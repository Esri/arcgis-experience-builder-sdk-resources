/*! For license information please see 7ac4f8d4951a50e07972c85427bfb177.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[58056],{58056:(e,t,i)=>{i.r(t),i.d(t,{arcgis_filter:()=>ie,arcgis_filter_condition:()=>pe,arcgis_filter_expression:()=>he,arcgis_filter_unique_list:()=>ge});var s=i(28384),r=i(62727),n=i(66716),a=i(81068),o=i(34077),l=i(26426);i(72637),i(18869);const u="match-expression-msg";var c,d,p,h,g,m;function f(e){return null!=e}function v(e){return!e||!e.filter||!["geometry","objectIds","timeExtent","where"].some((t=>e.filter.hasOwnProperty(t)&&!!e.filter[t]))}function y(e){return e&&e.length?e.map(((e,t)=>e.uid===`expression-${t}`?Object.assign(Object.assign({},e),{conditions:e.conditions.map(((e,i)=>{const s=`condition-${t}-${i}`;return e.uid===s?e:Object.assign(Object.assign({},e),{uid:s})}))}):Object.assign(Object.assign({},e),{uid:`expression-${t}`,expressionIndex:t,conditions:e.conditions.map(((e,i)=>{const s=`condition-${t}-${i}`;return e.uid===s?e:Object.assign(Object.assign({},e),{uid:s})}))}))):e}function O(e,t){let i;if(t&&"system"!==t)if("unknown"===t)i=new Date(e).toISOString();else{const s=(new Date).getTimezoneOffset(),r=new Date(e).toLocaleString("en-US",{timeZone:t});i=new Date(new Date(r).getTime()-6e4*s).toISOString()}else{const t=(new Date).getTimezoneOffset();i=new Date(e-6e4*t).toISOString()}return i}function I(e,t,i,s){let r;return r="unknown"===t?i.formatDate(e,Object.assign(Object.assign({},i.convertDateFormatToIntlOptions(s||"short-date-short-time")),{timeZone:"utc",timeZoneName:"shortOffset"})):i.formatDate(e,Object.assign(Object.assign({},i.convertDateFormatToIntlOptions(s||"short-date-short-time")),{timeZone:t})),r}function b(e,t){const i=t.fieldDomains;if(i){let t="";for(let s=0;s<i.length;s++){const r=i[s];r.code==e&&(t+=(t.length?" | ":"")+r.name)}return t}return e}function E(e){var t;return null===(t=e.fieldDomains)||void 0===t?void 0:t.length}function N(e,t){if(!e.fields||!e.fields.length){e.fields=[],e.stringFieldsCount=0,e.dateFieldsCount=0,e.numberFieldsCount=0,e.supportsStandardizedQuery||(t=t.filter((e=>-1===["date","date-only"].indexOf(e.type))));let i=[];if("subtype-group"!==e.layer.type){const{popupTemplate:t}=e.layer;i=t?t.fieldInfos:[]}t.forEach((t=>{const s=i?i.filter((e=>e.fieldName===t.name)):null,r=(null==s?void 0:s.length)?s[0].label:null,n={layerField:t,statisticsStatus:p.MISSING,histogramStatus:p.MISSING,uniqueValuesStatus:p.MISSING,partialUniqueValues:!1,label:r||t.alias||t.name};C(e,n),n.simpleFieldType&&e.fields.push(n)})),async function(e){const{layer:t,fields:i}=e;if("feature"!==t.type)return;const s=t.typeIdField,r=t.types;i.forEach((async t=>{const i=t.layerField.name,a=t.layerField.domain,o=F(i,e);if(o){if(s&&r){if(s===i?(o.fieldDomains=r.map((e=>({code:e.id,name:e.name}))),C(e,o)):(o.fieldDomains=[],r.forEach((e=>{var t,s;if(e.domains&&e.domains[i]&&"inherited"!==e.domains[i].type)(null===(s=null===(t=e.domains)||void 0===t?void 0:t[i])||void 0===s?void 0:s.codedValues)&&e.domains[i].codedValues.forEach((async e=>{let t=!1;if(o.fieldDomains.forEach((i=>{i.code===e.code&&(t=!0,-1===`, ${i.name},`.indexOf(`, ${e.name},`)&&(i.name+=`, ${e.name}`))})),!t){const[t]=await(0,n.l)(["esri/core/lang"]);o.fieldDomains.push(t.clone(e))}}));else{const e=a;(null==e?void 0:e.codedValues)&&e.codedValues.forEach((async e=>{let t=!1;if(o.fieldDomains.forEach((i=>{i.code===e.code&&(t=!0,-1===`, ${i.name},`.indexOf(`, ${e.name},`)&&(i.name+=`, ${e.name}`))})),!t){const[t]=await(0,n.l)(["esri/core/lang"]);o.fieldDomains.push(t.clone(e))}}))}}))),!E(o)&&(null==a?void 0:a.codedValues)){const[e]=await(0,n.l)(["esri/core/lang"]);o.fieldDomains=e.clone(a.codedValues)}}else(null==a?void 0:a.codedValues)&&(o.fieldDomains=a.codedValues);C(e,o)}}))}(e)}}function F(e,t){const{fields:i}=t;for(let t=0;t<i.length;t++){const s=i[t];if(s.layerField.name===e)return s}}function T(e){const{fields:t,defaultFieldName:i}=e;if(i){const e=t.find((e=>e.layerField.name===i));if(e)return e}let s;for(let e=0;e<t.length;e++){const i=t[e];if(i.simpleFieldType&&-1===[d.OID,d.GUID,d.DATE].indexOf(i.simpleFieldType)){if(i.simpleFieldType!==d.NUMBER||s)return i;s=i}}return s||t[0]}function x(e,t,i){var s;const{strings:r}=e,n={},a=t.statistics;if(!a)return t.simpleFieldType===d.STRING&&t.uniqueValuesStatus===p.SUCCESS&&(null===(s=t.uniqueValueInfos)||void 0===s?void 0:s.length)&&[r.operators.stringOperatorIs,r.operators.stringOperatorIsNot].indexOf(i)>-1&&(n.value=t.uniqueValueInfos[0].value),n;if(P(e,i)){const e=(new Date).getTime(),t=Math.abs(e-a.avg);t>2*g.YEAR?(n.value=Math.round(t/g.YEAR),n.unit=h.YEAR):t>2*g.MONTH?(n.value=Math.round(t/g.MONTH),n.unit=h.MONTH):t>2*g.WEEK?(n.value=Math.round(t/g.WEEK),n.unit=h.WEEK):t>2*g.DAY?(n.value=Math.round(t/g.DAY),n.unit=h.DAY):t>2*g.HOUR?(n.value=Math.round(t/g.HOUR),n.unit=h.HOUR):(n.value=Math.round(t/g.MINUTE),n.unit=h.MINUTE)}else V(e,i)?(n.value=S(a.avg,e,t),n.value2=S(a.max,e,t)):n.value=S(a.avg,e,t);return n}function S(e,t,i){return f(e)&&(D(i)?Math.round(e):function(e,t,i){const s=function(e,t){const{layer:i}=e;let s=2;const r="subtype-group"!==i.type&&i.popupTemplate;if(r){const e=r.fieldInfos.filter((e=>e.fieldName===t.layerField.name));if(null==e?void 0:e.length){const t=e[0];t.format&&f(t.format.places)&&(s=t.format.places)}}return s}(t,i),r=Math.pow(10,s);return f(e)&&Math.round(e*r)/r}(e,t,i))}function C(e,t){switch(t.layerField.type){case"string":t.simpleFieldType=d.STRING,e.stringFieldsCount++;break;case"date":E(t)?(t.simpleFieldType=d.STRING,e.stringFieldsCount++):(t.simpleFieldType=d.DATE,e.dateFieldsCount++);break;case"date-only":t.simpleFieldType=d.DATE_ONLY;break;case"oid":t.simpleFieldType=d.OID;break;case"guid":t.simpleFieldType=d.GUID;break;case"small-integer":case"big-integer":case"integer":case"single":case"double":case"long":E(t)?(t.simpleFieldType=d.STRING,e.stringFieldsCount++):(t.simpleFieldType=d.NUMBER,e.numberFieldsCount++)}}function w(e){return["small-integer","big-integer","integer","single","double","long"].indexOf(e.layerField.type)>-1}function D(e){return["small-integer","big-integer","integer","long"].indexOf(e.layerField.type)>-1}function R(e){return["date"].indexOf(e.layerField.type)>-1}function k(e){return["date-only"].indexOf(e.layerField.type)>-1}function L(e){const{layer:t,expressions:i,strings:s}=e;if("feature"!==t.type)return;const{portalItem:r,sourceJSON:n}=t;if(!r)return;const{typeKeywords:a,itemControl:o,portal:l}=r,u=l.isPortal,c=(null==a?void 0:a.indexOf("Hosted Service"))>-1,p=!u&&(null==a?void 0:a.indexOf("Location Tracking Service"))>-1;if(c&&!p&&l.user&&o&&["admin","update"].indexOf(o)>-1){const t=s.operators,r=[t.stringOperatorEndsWith,t.stringOperatorContains,t.stringOperatorDoesNotContain],a=[],o=t=>{const i=t.fieldName;if(!i)return;const s=F(i,e);((null==s?void 0:s.simpleFieldType)!==d.STRING&&(null==s?void 0:s.simpleFieldType)!==d.GUID||!(s.layerField.length>4e3||r.indexOf(t.operator)>-1))&&-1===a.indexOf(i)&&a.push(i)};null==i||i.forEach((e=>e.conditions.forEach((e=>o(e)))));const l={indexes:[]};n.indexes=n.indexes||[],a.forEach((e=>{n.indexes.some((t=>t.fields===e))||l.indexes.push({name:`${e}_Index`,fields:e,isUnique:!1,isAscending:!0,description:`${e}_Index`})})),l.indexes.length&&M(l,e)}}async function M(e,t){var i,s;const{layer:r,parentServiceUrl:a}=t;if("feature"!==r.type)return;const{portalItem:o,sourceJSON:l}=r,{typeKeywords:u,portal:c}=o,d=u.includes("View Service"),[p,h]=await(0,n.l)(["esri/identity/IdentityManager","esri/request"]);if(d&&!a){var g=`${c.restUrl}/content/items/${o.id}/relatedItems?relationshipType=Service2Service&direction=reverse`;const s=await p.getCredential(c.restUrl,{prompt:!1}),r=await h(g,{query:{f:"json",token:s.token}});return void((null===(i=null==r?void 0:r.data)||void 0===i?void 0:i.total)&&r.data.relatedItems.filter((e=>e.typeKeywords.includes("Hosted Service"))).forEach((i=>{t.parentServiceUrl=i.url,M(e,t)})))}const m=`${(a||r.url).replace("/rest/services","/rest/admin/services")}/${r.layerId}/addToDefinition`,f=await p.getCredential(r.url,{prompt:!1}),v={f:"json",addToDefinition:JSON.stringify(e),async:!c.isPortal,token:f.token},y=await h(m,{query:v,method:"post"});if(c.isPortal)l.indexes=l.indexes||[],l.indexes=l.indexes.concat(e.indexes);else try{await $(null===(s=null==y?void 0:y.data)||void 0===s?void 0:s.statusURL,{f:"json",token:f.token},h),l.indexes=l.indexes||[],l.indexes=l.indexes.concat(e.indexes)}catch(e){}}!function(e){e.AND="and",e.OR="or"}(c||(c={})),function(e){e.NUMBER="number",e.STRING="string",e.DATE="date",e.DATE_ONLY="date-only",e.OID="oid",e.GUID="guid",e.DOMAIN="domain"}(d||(d={})),function(e){e.MISSING="missing",e.IN_PROGRESS="inProgress",e.SUCCESS="success",e.FAILED="failed"}(p||(p={})),function(e){e.MINUTE="minute",e.HOUR="hour",e.DAY="day",e.WEEK="week",e.MONTH="month",e.YEAR="year"}(h||(h={})),function(e){e[e.MINUTE=6e4]="MINUTE",e[e.HOUR=36e5]="HOUR",e[e.DAY=864e5]="DAY",e[e.WEEK=6048e5]="WEEK",e[e.MONTH=2592e6]="MONTH",e[e.YEAR=31104e6]="YEAR"}(g||(g={})),function(e){e.SMALL="s",e.MEDIUM="m",e.LARGE="l"}(m||(m={}));const $=async(e,t,i)=>{var s;if(!e)throw new Error("pollForStatus: no status URL");const r=["processing","partial","Pending","InProgress"],n=["completed","Completed"];try{const a=await i(e,{query:t}),o=null===(s=null==a?void 0:a.data)||void 0===s?void 0:s.status;if(r.includes(o))return await(0,l.t)(500),$(e,t,i);if(n.includes(o))return a;throw a}catch(e){throw console.error(e),e}};function A(e,t){const{strings:i,defaultOperator:s}=e;if("cluster_count"===t.layerField.name)return i.operators.numberOperatorIsGreaterThan;switch(t.layerField.type){case"string":return i.operators.stringOperatorIs;case"date":case"date-only":if(E(t))return i.operators.stringOperatorIs;if(!s)return i.operators.dateOperatorIsBefore;switch(s){case">":case">=":return i.operators.dateOperatorIsAfter;case"<":case"<=":return i.operators.dateOperatorIsBefore;default:return i.operators.dateOperatorIsOn}case"oid":case"guid":return i.operators.numberOperatorIs;case"small-integer":case"big-integer":case"integer":case"single":if(E(t))return i.operators.stringOperatorIs;if(!s)return i.operators.numberOperatorIs;switch(s){case">":return i.operators.numberOperatorIsGreaterThan;case">=":return i.operators.numberOperatorIsAtLeast;case"<":return i.operators.numberOperatorIsLessThan;case"<=":return i.operators.numberOperatorIsAtMost;default:return i.operators.numberOperatorIs}case"double":case"long":if(E(t))return i.operators.stringOperatorIs;if(!s)return i.operators.numberOperatorIsAtLeast;switch(s){case">":return i.operators.numberOperatorIsGreaterThan;case">=":return i.operators.numberOperatorIsAtLeast;case"<":return i.operators.numberOperatorIsLessThan;case"<=":return i.operators.numberOperatorIsAtMost;default:return i.operators.numberOperatorIs}default:return i.operators.stringOperatorIs}}function V(e,t){const{strings:i}=e;return!!(t&&[i.operators.numberOperatorIsBetween,i.operators.numberOperatorIsNotBetween,i.operators.dateOperatorIsBetween,i.operators.dateOperatorIsNotBetween].indexOf(t)>-1)}function B(e,t){const{strings:i}=e;return!!(t&&[i.operators.stringOperatorIsBlank,i.operators.stringOperatorIsNotBlank,i.operators.numberOperatorIsBlank,i.operators.numberOperatorIsNotBlank,i.operators.dateOperatorIsBlank,i.operators.dateOperatorIsNotBlank].indexOf(t)>-1)}function U(e,t){const{strings:i}=e;return!!(t&&[i.operators.stringOperatorIsEmpty,i.operators.stringOperatorIsNotEmpty].indexOf(t)>-1)}function q(e,t){const{strings:i}=e;return!!(t&&[i.operators.stringOperatorIncludes,i.operators.stringOperatorExcludes,i.operators.numberOperatorIncludes,i.operators.numberOperatorExcludes].indexOf(t)>-1)}function P(e,t){const{strings:i}=e;return!!(t&&[i.operators.dateOperatorInTheLast,i.operators.dateOperatorNotInTheLast].indexOf(t)>-1)}const H=86399e3;function j(e){let t="";if(!e.expressions||!e.expressions.length)return null;let i="",s=0;for(let r=0;r<e.expressions.length;r++){const n=G(e.expressions[r],e);n.length&&(0===s?t=n:1===s?(i=` ${e.logicalOperatorForExpressions===c.OR?"OR":"AND"} `,t=`(${t})${i}(${n})`):t+=`${i}(${n})`,s++)}return t.length?t:null}function G(e,t){let i="";if(1===e.conditions.length)i=_(e.conditions[0],t);else{let s="";for(let r=0;r<e.conditions.length;r++){const n=_(e.conditions[r],t);n.length&&(i+=s+n,s=` ${e.logicalOperatorForConditions===c.OR?"OR":"AND"} `)}}return i}function _(e,t){const{strings:i}=t,s=e.fieldName,r=e.operator;let n=e.value,a=e.value2,o=e.values||[];const l=e.unit,u=F(s,t);if(!u)return"";if(V(t,r)&&!f(a))return"";if(q(t,r)&&!o.length)return"";if(P(t,r)&&!f(n))return"";if(!(f(n)||o.length||B(t,r)||U(t,r)))return"";let c="";if(u.simpleFieldType===d.STRING||u.simpleFieldType===d.GUID){let r="";f(n)&&t.isHosted&&J(n)&&(r="N");const a=w(u),l=null==n?void 0:n.toString().replace(/\'/g,"''");switch(e.operator){case i.operators.stringOperatorIs:c=`${s} = ${a?n:`${r}'${l}'`}`;break;case i.operators.stringOperatorIsNot:c=`${s} <> ${a?n:`${r}'${l}'`}`;break;case i.operators.stringOperatorStartsWith:c=`${s} LIKE ${r}'${l}%'`;break;case i.operators.stringOperatorEndsWith:c=`${s} LIKE ${r}'%${l}'`;break;case i.operators.stringOperatorContains:c=`${s} LIKE ${r}'%${l}%'`;break;case i.operators.stringOperatorDoesNotContain:c=`${s} NOT LIKE ${r}'%${l}%'`;break;case i.operators.stringOperatorIncludes:c=`${s} IN (${o.map((e=>a?e:`${J(e)?"N":""}'${null==e?void 0:e.toString().replace(/\'/g,"''")}'`)).toString()})`;break;case i.operators.stringOperatorExcludes:c=`${s} NOT IN (${o.map((e=>a?e:`${J(e)?"N":""}'${null==e?void 0:e.toString().replace(/\'/g,"''")}'`)).toString()})`;break;case i.operators.stringOperatorIsBlank:c=`${s} IS NULL`;break;case i.operators.stringOperatorIsNotBlank:c=`${s} IS NOT NULL`;break;case i.operators.stringOperatorIsEmpty:c=`${s} = ''`;break;case i.operators.stringOperatorIsNotEmpty:c=`${s} <> ''`}}else if(u.simpleFieldType===d.NUMBER||u.simpleFieldType===d.OID)switch(r){case i.operators.numberOperatorIs:c=`${s} = ${n}`;break;case i.operators.numberOperatorIsNot:c=`${s} <> ${n}`;break;case i.operators.numberOperatorIsAtLeast:c=`${s} >= ${n}`;break;case i.operators.numberOperatorIsLessThan:c=`${s} < ${n}`;break;case i.operators.numberOperatorIsAtMost:c=`${s} <= ${n}`;break;case i.operators.numberOperatorIsGreaterThan:c=`${s} > ${n}`;break;case i.operators.numberOperatorIsBetween:c=`${s} BETWEEN ${n} AND ${a}`;break;case i.operators.numberOperatorIsNotBetween:c=`${s} NOT BETWEEN ${n} AND ${a}`;break;case i.operators.numberOperatorIncludes:c=`${s} IN (${o.toString()})`;break;case i.operators.numberOperatorExcludes:c=`${s} NOT IN (${o.toString()})`;break;case i.operators.numberOperatorIsBlank:c=`${s} IS NULL`;break;case i.operators.numberOperatorIsNotBlank:c=`${s} IS NOT NULL`}else if(u.simpleFieldType===d.DATE_ONLY){const e=t.supportsStandardizedQuery?"DATE ":"";if("number"==typeof n){const e=new Date(n);n=`${e.getFullYear()}-${e.getMonth()<9?"0":""}${e.getMonth()+1}-${e.getDate()<10?"0":""}${e.getDate()}`}if(f(a)&&"number"==typeof a){const e=new Date(a);a=`${e.getFullYear()}-${e.getMonth()<9?"0":""}${e.getMonth()+1}-${e.getDate()<10?"0":""}${e.getDate()}`}switch(r){case i.operators.dateOperatorIsOn:case i.operators.numberOperatorIncludes:c=`${s} = ${e}'${n}'`;break;case i.operators.dateOperatorIsNotOn:case i.operators.numberOperatorExcludes:c=`${s} <> ${e}'${n}'`;break;case i.operators.dateOperatorIsBefore:c=`${s} < ${e}'${n}'`;break;case i.operators.dateOperatorIsAfter:c=`${s} > ${e}'${n}'`;break;case i.operators.dateOperatorIsBetween:c=`${s} BETWEEN ${e}'${n}' AND ${e}'${a}'`;break;case i.operators.dateOperatorIsNotBetween:c=`${s} NOT BETWEEN ${e}'${n}' AND ${e}'${a}'`;break;case i.operators.dateOperatorIsBlank:c=`${s} IS NULL`;break;case i.operators.dateOperatorIsNotBlank:c=`${s} IS NOT NULL`}}else{let e=W(n),o=W(a);const u=t.supportsStandardizedQuery?"timestamp ":"",d=Y(e),p=Y(Z(e)),h=Y(Z(o));switch(r){case i.operators.dateOperatorIsOn:c=`${s} BETWEEN ${u}'${d}' AND ${u}'${p}'`;break;case i.operators.dateOperatorIsNotOn:c=`${s} NOT BETWEEN ${u}'${d}' AND ${u}'${p}'`;break;case i.operators.dateOperatorIsBefore:c=`${s} < ${u}'${d}'`;break;case i.operators.dateOperatorIsAfter:c=`${s} > ${u}'${p}'`;break;case i.operators.dateOperatorInTheLast:c=`${s} BETWEEN ${K(t,n,l)}`;break;case i.operators.dateOperatorNotInTheLast:c=`${s} NOT BETWEEN ${K(t,n,l)}`;break;case i.operators.dateOperatorIsBetween:c=`${s} BETWEEN ${u}'${d}' AND ${u}'${h}'`;break;case i.operators.dateOperatorIsNotBetween:c=`${s} NOT BETWEEN ${u}'${d}' AND ${u}'${h}'`;break;case i.operators.dateOperatorIsBlank:c=`${s} IS NULL`;break;case i.operators.dateOperatorIsNotBlank:c=`${s} IS NOT NULL`}}return c}function W(e){return"number"==typeof e?new Date(e):"string"==typeof e?function(e){return new Date(e)}(e):e||void 0}function Y(e){if(!e)return"";const t=`${e.getUTCFullYear()}`;let i=`${e.getUTCMonth()+1}`;1===i.length&&(i=`0${i}`);let s=`${e.getUTCDate()}`;1===s.length&&(s=`0${s}`);let r=`${e.getUTCHours()}`;1===r.length&&(r=`0${r}`);let n=`${e.getUTCMinutes()}`;1===n.length&&(n=`0${n}`);let a=`${e.getSeconds()}`;return 1===a.length&&(a=`0${a}`),`${t}-${i}-${s} ${r}:${n}:${a}`}function K(e,t,i){if(e.supportedSqlParserVersion){let e=0;return"year"===i?(e=365*t,`CURRENT_TIMESTAMP - INTERVAL '${e}' DAY AND CURRENT_TIMESTAMP`):"month"===i?(e=30*t,`CURRENT_TIMESTAMP - INTERVAL '${e}' DAY AND CURRENT_TIMESTAMP`):"week"===i?(e=7*t,`CURRENT_TIMESTAMP - INTERVAL '${e}' DAY AND CURRENT_TIMESTAMP`):"day"===i?(e=t,`CURRENT_TIMESTAMP - INTERVAL '${e}' DAY AND CURRENT_TIMESTAMP`):"hour"===i?`CURRENT_TIMESTAMP - INTERVAL '${t}' HOUR AND CURRENT_TIMESTAMP`:`CURRENT_TIMESTAMP - INTERVAL '${t}' MINUTE AND CURRENT_TIMESTAMP`}{let e=0;return e="year"===i?365*t:"month"===i?30*t:"week"===i?7*t:"day"===i?t:"hour"===i?t/24:t/1440,`CURRENT_TIMESTAMP - ${e} AND CURRENT_TIMESTAMP`}}function z(e){let t=new Date(e);return new Date(t.getTime()-6e4*t.getTimezoneOffset())}function Z(e){if(e)return new Date(e.getTime()+H)}function J(e){if("number"==typeof e)return!1;for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!0;return!1}async function Q(e,t){const{layer:i}=t;if(e&&e.length){const[s]=await(0,n.l)(["esri/core/sql"]);return s.parseWhereClause(e,i.fieldsIndex).then((e=>{if(!e.isStandardized)return!1;t.expressions=[{conditions:[]}];const i=function(e,t){return!!t.expressions&&(ee(e)?X(e,t.expressions[0].conditions,t):(t.logicalOperatorForExpressions=te(e),X(e,t.expressions[0],t)))}(e.parseTree,t);return t.expressions=y(t.expressions),i}),(e=>(console.error("SQLParser - error:",e),!1)))}return!0}function X(e,t,i){var s;const{strings:r}=i;if(ee(e)){if("column-reference"===e.left.type){const s=F(e.left.column,i),n=s?function(e,t,i,s){var r,n,a,o;const{strings:l}=e;if(!i)return"";if(i.simpleFieldType===d.STRING)switch(t){case"=":return""===s.value?l.operators.stringOperatorIsEmpty:l.operators.stringOperatorIs;case"<>":return""===s.value?l.operators.stringOperatorIsNotEmpty:l.operators.stringOperatorIsNot;case"LIKE":return s.value.startsWith("%")&&s.value.endsWith("%")?(s.value=s.value.substring(1,s.value.length-1),l.operators.stringOperatorContains):s.value.endsWith("%")?(s.value=s.value.substring(0,s.value.length-1),l.operators.stringOperatorStartsWith):s.value.startsWith("%")?(s.value=s.value.substring(1),l.operators.stringOperatorEndsWith):l.operators.stringOperatorIs;case"NOT LIKE":return s.value.startsWith("%")&&s.value.endsWith("%")?s.value=s.value.substring(1,s.value.length-1):s.value.endsWith("%")?s.value=s.value.substring(0,s.value.length-1):s.value.startsWith("%")&&(s.value=s.value.substring(1)),l.operators.stringOperatorDoesNotContain;case"IS":return"null"===s.type?l.operators.stringOperatorIsBlank:l.operators.stringOperatorIs;case"ISNOT":case"IS NOT":return"null"===s.type?l.operators.stringOperatorIsNotBlank:l.operators.stringOperatorIs;case"IN":return l.operators.stringOperatorIncludes;case"NOT IN":case"NOTIN":return l.operators.stringOperatorExcludes}else if("number"===i.simpleFieldType||"oid"===i.simpleFieldType)switch(t){case"=":return l.operators.numberOperatorIs;case"<>":return l.operators.numberOperatorIsNot;case">=":return l.operators.numberOperatorIsAtLeast;case"<":return l.operators.numberOperatorIsLessThan;case"<=":return l.operators.numberOperatorIsAtMost;case">":return l.operators.numberOperatorIsGreaterThan;case"BETWEEN":return l.operators.numberOperatorIsBetween;case"NOT BETWEEN":case"NOTBETWEEN":return l.operators.numberOperatorIsNotBetween;case"IS":return"null"===s.type?l.operators.numberOperatorIsBlank:l.operators.numberOperatorIs;case"ISNOT":case"IS NOT":return"null"===s.type?l.operators.numberOperatorIsNotBlank:l.operators.numberOperatorIs;case"IN":return l.operators.numberOperatorIncludes;case"NOT IN":case"NOTIN":return l.operators.numberOperatorExcludes}else switch(t){case"=":return l.operators.dateOperatorIsOn;case"<>":return l.operators.dateOperatorIsNotOn;case"<":return l.operators.dateOperatorIsBefore;case">":return l.operators.dateOperatorIsAfter;case"BETWEEN":return"current-time"===(null===(n=null===(r=s.value[0])||void 0===r?void 0:r.left)||void 0===n?void 0:n.type)?l.operators.dateOperatorInTheLast:l.operators.dateOperatorIsBetween;case"NOT BETWEEN":case"NOTBETWEEN":return"current-time"===(null===(o=null===(a=s.value[0])||void 0===a?void 0:a.left)||void 0===o?void 0:o.type)?l.operators.dateOperatorNotInTheLast:l.operators.dateOperatorIsNotBetween;case"IS":if("null"===s.type)return l.operators.dateOperatorIsBlank;case"ISNOT":case"IS NOT":if("null"===s.type)return l.operators.dateOperatorIsNotBlank}return""}(i,e.operator,s,e.right):void 0;if(!s||!n)return!1;{let a;if("null"===e.right.type)a={fieldName:s.layerField.name,operator:n};else{if("column-reference"===e.right.type)return!1;if("expression-list"===e.right.type&&q(i,n))a={fieldName:s.layerField.name,operator:n,values:e.right.value.map((e=>e.value))};else if("expression-list"===e.right.type&&P(i,n)){const t=function(e){const t=e.right.value[0].right;let i=t.value;if("interval"!==t.type){if(isNaN(i))return null;if(i%365==0)return{value:i/365,unit:"year"};if(i%30==0)return{value:i/30,unit:"month"};if(i%7==0)return{value:i/7,unit:"week"};if(i%1==0)return{value:i,unit:"day"};{const e=Math.round(24*i*60);return e%60==0?{value:Math.round(24*i),unit:"hour"}:{value:e,unit:"minute"}}}if(i="string"===t.value.type?parseFloat(t.value.value):t.value.value,"day"===t.qualifier.period){if(i%365==0)return{value:i/365,unit:"year"};if(i%30==0)return{value:i/30,unit:"month"};if(i%7==0)return{value:i/7,unit:"week"};if(i%1==0)return{value:i,unit:"day"}}else{if("hour"===t.qualifier.period)return{value:i,unit:"hour"};if("minute"===t.qualifier.period)return{value:i,unit:"minute"}}}(e);if(!t)return!1;a={fieldName:s.layerField.name,operator:n,value:t.value,unit:t.unit}}else if("expression-list"===e.right.type&&V(i,n))if(R(s)){const t=z(e.right.value[0].value),i=z(e.right.value[1].value),o=new Date(i.getTime()-H);a=Math.abs(o.getTime()-t.getTime())<1e3?{fieldName:s.layerField.name,operator:n===r.operators.dateOperatorIsBetween?r.operators.dateOperatorIsOn:r.operators.dateOperatorIsNotOn,value:t.getTime()}:{fieldName:s.layerField.name,operator:n,value:t.getTime(),value2:i.getTime()}}else if(k(s)){const t=z(e.right.value[0].value),i=z(e.right.value[1].value),r=6e4*t.getTimezoneOffset();a={fieldName:s.layerField.name,operator:n,value:t.getTime()+2*r,value2:i.getTime()+2*r}}else a={fieldName:s.layerField.name,operator:n,value:e.right.value[0].value,value2:e.right.value[1].value};else if("timestamp"===e.right.type)a={fieldName:s.layerField.name,operator:n,value:z(e.right.value).getTime()};else if("date"===e.right.type)if(s.simpleFieldType===d.DATE_ONLY){const t=z(e.right.value),i=6e4*t.getTimezoneOffset();a={fieldName:s.layerField.name,operator:n,value:t.getTime()+2*i}}else a={fieldName:s.layerField.name,operator:n,value:z(e.right.value).getTime()};else a={fieldName:s.layerField.name,operator:n,value:e.right.value}}t.push(a)}return!0}return!1}{let r;if(i.expressions=i.expressions||[],ee(e.left)&&ee(e.right))t.logicalOperatorForConditions=te(e),r=X(e.left,t.conditions,i),r=r&&X(e.right,t.conditions,i);else if(ee(e.left))if(e.operator===e.right.operator&&ee(e.right.left)&&ee(e.right.right))t.logicalOperatorForConditions=te(e),r=X(e.left,t.conditions,i),r=r&&X(e.right,t,i);else{r=X(e.left,t.conditions,i);const s={conditions:[]};i.expressions.push(s),r=r&&X(e.right,s,i)}else if(ee(e.right))if(e.operator===e.left.operator&&ee(e.left.right)&&(ee(e.left.left)||e.left.operator===(null===(s=e.left.left)||void 0===s?void 0:s.operator)))t.logicalOperatorForConditions=te(e),r=X(e.left,t,i),r=r&&X(e.right,t.conditions,i);else{r=X(e.left,t,i);const s={conditions:[]};i.expressions.push(s),r=r&&X(e.right,s.conditions,i)}else if(e.operator===e.right.operator&&e.operator===e.left.operator)t.logicalOperatorForConditions=te(e),r=X(e.left,t,i),r=r&&X(e.right,t,i);else{r=X(e.left,t,i);const s={conditions:[]};i.expressions.push(s),r=r&&X(e.right,s,i)}return r}}function ee(e){return"binary-expression"!==e.type||"OR"!==e.operator&&"AND"!==e.operator}function te(e){return"OR"===e.operator.toUpperCase()?c.OR:c.AND}const ie=class{constructor(e){(0,s.r)(this,e),this.arcgisFilterWhereChange=(0,s.c)(this,"arcgisFilterWhereChange",7),this.arcgisFilterSave=(0,s.c)(this,"arcgisFilterSave",7),this.arcgisFilterCancel=(0,s.c)(this,"arcgisFilterCancel",7),this.arcgisFilterDismissedChange=(0,s.c)(this,"arcgisFilterDismissedChange",7),this.arcgisFilterDone=(0,s.c)(this,"arcgisFilterDone",7),this.arcgisFilterPanelBackClick=(0,s.c)(this,"arcgisFilterPanelBackClick",7),this.closeFilterPopovers=(0,s.c)(this,"closeFilterPopovers",7),this.arcgisFilterExpressionChanged=(0,s.c)(this,"arcgisFilterExpressionChanged",7),this.layerViewWaitHandler=null,this.layerHasFeatureEffect=!1,this.properClose=!1,this.applyFilter=()=>{const{props:e,mode:t}=this,{layerView:i,layer:s,labelClassIdx:r,labelClass:n,originalLayer:a}=e;if(this.closeFilterPopovers.emit(),f(r)||f(n))this.arcgisFilterSave.emit();else if("layer-view"===t){const t=j(e);this.arcgisFilterSave.emit(t)}else if("effects"===t);else if(s){const t=j(e);(a||s).definitionExpression=t,this.isAllowedFeatureEffect()?s.featureEffect=null:i&&"filter"in i&&(i.filter=null),L(e),this.properClose=!0,this.arcgisFilterSave.emit(),this.componentStateInvalid=!0}},this.cancelFilter=()=>{this.revertFilter(),this.closeFilterPopovers.emit(),this.properClose=!0,this.arcgisFilterCancel.emit()},this.closeFilter=()=>{this.applyFilter(),this.closeFilterPopovers.emit(),this.properClose=!0,this.arcgisFilterDismissedChange.emit()},this.onAddExpression=()=>{const{props:e}=this,{expressions:t}=e,i=T(e);if(!i)return;const s=A(e,i),r=x(e,i,s),n={conditions:[Object.assign(Object.assign({fieldName:i.layerField.name,operator:s},r),{hasFocus:!0})]};e.expressions=y(t?[...t.map((e=>Object.assign(Object.assign({},e),{conditions:e.conditions.map((e=>Object.assign(Object.assign({},e),{hasFocus:!1})))}))),n]:[n]),f(r.value)&&this.arcgisFilterExpressionChanged.emit({type:"replace",expression:n}),this.reRender=!this.reRender},this.onMatchSelect=e=>{const{props:t}=this,i=e.target;t.logicalOperatorForExpressions=i.selectedOption.value,this.reRender=!this.reRender,this.applyFilterToLayer()},this.onRemoveFilter=()=>{const{props:e}=this;e.invalidFilter=!1,e.expressions=void 0,this.reRender=!this.reRender,this.applyFilterToLayer()},this.focusByClass=()=>{const e=this.hostElement.querySelector("arcgis-filter .autofocus");e&&(e.nodeName.startsWith("CALCITE-")?e.setFocus():e.focus())},this.view=void 0,this.layer=void 0,this.labelClassIdx=void 0,this.labelClass=void 0,this.mode=void 0,this.viewFilter=void 0,this.featureReduction=void 0,this.hideLayerTitle=!1,this.panelHeading=void 0,this.tipHeading=void 0,this.tipMsg=void 0,this.invalidHeading=void 0,this.invalidMsg=void 0,this.newButtonLabel=void 0,this.clearText=void 0,this.defaultFieldName=void 0,this.defaultOperator=void 0,this.defaultExpression=!1,this.hideButtons=!1,this.panelMaxHeight=void 0,this.dismissible=!1,this.props=void 0,this.reRender=!1,this.componentStateInvalid=!1}arcgisFilterExpressionChangeHandler(e){var t;const{props:i}=this,{expressions:s}=i,{detail:r}=e;if("copy"===r.type){const t=e.detail.expression;let n;i.expressions=i.expressions.map((e=>e.uid===t.uid?t:e)),i.expressions=s.map((e=>Object.assign(Object.assign({},e),{conditions:e.conditions.map((e=>Object.assign(Object.assign({},e),{hasFocus:!1})))}))),i.expressions.forEach((e=>{e.uid===r.uid&&(n=this.esriLang.clone(Object.assign({},e)),n.conditions[0].hasFocus=!0)})),i.expressions=y([...i.expressions,n]),this.reRender=!this.reRender}else if("delete"===r.type){let e=0;s.forEach(((t,i)=>{t.uid===r.uid?e=i:t.conditions.forEach((e=>e.hasFocus=!1))})),i.expressions=s.filter((e=>e.uid!==r.uid)),(null===(t=i.expressions)||void 0===t?void 0:t.length)?(i.expressions[Math.max(0,e-1)].conditions[0].hasFocus=!0,i.expressions=y([...i.expressions]),setTimeout((()=>this.focusByClass()),500)):setTimeout((()=>this.fabNode.setFocus()),500),this.reRender=!this.reRender}else{const t=e.detail.expression;i.expressions=i.expressions.map((e=>e.uid===t.uid?Object.assign({},t):e))}this.applyFilterToLayer()}disableFilterPanelHandler(e){this.panelNode.disabled=e.detail}async setFocus(){this.panelNode.setFocus()}async done(){this.componentStateInvalid||(this.applyFilter(),this.closeFilterPopovers.emit(),this.properClose=!0,this.arcgisFilterDone.emit())}async closePopovers(){this.closeFilterPopovers.emit()}async componentWillLoad(){const[e,t,i]=await(0,r.g)(this.hostElement);this.props={expressions:void 0,logicalOperatorForExpressions:"and",fields:[],operators:void 0,invalidFilter:!1,stringFieldsCount:0,dateFieldsCount:0,numberFieldsCount:0,isHosted:!1,supportsStandardizedQuery:!1,supportedSqlParserVersion:!1,layer:{},view:this.view,labelClassIdx:this.labelClassIdx,labelClass:this.labelClass,featureReduction:this.featureReduction,strings:e,locale:t,localeIntl:i,inputDefinitionExpression:null,backgroundTheme:"light",lastWhere:void 0,defaultFieldName:this.defaultFieldName,defaultOperator:this.defaultOperator};const[s,a,o,l,u,c]=await(0,n.l)(["esri/core/reactiveUtils","esri/views/support/colorUtils","esri/layers/ImageryLayer","esri/layers/FeatureLayer","esri/layers/support/FeatureEffect","esri/core/lang"]);this.reactiveUtils=s,this.colorUtils=a,this.ImageryLayer=o,this.FeatureLayer=l,this.FeatureEffect=u,this.esriLang=c;const{view:d,layer:p}=this;let{props:h}=this;const g=p;if("esri.layers.support.Sublayer"===g.declaredClass){const e=g;d&&await this.reactiveUtils.whenOnce((()=>!d.updating));const t=await e.createFeatureLayer();await t.load(),this.props=Object.assign(Object.assign({},h),{layer:t,mapImageSublayer:e})}else if("imagery"===g.type||"subtype-group"===g.type)this.props=Object.assign(Object.assign({},h),{layer:g});else if(!d||"feature"===g.type&&g.isTable){let e;e=new this.FeatureLayer({url:g.url,layerId:g.layerId,popupTemplate:g.popupTemplate}),await e.load(),this.props=Object.assign(Object.assign({},h),{layer:e,originalLayer:g})}else this.props=Object.assign(Object.assign({},h),{layer:g});const{labelClassIdx:m,labelClass:v,featureReduction:y}=this.props,O=y?p.featureReduction.labelingInfo:p.labelingInfo;(!f(m)||O&&O[m])&&(!f(v)||O&&O.length)?this.processLayer():console.log("can't find labelClass")}componentDidLoad(){var e;const{props:t,defaultExpression:i}=this;!(null===(e=t.expressions)||void 0===e?void 0:e.length)&&i&&this.onAddExpression(),requestAnimationFrame((()=>this.panelNode.setFocus()))}disconnectedCallback(){this.properClose?this.closeFilterPopovers.emit():(this.applyFilter(),"layer-view"===this.mode&&L(this.props))}render(){const{props:e,hideLayerTitle:t,mode:i,panelHeading:r,componentStateInvalid:n,dismissible:o,hostElement:l,panelMaxHeight:u}=this,c="rtl"===(0,a.g)(l),{layer:d,mapImageSublayer:p,invalidFilter:h,strings:g}=e,m=p?p.title:d.title;return n?(0,s.h)(s.H,null,(0,s.h)("div",null)):d?h?this.renderInvalidFilter():"CALCITE-FLOW"===l.parentElement.tagName||"CALCITE-FLOW"===l.parentElement.parentElement.tagName?(0,s.h)(s.H,null,(0,s.h)("calcite-flow-item",{id:"filter-panel",loading:!1,heading:r||g.title,description:t?void 0:m,class:{[a.C.rtl]:c},style:u&&{maxHeight:u},closable:o,ref:e=>this.panelNode=e,onCalciteFlowItemBack:()=>{if("layer-view"===i){const t=j(e);this.arcgisFilterPanelBackClick.emit(t)}else this.arcgisFilterPanelBackClick.emit()},onCalciteFlowItemClose:()=>this.closeFilter()},this.renderContent())):(0,s.h)(s.H,null,(0,s.h)("calcite-panel",{id:"filter-panel",loading:!1,heading:r||g.title,description:t?void 0:m,class:{[a.C.rtl]:c},style:u&&{maxHeight:u},closable:o,ref:e=>this.panelNode=e,onCalcitePanelClose:()=>this.closeFilter()},this.renderContent())):this.renderLoading()}renderContent(){const{props:e,mode:t,hideButtons:i}=this,{labelClassIdx:r,labelClass:n}=e,a=f(r)||f(n);return(0,s.h)(s.F,null,a||"layer-view"===t||i?null:this.renderSaveButton(),a||"layer-view"===t||i?null:this.renderCancelButton(),this.renderPopoverHook(),this.renderRemoveFilter(),this.renderMatchExpressionMsg(),this.renderExpressions(),this.renderAddExpression(),this.renderTip())}renderSaveButton(){const{props:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",onClick:this.applyFilter,appearance:"solid",width:"half",label:t.save},t.save)}renderCancelButton(){const{props:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",onClick:this.cancelFilter,appearance:"outline-fill",width:"half",label:t.cancel},t.cancel)}renderPopoverHook(){return(0,s.h)("div",{id:"arcgis-filter-hook",class:"hook"})}renderRemoveFilter(){const{props:e,clearText:t}=this,{strings:i,expressions:r}=e;return r&&r.length?(0,s.h)("div",{class:"remove-filter"},(0,s.h)("calcite-label",{class:"no-space",layout:"inline-space-between",scale:"m"},t||i.removeFilter,(0,s.h)("calcite-action",{text:t||i.removeFilter,scale:"m",onClick:this.onRemoveFilter},(0,s.h)("calcite-icon",{scale:"s",icon:"trash"})))):null}renderLoading(){const{props:e,hideLayerTitle:t,panelHeading:i}=this,{layer:r,mapImageSublayer:n,strings:o}=e,l=n?n.title:r.title,u="rtl"===(0,a.g)(this.hostElement);return(0,s.h)(s.H,null,(0,s.h)("calcite-panel",{id:"filter-panel",heading:i||o.title,description:t?void 0:l,loading:!0,class:{panel:!0,[a.C.rtl]:u}}))}renderInvalidFilter(){const{props:e,hideLayerTitle:t,dismissible:i,mode:r,hideButtons:n,panelHeading:o}=this,{layer:l,mapImageSublayer:u,labelClassIdx:c,labelClass:d,strings:p}=e,h=u?u.title:l.title,g="rtl"===(0,a.g)(this.hostElement),m=f(c)||f(d);return(0,s.h)(s.H,null,(0,s.h)("calcite-panel",{id:"filter-panel",heading:o||p.title,description:t?void 0:h,loading:!1,closable:i,class:{panel:!0,[a.C.rtl]:g},ref:this.focusByClass,onCalcitePanelClose:()=>this.closeFilter()},m||"layer-view"===r||n?null:this.renderSaveButton(),m||"layer-view"===r||n?null:this.renderCancelButton(),this.renderInvalidFilterMsg(),this.renderCreateNewFilter()))}renderInvalidFilterMsg(){const{invalidHeading:e,invalidMsg:t,props:i}=this,{strings:r}=i;return(0,s.h)("calcite-tip",{heading:e||r.errors.problemDisplayingFilter,closeDisabled:!0},(0,s.h)("div",null,t||r.errors.problemDisplayingFilterMsg))}renderCreateNewFilter(){const{props:e,newButtonLabel:t,hideButtons:i}=this,{strings:r}=e;return(0,s.h)("calcite-fab",{class:{autofocus:!0,"fab-padding":i},slot:"fab",appearance:"outline-fill",kind:"neutral",scale:"m",textEnabled:!0,label:t||r.createNewFilter,text:t||r.createNewFilter,onClick:this.onRemoveFilter})}renderMatchExpressionMsg(){const{props:e}=this,{expressions:t,logicalOperatorForExpressions:i,strings:r}=e;if(!t||!t.length)return null;const n=i===c.AND;return 1===t.length?(0,s.h)("div",{class:u},(0,s.h)("calcite-label",{scale:"m",class:"no-space"},r.oneExpressionMsg)):(0,s.h)("div",{class:u},(0,s.h)("calcite-label",{class:"no-space",scale:"m"},r.manyExpressionsMsg,(0,s.h)("calcite-select",{width:"full",scale:"m",label:r.accessibility.matchExpressions,class:"match-expression-dropdown",onCalciteSelectChange:this.onMatchSelect},(0,s.h)("calcite-option",{value:c.AND,label:r.matchAllExpressions,selected:n}),(0,s.h)("calcite-option",{value:c.OR,label:r.matchAtLeastOneExpression,selected:!n}))))}renderExpressions(){const{props:e}=this,{expressions:t}=e;return t&&t.length?(0,s.h)("div",null,t.map(((e,t)=>this.renderExpression(e,t)))):null}renderExpression(e,t){const{props:i}=this;return(0,s.h)("div",null,this.renderLogicalOperatorExpression(t),(0,s.h)("arcgis-filter-expression",Object.assign({props:i,ref:this.focusByClass},e)))}renderLogicalOperatorExpression(e){const{props:t}=this,{logicalOperatorForExpressions:i,strings:r}=t;return 0===e?null:(0,s.h)("div",{class:"match-type"},(0,s.h)("span",null,i===c.OR?r.or:r.and))}renderAddExpression(){const{props:e,hideButtons:t}=this,{expressions:i,strings:r}=e;return(0,s.h)("calcite-fab",{class:{autofocus:!i||!i.length,"fab-padding":t},slot:"fab",appearance:"outline-fill",kind:"neutral",scale:"m",icon:"plus",textEnabled:!0,text:r.addExpression,onClick:this.onAddExpression,ref:e=>this.fabNode=e})}renderTip(){const{props:e,mode:t,tipHeading:i,tipMsg:r}=this,{mapImageSublayer:n,expressions:a,labelClassIdx:o,labelClass:l,strings:u}=e;if(null==a?void 0:a.length)return null;const c=f(o)||f(l);return(0,s.h)("calcite-tip",{heading:i||u.tips.emptyMsgTitle,closeDisabled:!0},(0,s.h)("div",null,r||(c?u.tips.emptyMsgLabels:n||"layer-view"===t?u.tips.emptyMsgMS:u.tips.emptyMsg)))}async processLayer(){var e;const{props:t,mode:i,viewFilter:s,hideButtons:r}=this,{layer:a,mapImageSublayer:l,originalLayer:u,view:c,labelClassIdx:h,labelClass:g,featureReduction:m}=t,v="feature"===a.type&&(m?a.featureReduction.labelingInfo:a.labelingInfo);if(!c||l||"imagery"===a.type||"subtype-group"===a.type||"feature"===a.type&&a.isTable||(t.layerView=await c.whenLayerView(a)),function(e){var t,i;const{layer:s,mapImageSublayer:r}=e,n=s.url;if(e.supportsStandardizedQuery="version"in s&&s.version>=10.2&&!!(null===(i=null===(t=s.capabilities)||void 0===t?void 0:t.query)||void 0===i?void 0:i.supportsStandardizedQueriesOnly),e.supportedSqlParserVersion="feature"===s.type&&e.supportsStandardizedQuery&&s.sourceJSON.sqlParserVersion&&"ES_10.6.1"!==s.sourceJSON.sqlParserVersion,!n||r)return void(e.isHosted=!1);const a=-1!==n.indexOf(".arcgis.com/"),o=-1!==n.indexOf("//services")||-1!==n.indexOf("//tiles")||-1!==n.indexOf("//features")||-1!==n.indexOf("//locationservices")||-1!==n.indexOf("//us-iot")||-1!==n.indexOf("//eu-iot");e.isHosted=a&&o||!a&&!1}(t),await async function(e){const{layer:t,mapImageSublayer:i,featureReduction:s}=e;if(!t)return;if(s)return async function(e){var t;const{layer:i,view:s}=e;if("imagery"!==i.type&&"subtype-group"!==i.type&&!(null===(t=e.fields)||void 0===t?void 0:t.length)){e.fields=[],e.stringFieldsCount=0,e.dateFieldsCount=0,e.numberFieldsCount=1;let t=5e3,r=10,a=0;try{a=await(0,o.g)(i,s),t=a?Math.min(Math.max(10,Math.ceil(a/4)),5e3):5e3,r=a&&a>=1e3?100:10}catch(e){}const[l]=await(0,n.l)(["esri/layers/support/Field"]),u=i.featureReduction;e.fields=[],u.fields.forEach((s=>{const n="count"===s.statisticType,a=s.onStatisticField&&i.fields.find((e=>e.name===s.onStatisticField));if(!s.onStatisticField&&n||a){const i={layerField:new l({name:s.name,alias:s.alias||s.name,type:(null==a?void 0:a.type)||"integer"}),statisticsStatus:n?p.SUCCESS:p.MISSING,statistics:n?{min:1,max:t,avg:r}:void 0,histogramStatus:n?p.FAILED:p.MISSING,uniqueValuesStatus:p.MISSING,partialUniqueValues:!1,label:s.alias||s.name};C(e,i),e.fields.push(i)}}))}}(e);let r=t.fields;if(!(i&&i.layer.portalItem&&i.layer.url.indexOf("https://demographics")>-1&&i.layer.url.indexOf(".arcgis.com")>-1))return N(e,r);{const t=i.layer.portalItem;try{const i=await t.fetchData();if(null==i?void 0:i.thematicGroup){const e=i.thematicGroup.fieldNames;e&&(r=r.filter((t=>e.indexOf(t.name)>-1)))}return N(e,r)}catch(t){return N(e,r)}}}(t),function(e){const{layer:t,featureReduction:i,strings:s}=e,r="esri.layers.StreamLayer"===t.declaredClass,n="esri.layers.ImageryLayer"===t.declaredClass;e.operators||(e.operators={},e.operators[d.STRING]=[],e.operators[d.STRING].push({name:s.operators.stringOperatorIs}),e.operators[d.STRING].push({name:s.operators.stringOperatorIsNot}),r||n||(e.operators[d.STRING].push({name:s.operators.stringOperatorIncludes}),e.operators[d.STRING].push({name:s.operators.stringOperatorExcludes})),e.operators[d.STRING].push({name:s.operators.stringOperatorStartsWith}),e.operators[d.STRING].push({name:s.operators.stringOperatorEndsWith}),e.operators[d.STRING].push({name:s.operators.stringOperatorContains}),e.operators[d.STRING].push({name:s.operators.stringOperatorDoesNotContain}),e.operators[d.STRING].push({name:s.operators.stringOperatorIsBlank}),e.operators[d.STRING].push({name:s.operators.stringOperatorIsNotBlank}),e.operators[d.STRING].push({name:s.operators.stringOperatorIsEmpty}),e.operators[d.STRING].push({name:s.operators.stringOperatorIsNotEmpty}),e.operators[d.DATE]=[],e.operators[d.DATE].push({name:s.operators.dateOperatorIsOn}),e.operators[d.DATE].push({name:s.operators.dateOperatorIsNotOn}),e.operators[d.DATE].push({name:s.operators.dateOperatorIsBefore}),e.operators[d.DATE].push({name:s.operators.dateOperatorIsAfter}),(e.isHosted||e.supportedSqlParserVersion)&&(e.operators[d.DATE].push({name:s.operators.dateOperatorInTheLast}),e.operators[d.DATE].push({name:s.operators.dateOperatorNotInTheLast})),e.operators[d.DATE].push({name:s.operators.dateOperatorIsBetween}),e.operators[d.DATE].push({name:s.operators.dateOperatorIsNotBetween}),e.operators[d.DATE].push({name:s.operators.dateOperatorIsBlank}),e.operators[d.DATE].push({name:s.operators.dateOperatorIsNotBlank}),e.operators[d.DATE_ONLY]=[],e.operators[d.DATE_ONLY].push({name:s.operators.dateOperatorIsOn}),e.operators[d.DATE_ONLY].push({name:s.operators.dateOperatorIsNotOn}),e.operators[d.DATE_ONLY].push({name:s.operators.dateOperatorIsBefore}),e.operators[d.DATE_ONLY].push({name:s.operators.dateOperatorIsAfter}),e.operators[d.DATE_ONLY].push({name:s.operators.dateOperatorIsBetween}),e.operators[d.DATE_ONLY].push({name:s.operators.dateOperatorIsNotBetween}),e.operators[d.DATE_ONLY].push({name:s.operators.dateOperatorIsBlank}),e.operators[d.DATE_ONLY].push({name:s.operators.dateOperatorIsNotBlank}),e.operators[d.NUMBER]=[],e.operators[d.NUMBER].push({name:s.operators.numberOperatorIs}),e.operators[d.NUMBER].push({name:s.operators.numberOperatorIsNot}),i||r||n||(e.operators[d.NUMBER].push({name:s.operators.numberOperatorIncludes}),e.operators[d.NUMBER].push({name:s.operators.numberOperatorExcludes})),e.operators[d.NUMBER].push({name:s.operators.numberOperatorIsAtLeast}),e.operators[d.NUMBER].push({name:s.operators.numberOperatorIsLessThan}),e.operators[d.NUMBER].push({name:s.operators.numberOperatorIsAtMost}),e.operators[d.NUMBER].push({name:s.operators.numberOperatorIsGreaterThan}),e.operators[d.NUMBER].push({name:s.operators.numberOperatorIsBetween}),e.operators[d.NUMBER].push({name:s.operators.numberOperatorIsNotBetween}),i||(e.operators[d.NUMBER].push({name:s.operators.numberOperatorIsBlank}),e.operators[d.NUMBER].push({name:s.operators.numberOperatorIsNotBlank})),e.operators[d.DOMAIN]=[],e.operators[d.DOMAIN].push({name:s.operators.stringOperatorIs}),e.operators[d.DOMAIN].push({name:s.operators.stringOperatorIsNot}),r||n||n||(e.operators[d.DOMAIN].push({name:s.operators.stringOperatorIncludes}),e.operators[d.DOMAIN].push({name:s.operators.stringOperatorExcludes})),e.operators[d.DOMAIN].push({name:s.operators.stringOperatorIsBlank}),e.operators[d.DOMAIN].push({name:s.operators.stringOperatorIsNotBlank}),e.operators[d.DOMAIN].push({name:s.operators.stringOperatorIsEmpty}),e.operators[d.DOMAIN].push({name:s.operators.stringOperatorIsNotEmpty}))}(t),t.backgroundTheme=c&&await this.colorUtils.getBackgroundColorTheme(c),this.layerHasFeatureEffect=a.featureEffect,f(h)&&v[h].where){t.inputDefinitionExpression=v[h].where;const e=await Q(t.inputDefinitionExpression,t);t.invalidFilter=!e,this.reRender=!this.reRender}else if(f(g)&&g.where){t.inputDefinitionExpression=g.where,t.lastWhere=t.inputDefinitionExpression;const e=await Q(t.inputDefinitionExpression,this.props);t.invalidFilter=!e,this.reRender=!this.reRender}else if("layer-view"===i){if(s){const e=await Q(s,t);t.invalidFilter=!e,e&&this.applyFilterToLayer(!0),this.reRender=!this.reRender}}else if("effects"===i){if(t.invalidFilter=!1,a.featureEffect){t.inputDefinitionExpression=null===(e=a.featureEffect.filter)||void 0===e?void 0:e.where,t.lastWhere=t.inputDefinitionExpression;const i=await Q(t.inputDefinitionExpression,t);t.invalidFilter=!i,this.reRender=!this.reRender}}else if(f(h)||f(g)||!f(a.definitionExpression)&&!f(null==u?void 0:u.definitionExpression))if(r){t.inputDefinitionExpression=a.definitionExpression,t.lastWhere=t.inputDefinitionExpression;const e=await Q(t.inputDefinitionExpression,this.props);t.invalidFilter=!e,this.reRender=!this.reRender}else t.invalidFilter=!1;else{t.inputDefinitionExpression=(u||a).definitionExpression;const e=await Q(t.inputDefinitionExpression,t);t.invalidFilter=!e,e&&this.applyFilterToLayer(!0),this.reRender=!this.reRender,!c||"imagery"===a.type||"subtype-group"===a.type||"feature"===a.type&&a.isTable||"effects"===i&&this.layerHasFeatureEffect||(a.definitionExpression=null)}}revertFilter(){var e,t,i,s;const{props:r,mode:n,viewFilter:a}=this,{layer:o,layerView:l,featureReduction:u,labelClassIdx:c,labelClass:d,inputDefinitionExpression:p,mapImageSublayer:h,originalLayer:g,backgroundTheme:m}=r,y=this.getLabelClassIndex();if("imagery"!==o.type&&"subtype-group"!==o.type&&f(c))(u?o.featureReduction.labelingInfo:o.labelingInfo)[c].where=p,u?(o.featureReduction=this.esriLang.clone(o.featureReduction),r.labelClass=o.featureReduction.labelingInfo[y]):o.labelingInfo=o.labelingInfo,h&&(h.labelingInfo=o.labelingInfo);else if("imagery"!==o.type&&"subtype-group"!==o.type&&f(d))d.where=p,u?(o.featureReduction=this.esriLang.clone(o.featureReduction),r.labelClass=o.featureReduction.labelingInfo[y]):o.labelingInfo=o.labelingInfo,h&&(h.labelingInfo=o.labelingInfo);else if("layer-view"===n){if("feature"===o.type)if(a)if(v(o.featureEffect)){const e="light"===m?100:65;o.featureEffect=new this.FeatureEffect({filter:{where:a},excludedEffect:`grayscale(100%) opacity(30%) brightness(${e}%)`})}else o.featureEffect.filter.where=a;else(null===(t=null===(e=o.featureEffect)||void 0===e?void 0:e.filter)||void 0===t?void 0:t.where)?(o.featureEffect.filter.where=null,v(o.featureEffect)&&(o.featureEffect=null)):o.featureEffect=null}else if("effects"===n);else if(o){if(h?h.definitionExpression=p:(g||o).definitionExpression=p,this.isAllowedFeatureEffect()){const e=o;(null===(s=null===(i=e.featureEffect)||void 0===i?void 0:i.filter)||void 0===s?void 0:s.where)&&(e.featureEffect.filter.where=null,v(e.featureEffect)&&(e.featureEffect=null))}else l&&"filter"in l&&(l.filter=null);this.componentStateInvalid=!0}}applyFilterToLayer(e){var t,i;const{props:s,layerViewWaitHandler:r,hideButtons:n}=this,{backgroundTheme:a,labelClass:o,layer:l,labelClassIdx:u,view:c,layerView:d,mapImageSublayer:p,originalLayer:h,featureReduction:g,lastWhere:m}=s,y=j(s)||void 0;if(e||y===m||this.arcgisFilterWhereChange.emit(y),s.lastWhere=y,"feature"===l.type&&f(u)){const e=this.getLabelClassIndex();return(g?l.featureReduction.labelingInfo:l.labelingInfo)[u].where=y,g?(l.featureReduction=this.esriLang.clone(l.featureReduction),s.labelClass=l.featureReduction.labelingInfo[e]):l.labelingInfo=l.labelingInfo,void(p&&(p.labelingInfo=l.labelingInfo))}if(!f(o))if("imagery"!==l.type&&"subtype-group"!==l.type){if(!n)if(p)p.definitionExpression=y;else if(!c||"feature"===l.type&&l.isTable)h.definitionExpression=j(s);else if(r&&(clearTimeout(r),this.layerViewWaitHandler=void 0),d)if(null==y?void 0:y.length)if(this.isAllowedFeatureEffect())if(v(l.featureEffect)){const e="light"===a?100:65;l.featureEffect=new this.FeatureEffect({filter:{where:y},excludedEffect:`grayscale(100%) opacity(30%) brightness(${e}%)`})}else l.featureEffect.filter=l.featureEffect.filter||{},l.featureEffect.filter.where=y;else"filter"in d&&(d.filter={where:y});else this.isAllowedFeatureEffect()?(null===(i=null===(t=l.featureEffect)||void 0===t?void 0:t.filter)||void 0===i?void 0:i.where)&&(l.featureEffect.filter.where=null,v(l.featureEffect)&&(l.featureEffect=null)):"filter"in d&&(d.filter=null);else this.layerViewWaitHandler=setTimeout((()=>{this.applyFilterToLayer()}),500)}else l.definitionExpression=y}isAllowedFeatureEffect(){const{props:e,layerHasFeatureEffect:t,mode:i}=this,{layer:s}=e;return["feature","geojson","ogc-feature","wfs","csv","stream"].indexOf(s.type)>-1&&!s.featureReduction&&"effects"!==i&&(!t||"layer-view"===i)}getLabelClassIndex(){const{props:e}=this,{layer:t,labelClass:i,featureReduction:s}=e;let r=-1;const n="feature"===t.type&&(s?t.featureReduction.labelingInfo:t.labelingInfo);return i&&n.forEach(((e,t)=>{JSON.stringify(e.toJSON())===JSON.stringify(i.toJSON())&&(r=t)})),r}get hostElement(){return(0,s.d)(this)}};ie.style=".sc-arcgis-filter-h{display:flex;flex:1 1 auto;overflow:hidden}.fab-padding.sc-arcgis-filter{padding-bottom:1rem}.hook.sc-arcgis-filter{width:100%;height:1px}.remove-filter.sc-arcgis-filter{margin-bottom:5px;background-color:white;padding-left:15px}.match-expression-dropdown.sc-arcgis-filter{width:100%}.match-expression-msg.sc-arcgis-filter{padding:12px;background-color:white}.match-type.sc-arcgis-filter{display:flex;justify-content:center;margin:6px 0}.arcgis--rtl.sc-arcgis-filter .remove-filter.sc-arcgis-filter{padding-left:0;padding-right:15px}.no-space.sc-arcgis-filter{--calcite-label-margin-bottom:0}";const se="input-plus-unique",re="input",ne="between-values-input",ae="select-values",oe="unique-values-content-list-msg",le="date-picker",ue="histogram-content",ce="histogram-content-slim",de="small-loader",pe=class{constructor(e){(0,s.r)(this,e),this.arcgisFilterConditionChanged=(0,s.c)(this,"arcgisFilterConditionChanged",7),this.disableFilterPanel=(0,s.c)(this,"disableFilterPanel",7),this.arcgisFilterUniqueValuesReturned=(0,s.c)(this,"arcgisFilterUniqueValuesReturned",7),this.histogramSlider=void 0,this.afterCreateSliderDiv=e=>{const{fieldName:t,props:i,histogramSlider:s}=this;e&&setTimeout((()=>{if(!s)return;const r=document.createElement("div");if(e.appendChild(r),s.container){const e=F(t,i);if(!e)return;const{bins:n,average:a,min:o,max:l,values:u,precision:c,rangeType:p}=s,h={container:r,bins:n,average:a,min:o,max:l,values:u,precision:c,rangeType:p};[d.DATE,d.DATE_ONLY].indexOf(e.simpleFieldType)>-1&&(h.hasTimeData=!0,this.addDateFormatFunctions(h)),s.destroy(),this.histogramSlider=new this.HistogramRangeSlider(h),this.createSliderChangeEvents(e)}else s.container=r}),1)},this.onFieldSelect=()=>{this.hasFocus=!0,this.openFieldPickList()},this.onOperatorSelect=e=>{var t,i,s,r;const{props:n,fieldName:a,operator:o,value:l,value2:u}=this,c=e.target.selectedOption.value,d=F(a,n),p=P(n,o),h=P(n,c),g=p||h,m=p&&h,v=V(n,o),y=V(n,c),O=v&&y,I={value:l,value2:u,operator:o};this.value=g&&!m?null:d.statistics&&!f(l)?d.statistics.avg:l,this.value2=y?null!=u?u:D(d)?Math.round(null===(t=d.statistics)||void 0===t?void 0:t.max):null===(i=d.statistics)||void 0===i?void 0:i.max:g||!O?null:u,this.operator=c;const b=this.checkDefaultValues(d),E={value:null!==(s=this.value)&&void 0!==s?s:b.value,value2:null!==(r=this.value2)&&void 0!==r?r:y?b.value2:null,operator:this.operator};this.value=I.value,this.value2=I.value2,this.operator=I.operator,this.emitChangeEvent(E)},this.onValueChangeMaybe=e=>{const{props:t,operator:i,value2:s}=this,r=this.getNewValue(e);f(r)&&V(t,i)&&r>=s||this.onValueChange(e,r)},this.onValueChange=(e,t)=>{const{props:i,fieldName:s,operator:r,value:n,value2:a}=this,{view:o}=i,{timeZone:l}=o,u=F(s,i),c=null==e?void 0:e.target;if(f(t=e?this.getNewValue(e):t)||(t=x(i,u,r).value,c&&(u.simpleFieldType===d.DATE?c.value=O(t,l):c.value=t)),n!==t){if(f(t)&&V(i,r)&&t>=a&&c)if(u.simpleFieldType===d.DATE)t=a-1,c.value=O(t,l);else if(u.simpleFieldType===d.DATE_ONLY){const e=new Date(new Date(a).getTime()-864e5+6e4*(new Date).getTimezoneOffset());t=`${e.getFullYear()}-${e.getMonth()<9?"0":""}${e.getMonth()+1}-${e.getDate()<10?"0":""}${e.getDate()}`,c.value=t}else t=a-1,c.value=t;("CALCITE-INPUT-DATE-PICKER"===(null==c?void 0:c.tagName)||"CALCITE-INPUT"===(null==c?void 0:c.tagName)&&"number"===(null==c?void 0:c.type))&&this.adjustHistogramMinMax(t),this.changeValues(t,a)}},this.onValue2ChangeMaybe=e=>{const{props:t,operator:i,value:s}=this,r=this.getNewValue(e);f(r)&&V(t,i)&&r<=s||this.onValue2Change(e,r)},this.onValue2Change=(e,t)=>{const{value:i,props:s,fieldName:r,operator:n}=this,{view:a}=s,{timeZone:o}=a,l=F(r,s),u=e.target;if(f(t=null!=t?t:this.getNewValue(e))||(t=x(s,l,n).value2,l.simpleFieldType===d.DATE?u.value=O(t,o):u.value=t),t<=i)if(l.simpleFieldType===d.DATE)t=i+1,u.value=O(t,o);else if(l.simpleFieldType===d.DATE_ONLY){const e=new Date(new Date(i).getTime()+864e5+6e4*(new Date).getTimezoneOffset());t=`${e.getFullYear()}-${e.getMonth()<9?"0":""}${e.getMonth()+1}-${e.getDate()<10?"0":""}${e.getDate()}`,u.value=t}else t=i+1,u.value=t;("CALCITE-INPUT-DATE-PICKER"===u.tagName||"CALCITE-INPUT"===u.tagName&&"number"===u.type)&&this.adjustHistogramMinMax(t),this.changeValues(i,t)},this.onUnitSelect=e=>{const t=e.target;this.emitChangeEvent({unit:t.selectedOption.value})},this.onSelectUniqueValue=()=>{this.onSelectUnique(!1)},this.onSelectUniqueValues=()=>{const{props:e,fieldName:t,operator:i}=this,s=E(F(t,e)),r=q(e,i),n=s&&!r;this.onSelectUnique(!n)},this.onDocumentClick=e=>{e.target.closest(`#arcgis-filter-unique-popover_${this.uid}`)||this.removeUniquePopover()},this.onRemoveSelectedValue=e=>{const{values:t,esriLang:i}=this,s=t.indexOf(e);t.splice(s,1),this.emitChangeEvent({values:t.length?i.clone(t):null})},this.afterCreateList=e=>{e&&this.scrollExprIntoView(e)},this.onHistogramBlockToggle=e=>{e.currentTarget.open?this.onHistogramOpen():this.onHistogramClose()},this.fieldPickListChanges=e=>{var t,i;e.stopPropagation();const s=null===(i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields)||void 0===i?void 0:i[0];this.removeFieldsPickList(),s&&this.afterFieldSelect(s)},this.props=void 0,this.uid=void 0,this.fieldName=void 0,this.operator=void 0,this.uniqueValuesSortBy=void 0,this.value=void 0,this.value2=void 0,this.values=void 0,this.unit=void 0,this.histogramOpen=void 0,this.hasFocus=void 0,this.invalidValue=void 0,this.reRender=!1}arcgisFilterUniqueValuesReturnedHandler(e){const t=e.detail;this.fieldName===t&&(this.checkDefaultValues(F(t,this.props)),this.reRender=!this.reRender)}arcgisFilterUniqueListChangedHandler(e){var t;const{detail:i}=e;if(i.uid===this.uid){const e=i.selectedValues;i.multiple?this.emitChangeEvent({values:e,uniqueValuesSortBy:i.sortBy}):(this.uniqueValuesSortBy=i.sortBy,this.onValueChange(null,(null==e?void 0:e.length)?e[0]:void 0),this.removeUniquePopover(),null===(t=this.uniqueActionNode)||void 0===t||t.setFocus())}}arcgisFilterUniqueListSortByChanged(e){const{detail:t}=e;t.uid===this.uid&&(this.uniqueValuesSortBy=t.sortBy)}arcgisFilterUniqueListDoneHandler(e){var t;const{detail:i}=e;i===this.uid&&(this.removeUniquePopover(),null===(t=this.uniqueActionNode)||void 0===t||t.setFocus())}calcitePopoverCloseHandler(){var e;this.uniquePopoverNode&&(this.removeUniquePopover(),null===(e=this.uniqueActionNode)||void 0===e||e.setFocus())}closeFilterPopoversHandler(){this.removeFieldsPickList(),this.removeUniquePopover()}async componentWillLoad(){const e=T({fields:this.props.fields});this.fieldName=this.fieldName||e.layerField.name,this.operator=this.operator||A(this.props,e),this.hasFocus=!!this.hasFocus;const[t,i,s,r,a,o]=await(0,n.l)(["esri/core/lang","esri/intl","esri/smartMapping/statistics/summaryStatistics","esri/smartMapping/statistics/histogram","esri/smartMapping/statistics/uniqueValues","esri/widgets/HistogramRangeSlider"]);this.esriLang=t,this.intl=i,this.summaryStatistics=s,this.histogram=r,this.uniqueValues=a,this.HistogramRangeSlider=o,this.onDocumentClickBind=this.onDocumentClick.bind(this)}componentDidLoad(){this.setFocus()}disconnectedCallback(){this.removeFieldsPickList(),this.removeUniquePopover()}render(){const{fieldName:e,props:t}=this,i=F(e,t);if(!i||!i.simpleFieldType)return(0,s.h)(s.H,null,(0,s.h)("div",null));const r=(0,a.g)(this.hostElement);return(0,s.h)(s.H,{dir:r},(0,s.h)("div",{class:{"filter-condition":!0,[a.C.rtl]:"rtl"===r}},this.renderFieldSelection(),this.renderOperatorSelection(i),this.renderValueInput(i),this.renderHistogram(i)))}renderFieldSelection(){const{hasFocus:e,fieldName:t,props:i}=this,{fields:r}=i,n=F(t,i);return(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",scale:"m",alignment:"icon-end-space-between",disabled:r.length<=1,iconEnd:"chevron-down",class:e?"autofocus":"",onClick:r.length>1?this.onFieldSelect:null,ref:e=>this.fieldNode=e},(null==n?void 0:n.label)||"")}renderOperatorSelection(e){const{props:t}=this,{operators:i,strings:r}=t;let n=e.simpleFieldType;if(!n)return null;n===d.GUID&&(n=d.STRING),n===d.OID&&(n=d.NUMBER),E(e)&&(n=d.DOMAIN);const a=i[n].map((e=>this.renderOperatorOption(e.name)));return(0,s.h)("calcite-select",{width:"full",scale:"m",label:r.accessibility.operator,class:"operator-dropdown",onCalciteSelectChange:this.onOperatorSelect},a)}renderOperatorOption(e){const{operator:t}=this;return(0,s.h)("calcite-option",{value:e,label:e,selected:e===t})}renderValueInput(e){const{props:t,operator:i,invalidValue:r}=this,n=r?"invalid":void 0;let a=null;return B(t,i)||U(t,i)?a=null:q(t,i)?a=this.renderUniqueValues(e):P(t,i)?a=this.renderInTheLast():e.simpleFieldType===d.STRING||e.simpleFieldType===d.GUID||E(e)?a=this.renderValueInputString(e,{status:n}):e.simpleFieldType===d.NUMBER?a=this.renderValueInputNumber(e,{status:n}):[d.DATE,d.DATE_ONLY].indexOf(e.simpleFieldType)>-1?a=this.renderValueInputDate(e):e.simpleFieldType===d.OID&&(a=this.renderValueInputOid(e,{status:n})),r?(0,s.h)("calcite-label",null,a,(0,s.h)("calcite-input-message",{icon:!0,status:n},r)):a}renderUniqueButton(e,t,i){const{props:r}=this,{layer:n,strings:a}=r;return e&&"imagery"!==n.type&&"subtype-group"!==n.type?(0,s.h)("calcite-action",{class:"select-unique-button",disabled:t,loading:!!i,text:a.chooseFromUnique,scale:"s",icon:"chevron-down",onClick:t?null:this.onSelectUniqueValue,ref:e=>{e&&(this.uniqueActionNode=e)}}):null}renderValueInputString(e,t){const{props:i,value:r,operator:n}=this,{strings:a}=i,o=e.uniqueValuesStatus,l=e.uniqueValueInfos,u=[a.operators.stringOperatorIs,a.operators.stringOperatorIsNot].indexOf(n)>-1,c=u&&(o===p.FAILED||o===p.SUCCESS&&!(null==l?void 0:l.length)),d=E(e),h=d?b(r,e):r,g=o===p.MISSING||o===p.IN_PROGRESS;return o===p.MISSING&&this.onDisplayUniqueValues(e.layerField.name),d?f(h)?(0,s.h)("div",{key:"value-input-string"},(0,s.h)("calcite-button",{key:h,appearance:"outline-fill",kind:"neutral",width:"full",scale:"m",alignment:"icon-end-space-between",iconEnd:g?"spinner":c?void 0:"chevron-down",disabled:c,onClick:c?void 0:this.onSelectUniqueValue,ref:e=>{e&&(this.uniqueActionNode=e)}},h?`${h}`:"")):(0,s.h)("div",{key:"value-input-string",class:se},(0,s.h)("div",{key:"value-input-string-button",class:`${re} blank-button ${o===p.SUCCESS?"active":"inactive"}`,tabIndex:-1,onClick:o===p.SUCCESS?this.onSelectUniqueValue:void 0}),this.renderUniqueButton(u,c,g)):(0,s.h)("div",{key:"value-input-string",class:se},(0,s.h)("calcite-input",Object.assign({type:"text",value:h?`${h}`:"",class:re,scale:"m",label:a.accessibility.value,onCalciteInputInput:this.onValueChange},t)),this.renderUniqueButton(u,c,g))}renderValueInputNumber(e,t){var i;const{props:r,value:n,value2:a,operator:o}=this,{strings:l}=r,u=["single","double"].indexOf(e.layerField.type)>-1;if([l.operators.numberOperatorIsBetween,l.operators.numberOperatorIsNotBetween].indexOf(o)>-1)return(0,s.h)("div",null,(0,s.h)("calcite-input",Object.assign({type:"number",value:f(n)?`${n}`:"",scale:"m",step:u?"any":1,label:l.accessibility.fromValue,onCalciteInputInput:e=>this.waitOnUser(e,this.onValueChangeMaybe)},t)),(0,s.h)("div",{class:`${ne} first`}),(0,s.h)("calcite-input",Object.assign({type:"number",value:f(a)?`${a}`:"",scale:"m",step:u?"any":1,class:ne,label:l.accessibility.toValue,onCalciteInputInput:e=>this.waitOnUser(e,this.onValue2ChangeMaybe)},t)));{const r=e.uniqueValuesStatus,a=e.uniqueValueInfos,c=[l.operators.numberOperatorIs,l.operators.numberOperatorIsNot,l.operators.numberOperatorIsAtLeast,l.operators.numberOperatorIsAtMost,l.operators.numberOperatorIsGreaterThan,l.operators.numberOperatorIsLessThan].indexOf(o)>-1,d=(0,s.h)("calcite-input",Object.assign({class:re,type:"number",value:f(n)?`${n}`:"",scale:"m",step:u?"any":1,label:l.accessibility.value,onCalciteInputInput:e=>this.waitOnUser(e,this.onValueChange)},t));return r===p.FAILED||r===p.SUCCESS&&!(null==a?void 0:a.length)||!c?(0,s.h)("div",{key:"value-input-number"},d):r===p.MISSING||r===p.IN_PROGRESS?(r===p.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-number",class:se},d,this.renderUniqueButton(c,!0,!0))):(0,s.h)("div",{key:"value-input-number",class:se},d,this.renderUniqueButton(c,!(null===(i=e.uniqueValueInfos)||void 0===i?void 0:i.length)))}}renderValueInputDate(e){var t;const{props:i,value:r,value2:n,operator:a}=this,{view:o,strings:l}=i,{timeZone:u}=o,c="number"==typeof r?O(r,u):r;if([l.operators.dateOperatorIsBetween,l.operators.dateOperatorIsNotBetween].indexOf(a)>-1){const e="number"==typeof n?O(n,u):n;return(0,s.h)("div",null,(0,s.h)("calcite-input-date-picker",{class:`${le} first`,scale:"m",value:c,overlayPositioning:"fixed",onCalciteInputDatePickerChange:this.onValueChange}),(0,s.h)("calcite-input-date-picker",{class:le,scale:"m",value:e,overlayPositioning:"fixed",onCalciteInputDatePickerChange:this.onValue2Change}))}{const i=e.uniqueValuesStatus,r=e.uniqueValueInfos,n=[l.operators.dateOperatorIsOn,l.operators.dateOperatorIsNotOn,l.operators.dateOperatorIsAfter,l.operators.dateOperatorIsBefore].indexOf(a)>-1,o=(0,s.h)("calcite-input-date-picker",{class:`${le} ${re}`,scale:"m",value:c,overlayPositioning:"fixed",onCalciteInputDatePickerChange:this.onValueChange});return i===p.FAILED||i===p.SUCCESS&&!(null==r?void 0:r.length)||!n?(0,s.h)("div",{key:"value-input-date"},o):i===p.MISSING||i===p.IN_PROGRESS?(i===p.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-date",class:se},o,this.renderUniqueButton(n,!0,!0))):(0,s.h)("div",{key:"value-input-date",class:se},o,this.renderUniqueButton(n,!(null===(t=e.uniqueValueInfos)||void 0===t?void 0:t.length)))}}renderValueInputOid(e,t){var i;const{props:r,value:n,value2:a,operator:o}=this,{strings:l}=r;if(e.simpleFieldType===d.OID)if(f(n)&&f(a)){const e=Math.round(n),t=Math.round(a);e===n&&t===a||this.changeValues(e,t)}else if(f(n)){const e=Math.round(n);e!==n&&this.changeValues(e,a)}else if(f(a)){const e=Math.round(a);e!==a&&this.changeValues(n,e)}if([l.operators.numberOperatorIsBetween,l.operators.numberOperatorIsNotBetween].indexOf(o)>-1)return(0,s.h)("div",null,(0,s.h)("calcite-input",Object.assign({type:"number",value:f(n)?`${n}`:"",scale:"m",min:0,step:1,label:l.accessibility.fromValue,onCalciteInputInput:this.onValueChangeMaybe},t)),(0,s.h)("div",{class:`${ne} first`}),(0,s.h)("calcite-input",Object.assign({type:"number",value:f(a)?`${a}`:"",scale:"m",min:0,step:1,class:ne,label:l.accessibility.toValue,onCalciteInputInput:this.onValue2ChangeMaybe},t)));{const r=e.uniqueValuesStatus,a=e.uniqueValueInfos,u=[l.operators.numberOperatorIs,l.operators.numberOperatorIsNot,l.operators.numberOperatorIsAtLeast,l.operators.numberOperatorIsAtMost,l.operators.numberOperatorIsGreaterThan,l.operators.numberOperatorIsLessThan].indexOf(o)>-1,c=(0,s.h)("calcite-input",Object.assign({class:re,type:"number",value:f(n)?`${n}`:"",scale:"m",min:0,step:1,label:l.accessibility.value,onCalciteInputInput:this.onValueChange},t));return r===p.FAILED||r===p.SUCCESS&&!(null==a?void 0:a.length)||!u?(0,s.h)("div",{key:"value-input-oid"},c):r===p.MISSING||r===p.IN_PROGRESS?(r===p.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",{key:"value-input-oid",class:se},c,this.renderUniqueButton(u,!0,!0))):(0,s.h)("div",{key:"value-input-oid",class:se},c,this.renderUniqueButton(u,!(null===(i=e.uniqueValueInfos)||void 0===i?void 0:i.length)))}}renderUniqueValues(e){const{props:t,values:i,fieldName:r}=this,{strings:n}=t,a=e.uniqueValuesStatus,o=e.uniqueValueInfos;if(a===p.MISSING||a===p.IN_PROGRESS)return a===p.MISSING&&this.onDisplayUniqueValues(e.layerField.name),(0,s.h)("div",null,(0,s.h)("calcite-loader",{class:de,inline:!0,label:""}));if(a===p.FAILED)return(0,s.h)("div",{class:oe},(0,s.h)("calcite-button",{appearance:"transparent",width:"full",scale:"m",alignment:"center",class:ae,disabled:!0,label:n.selectValues},n.selectValues),n.errors.errorUniqueValues);{const t=(0,s.h)("div",{class:oe},!(null==i?void 0:i.length)&&(null==o?void 0:o.length)?n.selectOneValue:"");let a;(null==o?void 0:o.length)||(a=(0,s.h)("div",{class:oe},n.errors.noUniqueValues));const l=null==i?void 0:i.map((t=>this.renderSelectedUniqueValue(t,e)));return(0,s.h)("div",null,t,(0,s.h)("calcite-button",{appearance:"transparent",width:"full",scale:"m",alignment:"center",class:ae,disabled:!(null==o?void 0:o.length),onClick:(null==o?void 0:o.length)>0?this.onSelectUniqueValues:null,ref:e=>this.uniqueSelectNode=e,label:n.selectValues},n.selectValues),a,(null==i?void 0:i.length)?(0,s.h)("calcite-value-list",{key:`unique-values-value-list-${r}`,class:"pick-list",ref:this.afterCreateList},l):null)}}renderSelectedUniqueValue(e,t){const{intl:i,props:r}=this,{view:n,strings:a}=r,{timeZone:o}=n,l=E(t)?b(e,t):R(t)?I(e,o,i):k(t)?i.formatDateOnly(e,i.convertDateFormatToIntlOptions("short-date")):w(t)?i.formatNumber(e):e;return(0,s.h)("calcite-value-list-item",{label:`${l}`,value:`${e}`},(0,s.h)("calcite-action",{slot:"actions-end",text:a.remove,icon:"x",onClick:this.onRemoveSelectedValue.bind(this,e)}))}renderInTheLast(){const{props:e,value:t,unit:i}=this,{strings:r}=e;return(0,s.h)("div",{class:"in-the-last"},(0,s.h)("calcite-input",{type:"number",min:1,step:1,value:f(t)?`${t}`:"",scale:"m",class:"in-the-last-count",label:r.accessibility.value,onCalciteInputInput:this.onValueChange}),(0,s.h)("calcite-select",{width:"full",scale:"m",label:r.accessibility.units,class:"in-the-last-unit",onCalciteSelectChange:this.onUnitSelect},this.renderInTheLastOption(h.MINUTE,i===h.MINUTE),this.renderInTheLastOption(h.HOUR,i===h.HOUR),this.renderInTheLastOption(h.DAY,i===h.DAY),this.renderInTheLastOption(h.WEEK,i===h.WEEK),this.renderInTheLastOption(h.MONTH,i===h.MONTH),this.renderInTheLastOption(h.YEAR,i===h.YEAR)))}renderInTheLastOption(e,t){const{props:i}=this,{strings:r}=i;return(0,s.h)("calcite-option",{value:e,label:r.units[e],selected:t})}renderHistogram(e){const{props:t,histogramOpen:i,operator:r,fieldName:n}=this,{layer:a,strings:o}=t;return"imagery"===a.type||"subtype-group"===a.type?null:e&&e.simpleFieldType?e.statisticsStatus===p.FAILED?null:function(e,t,i){const{strings:s}=i,r=F(e,i);return!!(r&&r.simpleFieldType&&"failed"!==r.statisticsStatus&&[d.NUMBER,d.DATE,d.DATE_ONLY].indexOf(r.simpleFieldType)>-1&&[s.operators.numberOperatorIs,s.operators.dateOperatorIsOn,s.operators.dateOperatorIsNotOn,s.operators.numberOperatorIsNot,s.operators.numberOperatorIsLessThan,s.operators.dateOperatorIsBefore,s.operators.numberOperatorIsGreaterThan,s.operators.dateOperatorIsAfter,s.operators.numberOperatorIsAtMost,s.operators.numberOperatorIsAtLeast,s.operators.numberOperatorIsBetween,s.operators.dateOperatorIsBetween,s.operators.numberOperatorIsNotBetween,s.operators.dateOperatorIsNotBetween].indexOf(t)>-1)}(n,r,t)?((void 0===i||i&&e.histogramStatus===p.MISSING)&&this.onHistogramOpen(),(0,s.h)("calcite-block-section",{open:!1!==i,text:e.histogramStatus===p.FAILED?o.valueRange:o.histogram,onCalciteBlockSectionToggle:this.onHistogramBlockToggle},this.renderHistogramContent(e))):null:null}renderHistogramContent(e){const{histogramOpen:t}=this,i=e.layerField.name;return!1===t?null:e.statistics&&e.histogramStatus!==p.IN_PROGRESS?this.prepareSlider(e)?(0,s.h)("div",{key:`histogram-content-${i}-${e.statistics}`,class:`${e.histogram?ue:ce}`,ref:this.afterCreateSliderDiv}):null:(0,s.h)("div",{key:`histogram-content-${i}-${e.statistics}`,class:e.histogram?ue:ce},(0,s.h)("calcite-loader",{class:de,inline:!0,label:""}))}setFocus(){setTimeout((()=>{const e=this.hostElement.querySelector(".autofocus");e&&e.setFocus()}),500)}onSelectUnique(e){var t;const{props:i,value:r,values:n,fieldName:l,uid:u,uniqueValuesSortBy:c,esriLang:p}=this,{strings:h,localeIntl:g}=i,m=(0,a.g)(this.hostElement);if(this.uniquePopoverNode)return void this.closeFilterPopoversHandler();this.closeFilterPopoversHandler();const f=F(l,i);if(!f)return;const v=null===(t=this.fieldNode)||void 0===t?void 0:t.getBoundingClientRect().width,y=v?v+2:204,O=(0,o.q)(this.hostElement,"calcite-panel"),I=null==O?void 0:O.clientHeight,b=I?Math.max(Math.min(I/3,400),240):400,E=document.createElement("calcite-popover");E.id=`arcgis-filter-unique-popover_${u}`,E.placement="rtl"===m?"bottom-start":"bottom-end",E.offsetDistance=0,E.offsetSkidding=0,E.pointerDisabled=!0,E.style=`width: ${y}px;`,E.referenceElement=e?this.uniqueSelectNode:this.uniqueActionNode;const N=document.createElement("arcgis-filter-unique-list");N.uid=u,N.props=i,N.uniqueValues=p.clone(f.uniqueValueInfos),N.selectedValues=e?n:r?[r]:[],N.fieldDomains=f.fieldDomains,N.layerFieldType=f.layerField.type,N.isDate=[d.DATE,d.DATE_ONLY].indexOf(f.simpleFieldType)>-1,N.multiple=e,N.sortBy=c,N.partialUniqueValues=f.partialUniqueValues,N.maxHeight=b,N.strings=h,N.locale=g,N.style=`min-width: ${y}px`,E.appendChild(N),document.body.appendChild(E),E.open=!0,(0,s.f)(N),N.setFocus(),E.reposition(),this.uniquePopoverNode=E,setTimeout((()=>{document.addEventListener("click",this.onDocumentClickBind)}),50)}scrollExprIntoView(e){setTimeout((()=>{e&&(null==(e=(0,o.q)(e,".filter-expression"))||e.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}))}),100)}removeUniquePopover(){var e;document.removeEventListener("click",this.onDocumentClickBind),this.uniquePopoverNode&&(this.uniquePopoverNode.open=!1,null===(e=this.uniquePopoverNode)||void 0===e||e.parentElement.removeChild(this.uniquePopoverNode),this.uniquePopoverNode=void 0)}async onDisplayUniqueValues(e){var t;const{props:i,uniqueValues:s}=this,{layer:r,view:n,featureReduction:a}=i,o=F(e,i);if(o&&"imagery"!==r.type&&"subtype-group"!==r.type&&o.uniqueValuesStatus===p.MISSING&&r){o.uniqueValuesStatus=p.IN_PROGRESS;try{const l=await s({layer:r,view:n,field:e,forBinning:a&&["binning","cluster"].indexOf(null===(t=r.featureReduction)||void 0===t?void 0:t.type)>-1}),u=w(o),c=l.uniqueValueInfos.filter((e=>!!f(e.value)&&("string"===o.simpleFieldType&&!u||"guid"===o.simpleFieldType?"<Null>"!==e.value&&""!==`${e.value}`.trim():("number"===o.simpleFieldType||o.simpleFieldType,"<Null>"!==e.value&&""!==e.value))));c.sort(((e,t)=>e.count>t.count?-1:e.count<t.count?1:0)),E(o)&&o.fieldDomains.forEach((e=>{c.find((t=>t.value===e.code))||c.push({value:e.code,count:0})}));const d=2e3===l.uniqueValueInfos.length;i.fields=i.fields.map((t=>t.layerField.name===e?Object.assign(Object.assign({},t),{uniqueValueInfos:c,uniqueValuesStatus:p.SUCCESS,partialUniqueValues:d}):t)),this.arcgisFilterUniqueValuesReturned.emit(o.layerField.name)}catch(t){if(console.error("error-uniqueValues",t),E(o)){const t=[];o.fieldDomains.forEach((e=>{t.find((t=>t.value===e.code))||t.push({value:e.code,count:void 0})})),i.fields=i.fields.map((i=>i.layerField.name===e?Object.assign(Object.assign({},i),{uniqueValueInfos:t,uniqueValuesStatus:p.SUCCESS,partialUniqueValues:!1}):i))}else i.fields=i.fields.map((t=>t.layerField.name===e?Object.assign(Object.assign({},t),{uniqueValuesStatus:p.FAILED}):t));this.reRender=!this.reRender}}}async onHistogramOpen(){var e,t;const{props:i,fieldName:s,summaryStatistics:r,histogram:n}=this,{layer:a,view:o,featureReduction:l}=i,u=F(s,i);if(a&&"imagery"!==a.type&&"subtype-group"!==a.type&&u)if(u.statistics)this.checkDefaultValues(u),this.histogramOpen=!0;else if(!u.statistics){i.fields=i.fields.map((e=>e.layerField.name===s?Object.assign(Object.assign({},e),{statisticsStatus:p.IN_PROGRESS}):e));try{const c=await r({layer:a,view:o,field:s,forBinning:l&&["binning","cluster"].indexOf(null===(e=a.featureReduction)||void 0===e?void 0:e.type)>-1});if(!f(c.avg)||!f(c.min)||!f(c.max))return i.fields=i.fields.map((e=>e.layerField.name===s?Object.assign(Object.assign({},e),{statisticsStatus:p.FAILED}):e)),void(this.histogramOpen=!1);c.min===c.max&&(c.min>0?(c.min=c.min-.1*c.min,c.max=c.max+.1*c.max):c.min<0?(c.min=c.min+.1*c.min,c.max=c.max-.1*c.max):(c.min=-1,c.max=1)),i.fields=i.fields.map((e=>e.layerField.name===s?Object.assign(Object.assign({},e),{statistics:c,statisticsStatus:p.SUCCESS}):e)),this.checkDefaultValues(u);try{const e=await n({layer:a,view:o,field:s,numBins:30,minValue:c.min,maxValue:c.max,forBinning:l&&["binning","cluster"].indexOf(null===(t=a.featureReduction)||void 0===t?void 0:t.type)>-1});i.fields=i.fields.map((t=>t.layerField.name===s?Object.assign(Object.assign({},t),{histogram:e,histogramStatus:p.SUCCESS}):t)),this.reRender=!this.reRender}catch(e){console.error("error-histogram",e),i.fields=i.fields.map((e=>e.layerField.name===s?Object.assign(Object.assign({},e),{histogramStatus:p.FAILED}):e)),this.reRender=!this.reRender}}catch(e){console.error("error-summaryStatistics",e),i.fields=i.fields.map((e=>e.layerField.name===s?Object.assign(Object.assign({},e),{statisticsStatus:p.FAILED,histogramStatus:p.FAILED}):e)),this.histogramOpen=!1,this.reRender=!this.reRender}}}onHistogramClose(){this.histogramOpen=!1}async onMinMaxChange(e,t,i){var s;const{props:r,value:n,value2:a,histogram:o}=this,{layer:l,view:u,featureReduction:c}=r,d=F(i,r);if(d&&"imagery"!==l.type&&"subtype-group"!==l.type){this.value=Math.min(Math.max(n,e),t),f(a)&&(this.value2=Math.min(Math.max(a,e),t)),this.histogramOpen=!0,r.fields=r.fields.map((e=>e.layerField.name===i?Object.assign(Object.assign({},e),{histogramStatus:p.IN_PROGRESS}):e));try{const n=await o({layer:l,view:u,field:d.layerField.name,numBins:30,minValue:e,maxValue:t,forBinning:c&&["binning","cluster"].indexOf(null===(s=l.featureReduction)||void 0===s?void 0:s.type)>-1});r.fields=r.fields.map((e=>e.layerField.name===i?Object.assign(Object.assign({},e),{histogram:n,histogramStatus:p.SUCCESS}):e)),this.reRender=!this.reRender}catch(e){console.error("error-histogram",e),r.fields=r.fields.map((e=>e.layerField.name===i?Object.assign(Object.assign({},e),{histogramStatus:p.FAILED}):e))}}}adjustHistogramMinMax(e){const{histogramSlider:t}=this;t&&(t.min>e&&t.set({min:e}),t.max<e&&t.set({max:e}))}prepareSlider(e){var t,i;const{histogramSliderFieldName:s}=this;let{value:r,value2:n,histogramSlider:a}=this;const o=e.statistics;if(e.histogramStatus===p.IN_PROGRESS)return!1;f(r)&&"number"!=typeof r&&(r=void 0),f(n)&&"number"!=typeof n&&(n=void 0),this.checkDefaultValues(e),r=this.value,n=this.value2;const l=[];if(l.push(r),f(n)&&l.push(n),D(e)){if(f(l[0])){const e=Math.round(l[0]);e!==l[0]&&this.changeValues(e,n),l[0]=e}if(f(l[1])){const e=Math.round(l[1]);e!==l[1]&&this.changeValues(r,e),l[1]=e}}let u=e.histogram?e.histogram.minValue:o.min,c=e.histogram?e.histogram.maxValue:o.max;if(f(l[0])&&f(l[1])?(u=Math.min(u,l[0]),c=Math.max(c,l[1])):f(l[0])&&(u=Math.min(u,l[0]),c=Math.max(c,l[0])),a&&s!==e.layerField.name&&(a.destroy(),a=void 0),a){const t={bins:null===(i=e.histogram)||void 0===i?void 0:i.bins,average:Math.round(10*o.avg)/10,min:u,max:c,values:void 0===(null==l?void 0:l[0])?void 0:l,rangeType:this.getSliderRangeType()};a.set(t)}else{const i={bins:null===(t=e.histogram)||void 0===t?void 0:t.bins,average:Math.round(10*o.avg)/10,min:u,max:c,values:void 0===(null==l?void 0:l[0])?void 0:l,rangeType:this.getSliderRangeType(),precision:D(e)?0:4};[d.DATE,d.DATE_ONLY].indexOf(e.simpleFieldType)>-1&&(i.hasTimeData=!0,this.addDateFormatFunctions(i)),this.histogramSliderFieldName=e.layerField.name,this.histogramSlider=new this.HistogramRangeSlider(i),this.createSliderChangeEvents(e)}return!0}createSliderChangeEvents(e){const{histogramSlider:t}=this;t&&(t.on("min-change",(i=>{const s=t;this.onMinMaxChange(i.value,s.max,e.layerField.name)})),t.on("max-change",(i=>{const s=t;this.onMinMaxChange(s.min,i.value,e.layerField.name)})),t.watch("values",(()=>{var i,s;const r=t;let n=null===(i=r.values)||void 0===i?void 0:i[0],a=null===(s=r.values)||void 0===s?void 0:s[1];[d.DATE,d.DATE_ONLY].indexOf(e.simpleFieldType)>-1&&(n=Math.round(n)),D(e)&&(a||0===n?(n=Math.floor(n),a=Math.ceil(a)):n=Math.round(n)),this.changeValues(n,a)})),t.on("segment-drag",(()=>{const i=t;let s=i.values[0],r=i.values[1];D(e)&&(r||0===s?(s=Math.floor(s),r=Math.ceil(r)):s=Math.round(s)),this.changeValues(s,r)})))}getSliderRangeType(){const{props:e,operator:t}=this,{strings:i}=e;switch(t){case i.operators.numberOperatorIs:case i.operators.dateOperatorIsOn:return"equal";case i.operators.numberOperatorIsNot:case i.operators.dateOperatorIsNotOn:return"not-equal";case i.operators.numberOperatorIsLessThan:case i.operators.dateOperatorIsBefore:return"less-than";case i.operators.numberOperatorIsGreaterThan:case i.operators.dateOperatorIsAfter:return"greater-than";case i.operators.numberOperatorIsAtMost:return"at-most";case i.operators.numberOperatorIsAtLeast:return"at-least";case i.operators.numberOperatorIsBetween:case i.operators.dateOperatorIsBetween:return"between";case i.operators.numberOperatorIsNotBetween:case i.operators.dateOperatorIsNotBetween:return"not-between";default:return""}}getNewValue(e){const{view:t}=this.props,{timeZone:i}=t,s=null==e?void 0:e.target;let r;if("CALCITE-INPUT-DATE-PICKER"===(null==s?void 0:s.tagName)){if(r=s.value,!r)return;r=function(e,t){let i;if(t&&"system"!==t)if("unknown"===t)i=e.getTime();else{const s=new Date(e.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(e.toLocaleString("en-US",{timeZone:t})).getTime();i=e.getTime()+s}else i=e.getTime()+6e4*e.getTimezoneOffset();return i}(new Date(r),i)}else if("CALCITE-INPUT"===(null==s?void 0:s.tagName)&&"number"===s.type){if(r=s.value,!r)return;r=parseFloat(r)}else"CALCITE-INPUT"===(null==s?void 0:s.tagName)&&(r=s.value,(null==r?void 0:r.length)||(r=void 0));return r}addDateFormatFunctions(e){const{intl:t,props:i}=this,{view:s}=i,{timeZone:r}=s;e.labelFormatFunction=e=>I(e,r,t,"short-date"),e.inputFormatFunction=e=>I(e,r,t,"short-date"),e.inputParseFunction=e=>function(e,t){if(!e)return e;let i;if(t&&"system"!==t)if("unknown"===t)i=e;else{const s=new Date;i=e+(new Date(s.toLocaleString("en-US",{timeZone:"utc"})).getTime()-new Date(s.toLocaleString("en-US",{timeZone:t})).getTime())}else i=e+6e4*(new Date).getTimezoneOffset();return i}(Date.parse(e),r)}changeValues(e,t){const{props:i,fieldName:s}=this,r=F(s,i),n=r.simpleFieldType&&[d.NUMBER,d.DATE,d.OID].indexOf(r.simpleFieldType)>-1&&isNaN(e)?null:e,a=r.simpleFieldType&&[d.NUMBER,d.DATE,d.OID].indexOf(r.simpleFieldType)>-1&&isNaN(t)?null:t;this.value===n&&this.value2===a||this.emitChangeEvent({value:null!=n?n:null,value2:null!=a?a:null})}checkDefaultValues(e){const{props:t,operator:i,value:s,value2:r,histogramSlider:n}=this,a=e.statistics,o=x(t,e,i);if(P(t,i)){if(!f(s)){const e=(new Date).getTime(),t=Math.abs(e-a.avg);let i,s;t>2*g.YEAR?(i=Math.round(t/g.YEAR),s=h.YEAR):t>2*g.MONTH?(i=Math.round(t/g.MONTH),s=h.MONTH):t>2*g.WEEK?(i=Math.round(t/g.WEEK),s=h.WEEK):t>2*g.DAY?(i=Math.round(t/g.DAY),s=h.DAY):t>2*g.HOUR?(i=Math.round(t/g.HOUR),s=h.HOUR):(i=Math.round(t/g.MINUTE),s=h.MINUTE),this.emitChangeEvent({value:i,unit:s})}}else if(V(t,i))if(f(s))if(f(r))r<s&&(n&&n.values[0]===s?this.changeValues(s,s):this.changeValues(r,r));else{const t=D(e)?Math.round(a.max):a.max;this.changeValues(s,t)}else if(f(r)){const i=S(null==a?void 0:a.avg,t,e);this.changeValues(i,r)}else this.changeValues(o.value,o.value2);else f(s)||this.changeValues(o.value,o.value2);return o}openFieldPickList(){const{props:e,fieldName:t,fieldPickListSortBy:i}=this,{layer:s,view:r,featureReduction:n}=e,l=(0,a.g)(this.hostElement);this.closeFilterPopoversHandler();const u=(0,o.q)(this.hostElement,"#filter-panel"),c=u.querySelector("#arcgis-filter-close"),d=null==u?void 0:u.getBoundingClientRect().width;this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps=c?{placement:"rtl"===l?"bottom-start":"bottom-end",offsetDistance:20,offsetSkidding:15,pointerDisabled:!0,popoverWidth:d?d+30:280,refElement:c}:{placement:"auto",offsetDistance:-1*(d?d-5:215),offsetSkidding:0,pointerDisabled:!0,popoverWidth:d?d+30:280,refElement:u},this.arcgisFieldPickList.fields=this.createPickListFields(),this.arcgisFieldPickList.layer=s,this.arcgisFieldPickList.mapView=r,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!1,this.arcgisFieldPickList.selectedFields=[t],this.arcgisFieldPickList.sortBy=i,this.arcgisFieldPickList.showFieldInfo=!n,this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed",this.fieldPickListChanges),this.arcgisFieldPickList.addEventListener("arcgisFieldPickListSortByChange",(e=>this.fieldPickListSortBy=e.detail)),document.body.appendChild(this.arcgisFieldPickList),this.disableFilterPanel.emit(!0)}createPickListFields(){const{props:e}=this,{fields:t}=e;return t.map((e=>({name:e.layerField.name,alias:e.label,type:e.simpleFieldType})))}removeFieldsPickList(){this.disableFilterPanel.emit(!1),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null,setTimeout((()=>{this.fieldNode.setFocus()}),1))}afterFieldSelect(e){var t;const{props:i,fieldName:s,operator:r,histogramOpen:n}=this,{strings:a}=i,o=F(s,i),l=F(e,i);let u=null;const c=function(e,t,i,s){return t.simpleFieldType!==i.simpleFieldType?function(e,t){const{strings:i}=e;return!!(t&&[i.operators.stringOperatorIncludes,i.operators.numberOperatorIncludes].indexOf(t)>-1)}(e,s)&&i.simpleFieldType!==d.DATE?function(e,t){const{strings:i}=e;switch(t.simpleFieldType){case"string":case"domain":default:return i.operators.stringOperatorIncludes;case"number":case"oid":case"guid":return i.operators.numberOperatorIncludes}}(e,i):function(e,t){const{strings:i}=e;return!!(t&&[i.operators.stringOperatorExcludes,i.operators.numberOperatorExcludes].indexOf(t)>-1)}(e,s)?function(e,t){const{strings:i}=e;switch(t.simpleFieldType){case"string":default:return i.operators.stringOperatorExcludes;case"number":case"oid":case"guid":return i.operators.numberOperatorExcludes}}(e,i):A(e,i):s}(i,o,l,r),h=F(e,i);h.simpleFieldType===d.STRING&&h.uniqueValuesStatus===p.SUCCESS&&(null===(t=h.uniqueValueInfos)||void 0===t?void 0:t.length)&&[a.operators.stringOperatorIs,a.operators.stringOperatorIsNot].indexOf(c)>-1&&(u=h.uniqueValueInfos[0].value),this.emitChangeEvent({hasFocus:!0,fieldName:e,operator:c,value:u,value2:null,values:null,uniqueValuesSortBy:null,histogramOpen:(l.simpleFieldType&&-1===[d.NUMBER,d.DATE,d.DATE_ONLY].indexOf(l.simpleFieldType)||l.statisticsStatus===p.FAILED||!1!==n||o.statisticsStatus===p.FAILED)&&null})}emitChangeEvent(e){var t,i;const{uid:s,fieldName:r,operator:n,uniqueValuesSortBy:a,value:o,value2:l,values:u,unit:c,histogramOpen:d,hasFocus:p}=this,h={uid:s,fieldName:e.fieldName||r,operator:e.operator||n,uniqueValuesSortBy:null===e.uniqueValuesSortBy?void 0:e.uniqueValuesSortBy||a,value:null===e.value?void 0:null!==(t=e.value)&&void 0!==t?t:o,value2:null===e.value2?void 0:null!==(i=e.value2)&&void 0!==i?i:l,values:null===e.values?void 0:e.values||u,unit:e.unit||c,histogramOpen:null===e.histogramOpen?void 0:e.histogramOpen||d,hasFocus:e.hasFocus||p};this.arcgisFilterConditionChanged.emit(h)}waitOnUser(e,t){this.typingHndl&&(clearTimeout(this.typingHndl),this.typingHndl=void 0);const i=e.target.value,s=parseFloat(i);i?("-"!==i[0]||0!==s&&!isNaN(s))&&t(e):this.typingHndl=setTimeout((()=>{this.typingHndl=void 0,t(e)}),2e3)}get hostElement(){return(0,s.d)(this)}};pe.style=".filter-condition.sc-arcgis-filter-condition{padding:0 6px}.operator-dropdown.sc-arcgis-filter-condition{width:100%;margin:5px 0}.input-plus-unique.sc-arcgis-filter-condition{display:flex;flex-direction:row;width:100%}.input.sc-arcgis-filter-condition{width:100%}.blank-button.sc-arcgis-filter-condition{height:22px;border:var(--calcite-ui-border-input) 1px solid}.blank-button.active.sc-arcgis-filter-condition{cursor:pointer}.blank-button.inactive.sc-arcgis-filter-condition:focus{outline:none}.select-unique-button.sc-arcgis-filter-condition{height:32px;border-top:var(--calcite-ui-border-input) 1px solid;border-bottom:var(--calcite-ui-border-input) 1px solid;border-right:var(--calcite-ui-border-input) 1px solid}.arcgis--rtl.sc-arcgis-filter-condition .select-unique-button.sc-arcgis-filter-condition{border-right:none;border-left:var(--calcite-ui-border-input) 1px solid}.between-values-input.first.sc-arcgis-filter-condition{margin-bottom:5px}.select-values.sc-arcgis-filter-condition{margin-bottom:4px}.pick-list.sc-arcgis-filter-condition{max-height:200px;overflow-y:auto}.unique-values-content-list-msg.sc-arcgis-filter-condition{font-size:90%;margin-top:5px;margin-bottom:5px}.in-the-last.sc-arcgis-filter-condition{display:flex}.in-the-last-count.sc-arcgis-filter-condition{width:50%}.in-the-last-unit.sc-arcgis-filter-condition{width:50%}.date-picker.sc-arcgis-filter-condition{width:100%}.date-picker.first.sc-arcgis-filter-condition{margin-bottom:5px}.histogram-content.sc-arcgis-filter-condition{height:120px;margin-top:5px}.histogram-content-slim.sc-arcgis-filter-condition{height:40px;margin-top:5px}.small-loader.sc-arcgis-filter-condition{margin-left:calc((100% - 16px) / 2);margin-top:10px}html[dir=rtl].sc-arcgis-filter-condition .small-loader.sc-arcgis-filter-condition{margin-left:auto;margin-right:8px}";const he=class{constructor(e){(0,s.r)(this,e),this.arcgisFilterExpressionChanged=(0,s.c)(this,"arcgisFilterExpressionChanged",7),this.onAddCondition=()=>{const{props:e,conditions:t}=this,i=T(e),s=x(e,i,A(e,i)),r=Object.assign(Object.assign({fieldName:i.layerField.name,operator:A(e,i)},s),{hasFocus:!0});t.forEach((e=>e.hasFocus=!1)),this.conditions=[...t,r],e.expressions=e.expressions.map((e=>e.uid===this.uid?Object.assign(Object.assign({},e),{conditions:this.conditions}):Object.assign({},e))),this.fixUIDsForExpression(),this.menuNode.open=!1,this.emitChangeEvent()},this.onRemoveCondition=e=>{const{props:t,conditions:i}=this,s=e.target,r=parseInt(s.getAttribute("data-value"));i.forEach((e=>e.hasFocus=!1));let n=0;this.conditions=i.filter(((e,t)=>!e||t!==r||(n=t,!1))),this.conditions[Math.max(0,n-1)].hasFocus=!0,t.expressions=t.expressions.map((e=>e.uid===this.uid?Object.assign(Object.assign({},e),{conditions:this.conditions}):Object.assign({},e))),this.fixUIDsForExpression(),this.emitChangeEvent()},this.onMatchSelect=e=>{const t=e.target.selectedOption.value;this.logicalOperatorForConditions=t,this.emitChangeEvent()},this.onCopyExpression=()=>{const{uid:e,conditions:t,logicalOperatorForConditions:i}=this,s={uid:e,conditions:t,logicalOperatorForConditions:i};this.menuNode.open=!1,this.arcgisFilterExpressionChanged.emit({type:"copy",uid:this.uid,expression:s})},this.onRemoveExpression=()=>{this.arcgisFilterExpressionChanged.emit({type:"delete",uid:this.uid})},this.props=void 0,this.uid=void 0,this.conditions=void 0,this.logicalOperatorForConditions=void 0,this.canRemove=!0,this.canDuplicate=!0,this.showAddConditionButton=!1}arcgisFilterConditionChangeHandler(e){const{conditions:t}=this,{detail:i}=e;this.conditions=t.map((e=>e.uid===i.uid?i:e)),this.emitChangeEvent()}async componentWillLoad(){this.conditions=this.conditions||[];const[e]=await(0,n.l)(["esri/core/lang"]);this.esriLang=e}render(){const{props:e,conditions:t}=this,{strings:i}=e,r=(0,a.g)(this.hostElement);return(0,s.h)(s.H,{class:{[a.C.rtl]:"rtl"===r},dir:r},(0,s.h)("calcite-block",{heading:1===t.length?i.expression:i.expressionSet,open:!0},this.renderMenu(),this.renderMatchCondition(),this.renderConditions(),this.renderAddConditionButton()))}renderMenu(){const{props:e,canDuplicate:t,canRemove:i,conditions:r}=this,{strings:n}=e;return(0,s.h)("calcite-action-menu",{slot:"control",placement:"bottom-end",overlayPositioning:"fixed",label:n.accessibility.moreOptions,ref:e=>this.menuNode=e},i&&(0,s.h)("calcite-action",{text:1===r.length?n.deleteExpression:n.deleteSet,textEnabled:!0,"data-value":"remove",onClick:this.onRemoveExpression}),t&&(0,s.h)("calcite-action",{text:n.duplicate,textEnabled:!0,"data-value":"copy",onClick:this.onCopyExpression}),(0,s.h)("calcite-action",{text:n.addCondition,textEnabled:!0,"data-value":"add",onClick:this.onAddCondition}))}renderMatchCondition(){const{conditions:e,logicalOperatorForConditions:t,props:i}=this,{strings:r}=i;if(!e||!e.length||1===e.length)return null;const n=t!==c.OR;return(0,s.h)("div",{class:"match-condition"},(0,s.h)("calcite-select",{width:"full",scale:"m",label:r.accessibility.matchConditions,class:"match-condition-dropdown",onCalciteSelectChange:this.onMatchSelect},(0,s.h)("calcite-option",{value:c.AND,label:r.matchAllConditions,selected:n}),(0,s.h)("calcite-option",{value:c.OR,label:r.matchAtLeastOneCondition,selected:!n})))}renderConditions(){const{conditions:e}=this;return(0,s.h)("div",{class:"content"},e.map(((e,t)=>this.renderCondition(e,t))))}renderCondition(e,t){const{props:i}=this;return(0,s.h)("div",null,this.renderConditionHeader(t),(0,s.h)("arcgis-filter-condition",Object.assign({props:i},e)))}renderAddConditionButton(){return this.showAddConditionButton&&(0,s.h)("calcite-button",{alignment:"center",appearance:"transparent",class:"add-condition-button","icon-start":"plus",scale:"s",onClick:this.onAddCondition},this.props.strings.addCondition)}renderConditionHeader(e){const{props:t,logicalOperatorForConditions:i,conditions:r}=this,{strings:n}=t;if(r.length<2)return null;const a=i!==c.OR;return(0,s.h)("div",{class:"condition-header"},e>0?(0,s.h)("span",{class:"match-type-text"},a?n.and:n.or):null,(0,s.h)("calcite-action",{label:n.remove,text:"",icon:"x",compact:!0,"data-value":`${e}`,onClick:this.onRemoveCondition}))}fixUIDsForExpression(){const{props:e}=this;e.expressions=y(e.expressions),this.conditions=e.expressions.filter((e=>e.uid===this.uid))[0].conditions}emitChangeEvent(){const{uid:e,conditions:t,logicalOperatorForConditions:i}=this,s={uid:e,conditions:t,logicalOperatorForConditions:i};this.arcgisFilterExpressionChanged.emit({type:"replace",expression:s})}get hostElement(){return(0,s.d)(this)}};he.style=".content.sc-arcgis-filter-expression{padding-bottom:6px}.condition-header.sc-arcgis-filter-expression{display:flex;justify-content:flex-end;align-items:center;margin:0 6px}.match-type-text.sc-arcgis-filter-expression{margin:0 auto}.match-condition.sc-arcgis-filter-expression{margin:0 6px}.match-condition-dropdown.sc-arcgis-filter-expression{width:100%}.add-condition-button.sc-arcgis-filter-expression{display:flex}";const ge=class{constructor(e){(0,s.r)(this,e),this.arcgisFilterUniqueListDone=(0,s.c)(this,"arcgisFilterUniqueListDone",7),this.arcgisFilterUniqueListChanged=(0,s.c)(this,"arcgisFilterUniqueListChanged",7),this.arcgisFilterUniqueListSortByChanged=(0,s.c)(this,"arcgisFilterUniqueListSortByChanged",7),this.onSortMenuSelect=e=>{var t;const i=null===(t=e.currentTarget.selectedItems)||void 0===t?void 0:t[0].getAttribute("data-value");this.sortBy=i,this.arcgisFilterUniqueListSortByChanged.emit({uid:this.uid,sortBy:i})},this.done=()=>{this.arcgisFilterUniqueListDone.emit(this.uid)},this.uid=void 0,this.props=void 0,this.uniqueValues=void 0,this.selectedValues=void 0,this.fieldDomains=void 0,this.layerFieldType=void 0,this.isDate=void 0,this.sortBy=void 0,this.multiple=void 0,this.partialUniqueValues=void 0,this.maxHeight=void 0,this.strings=void 0,this.locale=void 0}async setFocus(){var e;null===(e=this.pickListNode)||void 0===e||e.setFocus()}async componentWillLoad(){const[e]=await(0,n.l)(["esri/intl"]);this.intl=e,this.intl.setLocale(this.locale)}componentDidLoad(){}disconnectedCallback(){}render(){const{uid:e,uniqueValues:t,selectedValues:i,layerFieldType:r,fieldDomains:n,sortBy:a,multiple:o,partialUniqueValues:l,maxHeight:u,strings:c}=this;(e=>{const t=null==n?void 0:n.length;e.sort(((e,i)=>{const s=t?this.getDecodedValue(e.value):e.value,r=t?this.getDecodedValue(i.value):i.value;return"_"===`${s}`.charAt(0)?1:"_"===`${r}`.charAt(0)?-1:`${s}`.localeCompare(`${r}`)}))})(t),a&&"count"!==a?"selected"===a&&((e,t)=>{e.sort(((e,i)=>{var s,r;const n=null!==(s=null==t?void 0:t.indexOf(e.value))&&void 0!==s?s:-1,a=null!==(r=null==t?void 0:t.indexOf(i.value))&&void 0!==r?r:-1;return n===a||n>-1&&a>-1?0:n>a?-1:1}))})(t,i):(e=>{e.sort(((e,t)=>e.count<=t.count?1:-1))})(t);const d=t.map((e=>this.renderUniqueValue(e)));let p;return l&&(p=(0,s.h)("div",{class:"unique-values-content-list-msg"},c.errors.tooManyUniqueValues)),(0,s.h)(s.H,null,(0,s.h)("div",{class:"container"},(0,s.h)("calcite-pick-list",{class:"popover-unique-pick-list",filterEnabled:t.length>10,multiple:o,"filter-placeholder":c.searchValues,onCalciteListChange:async t=>{const i=t.target;let s=[...(await i.getSelectedItems()).keys()];"date-only"===r?s=null==s?void 0:s.map((e=>{const t=new Date(e),i=6e4*t.getTimezoneOffset();return t.getTime()+i})):["date","oid","guid","small-integer","big-integer","integer","long"].indexOf(r)>-1?s=null==s?void 0:s.map((e=>parseInt(e))):["single","double"].indexOf(r)>-1&&(s=null==s?void 0:s.map((e=>parseFloat(e)))),this.selectedValues=s,this.arcgisFilterUniqueListChanged.emit({uid:e,multiple:o,selectedValues:s,sortBy:a})},ref:e=>{this.pickListNode=e,u&&e.setAttribute("style",`max-height: ${u||400}px`)}},t.length>10?this.renderSort():null,d),p,this.renderDone()))}renderSort(){const{sortBy:e,strings:t}=this;return(0,s.h)("calcite-dropdown",{slot:"menu-actions",placement:"bottom-end",overlayPositioning:"fixed",width:"s",onCalciteDropdownSelect:this.onSortMenuSelect},(0,s.h)("calcite-action",{slot:"trigger",label:t.sortValues,text:""},(0,s.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,s.h)("calcite-dropdown-group",null,(0,s.h)("calcite-dropdown-item",{selected:"count"===e||!f(e),"data-value":"count"},t.sortByCount),(0,s.h)("calcite-dropdown-item",{selected:"name"===e,"data-value":"name"},t.sortAlphabetical),(0,s.h)("calcite-dropdown-item",{selected:"selected"===e,"data-value":"selected"},t.sortSelected)))}renderUniqueValue(e){const{selectedValues:t,fieldDomains:i,layerFieldType:r,isDate:n,intl:a,props:o}=this,{view:l}=o,{timeZone:u}=l,c=(null==i?void 0:i.length)?this.getDecodedValue(e.value):n?"date-only"===r?this.getDateOnlyString(e.value):I(e.value,u,a):"number"==typeof e.value?a.formatNumber(e.value):e.value,d=!!t&&t.indexOf(e.value)>-1;return(0,s.h)("calcite-pick-list-item",{key:`pick-list-item_${e.value}`,label:`${c}`,value:`${e.value}`,selected:d},f(e.count)?(0,s.h)("div",{class:"count",slot:"actions-end"},`${e.count}`):null)}renderDone(){const{multiple:e,strings:t}=this;return e?(0,s.h)("div",{class:"unique-values-done"},(0,s.h)("calcite-button",{appearance:"outline-fill",width:"full",onClick:this.done,label:t.done},t.done)):null}getDecodedValue(e){const{fieldDomains:t}=this,i=t;if(i){let t="";for(let s=0;s<i.length;s++){const r=i[s];r.code==e&&(t+=(t.length?" | ":"")+r.name)}return t}return e}getDateOnlyString(e){const{intl:t}=this;return e?t.formatDateOnly(e):""}get hostElement(){return(0,s.d)(this)}};ge.style=".sc-arcgis-filter-unique-list-h{width:100%}.container.sc-arcgis-filter-unique-list{min-height:30px}.popover-unique-pick-list.sc-arcgis-filter-unique-list{width:100%;overflow-y:auto}.unique-values-content-list-msg.sc-arcgis-filter-unique-list{font-size:75%;margin:5px}.count.sc-arcgis-filter-unique-list{padding:12px 6px}.unique-values-done.sc-arcgis-filter-unique-list{padding:0.5rem}"},26426:(e,t,i)=>{i.d(t,{a:()=>u,b:()=>p,c:()=>r,d:()=>s,e:()=>n,f:()=>c,g:()=>h,i:()=>a,m:()=>o,t:()=>l,u:()=>d});const s=(e,t)=>{let i,s="idle";const r=(...r)=>new Promise((n=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),n(e(...r))):n(null);break;case"invoked":clearTimeout(i),s="idle",n(e(...r));break;case"cancelled":clearTimeout(i),s="idle",n(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout((()=>(s="idle",n(e(...r)))),t)}}));return r.flush=function(...e){return s="flushed",r(...e)},r.invoke=function(...e){return s="invoked",r(...e)},r.cancel=function(...e){return s="cancelled",r(...e)},r.getStatus=function(){return s},r},r=(e,t)=>{let i;return(...s)=>new Promise((r=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,r(e(...s))}),t))}))};function n(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function a(e){return null!=e}async function o(e,t){return await Promise.all([e,l(t)]),e}function l(e){return new Promise((t=>setTimeout(t,e)))}const u=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:i,data:s}=t(e);return[i,s]}))),c=(e,t)=>e.length===t.length&&e.reduce(((e,i)=>e&&t.indexOf(i)>-1),!0);function d(e,t){const i=[],s={};return e.forEach((e=>{const r=t(e);null==s[r]&&(s[r]=e,i.push(e))})),i}function p(e){const t={boolean:{},number:{},string:{}},i=[];return e.filter((e=>{let s=typeof e;return s in t?!t[s].hasOwnProperty(e)&&(t[s][e]=!0):!(i.indexOf(e)>=0)&&i.push(e)}))}const h=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((i,s)=>e.slice(t*s,t+t*s)))},62727:(e,t,i)=>{i.d(t,{a:()=>a,g:()=>u});var s=i(18869),r=i(81068),n=i(28384);function a(e){var t,i,n;const a=null!==(t=(0,s.c)(e,"[lang]"))&&void 0!==t?t:null===(n=null===(i=e.shadowRoot)||void 0===i?void 0:i.ownerDocument)||void 0===n?void 0:n.documentElement,o=((null==a?void 0:a.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return r.l.has(o)?r.l.get(o):r.l.has(o.slice(0,2))?r.l.get(o.slice(0,2)):"en"}const o={};function l(e,t){const i=`${e}${t}`;return o[i]||(o[i]=function(e,t){return new Promise(((i,s)=>{fetch((0,n.a)(`../arcgis-app-assets/i18n/${e}.i18n.${t}.json`)).then((e=>{e.ok?i(e.json()):s()}),(()=>s()))}))}(e,t)),o[i]}async function u(e,t){const i=t||e.tagName.toLowerCase(),n=a(e),o=function(e){var t,i,n;const a=null!==(t=(0,s.c)(e,"[lang]"))&&void 0!==t?t:null===(n=null===(i=e.shadowRoot)||void 0===i?void 0:i.ownerDocument)||void 0===n?void 0:n.documentElement,o=((null==a?void 0:a.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return r.l.has(o)?r.l.get(o):r.l.has(o.slice(0,2))?o:"en"}(e);let u;try{u=await l(i,n)}catch(e){console.warn(`no locale for ${i} (${n}) loading default locale en.`),u=await l(i,"en")}return[u,n,o]}}}]);
/*! For license information please see 8025fd39be628e20082d55615eacbf63.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[36144],{83397:(e,r,t)=>{t.d(r,{a:()=>i,b:()=>u,c:()=>y,d:()=>p,e:()=>m,g:()=>c,i:()=>s,r:()=>l});var a=t(41171),n=t(76134),o=t(62381);const l=async(e,r,t={})=>{const{body:o,usePost:l,addTokenManually:s,api:i=(null===n.c||void 0===n.c?void 0:n.c.api)}=t,u=new URLSearchParams;o&&Object.entries(o).forEach((([e,r])=>{void 0!==r&&u.append(e,r)}));const c=new URL(e);c.searchParams.append("f","json");const d=!1===s?null:await(0,a.d)(r,i);d&&c.searchParams.append("token",d);const p=await fetch(c.toString(),{body:l?u:void 0,method:l?"POST":"GET"}),y=await p.json(),m=y.error;if(m)throw"string"==typeof m?new Error(m):m;return y},s=(e,r)=>"Feature Service"===r&&e.includes("Hosted Service"),i=async(e,r)=>{try{return{result:await l(d(e,r),r)}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},u=(e,r)=>`${d(e,r)}/data`,c=async(e,r)=>l(u(e,r),r),d=(e,r)=>`${(0,a.g)(r)}content/items/${e}`,p=async(e,r,t)=>{try{const a=d(e,r);return await l(a,r,t)}catch(e){console.warn(e)}},y=async(e,r)=>{try{const t=`${d(e,r)}/groups`;return{result:await l(t,r)}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},m=async(e,r)=>{let t=!1;return s(e.typeKeywords,e.type)&&(t=await v(e.url,r)),t},v=async(e,r,t=!1)=>{var a,n,s;if(e)try{const s=await l(`${null===(a=(0,o.p)(e))||void 0===a?void 0:a.baseServerUrl}/layers`,r,{addTokenManually:!t});return null===(n=null==s?void 0:s.layers)||void 0===n?void 0:n.reduce(((e,r)=>e||(null==r?void 0:r.capabilities.includes("Editing"))),!1)}catch(t){if(null===(s=null==t?void 0:t.message)||void 0===s?void 0:s.toLowerCase().includes("token required"))return v(e,r,!0)}return!1}},81068:(e,r,t)=>{t.d(r,{C:()=>s,a:()=>c,f:()=>i,g:()=>l,l:()=>o});var a=t(66716),n=t(18869);const o=new Map([["ar","ar"],["bg","bg"],["bs","bs"],["ca","ca"],["cs","cs"],["da","da"],["de","de"],["el","el"],["en","en"],["es","es"],["et","et"],["fi","fi"],["fr","fr"],["he","he"],["hr","hr"],["hu","hu"],["id","id"],["it","it"],["ja","ja"],["ko","ko"],["lt","lt"],["lv","lv"],["nb","nb"],["nl","nl"],["pl","pl"],["pt-br","pt-BR"],["pt-pt","pt-PT"],["ro","ro"],["ru","ru"],["sk","sk"],["sl","sl"],["sr","sr"],["sv","sv"],["th","th"],["tr","tr"],["uk","uk"],["vi","vi"],["zh-cn","zh-CN"],["zh-hk","zh-HK"],["zh-tw","zh-TW"]]);function l(e){return function(e,r,t){const a=(0,n.c)(e,"[dir]");return a?a.getAttribute("dir"):"ltr"}(e)}const s={rtl:"arcgis--rtl"};async function i(e,r){const{api:t,type:n,places:o}=r||{};if(4===t){const[r]=await(0,a.l)(["esri/intl"]),t=r.convertNumberFormatToIntlOptions({places:o,style:n,digitSeparator:!0});return r.formatNumber(e,Object.assign(Object.assign({},t),{style:n}))}const[l]=await(0,a.l)(["dojo/number"]);return l.format(e,{type:n,places:o,pattern:null==r?void 0:r.pattern})}const u={};function c(e){const r=document.documentElement.lang;return u[r]||(u[r]=new Intl.DateTimeFormat(document.documentElement.lang,{year:"numeric",month:"short",day:"numeric"})),u[r].format(e)}},62727:(e,r,t)=>{t.d(r,{a:()=>l,g:()=>u});var a=t(18869),n=t(81068),o=t(28384);function l(e){var r,t,o;const l=null!==(r=(0,a.c)(e,"[lang]"))&&void 0!==r?r:null===(o=null===(t=e.shadowRoot)||void 0===t?void 0:t.ownerDocument)||void 0===o?void 0:o.documentElement,s=((null==l?void 0:l.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return n.l.has(s)?n.l.get(s):n.l.has(s.slice(0,2))?n.l.get(s.slice(0,2)):"en"}const s={};function i(e,r){const t=`${e}${r}`;return s[t]||(s[t]=function(e,r){return new Promise(((t,a)=>{fetch((0,o.a)(`../arcgis-app-assets/i18n/${e}.i18n.${r}.json`)).then((e=>{e.ok?t(e.json()):a()}),(()=>a()))}))}(e,r)),s[t]}async function u(e,r){const t=r||e.tagName.toLowerCase(),o=l(e),s=function(e){var r,t,o;const l=null!==(r=(0,a.c)(e,"[lang]"))&&void 0!==r?r:null===(o=null===(t=e.shadowRoot)||void 0===t?void 0:t.ownerDocument)||void 0===o?void 0:o.documentElement,s=((null==l?void 0:l.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return n.l.has(s)?n.l.get(s):n.l.has(s.slice(0,2))?s:"en"}(e);let u;try{u=await i(t,o)}catch(e){console.warn(`no locale for ${t} (${o}) loading default locale en.`),u=await i(t,"en")}return[u,o,s]}},44371:(e,r,t)=>{t.d(r,{a:()=>$,b:()=>i,c:()=>c,d:()=>d,e:()=>R,s:()=>C,u:()=>u});var a=t(86739),n=t(41171),o=t(62381),l=t(83397),s=t(26426);const i=async(e,r,t,s,i=!1)=>{const{portal:u,user:c}=s,d=`${(0,n.g)(u)}content/users/${c.username}/shareItems`;let p=[];const y=r?function(e){switch(e){case"public":return{org:!1,everyone:!0};case"org":return{org:!0,everyone:!1};case"private":case"shared":return{org:!1,everyone:!1};default:return{}}}(r):{};if(e.every((e=>(0,o.i)(e,c))))try{p=(await(0,l.r)(d,u,{body:Object.assign({items:e.map((e=>e.id)).join(","),groups:(null==t?void 0:t.length)?t.join(","):void 0,confirmItemControl:!0},y),usePost:!0})).results}catch(e){return console.error(e),{error:{code:"unhandledError"}}}else p=(await Promise.all(e.map((({id:e})=>async function(e,r,t,o,s=!1){try{const i=`${(0,a.g)(e,o)}/share`,u=Object.assign({groups:(null==t?void 0:t.length)?t.join(","):null,confirmItemControl:!0},r);let c;return c=s?await(0,l.r)(i,o,{body:u,usePost:!0}):await(0,n.r)(i,u,{},"post"),{result:c}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}(e,y,t,u,i))))).map((e=>e.result));return{result:p}},u=async(e,r,t)=>{const{portal:a,user:o}=t,s=`${(0,n.g)(a)}content/users/${o.username}/unshareItems`;try{return{result:(await(0,l.r)(s,a,{body:{items:e.join(","),groups:(null==r?void 0:r.length)?r.join(","):null},usePost:!0})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};function c(e){const{typeKeywords:r,type:t,url:a}=e,n=r&&p.some((e=>r.includes(e))),o="Image Service"===t&&(null==a?void 0:a.includes("://iservices"))&&a.includes("arcgis.com"),l=y.includes(t);return n||o||l}function d(e){var r;const t=null===(r=e.typeKeywords)||void 0===r?void 0:r.includes("Hosted Service");return["Vector Tile Service","Map Service","Scene Service","Feature Service"].includes(e.type)&&t}const p=["Location Tracking Service","Location Tracking View","IoTFeed","IoTFeatureLayer","IoTMapImageLayer","IoTStreamLayer","Administrative Report","EditExtensionIndoorsSpaces","ArcgisWorkflowJobLocation"],y=["Knowledge Graph","Pro Project"],m=async(e,r)=>{const t=e.id;let a,n={items:[],layers:[]};switch(e.type){case"Group Layer":({result:n,error:a}=await v(t,r));break;case"Web Map":case"Web Scene":({result:n,error:a}=await h(t,r));break;case"Web Mapping Application":({result:n,error:a}=await g(t,r));break;case"Web Experience":case"Web Experience Template":({result:n,error:a}=await w(t,e.typeKeywords,r));break;case"Big Data File Share":case"Data Store":throw new Error("Not implemented")}return{result:n,error:a}},v=async(e,r)=>{try{const t=await(0,l.g)(e,r);return{result:{items:[],layers:[Object.assign({},t)]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},h=async(e,r)=>{var t,a;try{const n=await(0,l.g)(e,r),{operationalLayers:o,baseMap:s,tables:i,ground:u}=n;return{result:{items:[],layers:[...null!=o?o:[],...null!==(t=null==s?void 0:s.baseMapLayers)&&void 0!==t?t:[],...null!==(a=null==u?void 0:u.layers)&&void 0!==a?a:[],...null!=i?i:[]]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},g=async(e,r)=>{try{const t=await(0,l.g)(e,r);if(!t)return{result:{items:[],layers:[]}};const a=f(t),n=(await Promise.all(a.map((e=>(0,l.a)(e,r))))).map((({result:e})=>e)).filter((e=>e)),o=await Promise.all(n.map((e=>m(e,r)))),{items:s,layers:i}=b(o.map((({result:e})=>e)).flat().filter((e=>e)));return{result:{items:[...n,...s],layers:i}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},f=e=>{var r,t,a,n,o,l,s,i,u,c;return[...(null===(r=null==e?void 0:e.map)||void 0===r?void 0:r.itemId)?[e.map.itemId]:[],...null!==(n=null===(a=null===(t=e.values)||void 0===t?void 0:t.itemCollection)||void 0===a?void 0:a.map((e=>e.id)))&&void 0!==n?n:[],...null!==(s=null===(l=null===(o=e.values)||void 0===o?void 0:o.webmap)||void 0===l?void 0:l.split(","))&&void 0!==s?s:[],...null!==(c=null===(u=null===(i=e.values)||void 0===i?void 0:i.webscene)||void 0===u?void 0:u.split(","))&&void 0!==c?c:[]]},w=async(e,r,t)=>{const n=`${(0,a.g)(e,t)}/resources/config/config.json`,o=(0,l.b)(e,t),s=[];r.includes("status: Draft")?s.push(n):r.includes("status: Changed")?s.push(n,o):s.push(o);try{const e=[],r=[],a=[];return await Promise.all(s.map((async n=>{const o=await(0,l.r)(n,t);if(!(null==o?void 0:o.dataSources)&&!(null==o?void 0:o.utilities))return;const s=(await Promise.all(function(e){const r=e.dataSources||{},t=e.utilities||{};return[...Object.values(r),...Object.values(t)].map((e=>e.itemId)).filter((e=>e))}(o).map((e=>(0,l.a)(e,t))))).map((({result:e})=>e)).filter((e=>e)),i=await Promise.all(s.map((e=>m(e,t)))),{items:u,layers:c}=b(i.flatMap((({result:e})=>e)).filter((e=>e)));a.push(...c),e.push(...u),r.push(...s)}))),{result:{items:[...r,...e],layers:a}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},b=e=>({items:e.flatMap((e=>e.items)),layers:e.flatMap((e=>e.layers))});async function I(e,r,t=!1){try{const{result:a}=await(0,l.c)(e,r);return{result:[...a.admin,...a.member,...a.other].filter((e=>t||!e.isFav)).map((e=>e.id))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}const L=e=>!("layerType"in e)&&e.url&&e.popupInfo,T={needsGroupUpdate:!1,needsShareLevelUpdate:!1,canEditShareLevel:!0,premium:!1},S={private:0,shared:1,org:2,public:3},E=async(e,r)=>{const{owningSystemUrl:t}=await(0,n.f)((async()=>(0,n.a)(e)),"portalInfo",e.id);return(await Promise.all(r.map((async e=>{try{const{owningSystemUrl:r}=await(0,n.b)(e);return{owningSystemUrl:r,url:e}}catch(r){return console.error(r),{owningSystemUrl:null,url:e}}})))).filter((({owningSystemUrl:e})=>e===t)).map((({url:e})=>e))},k=async(e,r)=>{const t=e.filter((e=>{return e&&(r={layerType:e.layerType},["table","ArcGISFeatureLayer","ArcGISTiledMapServiceLayer","VectorTileLayer","GroupLayer","ArcGISImageServiceLayer","ArcGISTiledImageServiceLayer","SubtypeGroupLayer","ArcGISStreamLayer","MediaLayer"].includes(r.layerType));var r})),a=await O(t.map((e=>e.url)),r),o=[],s=[],i=[];await Promise.all(a.map((async e=>{const{result:t,error:a}=await(0,n.f)((()=>(async(e,r)=>{var t;try{return{result:await(0,l.r)(e,r,{addTokenManually:!1})}}catch(e){const r="token required";return(null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.toLowerCase().includes(r))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}})(e,r)),"itemMetadata",`${e}--no-token`);"tokenRequired"!==(null==a?void 0:a.code)?P(t)?o.push(j(t,e)):i.push(t):s.push(e)})));const u=i.map((e=>null==e?void 0:e.serviceItemId)),c=await E(r,s),d=(await Promise.all(c.map((async e=>({response:await(0,l.r)(e,r,{addTokenManually:!0}),url:e}))))).reduce(((e,{response:r,url:t})=>P(r)?(o.push(j(r,t)),e):[...e,null==r?void 0:r.serviceItemId]),[]),p=await Promise.all([...u,...d].map((async e=>e?(0,l.d)(e,r):null))),y=o.length<=0?[]:await k(o.map((e=>({url:e,layerType:"VectorTileLayer"}))),r);return[...p.filter((e=>!!e)),...y]},P=e=>!!(null==e?void 0:e.sources),j=(e,r)=>{var t;const a=null===(t=Object.values(e.sources)[0])||void 0===t?void 0:t.url;return a?a.includes("..")?(({path:e,url:r})=>{const t=r.split("/"),a=e.split("/");return t.slice(0,t.length-a.length).join("/")})({url:r,path:a}):a:null},O=async(e,r)=>{const t=e.filter((e=>!!e&&!!(0,o.p)(e))),a=e.filter((e=>!e||!(0,o.p)(e)));return[...await E(r,t),...a]},$=async(e,r,t,a={clearDataCacheOnDone:!0})=>{if("private"===e.access)return{result:{needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[]}};const{result:o,error:l}=await G(e,r,t);if(l)return{error:l};const s={needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[]};return await Promise.all(null==o?void 0:o.map((async t=>{const a=await A({mainItem:e,sharingDetailResult:t,portal:r});a&&s[a].push(t)}))),a.clearDataCacheOnDone&&R.forEach((e=>(0,n.c)(e))),{result:s}},G=async(e,r,t)=>{let a,i=[],u=[...t||[]];if(!(null==u?void 0:u.length)){const{error:t,result:n}=await m(e,r);a=t,u=n.layers,i=n.items}if(a)return{error:a};if(u.length<=0&&i.length<=0)return{error:{code:"dataNotAvailable"}};try{const{result:t,error:a}=await(async(e,r)=>{const t=[],a=e=>{if(L(e))t.push({id:e.id,url:e.url,layerType:"table",getType:"normal"});else{if("GroupLayer"===e.layerType)return e.itemId&&t.push({id:e.id,itemId:e.itemId,layerType:"GroupLayer",getType:"normal"}),void e.layers.forEach((e=>{if(L(e)||"GroupLayer"===e.layerType)return void a(e);const r=e.url;if(!r)return void a(e);const t=(0,o.p)(r);a(Object.assign(Object.assign({},e),{url:null!=(null==t?void 0:t.index)?t.baseServerUrl:e.url}))}));if((e=>"VectorTileLayer"===e.layerType&&"styleUrl"in e)(e))t.push({id:e.id,url:e.styleUrl,itemId:e.itemId,layerType:e.layerType,getType:"normal"});else if((e=>"ArcGISTiledMapServiceLayer"===e.layerType)(e)){const r=(e=>"ArcGISTiledMapServiceLayer"===e.layerType&&"layers"in e&&!1===e.layers[0].disablePopup)(e);if(r){const r=e.layers[0];t.push({id:r.id,url:r.layerUrl,getType:"normal",layerType:e.layerType,itemId:r.layerItemId})}t.push({id:e.id,getType:r?"normal":"tile-layer-with-no-popup",itemId:e.itemId,layerType:e.layerType,url:e.url})}else(e.itemId||e.url)&&t.push({id:e.id,url:e.url,itemId:e.itemId,layerType:e.layerType,getType:"normal"})}};e.forEach(a);const i=(0,s.a)(t,(e=>e.itemId?{key:e.itemId,data:{searchType:"item-id",layerType:e.layerType}}:{key:e.url,data:{searchType:"url",layerType:e.layerType}})),u=Object.keys(i).filter((e=>"item-id"===i[e].searchType));try{const e=(await Promise.all(u.map((e=>(0,l.d)(e,r))))).filter((e=>!!e)),a=t.filter((({getType:e,itemId:r})=>"tile-layer-with-no-popup"===e&&!!r)),o=(await Promise.all(a.map((e=>(async(e,r)=>{try{const t=e.itemId,a=await(0,n.f)((()=>(0,l.g)(t,r)),"itemData",t),{layerItemId:o}=null==a?void 0:a.layers[0];return o?{result:await(0,l.d)(o,r)}:{error:{code:"unhandledError"}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(e,r))))).map((({result:e})=>e)),c=e.filter((e=>!(0,l.i)(e.typeKeywords,e.type))),d=await k(c.map((e=>{const{url:r,id:t}=e,a=i[t];return a?{layerType:a.layerType,url:r}:null})),r),p=(0,s.a)(d,(e=>({key:e.url,data:e}))),y=Object.keys(i).map((e=>{const r=i[e];return r&&"url"===r.searchType?{layerType:r.layerType,url:e}:null})).filter((e=>e)),m=await k(y,r),v=[];return e.filter((e=>e)).forEach((e=>{const r=e.url;v.push({sourceItem:e});const t=p[r];t&&e.id!==t.id&&v.push({sourceItem:t})})),[...o,...m].forEach((e=>{e&&v.push({layer:null,sourceItem:e})})),{result:v}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(u,r);if(a)return{error:a};const{result:d,error:p}=await I(e.id,r);if(p)return{error:p};const y=(0,s.u)([...t.map((({sourceItem:e})=>e)),...i],(e=>e.id)),m=await Promise.all(y.map((async t=>{const a=await async function({mainItemAccess:e,mainItemSharingGroups:r,portal:t,sourceItem:a}){const{access:n,itemControl:l}=a,s=Object.assign({},T),i="public"===e;return c(a)&&i?Object.assign(Object.assign({},s),{needsShareLevelUpdate:!0,canEditShareLevel:!1}):("public"!==n?(s.canEditShareLevel=U(l),s.needsGroupUpdate=await D({sourceItem:a,isMainItemSharingToPublic:i,mainItemSharingGroups:r,portal:t}),s.needsShareLevelUpdate=M({mainItemAccess:e,sourceItemAccess:n})):s.premium=function(e){return(0,o.a)(e)||(0,o.b)(e)}(a),s)}({sourceItem:t,mainItemAccess:e.access,mainItemSharingGroups:d,portal:r});return{layer:null,sourceItem:t,detail:a}})));return{result:m}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},U=e=>"admin"===e,D=async({sourceItem:e,isMainItemSharingToPublic:r,portal:t,mainItemSharingGroups:a})=>{if(r)return!1;const{result:n}=await I(e.id,t);return!function(e,r){return!(null==e?void 0:e.length)||e.filter((e=>!(r||[]).includes(e))).length<=0}(a,n)},M=({mainItemAccess:e,sourceItemAccess:r})=>!("private"===r&&"shared"===e)&&S[e]>S[r];async function C(e,r,t,a,n=!0){const{user:o}=a,l=n?await Promise.all(r.map((async e=>{const{result:r}=await I(e.id,a);return r}))):[],s=l.flat(1);return i(e,t,s,{portal:a,user:o},!0)}const A=async({mainItem:e,sharingDetailResult:r,portal:t})=>{var a;const{sourceItem:n,detail:s}=r,{canEditShareLevel:i,needsGroupUpdate:u,needsShareLevelUpdate:c,premium:p}=s;if(!u&&!c&&!p)return null;if(!i&&!p)return"notEditableLayers";switch(e.access){case"public":if(p)return"premiumLayers";if("public"!==n.access){if((0,o.c)(t.subscriptionInfo||(null===(a=t.sourceJSON)||void 0===a?void 0:a.subscriptionInfo))&&d(n))return"notEditableLayers";if(await(0,l.e)(n,t))return n.typeKeywords.includes("Public Data Collection")?"needEditableLayers":"needDataCollectionLayers"}return"needsShareLevelUpdateLayers";case"org":case"shared":case"private":return p?null:"needsShareLevelUpdateLayers";default:x(e.access)}},R=["itemData","itemMetadata"],x=e=>{throw new Error(`Unexpected share level ${e}`)}},26800:(e,r,t)=>{t.d(r,{D:()=>m,a:()=>y,b:()=>c,c:()=>d,d:()=>v,e:()=>p,f:()=>L,g:()=>h,h:()=>g,i:()=>T,j:()=>w,k:()=>l,l:()=>i,s:()=>u});var a=t(62381),n=t(26426),o=t(44371);const l=(e,r)=>s(r)||(0,a.A)(r)&&((e,r)=>{const{username:t,orgId:a}=e;return r.every((({group:e})=>{const r=t===(null==e?void 0:e.owner),n=a===e.orgId;return r||n}))})(r,e),s=e=>!(0,a.x)(e)||function(e){return(e.privileges||[]).includes("portal:user:shareToGroup")}(e),i=(e,r)=>r.some((({selectedByItemIds:r})=>r.length!==e.length)),u=(e,r)=>!(0,a.x)(e)&&!(0,a.y)(e)&&r.some((e=>"private"===e)),c=(e,r,t)=>(0,a.n)(e)&&r.some((e=>"private"===e))&&t.length>0,d=(e,r,t)=>!(0,a.x)(e)&&!(0,a.z)(e)&&(({items:e,groupData:r})=>e.filter((e=>{const r=e.access;return"private"===r||"shared"===r})).reduce(((e,t)=>e||(({item:e,groupData:r})=>r.reduce(((r,t)=>r||!!t.selectedByItemIds&&t.selectedByItemIds.includes(e.id)),!1))({item:t,groupData:r})),!1))({items:r,groupData:t}),p=(e,r,t)=>!(0,a.x)(e)&&!(0,a.z)(e)&&"private"===r&&Object.keys(t).length>0,y=({shareMode:e,currentUsername:r,user:t,userGroupLookup:a,isPrivate:n})=>{var o;let l,s=[];if(a){let l=[];"admin"===e&&(null===(o=a[r])||void 0===o?void 0:o.length)&&r!==t.username&&(l=[...a[r]]),"admin"===e&&n||a[t.username].forEach((e=>{l.some((r=>r.id===e.id))||l.push(e)})),null==l||l.forEach((e=>{var r;const t=null===(r=e.userMembership)||void 0===r?void 0:r.memberType;!e.isViewOnly||"owner"!==t&&"admin"!==t||s.push(e.id)}))}s.length&&(l=`(isviewonly:false OR id:(${s.join(" OR ")}))`);const i=s.length?` OR id:(${s.join(" OR ")})`:"";switch(e){case"default":return l||`(owner:${r} OR isviewonly:false)`;case"group":return`owner:${r} -capabilities:updateitemcontrol`;case"admin":return t.username===r?`(isviewonly:false${i} OR owner:${t.username}) -capabilities:updateitemcontrol`:`(owner:${r} OR isviewonly:false${i})`;default:return""}},m={needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[]},v=["private","org","public"],h=(e,r)=>{const t=e.filter((e=>!r.some((r=>r.group.id===e.group.id)))),a=r.filter((r=>{const t=e.find((e=>e.group.id===r.group.id));return!t||t.selectedByItemIds.length<r.selectedByItemIds.length}));return{unshareGroupIds:t.map((e=>e.group.id)),shareGroupIds:a.map((e=>e.group.id))}},g=(e,r,t)=>{const n=(0,a.n)(e);let o=v;return n?o=["private","public"]:t.canSharePublic||(0,a.e)(e)||(o=["private","org"]),o=o.filter((a=>f(a,r,e,t))),o},f=(e,r,t,n)=>{var l;if("private"===e)return!0;const s=b(t,r),i=I(t,r),u=(0,a.e)(t)&&!(0,a.t)(t)&&i,c=(0,a.e)(t)&&(0,a.t)(t)&&i,d=(0,a.n)(t);if("org"===e)return!d&&((0,a.z)(t)&&(s||u)||(0,a.B)(t)&&(u||c));if("public"===e){const e=(0,a.c)((null==n?void 0:n.subscriptionInfo)||(null===(l=null==n?void 0:n.sourceJSON)||void 0===l?void 0:l.subscriptionInfo));if(1===r.length&&((0,o.c)(r[0])||e&&(0,o.d)(r[0])))return!1;const i=n.canSharePublic;return d||(0,a.C)(t)&&(s&&i||u)||(0,a.D)(t)&&(u||c)}},w=(e,r,t)=>{const n=e[0];if((0,a.i)(n,r))return"default";const o=!n.orgId||n.orgId===r.orgId;return(0,a.E)({items:e,user:r,portal:t})&&o?"admin":"group"},b=(e,r)=>r.every((r=>(0,a.i)(r,e))),I=(e,r)=>{const t=null==e?void 0:e.orgId;return r.every((r=>{var n;return(0,a.i)(r,e)||(null===(n=r.portal)||void 0===n?void 0:n.id)===t||r.orgId===t||r.isOrgItem}))},L=(e,r,t,a)=>e.some(((e,n)=>{const o=r[n];if("shared"===o&&"private"===e){const e=t[n];return!a.some((r=>r.selectedByItemIds.includes(e.id)))}return o!==e})),T=(e,r)=>e.length!==r.length||r.some((r=>{const t=e.find((e=>e.group.id===r.group.id));return!t||!(0,n.f)(t.selectedByItemIds,r.selectedByItemIds)}))}}]);
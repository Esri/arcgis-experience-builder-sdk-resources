/*! For license information please see 412088dc84a4dbcecd65f4137681e370.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[14614],{14614:(e,t,i)=>{i.r(t),i.d(t,{arcgis_layer_view:()=>M,arcgis_layer_view_browse_layer:()=>H,arcgis_layer_view_create:()=>q,arcgis_layer_view_definition:()=>U,arcgis_layer_view_join:()=>ie,arcgis_layer_view_join_add_selection:()=>re,arcgis_layer_view_join_browse_layer:()=>oe,arcgis_layer_view_join_config:()=>he,arcgis_layer_view_join_create:()=>ge,arcgis_layer_view_join_target_selection:()=>me,arcgis_layer_view_msg:()=>ye,arcgis_layer_view_overview:()=>fe,arcgis_layer_view_selection:()=>we,arcgis_layer_view_swap_source:()=>Ne});var s=i(28384),r=i(62727),o=i(66716),a=i(34077),n=i(26426),l=i(81068),d=i(3834),c=i(65508),h=i(74828);i(18869),i(72637),i(27010);const p="panel",u="footer",g="error-content";var m,y;function f(e){return!e||!e.filter||!["geometry","distance","objectIds","timeExtent","where"].some((t=>e.filter.hasOwnProperty(t)))}function v(e,t,i){const{backgroundTheme:s}=i;let r="light"===s?100:65;e.featureEffect=new t({filter:{},excludedEffect:`grayscale(100%) opacity(30%) brightness(${r}%)`,excludedLabelsVisible:!0})}function w(e,t){return e===t||Math.round(1e6*e)/1e6==Math.round(1e6*t)/1e6}function I(e,t){const i=["oid","esriFieldTypeOID","global-id","esriFieldTypeGlobalID","geometry","esriFieldTypeGeometry"];let s;if(t)s=t.fields;else{const{definitionLayerId:t}=e,i=P(t,e);s=(null==i?void 0:i.fields)||N(t,e).fields}return s.filter((e=>i.indexOf(e.type)>-1||!e.nullable&&!(0,a.i)(e.defaultValue))).map((e=>e.name))}function b(e,t){const{viewProps:i}=t;return null==i?void 0:i.find((t=>e===t.layerId))}function L(e){const{viewProps:t}=e;t&&(e.viewProps=t.filter((e=>e.filter||e.aoi||e.fields)),e.viewProps.length||(e.viewProps=void 0))}function E(e,t,i){var s;let r=b(e,i);r||(r={layerId:e});const o=Object.assign(Object.assign({},r),t);i.viewProps=null===(s=i.viewProps)||void 0===s?void 0:s.filter((t=>t.layerId!==e)),i.viewProps=i.viewProps||[],i.viewProps.push(o)}function N(e,t){const{layer:i}=t;return"group"===i.type?k(i).find((t=>t.layerId===e)):i}async function S(e,t,i){const s=N(t,i);if(s.isTable)return new Promise((e=>{e()}));const[r]=await(0,o.l)(["esri/layers/support/FeatureEffect"]);if(e){let t=0;const o=setInterval((()=>{var a;(null===(a=s.featureEffect)||void 0===a?void 0:a.filter)||v(s,r,i),s.featureEffect.filter.where=e,t++,3===t&&clearInterval(o)}),200)}else s.featureEffect.filter.where=null,f(s.featureEffect)&&(s.featureEffect=null)}async function C(e,t,i){const s=N(t,i),[r,a,n]=await(0,o.l)(["esri/layers/support/FeatureEffect","esri/geometry/Polygon","esri/geometry/Extent"]);if(e){let t=0;const o=setInterval((()=>{var l;(null===(l=s.featureEffect)||void 0===l?void 0:l.filter)||v(s,r,i);const d="polygon"===e.type?a.fromJSON(e.toJSON()):n.fromJSON(e.toJSON());s.featureEffect.filter.geometry=d,t++,3===t&&clearInterval(o)}),200)}else s.featureEffect.filter.geometry=null,f(s.featureEffect)&&(s.featureEffect=null)}function O(e){var t;const{url:i}=e;if(!i)return"";const s=null===(t=["/FeatureServer","/MapServer"].filter((e=>i.toLowerCase().indexOf(e.toLowerCase())>-1)))||void 0===t?void 0:t[0];let r="";return s&&(r=i.substring(0,i.indexOf(s)),r=r.substring(r.lastIndexOf("/")+1,r.length)),r}function k(e){var t,i,s;return(null===(t=e.layers)||void 0===t?void 0:t.length)&&(null===(i=e.tables)||void 0===i?void 0:i.length)?e.layers.concat(e.tables):(null===(s=e.layers)||void 0===s?void 0:s.length)?e.layers:e.tables}function x(e,t,i){const{strings:s}=i;return e.geometryType!==t.geometryType?(console.log("layer geometry type does not match"),s.msg.swapErrors.geometryType):JSON.stringify(e.spatialReference.toJSON())!==JSON.stringify(t.spatialReference.toJSON())?(console.log("layer spatial reference does not match"),s.msg.swapErrors.spatialReference):null}function T(e,t,i){const{strings:s}=i,r=I(i,e),o=b(e.layerId,i);let a;if(null==o?void 0:o.fields){const t=o.fields.concat(r);a=e.fields.filter((e=>t.indexOf(e.name)>-1))}else a=e.fields;for(let i=0;i<a.length;i++){const r=a[i],o=t.fields.find((e=>r.name===e.name));if(!o)return console.log("layer",e.layerId,e.title,": field",r.name,"missing in new source layer"),s.msg.swapErrors.missingField;if(r.type!==o.type)return console.log("layer",e.layerId,e.title,": field type of",r.name,"different in layers"),s.msg.swapErrors.fieldType}return null}async function F(e,t){const{layer:i,viewItem:s,adminServiceInfo:r}=e;if(r)return;let a=((null==s?void 0:s.url)||i.portalItem.url).replace("/rest/services","/rest/admin/services");t&&(a+=`${a.indexOf("?")>-1?"&":"?"}_ts=${(new Date).getTime()}`);try{const[t,i]=await(0,o.l)(["esri/identity/IdentityManager","esri/request"]);await t.getCredential(a);const s=await i(a,{query:{f:"json"}});e.adminServiceInfo=s.data}catch(e){return new Promise(((e,t)=>{t(new Error("could not get admin info"))}))}}function P(e,t){var i,s;const{adminServiceInfo:r}=t;return(null===(i=null==r?void 0:r.layers)||void 0===i?void 0:i.find((t=>t.id===e)))||(null===(s=null==r?void 0:r.tables)||void 0===s?void 0:s.find((t=>t.id===e)))}function j(e){const{layer:t,layerIds:i,adminServiceInfo:s}=e;if("group"===t.type){const r=s&&k(s);return!(s&&r.length===i.length&&r.every((e=>i.indexOf(e.id)>-1)))||k(t).filter((e=>i.indexOf(e.layerId)>-1)).some((t=>R(t.layerId,e)))}return R(t.layerId,e)}function R(e,t){var i,s,r,o;const{viewItem:a}=t,n=N(e,t),l=b(e,t),d=P(e,t),c=a&&(null==d?void 0:d.fields)?d.fields.filter((e=>e.visible)):(null==d?void 0:d.fields)||n.fields;if(l){if(l.filter!==(null==d?void 0:d.viewDefinitionQuery)||l.fields&&l.fields.length!==c.length||!l.fields&&c.length!==n.fields.length||!n.isTable&&!function(e,t){var i,s,r,o;const a=null===(o=null===(r=null===(s=null===(i=null==t?void 0:t.adminLayerInfo)||void 0===i?void 0:i.viewLayerDefinition)||void 0===s?void 0:s.table)||void 0===r?void 0:r.filter)||void 0===o?void 0:o.value;if(!(null==e?void 0:e.aoi)&&!a)return!0;if((null==e?void 0:e.aoi)&&!a||!(null==e?void 0:e.aoi)&&a)return!1;if(e.aoi.rings&&"esriGeometryPolygon"!==a.geometryType||e.aoi.xmin&&"esriGeometryEnvelope"!==a.geometryType)return!1;if(e.aoi.xmin){const t=e.aoi,i=a.geometry;return!!(w(t.xmin,i.xmin)&&w(t.xmax,i.xmax)&&w(t.ymin,i.ymin)&&w(t.ymax,i.ymax))}return e.aoi.rings?e.aoi.rings[0].length===a.geometry.rings[0].length&&e.aoi.rings[0].every((e=>a.geometry.rings[0].some((t=>w(e[0],t[0])&&w(e[1],t[1]))))):void 0}(l,d))return!0}else if((null==d?void 0:d.viewDefinitionQuery)||c.length<n.fields.length||!n.isTable&&(null===(o=null===(r=null===(s=null===(i=null==d?void 0:d.adminLayerInfo)||void 0===i?void 0:i.viewLayerDefinition)||void 0===s?void 0:s.table)||void 0===r?void 0:r.filter)||void 0===o?void 0:o.value))return!0;return!1}async function V(e,t,i){var s,r;const{layer:o,layerIds:a}=e;let n,l;"group"===o.type?(n=null===(s=o.layers)||void 0===s?void 0:s.filter((e=>a.indexOf(e.layerId)>-1)).map((t=>$(t,e))).toArray().reverse(),l=null===(r=o.tables)||void 0===r?void 0:r.filter((e=>a.indexOf(e.layerId)>-1)).map((t=>$(t,e))).toArray().reverse()):o.isTable?l=[$(o,e)]:n=[$(o,e)];try{const s=t.serviceurl.replace("rest/services","rest/admin/services");return await A(`${s}/addToDefinition`,{layers:n,tables:l},i,e),await async function(e,t,i){const{layer:s,layerIds:r}=e,{portalItem:o}=s,{portal:a}=o,n=t.serviceurl.replace("rest/services","rest/admin/services");try{if("group"===s.type){const t=[],o=k(s).filter((e=>r.indexOf(e.layerId)>-1));for(let i=0;i<o.length;i++){const s=o.getItemAt(i);if(R(s.layerId,e)){const i=await B(s,e),r=`${n}/${s.layerId}/updateDefinition`;t.push({updateDefUrl:r,json:i})}}if(t.length)if(a.isPortal)for(const s of t)await D(s.updateDefUrl,s.json,i,e);else{const s=[];t.forEach((t=>{s.push(D(t.updateDefUrl,t.json,i,e))})),await Promise.all(s)}}else if(R(s.layerId,e)){const t=await B(s,e),r=`${n}/${s.layerId}/updateDefinition`;await D(r,t,i,e)}return new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("updateDefinitions failed"))}))}}(e,t,i),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("initialAddToDefinition failed"))}))}}async function D(e,t,i,s,r=!1){var o;const{layer:a,viewItem:n}=s,l={updateDefinition:JSON.stringify(t)};try{const t=a.portalItem.portal,s=(null==n?void 0:n.typeKeywords.indexOf("IoTFeatureLayer"))>-1,r=await i(e,{query:Object.assign(Object.assign({},l),{f:"json",async:!t.isPortal&&!s,token:t.credential.token}),method:"post",responseType:"json"});if(t.isPortal||s)return new Promise((e=>{e()}));try{return await J(null===(o=null==r?void 0:r.data)||void 0===o?void 0:o.statusURL,{f:"json",token:t.credential.token},i),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("updateDefinition request failed (poll)"))}))}}catch(o){return r?new Promise(((e,t)=>{t(new Error("updateDefinition request failed"))})):D(e,t,i,s,!0)}}async function A(e,t,i,s,r=!1){var o;const{layer:a,viewItem:n}=s,l={addToDefinition:JSON.stringify(t)};try{const t=a.portalItem.portal,s=(null==n?void 0:n.typeKeywords.indexOf("IoTFeatureLayer"))>-1,r=await i(e,{query:Object.assign(Object.assign({},l),{f:"json",async:!t.isPortal&&!s,token:t.credential.token}),method:"post",responseType:"json"});if(t.isPortal||s)return new Promise((e=>{e()}));try{return await J(null===(o=null==r?void 0:r.data)||void 0===o?void 0:o.statusURL,{f:"json",token:t.credential.token},i),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("addToDefinition request failed (poll)"))}))}}catch(o){return r?new Promise(((e,t)=>{t(new Error("addToDefinition request failed"))})):A(e,t,i,s,!0)}}async function _(e,t,i,s,r=!1){const o={deleteFromDefinition:JSON.stringify(t)};try{return await s(e,{query:Object.assign(Object.assign({},o),{f:"json",token:i.portal.credential.token}),method:"post",responseType:"json"}),new Promise((e=>{e()}))}catch(o){return r?new Promise(((e,t)=>{t(new Error("deleteFromDefinition request failed"))})):_(e,t,i,s,!0)}}function $(e,t){const{layer:i,layerItem:s}=t,r=e.sourceJSON;return delete r.indexes,delete r.fields,delete r.serviceItemId,delete r.serverGens,delete r.relationships,r.url=`${e.url}/${e.layerId}?token=${i.portalItem.portal.credential.token}`,r.adminLayerInfo={viewLayerDefinition:{sourceServiceName:O(s),sourceLayerId:e.layerId,sourceLayerFields:"*"}},r}async function B(e,t){var i,s,r,o,n,l,d,c,h;const{modules:p}=t,u={},g=b(e.layerId,t);if(g){if(u.viewDefinitionQuery=g.filter||"",g.aoi){let t=g.aoi;if(m=t.spatialReference,y=e.spatialReference,f=[102113,102100,3857],!(m&&y&&(0,a.i)(m.wkid)&&(0,a.i)(y.wkid)&&f.indexOf(m.wkid)>-1&&f.indexOf(y.wkid)>-1||m&&y&&((0,a.i)(m.wkid)&&(0,a.i)(y.wkid)&&m.wkid==y.wkid||(0,a.i)(m.latestWkid)&&(0,a.i)(y.wkid)&&m.latestWkid==y.wkid||(0,a.i)(m.wkid)&&(0,a.i)(y.latestWkid)&&m.wkid==y.latestWkid||(0,a.i)(m.latestWkid)&&(0,a.i)(y.latestWkid)&&m.latestWkid==y.latestWkid)||m&&y&&(0,a.i)(m.wkt)&&(0,a.i)(y.wkt)&&m.wkt===y.wkt)){await p.projection.load();const s=t.rings?p.Polygon.fromJSON(t):p.Extent.fromJSON(t);t=null===(i=p.projection.project(s,e.spatialReference))||void 0===i?void 0:i.toJSON()}const s=t.rings?"esriGeometryPolygon":"esriGeometryEnvelope";u.viewLayerDefinition={filter:{operator:"esriSpatialRelIntersects",value:{geometryType:s,geometry:t}}}}else{const i=P(e.layerId,t);(null===(n=null===(o=null===(r=null===(s=null==i?void 0:i.adminLayerInfo)||void 0===s?void 0:s.viewLayerDefinition)||void 0===r?void 0:r.table)||void 0===o?void 0:o.filter)||void 0===n?void 0:n.value)&&(u.viewLayerDefinition={filter:null})}g.fields?u.fields=e.fields.map((e=>({name:e.name,visible:g.fields.indexOf(e.name)>-1}))):u.fields=e.fields.map((e=>({name:e.name,visible:!0})))}else{u.viewDefinitionQuery="",u.fields=e.fields.map((e=>({name:e.name,visible:!0})));const i=P(e.layerId,t);(null===(h=null===(c=null===(d=null===(l=null==i?void 0:i.adminLayerInfo)||void 0===l?void 0:l.viewLayerDefinition)||void 0===d?void 0:d.table)||void 0===c?void 0:c.filter)||void 0===h?void 0:h.value)&&(u.viewLayerDefinition={filter:null})}var m,y,f;return u}!function(e){e[e.ERROR=0]="ERROR",e[e.LOADING=1]="LOADING",e[e.SELECTION=2]="SELECTION",e[e.OVERVIEW=3]="OVERVIEW",e[e.SWAP_SOURCE=4]="SWAP_SOURCE",e[e.BROWSE_LAYER=5]="BROWSE_LAYER",e[e.DEFINITION=6]="DEFINITION",e[e.FILTER=7]="FILTER",e[e.CREATE=8]="CREATE"}(m||(m={})),function(e){e[e.CANCEL=0]="CANCEL",e[e.CREATE=1]="CREATE"}(y||(y={}));const J=async(e,t,i)=>{var s;if(!e)throw new Error("pollForStatus: no status URL");const r=["processing","partial","Pending","InProgress"],o=["completed","Completed"];try{const a=await i(e,{query:t}),l=null===(s=null==a?void 0:a.data)||void 0===s?void 0:s.status;return r.includes(l)?(await(0,n.t)(500),J(e,t,i)):o.includes(l)?new Promise((e=>{e()})):new Promise(((e,t)=>{t()}))}catch(e){return new Promise(((t,i)=>{i(e)}))}},M=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewCancel=(0,s.c)(this,"arcgisLayerViewCancel",7),this.arcgisLayerViewStepChange=(0,s.c)(this,"arcgisLayerViewStepChange",7),this.arcgisLayerViewCreated=(0,s.c)(this,"arcgisLayerViewCreated",7),this.arcgisLayerViewChanged=(0,s.c)(this,"arcgisLayerViewChanged",7),this.status=m.LOADING,this.goCancel=()=>{this.arcgisLayerViewCancel.emit()},this.view=void 0,this.itemId=void 0,this.config=void 0,this.props=void 0,this.reRender=!1}arcgisLayerViewStatusHandler(e){var t;const{props:i}=this,{detail:s}=e;this.status=s.status,(null===(t=s.layerIds)||void 0===t?void 0:t.length)&&(i.layerIds=[...s.layerIds]),this.status===m.SELECTION?(i.sourceItemId=i.layerItem.id,this.arcgisLayerViewStepChange.emit(1)):this.status===m.OVERVIEW?this.arcgisLayerViewStepChange.emit(2):this.status===m.CREATE&&this.arcgisLayerViewStepChange.emit(3),this.reRender=!this.reRender}async arcgisLayerViewCreateDoneHandler(e){this.arcgisLayerViewCreated.emit(e.detail)}async arcgisLayerViewOverviewUpdatedHandler(){this.arcgisLayerViewChanged.emit(this.itemId)}arcgisLayerViewSelectionCancelHandler(){this.arcgisLayerViewCancel.emit()}arcgisLayerViewOverviewCancelHandler(){this.arcgisLayerViewCancel.emit()}arcgisLayerViewCreateCancelHandler(){this.arcgisLayerViewCancel.emit()}async setStep(e){const{props:t}=this,{viewItem:i}=t;switch(document.body.querySelectorAll(".js-app-flyout").forEach((e=>{document.body.removeChild(e)})),e){case 1:this.status=m.SELECTION,this.reRender=!this.reRender;break;case 2:this.status=m.OVERVIEW,this.reRender=!this.reRender;break;case 3:i||(this.status=m.CREATE,this.reRender=!this.reRender)}}async componentWillLoad(){const{itemId:e,view:t,config:i}=this,[s]=await(0,r.g)(this.hostElement);this.strings=s,this.props={config:i,view:t,itemId:e,strings:s,layerIds:[],modules:{}}}async componentDidLoad(){var e,t,i;let{props:s}=this;const{itemId:r,view:a}=s;if(r)try{const[n,l,d,c,h,p,u]=await(0,o.l)(["esri/portal/PortalItem","esri/layers/Layer","esri/geometry/Extent","esri/geometry/projection","esri/views/support/colorUtils","esri/geometry/Polygon","esri/request"]);s.modules.PortalItem=n,s.modules.projection=c,s.modules.Polygon=p,s.modules.Extent=d,s.modules.Layer=l;const g=new n({id:r});if(await g.load(),"Feature Service"!==g.type)return void console.error("Only Feature Service items are allowed.");let y,f;if((null===(e=g.typeKeywords)||void 0===e?void 0:e.indexOf("View Service"))>-1?(y=g,await g.fetchRelatedItems({relationshipType:"Service2Data",direction:"forward"}).then((async e=>{e.length&&(f=e[0])}))):f=g,!f)return console.error("Could not find related item for view."),this.panelNode.loading=!1,this.status=m.ERROR,void(this.reRender=!this.reRender);s.sourceItemId=f.id;let v=f.portal.user;f.portal.user.username!==f.owner&&await u(`${f.portal.restUrl}/community/users/${f.owner}`,{query:{f:"json"}}).then((e=>{(null==e?void 0:e.data)&&(v=e.data)}));let w=(y||f).extent;if(w||(w=new d({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:4326})),4326!==a.spatialReference.wkid){await c.load();const e=c.project(w,a.spatialReference);a.goTo(e.expand(1.1))}else a.goTo(w.expand(1.1));const I=await h.getBackgroundColorTheme(a);f=new n({id:f.id}),await f.load();const b=await l.fromPortalItem({portalItem:f});if(this.props=Object.assign(Object.assign({},s),{layerItem:f,viewItem:y,layer:b,layerItemOwner:v,backgroundTheme:I}),s=this.props,"group"===b.type?(await b.loadAll(),(null===(t=b.layers)||void 0===t?void 0:t.length)&&a.map.add(b),s.layerIds=k(b).map((e=>e.layerId)).toArray(),null===(i=b.layers)||void 0===i||i.forEach((e=>{!e.popupTemplate&&e.popupEnabled&&(e.popupTemplate=e.createPopupTemplate())}))):(await b.load(),b.isTable||a.map.add(b),s.layerIds=[b.layerId],b.popupTemplate=b.createPopupTemplate()),await F(s),await async function(e){var t,i,s;const{viewItem:r,adminServiceInfo:o,layer:a}=e,{modules:n}=e;if(r){if(!o)return;e.layerIds=[],k(o).forEach((async t=>{var i,s,r,o;e.layerIds.push(t.id);const a=[];t.fields.forEach((e=>{!1!==e.visible&&a.push(e.name)})),a.length!==t.fields.length&&E(t.id,{fields:a},e);const l=t.viewDefinitionQuery;l&&(E(t.id,{filter:l},e),S(l,t.id,e));const d=null===(o=null===(r=null===(s=null===(i=t.adminLayerInfo)||void 0===i?void 0:i.viewLayerDefinition)||void 0===s?void 0:s.table)||void 0===r?void 0:r.filter)||void 0===o?void 0:o.value;d&&(E(t.id,{aoi:JSON.parse(JSON.stringify(d.geometry))},e),C(d.geometry.rings?n.Polygon.fromJSON(d.geometry):n.Extent.fromJSON(d.geometry),t.id,e))})),"group"===a.type?(a.layers.forEach((t=>{t.visible=e.layerIds.indexOf(t.layerId)>-1,t.definitionExpression=null})),null===(s=a.tables)||void 0===s||s.forEach((e=>{e.definitionExpression=null}))):(a.visible=e.layerIds.indexOf(a.layerId)>-1,a.definitionExpression=null)}else"group"===a.type?(null===(t=a.layers)||void 0===t||t.forEach((t=>{t.definitionExpression&&(E(t.layerId,{filter:t.definitionExpression},e),S(t.definitionExpression,t.layerId,e),t.definitionExpression=null)})),null===(i=a.tables)||void 0===i||i.forEach((t=>{t.definitionExpression&&(E(t.layerId,{filter:t.definitionExpression},e),S(t.definitionExpression,t.layerId,e),t.definitionExpression=null)}))):a.definitionExpression&&(E(a.layerId,{filter:a.definitionExpression},e),S(a.definitionExpression,a.layerId,e),a.definitionExpression=null)}(s),s.derivativeLayers={hasAny:!1},y){const e=await g.fetchRelatedItems({relationshipType:"Service2Service",direction:"forward"});e.length&&(s.derivativeLayers={hasMS:e.find((e=>"Map Service"===e.type)),hasVTL:e.find((e=>"Vector Tile Service"===e.type)),hasWFS:e.find((e=>"WFS"===e.type)),hasScene:e.find((e=>"Scene Service"===e.type)),hasOGCFL:e.find((e=>"OGCFeatureServer"===e.type))},(s.derivativeLayers.hasMS||s.derivativeLayers.hasVTL||s.derivativeLayers.hasWFS||s.derivativeLayers.hasScene||s.derivativeLayers.hasOGCFL)&&(s.derivativeLayers.hasAny=!0))}if(y&&s.adminServiceInfo.capabilities.indexOf("Sync")>-1){const e=`${y.url}/replicas`;await u(e,{query:{f:"json"}}).then((e=>{var t;s.hasReplicas=(null===(t=e.data)||void 0===t?void 0:t.length)>0}))}this.status=m.SELECTION,this.reRender=!this.reRender,this.arcgisLayerViewStepChange.emit(1)}catch(e){console.error(e),this.status=m.ERROR,this.reRender=!this.reRender}else console.error("itemId is a required property.")}disconnectedCallback(){const{props:e}=this,{view:t,layer:i}=e;t.map.remove(i)}render(){const{status:e}=this;return(0,s.h)(s.H,null,e===m.ERROR?this.renderError():null,e===m.LOADING?this.renderLoading():null,[m.SELECTION,m.SWAP_SOURCE,m.BROWSE_LAYER].includes(e)?this.renderLayerSelection():null,[m.OVERVIEW,m.DEFINITION,m.FILTER].includes(e)?this.renderLayerOverview():null,e===m.CREATE?this.renderCreateView():null)}renderError(){const{props:e}=this,{viewItem:t,layerItem:i,strings:r}=e;return(0,s.h)("calcite-flow-item",{loading:!1,heading:(null==t?void 0:t.title)||(null==i?void 0:i.title)||r.msg.error,description:(null==t?void 0:t.title)||(null==i?void 0:i.title)?r.general.sourceLayer:void 0,class:p,ref:e=>this.panelNode=e},(0,s.h)("div",{class:g},(0,s.h)("calcite-notice",{scale:"s",width:"full",open:!0,icon:"exclamation-mark-triangle",kind:"danger"},(0,s.h)("div",{slot:"title"},r.msg.error),(0,s.h)("div",{slot:"message"},r.msg.initFailed))),(0,s.h)("div",{slot:"footer",class:u},(0,s.h)("calcite-button",{slot:"footer",onClick:this.goCancel,appearance:"transparent",width:"full"},r.general.cancel)))}renderLoading(){const{props:e}=this,{viewItem:t,layerItem:i,strings:r}=e;return(0,s.h)("calcite-flow-item",{loading:!0,heading:(null==t?void 0:t.title)||(null==i?void 0:i.title),description:r.general.sourceLayer,class:p,ref:e=>this.panelNode=e})}renderLayerSelection(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-selection",{key:`selection-${t}`,props:e,status:t})}renderLayerOverview(){const{props:e,status:t}=this,{definitionLayerId:i}=e;return(0,s.h)("arcgis-layer-view-overview",{key:`overview-${t}-${i}`,props:e,status:t})}renderCreateView(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-create",{key:`create-${t}`,props:e})}get hostElement(){return(0,s.d)(this)}};M.style=".sc-arcgis-layer-view-h{height:100%}.panel.sc-arcgis-layer-view{height:100%}.footer.sc-arcgis-layer-view{width:100%}.error-content.sc-arcgis-layer-view{margin:0.5rem}";const H=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewStatusChange=(0,s.c)(this,"arcgisLayerViewStatusChange",7),this.onBack=()=>{this.arcgisLayerViewStatusChange.emit({status:m.SWAP_SOURCE})},this.goSwapLayer=async e=>{const{props:t,flowItemNode:i,hostElement:s}=this,{strings:r}=t,a=this.items.find((t=>t.id===e));this.loading=!0;const n=await async function(e,t){var i,s,r,o,a;const{layerItem:n,layer:l,adminServiceInfo:d,modules:c,strings:h}=t,{Layer:p,PortalItem:u}=c;if(t.swapItem=t.swapLayer=void 0,n.id===e.id)return Promise.resolve("");const g=u.fromJSON(e);await g.load();const m=await p.fromPortalItem({portalItem:g});if(l.type!==m.type)return console.log("layer type does not match,",l.type,"!=",m.type),Promise.resolve(h.msg.swapErrors.layerType);if("group"===l.type?await m.loadAll():await m.load(),"group"===l.type){if(d.layers[0].capabilities.indexOf("Sync")>-1!=((null===(i=m.layers)||void 0===i?void 0:i.length)?m.layers:m.tables).getItemAt(0).sourceJSON.capabilities.indexOf("Sync")>-1)return console.log("new source layer Sync not matching"),Promise.resolve(h.msg.swapErrors.sync)}else if(d.capabilities.indexOf("Sync")>-1!=m.sourceJSON.capabilities.indexOf("Sync")>-1)return console.log("new source layer Sync not matching"),Promise.resolve(h.msg.swapErrors.sync);if("group"===l.type&&((null===(s=l.layers)||void 0===s?void 0:s.length)!==(null===(r=m.layers)||void 0===r?void 0:r.length)||(null===(o=l.tables)||void 0===o?void 0:o.length)!==(null===(a=m.tables)||void 0===a?void 0:a.length)))return console.log("layer sublayers count does not match"),Promise.resolve(h.msg.swapErrors.layerCount);if("group"===l.type){const e=k(l),i=k(m);for(let s=0;s<e.length;s++){const r=e.getItemAt(s),o=i.getItemAt(s);let a=x(r,o,t);if(a)return Promise.resolve(a);if(a=T(r,o,t),a)return Promise.resolve(a)}}else{let e=x(l,m,t);if(e)return Promise.resolve(e);if(e=T(l,m,t),e)return Promise.resolve(e)}return t.swapItem=e,t.swapLayer=m,Promise.resolve(null)}(a,this.props);if(n)this.loading=!1,this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=t,this.msgNode.flowItemElement=i,this.msgNode.isError=!0,this.msgNode.message=`${r.msg.cannotSwap} ${n}`,s.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(s.removeChild(this.msgNode),this.msgNode=void 0)}),7e3);else try{await async function(e){var t,i;let{layer:s,layerIds:r,modules:a}=e;const{PortalItem:n}=a,{view:l,swapItem:d,swapLayer:c}=e,[h]=await(0,o.l)(["esri/request"]);try{await async function(e,t){var i,s;const{layer:r,viewItem:o,adminServiceInfo:a}=e,n=r.portalItem,l=[];null===(i=null==a?void 0:a.layers)||void 0===i||i.forEach((e=>{l.push(e.id)}));const d=[];if(null===(s=null==a?void 0:a.tables)||void 0===s||s.forEach((e=>{d.push(e.id)})),l.length||d.length){const e=`${o.url.replace("rest/services","rest/admin/services")}/deleteFromDefinition`;await _(e,{layers:null==l?void 0:l.map((e=>({id:e}))),tables:null==d?void 0:d.map((e=>({id:e})))},n,t)}return new Promise((e=>{e()}))}(e,h);const o=n.fromJSON(d);await o.load(),e.layerItem=o,e.layer=c,e.swapItem=e.swapLayer=void 0;const p=e.viewItem;e.viewItem=void 0,e.adminServiceInfo=void 0,await F(e),await V(e,{serviceurl:p.url},h),e.viewItem=p,e.adminServiceInfo=void 0,await F(e),l.map.remove(s),s=e.layer,"group"===s.type?((null===(t=s.layers)||void 0===t?void 0:t.length)&&(r&&s.layers.forEach((e=>{e.visible=r.indexOf(e.layerId)>-1})),l.map.add(s)),null===(i=s.layers)||void 0===i||i.forEach((e=>{!e.popupTemplate&&e.popupEnabled&&(e.popupTemplate=e.createPopupTemplate())}))):(s.isTable||l.map.add(s),s.popupTemplate=s.createPopupTemplate()),k(e.adminServiceInfo).forEach((async t=>{var i,s,r,o;const n=t.viewDefinitionQuery;n&&S(n,t.id,e);const l=null===(o=null===(r=null===(s=null===(i=t.adminLayerInfo)||void 0===i?void 0:i.viewLayerDefinition)||void 0===s?void 0:s.table)||void 0===r?void 0:r.filter)||void 0===o?void 0:o.value;l&&C(l.geometry.rings?a.Polygon.fromJSON(l.geometry):a.Extent.fromJSON(l.geometry),t.id,e)}))}catch(e){return new Promise(((e,t)=>{t(new Error("swap source failed"))}))}}(this.props),this.loading=!1,this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=t,this.msgNode.flowItemElement=i,this.msgNode.message=r.msg.successSwap.replace("${source}",a.title),this.msgNode.closeWithOK=!0,this.msgNode.addEventListener("arcgisLayerViewMsgClosed",(()=>{this.msgNode=void 0,this.arcgisLayerViewStatusChange.emit({status:m.SELECTION})})),s.appendChild(this.msgNode)}catch(e){this.loading=!1,this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=t,this.msgNode.flowItemElement=i,this.msgNode.isError=!0,this.msgNode.message=r.msg.swapFailed,s.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(s.removeChild(this.msgNode),this.msgNode=void 0)}),7e3)}},this.props=void 0,this.reRender=!1,this.loading=!1,this.items=void 0,this.pagination=void 0,this.error=void 0}arcgisLayerViewMsgClosedHandler(){this.msgNode&&(this.hostElement.removeChild(this.msgNode),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0}async componentDidLoad(){setTimeout((()=>requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))),200)}render(){const{props:e,loading:t,hostElement:i}=this,{strings:r}=e,o="rtl"===(0,l.g)(i);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{heading:r.swapSource.browseForLayerTitle,description:r.swapSource.subTitle,loading:t,class:{panel:!0,[l.C.rtl]:o},onCalciteFlowItemBack:this.onBack,ref:e=>this.flowItemNode=e},this.renderItemBrowser()))}renderItemBrowser(){const{props:e,pagination:t}=this,{layer:i,sourceItemId:r,strings:o}=e,{portalItem:a}=i,{portal:n}=a,l=n.user,c=`type:"Feature Service" typekeywords:"Hosted Service" -typekeywords:"View Service" owner:"${l.username}" -id:${r}`,h=`${(0,d.g)(n)}/home/`;return(0,s.h)("arcgis-item-browser",{onArcgisItemBrowserUpdate:e=>{const{results:t,num:i,start:s,total:r}=e.detail;this.items=t,this.pagination={start:s,num:i,total:r}},filter:c,portal:n,user:l,api:4,config:{baseUrl:h},selection:"none"},(0,s.h)("arcgis-item-browser-top-bar",{slot:"top-bar"},(0,s.h)("arcgis-item-browser-search",{slot:"search",term:""})),(0,s.h)("arcgis-item-browser-sort",{options:["modified","title","relevance"],slot:"sort"}),(0,s.h)("arcgis-item-browser-content",{slot:"content"},(this.items||[]).map((e=>(0,s.h)("arcgis-item-browser-card",{item:e,portal:n,baseUrl:h,key:e.id},(0,s.h)("calcite-action",{id:`swap-action-${e.id}`,icon:"arrow-right-left",text:"",scale:"s",slot:"actions-end",onClick:this.goSwapLayer.bind(this,e.id)},(0,s.h)("calcite-tooltip",{slot:"tooltip",label:o.general.swapSource,overlayPositioning:"fixed"},o.general.swapSource)))))),(0,s.h)("arcgis-item-browser-pagination",{total:null==t?void 0:t.total,start:null==t?void 0:t.start,num:null==t?void 0:t.num,slot:"pagination"}))}get hostElement(){return(0,s.d)(this)}};H.style=".panel.sc-arcgis-layer-view-browse-layer{height:100%}";const q=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewStatusChange=(0,s.c)(this,"arcgisLayerViewStatusChange",7),this.arcgisLayerViewCreateDone=(0,s.c)(this,"arcgisLayerViewCreateDone",7),this.arcgisLayerViewCreateCancel=(0,s.c)(this,"arcgisLayerViewCreateCancel",7),this.goBack=()=>{const{props:e}=this;e.savedItemProps={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder},this.arcgisLayerViewStatusChange.emit({status:m.OVERVIEW})},this.goCreate=async()=>{const{props:e,flowItemNode:t,hostElement:i}=this,{strings:s}=e;e.savedItemProps={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder};const r={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder};this.loading=!0;try{this.viewItemId=await async function(e,t){const[i]=await(0,o.l)(["esri/request"]);try{const s=await async function(e,t,i){var s,r,o;const{layer:a,layerIds:n}=e,l=a.portalItem,d=l.portal;let c=N(n[0],e);const h=`${d.restUrl}/content/users/${l.owner}/createService`,p={name:t.title.replace(/ /g,"_"),isView:!0,sourceSchemaChangesAllowed:!0,isUpdatableView:!0,spatialReference:null===(s=c.sourceJSON.extent)||void 0===s?void 0:s.spatialReference,initialExtent:c.sourceJSON.extent,capabilities:"Query",preserveLayerIds:!0};if(d.isPortal){const t=function(e){var t,i,s,r;const{adminServiceInfo:o}=e,a=(null===(i=null===(t=null==o?void 0:o.adminServiceInfo)||void 0===t?void 0:t.database)||void 0===i?void 0:i.datasource)||{};return(null===(s=null==a?void 0:a.name)||void 0===s?void 0:s.indexOf("/nosqlDatabases"))>-1?"spatiotemporal":(null===(r=null==a?void 0:a.name)||void 0===r?void 0:r.indexOf("/enterpriseDatabases"))>-1?"relational":null}(e);t&&(p.options={dataSourceType:t})}let u={createParameters:JSON.stringify(p),outputType:"featureService",tags:(null===(r=t.tags)||void 0===r?void 0:r.length)?t.tags.toString():void 0,snippet:t.summary,categories:null===(o=t.categories)||void 0===o?void 0:o.join(","),isView:!0};try{return(await i(h,{query:Object.assign(Object.assign({},u),{f:"json",token:d.credential.token}),method:"post",responseType:"json"})).data}catch(e){return new Promise(((t,i)=>{e.message.indexOf(" already exists ")>-1?i(new Error("service name already exists")):i(new Error("create service failed"))}))}}(e,t,i);return await V(e,s,i),await async function(e,t,i,s){var r,o,a,n,l,d,c,h,p,u,g,m,y,f;const{layer:v,layerIds:w}=e,I=v.portalItem,b=I.portal,L=await v.portalItem.fetchData(),E=(null==L?void 0:L.layers)||(null==L?void 0:L.tables);E&&(L.layers=null===(r=L.layers)||void 0===r?void 0:r.filter((e=>w.indexOf(e.id)>-1)),L.tables=null===(o=L.tables)||void 0===o?void 0:o.filter((e=>w.indexOf(e.id)>-1)),"group"===v.type&&(null===(a=v.layers)||void 0===a?void 0:a.length)&&(L.layers=L.layers||void 0),"group"===v.type&&(null===(n=v.tables)||void 0===n?void 0:n.length)&&(L.tables=L.tables||void 0),null===(l=L.layers)||void 0===l||l.forEach((e=>{e.layerDefinition&&(e.layerDefinition.definitionExpression=void 0)})),null===(d=L.tables)||void 0===d||d.forEach((e=>{e.layerDefinition&&(e.layerDefinition.definitionExpression=void 0)})));const N=`${b.restUrl}/content/users/${I.owner}/items/${t.itemId}/update`,S={title:i.title,tags:(null===(c=i.tags)||void 0===c?void 0:c.length)?i.tags.toString():void 0,snippet:i.summary,categories:null===(h=i.categories)||void 0===h?void 0:h.join(",")};return E&&(S.text=JSON.stringify(L)),("group"===v.type&&(null===(m=null===(g=null===(u=null===(p=v.layers)||void 0===p?void 0:p.getItemAt(0))||void 0===u?void 0:u.fullExtent)||void 0===g?void 0:g.spatialReference)||void 0===m?void 0:m.wkt)||"feature"===v.type&&(null===(f=null===(y=v.fullExtent)||void 0===y?void 0:y.spatialReference)||void 0===f?void 0:f.wkt))&&setTimeout((()=>{const e={extent:`${I.extent.xmin},${I.extent.ymin},${I.extent.xmax},${I.extent.ymax}`};s(N,{query:Object.assign(Object.assign({},e),{f:"json",token:b.credential.token}),method:"post",responseType:"json"})}),7e3),await s(N,{query:Object.assign(Object.assign({},S),{f:"json",token:b.credential.token}),method:"post",responseType:"json"})}(e,s,t,i),await async function(e,t,i,s){const{layer:r}=e,o=r.portalItem,{portal:a}=o;if(!i.folder||!i.folder.id||i.folder.id===o.owner)return;const n=`${a.restUrl}/content/users/${o.owner}/items/${t.itemId}/move`,l={folder:i.folder.id};return await s(n,{query:Object.assign(Object.assign({},l),{f:"json",token:a.credential.token}),method:"post",responseType:"json"})}(e,s,t,i),s.itemId}catch(e){return new Promise(((t,i)=>{"service name already exists"===e.message?i(e):i(new Error("createView failed"))}))}}(e,r),this.loading=!1,this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=e,this.msgNode.flowItemElement=t,this.msgNode.message=s.msg.created,i.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(i.removeChild(this.msgNode),this.msgNode=void 0,this.arcgisLayerViewCreateDone.emit(this.viewItemId))}),7e3)}catch(e){const{props:t,flowItemNode:s}=this,{strings:r}=t;this.loading=!1,console.error("could not create view",e),this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=t,this.msgNode.flowItemElement=s,this.msgNode.isError=!0,e.message,this.msgNode.message=r.msg.createFailed,i.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(i.removeChild(this.msgNode),this.msgNode=void 0)}),7e3)}},this.goCancel=()=>{this.arcgisLayerViewCreateCancel.emit()},this.props=void 0,this.reRender=!1,this.loading=!1,this.title=void 0}arcgisLayerViewMsgClosedHandler(){this.msgNode&&(this.hostElement.removeChild(this.msgNode),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0,this.viewItemId&&this.arcgisLayerViewCreateDone.emit(this.viewItemId)}async componentWillLoad(){const{props:e}=this;this.title=await async function(e){var t,i;const{layerItem:s,layer:r,strings:a}=e,[n]=await(0,o.l)(["esri/request"]),l=`${s.itemUrl}/relatedItems`,d=await n(l,{query:Object.assign(Object.assign({},{relationshipType:"Service2Service",direction:"forward"}),{f:"json",token:r.portalItem.portal.credential.token}),method:"post",responseType:"json"}),c=(null===(i=null===(t=null==d?void 0:d.data)||void 0===t?void 0:t.relatedItems)||void 0===i?void 0:i.filter((e=>"Feature Service"===e.type&&(e.title.indexOf(s.title)>-1||e.title.indexOf(s.title.replace(/ /g,"_"))>-1||e.title.replace(/ /g,"_").indexOf(s.title)>-1))))||[];return`${s.title}${c.length?` ${c.length+1}`:""} ${a.createView.view}`}(e)}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.backButtonNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e,loading:t}=this,{viewItem:i,layerItem:r,strings:o}=e,a="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{heading:o.createView.create,description:(null==i?void 0:i.title)||(null==r?void 0:r.title),loading:t,class:{panel:!0,[l.C.rtl]:a},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderInfo()))}renderFooterButtons(){return(0,s.h)("div",{slot:"footer",class:"footer"},this.renderBack(),this.renderCreate(),(0,s.h)("br",null),this.renderCancel())}renderBack(){const{props:e}=this,{strings:t}=e,i="rtl"===(0,l.g)(this.hostElement);return(0,s.h)("calcite-button",{onClick:this.goBack,appearance:"outline-fill",width:"half","icon-start":i?"arrow-right":"arrow-left",ref:e=>this.backButtonNode=e},t.general.back)}renderCreate(){const{props:e,title:t,titleError:i,summaryError:r}=this,{layer:o,layerIds:a,strings:n}=e,l=(null==o?void 0:o.loaded)&&a.length&&t&&!i&&!r;return(0,s.h)("calcite-button",{disabled:!l,onClick:l&&this.goCreate,appearance:"solid",width:"half","icon-start":"plus-square",ref:e=>this.createButtonNode=e},n.createView.create)}renderCancel(){const{props:e}=this,{layer:t,layerIds:i,strings:r}=e,o=(null==t?void 0:t.loaded)&&i.length;return(0,s.h)("calcite-button",{disabled:!o,onClick:o&&this.goCancel,appearance:"transparent",width:"full"},r.general.cancel)}renderInfo(){const{props:e,title:t}=this,{layer:i,layerItemOwner:r,savedItemProps:o}=e,{portalItem:a}=i,{portal:n}=a,l=n.user,d={portal:n,user:l,api:4};return o?(c.i.title=o.title,c.i.folder=o.folder,c.i.snippet=o.summary||"",c.i.categories=o.categories,c.i.tags=o.tags):(c.i.title=t,c.i.folder=a.ownerFolder&&{id:a.ownerFolder,username:a.owner},c.i.snippet=a.snippet||"",c.i.categories=a.categories,c.i.tags=a.tags),(0,s.h)("div",{class:"info"},(0,s.h)("arcgis-item-properties",{portal:n,user:l,api:4,config:d,type:"Feature Service",scale:"s"},(0,s.h)("arcgis-title-input",{enablePublishing:!0,onArcgisTitleInputChange:async e=>{const t=e.target,i=await t.validateTitle();(!this.titleError&&i||this.titleError&&!i)&&(this.reRender=!this.reRender),this.titleError=i}}),(0,s.h)("arcgis-folder-picker",{user:r}),(0,s.h)("arcgis-categories-picker",null),(0,s.h)("arcgis-tags-picker",null),(0,s.h)("arcgis-summary-input",{onArcgisSummaryInputChange:async e=>{const t=e.target,i=await t.getErrorMessage();(!this.summaryError&&i||this.summaryError&&!i)&&(this.reRender=!this.reRender),this.summaryError=i}})))}get hostElement(){return(0,s.d)(this)}};q.style=".panel.sc-arcgis-layer-view-create{height:100%}.info.sc-arcgis-layer-view-create{display:grid;grid-template-columns:repeat(1, minmax(0px, 1fr));gap:0.5rem;padding:1rem 0.75rem}.footer.sc-arcgis-layer-view-create{width:100%}";const U=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewOverViewRefresh=(0,s.c)(this,"arcgisLayerViewOverViewRefresh",7),this.aoiSymbol={type:"simple-fill",style:"solid",color:[0,0,0,0],outline:{type:"simple-line",style:"solid",color:[255,0,0,255],width:2}},this.onBack=()=>{this.arcgisLayerViewOverViewRefresh.emit()},this.goFilter=()=>{var e;(null===(e=this.aoiBlockNode)||void 0===e?void 0:e.open)&&(this.aoiBlockNode.open=!1,this.onAOIToggle()),this.status=m.FILTER,this.reRender=!this.reRender},this.onBackFilter=()=>{this.status=m.DEFINITION,this.reRender=!this.reRender,setTimeout((()=>{var e;return null===(e=this.filterActionNode)||void 0===e?void 0:e.setFocus()}),200)},this.onPolygonClick=e=>{const{props:t}=this,{strings:i}=t,s=e.target;s.active||(this.sketchViewModel.cancel(),this.sketchViewModel.create("polygon"),s.active=!0,this.rectangleAction.active=!1,this.drawLabel.innerHTML=i.defineView.aoiPolygonDraw)},this.onRectangleClick=e=>{const{props:t}=this,{strings:i}=t,s=e.target;s.active||(this.sketchViewModel.cancel(),this.sketchViewModel.create("rectangle"),s.active=!0,this.polygonAction.active=!1,this.drawLabel.innerHTML=i.defineView.aoiRectangleDraw)},this.onDeleteAOIClick=()=>{const{props:e}=this,{definitionLayerId:t,strings:i}=e;this.sketchViewModel.cancel(),this.graphicsLayer.removeAll();const s=b(t,e);s&&(s.aoi=void 0),L(e),C(void 0,t,e),this.drawLabel.innerHTML=i.defineView.aoiSelect,this.polygonAction.disabled=!1,this.rectangleAction.disabled=!1,this.aoiBlockNode.description=i.defineView.aoiSubtext,this.reRender=!this.reRender},this.onGraphicUpdate=e=>{const{props:t}=this,{view:i,definitionLayerId:s}=t;if(i.closePopup(),"complete"===e.state){const i=e.graphics[0],r=i.geometry.extent,o=i.geometry.rings[0];let a=!1;5===o.length&&o.indexOf([r.xmin,r.ymin])>-1&&o.indexOf([r.xmax,r.ymax])>-1&&(a=!0),E(s,{aoi:this.rectangleAction.active&&a?r.toJSON():i.geometry.toJSON()},t),C(i.geometry,s,t),this.rectangleAction.active&&!a&&(this.reRender=!this.reRender)}},this.selectFields=e=>{const{props:t,totalFields:i,requiredFieldNames:s}=this,{view:r,definitionLayerId:o}=t,a=b(o,t);let n=[];n=(null==a?void 0:a.fields)?a.fields:i.filter((e=>-1===s.indexOf(e.name))).map((e=>e.name)),this.closeLayerViewDefinitionPopoversHandler();const l=this.flowItemNode.getBoundingClientRect().width;this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps={placement:"auto",offsetDistance:-1*(l?l-5:215),offsetSkidding:0,pointerDisabled:!0,popoverWidth:l?l+30:280,refElement:this.flowItemNode},this.arcgisFieldPickList.fields=this.createPickListFields(e),this.arcgisFieldPickList.layer=e,this.arcgisFieldPickList.mapView=r,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!1,this.arcgisFieldPickList.selectedFields=n,this.arcgisFieldPickList.multiple=!0,this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed",this.fieldPickListChanges),document.body.appendChild(this.arcgisFieldPickList),this.flowItemNode.disabled=!0},this.fieldPickListChanges=e=>{var t;e.stopPropagation();const{props:i,requiredFieldNames:s}=this,{definitionLayerId:r}=i,o=null===(t=e.detail)||void 0===t?void 0:t.selectedFields;if(this.removeFieldsPickList(),o){const e=P(r,i),t=(null==e?void 0:e.fields)||N(r,i).fields,a=t.filter((e=>s.indexOf(e.name)>-1||o.indexOf(e.name)>-1)).map((e=>e.name));if(a.length<t.length)E(r,{fields:a},i);else{let e=b(r,i);e&&(e.fields=void 0),L(i)}this.reRender=!this.reRender}},this.removeField=e=>{const{props:t,totalFields:i}=this,{definitionLayerId:s}=t;let r=b(s,t);r||(r={layerId:s},t.viewProps=t.viewProps||[],t.viewProps.push(r)),r.fields||(r.fields=i.map((e=>e.name))),r.fields.splice(r.fields.indexOf(e),1),this.reRender=!this.reRender},this.props=void 0,this.status=void 0,this.reRender=!1,this.loading=!1}closeLayerViewDefinitionPopoversHandler(){this.removeFieldsPickList()}async componentWillLoad(){var e;const{props:t}=this,{definitionLayerId:i}=t;this.fl=N(i,t),this.adminLayerInfo=P(i,t),this.totalFields=(null===(e=this.adminLayerInfo)||void 0===e?void 0:e.fields)||N(i,t).fields,this.requiredFieldNames=I(t)}async componentDidLoad(){setTimeout((()=>requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))),200)}disconnectedCallback(){this.removeSketchViewModel()}render(){const{props:e,status:t}=this,{definitionLayerId:i,strings:r}=e,o=N(i,e),a="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{heading:r.defineView.definitions,description:o.title,class:{panel:!0,[l.C.rtl]:a},onCalciteFlowItemBack:this.onBack,ref:e=>this.flowItemNode=e},this.renderInfo(),this.renderFilter(),this.renderAOI(),this.renderFields()),t===m.FILTER?this.renderLayerFilter():null)}renderInfo(){const{props:e}=this,{config:t,strings:i}=e,{helpBase:r,helpMap:o}=t;return(0,h.g)(h.l.ARCGIS_COMPONENT_NOTIFICATIONS,h.a.LAYER_VIEW_DEFINITION_DISMISSED)?null:(0,s.h)("calcite-notice",{class:"notice",open:!0,closable:!0,scale:"s",width:"auto",onCalciteNoticeClose:()=>{(0,h.s)(h.l.ARCGIS_COMPONENT_NOTIFICATIONS,{key:h.a.LAYER_VIEW_DEFINITION_DISMISSED,value:"true"})}},(0,s.h)("div",{slot:"title"},i.defineView.addDefinitions),(0,s.h)("div",{slot:"message"},i.defineView.addDefinitionsMsg),(0,s.h)("calcite-link",{slot:"link",title:i.defineView.moreAboutViews,target:"_blank",href:`${r}${o[120002839]}`},i.defineView.moreAboutViews))}renderFilter(){const{props:e}=this,{definitionLayerId:t,strings:i}=e,r=b(t,e),o="rtl"===(0,l.g)(this.hostElement);return(0,s.h)("calcite-block",{heading:(null==r?void 0:r.filter)?i.defineView.editFilter:i.defineView.addFilter,collapsible:!1,class:"filter-block",tabIndex:0,onClick:this.goFilter},(0,s.h)("calcite-icon",{slot:"icon",icon:"filter",scale:"s"}),(0,s.h)("calcite-action",{slot:"control",icon:o?"chevron-left":"chevron-right",class:"filter-chevron",scale:"s",text:(null==r?void 0:r.filter)?i.defineView.editFilter:i.defineView.addFilter,ref:e=>this.filterActionNode=e}))}renderAOI(){const{props:e,fl:t}=this,{definitionLayerId:i,strings:r}=e;if(t.isTable)return null;const o=b(i,e);return(0,s.h)("calcite-block",{heading:r.defineView.areaOfInterest,description:(null==o?void 0:o.aoi)?void 0:r.defineView.aoiSubtext,collapsible:!0,onCalciteBlockToggle:()=>this.onAOIToggle(),ref:e=>this.aoiBlockNode=e},(0,s.h)("calcite-icon",{slot:"icon",icon:"polygon",scale:"s"}),this.renderAOIContent())}renderAOIContent(){const{props:e}=this,{definitionLayerId:t,layerIds:i,strings:r}=e,o=b(t,e),a=!!(null==o?void 0:o.aoi);return(0,s.h)("div",null,(0,s.h)("calcite-action-group",{layout:"grid",class:"aoi-group"},(0,s.h)("calcite-action",{icon:"polygon",appearance:"solid",alignment:"center",active:!1,disabled:a,scale:"s",text:r.defineView.aoiSketchPolygonLabel,title:r.defineView.aoiSketchPolygonLabel,onClick:a?void 0:this.onPolygonClick,ref:e=>this.polygonAction=e}),(0,s.h)("calcite-action",{icon:"rectangle",appearance:"solid",alignment:"center",active:!1,disabled:a,scale:"s",text:r.defineView.aoiSketchRectangleLabel,title:r.defineView.aoiSketchRectangleLabel,onClick:a?void 0:this.onRectangleClick,ref:e=>this.rectangleAction=e}),(0,s.h)("calcite-action",{icon:"trash",appearance:"solid",alignment:"center",scale:"s",disabled:!a,text:r.defineView.aoiDeleteLabel,title:r.defineView.aoiDeleteLabel,onClick:a?this.onDeleteAOIClick:void 0})),(0,s.h)("div",{class:"text-center",ref:e=>this.drawLabel=e},a?r.defineView.aoiRestart:r.defineView.aoiSelect),i.length>1?(0,s.h)("calcite-button",{appearance:"transparent",width:"full",class:"aoi-button",onClick:()=>this.applyAOIToAll()},r.defineView.aoiApplyAll):null)}renderFields(){var e;const{props:t,totalFields:i}=this,{definitionLayerId:r,strings:o}=t,a=b(r,t),n=i.length,l=(null===(e=null==a?void 0:a.fields)||void 0===e?void 0:e.length)||n;return(0,s.h)("calcite-block",{heading:o.defineView.fields,description:`${l}/${n}`,collapsible:!0},(0,s.h)("calcite-icon",{slot:"icon",icon:"feature-details",scale:"s"}),this.renderFieldsContent())}renderFieldsContent(){const{props:e,fl:t,requiredFieldNames:i,totalFields:r}=this,{definitionLayerId:o,strings:a}=e,n=b(o,e);let l;l=(null==n?void 0:n.fields)?r.filter((e=>n.fields.indexOf(e.name)>-1||i.indexOf(e.name)>-1)):r;const d=i.length!==r.length,c=l.map((e=>(0,s.h)("calcite-list-item",{label:e.alias||e.name},-1===i.indexOf(e.name)?(0,s.h)("calcite-action",{icon:"x",scale:"s",text:a.general.remove,slot:"actions-end",onClick:()=>this.removeField(e.name)}):null)));return(0,s.h)("div",null,d&&(0,s.h)("calcite-button",{class:"select-fields",appearance:"outline-fill",round:!0,label:a.defineView.selectFields,scale:"s",width:"full",onClick:()=>this.selectFields(t),ref:e=>this.buttonNode=e},a.defineView.selectFields),(0,s.h)("calcite-list",null,c))}renderLayerFilter(){const{props:e,fl:t}=this,{view:i,definitionLayerId:r}=e,o=b(r,this.props);return(0,s.h)("arcgis-filter",{key:`filter-${r}`,view:i,layer:t,mode:"layer-view",viewFilter:null==o?void 0:o.filter,dismissible:!1,hideLayerTitle:!1,onArcgisFilterPanelBackClick:this.onBackFilter,onArcgisFilterWhereChange:e=>this.applyFilter(e.detail)})}async applyFilter(e){const{props:t}=this,{definitionLayerId:i}=t;if(e)E(i,{filter:e},t);else{const e=b(i,t);e&&(e.filter=void 0),L(t)}}async onAOIToggle(){if(this.aoiBlockNode.open){if(!this.SketchViewModel){this.aoiBlockNode.loading=!0;const[e,t,i,s,r]=await(0,o.l)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/Graphic","esri/geometry/Polygon","esri/geometry/Extent"]);this.SketchViewModel=e,this.GraphicsLayer=t,this.Graphic=i,this.Polygon=s,this.Extent=r,this.aoiBlockNode.loading=!1}this.setupSketchViewModel()}else this.removeSketchViewModel()}setupSketchViewModel(){const{props:e,aoiSymbol:t}=this,{layer:i,view:s,definitionLayerId:r}=e;if(this.defaultAutoOpenEnabled=s.popupEnabled,s.popupEnabled=!1,this.graphicsLayer)return;this.graphicsLayer=new this.GraphicsLayer,s.map.add(this.graphicsLayer);const o=b(r,e);if(null==o?void 0:o.aoi){const e=o.aoi,i=e.rings?this.Polygon.fromJSON(e):new this.Polygon({rings:[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]],spatialReference:o.aoi.spatialReference}),s=new this.Graphic({geometry:i,symbol:t});this.graphicsLayer.add(s)}this.sketchViewModel=new this.SketchViewModel({layer:this.graphicsLayer,view:s,polygonSymbol:t,updateOnGraphicClick:!0}),this.sketchViewModel.on("create",(e=>this.onGraphicCreate(e))),this.sketchViewModel.on("update",this.onGraphicUpdate);const a="group"===i.type?i.layers.map((e=>({layer:e}))):[{layer:i}];this.sketchViewModel.snappingOptions.featureSources=a,this.sketchViewModel.snappingOptions.enabled=!0}removeSketchViewModel(){var e,t;const{props:i,defaultAutoOpenEnabled:s}=this,{view:r}=i;this.graphicsLayer&&r.map.remove(this.graphicsLayer),null===(e=this.graphicsLayer)||void 0===e||e.destroy(),this.graphicsLayer=void 0,null===(t=this.sketchViewModel)||void 0===t||t.destroy(),this.sketchViewModel=void 0,r.popupEnabled=s}onGraphicCreate(e){const{props:t}=this,{definitionLayerId:i,strings:s}=t;if("start"===e.state&&this.polygonAction.active&&(this.drawLabel.innerHTML=s.defineView.aoiPolygonEnd),"complete"===e.state){const r=e.graphic,o=r.geometry.extent;E(i,{aoi:this.polygonAction.active?r.geometry.toJSON():o.toJSON()},t),C(r.geometry,i,t),this.drawLabel.innerHTML=s.defineView.aoiRestart,this.polygonAction.active=!1,this.rectangleAction.active=!1,this.polygonAction.disabled=!0,this.rectangleAction.disabled=!0,this.aoiBlockNode.description=void 0,this.reRender=!this.reRender}}applyAOIToAll(){const{props:e}=this,{definitionLayerId:t,layer:i}=e;if("group"!==i.type)return;const s=b(t,e);i.layers.map((i=>{if(i.layerId!==t){if(null==s?void 0:s.aoi)E(i.layerId,{aoi:JSON.parse(JSON.stringify(s.aoi))},e);else{const t=b(i.layerId,e);t&&(t.aoi=void 0),L(e)}(null==s?void 0:s.aoi)?C(s.aoi.rings?this.Polygon.fromJSON(s.aoi):this.Extent.fromJSON(s.aoi),i.layerId,e):C(void 0,i.layerId,e)}}))}createPickListFields(e){const{requiredFieldNames:t,props:i}=this,s=P(e.layerId,i);return((null==s?void 0:s.fields)||N(e.layerId,i).fields).filter((e=>-1===t.indexOf(e.name))).map((e=>({name:e.name,alias:e.alias||e.name,type:e.type})))}removeFieldsPickList(){this.flowItemNode.disabled=!1,this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null,setTimeout((()=>{this.buttonNode.setFocus()}),1))}get hostElement(){return(0,s.d)(this)}};var W;function G(e,t){var i;const{fields:s,popupTemplate:r}=e,o=null==r?void 0:r.fieldInfos,a=s.find((e=>t===e.name));return a&&(null===(i=null==o?void 0:o.find((e=>e.fieldName===a.name)))||void 0===i?void 0:i.label)||(null==a?void 0:a.alias)||t}function z(e,t){const{fields:i}=e,s=i.find((e=>t===e.name));return null==s?void 0:s.type}function Y(e,t){const{strings:i}=t;return e.isTable?i.general.table:"point"===e.geometryType||"multipoint"===e.geometryType?i.join.pointLayer:"polyline"===e.geometryType?i.join.polylineLayer:"polygon"===e.geometryType?i.join.polygonLayer:""}function K(e){var t,i;return e.sourceJSON.ownershipBasedAccessControlForFeatures&&(!1===(null===(t=e.sourceJSON.ownershipBasedAccessControlForFeatures)||void 0===t?void 0:t.allowAnonymousToQuery)||!1===(null===(i=e.sourceJSON.ownershipBasedAccessControlForFeatures)||void 0===i?void 0:i.allowOthersToQuery))}async function Q(e,t,i,s=!1){const{modules:r}=i,{esriRequest:o,IdentityManager:a}=r,n=a.findCredential(e),l={addToDefinition:JSON.stringify(t)};try{return await o(e,{query:Object.assign(Object.assign({},l),{f:"json",token:n.token}),method:"post",responseType:"json"}),new Promise((e=>{e()}))}catch(r){return s?new Promise(((e,t)=>{t(new Error("addToDefinition request failed"))})):Q(e,t,i,!0)}}function X(e,t){const{targetItem:i}=t,{portal:s}=i,r=e.indexOf("/services/")+10;var o=e.substring(r,e.indexOf("/FeatureServer",r));return s.isPortal&&(o=o.replace("Hosted/","")),o}async function Z(e,t){const{targetLayer:i,adminServiceInfo:s,modules:r}=e,{IdentityManager:o,esriRequest:a}=r;if(s)return;let n=i.portalItem.url.replace("/rest/services","/rest/admin/services");t&&(n+=`${n.indexOf("?")>-1?"&":"?"}_ts=${(new Date).getTime()}`);try{await o.getCredential(n);const t=await a(n,{query:{f:"json"}});e.adminServiceInfo=t.data}catch(e){return new Promise(((e,t)=>{t(new Error("could not get admin info"))}))}}async function ee(e,t,i){const s={indexes:[]};e.sourceJSON.indexes=e.sourceJSON.indexes||[],t.forEach((t=>{e.sourceJSON.indexes.some((e=>e.fields===t))||s.indexes.push({name:`${t}_Index`,fields:t,isUnique:!1,isAscending:!0,description:`${t}_Index`})})),s.indexes.length&&await async function(e,t,i){var s;const{targetItem:r,modules:o}=i,{IdentityManager:a}=o,n=`${t.url.replace("/rest/services","/rest/admin/services")}/${t.layerId}/addToDefinition`,l=a.findCredential(n),d=r.portal.isPortal,c={f:"json",addToDefinition:JSON.stringify(e),async:!d,token:l.token},h=await o.esriRequest(n,{query:c,method:"post"});if(d)t.sourceJSON.indexes=t.sourceJSON.indexes||[],t.sourceJSON.indexes=t.sourceJSON.indexes.concat(e.indexes);else try{await te(null===(s=null==h?void 0:h.data)||void 0===s?void 0:s.statusURL,{f:"json",token:l.token},i),t.sourceJSON.indexes=t.sourceJSON.indexes||[],t.sourceJSON.indexes=t.sourceJSON.indexes.concat(e.indexes)}catch(e){}}(s,e,i)}U.style=".panel.sc-arcgis-layer-view-definition{height:100%}.hook.sc-arcgis-layer-view-definition{height:1px}.notice.sc-arcgis-layer-view-definition{margin:8px}.filter-block.sc-arcgis-layer-view-definition{cursor:pointer}.filter-block.sc-arcgis-layer-view-definition:hover{background-color:var(--calcite-ui-foreground-2)}.filter-chevron.sc-arcgis-layer-view-definition{margin-right:0.5rem}.arcgis--rtl.sc-arcgis-layer-view-definition .filter-chevron.sc-arcgis-layer-view-definition{margin-left:0.5rem;margin-right:auto}.aoi-group.sc-arcgis-layer-view-definition{width:100%;margin-bottom:0.75rem}.aoi-button.sc-arcgis-layer-view-definition{margin-top:0.75rem;border-top-width:1px;border-top-style:solid;border-top-color:var(--calcite-ui-border-3)}.text-center.sc-arcgis-layer-view-definition{text-align:center}.select-fields.sc-arcgis-layer-view-definition{margin:0 0 5px 0}",function(e){e[e.ERROR=0]="ERROR",e[e.LOADING=1]="LOADING",e[e.TARGET_SELECTION=2]="TARGET_SELECTION",e[e.ADD_SELECTION=3]="ADD_SELECTION",e[e.BROWSE_LAYER=4]="BROWSE_LAYER",e[e.CONFIG=5]="CONFIG",e[e.CREATE=6]="CREATE"}(W||(W={}));const te=async(e,t,i)=>{var s;const{modules:r}=i;if(!e)throw new Error("pollForStatus: no status URL");const o=["processing","partial","Pending","InProgress"],a=["completed","Completed"];try{const l=await r.esriRequest(e,{query:t}),d=null===(s=null==l?void 0:l.data)||void 0===s?void 0:s.status;if(o.includes(d))return await(0,n.t)(500),te(e,t,i);if(a.includes(d))return l;throw l}catch(e){throw console.error(e),e}},ie=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinCancel=(0,s.c)(this,"arcgisLayerViewJoinCancel",7),this.arcgisLayerViewJoinTableClick=(0,s.c)(this,"arcgisLayerViewJoinTableClick",7),this.arcgisLayerViewJoinStepChange=(0,s.c)(this,"arcgisLayerViewJoinStepChange",7),this.arcgisLayerViewJoinCreated=(0,s.c)(this,"arcgisLayerViewJoinCreated",7),this.status=W.LOADING,this.goCancel=()=>{this.arcgisLayerViewJoinCancel.emit()},this.view=void 0,this.itemId=void 0,this.config=void 0,this.showTableOption=!1}arcgisLayerViewStatusHandler(e){const{detail:t}=e;this.status=t.status,this.status===W.TARGET_SELECTION?this.arcgisLayerViewJoinStepChange.emit(1):this.status===W.ADD_SELECTION?this.arcgisLayerViewJoinStepChange.emit(2):this.status===W.CONFIG?this.arcgisLayerViewJoinStepChange.emit(3):this.status===W.CREATE&&this.arcgisLayerViewJoinStepChange.emit(4),(0,s.f)(this.hostElement)}async arcgisLayerViewJoinCreateDoneHandler(e){this.arcgisLayerViewJoinCreated.emit(e.detail)}arcgisLayerViewJoinCreateCancelHandler(){this.arcgisLayerViewJoinCancel.emit()}async setStep(e){var t,i;const{props:r}=this,{targetLayerId:o,addLayerId:n,attributeRelationships:l,joinOperation:d}=r,c=(0,a.i)(o),h=(0,a.i)(n),p=(null==l?void 0:l.find((e=>e.targetFieldName&&e.addFieldName)))&&d&&("first"===d.matchType&&d.sortByFieldName&&d.sortOrder||"summarize"===d.matchType&&(null===(t=d.statisticsFields)||void 0===t?void 0:t.length)&&(null===(i=d.statisticsFields)||void 0===i?void 0:i[0].fieldName));switch(document.body.querySelectorAll(".js-app-flyout").forEach((e=>{document.body.removeChild(e)})),e){case 1:return this.status=W.TARGET_SELECTION,(0,s.f)(this.hostElement),new Promise((e=>e(!0)));case 2:if(c)return this.status=W.ADD_SELECTION,(0,s.f)(this.hostElement),new Promise((e=>e(!0)));break;case 3:if(h)return this.status=W.CONFIG,(0,s.f)(this.hostElement),new Promise((e=>e(!0)));break;case 4:if(p)return this.status=W.CREATE,(0,s.f)(this.hostElement),new Promise((e=>e(!0)))}return new Promise((e=>e(!1)))}async componentWillLoad(){var e,t,i,s;const{itemId:a,view:n,showTableOption:l,config:d}=this,[c]=await(0,r.g)(this.hostElement,"arcgis-layer-view");this.strings=c,this.props={config:d,view:n,itemId:a,showTableOption:l,strings:c,modules:{}};let{props:h}=this;if(a)try{const[r,l,d,c,p,u,g]=await(0,o.l)(["esri/portal/PortalItem","esri/layers/Layer","esri/geometry/Extent","esri/geometry/projection","esri/geometry/Polygon","esri/request","esri/identity/IdentityManager"]);h.modules={PortalItem:r,projection:c,Polygon:p,Extent:d,Layer:l,esriRequest:u,IdentityManager:g};const m=new r({id:a});if(await m.load(),h.targetItemOwner=m.portal.user,m.portal.user.username!==m.owner&&await u(`${m.portal.restUrl}/community/users/${m.owner}`,{query:{f:"json"}}).then((e=>{(null==e?void 0:e.data)&&(h.targetItemOwner=e.data)})),"Feature Service"!==m.type)return console.error("Only Feature Service items are allowed."),void(this.status=W.ERROR);if(-1===(null===(e=m.typeKeywords)||void 0===e?void 0:e.indexOf("Hosted Service")))return console.error("Only hosted Feature Service items are allowed."),void(this.status=W.ERROR);if(m.portal.user.username!==m.owner&&"admin"!==m.itemControl)return console.error("Only owners and admins are allowed."),void(this.status=W.ERROR);if((null===(t=m.typeKeywords)||void 0===t?void 0:t.indexOf("View Service"))>-1)return console.error("View items are not allowed."),void(this.status=W.ERROR);if((null==m?void 0:m.typeKeywords.indexOf("IoTFeatureLayer"))>-1)return console.error("Velocity items are not allowed."),void(this.status=W.ERROR);let y=m.extent;if(y||(y=new d({xmin:-180,ymin:-90,xmax:180,ymax:90,spatialReference:4326})),4326!==n.spatialReference.wkid){await c.load();const e=c.project(y,n.spatialReference);n.goTo(e.expand(1.1))}else n.goTo(y.expand(1.1));const f=await l.fromPortalItem({portalItem:m});"group"===f.type?(await f.loadAll(),(null===(i=f.layers)||void 0===i?void 0:i.length)&&n.map.add(f),null===(s=f.layers)||void 0===s||s.forEach((e=>{!e.popupTemplate&&e.popupEnabled&&(e.popupTemplate=e.createPopupTemplate())}))):(await f.load(),f.isTable||n.map.add(f),f.popupTemplate=f.createPopupTemplate()),m.portal.isPortal&&("group"===f.type?k(f).find((e=>!K(e)))||console.error("Layers with Ownership-Based Access Control are not allowed."):K(f)&&console.error("Layers with Ownership-Based Access Control are not allowed.")),h.targetItem=m,h.targetLayer=f,this.status=W.TARGET_SELECTION}catch(e){console.error(e),this.status=W.ERROR}else console.error("itemId is a required property.")}async componentDidLoad(){this.arcgisLayerViewJoinStepChange.emit(1)}disconnectedCallback(){const{props:e}=this,{view:t,targetLayer:i,addLayer:s}=e;t.map.remove(i),t.map.remove(s)}render(){const{status:e}=this;return(0,s.h)(s.H,null,e===W.ERROR?this.renderError():null,e===W.LOADING?this.renderLoading():null,[W.TARGET_SELECTION].includes(e)?this.renderTargetLayerSelection():null,[W.ADD_SELECTION,W.BROWSE_LAYER].includes(e)?this.renderAddLayerSelection():null,[W.CONFIG].includes(e)?this.renderConfig():null,e===W.CREATE?this.renderCreateJoin():null)}renderError(){const{props:e}=this,{targetItem:t,strings:i}=e;return(0,s.h)("calcite-flow-item",{loading:!1,heading:(null==t?void 0:t.title)||i.msg.error,description:(null==t?void 0:t.title)?i.join.targetLayer:void 0,class:p,ref:e=>this.flowItemNode=e},(0,s.h)("div",{class:g},(0,s.h)("calcite-notice",{scale:"s",width:"full",open:!0,icon:"exclamation-mark-triangle",kind:"danger"},(0,s.h)("div",{slot:"title"},i.msg.error),(0,s.h)("div",{slot:"message"},i.msg.initFailed))),(0,s.h)("div",{slot:"footer",class:u},(0,s.h)("calcite-button",{slot:"footer",onClick:this.goCancel,appearance:"transparent",width:"full"},i.general.cancel)))}renderLoading(){const{props:e}=this,{targetItem:t,strings:i}=e;return(0,s.h)("calcite-flow-item",{loading:!0,heading:null==t?void 0:t.title,description:i.join.targetLayer,class:p,ref:e=>this.flowItemNode=e})}renderTargetLayerSelection(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-join-target-selection",{key:`target-selection-${t}`,props:e,status:t})}renderAddLayerSelection(){const{props:e,status:t}=this,{addItem:i}=e;return(0,s.h)("arcgis-layer-view-join-add-selection",{key:`add-${t}-${null==i?void 0:i.id}`,props:e,status:t})}renderConfig(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-join-config",{key:`create-${t}`,props:e,onArcgisLayerViewJoinConfigTableClick:e=>this.arcgisLayerViewJoinTableClick.emit(e.detail)})}renderCreateJoin(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-join-create",{key:`create-${t}`,props:e})}get hostElement(){return(0,s.d)(this)}};ie.style=":host{height:100%}.panel{height:100%}.footer{width:100%}.error-content{margin:0.5rem}";const se="text",re=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinStatusChange=(0,s.c)(this,"arcgisLayerViewJoinStatusChange",7),this.goBrowse=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:W.BROWSE_LAYER})},this.goBack=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:W.TARGET_SELECTION})},this.goNext=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:W.CONFIG})},this.onSelectionChange=()=>{const{props:e}=this;this.listNode.querySelectorAll("calcite-pick-list-item").forEach((t=>{t.selected&&(e.addLayerId=t.value,(0,s.f)(this.hostElement))})),e.attributeRelationships=void 0,e.joinOperation=void 0},this.props=void 0,this.status=void 0}componentWillLoad(){const{props:e}=this,{addItem:t,targetItem:i,targetLayer:s}=e;t||"group"!==s.type||(e.addItem=i,e.addLayer=s),e.addLayer&&"group"!==e.addLayer.type&&!(0,a.i)(e.addLayerId)&&(e.addLayerId=e.addLayer.layerId)}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.backButtonNode)||void 0===e?void 0:e.setFocus()}))}componentDidRender(){const{props:e}=this,{targetLayer:t,targetLayerId:i,addLayer:s,addLayerId:r}=e;"group"===t.type&&k(t).forEach((e=>{e.layerId!==i&&(e.visible=!1)})),s&&"group"===s.type&&(0,a.i)(r)?k(s).forEach((e=>{t.id===s.id&&i===e.layerId||(e.visible=e.layerId===r)})):s&&"group"!==s.type&&(s.visible=!0)}render(){const{props:e,status:t}=this,{strings:i}=e,r="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow",{class:"flow",dir:(0,l.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{description:i.join.joinLayer,class:{panel:!0,[l.C.rtl]:r},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderOBACMsg(),this.renderBrowse(),this.renderSublayers()),t===W.BROWSE_LAYER&&this.renderBrowseLayer()))}renderFooterButtons(){const{props:e}=this,{addItem:t,addLayerId:i,addLayer:r,strings:o}=e,n="rtl"===(0,l.g)(this.hostElement);let d;r&&"group"===r.type&&(0,a.i)(i)?k(r).forEach((e=>{i===e.layerId&&(d=e)})):r&&"group"!==r.type&&(d=r);const c=!r||!(0,a.i)(i)||t.portal.isPortal&&K(d);return(0,s.h)("div",{slot:"footer",class:"footer"},(0,s.h)("calcite-button",{onClick:this.goBack,appearance:"outline-fill",width:"half","icon-start":n?"arrow-right":"arrow-left",ref:e=>this.backButtonNode=e},o.general.back),(0,s.h)("calcite-button",{disabled:c,onClick:!c&&this.goNext,appearance:"solid",width:"half",iconEnd:n?"arrow-left":"arrow-right",ref:e=>this.nextButtonNode=e},o.general.next))}renderOBACMsg(){const{props:e}=this,{config:t,addItem:i,addLayerId:r,addLayer:o,strings:n}=e,{helpBase:l,helpMap:d}=t;if(!o)return;if(!i.portal.isPortal)return;let c;if("group"===o.type&&(0,a.i)(r))c=k(o).find((e=>r===e.layerId));else{if("group"===o.type)return;c=o}return K(c)?(0,s.h)("calcite-notice",{key:`${K(c)}`,class:"notice",open:!0,closable:!1,scale:"s",width:"auto",kind:"warning",icon:"exclamation-mark-triangle"},(0,s.h)("div",{slot:"message"},n.join.obacNotSupportedMsg),(0,s.h)("calcite-link",{slot:"link",title:n.join.learnMore,target:"_blank",href:`${l}${d[120004184]}`},n.join.learnMore)):void 0}renderBrowse(){const{props:e}=this,{strings:t}=e;return(0,s.h)("div",null,(0,s.h)("div",{class:"info"},(0,s.h)("div",{class:se},t.join.selectAddLayerPanelDescription)),(0,s.h)("div",{class:"footer-button"},(0,s.h)("calcite-button",{id:"arcgis-layer-view-join-browse",onClick:this.goBrowse,appearance:"outline-fill",width:"full",ref:e=>this.browseButtonNode=e},t.join.browseForLayer)))}renderBrowseLayer(){const{props:e}=this;return(0,s.h)("arcgis-layer-view-join-browse-layer",{props:e,class:"browse",onArcgisLayerViewJoinStatusChange:e=>{e.detail.status===W.ADD_SELECTION&&setTimeout((()=>{var e;return null===(e=document.getElementById("arcgis-layer-view-join-browse"))||void 0===e?void 0:e.setFocus()}),400)}})}renderSublayers(){const{props:e}=this,{targetLayer:t,addItem:i,addLayer:r,targetLayerId:o,strings:a}=e;if(!r)return null;const n=[];"group"===r.type?k(r).forEach((e=>{t.id===r.id&&o===e.layerId||n.unshift(this.renderSublayer(e))})):n.push(this.renderSublayer(r));const l=a.join.selectFromItem;return(0,s.h)(s.F,null,(0,s.h)("div",{class:"list-header"},(0,s.h)("div",{class:se},l.substring(0,l.indexOf("${")),(0,s.h)("b",null,i.title),l.substring(l.indexOf("}")+1))),(0,s.h)("calcite-pick-list",{multiple:!1,onCalciteListChange:this.onSelectionChange,ref:e=>this.listNode=e},n))}renderSublayer(e){const{props:t}=this,{addLayerId:i}=t;return(0,s.h)("calcite-pick-list-item",{key:e.layerId,label:e.title,value:e.layerId,description:Y(e,t),selected:i===e.layerId})}get hostElement(){return(0,s.d)(this)}};re.style=".flow{height:100%}.panel{height:100%}.footer{width:100%}.info{pointer-events:none;padding:1rem 0.75rem}.list-header{pointer-events:none;padding:1rem 0.75rem 0.3rem}.text{font-size:var(--calcite-font-size--2);line-height:1.375;color:var(--calcite-ui-text-3);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);pointer-events:none;word-wrap:break-word;word-break:break-word}.footer-button{margin:0 10px 5px 10px}.notice{margin:8px}.browse{width:100%}";const oe=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinStatusChange=(0,s.c)(this,"arcgisLayerViewJoinStatusChange",7),this.onBack=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:W.ADD_SELECTION})},this.goUseLayer=async e=>{var t,i;const{props:s}=this,{addLayer:r,targetLayer:o,view:a,modules:n}=s;this.loading=!0,r&&r.id!==o.id&&a.map.remove(r);const l=new n.PortalItem({id:e});await l.load();const d=await n.Layer.fromPortalItem({portalItem:l});"group"===d.type?(await d.loadAll(),(null===(t=d.layers)||void 0===t?void 0:t.length)&&a.map.add(d),null===(i=d.layers)||void 0===i||i.forEach((e=>{!e.popupTemplate&&e.popupEnabled&&(e.popupTemplate=e.createPopupTemplate())}))):(await d.load(),d.isTable||a.map.add(d),d.popupTemplate=d.createPopupTemplate()),s.addItem=l,s.addLayer=d,s.addLayerId=void 0,s.joinOperation=void 0,this.arcgisLayerViewJoinStatusChange.emit({status:W.ADD_SELECTION})},this.props=void 0,this.loading=!1,this.items=void 0,this.pagination=void 0,this.error=void 0}async componentDidLoad(){setTimeout((()=>requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))),200)}render(){const{props:e,loading:t,hostElement:i}=this,{strings:r}=e,o="rtl"===(0,l.g)(i);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{heading:r.join.browseForLayerTitle,description:r.join.browseForLayerSubTitle,loading:t,class:{panel:!0,[l.C.rtl]:o},onCalciteFlowItemBack:this.onBack,ref:e=>this.flowItemNode=e},this.renderItemBrowser()))}renderItemBrowser(){const{props:e,pagination:t}=this,{targetItem:i,targetLayer:r,itemId:o,strings:a}=e,{portalItem:n}=r,{portal:l}=n,c=l.user,h=`type:"Feature Service" typekeywords:"Hosted Service" -typekeywords:"View Service" -typekeywords:"Spatiotemporal" owner:"${i.owner}" -id:${o}`,p=`${(0,d.g)(l)}/home/`;return(0,s.h)("arcgis-item-browser",{onArcgisItemBrowserUpdate:e=>{const{results:t,num:i,start:s,total:r}=e.detail;this.items=t,this.pagination={start:s,num:i,total:r}},filter:h,portal:l,user:c,api:4,config:{baseUrl:p},selection:"none"},(0,s.h)("arcgis-item-browser-top-bar",{slot:"top-bar"},(0,s.h)("arcgis-item-browser-search",{slot:"search",term:""})),(0,s.h)("arcgis-item-browser-sort",{options:["modified","title","relevance"],slot:"sort"}),(0,s.h)("arcgis-item-browser-content",{slot:"content"},(this.items||[]).map((e=>(0,s.h)("arcgis-item-browser-card",{item:e,portal:l,baseUrl:p,key:e.id},(0,s.h)("calcite-action",{id:`join-action-${e.id}`,icon:"plus-circle",text:"",scale:"s",slot:"actions-end",onClick:this.goUseLayer.bind(this,e.id)},(0,s.h)("calcite-tooltip",{slot:"tooltip",label:a.join.select,overlayPositioning:"fixed"},a.join.select)))))),(0,s.h)("arcgis-item-browser-pagination",{total:null==t?void 0:t.total,start:null==t?void 0:t.start,num:null==t?void 0:t.num,slot:"pagination"}))}get hostElement(){return(0,s.d)(this)}};oe.style=".panel.sc-arcgis-layer-view-join-browse-layer{height:100%}";const ae="layer-header",ne="layer-title",le="layer-icon",de="chip",ce="select",he=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinStatusChange=(0,s.c)(this,"arcgisLayerViewJoinStatusChange",7),this.arcgisLayerViewJoinConfigTableClick=(0,s.c)(this,"arcgisLayerViewJoinConfigTableClick",7),this.goBack=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:W.ADD_SELECTION})},this.goNext=()=>{const{props:e}=this,{attributeRelationships:t}=e;e.attributeRelationships=t.filter((e=>e.targetFieldName&&e.addFieldName)),this.arcgisLayerViewJoinStatusChange.emit({status:W.CREATE})},this.onTargetFieldSelect=e=>{const{props:t,targetFL:i}=this,{strings:r}=t,{targetFieldName:o}=e,a=i.fields.filter((e=>e.name.toLowerCase().startsWith("shape__")));this.openFieldPickList({layer:i,fieldName:o,multiple:!1,heading:r.join.targetFields,fieldTypes:["small-integer","big-integer","integer","single","double","long","number","date","date-only","time-only","timestamp-offset","string","guid","global-id"],excludedFields:a.map((e=>e.name)),buttonNode:this.targetFieldNode,onChange:t=>{e.targetFieldName=t[0],(0,s.f)(this.hostElement)}})},this.onJoinFieldSelect=e=>{const{props:t,addFL:i}=this,{strings:r}=t,{addFieldName:o}=e,a=i.fields.filter((e=>e.name.toLowerCase().startsWith("shape__")));this.openFieldPickList({layer:i,fieldName:o,multiple:!1,heading:r.join.joinFields,fieldTypes:["small-integer","big-integer","integer","single","double","long","number","date","date-only","time-only","timestamp-offset","string","guid","global-id"],excludedFields:a.map((e=>e.name)),buttonNode:this.addFieldNode,onChange:t=>{e.addFieldName=t[0],(0,s.f)(this.hostElement)}})},this.onSortByFieldSelect=()=>{const{props:e,addFL:t}=this,{joinOperation:i,strings:r}=e,{sortByFieldName:o}=i,a=t.fields.filter((e=>e.name.toLowerCase().startsWith("shape__")));this.openFieldPickList({layer:t,fieldName:o,multiple:!1,heading:r.join.joinFields,fieldTypes:["small-integer","big-integer","integer","single","double","long","number","date","date-only","time-only","timestamp-offset","oid"],excludedFields:a.map((e=>e.name)),buttonNode:this.sortByFieldNode,onChange:e=>{i.sortByFieldName=e[0],(0,s.f)(this.hostElement)}})},this.onStatsFieldSelect=()=>{const{props:e,addFL:t}=this,{joinOperation:i,strings:r}=e,{statisticsFields:o}=i,a=t.fields.filter((e=>e.name.toLowerCase().startsWith("shape__")));this.openFieldPickList({layer:t,fieldName:"",multiple:!0,heading:r.join.selectFields,fieldTypes:["small-integer","big-integer","integer","single","double","long","number","date","date-only","time-only","timestamp-offset"],excludedFields:o.map((e=>e.fieldName)).concat(a.map((e=>e.name))),buttonNode:this.statsButtonNode,onChange:e=>{e.forEach((e=>{const i=["date","date-only","time-only","timestamp-offset"].indexOf(z(t,e))>-1;o.push({fieldName:e,types:[i?"MIN":"SUM"]})})),(0,s.f)(this.hostElement)}})},this.props=void 0,this.status=void 0,this.showTableOption=!1}async componentWillLoad(){var e;const{props:t}=this,{targetLayer:i,targetLayerId:s,addLayer:r,addLayerId:o,attributeRelationships:a,joinOperation:n}=t;if(this.targetFL="group"===i.type?k(i).find((e=>e.layerId===s)):i,this.addFL="group"===r.type?k(r).find((e=>e.layerId===o)):r,!(null==a?void 0:a.length)){t.attributeRelationships=[];const{targetFL:i,addFL:r}=this;if(i.relationships&&r.relationships){const e=i.relationships.filter((e=>e.relatedTableId===o)),a=r.relationships.filter((e=>e.relatedTableId===s));e.length&&a.length&&e.forEach((e=>{const i=a.find((t=>e.id===t.id));i&&t.attributeRelationships.push({targetFieldName:e.keyField,addFieldName:i.keyField})}))}(null===(e=t.attributeRelationships)||void 0===e?void 0:e.length)||t.attributeRelationships.push({})}n||(t.joinOperation={type:"one-to-one",matchType:"first",sortByFieldName:this.addFL.objectIdField,sortOrder:"ASC",joinType:"INNER",statisticsFields:[]})}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.backButtonNode)||void 0===e?void 0:e.setFocus()}))}disconnectedCallback(){this.removeInfoPopover()}render(){const{props:e}=this,{strings:t}=e,i="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow",{class:"flow",dir:(0,l.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{heading:t.join.configureJoin,class:{panel:!0,[l.C.rtl]:i},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderContent())))}renderFooterButtons(){var e,t;const{props:i}=this,{attributeRelationships:r,joinOperation:o,strings:a}=i,n="rtl"===(0,l.g)(this.hostElement),d=!!r.find((e=>e.targetFieldName&&e.addFieldName))&&("one-to-many"===o.type||"first"===o.matchType&&o.sortByFieldName&&o.sortOrder||"summarize"===o.matchType&&(null===(e=o.statisticsFields)||void 0===e?void 0:e.length)&&(null===(t=o.statisticsFields)||void 0===t?void 0:t[0].fieldName));return(0,s.h)("div",{slot:"footer",class:"footer"},(0,s.h)("calcite-button",{onClick:this.goBack,appearance:"outline-fill",width:"half","icon-start":n?"arrow-right":"arrow-left",ref:e=>this.backButtonNode=e},a.general.back),(0,s.h)("calcite-button",{disabled:!d,onClick:d&&this.goNext,appearance:"solid",width:"half",iconEnd:n?"arrow-left":"arrow-right",ref:e=>this.nextButtonNode=e},a.general.next))}renderContent(){return(0,s.h)(s.F,null,this.renderLayers(),this.renderAttributeRelationships(),this.renderJoinOperation())}renderLayers(){const{props:e,targetFL:t,addFL:i}=this,{targetItem:r,targetLayer:o,targetLayerId:a,addItem:n,addLayer:d,addLayerId:c,showTableOption:h,strings:p}=e,u="rtl"===(0,l.g)(this.hostElement),g="group"===o.type?u?`${t.title} / ${r.title}`:`${r.title} / ${t.title}`:o.title,m="group"===d.type?u?`${i.title} / ${n.title}`:`${n.title} / ${i.title}`:d.title;return(0,s.h)("div",{class:"layer-section"},(0,s.h)("div",{class:"target-layer"},(0,s.h)("div",null,(0,s.h)("div",{class:ae},p.join.targetLayer),(0,s.h)("div",{class:ne},g)),h&&(0,s.h)("calcite-action",{scale:"s",icon:"table",class:le,text:p.join.showTable,textEnabled:!1,onClick:()=>{var e,t;"group"===o.type?(null===(e=o.tables)||void 0===e||e.forEach((e=>{e.layerId===a&&this.arcgisLayerViewJoinConfigTableClick.emit(e)})),null===(t=o.layers)||void 0===t||t.forEach((e=>{e.layerId===a&&this.arcgisLayerViewJoinConfigTableClick.emit(e)}))):this.arcgisLayerViewJoinConfigTableClick.emit(o)}})),(0,s.h)("div",{class:"add-layer"},(0,s.h)("div",null,(0,s.h)("div",{class:ae},p.join.joinLayer),(0,s.h)("div",{class:ne},m)),h&&(0,s.h)("calcite-action",{scale:"s",icon:"table",class:le,text:p.join.showTable,textEnabled:!1,onClick:()=>{var e,t;"group"===d.type?(null===(e=d.tables)||void 0===e||e.forEach((e=>{e.layerId===c&&this.arcgisLayerViewJoinConfigTableClick.emit(e)})),null===(t=d.layers)||void 0===t||t.forEach((e=>{e.layerId===c&&this.arcgisLayerViewJoinConfigTableClick.emit(e)}))):this.arcgisLayerViewJoinConfigTableClick.emit(d)}})))}renderAttributeRelationships(){const{props:e}=this,{attributeRelationships:t,strings:i}=e;return(0,s.h)("calcite-block",{heading:i.join.attributeJoin,description:i.join.attributeJoinMsg,open:!0,collapsible:!0,ref:e=>this.attrBlockNode=e},t.map(((e,t)=>this.renderAttributeRelationship(e,t))),(0,s.h)("calcite-button",{onClick:()=>{t.push({}),(0,s.f)(this.hostElement)},appearance:"outline-fill",width:"full",ref:e=>this.fieldButtonNode=e},i.join.fields))}renderAttributeRelationship(e,t){const{targetFL:i,addFL:r,props:o}=this,{attributeRelationships:a,strings:n}=o;return(0,s.h)("div",{class:"attribute-relationship"},a.length>1&&(0,s.h)("div",{class:"remove-attribute-relationship"},(0,s.h)("calcite-action",{scale:"s",icon:"trash",text:n.general.remove,onClick:()=>{a.splice(t,1),(0,s.f)(this.hostElement)}})),(0,s.h)("calcite-label",null,n.join.targetField,(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",alignment:"icon-end-space-between",iconEnd:"chevron-down",onClick:()=>this.onTargetFieldSelect(e),ref:e=>this.targetFieldNode=e},e.targetFieldName?G(i,e.targetFieldName):n.join.selectField)),(0,s.h)("calcite-label",null,n.join.joinField,(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",alignment:"icon-end-space-between",iconEnd:"chevron-down",onClick:()=>this.onJoinFieldSelect(e),ref:e=>this.addFieldNode=e},e.addFieldName?G(r,e.addFieldName):n.join.selectField)))}renderJoinOperation(){const{props:e}=this,{joinOperation:t,strings:i}=e;return(0,s.h)("calcite-block",{heading:i.join.joinSettings,description:i.join.joinSettingsMsg,open:!0,collapsible:!0,ref:e=>this.operationBlockNode=e},this.renderJoinOperationType(),"one-to-one"===t.type&&this.renderMatchType(),"one-to-one"===t.type&&"first"===t.matchType&&this.renderJoinOperationSortBy(),"one-to-one"===t.type&&"summarize"===t.matchType&&this.renderJoinOperationStatistics(),(0,s.h)("div",{class:"separator"}),this.renderJoinType())}renderJoinOperationType(){const{props:e}=this,{joinOperation:t,strings:i}=e;return(0,s.h)("calcite-label",null,(0,s.h)("div",{class:"info"},(0,s.h)("div",{class:"info-label"},i.join.joinOperation),(0,s.h)("calcite-action",{class:"link-info",tabindex:"0",scale:"s",icon:"information",onClick:e=>this.handleInfoClick(e,"join-operation"),text:i.join.moreInfo,ref:e=>{this.joinOperationInfoIconNode=e,e.addEventListener("keyup",(e=>{e.stopPropagation(),(" "===e.key||!this.infoPopoverNode&&"Enter"===e.key)&&this.handleInfoClick(e,"join-operation")})),e.addEventListener("keydown",(e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())}))}})),(0,s.h)("div",null,(0,s.h)("calcite-chip",{value:"one-to-one",appearance:"one-to-one"===t.type?"solid":"outline-fill",kind:"brand",class:`${de} ${"one-to-many"===t.type?ce:""}`,onClick:"one-to-many"===t.type?()=>{t.type="one-to-one",(0,s.f)(this.hostElement)}:void 0},i.join.oneToOne)," ",(0,s.h)("calcite-chip",{value:"one-to-many",appearance:"one-to-many"===t.type?"solid":"outline-fill",kind:"brand",class:`${de} ${"one-to-one"===t.type?ce:""}`,onClick:"one-to-one"===t.type?()=>{t.type="one-to-many",(0,s.f)(this.hostElement)}:void 0},i.join.oneToMany)))}renderMatchType(){const{props:e}=this,{joinOperation:t,strings:i}=e;return(0,s.h)("calcite-radio-button-group",{name:"matchType",layout:"vertical",class:"join-match-type-section"},(0,s.h)("calcite-label",{layout:"inline",class:ce,onClick:()=>{t.matchType="first",(0,s.f)(this.hostElement)}},(0,s.h)("calcite-radio-button",{checked:"first"===t.matchType,value:"first",onClick:()=>{t.matchType="first",(0,s.f)(this.hostElement)}}),i.join.onlyFirst),(0,s.h)("calcite-label",{layout:"inline",class:ce,onClick:()=>{t.matchType="summarize",(0,s.f)(this.hostElement)}},(0,s.h)("calcite-radio-button",{checked:"summarize"===t.matchType,value:"summarize",onClick:()=>{t.matchType="summarize",(0,s.f)(this.hostElement)}}),i.join.summarizeMatching))}renderJoinOperationSortBy(){const{addFL:e,props:t}=this,{joinOperation:i,strings:r}=t;return(0,s.h)("div",{class:"sort-by-section"},(0,s.h)("calcite-label",null,r.join.sortBy,(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",width:"full",alignment:"icon-end-space-between",iconEnd:"chevron-down",onClick:()=>this.onSortByFieldSelect(),ref:e=>this.sortByFieldNode=e},G(e,i.sortByFieldName))),(0,s.h)("calcite-label",null,r.join.sortOrder,(0,s.h)("calcite-select",{width:"full",onCalciteSelectChange:e=>{const t=e.target;i.sortOrder=t.value,(0,s.f)(this.hostElement)},label:r.join.sortOrder},(0,s.h)("calcite-option",{label:r.join.asc,selected:"ASC"===i.sortOrder,value:"ASC"},r.join.asc),(0,s.h)("calcite-option",{label:r.join.desc,selected:"DESC"===i.sortOrder,value:"DESC"},r.join.desc))))}renderJoinOperationStatistics(){var e;const{props:t,addFL:i}=this,{joinOperation:r,strings:o}=t,{statisticsFields:a}=r,n=a.map((e=>e.fieldName)),l=["small-integer","big-integer","integer","single","double","long","number","date","date-only","time-only","timestamp-offset"],d=!i.fields.filter((e=>-1===n.indexOf(e.name))).filter((e=>l.indexOf(e.type)>-1)).length;return(0,s.h)(s.F,null,(0,s.h)("calcite-label",{scale:"l"},o.join.fieldStats),null===(e=r.statisticsFields)||void 0===e?void 0:e.map(((e,t)=>this.renderJoinOperationStatistic(e,t))),(0,s.h)("calcite-button",{onClick:!d&&this.onStatsFieldSelect,appearance:"outline-fill","icon-start":"plus",width:"full",disabled:d,class:"stats-button",ref:e=>this.statsButtonNode=e},o.join.addStats))}renderJoinOperationStatistic(e,t){const{props:i,addFL:r}=this,{joinOperation:o,strings:a}=i,n=["date","date-only","time-only","timestamp-offset"].indexOf(z(r,e.fieldName))>-1,l=n?e.types.indexOf("MIN")>-1&&e.types.indexOf("MAX")>-1:e.types.indexOf("SUM")>-1&&e.types.indexOf("MIN")>-1&&e.types.indexOf("MAX")>-1&&e.types.indexOf("MEAN")>-1&&e.types.indexOf("STDDEV")>-1;return(0,s.h)("div",{class:"stats-section"},(0,s.h)("calcite-label",{class:"stats-field-header",layout:"inline-space-between"},G(r,e.fieldName),(0,s.h)("calcite-action",{scale:"s",icon:"trash",text:a.general.remove,onClick:()=>{o.statisticsFields.splice(t,1),(0,s.f)(this.hostElement)}})),(0,s.h)("div",null,!n&&(0,s.h)(s.F,null,(0,s.h)("calcite-chip",{value:"SUM",appearance:e.types.indexOf("SUM")>-1?"solid":"outline-fill",kind:"brand",class:`${de} ${e.types.length>1||-1===e.types.indexOf("SUM")?ce:""}`,onClick:()=>{-1===e.types.indexOf("SUM")?e.types.push("SUM"):e.types.length>1&&e.types.splice(e.types.indexOf("SUM"),1),(0,s.f)(this.hostElement)}},a.join.sum)," "),(0,s.h)("calcite-chip",{value:"MIN",appearance:e.types.indexOf("MIN")>-1?"solid":"outline-fill",kind:"brand",class:`${de} ${e.types.length>1||-1===e.types.indexOf("MIN")?ce:""}`,onClick:()=>{-1===e.types.indexOf("MIN")?e.types.push("MIN"):e.types.length>1&&e.types.splice(e.types.indexOf("MIN"),1),(0,s.f)(this.hostElement)}},a.join.min)," ",(0,s.h)("calcite-chip",{value:"MAX",appearance:e.types.indexOf("MAX")>-1?"solid":"outline-fill",kind:"brand",class:`${de} ${e.types.length>1||-1===e.types.indexOf("MAX")?ce:""}`,onClick:()=>{-1===e.types.indexOf("MAX")?e.types.push("MAX"):e.types.length>1&&e.types.splice(e.types.indexOf("MAX"),1),(0,s.f)(this.hostElement)}},a.join.max),!n&&(0,s.h)(s.F,null," ",(0,s.h)("calcite-chip",{value:"MEAN",appearance:e.types.indexOf("MEAN")>-1?"solid":"outline-fill",kind:"brand",class:`${de} ${e.types.length>1||-1===e.types.indexOf("MEAN")?ce:""}`,onClick:()=>{-1===e.types.indexOf("MEAN")?e.types.push("MEAN"):e.types.length>1&&e.types.splice(e.types.indexOf("MEAN"),1),(0,s.f)(this.hostElement)}},a.join.mean)," ",(0,s.h)("calcite-chip",{value:"STDDEV",appearance:e.types.indexOf("STDDEV")>-1?"solid":"outline-fill",kind:"brand",class:`${de} ${e.types.length>1||-1===e.types.indexOf("STDDEV")?ce:""}`,onClick:()=>{-1===e.types.indexOf("STDDEV")?e.types.push("STDDEV"):e.types.length>1&&e.types.splice(e.types.indexOf("STDDEV"),1),(0,s.f)(this.hostElement)}},a.join.stdDev)),!l&&(0,s.h)(s.F,null," ",(0,s.h)("calcite-button",{appearance:"transparent",label:a.join.selectAll,onClick:()=>{!n&&-1===e.types.indexOf("SUM")&&e.types.push("SUM"),-1===e.types.indexOf("MIN")&&e.types.push("MIN"),-1===e.types.indexOf("MAX")&&e.types.push("MAX"),!n&&-1===e.types.indexOf("MEAN")&&e.types.push("MEAN"),!n&&-1===e.types.indexOf("STDDEV")&&e.types.push("STDDEV"),(0,s.f)(this.hostElement)}},a.join.selectAll))))}renderJoinType(){const{props:e}=this,{joinOperation:t,strings:i}=e;return(0,s.h)("calcite-label",null,(0,s.h)("div",{class:"info"},(0,s.h)("div",{class:"info-label"},i.join.joinType),(0,s.h)("calcite-action",{class:"link-info",tabindex:"0",scale:"s",icon:"information",onClick:e=>this.handleInfoClick(e,"join-type"),text:i.join.moreInfo,ref:e=>{this.joinTypeInfoIconNode=e,e.addEventListener("keyup",(e=>{e.stopPropagation(),(" "===e.key||!this.infoPopoverNode&&"Enter"===e.key)&&this.handleInfoClick(e,"join-type")})),e.addEventListener("keydown",(e=>{" "===e.key&&(e.stopPropagation(),e.preventDefault())}))}})),(0,s.h)("div",null,(0,s.h)("calcite-chip",{value:"inner-join",appearance:"INNER"===t.joinType?"solid":"outline-fill",kind:"brand",class:`${de} ${"LEFT"===t.joinType?ce:""}`,onClick:"LEFT"===t.joinType?()=>{t.joinType="INNER",(0,s.f)(this.hostElement)}:void 0},i.join.innerJoin)," ",(0,s.h)("calcite-chip",{value:"left-join",appearance:"LEFT"===t.joinType?"solid":"outline-fill",kind:"brand",class:`${de} ${"INNER"===t.joinType?ce:""}`,onClick:"INNER"===t.joinType?()=>{t.joinType="LEFT",(0,s.f)(this.hostElement)}:void 0},i.join.leftJoin)))}openFieldPickList({layer:e,fieldName:t,multiple:i,heading:s,fieldTypes:r,excludedFields:o,buttonNode:a,onChange:n}){const{props:l,fieldPickListSortBy:d,flowItemNode:c}=this,{view:h}=l,p=c.getBoundingClientRect().width||215;this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps={placement:"auto",offsetDistance:-1*(p-2),offsetSkidding:0,pointerDisabled:!0,popoverWidth:p+7,refElement:c},this.arcgisFieldPickList.fields=this.createPickListFields(e,r,o),this.arcgisFieldPickList.layer=e,this.arcgisFieldPickList.mapView=h,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!1,this.arcgisFieldPickList.selectedFields=t?[t]:[],this.arcgisFieldPickList.sortBy=d,this.arcgisFieldPickList.multiple=i,this.arcgisFieldPickList.heading=s,this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed",(e=>{var t;e.stopPropagation();const i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields;c.disabled=!1,this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null,setTimeout((()=>{a.setFocus()}),1)),(null==i?void 0:i.length)&&n(i)})),this.arcgisFieldPickList.addEventListener("arcgisFieldPickListSortByChange",(e=>this.fieldPickListSortBy=e.detail)),document.body.appendChild(this.arcgisFieldPickList),c.disabled=!0}createPickListFields(e,t,i){const{fields:s,popupTemplate:r}=e;return s.filter((e=>-1===i.indexOf(e.name))).filter((e=>t.indexOf(e.type)>-1)).map((e=>{var t,i;return{name:e.name,alias:(null===(i=null===(t=null==r?void 0:r.fieldInfos)||void 0===t?void 0:t.find((t=>t.fieldName===e.name)))||void 0===i?void 0:i.label)||e.alias,type:e.type}}))}handleInfoClick(e,t){e.stopPropagation(),this.removeInfoPopover();const{props:i}=this,s="join-operation"===t?this.joinOperationInfoIconNode:this.joinTypeInfoIconNode;this.infoPopoverNode=document.createElement("arcgis-layer-view-join-info-popover"),this.infoPopoverNode.props=i,this.infoPopoverNode.type=t,this.infoPopoverNode.referenceElement=s,this.infoPopoverNode.addEventListener("arcgisLayerViewJoinInfoPopoverClose",(e=>{e.stopPropagation(),this.removeInfoPopover(),setTimeout((()=>s.setFocus()),200)})),this.infoPopoverNode.addEventListener("arcgisLayerViewJoinInfoPopoverDisconnected",(e=>{e.stopPropagation(),this.removeInfoPopover()})),document.body.appendChild(this.infoPopoverNode),this.infoPopoverNode.setOpen(!0),setTimeout((()=>this.infoPopoverNode.setFocus()),100)}removeInfoPopover(){var e;this.infoPopoverNode&&(null===(e=this.infoPopoverNode.parentNode)||void 0===e||e.removeChild(this.infoPopoverNode),this.infoPopoverNode=null)}get hostElement(){return(0,s.d)(this)}};he.style=".flow{height:100%}.panel{height:100%}.footer{width:100%}.layer-section{border:1px solid var(--calcite-ui-border-3);background-color:white;margin:10px}.target-layer{padding:10px;border-bottom:1px solid var(--calcite-ui-border-3);display:flex;justify-content:space-between}.add-layer{padding:10px;display:flex;justify-content:space-between}.layer-header{padding-bottom:3px;overflow-wrap:anywhere}.layer-title{font-weight:bold;overflow-wrap:anywhere}.layer-icon{align-self:center;cursor:pointer}.attribute-relationship{border:1px solid var(--calcite-ui-border-3);padding:10px 10px 0 10px;margin-bottom:10px}.remove-attribute-relationship{display:flex;justify-content:flex-end}.join-match-type-section{padding:10px 0}.info{display:flex;justify-content:space-between}.info-label{display:flex;align-items:center}.chip{margin-bottom:5px}.sort-by-section{border:1px solid var(--calcite-ui-border-3);padding:10px 10px 0 10px;margin:10px 0}.separator{border-bottom:1px solid var(--calcite-ui-border-3);margin:10px 0 15px 0}.stats-section{border:1px solid var(--calcite-ui-border-3);padding:10px 10px 0 10px;margin-bottom:10px}.stats-field-header{overflow-wrap:anywhere;width:100%}.stats-button{margin-bottom:10px}.select{cursor:pointer}";const pe="layer-header",ue="layer-title",ge=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinStatusChange=(0,s.c)(this,"arcgisLayerViewJoinStatusChange",7),this.arcgisLayerViewJoinCreateDone=(0,s.c)(this,"arcgisLayerViewJoinCreateDone",7),this.arcgisLayerViewJoinCreateCancel=(0,s.c)(this,"arcgisLayerViewJoinCreateCancel",7),this.goBack=()=>{const{props:e}=this;e.savedItemProps={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder},this.arcgisLayerViewJoinStatusChange.emit({status:W.CONFIG})},this.goCreate=async()=>{const{props:e,flowItemNode:t,hostElement:i}=this,{strings:s}=e;e.savedItemProps={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder};const r={title:c.i.title,tags:c.i.tags,summary:c.i.snippet,categories:c.i.categories,folder:c.i.folder};this.loading=!0;try{this.viewItemId=await async function(e,t){const{targetItem:i,targetLayer:s,targetLayerId:r,addLayer:o,addLayerId:a}=e,n=i.portal.isPortal,l=Date.now(),d="group"===s.type?k(s).find((e=>e.layerId===r)):s,c="group"===o.type?k(o).find((e=>e.layerId===a)):o;try{await Z(e),n||await async function(e){const{targetLayer:t,targetLayerId:i,addLayer:s,addLayerId:r,attributeRelationships:o}=e;let a="group"===t.type?k(t).find((e=>e.layerId===i)):t,n=o.map((e=>e.targetFieldName));await ee(a,n,e),a="group"===s.type?k(s).find((e=>e.layerId===r)):s,n=o.map((e=>e.addFieldName)),await ee(a,n,e)}(e);const i=await async function(e,t){const{targetItem:i,modules:s}=e,{esriRequest:r}=s,{folder:o}=t,a=!o||!o.id||o.id===i.owner,n=i.portal,l=`${n.restUrl}/content/users/${i.owner}${a?"":`/${o.id}`}/createService`,d={serviceDescription:"",hasVersionedData:!1,supportsDisconnectedEditing:!1,hasStaticData:!0,maxRecordCount:2e3,supportedQueryFormats:"JSON",capabilities:"Query",description:"",copyrightText:"",allowGeometryUpdates:!1,syncEnabled:!1,editorTrackingInfo:{enableEditorTracking:!1,enableOwnershipAccessControl:!1,allowOthersToUpdate:!0,allowOthersToDelete:!0},xssPreventionInfo:{xssPreventionEnabled:!0,xssPreventionRule:"InputOnly",xssInputRule:"rejectInvalid"},tables:[],name:t.title.replace(/ /g,"_")};if(n.isPortal){const t=await async function(e){var t,i,s,r;await Z(e);const{adminServiceInfo:o}=e,a=(null===(i=null===(t=null==o?void 0:o.adminServiceInfo)||void 0===t?void 0:t.database)||void 0===i?void 0:i.datasource)||{};return(null===(s=null==a?void 0:a.name)||void 0===s?void 0:s.indexOf("/nosqlDatabases"))>-1?"spatiotemporal":(null===(r=null==a?void 0:a.name)||void 0===r?void 0:r.indexOf("/enterpriseDatabases"))>-1?"relational":null}(e);t&&(d.options={dataSourceType:t})}let c={createParameters:JSON.stringify(d),outputType:"featureService"};try{return(await r(l,{query:Object.assign(Object.assign({},c),{f:"json",isView:!0,token:n.credential.token}),method:"post",responseType:"json"})).data}catch(e){return new Promise(((e,t)=>{t(new Error("create service failed"))}))}}(e,t),s={newItemProps:t,createServiceResponse:i,timeStamp:l,targetFL:d,addFL:c};return await async function(e,t){const{createServiceResponse:i,addFL:s,timeStamp:r}=t,{addLayerId:o,joinOperation:a,attributeRelationships:n}=e;if("one-to-one"===a.type&&"summarize"===a.matchType)try{const t=i.serviceurl.replace("rest/services","rest/admin/services"),l=n.map((e=>{var t;return{name:e.addFieldName,alias:(null===(t=s.fields.find((t=>t.name===e.addFieldName)))||void 0===t?void 0:t.alias)||e.addFieldName,source:e.addFieldName}})),d=[];a.statisticsFields.forEach((e=>{e.types.forEach((t=>{const i=t.toLowerCase();d.push({name:`${e.fieldName}_${i}`,alias:`${e.fieldName}_${i}`,source:e.fieldName,statisticType:"mean"===i?"avg":i})}))}));const c={layers:[{name:`${X(s.url,e)}_StatsTable`,description:"tablestatsjoin",adminLayerInfo:{viewLayerDefinition:{table:{materialized:!1,name:`${X(s.url,e)}_${r}_StatsTable`,sourceServiceName:X(s.url,e),sourceLayerId:o,sourceLayerFields:[...l,{name:"join_count",alias:"join_count",source:a.statisticsFields[0].fieldName,statisticType:"count"},...d],groupBy:n.map((e=>e.addFieldName)).join(",")}}}}]};return await Q(`${t}/addToDefinition`,c,e),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("addToDefinition StatsTable failed"))}))}}(e,s),await async function(e,t){const{createServiceResponse:i,newItemProps:s,targetFL:r,addFL:o,timeStamp:a}=t;try{const t=i.serviceurl.replace("rest/services","rest/admin/services"),n=function(e,t,i,s,r){const{targetLayerId:o,addLayerId:a,joinOperation:n,attributeRelationships:l,adminServiceInfo:d}=e,c=l.map((e=>{var t;return{name:e.addFieldName,alias:(null===(t=s.fields.find((t=>t.name===e.addFieldName)))||void 0===t?void 0:t.alias)||e.addFieldName,source:e.addFieldName}}));let h;"one-to-one"===n.type&&"summarize"===n.matchType&&(h=[],n.statisticsFields.forEach((e=>{e.types.forEach((t=>{const i=t.toLowerCase();h.push({name:`${e.fieldName}_${i}`,alias:`${e.fieldName}_${i}`,source:`${e.fieldName}_${i}`})}))})));const p={};return p.name=t.title.replace(/ /g,"_"),p.displayField="",p.description="AttributeJoin",p.adminLayerInfo={viewLayerDefinition:{table:{name:`${X(i.url,e)}_${r}_target`,sourceServiceName:X(i.url,e),sourceLayerId:o,sourceLayerFields:i.fields.filter((e=>"oid"!==e.type)).map((e=>({name:e.name,alias:e.alias,source:e.name}))),relatedTables:["one-to-one"===n.type&&"summarize"===n.matchType?{name:`${X(s.url,e)}_StatsTable`,sourceServiceName:t.title.replace(/ /g,"_"),sourceLayerId:0,sourceLayerFields:[...c.filter((e=>!l.some((t=>e.name===t.addFieldName)))),{name:"join_count",alias:"join_count",source:"join_count"},...h],type:n.joinType,parentKeyFields:l.map((e=>e.targetFieldName)),keyFields:l.map((e=>e.addFieldName))}:{name:`${X(s.url,e)}_${r}_join`,sourceServiceName:X(s.url,e),sourceLayerId:a,sourceLayerFields:s.fields.filter((e=>"oid"!==e.type)).map((e=>({name:i.fields.find((t=>t.name===e.name))?`${e.name}_${r}`:e.name,alias:e.alias,source:e.name}))),type:n.joinType,parentKeyFields:l.map((e=>e.targetFieldName)),keyFields:l.map((e=>e.addFieldName)),topFilter:"one-to-one"===n.type&&"first"===n.matchType?{groupByFields:l.map((e=>e.addFieldName)).join(","),orderByFields:`${n.sortByFieldName} ${n.sortOrder}`,topCount:1}:void 0}],materialized:!1}},geometryField:i.isTable?null:{name:`${X(i.url,e)}_${r}_target.${d.layers.find((e=>e.id===o)).adminLayerInfo.geometryField.name}`}},{layers:[p]}}(e,s,r,o,a);return await Q(`${t}/addToDefinition`,n,e),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("addToDefinition AttributeJoin failed"))}))}}(e,s),await async function(e,t){var i,s;const{createServiceResponse:r,newItemProps:o}=t,{targetItem:a,modules:n}=e,{esriRequest:l}=n,d=a.portal,c=`${d.restUrl}/content/users/${a.owner}/items/${r.itemId}/update`,h={title:o.title,tags:(null===(i=o.tags)||void 0===i?void 0:i.length)?o.tags.toString():void 0,snippet:o.summary,categories:null===(s=o.categories)||void 0===s?void 0:s.join(",")};d.isPortal&&(h.typeKeywords="Multi Services View");try{return await l(c,{query:Object.assign(Object.assign({},h),{f:"json",token:d.credential.token}),method:"post",responseType:"json"})}catch(e){return new Promise(((e,t)=>{t(new Error("item update request failed"))}))}}(e,s),i.itemId}catch(e){return new Promise(((e,t)=>{t(new Error("createJoinView failed"))}))}}(e,r),this.loading=!1,this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=e,this.msgNode.flowItemElement=t,this.msgNode.message=s.msg.created,i.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(i.removeChild(this.msgNode),this.msgNode=void 0,this.arcgisLayerViewJoinCreateDone.emit(this.viewItemId))}),7e3)}catch(e){const{props:t,flowItemNode:s}=this,{strings:r}=t;this.loading=!1,console.error("could not create join view",e),this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=t,this.msgNode.flowItemElement=s,this.msgNode.isError=!0,this.msgNode.message=r.msg.createFailed,i.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(i.removeChild(this.msgNode),this.msgNode=void 0)}),7e3)}},this.goCancel=()=>{this.arcgisLayerViewJoinCreateCancel.emit()},this.props=void 0,this.loading=!1,this.title=void 0}arcgisLayerViewMsgClosedHandler(){this.msgNode&&(this.hostElement.removeChild(this.msgNode),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0,this.viewItemId&&this.arcgisLayerViewJoinCreateDone.emit(this.viewItemId)}async componentWillLoad(){const{props:e}=this,{targetLayer:t,targetLayerId:i,addLayer:s,addLayerId:r}=e;this.targetFL="group"===t.type?k(t).find((e=>e.layerId===i)):t,this.addFL="group"===s.type?k(s).find((e=>e.layerId===r)):s,this.title=await async function(e){var t,i;const{targetItem:s,targetLayer:r,strings:o,modules:a}=e,{esriRequest:n}=a,l=`${s.itemUrl}/relatedItems`,d=await n(l,{query:Object.assign(Object.assign({},{relationshipType:"Service2Service",direction:"forward"}),{f:"json",token:r.portalItem.portal.credential.token}),method:"post",responseType:"json"}),c=(null===(i=null===(t=null==d?void 0:d.data)||void 0===t?void 0:t.relatedItems)||void 0===i?void 0:i.filter((e=>"Feature Service"===e.type&&(e.title.indexOf(s.title)>-1||e.title.indexOf(s.title.replace(/ /g,"_"))>-1||e.title.replace(/ /g,"_").indexOf(s.title)>-1))))||[];return o.join.joinFeaturesTo.replace("${name}",s.title)+`${c.length?` ${c.length+1}`:""} ${o.createView.view}`}(e)}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.backButtonNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e,loading:t}=this,{strings:i}=e,r="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{heading:i.join.create,loading:t,class:{panel:!0,[l.C.rtl]:r},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderNotice(),this.renderLayers(),this.renderInfo()))}renderFooterButtons(){return(0,s.h)("div",{slot:"footer",class:"footer"},this.renderBack(),this.renderCreate(),(0,s.h)("br",null),this.renderCancel())}renderBack(){const{props:e}=this,{strings:t}=e,i="rtl"===(0,l.g)(this.hostElement);return(0,s.h)("calcite-button",{onClick:this.goBack,appearance:"outline-fill",width:"half","icon-start":i?"arrow-right":"arrow-left",ref:e=>this.backButtonNode=e},t.general.back)}renderCreate(){const{props:e,title:t,titleError:i,summaryError:r}=this,{strings:o}=e,a=t&&!i&&!r;return(0,s.h)("calcite-button",{disabled:!a,onClick:a&&this.goCreate,appearance:"solid",width:"half","icon-start":"plus-square",ref:e=>this.createButtonNode=e},o.createView.create)}renderCancel(){const{props:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{onClick:this.goCancel,appearance:"transparent",width:"full"},t.general.cancel)}renderNotice(){}renderLayers(){const{props:e,targetFL:t,addFL:i}=this,{targetItem:r,targetLayer:o,addItem:a,addLayer:n,strings:d}=e,c="rtl"===(0,l.g)(this.hostElement),h="group"===o.type?c?`${t.title} / ${r.title}`:`${r.title} / ${t.title}`:o.title,p="group"===n.type?c?`${i.title} / ${a.title}`:`${a.title} / ${i.title}`:n.title;return(0,s.h)("div",{class:"layer-section"},(0,s.h)("div",{class:"target-layer"},(0,s.h)("div",{class:pe},d.join.targetLayer),(0,s.h)("div",{class:ue},h)),(0,s.h)("div",{class:"add-layer"},(0,s.h)("div",{class:pe},d.join.joinLayer),(0,s.h)("div",{class:ue},p)))}renderInfo(){const{props:e,title:t}=this,{targetItem:i,targetItemOwner:r,savedItemProps:o}=e,{portal:a}=i,n=a.user,l={portal:a,user:n,api:4};return o?(c.i.title=o.title,c.i.folder=o.folder,c.i.snippet=o.summary||"",c.i.categories=o.categories,c.i.tags=o.tags):(c.i.title=t,c.i.folder=i.ownerFolder&&{id:i.ownerFolder,username:i.owner},c.i.snippet=i.snippet||"",c.i.categories=i.categories,c.i.tags=i.tags),(0,s.h)("div",{class:"info"},(0,s.h)("arcgis-item-properties",{portal:a,user:n,api:4,config:l,type:"Feature Service",scale:"s"},(0,s.h)("arcgis-title-input",{enablePublishing:!0,onArcgisTitleInputChange:async e=>{const t=e.target,i=await t.validateTitle();(!this.titleError&&i||this.titleError&&!i)&&(0,s.f)(this.hostElement),this.titleError=i}}),(0,s.h)("arcgis-folder-picker",{user:r}),(0,s.h)("arcgis-categories-picker",null),(0,s.h)("arcgis-tags-picker",null),(0,s.h)("arcgis-summary-input",{onArcgisSummaryInputChange:async e=>{const t=e.target,i=await t.getErrorMessage();(!this.summaryError&&i||this.summaryError&&!i)&&(0,s.f)(this.hostElement),this.summaryError=i}})))}get hostElement(){return(0,s.d)(this)}};ge.style=".panel.sc-arcgis-layer-view-join-create{height:100%}.info.sc-arcgis-layer-view-join-create{display:grid;grid-template-columns:repeat(1, minmax(0px, 1fr));gap:0.5rem;padding:0 0.75rem}.footer.sc-arcgis-layer-view-join-create{width:100%}.layer-section.sc-arcgis-layer-view-join-create{border:1px solid var(--calcite-ui-border-3);background-color:white;margin:10px}.target-layer.sc-arcgis-layer-view-join-create{padding:10px;border-bottom:1px solid var(--calcite-ui-border-3)}.add-layer.sc-arcgis-layer-view-join-create{padding:10px}.layer-header.sc-arcgis-layer-view-join-create{padding-bottom:3px}.layer-title.sc-arcgis-layer-view-join-create{font-weight:bold}.notice.sc-arcgis-layer-view-join-create{margin:8px}";const me=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewJoinStatusChange=(0,s.c)(this,"arcgisLayerViewJoinStatusChange",7),this.goNext=()=>{this.arcgisLayerViewJoinStatusChange.emit({status:W.ADD_SELECTION})},this.onSelectionChange=()=>{const{props:e}=this,{targetLayer:t}=e;this.listNode.querySelectorAll("calcite-pick-list-item").forEach((i=>{i.selected&&(e.targetLayerId=i.value,(0,s.f)(this.hostElement)),"group"===t.type?k(t).find((e=>e.layerId===i.value)).visible=i.selected:t.visible=i.selected})),e.attributeRelationships=void 0,e.joinOperation=void 0},this.props=void 0,this.status=void 0}async componentWillLoad(){const{props:e}=this,{targetLayer:t}=e;"group"!==t.type&&(e.targetLayerId=t.layerId)}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.listNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e}=this,{targetItem:t,strings:i}=e,r="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow",{class:"flow",dir:(0,l.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{heading:null==t?void 0:t.title,description:i.join.targetLayer,class:{panel:!0,[l.C.rtl]:r},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderOBACMsg(),this.renderInfo(),this.renderSublayers())))}renderFooterButtons(){const{props:e}=this,{targetItem:t,targetLayer:i,targetLayerId:r,strings:o}=e,n="rtl"===(0,l.g)(this.hostElement);let d;"group"===i.type&&(0,a.i)(r)?d=k(i).find((e=>r===e.layerId)):"group"!==i.type&&(d=i);const c=!(0,a.i)(r)||t.portal.isPortal&&K(d);return(0,s.h)("div",{slot:"footer",class:"footer"},(0,s.h)("calcite-button",{disabled:c,onClick:!c&&this.goNext,appearance:"solid",width:"full",iconEnd:n?"arrow-left":"arrow-right",ref:e=>this.nextButtonNode=e},o.general.next))}renderOBACMsg(){const{props:e}=this,{config:t,targetItem:i,targetLayerId:r,targetLayer:o,strings:n}=e,{helpBase:l,helpMap:d}=t;if(!i.portal.isPortal)return;let c;if("group"===o.type&&(0,a.i)(r))c=k(o).find((e=>r===e.layerId));else{if("group"===o.type)return;c=o}return K(c)?(0,s.h)("calcite-notice",{key:`${K(c)}`,class:"notice",open:!0,closable:!1,scale:"s",width:"auto",kind:"warning",icon:"exclamation-mark-triangle"},(0,s.h)("div",{slot:"message"},n.join.obacNotSupportedMsg),(0,s.h)("calcite-link",{slot:"link",title:n.join.learnMore,target:"_blank",href:`${l}${d[120004184]}`},n.join.learnMore)):void 0}renderInfo(){const{props:e}=this,{strings:t}=e;return(0,s.h)("div",{class:"info"},(0,s.h)("div",{class:"text"},t.join.selectTargetLayerPanelDescription))}renderSublayers(){var e,t;const{props:i}=this,{targetLayer:r}=i,o=[];return"group"===r.type?(null===(e=r.tables)||void 0===e||e.forEach((e=>{o.unshift(this.renderSublayer(e))})),null===(t=r.layers)||void 0===t||t.forEach((e=>{o.unshift(this.renderSublayer(e))}))):o.push(this.renderSublayer(r)),(0,s.h)("calcite-pick-list",{multiple:!1,onCalciteListChange:this.onSelectionChange,ref:e=>this.listNode=e},o)}renderSublayer(e){const{props:t}=this,{targetLayerId:i}=t;return(0,s.h)("calcite-pick-list-item",{key:e.layerId,label:e.title,value:e.layerId,description:Y(e,t),selected:i===e.layerId})}get hostElement(){return(0,s.d)(this)}};me.style=".flow{height:100%}.panel{height:100%}.footer{width:100%}.info{pointer-events:none;padding:1rem 0.75rem}.text{font-size:var(--calcite-font-size--2);line-height:1.375;color:var(--calcite-ui-text-3);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);pointer-events:none}.notice{margin:8px}";const ye=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewMsgClosed=(0,s.c)(this,"arcgisLayerViewMsgClosed",7),this.props=void 0,this.flowItemElement=void 0,this.isError=!1,this.isWarning=!1,this.message=void 0,this.closeWithOK=void 0}async componentDidLoad(){this.flowItemElement&&(this.flowItemElement.disabled=!0),requestAnimationFrame((()=>{var e;return null===(e=this.okNode)||void 0===e?void 0:e.setFocus()}))}disconnectedCallback(){this.flowItemElement&&(this.flowItemElement.disabled=!1)}render(){const{props:e,hostElement:t,flowItemElement:i,isError:r,isWarning:o,message:a,closeWithOK:n}=this,{strings:d}=e,c=(0,l.g)(t),h=Math.round(i.getBoundingClientRect().width);return(0,s.h)(s.H,{class:"js-app-flyout"},(0,s.h)("calcite-popover",{dir:c,placement:"trailing-start",open:!0,pointerDisabled:!0,referenceElement:i,offsetDistance:-1*(h-10),offsetSkidding:200,label:a,style:{zIndex:"100",width:h-20+"px"}},(0,s.h)("calcite-notice",{scale:"s",width:"full",open:!0,closable:!n,icon:r||o?"exclamation-mark-triangle":"check-circle",kind:r?"danger":o?"warning":"success",onCalciteNoticeClose:()=>{this.arcgisLayerViewMsgClosed.emit()}},(0,s.h)("div",{slot:"title"},r?d.msg.error:o?d.msg.warning:d.msg.success),(0,s.h)("div",{slot:"message",ref:e=>{e.innerHTML=a}}),n&&(0,s.h)("calcite-button",{appearance:"transparent",slot:"actions-end",onClick:()=>{this.arcgisLayerViewMsgClosed.emit()},ref:e=>this.okNode=e},d.msg.ok))))}get hostElement(){return(0,s.d)(this)}},fe=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewStatusChange=(0,s.c)(this,"arcgisLayerViewStatusChange",7),this.arcgisLayerViewOverviewUpdated=(0,s.c)(this,"arcgisLayerViewOverviewUpdated",7),this.arcgisLayerViewOverviewCancel=(0,s.c)(this,"arcgisLayerViewOverviewCancel",7),this.listItemNodes=[],this.goBack=()=>{this.arcgisLayerViewStatusChange.emit({status:m.SELECTION})},this.goNext=()=>{this.arcgisLayerViewStatusChange.emit({status:m.CREATE})},this.goUpdate=async()=>{const{props:e,hostElement:t}=this,{strings:i}=e,s=()=>{this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=e,this.msgNode.flowItemElement=this.flowItemNode,this.msgNode.message=i.msg.updated,t.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(t.removeChild(this.msgNode),this.msgNode=void 0,this.arcgisLayerViewOverviewUpdated.emit())}),7e3)};if(j(e)){this.loading=!0;try{if(await async function(e){const{viewItem:t}=e,[i]=await(0,o.l)(["esri/request"]);try{const{addLayerIds:s,deleteLayerIds:r}=await async function(e,t,i){var s,r,o,a;const{layer:n,layerIds:l,adminServiceInfo:d}=e,c=n.portalItem,{portal:h}=c,p=[],u=[];try{const g=t.url.replace("rest/services","rest/admin/services");if("group"===n.type){null===(s=null==d?void 0:d.layers)||void 0===s||s.forEach((e=>{-1===l.indexOf(e.id)&&p.push(e.id)}));const t=[];if(null===(r=null==d?void 0:d.tables)||void 0===r||r.forEach((e=>{-1===l.indexOf(e.id)&&t.push(e.id)})),p.length||t.length){const e=`${g}/deleteFromDefinition`;await _(e,{layers:null==p?void 0:p.map((e=>({id:e}))),tables:null==t?void 0:t.map((e=>({id:e})))},c,i);let s=[];if(k(n).filter((e=>l.indexOf(e.layerId)>-1)).forEach((async e=>{var i,r;if(null===(i=e.relationships)||void 0===i?void 0:i.length){const i=k(d).find((t=>t.id===e.layerId));if(null===(r=null==i?void 0:i.relationships)||void 0===r?void 0:r.length){const r=i.relationships.filter((e=>p.indexOf(e.relatedTableId)>-1||t.indexOf(e.relatedTableId)>-1));if(r.length){const t={};t.relationships=r;const i=`${g}/${e.layerId}/deleteFromDefinition`;s.push({delFromDefUrl:i,json:t})}}}})),s.length)if(h.isPortal)for(const e of s)await _(e.delFromDefUrl,e.json,c,i);else{const e=[];s.forEach((t=>{e.push(_(t.delFromDefUrl,t.json,c,i))})),await Promise.all(e)}}if(l.forEach((e=>{k(d).some((t=>t.id===e))||u.push(e)})),u.length){const t=null===(o=n.layers)||void 0===o?void 0:o.filter((e=>u.indexOf(e.layerId)>-1)).map((t=>$(t,e))).toArray().reverse(),s=null===(a=n.tables)||void 0===a?void 0:a.filter((e=>u.indexOf(e.layerId)>-1)).map((t=>$(t,e))).toArray().reverse();await A(`${g}/addToDefinition`,{layers:t,tables:s},i,e);const r=[];if(k(n).filter((e=>l.indexOf(e.layerId)>-1)).forEach((async e=>{var t,i;if(null===(t=e.relationships)||void 0===t?void 0:t.length){const t=k(d).find((t=>t.id===e.layerId));if(t&&(null===(i=e.relationships)||void 0===i?void 0:i.length)!==t.relationships.length){const t={},i=e.relationships.filter((e=>u.indexOf(e.relatedTableId)>-1));t.relationships=i;const s=`${g}/${e.layerId}/addToDefinition`;r.push({addToDefUrl:s,json:t})}}})),r.length)if(h.isPortal)for(const t of r)await A(t.addToDefUrl,t.json,i,e);else{const t=[];r.forEach((s=>{t.push(A(s.addToDefUrl,s.json,i,e))})),await Promise.all(t)}}const m=[],y=[],f=async(t,i)=>{const s=`${g}/${i.layerId}/updateDefinition`,r=await B(i,e);return t.push({updateDefUrl:s,json:r}),Promise.resolve()};if(k(n).filter((e=>l.indexOf(e.layerId)>-1)).forEach((t=>{R(t.layerId,e)&&y.push(f(m,t))})),await Promise.all(y),m.length)if(h.isPortal)for(const t of m)await D(t.updateDefUrl,t.json,i,e);else{const t=[];m.forEach((s=>{t.push(D(s.updateDefUrl,s.json,i,e))})),await Promise.all(t)}}else if(R(n.layerId,e)){const t=await B(n,e),s=`${g}/${n.layerId}/updateDefinition`;await D(s,t,i,e)}return new Promise((e=>{e({addLayerIds:u,deleteLayerIds:p})}))}catch(e){return console.error(e),new Promise(((e,t)=>{t(new Error("updateDefinition failed"))}))}}(e,t,i);return await async function(e,t,i,s){var r,o,a,n,l,d,c,h;if(!t.length&&!i.length)return new Promise((e=>{e()}));const{layer:p,viewItem:u}=e,g=p.portalItem,m=g.portal,y=await p.portalItem.fetchData();let f=await u.fetchData();if(!(y&&(y.layers||y.tables)||f&&(f.layers||f.tables)))return new Promise((e=>{e()}));i.length&&((null===(r=null==f?void 0:f.layers)||void 0===r?void 0:r.length)&&(f.layers=f.layers.filter((e=>-1===i.indexOf(e.id)))),(null===(o=null==f?void 0:f.tables)||void 0===o?void 0:o.length)&&(f.tables=f.tables.filter((e=>-1===i.indexOf(e.id)))));const v=!!(null===(a=null==f?void 0:f.layers)||void 0===a?void 0:a.length)||!!(null===(n=null==f?void 0:f.tables)||void 0===n?void 0:n.length);if(t.length){const i=[],s=[];if(t.forEach((t=>{if(N(t,e).isTable){let e;(null==y?void 0:y.tables)&&(e=y.tables.find((e=>e.id===t)),(null==e?void 0:e.layerDefinition)&&(e.layerDefinition.definitionExpression=void 0)),!e&&v&&(e={id:t}),e&&s.push(e)}else{let e;(null==y?void 0:y.layers)&&(e=y.layers.find((e=>e.id===t)),(null==e?void 0:e.layerDefinition)&&(e.layerDefinition.definitionExpression=void 0)),!e&&v&&(e={id:t}),e&&i.push(e)}})),null==i?void 0:i.length){f=f||{},f.layers=(f.layers||[]).concat(i);const e=[];null===(l=p.layers)||void 0===l||l.forEach((t=>{e.unshift(t.layerId)})),f.layers.sort(((t,i)=>e.indexOf(t.id)<e.indexOf(i.id)?-1:1))}if(null==s?void 0:s.length){f=f||{},f.tables=(f.tables||[]).concat(s);const e=[];null===(d=p.tables)||void 0===d||d.forEach((t=>{e.unshift(t.layerId)})),f.tables.sort(((t,i)=>e.indexOf(t.id)<e.indexOf(i.id)?-1:1))}}const w=`${m.restUrl}/content/users/${g.owner}/items/${u.id}/update`,I={tags:(null===(c=u.tags)||void 0===c?void 0:c.length)?u.tags.toString():void 0,snippet:u.snippet,categories:null===(h=u.categories)||void 0===h?void 0:h.join(","),text:JSON.stringify(f)};return await s(w,{query:Object.assign(Object.assign({},I),{f:"json",token:m.credential.token}),method:"post",responseType:"json"})}(e,s,r,i),new Promise((e=>{e()}))}catch(e){return new Promise(((e,t)=>{t(new Error("updateView failed"))}))}}(this.props),await this.getLatestAdminServiceInfo(),j(this.props)){let e=1e3;const t=async()=>{var i,s;await this.getLatestAdminServiceInfo(),!j(this.props)||e>3e4?null===(s=null===(i=this.props.adminServiceInfo)||void 0===i?void 0:i.layers)||void 0===s||s.forEach((async e=>{var t,i,s,r;const o=null===(r=null===(s=null===(i=null===(t=e.adminLayerInfo)||void 0===t?void 0:t.viewLayerDefinition)||void 0===i?void 0:i.table)||void 0===s?void 0:s.filter)||void 0===r?void 0:r.value;o&&E(e.id,{aoi:JSON.parse(JSON.stringify(o.geometry))},this.props)})):(e*=2,setTimeout(t,e))};setTimeout(t,e)}this.loading=!1,s()}catch(i){const{strings:s}=e;this.loading=!1,console.error("could not create view",i),this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=e,this.msgNode.flowItemElement=this.flowItemNode,this.msgNode.isError=!0,this.msgNode.message=s.msg.updateFailed,t.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(t.removeChild(this.msgNode),this.msgNode=void 0)}),7e3)}}else s()},this.goCancel=()=>{this.arcgisLayerViewOverviewCancel.emit()},this.props=void 0,this.status=void 0,this.reRender=!1,this.loading=!1}arcgisLayerViewOverviewRefreshHandler(){this.status=m.OVERVIEW,this.reRender=!this.reRender}arcgisLayerViewMsgClosedHandler(){const{props:e}=this,{strings:t}=e;this.msgNode&&(this.msgNode.message===t.msg.updated&&this.arcgisLayerViewOverviewUpdated.emit(),this.hostElement.removeChild(this.msgNode),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0}async componentWillLoad(){}async componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.backButtonNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e,status:t,loading:i}=this,{viewItem:r,layerItem:o,strings:a}=e,n="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow",{class:"flow",dir:(0,l.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{key:t,heading:a.general.includedLayerPanelTitle,description:(null==r?void 0:r.title)||(null==o?void 0:o.title),loading:i,class:{panel:!0,[l.C.rtl]:n},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderInfo(),this.renderSublayers()),[m.DEFINITION,m.FILTER].includes(t)?this.renderLayerDefinition():null))}renderFooterButtons(){const{props:e}=this,{viewItem:t}=e;return(0,s.h)("div",{slot:"footer",class:"footer"},(0,s.h)("div",{class:"footer-top"},this.renderBack(),t?this.renderUpdate():this.renderNext()),t?this.renderCancel():null)}renderBack(){const{props:e}=this,{strings:t}=e,i="rtl"===(0,l.g)(this.hostElement);return(0,s.h)("calcite-button",{slot:"footer",onClick:this.goBack,appearance:"outline-fill",width:"half","icon-start":i?"arrow-right":"arrow-left",ref:e=>this.backButtonNode=e},t.general.back)}renderNext(){const{props:e}=this,{strings:t}=e,i="rtl"===(0,l.g)(this.hostElement);return(0,s.h)("calcite-button",{slot:"footer",onClick:this.goNext,appearance:"solid",width:"half",iconEnd:i?"arrow-left":"arrow-right",ref:e=>this.nextButtonNode=e},t.general.next)}renderUpdate(){const{props:e}=this,{strings:t}=e;return(0,s.h)("calcite-button",{slot:"footer",onClick:this.goUpdate,appearance:"solid",width:"half","icon-start":"plus-square",ref:e=>this.nextButtonNode=e},t.general.update)}renderCancel(){const{props:e}=this,{layer:t,layerIds:i,strings:r}=e,o=(null==t?void 0:t.loaded)&&i.length;return(0,s.h)("calcite-button",{disabled:!o,onClick:o&&this.goCancel,appearance:"transparent",width:"full"},r.general.close)}renderInfo(){const{props:e}=this,{strings:t}=e;return(0,s.h)("div",{class:"info"},(0,s.h)("div",{class:"info-description"},t.general.includedLayerPanelDescription))}renderSublayers(){var e,t;const{props:i}=this,{layer:r,layerIds:o}=i,a=[];return"group"===r.type?(null===(e=r.tables)||void 0===e||e.forEach((e=>{o.includes(e.layerId)&&a.unshift(this.renderSublayer(e))})),null===(t=r.layers)||void 0===t||t.forEach((e=>{o.includes(e.layerId)&&a.unshift(this.renderSublayer(e))}))):a.push(this.renderSublayer(r)),(0,s.h)("calcite-list",{ref:e=>this.listNode=e},a)}renderSublayer(e){const{props:t}=this,{strings:i}=t,r="rtl"===(0,l.g)(this.hostElement),o=b(e.layerId,t);return(0,s.h)("calcite-list-item",{key:e.layerId,label:e.title,description:e.isTable?i.general.table:i.general.layer,onClick:this.goDefinition.bind(this,e.layerId),ref:t=>{t&&(this.listItemNodes[e.layerId]=t)}},o?(0,s.h)("calcite-icon",{class:"has-definition-icon",slot:"content-end",icon:"sliders",scale:"s"}):null,(0,s.h)("calcite-icon",{class:"definition-icon",slot:"content-end",icon:r?"chevron-left":"chevron-right",scale:"s"}))}renderLayerDefinition(){const{props:e,status:t}=this,{definitionLayerId:i}=e;return(0,s.h)("arcgis-layer-view-definition",{key:`definition-${i}`,props:e,status:t,class:"calcite-match-height",onArcgisLayerViewOverViewRefresh:()=>setTimeout((()=>{var e;return null===(e=this.listItemNodes[i])||void 0===e?void 0:e.setFocus()}),200)})}goDefinition(e){const{props:t}=this;this.status=m.DEFINITION,t.definitionLayerId=e,this.reRender=!this.reRender}async getLatestAdminServiceInfo(){this.props.adminServiceInfo=void 0,await F(this.props,!0),this.reRender=!this.reRender}get hostElement(){return(0,s.d)(this)}};fe.style=".flow.sc-arcgis-layer-view-overview{height:100%}.panel.sc-arcgis-layer-view-overview{height:100%}.info.sc-arcgis-layer-view-overview{display:grid;grid-template-columns:repeat(1, minmax(0px, 1fr));gap:0.5rem;pointer-events:none;padding:1rem 0.75rem}.info-description.sc-arcgis-layer-view-overview{font-size:var(--calcite-font-size--2);line-height:1.375;color:var(--calcite-ui-text-3);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);pointer-events:none}.has-definition-icon.sc-arcgis-layer-view-overview{color:var(--calcite-ui-border-1);cursor:pointer}.definition-icon.sc-arcgis-layer-view-overview{color:var(--calcite-ui-text-2);cursor:pointer}.footer.sc-arcgis-layer-view-overview{width:100%}.footer-top.sc-arcgis-layer-view-overview{display:flex}";const ve="info-heading",we=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewStatusChange=(0,s.c)(this,"arcgisLayerViewStatusChange",7),this.arcgisLayerViewSelectionCancel=(0,s.c)(this,"arcgisLayerViewSelectionCancel",7),this.goNext=()=>{const{props:e}=this,{layerIds:t}=e;this.arcgisLayerViewStatusChange.emit({status:m.OVERVIEW,layerIds:t})},this.goSwapSource=()=>{const{props:e}=this,{layerIds:t}=e;this.arcgisLayerViewStatusChange.emit({status:m.SWAP_SOURCE,layerIds:t})},this.onSelectionChange=()=>{const{props:e,hostElement:t}=this,{layer:i,strings:s}=e,r=[];this.listNode.querySelectorAll("calcite-pick-list-item").forEach((e=>{e.selected&&r.push(e.value),"group"===i.type?k(i).find((t=>t.layerId===e.value)).visible=e.selected:i.visible=e.selected})),r.length?this.props.layerIds=r:(this.msgNode=document.createElement("arcgis-layer-view-msg"),this.msgNode.props=e,this.msgNode.flowItemElement=this.flowItemNode,this.msgNode.message=s.msg.atLeastOne,this.msgNode.isWarning=!0,t.appendChild(this.msgNode),clearTimeout(this.timeoutHndl),this.timeoutHndl=setTimeout((()=>{this.timeoutHndl=void 0,this.msgNode&&(t.removeChild(this.msgNode),this.msgNode=void 0,this.reRender=!this.reRender)}),7e3),this.listNode.querySelectorAll("calcite-pick-list-item").forEach((t=>{e.layerIds.indexOf(t.value)>-1&&(t.selected=!0)}))),this.reRender=!this.reRender},this.props=void 0,this.status=void 0,this.reRender=!1}arcgisLayerViewMsgClosedHandler(){this.msgNode&&(this.hostElement.removeChild(this.msgNode),this.msgNode=void 0),clearTimeout(this.timeoutHndl),this.timeoutHndl=void 0,this.reRender=!this.reRender}async componentWillLoad(){}async componentDidLoad(){const{props:e}=this,{derivativeLayers:t}=e;t.hasAny?requestAnimationFrame((()=>{var e;return null===(e=this.swapButtonNode)||void 0===e?void 0:e.setFocus()})):requestAnimationFrame((()=>{var e;return null===(e=this.listNode)||void 0===e?void 0:e.setFocus()}))}render(){const{props:e,status:t}=this,{viewItem:i,layerItem:r,strings:o}=e,a="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow",{class:"flow",dir:(0,l.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{heading:(null==i?void 0:i.title)||(null==r?void 0:r.title),description:o.general.sourceLayer,class:{panel:!0,[l.C.rtl]:a},ref:e=>this.flowItemNode=e},this.renderFooterButtons(),this.renderInfo(),this.renderSublayers()),[m.SWAP_SOURCE,m.BROWSE_LAYER].includes(t)?this.renderSwapSource():null))}renderFooterButtons(){const{props:e}=this,{layer:t,layerIds:i,viewItem:r,derivativeLayers:o,hasReplicas:a,strings:n}=e,d="rtl"===(0,l.g)(this.hostElement),c=!((null==r?void 0:r.typeKeywords.indexOf("IoTFeatureLayer"))>-1)&&["admin","update"].indexOf(null==r?void 0:r.itemControl)>-1,h=(null==t?void 0:t.loaded)&&i.length&&!o.hasAny;return c&&o.hasAny?(0,s.h)("div",{slot:"footer",class:"footer"},(0,s.h)("calcite-button",{onClick:!a&&this.goSwapSource,disabled:a,appearance:"solid",width:"full",iconStart:"arrow-right-left",ref:e=>this.swapButtonNode=e},n.general.swapSource),(0,s.h)("calcite-button",{onClick:()=>this.arcgisLayerViewSelectionCancel.emit(),appearance:"transparent",width:"full"},n.general.close)):(0,s.h)("div",{slot:"footer",class:"footer"},(0,s.h)("calcite-button",{disabled:!h,onClick:h&&this.goNext,appearance:"solid",width:"full",iconEnd:d?"arrow-left":"arrow-right",ref:e=>this.nextButtonNode=e},n.general.next),c&&(0,s.h)("div",null,(0,s.h)("calcite-button",{disabled:!h||a,onClick:h&&!a&&this.goSwapSource,appearance:"transparent",width:"full",iconStart:"arrow-right-left",ref:e=>this.swapButtonNode=e},n.general.swapSource)))}renderInfo(){const{props:e}=this,{viewItem:t,derivativeLayers:i,hasReplicas:r,strings:o}=e,a=["admin","update"].indexOf(null==t?void 0:t.itemControl)>-1;return(0,s.h)("div",{class:"info"},i.hasAny?(0,s.h)("calcite-notice",{scale:"s",width:"full",open:!0,icon:"information"},(0,s.h)("div",{slot:"message"},o.general.derivativeLayerNotice)):null,r&&a?(0,s.h)("calcite-notice",{scale:"s",width:"full",open:!0,icon:"information"},(0,s.h)("div",{slot:"message"},o.general.selectLayerPanelReplicaNotice)):null,i.hasAny?null:(0,s.h)("div",null,(0,s.h)("div",{class:ve},o.general.selectLayerPanelTitle),(0,s.h)("div",{class:"info-description"},o.general.selectLayerPanelDescription)))}renderSublayers(){const{props:e}=this,{derivativeLayers:t}=e;return t.hasAny?this.renderNonEditableSublayers():this.renderEditableSublayers()}renderNonEditableSublayers(){var e,t;const{props:i}=this,{layer:r,layerIds:o,strings:a}=i,n=[],l=[];return"group"===r.type?(null===(e=r.tables)||void 0===e||e.forEach((e=>{o.indexOf(e.layerId)>-1&&l.unshift(this.renderNonEditableSublayer(e))})),null===(t=r.layers)||void 0===t||t.forEach((e=>{o.indexOf(e.layerId)>-1&&n.unshift(this.renderNonEditableSublayer(e))}))):(r.isTable?l:n).push(this.renderNonEditableSublayer(r)),(0,s.h)("div",{class:"info"},n.length>0?(0,s.h)("div",{class:ve},a.general.layers):null,n.length>0?(0,s.h)("ul",null,n):null,l.length>0?(0,s.h)("div",{class:ve},a.general.tables):null,l.length>0?(0,s.h)("ul",null,l):null)}renderNonEditableSublayer(e){return(0,s.h)("li",{class:"fixed-list-item"},e.title)}renderEditableSublayers(){var e,t;const{props:i}=this,{layer:r}=i,o=[];return"group"===r.type?(null===(e=r.tables)||void 0===e||e.forEach((e=>{o.unshift(this.renderEditableSublayer(e))})),null===(t=r.layers)||void 0===t||t.forEach((e=>{o.unshift(this.renderEditableSublayer(e))}))):o.push(this.renderEditableSublayer(r)),(0,s.h)("calcite-pick-list",{multiple:!0,onCalciteListChange:this.onSelectionChange,ref:e=>this.listNode=e},o)}renderEditableSublayer(e){const{props:t}=this,{layerIds:i,strings:r}=t;return(0,s.h)("calcite-pick-list-item",{key:e.layerId,label:e.title,value:e.layerId,description:e.isTable?r.general.table:r.general.layer,selected:i.indexOf(e.layerId)>-1})}renderSwapSource(){const{props:e,status:t}=this;return(0,s.h)("arcgis-layer-view-swap-source",{props:e,status:t,onArcgisLayerViewStatusChange:()=>setTimeout((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}),200)})}get hostElement(){return(0,s.d)(this)}};we.style=".flow.sc-arcgis-layer-view-selection{height:100%}.panel.sc-arcgis-layer-view-selection{height:100%}.footer.sc-arcgis-layer-view-selection{width:100%}.info.sc-arcgis-layer-view-selection{display:grid;grid-template-columns:repeat(1, minmax(0px, 1fr));gap:0.5rem;pointer-events:none;padding:1rem 0.75rem}.info-heading.sc-arcgis-layer-view-selection{font-size:var(--calcite-font-size--1);line-height:1.375;color:var(--calcite-ui-text-2);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);font-weight:var(--calcite-font-weight-medium);pointer-events:none}.info-description.sc-arcgis-layer-view-selection{font-size:var(--calcite-font-size--2);line-height:1.375;color:var(--calcite-ui-text-3);transition-duration:150ms;transition-timing-function:cubic-bezier(0.4, 0, 0.2, 1);pointer-events:none}.fixed-list-item.sc-arcgis-layer-view-selection{margin-bottom:10px}";const Ie="info",be="text",Le="check",Ee="check-text",Ne=class{constructor(e){(0,s.r)(this,e),this.arcgisLayerViewStatusChange=(0,s.c)(this,"arcgisLayerViewStatusChange",7),this.onBack=()=>{this.arcgisLayerViewStatusChange.emit({status:m.SELECTION})},this.goBrowse=()=>{this.arcgisLayerViewStatusChange.emit({status:m.BROWSE_LAYER})},this.props=void 0,this.status=void 0,this.reRender=!1,this.loading=!1}async componentDidLoad(){setTimeout((()=>requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))),200)}render(){const{props:e,status:t,loading:i}=this,{strings:r}=e,o="rtl"===(0,l.g)(this.hostElement);return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{key:t,heading:r.swapSource.title,description:r.swapSource.subTitle,loading:i,class:{panel:!0,[l.C.rtl]:o},onCalciteFlowItemBack:this.onBack,ref:e=>this.flowItemNode=e},this.renderInfo(),this.renderDerivativeInfo(),this.renderBrowse()),t===m.BROWSE_LAYER&&this.renderBrowseLayer())}renderInfo(){const{props:e}=this,{strings:t}=e;return(0,s.h)("div",{class:Ie},(0,s.h)("div",{class:be},t.swapSource.msg1),(0,s.h)("div",{class:be},t.swapSource.msg2),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-icon",{icon:"check",class:Le}),(0,s.h)("span",{class:Ee},t.swapSource.requirement1)),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-icon",{icon:"check",class:Le}),(0,s.h)("span",{class:Ee},t.swapSource.requirement2)),(0,s.h)("calcite-label",{layout:"inline"},(0,s.h)("calcite-icon",{icon:"check",class:Le}),(0,s.h)("span",{class:Ee},t.swapSource.requirement3)),(0,s.h)("div",{class:be},t.swapSource.msg3))}renderDerivativeInfo(){const{props:e}=this,{derivativeLayers:t,strings:i}=e;return t.hasMS||t.hasVTL||t.hasScene?(0,s.h)("div",{class:Ie},(0,s.h)("div",{class:be},i.swapSource.derivativeMsg)):null}renderBrowse(){const{props:e}=this,{strings:t}=e;return(0,s.h)("div",{class:"footer-button"},(0,s.h)("calcite-button",{id:"arcgis-layer-view-swap-source-browse",onClick:this.goBrowse,appearance:"outline-fill",width:"full",ref:e=>this.browseButtonNode=e},t.swapSource.browseForLayer))}renderBrowseLayer(){const{props:e}=this;return(0,s.h)("arcgis-layer-view-browse-layer",{props:e,class:"browse",onArcgisLayerViewStatusChange:e=>{e.detail.status===m.SWAP_SOURCE&&setTimeout((()=>{var e;return null===(e=document.getElementById("arcgis-layer-view-swap-source-browse"))||void 0===e?void 0:e.setFocus()}),400)}})}get hostElement(){return(0,s.d)(this)}};Ne.style=".panel.sc-arcgis-layer-view-swap-source{height:100%}.browse.sc-arcgis-layer-view-swap-source{width:100%}.info.sc-arcgis-layer-view-swap-source{margin:10px}.text.sc-arcgis-layer-view-swap-source{margin-bottom:8px}.check.sc-arcgis-layer-view-swap-source{color:green}.check-text.sc-arcgis-layer-view-swap-source{font-weight:bold}.footer-button.sc-arcgis-layer-view-swap-source{margin:0 10px 5px 10px}"},26426:(e,t,i)=>{i.d(t,{a:()=>d,b:()=>p,c:()=>r,d:()=>s,e:()=>o,f:()=>c,g:()=>u,i:()=>a,m:()=>n,t:()=>l,u:()=>h});const s=(e,t)=>{let i,s="idle";const r=(...r)=>new Promise((o=>{switch(s){case"flushed":s="idle",i?(clearTimeout(i),o(e(...r))):o(null);break;case"invoked":clearTimeout(i),s="idle",o(e(...r));break;case"cancelled":clearTimeout(i),s="idle",o(null);break;default:i&&clearTimeout(i),s="pending",i=setTimeout((()=>(s="idle",o(e(...r)))),t)}}));return r.flush=function(...e){return s="flushed",r(...e)},r.invoke=function(...e){return s="invoked",r(...e)},r.cancel=function(...e){return s="cancelled",r(...e)},r.getStatus=function(){return s},r},r=(e,t)=>{let i;return(...s)=>new Promise((r=>{i||(i=setTimeout((()=>{clearTimeout(i),i=void 0,r(e(...s))}),t))}))};function o(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function a(e){return null!=e}async function n(e,t){return await Promise.all([e,l(t)]),e}function l(e){return new Promise((t=>setTimeout(t,e)))}const d=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:i,data:s}=t(e);return[i,s]}))),c=(e,t)=>e.length===t.length&&e.reduce(((e,i)=>e&&t.indexOf(i)>-1),!0);function h(e,t){const i=[],s={};return e.forEach((e=>{const r=t(e);null==s[r]&&(s[r]=e,i.push(e))})),i}function p(e){const t={boolean:{},number:{},string:{}},i=[];return e.filter((e=>{let s=typeof e;return s in t?!t[s].hasOwnProperty(e)&&(t[s][e]=!0):!(i.indexOf(e)>=0)&&i.push(e)}))}const u=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((i,s)=>e.slice(t*s,t+t*s)))},27010:(e,t,i)=>{i.d(t,{c:()=>n});var s=i(28384);const r=e=>!("isConnected"in e)||e.isConnected,o=((e,t)=>{let i;return(...e)=>{i&&clearTimeout(i),i=setTimeout((()=>{i=0,(e=>{for(let t of e.keys())e.set(t,e.get(t).filter(r))})(...e)}),2e3)}})(),a=e=>"function"==typeof e?e():e,n=(e,t)=>{const i=((e,t=((e,t)=>e!==t))=>{const i=a(e);let s=new Map(Object.entries(null!=i?i:{}));const r={dispose:[],get:[],set:[],reset:[]},o=()=>{var t;s=new Map(Object.entries(null!==(t=a(e))&&void 0!==t?t:{})),r.reset.forEach((e=>e()))},n=e=>(r.get.forEach((t=>t(e))),s.get(e)),l=(e,i)=>{const o=s.get(e);t(i,o,e)&&(s.set(e,i),r.set.forEach((t=>t(e,i,o))))},d="undefined"==typeof Proxy?{}:new Proxy(i,{get:(e,t)=>n(t),ownKeys:e=>Array.from(s.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>s.has(t),set:(e,t,i)=>(l(t,i),!0)}),c=(e,t)=>(r[e].push(t),()=>{((e,t)=>{const i=e.indexOf(t);i>=0&&(e[i]=e[e.length-1],e.length--)})(r[e],t)});return{state:d,get:n,set:l,on:c,onChange:(t,i)=>{const s=c("set",((e,s)=>{e===t&&i(s)})),r=c("reset",(()=>i(a(e)[t])));return()=>{s(),r()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(c("set",t.set)),t.get&&e.push(c("get",t.get)),t.reset&&e.push(c("reset",t.reset)),t.dispose&&e.push(c("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{r.dispose.forEach((e=>e())),o()},reset:o,forceUpdate:e=>{const t=s.get(e);r.set.forEach((i=>i(e,t,t)))}}})(e,t);return i.use((()=>{if("function"!=typeof s.g)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const i=(0,s.g)();i&&((e,t,i)=>{const s=e.get(t);s?s.includes(i)||s.push(i):e.set(t,[i])})(e,t,i)},set:t=>{const i=e.get(t);i&&e.set(t,i.filter(s.f)),o(e)},reset:()=>{e.forEach((e=>e.forEach(s.f))),o(e)}}})()),i}},65508:(e,t,i)=>{i.d(t,{a:()=>s,i:()=>r});const s=(0,i(27010).c)({title:"",snippet:"",tags:[],categories:[]}),r=s.state},74828:(e,t,i)=>{var s,r;i.d(t,{a:()=>r,g:()=>n,l:()=>s,s:()=>a}),function(e){e.ARCGIS_COMPONENT_NOTIFICATIONS="arcgisComponent_notifications"}(s||(s={})),function(e){e.FEATURE_REDUCTION_WARNING_DISMISSED="arcgis_feature_reduction_warning_dismissed",e.POPUP_WARNING_DISMISSED="arcgis_popup_warning_dismissed",e.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED="arcgis_symbol_styler_incompatible_vector_symbols_dismissed",e.EFFECTS_TIP_DISMISSED="arcgis_effects_tip_dismissed",e.LAYER_VIEW_DEFINITION_DISMISSED="arcgis_layer_view_definition_dismissed",e.LAYER_OVERRIDE_STATUS_TIP_DISMISSED="arcgis_layer_override_status_tip_dismissed",e.LAYER_VIEW_JOIN_TIP_DISMISSED="arcgis_layer_view_join_tip_dismissed",e.MULTIDIMENSIONAL_INFO_TIP_DISMISSED="arcgis_multidimensional_info_tip_dismissed"}(r||(r={}));const o=e=>JSON.parse((e=>localStorage.getItem(e))(e))||{},a=(e,t)=>{const i=o(e);i[t.key]=t.value,((e,t)=>{localStorage.setItem(e,t)})(e,JSON.stringify(i))},n=(e,t)=>{const i=o(e);return(null==i?void 0:i.hasOwnProperty(t))?i[t]:null}},62727:(e,t,i)=>{i.d(t,{a:()=>a,g:()=>d});var s=i(18869),r=i(81068),o=i(28384);function a(e){var t,i,o;const a=null!==(t=(0,s.c)(e,"[lang]"))&&void 0!==t?t:null===(o=null===(i=e.shadowRoot)||void 0===i?void 0:i.ownerDocument)||void 0===o?void 0:o.documentElement,n=((null==a?void 0:a.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return r.l.has(n)?r.l.get(n):r.l.has(n.slice(0,2))?r.l.get(n.slice(0,2)):"en"}const n={};function l(e,t){const i=`${e}${t}`;return n[i]||(n[i]=function(e,t){return new Promise(((i,s)=>{fetch((0,o.a)(`../arcgis-app-assets/i18n/${e}.i18n.${t}.json`)).then((e=>{e.ok?i(e.json()):s()}),(()=>s()))}))}(e,t)),n[i]}async function d(e,t){const i=t||e.tagName.toLowerCase(),o=a(e),n=function(e){var t,i,o;const a=null!==(t=(0,s.c)(e,"[lang]"))&&void 0!==t?t:null===(o=null===(i=e.shadowRoot)||void 0===i?void 0:i.ownerDocument)||void 0===o?void 0:o.documentElement,n=((null==a?void 0:a.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return r.l.has(n)?r.l.get(n):r.l.has(n.slice(0,2))?n:"en"}(e);let d;try{d=await l(i,o)}catch(e){console.warn(`no locale for ${i} (${o}) loading default locale en.`),d=await l(i,"en")}return[d,o,n]}},3834:(e,t,i)=>{function s(e){const{customBaseUrl:t,portalHostname:i,urlKey:s}=e,{protocol:r}=window.location;return`${r}//${s?`${s}.${t}`:i}`}i.d(t,{g:()=>s})}}]);
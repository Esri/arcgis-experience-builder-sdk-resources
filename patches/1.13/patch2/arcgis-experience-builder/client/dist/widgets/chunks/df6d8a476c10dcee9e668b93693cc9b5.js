/*! For license information please see df6d8a476c10dcee9e668b93693cc9b5.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[99418],{99418:(e,i,t)=>{t.r(i),t.d(i,{arcgis_new_item_pages_home:()=>g});var n=t(28384),l=t(76134),r=t(48333),o=t(62381),s=t(65508),a=t(86739),u=t(58892),c=t(54871),d=t(76706),v=t(31546),p=t(47682),f=t(51510),m=t(59004);t(27010),t(41171),t(66716);const g=class{constructor(e){(0,n.r)(this,e),this.newItemUpdatePage=(0,n.c)(this,"newItemUpdatePage",7),this.allowedFileTypes=null,this.fileSelectHandler=async(e,i)=>{const{user:t,portal:n,config:{helpMap:o,helpBase:a},telemetry:d}=l.c,v=i?"your device":"drag drop",p={eventType:"new item click",pageName:"my content",category:"new item",label:v};null==d||d.logEvent(p),c.u.telemetryDetails=v;const{title:g,fileName:h,extension:w}=(0,r.s)(e);s.i.title=g,u.a.file=e,u.a.fileName=h,u.a.newItemMode="file",u.a.extension=w,u.a.selectedFields=void 0;const y=(0,f.f)(w),b="map"===c.u.workflow;if(1===y.length){const i=y[0].type;if("GeoJson"===i&&b&&!(0,m.a)(t,i,n)&&(0,f.i)(e.size))return void(this.error={description:c.u.i18n.publishSelect.bigGeoJsonHintPublicAccount,linkText:c.u.i18n.common.learnMore,link:`${a}${o[120003923]}`});u.a.type=i,["Microsoft Excel","CSV","GeoJson"].includes(i)&&(u.a.id=null,u.a.analyzeResults=null,u.a.selectedFields=null,"GeoJson"!==i&&(u.a.selectedSheet=null)),u.a.tileLayerPublishType="3DTiles Package"===i?"3dTiles":void 0;const r=y[0].nextStep,s=["CSV","Microsoft Excel"];b&&!(0,m.a)(t,i,n)&&s.includes(i)?(u.a.enablePublishing=!1,this.newItemUpdatePage.emit("publishSelect")):!(0,m.a)(t,i,n)||!l.c.allowPublish&&"publishSelect"===r?(u.a.enablePublishing=!1,this.newItemUpdatePage.emit("itemProperties")):this.newItemUpdatePage.emit(r)}else"zip"===w&&(this.newItemUpdatePage.emit("zipSelect"),u.a.applicationFile=null)},this.managedFocus=!0,this.error=void 0}componentWillLoad(){(0,d.a)();const{allowedItemTypes:e,user:i,portal:t}=l.c;if(e){const e=["CSV","GeoJson","KML"];this.allowedFileTypes=l.c.allowedItemTypes.filter((n=>(!(0,v.i)(n)||e.includes(n))&&!!i&&(e.includes(n)||!(0,o.n)(i)&&(0,m.a)(i,n,t))));const n=c.u.i18n;this.browserHelpText=(0,p.r)(n.common.supportFileTypes,this.allowedFileTypes.map((e=>{var i;return null!==(i=n.itemTypeInfo.lowercaseDisplayName[e])&&void 0!==i?i:e})).join(", "),"typeList")}"map"!==c.u.workflow||u.a.existingItem||this.removeExistingFile()}onTransitionComplete(){var e;null===(e=this.fileBrowserRef)||void 0===e||e.focusMainInput()}async removeExistingFile(){const e=u.a.id;e&&(u.a.id=null,await(0,a.d)(e,{permanentDelete:!0}))}render(){const e="map"===c.u.workflow,{allowedFileTypes:i,error:t,fileSelectHandler:r}=this,{portal:o,config:s,user:a,userLicensedItems:d}=l.c;return(0,n.h)(n.H,null,l.c.allowedModes.includes("file")&&(0,n.h)("arcgis-file-browser",{ref:e=>this.fileBrowserRef=e,class:{"full-height":e},allowedExtensions:i?(0,f.m)(i):void 0,helpText:this.browserHelpText,fullHeight:e,portal:o,config:s,user:a,userLicensedItems:d,onCloudDriveConnected:e=>{var i;const t=e.detail,n={eventType:"new item click",pageName:"my content",category:"new item",label:t};null===(i=l.c.telemetry)||void 0===i||i.logEvent(n),c.u.telemetryDetails=t,u.a.cloudProvider=t,this.newItemUpdatePage.emit("cloud")},onFileSelect:({detail:{file:e,source:i}})=>{r(e,"local-device"===i)}}),!e&&(0,n.h)("arcgis-new-item-create-layers-list",null),(0,n.h)("arcgis-new-item-alert",{description:null==t?void 0:t.description,link:{href:null==t?void 0:t.link,title:null==t?void 0:t.linkText},active:!!t,onAlertDismiss:()=>this.error=null}))}}},48333:(e,i,t)=>{t.d(i,{a:()=>r,f:()=>u,g:()=>a,s:()=>o,v:()=>s});var n=t(31546),l=t(48680);function r(e,i){const t=/(?:\.([^.]+))?$/;let n=e.replace(/^.*(\\|\/|:)/,""),r=n&&t.exec(n)[1]?t.exec(n)[1].toLowerCase():"",o="";if(n.indexOf(".rft.")>-1){const[e,i]=n.split(".rft.");r=`rft.${i}`,o=e}return n&&!o&&(o=-1===n.lastIndexOf(".")?n:n.substring(0,n.lastIndexOf("."))),o=o.replace(/\.|-/g,"_"),i&&(o=function(e){return`${e}_${(0,l.g)()}`}(o),n=`${o}.${r}`),{title:o,fileName:n,extension:r}}function o(e,i){return r(e.name,!!i)}function s(e,i){let t=e;const n=e.lastIndexOf("\\");return n>-1&&(t=t.substring(n+1,t.length)),t.replace(/\ /g,"_")===i.replace(/\ /g,"_")}function a(e){return n.a[e]?n.a[e]:n.a[Object.keys(n.a).find((i=>n.a[i].type===e))]}function u(e){if(!e)return"0 B";const i=Math.floor(Math.log(e)/Math.log(1024));return`${Math.round(e/Math.pow(1024,i))} ${["B","KB","MB","GB","TB"][i]}`}},48680:(e,i,t)=>{t.d(i,{g:()=>n});const n=()=>[2,1,1,1,3].map((e=>{let i="";for(let t=0;t<e;t++)i+=(65536*(1+Math.random())|0).toString(16).substring(1);return i})).join("-")},47682:(e,i,t)=>{t.d(i,{r:()=>l});const n={fileName:/\$\{fileName\}/g,fileType:/\$\{type\}/g,typeList:/\$\{typeList\}/g,missingFields:/\$\{\missingFields\}/g},l=(e,i,t)=>{const l=new RegExp(n[t]);return null==e?void 0:e.replace(l,i)}},51510:(e,i,t)=>{t.d(i,{a:()=>a,f:()=>r,i:()=>s,m:()=>o});var n=t(26426),l=t(31546);function r(e,i){let t;t=i?i.map((e=>e.type)):Object.keys(l.a);let n=[];return t.forEach((i=>{var t;(null===(t=l.a[i].fileExt)||void 0===t?void 0:t.indexOf(e))>=0&&n.push(l.a[i])})),n}function o(e){return e?(0,n.b)(e.flatMap((e=>{var i;return null===(i=l.a[e])||void 0===i?void 0:i.fileExt})).filter((e=>!!e))):null}const s=e=>e/1024/1024>50,a=e=>e/1024/1024>20},59004:(e,i,t)=>{t.d(i,{a:()=>k,b:()=>c,c:()=>S,d:()=>f,e:()=>m,f:()=>h,g:()=>d,h:()=>p,i:()=>w,j:()=>y,k:()=>P,l:()=>a,m:()=>I,n:()=>u,o:()=>T,p:()=>$,q:()=>o,r:()=>x,s:()=>b,t:()=>M,u:()=>C});var n=t(62381),l=t(76134),r=t(41171);async function o(){return new Promise((async e=>{const{portal:i}=l.c;if(null==i?void 0:i.isPortal){const t=i.helperServices.geocode,n=await function(e){const{config:i,portal:t}=l.c;return new Promise((async(n,l)=>{const o=e.filter((e=>s(e.url,t))).filter((e=>e.isEsriBatchGeocoder))[0];if(o){const e=o.url.split("/servers/")[1].split("/rest/services/")[0],t=`${i.restBaseUrl}/content/items/${e}`;try{n((await(0,r.r)(t)).url)}catch(e){l(e)}}else l("No world geocoder configured")}))}(t);e(n)}else{const t=function(e){const i=null==e?void 0:e.portalHostname;return-1!==i.indexOf("dev")?"dev":-1!==i.indexOf("qa")?"qa":""}(i);e(`https://geocode${t}.arcgis.com/arcgis/rest/services/World/GeocodeServer`)}}))}function s(e="",i){var t;const n=i.isPortal,l=e.toLowerCase(),r=l.indexOf("/geocodeserver")>-1&&l.indexOf("/rest/services/")>-1,o=n&&l.indexOf(null===(t=i.portalHostname)||void 0===t?void 0:t.toLowerCase())>-1,s=!n&&l.indexOf("utility")&&l.indexOf(".arcgis.com")>-1;return r&&(o||s)}function a(e){return(0,n.n)(e)||(null==e?void 0:e.privileges.includes("portal:user:createItem"))}function u(e){return(0,n.n)(e)||(null==e?void 0:e.privileges.includes("portal:user:receiveItems"))}function c(e,i){return!(0,n.n)(e)&&(null==e?void 0:e.privileges.includes("portal:publisher:publishFeatures"))&&(!i.isPortal||i.isBackedBySDS)}function d(e,i){return!(0,n.n)(e)&&(null==e?void 0:e.privileges.includes("portal:publisher:publishTiles"))&&(!i.isPortal||i.isBackedBySDS)}function v(e){return!(0,n.n)(e)&&!0}function p(e){var i;return!(0,n.n)(e)&&(null===(i=null==e?void 0:e.privileges)||void 0===i?void 0:i.includes("portal:publisher:publishScenes"))}const f=e=>!(0,n.n)(e);function m(e,i,t){var n,l;const r=!!(null===(l=null===(n=i.helperServices)||void 0===n?void 0:n.rasterAnalytics)||void 0===l?void 0:l.url),o=function(e,i,t){var n;return(null===(n=null==e?void 0:e.privileges)||void 0===n?void 0:n.includes("portal:publisher:publishDynamicImagery"))&&(i.isPortal||g(t))}(e,i,t),s=i.isPortal?o:o||function(e,i,t){var n;return(null===(n=null==e?void 0:e.privileges)||void 0===n?void 0:n.includes("portal:publisher:publishTiledImagery"))&&!i.isPortal&&g(t)}(e,i,t);return r&&s}function g(e){return null==e?void 0:e.some((e=>{var i;return null===(i=e.entitlements)||void 0===i?void 0:i.some((e=>"image"===e.toLowerCase()))}))}async function h(e){var i;const{userLicensedItems:t}=await(0,r.r)(`${null!==(i=e.restUrl)&&void 0!==i?i:e.portalUrl}/community/self?returnUserLicensedItems=true`);return t}function w(e,i){var t,l;const r=null===(t=i.helperServices)||void 0===t?void 0:t.geocode.some((({url:e})=>s(e,i))),o=null!==(l=null==e?void 0:e.privileges)&&void 0!==l?l:[];return!(0,n.n)(e)&&r&&(!i.isPortal||!i.isWebTierAuth&&o.includes("portal:user:viewOrgItems")&&o.includes("portal:user:createItem"))}const y=e=>!(0,n.n)(e);function b(e){return null==e?void 0:e.privileges.includes("premium:publisher:createAdvancedNotebooks")}function x(e){return null==e?void 0:e.privileges.includes("premium:publisher:createNotebooks")}function P(e,i){var t;return!!i.isPortal&&!!(null===(t=null==e?void 0:e.privileges)||void 0===t?void 0:t.includes("portal:publisher:registerDataStores"))}function I(e){return!(0,n.n)(e)&&(null==e?void 0:e.privileges.includes("premium:user:geocode"))}function S(e,i,t){return!i.isPortal&&c(e,i)&&function(e,i,t){return!(0,n.n)(e)&&!!i.supportsHostedServices&&a(e)&&(d(e,i)||c(e,i)||p(e)||v(e)||m(e,i,t))}(e,i,t)}function k(e,i,t){switch(i){case"CSV":case"GeoJson":case"Microsoft Excel":case"Shapefile":case"File Geodatabase":case"Photos with Locations":return c(e,t);case"Tile Package":return d(e,t);case"Vector Tile Package":return v(e);case"Scene Package":return p(e);case"Service Definition":return function(e,i){return c(e,i)&&d(e,i)}(e,t);default:return!0}}function T(e,i){var t;return(0,n.e)(e)||function(e){var i;return!!(null===(i=null==e?void 0:e.privileges)||void 0===i?void 0:i.includes("portal:admin:manageCredits"))}(e)||!!((null==e?void 0:e.assignedCredits)>-1&&(null===(t=null==i?void 0:i.portalProperties)||void 0===t?void 0:t.showCreditsOnProfile))}const $=e=>!1;function M(e){var i;return!!(null===(i=null==e?void 0:e.privileges)||void 0===i?void 0:i.includes("portal:admin:viewGroups"))}function C(e){return(0,n.e)(e)||function(e){var i;return!!(null===(i=null==e?void 0:e.privileges)||void 0===i?void 0:i.includes("portal:admin:viewUsers"))}(e)&&function(e){var i;return!!(null===(i=null==e?void 0:e.privileges)||void 0===i?void 0:i.includes("portal:admin:viewItems"))}(e)&&(function(e){var i;return!!(null===(i=null==e?void 0:e.privileges)||void 0===i?void 0:i.includes("portal:admin:updateItems"))}(e)||function(e){var i;return!!(null===(i=null==e?void 0:e.privileges)||void 0===i?void 0:i.includes("portal:admin:deleteItems"))}(e)||function(e){var i;return!!(null===(i=null==e?void 0:e.privileges)||void 0===i?void 0:i.includes("portal:admin:reassignItems"))}(e))}},76706:(e,i,t)=>{t.d(i,{a:()=>s,r:()=>o});var n=t(65508),l=t(58892),r=t(54871);function o(){l.d.reset(),n.a.reset()}const s=()=>{if(l.a.existingItem||"register"===r.u.workflow)return;l.d.reset();const e=n.i.folder;n.a.reset(),n.i.folder=e}}}]);
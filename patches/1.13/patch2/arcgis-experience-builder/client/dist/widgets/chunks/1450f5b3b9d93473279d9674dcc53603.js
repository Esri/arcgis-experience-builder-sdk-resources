/*! For license information please see 1450f5b3b9d93473279d9674dcc53603.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[84154],{84154:(e,i,n)=>{n.r(i),n.d(i,{arcgis_raster_multidimensional_info:()=>l});var t=n(28384),s=n(62727),o=n(74746),a=n(74828);n(18869),n(81068),n(66716),n(34077),n(72637);const l=class{constructor(e){(0,t.r)(this,e),this.keepActiveDimension=!0,this.showFilterLength=10,this.showRawSourceInfo=!0,this.layer=void 0,this.open=!0,this.showStatistics=!1,this.useTable=!0,this.multidimensionalInfo=void 0,this.selectedVariableNames=[]}watchLayer(e,i){this.closePopover(),this.multidimensionalInfo=null,this.selectedVariableNames=[],this.initLayer(e)}async componentWillLoad(){[this.strings]=await(0,s.g)(this.hostElement),this.initLayer(this.layer)}disconnectedCallback(){this.closePopover()}async done(){this.closePopover()}render(){var e,i,n;const{layer:s,multidimensionalInfo:o,strings:l}=this;if(!o){const e=!(null==s?void 0:s.loaded);return(0,t.h)(t.H,null,(0,t.h)("calcite-block",{class:"info",heading:l.multidimensionalInfo.info,collapsible:!0,open:!!this.open,loading:e},e?(0,t.h)("div",{class:"info-content"}):(0,t.h)("div",null,l.general.unsupported)))}const{variables:r}=o,c=null!==(i=null===(e=("imagery"===s.type?s.serviceRasterInfo:s.rasterInfo).keyProperties)||void 0===e?void 0:e.DefaultVariable)&&void 0!==i?i:r[0].name,u=[];r.forEach((({dimensions:e})=>e.forEach((e=>{u.some((i=>i.name===e.name))||u.push(e)}))));const d=u.map((({name:e,values:i})=>{const n="StdTime"===e?l.multidimensionalInfo.timeValues:"StdZ"===e?l.multidimensionalInfo.zValues:l.multidimensionalInfo.generalValues.replace("${dimensionName}",e),t=null==i?void 0:i.length;return t?`${n}: ${t}`:n})).join("; "),m=r.map((({name:e,dimensions:i})=>({name:e,dimensionNames:i.map((e=>e.name))}))),h=(null===(n=this.selectedVariableNames)||void 0===n?void 0:n.length)?r.filter((({name:e})=>this.selectedVariableNames.includes(e))):r,v=r.length>=this.showFilterLength&&(0,t.h)("calcite-filter",{items:m,messageOverrides:{clear:l.general.clear,label:l.multidimensionalInfo.searchVariables},placeholder:l.multidimensionalInfo.searchVariables,onCalciteFilterChange:e=>{const i=e.target.filteredItems;this.selectedVariableNames=i.map((({name:e})=>e))}}),f=(0,t.h)("div",{ref:e=>this.variableEL=e},(0,t.h)("calcite-label",null,`${l.multidimensionalInfo.variables}: ${r.length}; ${d}`),v,(0,t.h)("calcite-list",null,h.map((e=>this.renderVariableListItem(e,e.name===c))))),g=!(0,a.g)(a.l.ARCGIS_COMPONENT_NOTIFICATIONS,a.a.MULTIDIMENSIONAL_INFO_TIP_DISMISSED)&&(0,t.h)("calcite-notice",{open:!0,closable:!0,icon:!0,scale:"s",class:"notice",onCalciteNoticeClose:()=>{(0,a.s)(a.l.ARCGIS_COMPONENT_NOTIFICATIONS,{key:a.a.MULTIDIMENSIONAL_INFO_TIP_DISMISSED,value:"true"})}},(0,t.h)("div",{slot:"message"}," ",l.multidimensionalInfo.tip));return(0,t.h)(t.H,null,(0,t.h)("calcite-block",{class:"info",heading:l.multidimensionalInfo.info,collapsible:!0,open:!!this.open,onCalciteBlockToggle:e=>!e.target.open&&this.closePopover()},g,f,(0,t.h)("slot",null)))}renderVariableListItem(e,i){const{name:n,unit:s,description:o}=e,a=s?`${n} (${s})`:`${n}`;return(0,t.h)("calcite-list-item",{label:a,description:o,key:n,onClick:()=>this.renderPickListPopover(e)},(0,t.h)("calcite-action",{icon:"information",scale:"s",text:this.strings.general.close,slot:"actions-start",onClick:()=>this.renderPickListPopover(e)}),i?(0,t.h)("calcite-chip",{slot:"actions-end",value:void 0},(0,t.h)("span",{class:"default-variable"},this.strings.general.default)):null)}renderPickListPopover(e){if(this.popOver)return this.popOver.keepActiveDimension=this.keepActiveDimension,this.popOver.variableInfo=e,void this.popOver.setFocus("dismiss-button");const i=document.createElement("arcgis-raster-multidimensional-variable-info");i.keepActiveDimension=this.keepActiveDimension,i.variableInfo=e,i.showStatistics=this.showStatistics,i.useTable=this.useTable,i.strings=this.strings;let n=0;this.variableEL&&(n=this.variableEL.getBoundingClientRect().top-this.hostElement.getBoundingClientRect().top),i.popoverProps={refElement:this.hostElement,placement:"leading-start",offsetDistance:0,offsetSkidding:n,popoverWidth:100},i.addEventListener("arcgisRasterMultidimensionalVariableInfoDismiss",(e=>{this.closePopover()})),document.body.appendChild(i),i.componentOnReady().then((()=>{requestAnimationFrame((()=>i.setFocus("dismiss-button")))})),this.popOver=i}closePopover(){this.popOver&&(document.body.removeChild(this.popOver),this.popOver=null)}async initLayer(e){e&&(e.loaded||await e.load(),this.multidimensionalInfo=await(0,o.a)(e,this.showRawSourceInfo))}get hostElement(){return(0,t.d)(this)}static get watchers(){return{layer:["watchLayer"]}}};l.style=":host{display:flex;flex:1 1 auto}.info{width:100%}.info-content{height:var(--calcite-loader-size, 64px)}.default-variable{font-size:var(--calcite-font-size--2)}.notice{margin-bottom:10px}"},74828:(e,i,n)=>{var t,s;n.d(i,{a:()=>s,g:()=>l,l:()=>t,s:()=>a}),function(e){e.ARCGIS_COMPONENT_NOTIFICATIONS="arcgisComponent_notifications"}(t||(t={})),function(e){e.FEATURE_REDUCTION_WARNING_DISMISSED="arcgis_feature_reduction_warning_dismissed",e.POPUP_WARNING_DISMISSED="arcgis_popup_warning_dismissed",e.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED="arcgis_symbol_styler_incompatible_vector_symbols_dismissed",e.EFFECTS_TIP_DISMISSED="arcgis_effects_tip_dismissed",e.LAYER_VIEW_DEFINITION_DISMISSED="arcgis_layer_view_definition_dismissed",e.LAYER_OVERRIDE_STATUS_TIP_DISMISSED="arcgis_layer_override_status_tip_dismissed",e.LAYER_VIEW_JOIN_TIP_DISMISSED="arcgis_layer_view_join_tip_dismissed",e.MULTIDIMENSIONAL_INFO_TIP_DISMISSED="arcgis_multidimensional_info_tip_dismissed"}(s||(s={}));const o=e=>JSON.parse((e=>localStorage.getItem(e))(e))||{},a=(e,i)=>{const n=o(e);n[i.key]=i.value,((e,i)=>{localStorage.setItem(e,i)})(e,JSON.stringify(n))},l=(e,i)=>{const n=o(e);return(null==n?void 0:n.hasOwnProperty(i))?n[i]:null}},62727:(e,i,n)=>{n.d(i,{a:()=>a,g:()=>c});var t=n(18869),s=n(81068),o=n(28384);function a(e){var i,n,o;const a=null!==(i=(0,t.c)(e,"[lang]"))&&void 0!==i?i:null===(o=null===(n=e.shadowRoot)||void 0===n?void 0:n.ownerDocument)||void 0===o?void 0:o.documentElement,l=((null==a?void 0:a.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return s.l.has(l)?s.l.get(l):s.l.has(l.slice(0,2))?s.l.get(l.slice(0,2)):"en"}const l={};function r(e,i){const n=`${e}${i}`;return l[n]||(l[n]=function(e,i){return new Promise(((n,t)=>{fetch((0,o.a)(`../arcgis-app-assets/i18n/${e}.i18n.${i}.json`)).then((e=>{e.ok?n(e.json()):t()}),(()=>t()))}))}(e,i)),l[n]}async function c(e,i){const n=i||e.tagName.toLowerCase(),o=a(e),l=function(e){var i,n,o;const a=null!==(i=(0,t.c)(e,"[lang]"))&&void 0!==i?i:null===(o=null===(n=e.shadowRoot)||void 0===n?void 0:n.ownerDocument)||void 0===o?void 0:o.documentElement,l=((null==a?void 0:a.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return s.l.has(l)?s.l.get(l):s.l.has(l.slice(0,2))?l:"en"}(e);let c;try{c=await r(n,o)}catch(e){console.warn(`no locale for ${n} (${o}) loading default locale en.`),c=await r(n,"en")}return[c,o,l]}},74746:(e,i,n)=>{n.d(i,{a:()=>d,b:()=>c,c:()=>u,f:()=>l,g:()=>r,i:()=>m,m:()=>s,u:()=>h});var t=n(34077);const s=10.9;function o(e,i){const n=new Date(e),{useFriendlyISOFormat:t,intl:s,format:o}=i;if(t&&s)return s.formatDate(n,Object.assign(Object.assign({},s.convertDateFormatToIntlOptions(null!=o?o:"short-date-long-time")),{timeZone:"UTC"}));let a=new Date(e).toISOString();return a=a.slice(0,a.indexOf("."))+"Z",a}function a(e,i,n="long"){const t=new Date(2022,9,10);return t.setMonth(e-1),i.formatDate(t,{month:n})}function l(e,i,n={}){var t,s,l,r;if(null==e)return"";const{intl:c,useRecurringTimeLabel:u}=n;if(u&&c&&!Array.isArray(e)){const n=null===(t=i.intervalUnit)||void 0===t?void 0:t.toLowerCase().trim(),s=function(e){return"StdTime"===e.name&&!!e.recurring}(i)&&("months"===n||"quarters"===n);if(s)return"months"===n?a(e,c):function(e,i){return`${a(3*(e-1)+1,i,"short")} - ${a(3*e,i,"short")}`}(e,c)}const d=null===(s=i.values)||void 0===s?void 0:s[i.values.length-1];if(n.useStartOrEndForRangedValue&&Array.isArray(e)&&2===e.length&&Array.isArray(d)){const i=e.join("-")===d.join("-");e=i?e[1]:e[0]}if(!m(i))return Array.isArray(e)?e.map((e=>{var i;return null!==(i=null==c?void 0:c.formatNumber(e))&&void 0!==i?i:String(e)})).join(" - "):null!==(l=null==c?void 0:c.formatNumber(e))&&void 0!==l?l:String(e);if(n.useFriendlyISOFormat&&!n.format){let e=null===(r=i.intervalUnit)||void 0===r?void 0:r.toLowerCase().trim(),{interval:t,extent:s}=i;if("months"===e?t>11&&(e="year"):"days"===e?t>364?e="year":t>27&&(e="months"):"hours"===e&&(e="days"),!["years","months","days"].includes(e)&&(null==s?void 0:s.length)){const n=(s[1]-s[0])/i.values.length,t=864e5;n>=365*t?e="years":n>=28*t&&(e="months")}const o="years"===e?"year":"months"===e?"short-month-year":"short-date";n=Object.assign({format:o},n)}return Array.isArray(e)?e.map((e=>o(e,n))).join(" - "):o(e,n)}function r(e,i){var n;const s=null===(n=null==i?void 0:i.dimensions)||void 0===n?void 0:n.find((({name:i})=>i===e.name));if(!(null==s?void 0:s.extent))return e;const o=[...s.extent],a=e.values.filter((e=>Array.isArray(e)?(0,t.i)(o[1])&&o[0]!==o[1]?e[0]>=o[0]&&e[0]<=o[1]&&e[1]>=o[0]&&e[1]<=o[1]:e[0]===o[0]:e>=o[0]&&e<=o[1]));if(0===a.length){const i=e.values[e.values.length-1];Array.isArray(i)&&i[1]===o[0]&&a.push(i)}return Object.assign(Object.assign({},e),{extent:o,values:a})}function c(e){var i;const{values:n,extent:t,name:s}=e;let o=null!==(i=null==n?void 0:n[0])&&void 0!==i?i:t[0];return"stdz"===s.toLowerCase()&&!e.hasRanges&&Math.abs(t[1])<=Math.abs(t[0])&&(o=(null==n?void 0:n.length)?n[n.length-1]:t[1]),o}function u(e){var i,n;return"imagery-tile"===e.type?e.multidimensionalDefinition:null===(n=null!==(i=e.mosaicRule)&&void 0!==i?i:e._defaultServiceMosaicRule)||void 0===n?void 0:n.multidimensionalDefinition}async function d(e,i){var n,t;if("imagery-tile"===e.type)return e.rasterInfo.multidimensionalInfo;const{rasterFunction:o,version:a}=e;return i||a<=s||!o||"none"===(null===(n=o.functionName)||void 0===n?void 0:n.toLowerCase())?e.serviceRasterInfo.multidimensionalInfo:(null!==(t=await e.generateRasterInfo(e.rasterFunction))&&void 0!==t?t:e.serviceRasterInfo).multidimensionalInfo}function m(e,i=!1){return"StdTime"===e.name&&(i||!e.recurring)}function h(e,i,n){i=r(i,n);const t=l(e.values[0],i);if(!i.values.some((e=>t===l(e,i)))){const n=c(i);e.values=[n]}}}}]);
/*! For license information please see ea084d2c9d9c953793ccc26a4e238cf9.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[41597],{41597:(e,t,i)=>{i.r(t),i.d(t,{arcgis_popup:()=>S,arcgis_popup_arcade:()=>D,arcgis_popup_attachments:()=>H,arcgis_popup_attributes:()=>A,arcgis_popup_chart:()=>O,arcgis_popup_expressions:()=>N,arcgis_popup_field_pick_list:()=>B,arcgis_popup_image:()=>U,arcgis_popup_main_contentpopover:()=>V,arcgis_popup_multimedia:()=>$,arcgis_popup_relationship:()=>_,arcgis_popup_richtext:()=>z,arcgis_popup_title:()=>j});var s=i(28384),o=i(62727),a=i(72637),n=i(34077),l=i(66716),r=i(48680),p=i(22338),h=i(81068),c=i(26426),d=i(87247);i(18869),i(27010);const u=(e,t)=>{var i,s;const o=null===(s=null===(i=null==e?void 0:e.shadowRoot)||void 0===i?void 0:i.querySelector("input"))||void 0===s?void 0:s.selectionStart;return m(o)?[e.value.slice(0,o),`{${t}}`,e.value.slice(o)].join(""):`${e.value}{${t}}`},m=e=>null!=e,g=async(e,t,i)=>{var s,o,n,l,r;const p=null===(o=null===(s=e.capabilities)||void 0===s?void 0:s.queryRelated)||void 0===o?void 0:o.supportsCount,h=null===(l=null===(n=e.capabilities)||void 0===n?void 0:n.queryRelated)||void 0===l?void 0:l.supportsPagination;if([a.s.feature,a.s.scene].indexOf(i)>-1&&(null===(r=null==e?void 0:e.relationships)||void 0===r?void 0:r.length)&&p&&h)for(const i of e.relationships)for(const s of[...t.map.allLayers,...t.map.allTables]){const t=s;if(await f(e,t,i))return await t.load(),Promise.resolve(!0)}return Promise.resolve(!1)};function v(e){return"feature"===e.type&&e.url.toLocaleLowerCase().endsWith("/featureserver")?e.url.substring(0,e.url.length-14):"scene"===e.type&&e.url.toLocaleLowerCase().endsWith("/sceneserver")?e.url.substring(0,e.url.length-12):e.url}async function f(e,t,i){var s,o,a;const n=t.url?t.url===e.url||v(t)===v(e):"type"in t.parent&&"group"===t.parent.type&&(null===(o=null===(s=t.parent)||void 0===s?void 0:s.portalItem)||void 0===o?void 0:o.id)===(null===(a=e.portalItem)||void 0===a?void 0:a.id);return["feature","scene"].indexOf(t.type)>-1&&n&&!m(t.layerId)&&await t.load(),Promise.resolve(["feature","scene"].indexOf(t.type)>-1&&n&&t.layerId===i.relatedTableId)}function y(e,t,i){var s,o,a;const n=t.url?t.url===e.url||v(t)===v(e):"type"in t.parent&&"group"===t.parent.type&&(null===(o=null===(s=t.parent)||void 0===s?void 0:s.portalItem)||void 0===o?void 0:o.id)===(null===(a=e.portalItem)||void 0===a?void 0:a.id);return["feature","scene"].indexOf(t.type)>-1&&n&&t.layerId===i.relatedTableId}var P,C,b;!function(e){e.attributes="attributes",e.attachments="attachments",e.charts="charts",e.images="images",e.richText="richText",e.summaryET="summaryET",e.arcade="arcade",e.relationship="relationship"}(P||(P={})),function(e){e.image="image",e.barChart="bar-chart",e.columnChart="column-chart",e.lineChart="line-chart",e.pieChart="pie-chart"}(C||(C={})),function(e){e.preview="preview",e.list="list",e.auto="auto"}(b||(b={}));const I=(e,t,i)=>e||(t===a.l.cluster?T(i):x(i)),k=async(e,t,i,s,o)=>o===a.l.cluster?{id:"popup-feature-reduction",definitions:{$feature:{fields:(0,n.k)(s,!1)},$aggregatedFeatures:await w(t,e,s)}}:Object.assign(Object.assign({id:"popup"},(i===a.s.csv||i===a.s.geojson||i===a.s.mapImage||i===a.s.tile)&&{disabledVariables:["$layer","$map","$datastore"]}),{definitions:{$feature:e,$layer:e,$map:t.map,$datastore:e}}),L=async(e,t,i,s)=>{try{return i===a.l.cluster?{profileVariableInstances:{$feature:await(0,n.l)(t,e,s),$aggregatedFeatures:await w(t,e,s)},spatialReference:t.spatialReference,timeZone:t.timeZone}:{profileVariableInstances:{$feature:(await(0,n.m)(e,t)).features[0],$layer:e,$map:t.map,$datastore:e.url},spatialReference:t.spatialReference,timeZone:t.timeZone}}catch(e){console.log(e)}},w=async(e,t,i)=>{const s=await e.whenLayerView(t),o=s.createQuery();return o.aggregateIds=[(await(0,n.l)(e,t,i)).getObjectId()],s.queryFeatures(o)},x=e=>`// ${e.arcadeScriptLine1} \n// ${e.arcadeScriptLine2}\n// Average($feature.SalesQ1, $feature.SalesQ2, $feature.SalesQ3, $feature.SalesQ4)\n`,T=e=>`// ${e.clusterArcadeScriptLine3} \nExpects($aggregatedFeatures, "field1", "field2")\n\n// ${e.clusterArcadeScriptLine1} \n// ${e.clusterArcadeScriptLine2}\n// Count(Filter($aggregatedFeatures, "field1 = 'value'"))\n`,F=(e,t)=>{const i=`// ${t.arcadeContentClusterScriptLine} \nExpects($aggregatedFeatures, "field1", "field2")\n\n`,s=`/* \n${t.arcadeContentScriptLine1} \n${t.arcadeContentScriptLine2} \nhttps://developers.arcgis.com/arcade/guide/profiles/#popup-element \n*/\n\n${E()}`;return e===a.l.cluster?i+s:s},E=()=>"return { \n\ttype : 'text', \n\ttext : 'place your text or html here' //this property supports html tags \n}",M=(e,t,i,s)=>{const o=t,a=new i;return a.expression=e.script,a.title=e.title,a.name=((e,t)=>{var i;if(t)return t;if(null===(i=e.expressionInfos)||void 0===i?void 0:i.length){const t=e.expressionInfos[e.expressionInfos.length-1].name.match(/\d+$/);return(null==t?void 0:t[0])?`expr${Number(t[0])+1}`:`expr${e.expressionInfos.length}`}return"expr0"})(s,o),a.returnType="number"===e.predictOutputType?"number":"string",s.expressionInfos?o?s.expressionInfos.find(((e,t)=>{e.name===o&&(s.expressionInfos[t]=a)})):s.expressionInfos.push(a):s.expressionInfos=[a],a},R=async(e,t,i,s)=>{t===a.l.cluster?(i.featureReduction.popupTemplate.expressionInfos=[...e.expressionInfos],e.fieldInfos=((e,t)=>{var i;const s=[];return e.fieldInfos.forEach((e=>{e.fieldName.includes(a.f.expression)||s.push(e)})),null===(i=e.expressionInfos)||void 0===i||i.forEach((async e=>{const i=new t;i.fieldName=`${a.f.expression}${e.name}`,i.visible=!1,s.push(i)})),s})(e,s)):(i.popupTemplate.expressionInfos=[...e.expressionInfos],e.fieldInfos=[...await(0,p.g)(i,e)])},S=class{constructor(e){(0,s.r)(this,e),this.popupUpdated=(0,s.c)(this,"popupUpdated",7),this.arcgisPopupDismissedChange=(0,s.c)(this,"arcgisPopupDismissedChange",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.resetMultiMediaIndex=(0,s.c)(this,"resetMultiMediaIndex",7),this.mainPopupReRender=(0,s.c)(this,"mainPopupReRender",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.closeAttributePopovers=(0,s.c)(this,"closeAttributePopovers",7),this.attributesChangeNotification=(0,s.c)(this,"attributesChangeNotification",7),this.arcadeChangeNotification=(0,s.c)(this,"arcadeChangeNotification",7),this.attributeData=[],this.fieldData=[],this.richTextElements=[],this.popupHasAttachment=!1,this.layerHasAttributes=!0,this.layerHasCharts=!0,this.layerHasImages=!0,this.layerHasText=!0,this.isPopupOpenForCurrentLayer=!1,this.relatedRecordsDefaultCount=1,this.guidList=[],this.debouncedPopupUpdates=(0,c.d)((e=>{var t;this.serviceType!==a.s.wms&&(e&&(null===(t=this.layer)||void 0===t?void 0:t.popupTemplate)||(this.layerDisplayType===a.l.feature?this.layer.popupTemplate=this.popupTemplate.clone():this.layerDisplayType===a.l.cluster&&(this.layer.featureReduction.popupTemplate=this.popupTemplate.clone()))),this.popupUpdated.emit(this.layerDisplayType===a.l.mapNotes&&{mapNotesPopuptemplate:this.mapNotesPopupEnabled?this.popupTemplate.clone():null})}),1e3),this.manageExpressionBtnClick=e=>{e.stopPropagation(),this.closePopupPopovers.emit();const t=document.createElement("arcgis-popup-expressions");this.calciteFlowProps?this.calciteFlowProps.flow.appendChild(t):this.hostElement.shadowRoot.getElementById("popupFlow_Id").appendChild(t),setTimeout((()=>requestAnimationFrame((()=>t.setFocus()))),200)},this.popupTitleComponent=()=>(0,s.h)("arcgis-popup-title",{popupFlowItem:this.popupPanel}),this.fieldComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-attributes",{guid:e,popupContent:t,popupFlowItem:this.popupPanel,blockOpen:i})),this.attachmentComponent=(e,t,i)=>{var o,a,n;return(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-attachments",{guid:e,attachmentContent:t,layerSupportsResizeAttachments:!!(null===(n=null===(a=null===(o=this.layer)||void 0===o?void 0:o.capabilities)||void 0===a?void 0:a.operations)||void 0===n?void 0:n.supportsResizeAttachments),popupFlowItem:this.popupPanel,blockOpen:i}))},this.richtextComponent=(e,t,i)=>{var o,a;const n=null===(o=this.popupTemplate.toJSON().fieldInfos)||void 0===o?void 0:o.map((({fieldName:e,label:t})=>({name:e,alias:t||e})));this.fieldData=n||[];const l=null===(a=this.popupTemplate)||void 0===a?void 0:a.toJSON().expressionInfos,r=null==l?void 0:l.map((({expression:e,name:t,returnType:i,title:s})=>({name:`expression/${t}`,alias:"New expression"===s?" ":s,type:i,description:e})));return(null==r?void 0:r.length)&&(this.fieldData=this.fieldData.filter((e=>!r.some((t=>t.name===e.name))))),this.attributeData=r?[...r,...this.fieldData]:this.fieldData,(0,s.h)("div",{key:e,id:e,ref:e=>{e&&(this.richTextElements=[...this.richTextElements,e])}},(0,s.h)("arcgis-popup-richtext",{fieldExpressionData:{data:this.attributeData,placeholderText:this.strings.searchFields,heading:this.strings.selectField,label:this.strings.fieldsListPluginName,mapView:this.mapView,layer:this.layer},arcgisColorPickerData:{data:this.attributeData,filterPlaceholder:this.strings.searchAttributes,label:this.strings.colorPicker,doneText:this.strings.done,customText:this.strings.customText,attributeText:this.strings.attributeText},guid:e,richtextContent:t,popupFlowItem:this.popupPanel,blockOpen:i}))},this.multimediaComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-multimedia",{guid:e,multimediaContent:t,popupFlowItem:this.popupPanel,blockOpen:i})),this.arcadeComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-arcade",{guid:e,arcadeContent:t,blockOpen:i})),this.relationshipComponent=(e,t,i)=>(0,s.h)("div",{key:e,id:e},(0,s.h)("arcgis-popup-relationship",{guid:e,relatedRecordsContent:t,popupFlowItem:this.popupPanel,blockOpen:i})),this.mapView=void 0,this.layer=void 0,this.portal=void 0,this.displayPopup=!0,this.config=void 0,this.layerDisplayType=a.l.feature,this.dismissible=!1,this.backButton=!1,this.hideLayerTitle=!1,this.showConfigureFields=!1,this.showManageExpressions=!0,this.calciteFlowProps=null,this.mapNotesPopupTemplate=void 0,this.mapNotesGraphic=void 0,this.reRender=void 0,this.popupComponents=[],this.hasError=!1}async componentWillLoad(){var e,t,i;if((0,d.c)(d.p),[this.strings,this.currentLanguage,this.currentLanguageIntl]=await(0,o.g)(this.hostElement),this.serviceType=(0,n.c)(this.layer),await this.loadAllModules(),this.supportsArcade=this.showManageExpressions&&(this.layerDisplayType===a.l.feature||this.layerDisplayType===a.l.cluster)&&this.serviceType!==a.s.ogcFeature&&this.serviceType!==a.s.wfs&&this.serviceType!==a.s.imagery&&this.serviceType!==a.s.imageryTile&&this.serviceType!==a.s.subtype,this.serviceType===a.s.tile&&"url"in this.layer&&!("type"in this.layer)&&this.layer.url.indexOf(this.layer.layer.url)>-1)this.hasError=!0,console.error("popups not supported, no related feature service");else if(this.serviceType!==a.s.wms)if(this.layerDisplayType===a.l.feature){const s="type"in this.layer?this.layer.type:"sublayer",o=this.mapView.popup.visible?null===(e=this.mapView.popup.selectedFeature)||void 0===e?void 0:e.sourceLayer:void 0;this.isPopupOpenForCurrentLayer="subtype-sublayer"===s?(null==o?void 0:o.subtypeCode)===this.layer.subtypeCode&&(null==o?void 0:o.parent.id)===this.layer.parent.id:"sublayer"===s?(null==o?void 0:o.id)===this.layer.id&&(null==o?void 0:o.layer.id)===this.layer.layer.id:"id"in this.layer&&(null==o?void 0:o.id)===this.layer.id,m(null===(i=null===(t=this.layer.capabilities)||void 0===t?void 0:t.data)||void 0===i?void 0:i.supportsAttachment)&&(this.layerHasAttachment=this.layer.capabilities.data.supportsAttachment),this.layerHasET=!!this.layer.editFieldsInfo,d.p.layerHasRelatedRecords=await g(this.layer,this.mapView,this.serviceType),this.serviceType!==a.s.mapImage||this.layer.popupTemplate||(this.layer.popupEnabled=!1),this.popupTemplate=this.layer.popupTemplate?this.layer.popupTemplate.clone():this.layer.createPopupTemplate(),this.popupTemplate.fieldInfos=[...await(0,p.g)(this.layer,this.popupTemplate)]}else if(this.layerDisplayType===a.l.cluster)this.layerHasAttachment=!1,this.layerHasET=!1,this.popupTemplate=this.layer.featureReduction.popupTemplate.clone();else if(this.layerDisplayType===a.l.mapNotes){if(this.mapNotesPopupTemplate)this.mapNotesPopupEnabled=!0,this.popupTemplate=this.mapNotesPopupTemplate.clone();else{this.mapNotesPopupEnabled=!1;const[e]=await(0,l.l)(["esri/PopupTemplate"]);this.popupTemplate=new e}this.layerHasAttachment=!1,this.layerHasET=!1,this.layerHasAttributes=!1,this.layerHasCharts=!1}d.p.layer=this.layer,d.p.mapView=this.mapView,d.p.portal=this.portal,d.p.config=this.config,d.p.strings=this.strings,d.p.currentLanguage=this.currentLanguage,d.p.currentLanguageIntl=this.currentLanguageIntl,d.p.serviceType=this.serviceType,d.p.popupTemplate=this.popupTemplate,d.p.layerHasAttachment=this.layerHasAttachment,d.p.layerHasET=this.layerHasET,d.p.layerHasAttributes=this.layerHasAttributes,d.p.layerHasCharts=this.layerHasCharts,d.p.layerHasImages=this.layerHasImages,d.p.layerHasText=this.layerHasText,d.p.layerDisplayType=this.layerDisplayType,d.p.supportsArcade=this.supportsArcade}async componentDidLoad(){var e;if(this.popupTemplate){if("string"==typeof this.popupTemplate.content){const e=await(0,l.l)(["esri/popup/content/TextContent"]).then((([e])=>new e({text:this.popupTemplate.content})));this.popupTemplate.content=[e]}Array.isArray(this.popupTemplate.content)?this.popupTemplate.content.forEach(((e,t)=>{"attachments"!==e.type||this.layerHasAttachment?this.addToPopupComponents(e):this.popupTemplate.content.splice(t,1)})):console.error("content not supported"),this.reRender=!this.reRender}if(this.serviceType!==a.s.wms){this.layerDisplayType===a.l.feature&&this.watchForChangesToLayersList(),this.sortableComponents=this.hostElement.shadowRoot.getElementById("SortableComponents_Id"),this.calciteFab=(null===(e=this.calciteFlowProps)||void 0===e?void 0:e.calciteFab)||this.hostElement.shadowRoot.getElementById("addComponentBtn_Id");const t=this.getPopupEnabledProp();this.enableDisablePopup(t),this.setupResizeObserver(),this.calciteFab.onclick=e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.contentPopover||(this.contentPopover=document.createElement("arcgis-popup-main-contentpopover"),this.contentPopover.contentPopoverRefElement=this.calciteFab,this.contentPopover.popupHasAttachment=this.popupHasAttachment,this.contentPopover.popoverPanelWidth=this.hostElement.getBoundingClientRect().width,document.body.appendChild(this.contentPopover),this.calciteFab.disabled=!0,this.disablePopupPanel.emit(!0))}}requestAnimationFrame((()=>this.popupPanel.setFocus()))}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){var e,t;null===(e=this.parentShellObserver)||void 0===e||e.disconnect(),null===(t=this.watchLayersAndTables)||void 0===t||t.remove(),this.contentPopover&&document.body.removeChild(this.contentPopover)}async done(){var e;this.resetMultiMediaIndex.emit(),this.closePopupPopovers.emit(),null===(e=this.attributesComponent)||void 0===e||e.done(),this.showPreviewPopup(!1)}async setFocus(e){var t;null===(t=this.calciteFab)||void 0===t||t.setFocus()}calciteFlowItemBackHandler(e){e.stopPropagation(),this.closePopupPopovers.emit()}mainPopupReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}internalPopupUpdatedHandler(e){var t,i;e.stopPropagation(),this.singleFeature&&(null===(i=null===(t=this.mapView.popup)||void 0===t?void 0:t._flowItems)||void 0===i?void 0:i.length)&&(this.mapView.popup.features=void 0,setTimeout((()=>this.mapView.popup.features=[this.singleFeature]),1e3)),this.debouncedPopupUpdates(e.detail)}deleteComponentHandler(e){e.stopPropagation(),this.closePopupPopovers.emit();const t=this.sortableComponents.getElementsByTagName("div");for(let i=0;i<t.length;i++)if(t[i].id===e.detail){this.popupTemplate.content.splice(i,1),this.popupComponents.splice(i,1),this.guidList.splice(i,1);break}if(this.popupHasAttachment=this.popupTemplate.content.some((e=>{if("attachments"===e.type)return!0})),this.richTextElements){const t=this.richTextElements.filter((t=>t.id!==e.detail));this.richTextElements=t}this.mainPopupReRender.emit(),this.calciteFab.setFocus()}duplicateComponentHandler(e){e.stopPropagation(),this.closePopupPopovers.emit();const t=this.sortableComponents.getElementsByTagName("div");for(let i=0;i<t.length;i++)if(t[i].id===e.detail){const e=this.popupTemplate.content[i].clone();this.popupTemplate.content.push(e),this.addToPopupComponents(e,!0);break}}closePopupPopoversHandler(){this.contentPopover&&(document.body.removeChild(this.contentPopover),this.contentPopover=null,this.calciteFab.disabled=!1,requestAnimationFrame((()=>this.calciteFab.setFocus())),this.disablePopupPanel.emit(!1))}notifyAddContentSelectionHandler(e){e.stopPropagation(),this.closePopupPopovers.emit(),e.detail===P.summaryET?(this.popupTemplate.lastEditInfoEnabled=!0,this.mainPopupReRender.emit(),this.summaryETDiv.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.calciteFab.setFocus()):this.addPopupContents(e.detail)}disablePopupPanelHandler(e){var t;e.stopPropagation(),((null===(t=this.calciteFlowProps)||void 0===t?void 0:t.calciteFlowItem)||this.popupPanel).disabled=e.detail}async attributesUpdatedHandler(e){e.stopPropagation(),this.popupTemplate.fieldInfos=[...await(0,p.g)(this.layer,this.layer.popupTemplate||this.popupTemplate)],this.layer.popupTemplate.expressionInfos&&(this.popupTemplate.expressionInfos=[...this.layer.popupTemplate.expressionInfos],this.arcadeChangeNotification.emit()),this.attributesChangeNotification.emit(),this.mainPopupReRender.emit()}arcadeChangeNotificationHandler(){var e;if(this.richTextElements){const t=null===(e=this.popupTemplate)||void 0===e?void 0:e.toJSON().expressionInfos.map((({expression:e,name:t,returnType:i,title:s})=>({name:`expression/${t}`,alias:"New expression"===s?" ":s,type:i,description:e})));this.attributeData=t?[...t,...this.fieldData]:this.fieldData,this.richTextElements.forEach((e=>{const t=e.firstChild;t.arcgisColorPickerData.data=this.attributeData,t.fieldExpressionData.data=this.attributeData}))}this.mainPopupReRender.emit()}async loadAllModules(){[this.LayerOptions,this.reactiveUtils]=await(0,l.l)(["esri/popup/LayerOptions","esri/core/reactiveUtils"])}watchForChangesToLayersList(){var e,t;this.layerDisplayType===a.l.feature&&this.serviceType===a.s.feature&&(null===(t=null===(e=this.layer)||void 0===e?void 0:e.relationships)||void 0===t?void 0:t.length)&&(this.watchLayersAndTables=this.reactiveUtils.watch((()=>[this.mapView.map.allLayers.length,this.mapView.map.allTables.length]),(async()=>{d.p.layerHasRelatedRecords=await g(this.layer,this.mapView,this.serviceType)})))}enableDisablePopup(e){this.serviceType!==a.s.wms&&(this.hostElement.shadowRoot.getElementById("popupDiv_Id").style.display=e?"block":"none",this.calciteFab.style.display=e?"block":"none"),this.closePopupPopovers.emit()}getPopupEnabledProp(){switch(this.layerDisplayType){case a.l.feature:return(this.serviceType===a.s.wms||!!this.layer.popupTemplate)&&this.layer.popupEnabled;case a.l.cluster:return this.layer.featureReduction.popupEnabled;case a.l.mapNotes:return this.mapNotesPopupEnabled;default:return this.layer.popupEnabled}}reorder(e,t,i){const s=[...e];e.length=0,s.forEach(((s,o)=>{let a;i.forEach(((e,i)=>{t[o]===e&&(a=i)})),e[a]=s}))}addToPopupComponents(e,t=!1){const i=(0,r.g)();"fields"===e.type?(this.popupComponents=[...this.popupComponents,this.fieldComponent(i,e,t)],this.guidList=[...this.guidList,i]):"attachments"===e.type?(this.popupComponents=[...this.popupComponents,this.attachmentComponent(i,e,t)],this.popupHasAttachment=!0,this.guidList=[...this.guidList,i]):"media"===e.type?(this.popupComponents=[...this.popupComponents,this.multimediaComponent(i,e,t)],this.guidList=[...this.guidList,i]):"text"===e.type?(this.popupComponents=[...this.popupComponents,this.richtextComponent(i,e,t)],this.guidList=[...this.guidList,i]):"expression"===e.type?(this.popupComponents=[...this.popupComponents,this.arcadeComponent(i,e,t)],this.guidList=[...this.guidList,i]):"relationship"===e.type&&(this.popupComponents=[...this.popupComponents,this.relationshipComponent(i,e,t)],this.guidList=[...this.guidList,i])}async addPopupContents(e){const[t,i,s,o,n,r,p,h,c,d]=await(0,l.l)(["esri/popup/content/FieldsContent","esri/popup/content/AttachmentsContent","esri/popup/content/TextContent","esri/popup/content/MediaContent","esri/popup/content/ImageMediaInfo","esri/popup/content/ColumnChartMediaInfo","esri/popup/content/support/ImageMediaInfoValue","esri/popup/content/support/ChartMediaInfoValue","esri/popup/content/ExpressionContent","esri/popup/content/RelationshipContent"]);let u=null;if(e===P.attributes)u=new t({fieldInfos:null});else if(e===P.attachments)u=new i({displayType:null});else if(e===P.richText)u=new s({text:null});else if(e===P.images)u=new o({mediaInfos:[new n({title:"",caption:"",altText:"",value:new p({sourceURL:"",linkURL:""})})]});else if(e===P.charts)u=new o({mediaInfos:[new r({title:"",caption:"",altText:"",value:new h({fields:[]})})]});else if(e===P.arcade)u=new c({expressionInfo:{expression:F(this.layerDisplayType,this.strings)}});else if(e===P.relationship){const e=await(async(e,t,i)=>{var s;if([a.s.feature,a.s.scene].indexOf(i)>-1&&(null===(s=null==e?void 0:e.relationships)||void 0===s?void 0:s.length))for(const i of e.relationships)for(const s of[...t.map.allLayers,...t.map.allTables]){const t=s;if(await f(e,t,i))return await t.load(),{relationship:i,currLayer:t}}})(this.layer,this.mapView,this.serviceType);let t=e.currLayer.fields.find((e=>e.visible&&"date"===e.type));t||(t=e.currLayer.fields.find((e=>e.visible))),u=new d({displayCount:this.relatedRecordsDefaultCount,relationshipId:e.relationship.id,orderByFields:[{field:t.name,order:"asc"}]})}this.popupTemplate.content.push(u),this.addToPopupComponents(u,!0)}async showPreviewPopup(e){var t,i,s;this.displayPopup&&this.layerDisplayType===a.l.feature&&!this.isPopupOpenForCurrentLayer?e&&this.layer.popupEnabled&&this.layer.popupTemplate?((null===(i=null===(t=this.mapView.popup)||void 0===t?void 0:t.features)||void 0===i?void 0:i.length)&&(this.mapView.closePopup(),this.mapView.popup.features=void 0),this.previewPopupController=new AbortController,this.singleFeature=await(0,p.p)(this.mapView,this.layer,this.previewPopupController)):(null===(s=this.previewPopupController)||void 0===s||s.abort(),this.mapView.closePopup()):this.layerDisplayType===a.l.mapNotes&&(e?this.mapView.openPopup({features:[this.mapNotesGraphic],location:(0,n.o)(this.mapNotesGraphic.geometry)}):this.mapView.closePopup())}setupResizeObserver(){var e;const t=null===(e=this.hostElement)||void 0===e?void 0:e.parentElement;if("CALCITE-SHELL-PANEL"===(null==t?void 0:t.tagName)){const e=t;m(e.collapsed)&&(this.parentShellObserver=new ResizeObserver((()=>{e.collapsed?this.done():this.showPreviewPopup(!0)})),this.parentShellObserver.observe(e))}else this.showPreviewPopup(!0)}createLayerOptions(){var e,t;const i=this.popupTemplate.layerOptions||new this.LayerOptions;i.showNoDataRecords=null!==(e=i.showNoDataRecords)&&void 0!==e&&e,i.returnTopmostRaster=null===(t=i.returnTopmostRaster)||void 0===t||t,this.popupTemplate.layerOptions=i}render(){var e,t,i,o,l,r;if(this.hasError)return this.renderPopupError();const p=(0,s.h)("calcite-label",{class:"enable-popup",alignment:"start",layout:"inline-space-between"},this.strings.enablePopup,(0,s.h)("calcite-switch",{scale:"s",checked:this.getPopupEnabledProp(),onCalciteSwitchChange:e=>{const t=e.target.checked;switch(this.layerDisplayType){case a.l.feature:this.layer.popupEnabled=t;break;case a.l.cluster:this.layer.featureReduction.popupEnabled=t;break;case a.l.mapNotes:this.mapNotesPopupEnabled=t;break;default:this.layer.popupEnabled=t}this.enableDisablePopup(t),this.internalPopupUpdated.emit(!0),this.layerDisplayType!==a.l.mapNotes&&t&&!this.layer.popupTemplate&&(this.layer.popupTemplate=this.popupTemplate),this.showPreviewPopup(t)}})),c=(0,s.h)("calcite-button",{alignment:"icon-end-space-between",appearance:"transparent",kind:"neutral",iconEnd:"rtl"===(0,h.g)(this.hostElement)?"chevron-left":"chevron-right",label:this.strings.manageExpressions,width:"full",onClick:this.manageExpressionBtnClick},this.strings.manageExpressions),d=(0,s.h)("calcite-label",{alignment:"start",layout:"inline-space-between"},this.strings.ignoreNoData,(0,s.h)("calcite-switch",{scale:"s",checked:!(null!==(i=null===(t=null===(e=this.popupTemplate)||void 0===e?void 0:e.layerOptions)||void 0===t?void 0:t.showNoDataRecords)&&void 0!==i&&i),onCalciteSwitchChange:e=>{var t;const i=e.target.checked;(null===(t=this.popupTemplate)||void 0===t?void 0:t.layerOptions)||this.createLayerOptions(),this.popupTemplate.layerOptions.showNoDataRecords=!i,this.internalPopupUpdated.emit()}})),u=(0,s.h)("calcite-label",{alignment:"start",layout:"inline-space-between"},this.strings.displayTopmost,(0,s.h)("calcite-switch",{scale:"s",checked:null===(r=null===(l=null===(o=this.popupTemplate)||void 0===o?void 0:o.layerOptions)||void 0===l?void 0:l.returnTopmostRaster)||void 0===r||r,onCalciteSwitchChange:e=>{var t;const i=e.target.checked;(null===(t=this.popupTemplate)||void 0===t?void 0:t.layerOptions)||this.createLayerOptions(),this.popupTemplate.layerOptions.returnTopmostRaster=i,this.internalPopupUpdated.emit()}})),m=(0,s.h)("section",{class:"summary-et"},(0,s.h)("calcite-icon",{scale:"m",icon:"user"}),(0,s.h)("label",{class:"summary-et-label"},this.strings.summaryETHeading),(0,s.h)("calcite-action",{text:this.strings.remove,appearance:"transparent",icon:"x",class:"summary-et-action",onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.popupTemplate.lastEditInfoEnabled=!1,this.mainPopupReRender.emit(),this.calciteFab.setFocus()}})),g=(0,s.h)("calcite-fab",{id:"addComponentBtn_Id",icon:"plus",slot:"fab",scale:"s",appearance:"outline-fill",kind:"neutral",label:this.strings.addContent,text:this.strings.addContent,"text-enabled":!0}),v=(0,s.h)("calcite-button",{alignment:"icon-end-space-between",appearance:"transparent",kind:"neutral",iconEnd:"rtl"===(0,h.g)(this.hostElement)?"chevron-left":"chevron-right",label:this.strings.configureFields,width:"full",onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit();const t=document.createElement("calcite-flow-item");t.heading=this.strings.attributes,t.description=this.hideLayerTitle?void 0:this.layer.title,this.attributesComponent=document.createElement("arcgis-attributes"),this.attributesComponent.lang=this.currentLanguage,this.attributesComponent.layer=this.layer,this.attributesComponent.mapView=this.mapView,this.attributesComponent.portal=this.portal,this.attributesComponent.layerDisplayType=this.layerDisplayType,this.attributesComponent.config=this.config,this.attributesComponent.calciteFlowProps=!0,this.attributesComponent.displayPopup=!1,t.appendChild(this.attributesComponent),t.beforeBack=async()=>{this.closeAttributePopovers.emit()},this.calciteFlowProps?this.calciteFlowProps.flow.appendChild(t):this.hostElement.shadowRoot.getElementById("popupFlow_Id").appendChild(t),setTimeout((()=>requestAnimationFrame((()=>t.setFocus()))),200)}},this.strings.configureFields),f=()=>{var e,t,i;const o=this.layer,a=!!(null===(t=null===(e=o.capabilities)||void 0===e?void 0:e.operations)||void 0===t?void 0:t.supportsQuery)&&(null===(i=o.fields)||void 0===i?void 0:i.length),l=o.hasMultidimensions;return(0,s.h)("div",{class:"imagery-options"},d,(0,n.p)(o)>=10.8&&(a||l)&&u)},y=(0,s.h)("div",null,p,(0,s.h)("div",{id:"popupDiv_Id"},(()=>{const e=this.showConfigureFields,t=this.serviceType===a.s.imagery;if(e||this.supportsArcade||t)return(0,s.h)("calcite-block",{heading:this.strings.options,open:!0,collapsible:!0},t&&f(),this.supportsArcade&&c,e&&v)})(),this.popupTitleComponent(),(0,s.h)("div",{class:"component-ul"},(0,s.h)("calcite-sortable-list",{id:"SortableComponents_Id",style:{position:"relative"},onCalciteListOrderChange:e=>{e.stopPropagation(),this.sortableComponents=this.hostElement.shadowRoot.getElementById("SortableComponents_Id");const t=[],i=this.sortableComponents.getElementsByTagName("div");for(let e=0;e<i.length;e++)t.push(i[e].id);this.reorder(this.popupTemplate.content,this.guidList,t),this.reorder(this.popupComponents,this.guidList,t),this.guidList=t,this.internalPopupUpdated.emit()}},this.popupComponents)),(0,s.h)("div",{ref:e=>this.summaryETDiv=e},this.layerHasET&&this.popupTemplate.lastEditInfoEnabled&&m))),P=(0,s.h)("calcite-action",{text:this.strings.back,scale:"s",slot:"header-actions-start",ref:e=>this.backButtonEl=e,onClick:e=>{e.stopPropagation(),this.done(),this.arcgisPopupDismissedChange.emit()}},(0,s.h)("calcite-icon",{icon:"rtl"===(0,h.g)(this.hostElement)?"chevron-right":"chevron-left"}));return(0,s.h)(s.H,{style:this.calciteFlowProps?{}:{display:"flex",flex:"1 1 auto",overflow:"hidden"}},this.calciteFlowProps?(0,s.h)("div",{dir:(0,h.g)(this.hostElement),ref:()=>this.popupPanel=this.calciteFlowProps.calciteFlowItem},this.serviceType===a.s.wms?p:y):(0,s.h)("calcite-flow",{id:"popupFlow_Id",dir:(0,h.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{ref:e=>this.popupPanel=e,heading:this.strings.popupHeading,description:this.hideLayerTitle?void 0:this.layer.title,closable:this.dismissible,onCalciteFlowItemClose:e=>{e.stopPropagation(),this.done(),this.arcgisPopupDismissedChange.emit()}},this.serviceType===a.s.wms?p:y,this.serviceType!==a.s.wms&&g,this.backButton&&P)))}renderPopupError(){const e=(0,s.h)("div",{class:"notice"},(0,s.h)("calcite-notice",{open:!0,closable:!1,icon:"exclamation-mark-triangle",scale:"s"},(0,s.h)("div",{slot:"message"}," ",this.strings.popupTileError)));return(0,s.h)(s.H,{style:this.calciteFlowProps?{}:{display:"flex",flex:"1 1 auto",overflow:"hidden"}},this.calciteFlowProps?(0,s.h)("div",{dir:(0,h.g)(this.hostElement),ref:()=>this.popupPanel=this.calciteFlowProps.calciteFlowItem},e):(0,s.h)("calcite-flow",{id:"popupFlow_Id",dir:(0,h.g)(this.hostElement)},(0,s.h)("calcite-flow-item",{ref:e=>this.popupPanel=e,heading:this.strings.popupHeading,description:this.hideLayerTitle?void 0:this.layer.title,closable:this.dismissible,onCalciteFlowItemClose:e=>{e.stopPropagation(),this.done(),this.arcgisPopupDismissedChange.emit()}},e)))}get hostElement(){return(0,s.d)(this)}};S.style=".enable-popup{background-color:var(--arcgis-app-background);display:flex;padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-cap-spacing-half) var(--arcgis-app-cap-spacing-quarter);border-bottom:solid 1px var(--arcgis-app-border)}.component-ul{margin:0 0 var(--arcgis-app-cap-spacing);padding:0}.summary-et{display:flex;align-items:center;padding:0% var(--arcgis-app-cap-spacing-three-quarters)}.summary-et-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden;padding:0% var(--arcgis-app-cap-spacing-half);font-size:medium}.summary-et-action{margin:0;flex:0 0 0%;justify-self:flex-end}.notice{margin:0.5rem}.imagery-options{padding:0 var(--arcgis-app-cap-spacing-three-quarters)}";const D=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.guid=void 0,this.arcadeContent=void 0,this.blockOpen=!1,this.reRender=void 0}async componentWillLoad(){this.layer=d.p.layer,this.mapView=d.p.mapView,this.portal=d.p.portal,this.config=d.p.config,this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.serviceType=d.p.serviceType,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType}async componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),await this.launchArcade())}async launchArcade(){var e,t,i,s;this.arcadeEditor||(this.disablePopupPanel.emit(!0),this.arcadeEditor=document.createElement("arcgis-modal-arcade"),this.arcadeEditor.arcadeScript=I(null===(e=this.arcadeContent.expressionInfo)||void 0===e?void 0:e.expression,this.layerDisplayType,this.strings),this.arcadeEditor.arcadeProfile=await k(this.layer,this.mapView,this.serviceType,this.popupTemplate,this.layerDisplayType),this.arcadeEditor.testData=await L(this.layer,this.mapView,this.layerDisplayType,this.popupTemplate),this.arcadeEditor.suggestions=[{label:(s=this.strings).templates,suggestions:[{label:s.chartTemplate,code:"return {\n    type: 'media',\n    // title : 'The title for all media in the element',\n    // description : '',\n    attributes : {att1 : 2, att2 : 3, att3 : 4},  // replace this dictionary with your own key-value pairs,\n    mediaInfos: [{\n        type : 'piechart', //linechart | barchart | piechart | columnchart\n        title : 'give your chart a title',\n        // caption : '',\n        altText : '', //altText will be read by screen readers\n        value : {\n          fields: [\"att1\", \"att2\", \"att3\"],  // choose what attributes to use in the chart\n          /* colors: [  // values must be an array of [r, g, b, a] values (0-255)\n            [122, 190, 229, 255],\n            [179, 155, 213, 255],\n            [248, 174, 131, 255]\n          ], */\n          //normalizeField : '',  // the name of the attribute to normalize by or value\n        }\n      }]\n  }"},{label:s.fieldsListTemplate,code:"return {\n    type: 'fields',\n    //title: '',\n    //description : '',\n    fieldInfos:  [{\n          fieldName: \"att1\"  // fieldName should match the key in the attributes dictionary\n        },\n        {\n          fieldName: \"att2\"  // fieldName should match the key in the attributes dictionary\n        },\n        {\n          fieldName: \"att3\"  // fieldName should match the key in the attributes dictionary\n        }],\n    attributes : {att1 : 2, att2 : 3, att3 : 4}  // replace this dictionary with your own key-value pairs\n  }"},{label:s.richText,code:E()}]}],this.arcadeEditor.addExistingExpressions=!0,this.arcadeEditor.layer=this.layer,this.arcadeEditor.arcadeTitle=(null===(t=this.arcadeContent.expressionInfo)||void 0===t?void 0:t.title)||this.strings.arcadeDefaultTitle,this.arcadeEditor.arcadeTitleEditable=!0,this.arcadeEditor.returnPredictOutputType=!1,this.arcadeEditor.arcadeTitleEditingEnabled=!(null===(i=this.arcadeContent.expressionInfo)||void 0===i?void 0:i.title),document.body.appendChild(this.arcadeEditor),this.arcadeEditor.addEventListener("arcgisModalArcadeClose",(e=>this.arcadeSetup(e.detail))))}async arcadeSetup(e){e&&(this.arcadeContent.expressionInfo.expression=e.script,this.arcadeContent.expressionInfo.title=e.title,this.reRender=!this.reRender,this.internalPopupUpdated.emit()),this.disablePopupPanel.emit(!1),document.body.removeChild(this.arcadeEditor),this.arcadeEditor=null}render(){return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,h.g)(this.hostElement),heading:this.strings.arcade,description:this.arcadeContent.expressionInfo.title,collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0}})),(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:"code"})),(0,s.h)("div",{class:"ignore-elements-sortable"},(0,s.h)("calcite-button",{appearance:"transparent",width:"full",onClick:async()=>await this.launchArcade()},this.strings.editExpression))))}get hostElement(){return(0,s.d)(this)}},H=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.formInput=(e,t,i,o,a)=>{var n;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.attachmentContent.title=i:this.attachmentContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(n=this.popupTemplate.fieldInfos)||void 0===n?void 0:n.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.attachmentContent=void 0,this.layerSupportsResizeAttachments=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.layerSupportsResizeAttachments?this.attachmentContent.displayType||(this.attachmentContent.displayType=b.auto,this.internalPopupUpdated.emit()):this.attachmentContent.displayType=b.list,this.attachmentContent.title||(this.attachmentContent.title=""),this.attachmentContent.description||(this.attachmentContent.description="")}componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.blockOptions.setFocus())}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}closePopupPopoversHandler(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1))}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=u(this.contentTitle,i),this.contentTitle.setFocus(),this.attachmentContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=u(this.contentDescription,i),this.contentDescription.setFocus(),this.attachmentContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}render(){const e=(0,s.h)("calcite-label",null,this.strings.displayAttachmentsAs,(0,s.h)("calcite-segmented-control",{width:"full",scale:"s",disabled:!this.layerSupportsResizeAttachments,onCalciteSegmentedControlChange:e=>{const t=e.target.selectedItem;this.attachmentContent.displayType=t.value,this.reRender=!this.reRender}},(0,s.h)("calcite-segmented-control-item",{value:b.auto,iconStart:"check",checked:this.attachmentContent.displayType===b.auto},this.strings.auto),(0,s.h)("calcite-segmented-control-item",{value:b.list,iconStart:"list",checked:this.attachmentContent.displayType===b.list},this.strings.list),(0,s.h)("calcite-segmented-control-item",{value:b.preview,iconStart:"image",checked:this.attachmentContent.displayType===b.preview},this.strings.gallery)),(0,s.h)("calcite-label",{scale:"s"},(()=>{switch(this.attachmentContent.displayType){case b.auto:return this.strings.autoDisplayMessage;case b.list:return this.strings.listDisplayMessage;case b.preview:return this.strings.previewDisplayMessage;default:return this.strings.listDisplayMessage}})())),t=(0,s.h)("div",{class:"list-warning-div"},(0,s.h)("label",{class:"list-warning-label"},(0,s.h)("span",{class:"list-warning-icon"},(0,s.h)("calcite-icon",{scale:"s",icon:"exclamation-mark-triangle"})),(0,s.h)("span",{class:"list-warning-text"},this.strings.layerOnlySupportsListView)));return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,h.g)(this.hostElement),heading:this.strings.attachments,description:this.attachmentContent.title&&`${this.attachmentContent.title.substring(0,25)}${this.attachmentContent.title.length>25?"...":""}`||(()=>{switch(this.attachmentContent.displayType){case b.auto:return this.strings.auto;case b.list:return this.strings.list;case b.preview:return this.strings.gallery;default:return this.strings.list}})(),collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,calciteBlockOptions:{hasDelete:!0}})),(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:"attachment"})),(0,s.h)("div",{class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.attachmentContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.attachmentContent.description,this.strings.enterDescription),e,this.layerSupportsResizeAttachments?null:t)))}get hostElement(){return(0,s.d)(this)}};H.style=".list-warning-div{background-color:var(--arcgis-app-background)}.list-warning-label{align-items:stretch;background-color:var(--arcgis-app-background);border-radius:var(--arcgis-app-border-radius);border:1px solid var(--arcgis-app-border);display:flex;font-size:var(--arcgis-app-font-size--2)}.list-warning-icon{align-items:center;background-color:var(--arcgis-app-background-content);display:flex;padding:0 var(--arcgis-app-side-spacing-half)}.list-warning-text{padding:var(--arcgis-app-cap-spacing-quarter) var(--arcgis-app-side-spacing-half)}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}";const A=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.pickList=[],this.arcadeExpMap=new Map,this.manageBtnClick=e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.popupFieldManagePickList||(this.popupFieldManagePickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldManagePickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldManagePickList.selectedFields=this.getSelectedFields(),this.popupFieldManagePickList.showCancel=!1,this.popupFieldManagePickList.multiple=!0,this.popupFieldManagePickList.heading=this.strings.selectFields,this.popupFieldManagePickList.okBtnText=this.strings.done,this.popupFieldManagePickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldManagePickList.addEventListener("arcgisPopupPickListChange",this.popupFieldManagePickListChanges),document.body.appendChild(this.popupFieldManagePickList),this.disablePopupPanel.emit(!0))},this.popupFieldManagePickListChanges=e=>{var t;e.stopPropagation();const i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields,s=[];this.setupFieldMapInfo(),i.forEach((e=>{var t;if(this.fieldInfoMap.has(e)){const i=null===(t=this.fieldInfoMap.get(e))||void 0===t?void 0:t.clone();i.visible=!0,s.push(i)}})),this.popupContent.fieldInfos=[...s],this.reRender=!this.reRender},this.calcitePickList=e=>(0,s.h)("calcite-value-list-item",{key:e.fieldName,label:(0,n.b)(e,this.arcadeExpMap),value:e.fieldName},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:()=>this.removeBtnClick(e.fieldName)},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.formInput=(e,t,i,o,a)=>{var n;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.popupContent.title=i:this.popupContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(n=this.popupTemplate.fieldInfos)||void 0===n?void 0:n.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.popupContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}async componentWillLoad(){this.layer=d.p.layer,this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType,this.popupContent.fieldInfos||(this.popupContent.fieldInfos=await this.getFieldsContent()),this.popupContent.title||(this.popupContent.title=""),this.popupContent.description||(this.popupContent.description="")}componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.blockOptions.setFocus(),this.internalPopupUpdated.emit())}componentWillRender(){this.arcadeExpMap=(0,n.e)(this.popupTemplate),this.setupFieldMapInfo(),this.pickList=[],this.popupContent.fieldInfos.forEach((e=>{this.pickList.push(this.calcitePickList(e))}))}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.popupFieldManagePickList&&document.body.removeChild(this.popupFieldManagePickList),this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}arcadeChangeNotificationHandler(){this.reRender=!this.reRender}async attributesChangeNotificationHandler(){this.popupContent.fieldInfos.forEach(((e,t)=>{this.fieldInfoMap.has(e.fieldName)&&(this.popupContent.fieldInfos[t]=this.fieldInfoMap.get(e.fieldName).clone(),this.popupContent.fieldInfos[t].visible=!0)})),this.reRender=!this.reRender}closePopupPopoversHandler(){this.popupFieldManagePickList&&(document.body.removeChild(this.popupFieldManagePickList),this.popupFieldManagePickList=null,this.blockOptions.setFocus(),this.disablePopupPanel.emit(!1)),this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1))}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}calciteListOrderChangeHandler(e){const t=e.detail,i=[];t.forEach((e=>{this.popupContent.fieldInfos.find((t=>{if(t.fieldName===e)return i.push(t)}))})),this.popupContent.fieldInfos=i,this.internalPopupUpdated.emit()}async getFieldsContent(){var e,t;let i=[];if(this.checkForCreateFieldsContent()){const[s]=await(0,l.l)(["esri/support/popupUtils"]),o=null===(t=s.createFieldsContent({fields:await(0,n.j)(this.layer),objectIdField:this.layer.objectIdField,editFieldsInfo:(null===(e=this.layer)||void 0===e?void 0:e.editFieldsInfo)||null}))||void 0===t?void 0:t.fieldInfos;!this.fieldInfoMap&&this.setupFieldMapInfo(),o.forEach((e=>{if(this.fieldInfoMap.has(e.fieldName)){const t=this.fieldInfoMap.get(e.fieldName);i.push(t.clone()),i[i.length-1].visible=!0}})),this.popupTemplate.fieldInfos.forEach((e=>{(e.fieldName.includes(a.f.expression)||e.fieldName.includes(a.f.relationship))&&e.visible&&i.push(e.clone())}))}else this.popupTemplate.fieldInfos.forEach((e=>{e.visible&&i.push(e.clone())}));return i}checkForCreateFieldsContent(){var e,t,i;return this.layerDisplayType===a.l.feature&&("fields"!==(null===(t=null===(e=this.popupTemplate)||void 0===e?void 0:e.content[0])||void 0===t?void 0:t.type)||!!(null===(i=this.popupTemplate.content[0])||void 0===i?void 0:i.fieldInfos))}removeBtnClick(e){this.closePopupPopovers.emit(),this.popupContent.fieldInfos.find(((t,i)=>{if(t.fieldName===e)return this.popupContent.fieldInfos.splice(i,1)})),this.reRender=!this.reRender}getSelectedFields(){const e=[];return this.popupContent.fieldInfos.forEach((t=>{e.push(t.fieldName)})),e}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=u(this.contentTitle,i),this.contentTitle.setFocus(),this.popupContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=u(this.contentDescription,i),this.contentDescription.setFocus(),this.popupContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}setupFieldMapInfo(){this.fieldInfoMap=new Map(this.popupTemplate.fieldInfos.map((e=>[e.fieldName,e])))}render(){return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,h.g)(this.hostElement),heading:this.strings.fieldsList,description:this.popupContent.title&&`${this.popupContent.title.substring(0,25)}${this.popupContent.title.length>25?"...":""}`||`${this.popupContent.fieldInfos.length}/${this.popupTemplate.fieldInfos.length} ${this.strings.attributes_L}`,collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0}})),(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:"feature-details"})),(0,s.h)("div",{class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.popupContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.popupContent.description,this.strings.enterDescription),(0,s.h)("calcite-button",{class:"manage-btn",appearance:"transparent",scale:"m",width:"full",id:"openManageAttributes_Id",onClick:this.manageBtnClick},this.strings.selectAttributes),(0,s.h)("calcite-value-list",{"drag-enabled":!0},this.pickList))))}get hostElement(){return(0,s.d)(this)}};A.style=".manage-btn{justify-content:flex-end;margin:4px 0}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}";const O=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.chartChangedReRender=(0,s.c)(this,"chartChangedReRender",7),this.notifyMultiMediaChange=(0,s.c)(this,"notifyMultiMediaChange",7),this.lastColors={},this.pickList=[],this.arcadeExpMap=new Map,this.colorNodes=[],this.popupFieldManagePickListChanges=e=>{var t,i,o,a,n,l,r,p,h,c;const{esriLang:d,esriColor:u,rendererColors:m}=this;e.stopPropagation();const g=this.chartMediaInfo.value.fields,v=e.detail.selectedFields;if(this.chartMediaInfo.value.fields=v,this.chartMediaInfo.type===C.lineChart){if((null===(t=this.chartMediaInfo.value.fields)||void 0===t?void 0:t.length)&&!(null===(i=this.chartMediaInfo.value.colors)||void 0===i?void 0:i.length)){const e=this.getDefaultColorScheme();this.colors=[e.colors[0]],this.chartMediaInfo.value.colors=d.clone(this.colors),(0,s.f)(this.hostElement)}else!(null===(o=this.chartMediaInfo.value.fields)||void 0===o?void 0:o.length)&&(null===(a=this.chartMediaInfo.value.colors)||void 0===a?void 0:a.length)&&(this.colors=void 0,this.chartMediaInfo.value.colors=void 0,(0,s.f)(this.hostElement));if(null===(n=this.lastColors.rampColors)||void 0===n?void 0:n.length){const e=this.getDefaultColorScheme();this.lastColors.rampColors=null===(l=this.chartMediaInfo)||void 0===l?void 0:l.value.fields.map(((t,i)=>{var s;const o=g.indexOf(t);return o>-1&&(null===(s=this.lastColors.rampColors)||void 0===s?void 0:s[o])||new u(e.colors[i%10])||new u([0,0,0,1])}))}}else if(null===(r=this.chartMediaInfo.value.fields)||void 0===r?void 0:r.length){const e=this.getDefaultColorScheme();this.colors=null===(p=this.chartMediaInfo)||void 0===p?void 0:p.value.fields.map(((t,i)=>{var s;const o=g.indexOf(t);return o>-1&&(null===(s=this.colors)||void 0===s?void 0:s[o])||(m.get(t)?d.clone(m.get(t)[0]):new u(e.colors[i%10])||new u([0,0,0,1]))})),(null===(h=this.chartMediaInfo.value.colors)||void 0===h?void 0:h.length)?this.chartMediaInfo.value.colors=d.clone(this.colors):(this.colors=[],this.setColors(),(0,s.f)(this.hostElement)),(null==g?void 0:g.length)?this.colorButtonNode&&(0,s.f)(this.colorButtonNode):(0,s.f)(this.hostElement)}else this.colors=void 0,this.chartMediaInfo.value.colors=void 0,(0,s.f)(this.hostElement);this.chartChangedReRender.emit(),(null==g?void 0:g.length)&&(null===(c=this.chartMediaInfo.value.fields)||void 0===c?void 0:c.length)||(0,s.f)(this.hostElement)},this.fieldPickListChanges=e=>{var t,i;e.stopPropagation();const s=null===(i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields)||void 0===i?void 0:i[0];s&&(this.chartMediaInfo.value.normalizeField=s,this.chartChangedReRender.emit()),this.closePopupPopovers.emit(this.guid),this.normalizeBtn.focus()},this.popupFieldSelectionPickListChanges=(e,t)=>{const i=e.detail.selectedFields[0];"title"===t?(this.editChartTitle.value=u(this.editChartTitle,i),this.chartMediaInfo.title=this.editChartTitle.value,this.editChartTitle.setFocus()):"caption"===t?(this.editChartCaption.value=u(this.editChartCaption,i),this.chartMediaInfo.caption=this.editChartCaption.value,this.editChartCaption.setFocus()):"altText"===t&&(this.editAltText.value=u(this.editAltText,i),this.chartMediaInfo.altText=this.editAltText.value,this.editAltText.setFocus()),this.closePopupPopovers.emit(this.guid),this.chartChangedReRender.emit()},this.chartFormInput=e=>{var t;return(0,s.h)("calcite-label",{scale:"s"},(()=>"title"===e?this.strings.title:"caption"===e?this.strings.caption:"altText"===e?this.strings.description:void 0)(),(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:t=>(t.addEventListener("calciteInputChange",(t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.chartMediaInfo.title=i:"caption"===e?this.chartMediaInfo.caption=i:"altText"===e&&(this.chartMediaInfo.altText=i),this.chartChangedReRender.emit()})),"title"===e?this.editChartTitle=t:"caption"===e?this.editChartCaption=t:"altText"===e?this.editAltText=t:void 0),value:(()=>"title"===e?this.chartMediaInfo.title:"caption"===e?this.chartMediaInfo.caption:"altText"===e?this.chartMediaInfo.altText:void 0)(),placeholder:(()=>"title"===e?this.strings.imageTitlePlaceHolder:"caption"===e?this.strings.imageCaptionPlaceHolder:"altText"===e?this.strings.describeChart:void 0)(),onClick:()=>this.closePopupPopovers.emit(this.guid)}),(null===(t=this.popupTemplate.fieldInfos)||void 0===t?void 0:t.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,"text-display":"hidden",onClick:()=>{var t;this.closePopupPopovers.emit(this.guid),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.panelElement},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit(this.guid)})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.panelElement.disabled=!0)},scale:"s",icon:"brackets-curly"})))},this.calcitePickList=(e,t)=>(0,s.h)("calcite-list-item",{key:e.fieldName,label:(0,n.b)(e,this.arcadeExpMap),value:e.fieldName},this.renderColorIcon(t),(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:()=>{var t,i,o;this.closePopupPopovers.emit(this.guid),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),(null===(i=this.chartMediaInfo.value.colors)||void 0===i?void 0:i.length)?this.chartMediaInfo.value.fields.forEach(((t,i)=>{var o;t===e.fieldName&&(this.chartMediaInfo.value.fields.splice(i,1),this.chartMediaInfo.type!==C.lineChart&&(this.chartMediaInfo.value.colors.splice(i,1),this.colors.splice(i,1),this.colorButtonNode&&(0,s.f)(this.colorButtonNode)),(null===(o=this.lastColors.rampColors)||void 0===o?void 0:o.length)&&this.lastColors.rampColors.splice(i,1))})):(this.chartMediaInfo.value.fields.forEach(((t,i)=>{t===e.fieldName&&this.chartMediaInfo.value.fields.splice(i,1)})),this.colors=[],this.setColors(),(0,s.f)(this.hostElement)),this.chartChangedReRender.emit(),(null===(o=this.chartMediaInfo.value.fields)||void 0===o?void 0:o.length)||(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.guid=void 0,this.chartMediaInfo=void 0,this.mediaContent=void 0,this.mediaIndexPosition=void 0,this.refElement=void 0,this.isOpen=!1,this.reRender=void 0}async componentWillLoad(){var e;this.layer=d.p.layer,this.mapView=d.p.mapView,this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType,this.chartMediaInfo.title=this.chartMediaInfo.title||"",this.chartMediaInfo.altText=this.chartMediaInfo.altText||"",this.chartMediaInfo.caption=this.chartMediaInfo.caption||"";const[t,i,s,o]=await(0,l.l)(["esri/core/lang","esri/Color","esri/smartMapping/symbology/pieChart","esri/renderers/support/utils"]);if(this.esriLang=t,this.esriColor=i,this.pieChartSchemes=s,this.rendererUtils=o,"renderer"in this.layer){let e;e=this.layerDisplayType===a.l.cluster?this.layer.featureReduction.renderer:this.layer.renderer,["class-breaks","dot-density","heatmap","pie-chart","simple","unique-value"].indexOf(e.type)>-1&&(this.rendererColors=await this.rendererUtils.getColorsFromRenderer(e))}this.colors=t.clone(null===(e=this.chartMediaInfo)||void 0===e?void 0:e.value.colors)||[],this.setColors()}componentDidLoad(){this.isOpen=!0,setTimeout((()=>requestAnimationFrame((()=>this.panelElement.setFocus()))),300)}async componentWillRender(){this.fieldInfoMap=new Map(this.popupTemplate.fieldInfos.map((e=>[e.fieldName,e]))),this.layerFieldsMap=await(0,n.d)(this.layer),this.arcadeExpMap=(0,n.e)(this.popupTemplate),this.pickList=[],this.chartMediaInfo.value.fields.forEach(((e,t)=>{var i,s;if(this.fieldInfoMap.has(e)){const i=this.fieldInfoMap.get(e);this.pickList.push(this.calcitePickList(i,t))}else if(this.chartMediaInfo.value.fields.splice(t,1),this.chartMediaInfo.type!==C.lineChart)if(null===(i=this.chartMediaInfo.value.colors)||void 0===i?void 0:i.length)this.chartMediaInfo.value.colors.splice(t,1),this.colors.splice(t,1);else{const e=this.getDefaultColorScheme();this.colors=null===(s=this.chartMediaInfo)||void 0===s?void 0:s.value.fields.map(((t,i)=>{var s;return this.rendererColors.get(t)?this.esriLang.clone(this.rendererColors.get(t)[0]):(null===(s=this.colors)||void 0===s?void 0:s[i])||new this.esriColor(e.colors[i%10])||new this.esriColor([0,0,0,1])}))}}))}componentDidUpdate(){this.notifyMultiMediaChange.emit({guid:this.guid,mediaIndexPosition:this.mediaIndexPosition}),this.chartPopover.reposition()}disconnectedCallback(){var e;this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldManagePickList&&document.body.removeChild(this.popupFieldManagePickList),this.arcgisFieldPickList&&document.body.removeChild(this.arcgisFieldPickList),null===(e=this.colorButtonNode)||void 0===e||e.closePopover()}async reposition(){this.chartPopover.reposition()}chartChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}closePopupPopoversHandler(){this.removeAttributesSelectionPopover()}closeMultiMediaPopoverHandler(){this.removeAttributesSelectionPopover()}arcadeChangeNotificationHandler(){this.chartChangedReRender.emit()}removeAttributesSelectionPopover(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null),this.popupFieldManagePickList&&(document.body.removeChild(this.popupFieldManagePickList),this.popupFieldManagePickList=null),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null),this.colorPopoverNode&&(document.body.removeChild(this.colorPopoverNode),this.colorPopoverNode=null),this.panelElement.disabled=!1}async chartSelection(e){const[t,i,s,o]=await(0,l.l)(["esri/popup/content/BarChartMediaInfo","esri/popup/content/ColumnChartMediaInfo","esri/popup/content/LineChartMediaInfo","esri/popup/content/PieChartMediaInfo"]);let a=null;e===C.barChart&&(a=new t({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===C.columnChart&&(a=new i({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===C.lineChart&&(a=new s({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),e===C.pieChart&&(a=new o({title:this.chartMediaInfo.title,caption:this.chartMediaInfo.caption,value:this.chartMediaInfo.value,altText:this.chartMediaInfo.altText})),this.chartMediaInfo=a.clone(),this.mediaContent.mediaInfos[this.mediaIndexPosition]=this.chartMediaInfo,this.chartChangedReRender.emit()}getSummaryString(){return this.chartMediaInfo.type===C.barChart?this.strings.bar:this.chartMediaInfo.type===C.columnChart?this.strings.column:this.chartMediaInfo.type===C.lineChart?this.strings.line:this.chartMediaInfo.type===C.pieChart?this.strings.pie:void 0}render(){var e,t;const i=!!(null===(e=this.chartMediaInfo.value.fields)||void 0===e?void 0:e.length),o=(0,s.h)("calcite-segmented-control",{width:"full",scale:"s",class:"chart-group",onCalciteSegmentedControlChange:async e=>{var t;null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover();const i=e.target.selectedItem;if(this.chartMediaInfo.type===C.lineChart&&i.value!==C.lineChart||this.chartMediaInfo.type!==C.lineChart&&i.value===C.lineChart){const e=this.chartMediaInfo.value.colors;this.chartMediaInfo.type===C.lineChart?(this.lastColors.lineColors=e&&this.esriLang.clone(e),this.colors=void 0,this.chartMediaInfo.value.colors=void 0):(this.lastColors.rampColors=e&&this.esriLang.clone(e),i.value===C.lineChart&&(this.colors=void 0,this.chartMediaInfo.value.colors=void 0))}i.value!==this.chartMediaInfo.type&&(i.value!==C.columnChart||this.chartMediaInfo.type!==C.barChart)&&await this.chartSelection(i.value),this.setColors()}},(0,s.h)("calcite-segmented-control-item",{value:C.columnChart,iconStart:"graph-bar",checked:this.chartMediaInfo.type===C.columnChart||this.chartMediaInfo.type===C.barChart},this.strings.bar),(0,s.h)("calcite-segmented-control-item",{value:C.lineChart,iconStart:"graph-time-series",checked:this.chartMediaInfo.type===C.lineChart},this.strings.line),(0,s.h)("calcite-segmented-control-item",{value:C.pieChart,iconStart:"pie-chart",checked:this.chartMediaInfo.type===C.pieChart},this.strings.pie)),a=(0,s.h)("arcgis-popup-color-button",{chartMediaInfo:this.chartMediaInfo,colors:this.colors,popoverReferenceElement:this.panelElement,onArcgisPopupColorButtonChange:({detail:e})=>{this.colors=e,this.chartMediaInfo.value.colors=this.esriLang.clone(e),this.chartChangedReRender.emit()},onArcgisPopupColorButtonBeforeOpen:()=>this.closeColorPopover(),ref:e=>this.colorButtonNode=e}),l=(0,s.h)("calcite-label",{layout:"inline-space-between"},this.strings.resetColors,(0,s.h)("calcite-action",{appearance:"transparent",text:this.strings.resetColors,disabled:!(null===(t=this.chartMediaInfo.value.colors)||void 0===t?void 0:t.length),onClick:()=>{var e;null===(e=this.colorButtonNode)||void 0===e||e.closePopover(),this.closeColorPopover(),this.chartMediaInfo.value.colors=null,this.colors=[],this.chartMediaInfo.type===C.lineChart?this.lastColors.lineColors=void 0:this.lastColors.rampColors=void 0,this.setColors(),(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{scale:"s",icon:"reset"}))),r=(0,s.h)("div",null,(0,s.h)("calcite-button",{class:"manage-btn",appearance:"transparent",scale:"m",width:"full",onClick:async e=>{var t,i,s;e.stopPropagation(),this.closePopupPopovers.emit(this.guid),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.popupFieldManagePickList||(this.popupFieldManagePickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldManagePickList.popoverProps={refElement:this.panelElement},this.popupFieldManagePickList.selectedFields=(null===(s=null===(i=this.chartMediaInfo)||void 0===i?void 0:i.value)||void 0===s?void 0:s.fields)||[],this.popupFieldManagePickList.showCancel=!1,this.popupFieldManagePickList.multiple=!0,this.popupFieldManagePickList.heading=this.strings.selectFields,this.popupFieldManagePickList.okBtnText=this.strings.done,this.popupFieldManagePickList.numbersOnly=!0,this.popupFieldManagePickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit(this.guid)})),this.popupFieldManagePickList.addEventListener("arcgisPopupPickListChange",this.popupFieldManagePickListChanges),document.body.appendChild(this.popupFieldManagePickList),this.panelElement.disabled=!0)}},this.strings.selectAttributes),(0,s.h)("calcite-list",{"drag-enabled":!0,onCalciteListOrderChange:async e=>{var t,i;e.stopPropagation();const s=e.target.querySelectorAll("calcite-list-item"),o=[];if(s.forEach((e=>{this.chartMediaInfo.value.fields.forEach(((t,i)=>{e.value===t&&o.push(i)}))})),this.chartMediaInfo.type===C.lineChart)this.chartMediaInfo.value.fields=Array.from(s).map((e=>e.value));else{(null===(t=this.chartMediaInfo.value.colors)||void 0===t?void 0:t.length)||(this.chartMediaInfo.value.colors=this.esriLang.clone(this.colors));const e=[],i=[];o.forEach((t=>{e.push(this.chartMediaInfo.value.fields[t]),i.push(this.esriLang.clone(this.chartMediaInfo.value.colors[t]))})),this.chartMediaInfo.value.fields=e,this.colors=i,this.chartMediaInfo.value.colors=this.esriLang.clone(i)}if(null===(i=this.lastColors.rampColors)||void 0===i?void 0:i.length){const e=[];o.forEach((t=>{e.push(this.lastColors.rampColors[t])})),this.lastColors.rampColors=e}this.chartChangedReRender.emit()}},this.pickList)),p=(this.chartMediaInfo.type===C.barChart||this.chartMediaInfo.type===C.columnChart)&&(0,s.h)("section",{class:"enable-column"},(0,s.h)("label",{class:"enable-column-label"},this.strings.horizontalOrientation),(0,s.h)("calcite-switch",{scale:"s",class:"column-switch",checked:this.chartMediaInfo.type===C.barChart,onCalciteSwitchChange:async e=>{var t;await this.chartSelection((null===(t=e.target)||void 0===t?void 0:t.checked)?C.barChart:C.columnChart)}})),c=(0,s.h)("calcite-block-section",{class:"normalize-block",text:this.strings.normalize,toggleDisplay:"switch",open:!!this.chartMediaInfo.value.normalizeField,onCalciteBlockSectionToggle:e=>{e.target.open?this.chartMediaInfo.value.normalizeField=this.tempNormalizedField:(this.tempNormalizedField=this.chartMediaInfo.value.normalizeField,this.chartMediaInfo.value.normalizeField=""),this.chartChangedReRender.emit()}},(0,s.h)("div",{class:"normalize-content-btn-section"},(0,s.h)("button",{ref:e=>this.normalizeBtn=e,class:"normalize-content-btn",title:this.strings.normalizeBy,onClick:e=>{var t;e.stopPropagation(),this.closePopupPopovers.emit(this.guid),null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.arcgisFieldPickList||(this.arcgisFieldPickList=document.createElement("arcgis-popup-field-pick-list"),this.arcgisFieldPickList.popoverProps={refElement:this.panelElement},this.arcgisFieldPickList.selectedFields=[this.chartMediaInfo.value.normalizeField],this.arcgisFieldPickList.numbersOnly=!0,this.arcgisFieldPickList.addEventListener("arcgisPopupPickListDismissed",this.fieldPickListChanges),document.body.appendChild(this.arcgisFieldPickList),this.panelElement.disabled=!0)}},(0,s.h)("span",{class:"normalize-content-btn-text"},this.fieldInfoMap.has(this.chartMediaInfo.value.normalizeField)?(0,n.b)(this.fieldInfoMap.get(this.chartMediaInfo.value.normalizeField),this.arcadeExpMap):this.strings.normalizeBy),(0,s.h)("span",{class:"normalize-content-btn-icon"},(0,s.h)("calcite-icon",{scale:"s",icon:"pencil"}))))),d=(0,s.h)("calcite-button",{appearance:"outline-fill",scale:"m",slot:"footer",width:"full",onClick:()=>this.closePopupPopovers.emit()},this.strings.done);return(0,s.h)(s.H,{class:"js-app-flyout"},(0,s.h)("calcite-popover",{dir:(0,h.g)(this.hostElement),ref:e=>this.chartPopover=e,placement:"leading-start",open:this.isOpen,pointerDisabled:!0,referenceElement:this.refElement,offsetDistance:-Math.round(this.refElement.getBoundingClientRect().width),offsetSkidding:50,label:"",style:{zIndex:"100"},triggerDisabled:!0},(0,s.h)("calcite-panel",{ref:e=>this.panelElement=e,closable:!0,style:{width:`${this.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{slot:"header-content"},this.strings.configureChart),d,(0,s.h)("div",{class:"popover-chart-div"},o,this.chartFormInput("title"),this.chartFormInput("caption"),this.chartFormInput("altText"),i&&a,i&&l,r,p,c))))}renderColorIcon(e){const{strings:t,selectedFieldIdx:i,colors:o}=this;if(this.chartMediaInfo.type!==C.lineChart)return(0,s.h)("div",{class:"color-icon",style:{backgroundColor:o[e].toHex()},slot:"content-start",onClick:()=>this.openColorPicker(e),role:"button",tabIndex:0,"aria-label":t.changeColor,"aria-haspopup":"true","aria-expanded":i===e,onKeyUp:t=>{" "!==t.key&&"Enter"!==t.key||this.openColorPicker(e)},ref:t=>{this.colorNodes[e]=t}})}openColorPicker(e){var t;const{colors:i,strings:o,esriColor:a}=this;null===(t=this.colorButtonNode)||void 0===t||t.closePopover(),this.closeColorPopover(),this.selectedFieldIdx=e;const n=document.createElement("arcgis-popup-color-popover");n.heading=o.selectColor,n.intlDone=o.done,n.label=o.selectColor,n.hexColor=i[e].toHex(),n.popoverProps={placement:"leading-start",offsetDistance:1,offsetSkidding:52,pointerDisabled:"true",popoverWidth:315,refElement:this.chartPopover},n.addEventListener("arcgisPopupColorPopoverClose",(()=>{this.selectedFieldIdx=void 0,this.colorPopoverNode=null})),n.addEventListener("arcgisPopupColorPopoverChange",(({detail:t})=>{i[e]=new a(t),this.chartMediaInfo.value.colors=this.esriLang.clone(i),this.chartChangedReRender.emit(),(0,s.f)(this.colorButtonNode)})),document.body.appendChild(n),n.setOpen(!0),this.colorPopoverNode=n}setColors(){var e,t,i,s,o,a;const{esriColor:n,lastColors:l,rendererColors:r}=this;if(this.chartMediaInfo.type===C.lineChart)if(!(null===(e=this.colors)||void 0===e?void 0:e.length)&&l.lineColors&&(this.colors=l.lineColors,this.chartMediaInfo.value.colors=this.esriLang.clone(this.colors)),null===(t=this.colors)||void 0===t?void 0:t.length)this.colors.length>1&&(this.colors=[this.colors[0]]);else{const e=this.getDefaultColorScheme();this.colors=[e.colors[0]]}else if(!(null===(i=this.colors)||void 0===i?void 0:i.length)&&l.rampColors&&(this.colors=this.esriLang.clone(l.rampColors),this.chartMediaInfo.value.colors=this.esriLang.clone(this.colors)),!(null===(s=this.colors)||void 0===s?void 0:s.length)||this.colors.length!==(null===(o=this.chartMediaInfo)||void 0===o?void 0:o.value.fields.length)){const e=this.getDefaultColorScheme();this.colors=null===(a=this.chartMediaInfo)||void 0===a?void 0:a.value.fields.map(((t,i)=>{var s;return r.get(t)?this.esriLang.clone(r.get(t)[0]):(null===(s=this.colors)||void 0===s?void 0:s[i])||new n(e.colors[i%10])||new n([0,0,0,1])}))}}getDefaultColorScheme(){const e=this.pieChartSchemes.getSchemes({basemap:this.mapView.map.basemap,geometryType:"polygon",numColors:Math.min(10,this.chartMediaInfo.value.fields.length)});return[e.primaryScheme].concat(e.secondarySchemes).find((e=>"Olympic Sunset"===e.name))||e.primaryScheme}closeColorPopover(){this.colorPopoverNode&&(document.body.removeChild(this.colorPopoverNode),this.colorPopoverNode=null)}get hostElement(){return(0,s.d)(this)}};O.style=".manage-btn{justify-content:flex-end}.enable-column{background-color:var(--arcgis-app-background);display:flex;padding:var(--arcgis-app-cap-spacing-half) var(--arcgis-app-side-spacing-quarter)}.enable-column-label{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.column-switch{margin:0;flex:0 0 0%;justify-self:flex-end}.normalize-block{padding:0 var(--arcgis-app-side-spacing-quarter)}.normalize-content-btn-section{background-color:var(--arcgis-app-background);min-width:100%}.normalize-content-btn{background:var(--arcgis-app-background-clear);border:1px solid var(--arcgis-app-border);border-radius:var(--arcgis-app-border-radius);display:flex;align-items:center;justify-content:space-between;padding:var(--arcgis-app-cap-spacing-half) var(--arcgis-app-side-spacing-quarter);cursor:pointer;width:100%;text-align:unset;transition:background-color var(--arcgis-app-animation-time-fast) var(--arcgis-app-easing-function), border-color var(--arcgis-app-animation-time-fast) var(--arcgis-app-easing-function)}.normalize-content-btn:hover{background-color:var(--arcgis-app-background-hover);border-color:var(--arcgis-app-border-hover)}.normalize-content-btn-text{font-family:var(--arcgis-app-font-family);font-size:var(--arcgis-app-font-size-0);flex:0 1 auto;overflow:hidden;padding:0 var(--arcgis-app-side-spacing-eighth);text-overflow:ellipsis;white-space:nowrap}.normalize-content-btn-icon{flex:0 0 0%;padding:0 var(--arcgis-app-side-spacing-half)}.popover-chart-div{background-color:var(--arcgis-app-background);padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing-half);max-height:60vh}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.chart-group{margin-bottom:var(--arcgis-app-cap-spacing-half)}.color-icon{width:18px;height:18px;border-radius:90%}";const N=class{constructor(e){(0,s.r)(this,e),this.arcadeChangeNotification=(0,s.c)(this,"arcadeChangeNotification",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.valueList=[],this.filterLength=5,this.calciteValueList=e=>(0,s.h)("calcite-value-list-item",{label:e.title,description:`{${a.f.expression}${e.name}}`,value:e.name,metadata:{title:e.title,name:`{${a.f.expression}${e.name}}`},onClick:t=>this.launchArcade(t,e)},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:t=>this.removeBtnClick(t,e.name)},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.reRender=void 0}componentWillLoad(){this.layer=d.p.layer,this.mapView=d.p.mapView,this.portal=d.p.portal,this.config=d.p.config,this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.serviceType=d.p.serviceType,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType}async componentDidLoad(){await this.loadAllModules()}componentWillRender(){var e;this.valueList=[],(null===(e=this.popupTemplate.expressionInfos)||void 0===e?void 0:e.length)&&this.popupTemplate.expressionInfos.forEach((e=>{this.valueList.push(this.calciteValueList(e))}))}async setFocus(){this.expressionFlowItem.setFocus()}async loadAllModules(){[this.FieldInfo,this.PopupExpressionInfo]=await(0,l.l)(["esri/popup/FieldInfo","esri/popup/ExpressionInfo"])}async launchArcade(e,t){e.stopPropagation(),this.arcadeEditor||(this.expressionFlowItem.disabled=!0,this.arcadeEditor=document.createElement("arcgis-modal-arcade"),this.arcadeEditor.arcadeScript=I(null==t?void 0:t.expression,this.layerDisplayType,this.strings),this.arcadeEditor.arcadeProfile=await k(this.layer,this.mapView,this.serviceType,this.popupTemplate,this.layerDisplayType),this.arcadeEditor.testData=await L(this.layer,this.mapView,this.layerDisplayType,this.popupTemplate),this.arcadeEditor.addExistingExpressions=!0,this.arcadeEditor.layer=this.layer,this.arcadeEditor.arcadeTitle=(null==t?void 0:t.title)||this.strings.arcadeDefaultTitle,this.arcadeEditor.arcadeTitleEditable=!0,this.arcadeEditor.arcadeTitleEditingEnabled=!(null==t?void 0:t.title),document.body.appendChild(this.arcadeEditor),this.arcadeEditor.addEventListener("arcgisModalArcadeClose",(e=>{this.arcadeSetup(e.detail,t),setTimeout((()=>this.fabButtonNode.setFocus()),300)})))}async arcadeSetup(e,t){e&&(M(e,null==t?void 0:t.name,this.PopupExpressionInfo,this.popupTemplate),await this.popupExpressionSetup()),this.expressionFlowItem.disabled=!1,document.body.removeChild(this.arcadeEditor),this.arcadeEditor=null}async popupExpressionSetup(){await R(this.popupTemplate,this.layerDisplayType,this.layer,this.FieldInfo),this.arcadeChangeNotification.emit(),this.internalPopupUpdated.emit(),this.reRender=!this.reRender}removeBtnClick(e,t){e.stopPropagation(),this.popupTemplate.expressionInfos.find(((e,i)=>{if(e.name===t)return this.popupTemplate.expressionInfos.splice(i,1)})),this.popupExpressionSetup()}render(){var e;const t=(0,s.h)("calcite-fab",{slot:"fab",class:"fab",icon:"plus",scale:"s",appearance:"outline-fill",kind:"neutral",label:this.strings.addExpression,text:this.strings.addExpression,"text-enabled":!0,onClick:e=>this.launchArcade(e),ref:e=>this.fabButtonNode=e});return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{dir:(0,h.g)(this.hostElement),heading:this.strings.manageExpressions,ref:e=>this.expressionFlowItem=e},(null===(e=this.popupTemplate.expressionInfos)||void 0===e?void 0:e.length)>0&&(0,s.h)("calcite-value-list",{filterEnabled:this.valueList.length>=this.filterLength},this.valueList),t))}get hostElement(){return(0,s.d)(this)}},B=class{constructor(e){(0,s.r)(this,e),this.arcgisPopupPickListDismissed=(0,s.c)(this,"arcgisPopupPickListDismissed",7),this.arcgisPopupPickListChange=(0,s.c)(this,"arcgisPopupPickListChange",7),this.arcadeChangeNotification=(0,s.c)(this,"arcadeChangeNotification",7),this.arcadeExpMap=new Map,this.calciteFieldOnlyValueList=e=>(0,s.h)("calcite-pick-list-item",{key:e.name,label:e.alias||e.name,value:e.name,description:`{${e.name}}`,selected:!this.multiple&&e.name===this.selectedFields[0]||this.multiple&&this.selectedFields.indexOf(e.name)>-1,metadata:{label:e.alias,fieldName:e.name}},this.layerDisplayType===a.l.feature&&!e.name.includes(a.f.relationship)&&(0,s.h)("calcite-action",{slot:"actions-end",text:this.strings.info,title:this.strings.info,scale:"s",icon:"information",onClick:t=>{var i;t.stopPropagation();const s=t.target,o=document.createElement("calcite-flow-item");o.heading=null!==(i=e.alias)&&void 0!==i?i:e.name,o.description=e.name;const a=document.createElement("arcgis-field-info");a.lang=this.currentLanguageIntl,a.fieldName=e.name,a.layer=this.layer,a.view=this.mapView,a.classList.add("content"),o.addEventListener("calciteFlowItemBack",(()=>requestAnimationFrame((()=>s.setFocus())))),o.appendChild(a),this.flowElement.appendChild(o),setTimeout((()=>o.setFocus()),200)}})),this.calciteExpressionsOnlyValueList=e=>(0,s.h)("calcite-pick-list-item",{key:e.name,label:e.alias||e.name,value:e.name,description:`{${e.name}}`,selected:!this.multiple&&e.name===this.selectedFields[0]||this.multiple&&this.selectedFields.indexOf(e.name)>-1,metadata:{label:e.alias,fieldName:e.name}},(0,s.h)("div",{class:"expression-actions",slot:"actions-end"},(0,s.h)("calcite-action",{text:this.strings.edit,title:this.strings.edit,scale:"s",icon:this.numbersOnly&&e.type.toLowerCase()!==a.a.number?"exclamation-mark-triangle":"pencil",onClick:()=>{this.arcadeExpMap.has(e.name)&&this.launchArcade(this.arcadeExpMap.get(e.name))}}),(0,s.h)("calcite-action",{text:this.strings.remove,title:this.strings.remove,scale:"s",icon:"trash",onClick:async()=>{this.popupTemplate.expressionInfos.find(((t,i)=>{if(e.name.includes(`/${t.name}`))return this.popupTemplate.expressionInfos.splice(i,1)})),await R(this.popupTemplate,this.layerDisplayType,this.layer,this.FieldInfo),this.fields=this.fields.filter((t=>t.name!==e.name)),this.selectedFields=[...this.selectedFields].filter((t=>t!==e.name)),this.multiple&&this.arcgisPopupPickListChange.emit({selectedFields:[...new Set(this.selectedFields)]}),this.arcadeChangeNotification.emit()}}))),this.selectedFields=[],this.popoverProps=void 0,this.showCancel=!0,this.multiple=!1,this.heading=void 0,this.okBtnText=void 0,this.showFilterLength=5,this.numbersOnly=!1,this.lastSortyBy=a.L.default,this.filterFields=null,this.arcadeEditor=void 0}async componentWillLoad(){this.layer=d.p.layer,this.mapView=d.p.mapView,this.portal=d.p.portal,this.config=d.p.config,this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.currentLanguageIntl=d.p.currentLanguageIntl,this.serviceType=d.p.serviceType,this.popupTemplate=d.p.popupTemplate,this.layerDisplayType=d.p.layerDisplayType,this.supportsArcade=d.p.supportsArcade,this.layerFieldsMap=await(0,n.d)(this.layer),this.arcadeExpMap=(0,n.e)(this.popupTemplate),this.fields=await this.getFields(),!this.multiple&&this.selectedFields.length>1&&(this.selectedFields=[this.selectedFields[0]])}async componentDidLoad(){await this.loadAllModules(),this.popoverNode.open=!0,setTimeout((()=>requestAnimationFrame((()=>this.flowItemElement.setFocus()))),200)}componentWillRender(){this.arcadeExpMap=(0,n.e)(this.popupTemplate),this.fieldsOnly=[...this.getSortedList()].filter((e=>!e.name.includes(a.f.expression))),this.expressionsOnly=[...this.getSortedList()].filter((e=>e.name.includes(a.f.expression)))}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}calciteFilterChangeHandler(e){var t,i;e.stopPropagation();const s=null===(t=null==e?void 0:e.path)||void 0===t?void 0:t.find((e=>"CALCITE-FILTER"===e.nodeName));this.filterFields=null===(i=null==s?void 0:s.filteredItems)||void 0===i?void 0:i.map((e=>e.value))}getSortedList(){const e=[...this.fields];return this.lastSortyBy===a.L.display?e.sort(((e,t)=>e.alias.localeCompare(t.alias))):this.lastSortyBy===a.L.field?e.sort(((e,t)=>e.name.localeCompare(t.name))):this.lastSortyBy===a.L.type&&e.sort(((e,t)=>e.type.localeCompare(t.type))),e}selectDeselect(){var e;return(null===(e=this.filterFields)||void 0===e?void 0:e.length)?this.filterContainsAll():this.selectedFields.length===this.fields.length}filterContainsAll(){return this.filterFields.every((e=>this.selectedFields.some((t=>t===e))))}async loadAllModules(){[this.PopupExpressionInfo,this.FieldInfo]=await(0,l.l)(["esri/popup/ExpressionInfo","esri/popup/FieldInfo"])}async launchArcade(e){this.arcadeEditor||(this.flowItemElement.disabled=!0,this.arcadeEditor=document.createElement("arcgis-modal-arcade"),this.arcadeEditor.arcadeScript=I(null==e?void 0:e.expression,this.layerDisplayType,this.strings),this.arcadeEditor.arcadeProfile=await k(this.layer,this.mapView,this.serviceType,this.popupTemplate,this.layerDisplayType),this.arcadeEditor.testData=await L(this.layer,this.mapView,this.layerDisplayType,this.popupTemplate),this.arcadeEditor.addExistingExpressions=!0,this.arcadeEditor.layer=this.layer,this.arcadeEditor.arcadeTitle=(null==e?void 0:e.title)||this.strings.arcadeDefaultTitle,this.arcadeEditor.arcadeTitleEditable=!0,this.arcadeEditor.arcadeTitleEditingEnabled=!(null==e?void 0:e.title),document.body.appendChild(this.arcadeEditor),this.arcadeEditor.addEventListener("arcgisModalArcadeClose",(t=>this.arcadeSetup(t.detail,e))))}async arcadeSetup(e,t){if(e){const i=M(e,null==t?void 0:t.name,this.PopupExpressionInfo,this.popupTemplate);await R(this.popupTemplate,this.layerDisplayType,this.layer,this.FieldInfo);const s=`${a.f.expression}${i.name}`;this.fields.push({name:s,alias:i.title,type:i.returnType}),this.fields=[...new Map(this.fields.map((e=>[e.name,e]))).values()],this.multiple?this.selectedFields.push(s):this.selectedFields=[s],this.arcgisPopupPickListChange.emit({selectedFields:[...new Set(this.selectedFields)]}),this.arcadeChangeNotification.emit()}this.flowItemElement.disabled=!1,document.body.removeChild(this.arcadeEditor),this.arcadeEditor=null}async getFields(){const e=[];let t=await(0,n.j)(this.layer);t=t.filter((e=>e.visible));const i=new Map(this.popupTemplate.fieldInfos.map((e=>[e.fieldName,e])));if(t.forEach((t=>{if(i.has(t.name)){const s=i.get(t.name);e.push({name:s.fieldName,alias:(0,n.b)(s,this.arcadeExpMap),type:(0,n.a)(s.fieldName,this.layerFieldsMap,this.arcadeExpMap)}),i.delete(t.name)}})),i.forEach((t=>{e.push({name:t.fieldName,alias:(0,n.b)(t,this.arcadeExpMap),type:(0,n.a)(t.fieldName,this.layerFieldsMap,this.arcadeExpMap)})})),this.numbersOnly){const t=new Set(this.selectedFields);return e.filter((e=>{const i=e.type.toLowerCase();if((t.has(e.name)||i===a.a.integer||i===a.a.smallInteger||i===a.a.bigInteger||i===a.a.single||i===a.a.double||i===a.a.long||i===a.a.number||i===a.a.oid)&&!e.name.includes(a.f.relationship))return e}))}return e}render(){const e=(0,s.h)("calcite-button",{appearance:this.showCancel?"solid":"outline-fill",width:this.showCancel?"half":"full",scale:"m",onClick:()=>{this.arcgisPopupPickListDismissed.emit({selectedFields:[...new Set(this.selectedFields)]})}},this.okBtnText||(this.multiple?this.strings.done:this.strings.ok)),t=(0,s.h)("calcite-button",{appearance:"outline-fill",width:this.multiple?"half":"full",scale:"m",onClick:()=>this.arcgisPopupPickListDismissed.emit()},this.strings.cancel),i=(0,s.h)("calcite-dropdown",{slot:"menu-actions",placement:"bottom-end",overlayPositioning:"fixed"},(0,s.h)("calcite-action",{slot:"trigger",text:this.strings.sort,title:this.strings.sort},(0,s.h)("calcite-icon",{scale:"s",icon:"sortDescending"})),(0,s.h)("calcite-dropdown-group",null,(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.default,onClick:()=>this.lastSortyBy=a.L.default},this.strings.default),(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.display,onClick:()=>this.lastSortyBy=a.L.display},this.strings.displayName),(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.type,onClick:()=>this.lastSortyBy=a.L.type},this.strings.type),(0,s.h)("calcite-dropdown-item",{selected:this.lastSortyBy===a.L.field,onClick:()=>this.lastSortyBy=a.L.field},this.strings.fieldName))),o=(0,s.h)("div",{class:"selection-button-div"},(0,s.h)("calcite-button",{appearance:"transparent",scale:"m",width:"full",class:"selection-button",onClick:()=>{var e,t;this.selectDeselect()?this.selectedFields=(null===(e=this.filterFields)||void 0===e?void 0:e.length)?this.selectedFields.filter((e=>!this.filterFields.includes(e))):[]:this.selectedFields=(null===(t=this.filterFields)||void 0===t?void 0:t.length)?[...new Set([...this.selectedFields,...this.filterFields])]:this.fields.map((e=>e.name))}},this.selectDeselect()?this.strings.deselectAll:this.strings.selectAll)),n=(0,s.h)("calcite-button",{appearance:"transparent",scale:"m",width:"full",iconStart:"plus",class:"add-expression-button",onClick:()=>{this.launchArcade()}},this.strings.addExpression);return(0,s.h)(s.H,{class:"js-app-flyout"},(0,s.h)("calcite-popover",{dir:(0,h.g)(this.hostElement),class:"popover",placement:this.popoverProps.placement||"leading-start",open:!1,pointerDisabled:!0,referenceElement:this.popoverProps.refElement,offsetDistance:this.popoverProps.offsetDistance||-Math.round(this.popoverProps.refElement.getBoundingClientRect().width),offsetSkidding:this.popoverProps.offsetSkidding||50,label:this.heading,triggerDisabled:!0,ref:e=>this.popoverNode=e},(0,s.h)("calcite-flow",{ref:e=>{this.flowElement=e},style:{width:`${this.popoverProps.popoverWidth||this.popoverProps.refElement.getBoundingClientRect().width}px`}},(0,s.h)("calcite-flow-item",{ref:e=>this.flowItemElement=e,class:"panel",heading:this.heading,closable:!0,onCalciteFlowItemClose:()=>this.arcgisPopupPickListDismissed.emit()},(0,s.h)("div",{class:"footer",slot:"footer"},this.supportsArcade&&n,this.multiple&&e,this.showCancel&&t),(0,s.h)("calcite-pick-list",{class:"content",multiple:this.multiple,ref:e=>{this.pickListNode=e},filterEnabled:this.fields.length>=this.showFilterLength,filterPlaceholder:this.strings.searchFields,onCalciteListChange:async()=>{const e=await this.pickListNode.getSelectedItems();this.selectedFields=[...new Set([...this.selectedFields.filter((t=>e.has(t))),...e.keys()])],this.arcgisPopupPickListChange.emit({selectedFields:this.selectedFields}),this.multiple||this.arcgisPopupPickListDismissed.emit({selectedFields:this.selectedFields})}},this.fields.length>=this.showFilterLength&&i,this.multiple&&o,this.supportsArcade&&(0,s.h)("calcite-pick-list-group",{"group-title":this.strings.expressions},this.expressionsOnly.length?this.expressionsOnly.map((e=>this.calciteExpressionsOnlyValueList(e))):(0,s.h)("calcite-label",{alignment:"center"},this.strings.noExpressions)),(0,s.h)("calcite-pick-list-group",{groupTitle:this.supportsArcade?this.strings.attributes:null},this.fieldsOnly.map((e=>this.calciteFieldOnlyValueList(e)))))))))}get hostElement(){return(0,s.d)(this)}};B.style=".popover{z-index:100}.panel{min-height:300px}.content{max-height:calc(60vh - 142px);}.selection-button-div{padding:4px 10px}.footer{width:100%}.expression-actions{display:flex}.add-expression-button{margin:4px 0 8px}";const U=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.imageChangedReRender=(0,s.c)(this,"imageChangedReRender",7),this.notifyMultiMediaChange=(0,s.c)(this,"notifyMultiMediaChange",7),this.changeImageProperties=e=>{null==e||e.stopPropagation(),null==e||e.preventDefault(),this.imageMediaInfo.value.sourceURL=this.editImageUrl.value,this.imageMediaInfo.title=this.editImageTitle.value,this.imageMediaInfo.refreshInterval=this.editRefreshImage.value||0,this.imageMediaInfo.caption=this.editImageCaption.value,this.imageMediaInfo.altText=this.editAltText.value,this.imageMediaInfo.value.linkURL=this.editImageLinkUrl.value,this.imageChangedReRender.emit()},this.openAttributesList=e=>{this.closePopupPopovers.emit(this.guid),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.panelElement},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit(this.guid)})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.panelElement.disabled=!0)},this.imageFormInput=e=>{var t;const i=this.getImageInputObject(e);return(0,s.h)("calcite-label",{scale:"s"},i.inputLabel,(0,s.h)("div",{id:i.popoverId,class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i.referenceElement,value:i.inputValue,placeholder:i.placeHolder,onClick:()=>this.closePopupPopovers.emit(this.guid)}),(null===(t=this.popupTemplate.fieldInfos)||void 0===t?void 0:t.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,"text-display":"hidden",onClick:()=>this.openAttributesList(i.imageInput),scale:"s",icon:"brackets-curly"})))},this.getImageInputObject=e=>{const t=new class{};return t.imageInput=e,t.popoverId=`popoverId_${t.imageInput}`,e===a.i.sourceUrl?(t.inputLabel=this.strings.url,t.referenceElement=e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editImageUrl=e},t.inputValue=this.imageMediaInfo.value.sourceURL,t.placeHolder=this.strings.imageUrlPlaceHolder):e===a.i.title?(t.inputLabel=this.strings.title,t.referenceElement=e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editImageTitle=e},t.inputValue=this.imageMediaInfo.title,t.placeHolder=this.strings.imageTitlePlaceHolder):e===a.i.caption?(t.inputLabel=this.strings.caption,t.referenceElement=e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editImageCaption=e},t.inputValue=this.imageMediaInfo.caption,t.placeHolder=this.strings.imageCaptionPlaceHolder):e===a.i.altText?(t.inputLabel=this.strings.description,t.referenceElement=e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editAltText=e},t.inputValue=this.imageMediaInfo.altText,t.placeHolder=this.strings.describeImage):e===a.i.linkUrl&&(t.inputLabel=this.strings.link,t.referenceElement=e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editImageLinkUrl=e},t.inputValue=this.imageMediaInfo.value.linkURL,t.placeHolder=this.strings.imageLinkUrlPlaceHolder),t},this.guid=void 0,this.imageMediaInfo=void 0,this.refElement=void 0,this.mediaIndexPosition=void 0,this.isOpen=!1,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate,this.imageMediaInfo.title=this.imageMediaInfo.title||"",this.imageMediaInfo.altText=this.imageMediaInfo.altText||"",this.imageMediaInfo.caption=this.imageMediaInfo.caption||"",this.imageMediaInfo.value.sourceURL=this.imageMediaInfo.value.sourceURL||"",this.imageMediaInfo.value.linkURL=this.imageMediaInfo.value.linkURL||""}componentDidLoad(){this.editImageUrl.value=this.imageMediaInfo.value.sourceURL,this.editImageTitle.value=this.imageMediaInfo.title,this.editRefreshImage.value=this.imageMediaInfo.refreshInterval||0,this.editImageCaption.value=this.imageMediaInfo.caption,this.editImageLinkUrl.value=this.imageMediaInfo.value.linkURL,this.editAltText.value=this.imageMediaInfo.altText,this.isOpen=!0,setTimeout((()=>requestAnimationFrame((()=>this.panelElement.setFocus()))),300)}componentDidUpdate(){this.notifyMultiMediaChange.emit({guid:this.guid,mediaIndexPosition:this.mediaIndexPosition})}disconnectedCallback(){this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}async reposition(){var e;null===(e=this.popoverNode)||void 0===e||e.reposition()}imageChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}closePopupPopoversHandler(){this.removeAttributesSelectionPopover()}closeMultiMediaPopoverHandler(){this.removeAttributesSelectionPopover()}calciteBlockSectionToggleHandler(e){const t=e.composedPath();"refreshImageBlockSection_id"===(null==t?void 0:t[0].id)&&(this.editRefreshImage.value=0,this.changeImageProperties(e),this.hostElement.shadowRoot.getElementById("managePopover_Id").reposition()),e.stopPropagation()}removeAttributesSelectionPopover(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null),this.panelElement.disabled=!1}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];t===a.i.sourceUrl?(this.editImageUrl.value=u(this.editImageUrl,i),this.editImageUrl.setFocus()):t===a.i.title?(this.editImageTitle.value=u(this.editImageTitle,i),this.editImageTitle.setFocus()):t===a.i.caption?(this.editImageCaption.value=u(this.editImageCaption,i),this.editImageCaption.setFocus()):t===a.i.linkUrl?(this.editImageLinkUrl.value=u(this.editImageLinkUrl,i),this.editImageLinkUrl.setFocus()):t===a.i.altText&&(this.editAltText.value=u(this.editAltText,i),this.editAltText.setFocus()),this.closePopupPopovers.emit(this.guid),this.changeImageProperties()}render(){const e=(0,s.h)("calcite-block-section",{id:"refreshImageBlockSection_id",text:this.strings.refreshInterval,toggleDisplay:"switch",open:!!this.imageMediaInfo.refreshInterval},(0,s.h)("div",{class:"refresh-label"},(0,s.h)("calcite-label",{scale:"s",layout:"inline"},(0,s.h)("calcite-input",{class:"refresh-image-input",type:"number",min:0,max:1440,ref:e=>{e.addEventListener("calciteInputChange",this.changeImageProperties),this.editRefreshImage=e},value:this.imageMediaInfo.refreshInterval?this.imageMediaInfo.refreshInterval.toString():"0",onClick:()=>this.closePopupPopovers.emit(this.guid),onCalciteInputInput:()=>{if(this.editRefreshImage.value){const e=parseInt(this.editRefreshImage.value);e<0?this.editRefreshImage.value=0:e>1440&&(this.editRefreshImage.value=1440)}}}),this.strings.minutes))),t=(0,s.h)("div",{class:"ignore-elements-sortable"},this.imageFormInput(a.i.sourceUrl),(0,s.h)("calcite-block-section",{open:!0,text:this.strings.options},this.imageFormInput(a.i.title),this.imageFormInput(a.i.caption),this.imageFormInput(a.i.altText),this.imageFormInput(a.i.linkUrl),e)),i=(0,s.h)("calcite-button",{appearance:"outline-fill",scale:"m",slot:"footer",width:"full",onClick:()=>this.closePopupPopovers.emit()},this.strings.done);return(0,s.h)(s.H,{class:"js-app-flyout"},(0,s.h)("calcite-popover",{dir:(0,h.g)(this.hostElement),id:"managePopover_Id",placement:"leading-start",open:this.isOpen,pointerDisabled:!0,referenceElement:this.refElement,offsetDistance:-Math.round(this.refElement.getBoundingClientRect().width),offsetSkidding:50,label:"",style:{zIndex:"100"},triggerDisabled:!0,ref:e=>this.popoverNode=e},(0,s.h)("calcite-panel",{ref:e=>this.panelElement=e,closable:!0,style:{width:`${this.refElement.getBoundingClientRect().width}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{slot:"header-content"},this.strings.configureImage),i,(0,s.h)("div",{class:"popover-image-div"},t))))}get hostElement(){return(0,s.d)(this)}};U.style=".popover-image-div{background-color:var(--arcgis-app-background);padding:var(--arcgis-app-cap-spacing) var(--arcgis-app-side-spacing-half);max-height:calc(60vh - 102px);}.refresh-label{margin-top:6px}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.refresh-image-input{width:5rem}";const V=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.notifyAddContentSelection=(0,s.c)(this,"notifyAddContentSelection",7),this.notifyAddMultiMediaContentSelection=(0,s.c)(this,"notifyAddMultiMediaContentSelection",7),this.contentPopoverRefElement=void 0,this.popupHasAttachment=void 0,this.popoverPanelWidth=void 0,this.isMultimediaContent=!1,this.guid=void 0,this.isOpen=!1}async reposition(){var e;null===(e=this.popoverElement)||void 0===e||e.reposition()}componentWillLoad(){this.strings=d.p.strings,this.layerHasAttachment=d.p.layerHasAttachment,this.layerHasET=d.p.layerHasET,this.layerHasAttributes=d.p.layerHasAttributes,this.layerHasCharts=d.p.layerHasCharts,this.layerHasImages=d.p.layerHasImages,this.layerHasText=d.p.layerHasText,this.popupTemplate=d.p.popupTemplate,this.supportsArcade=d.p.supportsArcade}componentDidLoad(){this.hostElement.shadowRoot.getElementById("managePopover_Id").reposition(),this.isOpen=!0,setTimeout((()=>requestAnimationFrame((()=>this.panelElement.setFocus()))),300)}contentSelection(e){this.isMultimediaContent?this.notifyAddMultiMediaContentSelection.emit({guid:this.guid,content:e}):this.notifyAddContentSelection.emit(e)}render(){const e=(0,s.h)("calcite-action",{label:this.strings.fieldsList,text:this.strings.fieldsList,textEnabled:!0,onClick:()=>{this.contentSelection(P.attributes)}},(0,s.h)("calcite-icon",{scale:"s",icon:"feature-details"})),t=(0,s.h)("calcite-action",{label:this.strings.attachments,text:this.strings.attachments,textEnabled:!0,onClick:()=>{this.contentSelection(P.attachments)},disabled:!!this.popupHasAttachment},(0,s.h)("calcite-icon",{scale:"s",icon:"attachment"})),i=(0,s.h)("calcite-action",{label:this.strings.chart,text:this.strings.chart,textEnabled:!0,onClick:()=>{this.contentSelection(P.charts)}},(0,s.h)("calcite-icon",{scale:"s",icon:"graph-bar"})),o=(0,s.h)("calcite-action",{label:this.strings.image,text:this.strings.image,textEnabled:!0,onClick:()=>{this.contentSelection(P.images)}},(0,s.h)("calcite-icon",{scale:"s",icon:"image"})),a=(0,s.h)("calcite-action",{label:this.strings.text,text:this.strings.text,textEnabled:!0,onClick:()=>{this.contentSelection(P.richText)}},(0,s.h)("calcite-icon",{scale:"s",icon:"text"})),l=(0,s.h)("calcite-action",{label:this.strings.arcade,text:this.strings.arcade,icon:"code",textEnabled:!0,onClick:()=>{this.contentSelection(P.arcade)}}),r=(0,s.h)("calcite-action",{label:this.strings.summaryETHeading,text:this.strings.summaryETHeading,textEnabled:!0,onClick:()=>{this.contentSelection(P.summaryET)},disabled:!!this.popupTemplate.lastEditInfoEnabled},(0,s.h)("calcite-icon",{scale:"s",icon:"user"})),p=(0,s.h)("calcite-action",{label:this.strings.relatedRecords,text:this.strings.relatedRecords,textEnabled:!0,onClick:()=>{this.contentSelection(P.relationship)}},(0,s.h)("calcite-icon",{scale:"s",icon:"link"})),c=(0,n.q)(this.contentPopoverRefElement,"calcite-flow-item"),u=(null==c?void 0:c.getBoundingClientRect().top)||56,m=this.contentPopoverRefElement.getBoundingClientRect().top-u-54-10,g={maxHeight:m>0?`${m}px`:"60vh"};return(0,s.h)(s.H,{class:"js-app-flyout"},(0,s.h)("calcite-popover",{ref:e=>this.popoverElement=e,dir:(0,h.g)(this.hostElement),id:"managePopover_Id",placement:"bottom",open:this.isOpen,referenceElement:this.contentPopoverRefElement,label:this.isMultimediaContent?this.strings.addMedia:this.strings.addContent,style:{zIndex:"100"},triggerDisabled:!0},(0,s.h)("calcite-panel",{ref:e=>this.panelElement=e,closable:!0,style:{width:`${this.popoverPanelWidth}px`},onCalcitePanelClose:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{slot:"header-content"},this.isMultimediaContent?this.strings.addMedia:this.strings.content),this.isMultimediaContent?(0,s.h)("div",{style:g},this.layerHasCharts&&i,this.layerHasImages&&o):(0,s.h)("div",{style:g},this.layerHasAttributes&&e,this.layerHasAttachment&&t,this.layerHasCharts&&i,this.layerHasImages&&o,this.layerHasText&&a,this.supportsArcade&&l,this.layerHasET&&r,d.p.layerHasRelatedRecords&&p))))}get hostElement(){return(0,s.d)(this)}},$=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.closeMultiMediaPopover=(0,s.c)(this,"closeMultiMediaPopover",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.deleteComponent=(0,s.c)(this,"deleteComponent",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.pickList=[],this.mediaMap=new Map,this.calciteValueListItem=(e,t)=>(0,s.h)("calcite-value-list-item",{id:t,label:e.title&&`${e.title.substring(0,25)}${e.title.length>25?"...":""}`||this.strings.noTitle,description:this.getMultiMediaText(e.type),value:t,onClick:i=>{i.stopPropagation(),this.closePopupPopovers.emit(),this.openMediaPopover(e,this.findChartIndexPosition(t))}},(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.strings.remove,onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit();const i=this.hostElement.shadowRoot.getElementById("valueList_Id").getElementsByTagName("calcite-value-list-item");for(let e=0;e<i.length;e++)if(i[e].id===t){this.multimediaContent.mediaInfos.splice(e,1),0===this.multimediaContent.mediaInfos.length?this.deleteComponent.emit(this.guid):(this.setActiveMediaInfoIndex(0),this.reRender=!this.reRender);break}}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"}))),this.formInput=(e,t,i,o,a)=>{var n;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.multimediaContent.title=i:this.multimediaContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(n=this.popupTemplate.fieldInfos)||void 0===n?void 0:n.length)>0&&(0,s.h)("calcite-action",{text:this.strings.attributes,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.multimediaContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}async componentWillLoad(){this.strings=d.p.strings,this.mapView=d.p.mapView,this.popupTemplate=d.p.popupTemplate;const[e]=await(0,l.l)(["esri/core/reactiveUtils"]);e.watch((()=>{var e;return null===(e=this.mapView.popup)||void 0===e?void 0:e.selectedFeature}),(()=>this.setActiveMediaInfoIndex(0))),e.watch((()=>{var e;return null===(e=this.mapView.popup)||void 0===e?void 0:e.visible}),(()=>this.setActiveMediaInfoIndex(0))),this.multimediaContent.title||(this.multimediaContent.title=""),this.multimediaContent.description||(this.multimediaContent.description="")}componentDidLoad(){this.blockOpen&&(this.addMediaBtn.scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),1===this.multimediaContent.mediaInfos.length?this.openMediaPopover(this.multimediaContent.mediaInfos[0],0):this.blockOptions.setFocus())}componentWillRender(){this.pickList=[],this.mediaMap.clear(),this.multimediaContent.mediaInfos.forEach((e=>{const t=(0,r.g)();this.mediaMap.set(t,e),this.pickList.push(this.calciteValueListItem(e,t))}))}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.imagePopover&&document.body.removeChild(this.imagePopover),this.chartPopover&&document.body.removeChild(this.chartPopover),this.multimediaContentPopover&&document.body.removeChild(this.multimediaContentPopover),this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList)}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}calciteListOrderChangeHandler(){let e=[];const t=this.hostElement.shadowRoot.getElementById("valueList_Id").getElementsByTagName("calcite-value-list-item");Array.from(t).map((e=>e.id)).forEach((t=>{this.mediaMap.has(t)&&e.push(this.mediaMap.get(t))})),e.length>0&&(this.multimediaContent.mediaInfos=e),this.setActiveMediaInfoIndex(0,!0),this.closePopupPopovers.emit()}resetMultiMediaIndexHandler(){this.setActiveMediaInfoIndex(0,!0)}closePopupPopoversHandler(e){(null==e?void 0:e.detail)!==this.guid&&this.imagePopover&&(this.closeMultiMediaPopover.emit(),document.body.removeChild(this.imagePopover),this.imagePopover=null,this.addMediaBtn.setFocus(),this.disablePopupPanel.emit(!1)),(null==e?void 0:e.detail)!==this.guid&&this.chartPopover&&(this.closeMultiMediaPopover.emit(),document.body.removeChild(this.chartPopover),this.chartPopover=null,this.addMediaBtn.setFocus(),this.disablePopupPanel.emit(!1)),this.multimediaContentPopover&&(document.body.removeChild(this.multimediaContentPopover),this.multimediaContentPopover=null,this.addMediaBtn.disabled=!1,requestAnimationFrame((()=>this.addMediaBtn.setFocus())),this.disablePopupPanel.emit(!1)),this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1))}notifyMultiMediaChangeHandler(e){var t,i;(null===(t=e.detail)||void 0===t?void 0:t.guid)===this.guid&&(this.setActiveMediaInfoIndex(null===(i=e.detail)||void 0===i?void 0:i.mediaIndexPosition),this.reRender=!this.reRender)}async notifyAddMultiMediaContentSelectionHandler(e){if(e.stopPropagation(),this.closePopupPopovers.emit(),e.detail.guid===this.guid){const t=e.detail.content,[i,s,o,a]=await(0,l.l)(["esri/popup/content/ImageMediaInfo","esri/popup/content/ColumnChartMediaInfo","esri/popup/content/support/ImageMediaInfoValue","esri/popup/content/support/ChartMediaInfoValue"]);let n;t===P.images?n=new i({title:"",caption:"",altText:"",value:new o({sourceURL:"",linkURL:""})}):t===P.charts&&(n=new s({title:"",caption:"",altText:"",value:new a({fields:[]})})),this.multimediaContent.mediaInfos.push(n),this.reRender=!this.reRender,this.openMediaPopover(n,this.multimediaContent.mediaInfos.length-1)}}setActiveMediaInfoIndex(e,t){this.multimediaContent.activeMediaInfoIndex=e||0,t&&this.internalPopupUpdated.emit()}findChartIndexPosition(e){const t=this.hostElement.shadowRoot.getElementById("valueList_Id").getElementsByTagName("calcite-value-list-item");for(let i=0;i<t.length;i++)if(t[i].id===e)return i}getMultiMediaText(e){return e===C.image?this.strings.image:e===C.barChart||e===C.columnChart?this.strings.barChart:e===C.lineChart?this.strings.lineChart:e===C.pieChart?this.strings.pieChart:this.strings.image}openMediaPopover(e,t){e.type===C.image?(this.imagePopover=document.createElement("arcgis-popup-image"),this.imagePopover.guid=this.guid,this.imagePopover.refElement=this.popupFlowItem,this.imagePopover.imageMediaInfo=e,this.imagePopover.mediaIndexPosition=t,document.body.appendChild(this.imagePopover)):(this.chartPopover=document.createElement("arcgis-popup-chart"),this.chartPopover.guid=this.guid,this.chartPopover.refElement=this.popupFlowItem,this.chartPopover.chartMediaInfo=e,this.chartPopover.mediaContent=this.multimediaContent,this.chartPopover.mediaIndexPosition=t,document.body.appendChild(this.chartPopover)),this.disablePopupPanel.emit(!0)}getSummartText(){return this.multimediaContent.mediaInfos.length>1?`${this.strings.multiple} (${this.multimediaContent.mediaInfos.length})`:this.getMultiMediaText(this.multimediaContent.mediaInfos[0].type)}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=u(this.contentTitle,i),this.contentTitle.setFocus(),this.multimediaContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=u(this.contentDescription,i),this.contentDescription.setFocus(),this.multimediaContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}render(){return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,h.g)(this.hostElement),heading:this.multimediaContent.mediaInfos.length>1?this.strings.mediaGroup:this.strings.media,description:this.multimediaContent.title&&`${this.multimediaContent.title.substring(0,25)}${this.multimediaContent.title.length>25?"...":""}`||this.getSummartText(),collapsible:!0,open:this.blockOpen,dragHandle:!0},(0,s.h)("div",{class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0}})),(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:"images"})),(0,s.h)("div",{class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.multimediaContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.multimediaContent.description,this.strings.enterDescription),(0,s.h)("calcite-label",{class:"disable-spacing",scale:"s"},this.strings.mediaContent),(0,s.h)("calcite-value-list",{id:"valueList_Id","drag-enabled":!0},this.pickList),(0,s.h)("calcite-button",{ref:e=>this.addMediaBtn=e,title:this.strings.addMedia,appearance:"outline-fill",round:!0,scale:"s",class:"add-media-button",iconStart:"plus",onClick:e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.multimediaContentPopover||(this.multimediaContentPopover=document.createElement("arcgis-popup-main-contentpopover"),this.multimediaContentPopover.contentPopoverRefElement=this.addMediaBtn,this.multimediaContentPopover.popoverPanelWidth=this.hostElement.getBoundingClientRect().width,this.multimediaContentPopover.isMultimediaContent=!0,this.multimediaContentPopover.guid=this.guid,document.body.appendChild(this.multimediaContentPopover),this.addMediaBtn.disabled=!0,this.disablePopupPanel.emit(!0))}}))))}get hostElement(){return(0,s.d)(this)}};$.style=".add-media-button{display:flex;justify-content:center;padding:var(--arcgis-app-cap-spacing-half) 0 0 0}.form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.disable-spacing{--calcite-label-margin-bottom:0}";const _=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.maxPreviewCount=11,this.fieldPickListChanges=e=>{var t,i;e.stopPropagation();const s=null===(i=null===(t=e.detail)||void 0===t?void 0:t.selectedFields)||void 0===i?void 0:i[0];s&&(this.relatedRecordsContent.orderByFields[0].field=s,this.reRender=!this.reRender),this.closePopupPopovers.emit()},this.formInput=(e,t,i,o,a)=>{var n;return(0,s.h)("calcite-label",{scale:"s"},t,(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:i,value:o,placeholder:a,disabled:!this.hasRelationshipLayer,onCalciteInputInput:t=>{t.stopPropagation();const i=t.target.value;"title"===e?this.relatedRecordsContent.title=i:this.relatedRecordsContent.description=i,this.reRender=!this.reRender},onClick:()=>this.closePopupPopovers.emit()}),(null===(n=this.popupTemplate.fieldInfos)||void 0===n?void 0:n.length)&&(0,s.h)("calcite-action",{text:this.strings.attributes,disabled:!this.hasRelationshipLayer,onClick:()=>{this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",(t=>this.popupFieldSelectionPickListChanges(t,e))),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},scale:"s",icon:"brackets-curly"})))},this.guid=void 0,this.relatedRecordsContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0,this.hasRelationshipLayer=!0}async componentWillLoad(){this.strings=d.p.strings,this.layer=d.p.layer,this.view=d.p.mapView,this.popupTemplate=d.p.popupTemplate,await this.loadAllModules(),this.hasRelationshipLayer=await this.checkIfRelationshipExists(),this.relatedRecordsContent.title||(this.relatedRecordsContent.title=""),this.relatedRecordsContent.description||(this.relatedRecordsContent.description="")}componentDidLoad(){this.blockOpen&&(this.blockOptions.scrollIntoView({behavior:"smooth",block:"nearest",inline:"start"}),this.blockOptions.setFocus()),this.watchForChangesToLayersList()}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){var e;null===(e=this.watchLayersTables)||void 0===e||e.remove(),this.popupFieldSelectionPickList&&document.body.removeChild(this.popupFieldSelectionPickList),this.arcgisFieldPickList&&document.body.removeChild(this.arcgisFieldPickList)}closePopupPopoversHandler(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.disablePopupPanel.emit(!1)),this.arcgisFieldPickList&&(document.body.removeChild(this.arcgisFieldPickList),this.arcgisFieldPickList=null,this.disablePopupPanel.emit(!1))}async loadAllModules(){[this.RelatedRecordsInfoFieldOrder,this.reactiveUtils]=await(0,l.l)(["esri/popup/support/RelatedRecordsInfoFieldOrder","esri/core/reactiveUtils"])}popupFieldSelectionPickListChanges(e,t){const i=e.detail.selectedFields[0];"title"===t?(this.contentTitle.value=u(this.contentTitle,i),this.contentTitle.setFocus(),this.relatedRecordsContent.title=this.contentTitle.value):"description"===t&&(this.contentDescription.value=u(this.contentDescription,i),this.contentDescription.setFocus(),this.relatedRecordsContent.description=this.contentDescription.value),this.closePopupPopovers.emit(),this.reRender=!this.reRender}async openPickList(e){var t,i,s;this.closePopupPopovers.emit(),this.arcgisFieldPickList||(this.arcgisFieldPickList=document.createElement("arcgis-field-pick-list"),this.arcgisFieldPickList.popoverProps={refElement:this.popupFlowItem,offsetSkidding:50},this.arcgisFieldPickList.fields=e.fields.filter((e=>e.visible)),this.arcgisFieldPickList.layer=e,this.arcgisFieldPickList.mapView=this.view,this.arcgisFieldPickList.showFieldInfo=!0,this.arcgisFieldPickList.showFieldName=!0,this.arcgisFieldPickList.selectedFields=[null===(s=null===(i=null===(t=this.relatedRecordsContent)||void 0===t?void 0:t.orderByFields)||void 0===i?void 0:i[0])||void 0===s?void 0:s.field],this.arcgisFieldPickList.addEventListener("arcgisFieldPickListDismissed",this.fieldPickListChanges),document.body.appendChild(this.arcgisFieldPickList),this.disablePopupPanel.emit(!0))}async checkIfRelationshipExists(){var e;for(const t of null===(e=this.layer)||void 0===e?void 0:e.relationships)if(t.id===this.relatedRecordsContent.relationshipId){for(const e of[...this.view.map.allLayers,...this.view.map.allTables]){const i=e;if(await f(this.layer,i,t))return await i.load(),Promise.resolve(!0)}return Promise.resolve(!1)}return Promise.resolve(!1)}watchForChangesToLayersList(){this.watchLayersTables=this.reactiveUtils.watch((()=>[this.view.map.allLayers.length,this.view.map.allTables.length]),(async()=>{this.hasRelationshipLayer=await this.checkIfRelationshipExists()}))}render(){var e,t,i,o,a,n,l;const r=(0,s.h)("calcite-label",null,this.strings.relationship,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed",class:"dropdown"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m"},(()=>{for(const e of this.layer.relationships)if(e.id===this.relatedRecordsContent.relationshipId)return e.name||this.strings.relationship;return this.strings.relationship})()),(0,s.h)("calcite-dropdown-group",null,this.layer.relationships.map((e=>{for(const t of[...this.view.map.allLayers,...this.view.map.allTables]){const i=t;if(y(this.layer,i,e))return(0,s.h)("calcite-dropdown-item",{selected:this.relatedRecordsContent.relationshipId===e.id,onClick:async()=>{var t;await i.load(),this.relatedRecordsContent.relationshipId=e.id,this.relatedRecordsContent.orderByFields=[new this.RelatedRecordsInfoFieldOrder({field:i.fields.find((e=>e.visible)).name,order:(null===(t=this.relatedRecordsContent.orderByFields)||void 0===t?void 0:t[0].order)||"asc"})],this.reRender=!this.reRender}},e.name||this.strings.relationship)}}))))),p=(0,s.h)("calcite-label",null,this.strings.sortBy,(0,s.h)("calcite-button",{appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m",disabled:!this.hasRelationshipLayer,onClick:async()=>{this.layer.relationships.map((async e=>{for(const t of[...this.view.map.allLayers,...this.view.map.allTables]){const i=t;this.relatedRecordsContent.relationshipId===e.id&&y(this.layer,i,e)&&this.openPickList(i)}}))}},(null===(i=null===(t=null===(e=this.relatedRecordsContent)||void 0===e?void 0:e.orderByFields)||void 0===t?void 0:t[0])||void 0===i?void 0:i.field)||this.strings.default)),c=(0,s.h)("calcite-label",null,this.strings.sortOrder,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m"},"desc"===(null===(o=this.relatedRecordsContent.orderByFields)||void 0===o?void 0:o[0].order)?this.strings.descending:this.strings.ascending),(0,s.h)("calcite-dropdown-item",{selected:"asc"===(null===(a=this.relatedRecordsContent.orderByFields)||void 0===a?void 0:a[0].order),onClick:()=>{this.relatedRecordsContent.orderByFields[0].order="asc",this.reRender=!this.reRender}},this.strings.ascending),(0,s.h)("calcite-dropdown-item",{selected:"desc"===(null===(n=this.relatedRecordsContent.orderByFields)||void 0===n?void 0:n[0].order),onClick:()=>{this.relatedRecordsContent.orderByFields[0].order="desc",this.reRender=!this.reRender}},this.strings.descending))),d=(0,s.h)("calcite-label",null,this.strings.previewCount,(0,s.h)("calcite-dropdown",{disabled:!this.hasRelationshipLayer,overlayPositioning:"fixed"},(0,s.h)("calcite-button",{slot:"trigger",appearance:"outline-fill",kind:"neutral",iconEnd:"chevronDown",alignment:"icon-end-space-between",width:"full",scale:"m"},null!==(l=0===this.relatedRecordsContent.displayCount?this.strings.none:this.relatedRecordsContent.displayCount)&&void 0!==l?l:1),(0,s.h)("calcite-dropdown-group",null,[...Array(this.maxPreviewCount).keys()].map((e=>(0,s.h)("calcite-dropdown-item",{selected:this.relatedRecordsContent.displayCount===e,onClick:()=>{this.relatedRecordsContent.displayCount=e,this.reRender=!this.reRender}},0===e?this.strings.none:e))))));return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,h.g)(this.hostElement),heading:this.strings.relatedRecords,description:this.relatedRecordsContent.title&&`${this.relatedRecordsContent.title.substring(0,25)}${this.relatedRecordsContent.title.length>25?"...":""}`||(()=>{for(const e of this.layer.relationships)if(e.id===this.relatedRecordsContent.relationshipId)return e.name;return this.strings.selectTable})(),collapsible:!0,open:this.blockOpen,dragHandle:!0,onCalciteBlockToggle:()=>this.closePopupPopovers.emit()},(0,s.h)("div",{class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{ref:e=>this.blockOptions=e,guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:this.hasRelationshipLayer}})),(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:this.hasRelationshipLayer?"link":"exclamation-mark-triangle"})),(0,s.h)("div",{class:"ignore-elements-sortable"},this.formInput("title",this.strings.title,(e=>this.contentTitle=e),this.relatedRecordsContent.title,this.strings.enterTitle),this.formInput("description",this.strings.desc,(e=>this.contentDescription=e),this.relatedRecordsContent.description,this.strings.enterDescription),r,p,c,d)))}get hostElement(){return(0,s.d)(this)}};_.style=".form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}.dropdown{display:block}";const z=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.richTextChangedReRender=(0,s.c)(this,"richTextChangedReRender",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.arcadeExpMap=new Map,this.guid=void 0,this.fieldExpressionData=void 0,this.arcgisColorPickerData=void 0,this.richtextContent=void 0,this.blockOpen=!1,this.popupFlowItem=void 0,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.currentLanguage=d.p.currentLanguage,this.popupTemplate=d.p.popupTemplate}componentDidLoad(){this.ckEditorMentionFieldsSetup(),this.blockOpen&&(this.hostElement.shadowRoot.getElementById("content_Id").scrollIntoView({behavior:"auto",block:"nearest",inline:"start"}),this.showRichTextEditor())}componentDidUpdate(){this.internalPopupUpdated.emit()}disconnectedCallback(){this.arcgisCkeditor5&&document.body.removeChild(this.arcgisCkeditor5)}richTextChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}closeAllPopoversHandler(){this.arcgisCkeditor5&&(document.body.removeChild(this.arcgisCkeditor5),this.arcgisCkeditor5=null,this.disablePopupPanel.emit(!1))}ckEditorPopoverClosedHandler(e){var t,i,s,o,a;(null===(t=e.detail)||void 0===t?void 0:t.guid)===this.guid&&(e.stopPropagation(),((null===(s=null===(i=e.detail)||void 0===i?void 0:i.data)||void 0===s?void 0:s.length)||0===(null===(a=null===(o=e.detail)||void 0===o?void 0:o.data)||void 0===a?void 0:a.length))&&(this.richtextContent.text=e.detail.data,this.reRender=!this.reRender,this.richTextChangedReRender.emit()),this.closePopupPopovers.emit())}calciteBlockToggleHandler(){this.closePopupPopovers.emit()}arcadeChangeNotificationHandler(){this.ckEditorMentionFieldsSetup()}ckEditorMentionFieldsSetup(){var e;this.arcadeExpMap=(0,n.e)(this.popupTemplate),this.ckEditorMentionFields=[],null===(e=this.popupTemplate.fieldInfos)||void 0===e||e.forEach((e=>{e.fieldName&&this.ckEditorMentionFields.push({id:"{"+e.fieldName+"}",name:(0,n.b)(e,this.arcadeExpMap)})}))}getTextFromHtml(e){var t;const i=null!==(t=this.richtextContent.text)&&void 0!==t?t:"",s=document.createElement("div");s.innerHTML=i;const o=s.textContent||s.innerText||"";return`${o.substring(0,e)}${o.length>e?"...":""}`}showRichTextEditor(){var e,t;this.closePopupPopovers.emit(),this.arcgisCkeditor5=document.createElement("arcgis-ckeditor5"),this.arcgisCkeditor5.fieldExpressionConfig=this.fieldExpressionData,this.arcgisCkeditor5.arcgisColorPickerConfig=Object.assign(Object.assign({},this.arcgisColorPickerData),{enableFields:!(!this.arcgisColorPickerData.data||!this.arcgisColorPickerData.data.length)}),this.arcgisCkeditor5.guid=this.guid,this.arcgisCkeditor5.refElement=this.popupFlowItem,this.arcgisCkeditor5.textData=null!==(e=this.richtextContent.text)&&void 0!==e?e:"",this.arcgisCkeditor5.ckEditorMentionFields=this.ckEditorMentionFields,this.arcgisCkeditor5.intlTextPlaceHolder=(null===(t=this.popupTemplate.fieldInfos)||void 0===t?void 0:t.length)>0?this.strings.textPlaceHolder:this.strings.textPlaceHolderLabel,this.arcgisCkeditor5.intlOk=this.strings.ok,this.arcgisCkeditor5.intlCancel=this.strings.cancel,this.arcgisCkeditor5.currentLanguage=this.currentLanguage,document.body.appendChild(this.arcgisCkeditor5),this.arcgisCkeditor5.setFocus(),this.disablePopupPanel.emit(!0)}render(){return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,h.g)(this.hostElement),id:"richText_Id",heading:this.strings.text,description:this.getTextFromHtml(25),open:this.blockOpen,collapsible:!0,dragHandle:!0},(0,s.h)("div",{class:"ignore-elements-sortable",slot:"control"},(0,s.h)("arcgis-calcite-block-options",{guid:this.guid,intlOptions:this.strings.options,intlDelete:this.strings.delete,intlDuplicate:this.strings.duplicate,calciteBlockOptions:{hasDelete:!0,hasDuplicate:!0}})),(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:"text"})),(0,s.h)("div",{class:"ignore-elements-sortable",id:"content_Id"},(0,s.h)("calcite-button",{appearance:"transparent",width:"full",onClick:()=>this.showRichTextEditor()},this.strings.editText))))}get hostElement(){return(0,s.d)(this)}},j=class{constructor(e){(0,s.r)(this,e),this.closePopupPopovers=(0,s.c)(this,"closePopupPopovers",7),this.titleChangedReRender=(0,s.c)(this,"titleChangedReRender",7),this.internalPopupUpdated=(0,s.c)(this,"internalPopupUpdated",7),this.disablePopupPanel=(0,s.c)(this,"disablePopupPanel",7),this.changeTitle=()=>{this.popupTemplate.title=this.titleInput.value,this.internalPopupUpdated.emit(),this.titleChangedReRender.emit()},this.openAttributesList=e=>{e.stopPropagation(),this.closePopupPopovers.emit(),this.popupFieldSelectionPickList||(this.popupFieldSelectionPickList=document.createElement("arcgis-popup-field-pick-list"),this.popupFieldSelectionPickList.popoverProps={refElement:this.popupFlowItem},this.popupFieldSelectionPickList.multiple=!1,this.popupFieldSelectionPickList.heading=this.strings.addField,this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListDismissed",(()=>{this.closePopupPopovers.emit()})),this.popupFieldSelectionPickList.addEventListener("arcgisPopupPickListChange",this.popupFieldSelectionPickListChanges),document.body.appendChild(this.popupFieldSelectionPickList),this.disablePopupPanel.emit(!0))},this.popupFieldSelectionPickListChanges=e=>{const t=e.detail.selectedFields[0];this.titleInput.value=u(this.titleInput,t),this.titleInput.setFocus(),this.popupTemplate.title=this.titleInput.value,this.changeTitle(),this.closePopupPopovers.emit()},this.popupFlowItem=void 0,this.reRender=void 0}componentWillLoad(){this.strings=d.p.strings,this.popupTemplate=d.p.popupTemplate}componentDidLoad(){this.guidForSelection=(0,r.g)()}titleChangedReRenderHandler(e){e.stopPropagation(),this.reRender=!this.reRender}closePopupPopoversHandler(){this.popupFieldSelectionPickList&&(document.body.removeChild(this.popupFieldSelectionPickList),this.popupFieldSelectionPickList=null,this.titleInput.setFocus(),this.disablePopupPanel.emit(!1))}render(){var e;const t=this.popupTemplate.title;return(0,s.h)(s.H,null,(0,s.h)("calcite-block",{dir:(0,h.g)(this.hostElement),heading:this.strings.popupTitle,description:t&&`${t.substring(0,25)}${t.length>25?"...":""}`,collapsible:!0},(0,s.h)("div",{slot:"icon"},(0,s.h)("calcite-icon",{scale:"m",icon:"title"})),(0,s.h)("div",{class:"form-input-button"},(0,s.h)("calcite-input",{type:"text",autofocus:!0,ref:e=>{this.titleInput=e},value:t,onCalciteInputInput:e=>{e.stopPropagation(),this.changeTitle()},onClick:()=>this.closePopupPopovers.emit()}),(null===(e=this.popupTemplate.fieldInfos)||void 0===e?void 0:e.length)>0&&(0,s.h)("calcite-action",{scale:"s",text:this.strings.attributes,onClick:this.openAttributesList,icon:"brackets-curly"}))))}get hostElement(){return(0,s.d)(this)}};j.style=".form-input-button{display:flex}.form-input-button calcite-input[type=text]{display:flex;flex-flow:column nowrap;flex:1 0 0%;overflow:hidden}.form-input-button calcite-action{margin:0;flex:0 0 0%;justify-self:flex-end}"},48680:(e,t,i)=>{i.d(t,{g:()=>s});const s=()=>[2,1,1,1,3].map((e=>{let t="";for(let i=0;i<e;i++)t+=(65536*(1+Math.random())|0).toString(16).substring(1);return t})).join("-")},27010:(e,t,i)=>{i.d(t,{c:()=>l});var s=i(28384);const o=e=>!("isConnected"in e)||e.isConnected,a=((e,t)=>{let i;return(...e)=>{i&&clearTimeout(i),i=setTimeout((()=>{i=0,(e=>{for(let t of e.keys())e.set(t,e.get(t).filter(o))})(...e)}),2e3)}})(),n=e=>"function"==typeof e?e():e,l=(e,t)=>{const i=((e,t=((e,t)=>e!==t))=>{const i=n(e);let s=new Map(Object.entries(null!=i?i:{}));const o={dispose:[],get:[],set:[],reset:[]},a=()=>{var t;s=new Map(Object.entries(null!==(t=n(e))&&void 0!==t?t:{})),o.reset.forEach((e=>e()))},l=e=>(o.get.forEach((t=>t(e))),s.get(e)),r=(e,i)=>{const a=s.get(e);t(i,a,e)&&(s.set(e,i),o.set.forEach((t=>t(e,i,a))))},p="undefined"==typeof Proxy?{}:new Proxy(i,{get:(e,t)=>l(t),ownKeys:e=>Array.from(s.keys()),getOwnPropertyDescriptor:()=>({enumerable:!0,configurable:!0}),has:(e,t)=>s.has(t),set:(e,t,i)=>(r(t,i),!0)}),h=(e,t)=>(o[e].push(t),()=>{((e,t)=>{const i=e.indexOf(t);i>=0&&(e[i]=e[e.length-1],e.length--)})(o[e],t)});return{state:p,get:l,set:r,on:h,onChange:(t,i)=>{const s=h("set",((e,s)=>{e===t&&i(s)})),o=h("reset",(()=>i(n(e)[t])));return()=>{s(),o()}},use:(...e)=>{const t=e.reduce(((e,t)=>(t.set&&e.push(h("set",t.set)),t.get&&e.push(h("get",t.get)),t.reset&&e.push(h("reset",t.reset)),t.dispose&&e.push(h("dispose",t.dispose)),e)),[]);return()=>t.forEach((e=>e()))},dispose:()=>{o.dispose.forEach((e=>e())),a()},reset:a,forceUpdate:e=>{const t=s.get(e);o.set.forEach((i=>i(e,t,t)))}}})(e,t);return i.use((()=>{if("function"!=typeof s.g)return{};const e=new Map;return{dispose:()=>e.clear(),get:t=>{const i=(0,s.g)();i&&((e,t,i)=>{const s=e.get(t);s?s.includes(i)||s.push(i):e.set(t,[i])})(e,t,i)},set:t=>{const i=e.get(t);i&&e.set(t,i.filter(s.f)),a(e)},reset:()=>{e.forEach((e=>e.forEach(s.f))),a(e)}}})()),i}},87247:(e,t,i)=>{function s(e){e.layer=null,e.mapView=null,e.portal=null,e.config=null,e.strings=null,e.currentLanguage=null,e.currentLanguageIntl=null,e.serviceType=null,e.popupTemplate=null,e.layerHasAttachment=null,e.layerHasET=null,e.layerHasAttributes=null,e.layerHasCharts=null,e.layerHasImages=null,e.layerHasText=null,e.layerDisplayType=null,e.supportsArcade=null,e.layerHasRelatedRecords=!1}i.d(t,{c:()=>s,p:()=>o});const o=(0,i(27010).c)({layer:null,mapView:null,portal:null,config:null,strings:null,currentLanguage:null,currentLanguageIntl:null,serviceType:null,popupTemplate:null,layerHasAttachment:null,layerHasET:null,layerHasAttributes:null,layerHasCharts:null,layerHasImages:null,layerHasText:null,layerDisplayType:null,supportsArcade:null,layerHasRelatedRecords:!1}).state}}]);
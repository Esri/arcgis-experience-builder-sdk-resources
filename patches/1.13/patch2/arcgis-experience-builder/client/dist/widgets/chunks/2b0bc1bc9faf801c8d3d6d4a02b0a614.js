/*! For license information please see 2b0bc1bc9faf801c8d3d6d4a02b0a614.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[79250],{79250:(e,i,t)=>{t.r(i),t.d(i,{arcgis_raster_multidimensional:()=>c});var n=t(28384),s=t(26426),a=t(62727),l=t(66716),o=t(81068),r=t(74746),d=t(72637);t(18869),t(34077);const u=Number.MAX_VALUE-1,c=class{constructor(e){(0,n.r)(this,e),this.arcgisRasterMultidimensionalChange=(0,n.c)(this,"arcgisRasterMultidimensionalChange",7),this.arcgisRasterMultidimensionalSave=(0,n.c)(this,"arcgisRasterMultidimensionalSave",7),this.arcgisRasterMultidimensionalCancel=(0,n.c)(this,"arcgisRasterMultidimensionalCancel",7),this.valuePickers={time:null,z:null},this.containerTop=0,this.aoiIndex=0,this.previousPickedListSize=-1,this.pauseLayerUpdate=!1,this.apply=()=>{var e;if(!this.multidimensionalInfo)return;this.originalLayerSetting.definition=this.esriLang.clone(this.activeMultidimensionalDefinition),this.originalLayerSetting.subset=this.activeMultidimensionalSubset.clone();const{layer:i}=this;this.isImageryLayer(i)&&(this.originalLayerSetting.mosaicRule=null===(e=i.mosaicRule)||void 0===e?void 0:e.clone()),this.makeLiveLayerUpdate||(this.updateLayerMultidimensionalDefinition(),this.updateLayerMultidimensionalSubset()),this.closePopover(),this.arcgisRasterMultidimensionalSave.emit()},this.cancel=()=>{if(!this.multidimensionalInfo)return;const{layer:e,originalLayerSetting:i}=this,t=this.esriLang.clone(i.definition),n=this.esriLang.clone(i.subset);this.updateStateWhenCancel&&(this.pauseLayerUpdate=!0,this.activeMultidimensionalSubset=null!=n?n:this.getDefaultMultidimensionalSubset(),this.activeMultidimensionalDefinition=t,this.pauseLayerUpdate=!1),this.isImageryLayer(e)?e.mosaicRule=i.mosaicRule:e.multidimensionalDefinition=t,e.renderer=i.renderer,e.multidimensionalSubset=n,this.closePopover(),this.arcgisRasterMultidimensionalCancel.emit()},this.updateDefinitionDimensionValue=(e,i,t=!1)=>{var n,s;const a=this.esriLang.clone(this.activeMultidimensionalDefinition);if(a.find((({dimensionName:i})=>i===e)).values=[i],this.activeMultidimensionalDefinition=a,!t)return;const{valuePickers:l}=this,o=(null===(n=l.time)||void 0===n?void 0:n.dimensionName)===e?l.time:(null===(s=l.z)||void 0===s?void 0:s.dimensionName)===e?l.z:null;if(o){const e=o.dimensionValues.findIndex((e=>Array.isArray(i)&&Array.isArray(e)?i.join("-")===e.join("-"):i===e));o.slider.values=this.getSelectedSliderValue(e,o.slider.component.reversed,o.dimensionValues.length)}},this.updateDefinitionVariableName=e=>{this.isDefaultUnspecifiedVariable(e)&&(e="");const i=this.getNewMultidimensionalDefinition(e);this.activeMultidimensionalDefinition=i},this.updateExtentDimensionSubset=(e,i,t="both")=>{const{activeMultidimensionalSubset:n}=this,s=[...n.dimensions.find((i=>i.name===e)).extent];if("both"===t){if(s[0]===i[0]&&s[1]===i[1])return;[s[0],s[1]]=i}else if("start"===t){let e=s[1]===s[0];s[0]=Array.isArray(i)?i[0]:i,e&&(s[1]=s[0])}else s[1]=i===u?s[0]:Array.isArray(i)?i[i.length-1]:i;(s[1]<s[0]||null==s[1])&&(s[1]=s[0]);const a=n.clone(),{subsetDefinitions:l}=a;l.forEach((i=>{i.dimensionName===e&&(i.values=[s[0],s[1]])})),this.activeMultidimensionalSubset=a;const{animatedDimensions:o}=this,r=o.time===e,d=o.z===e;if(r||d){const i=this.getVariableInfo(this.activeMultidimensionalDefinition[0].variableName),t=null==i?void 0:i.dimensions.find((({name:i})=>i===e));this.createValuePicker(t),r?o.time=e:o.z=e}},this.updateExtentVariables=e=>{let{activeMultidimensionalSubset:i}=this;if(e.length&&i.variables.length&&e.join(",")===i.variables.join(","))return;this.previousPickedListSize=e.length,0===e.length&&(e=this.allVariables.map((({name:e})=>e)));const t=this.getDefaultMultidimensionalSubset(e),{subsetDefinitions:n}=t.clone();n.forEach((e=>{const t=i.subsetDefinitions.find((i=>i.variableName===e.variableName&&i.dimensionName===e.dimensionName));if(t)e.values=t.values;else{const t=i.dimensions.find((i=>i.name===e.dimensionName));t&&(e.values=[...t.extent])}}));const s=i.clone();s.subsetDefinitions=n,this.activeMultidimensionalSubset=s},this.updateExtentAOI=e=>{const i=this.activeMultidimensionalSubset.clone();i.areaOfInterest=null==e?void 0:e.clone(),this.activeMultidimensionalSubset=i},this.updateExtentFromTime=e=>{if(!this.multidimensionalInfo)return;const i=this.esriLang.clone(this.originalLayerSetting.definition),{multidimensionalDefinition:t}=this.layer.normalizeRasterFetchOptions({multidimensionalDefinition:i,timeExtent:e});t&&this.isPropertyValueChanged(t,this.activeMultidimensionalDefinition)&&(this.activeMultidimensionalDefinition=t)},this.updateSorting=e=>{const i=Object.assign({},this.sortDirections);i[e]="descending"===i[e]?"ascending":"descending",this.sortDirections=i},this.updateLayerMultidimensionalDefinition=(0,s.d)((()=>{var e,i,t;const{activeMultidimensionalDefinition:n,layer:s}=this,a=this.isImageryLayer(s);if(!(a?this.isPropertyValueChanged(n,null===(e=s.mosaicRule)||void 0===e?void 0:e.multidimensionalDefinition):this.isPropertyValueChanged(n,s.multidimensionalDefinition)))return;const l=this.getMultidimensionalDefinition(s),o=!l||0===l.length||l[0].variableName!==n[0].variableName;if(a){const e=(null!==(i=s.mosaicRule)&&void 0!==i?i:s.defaultMosaicRule).clone();if(this.isDefaultUnspecifiedVariable(n[0].variableName)){const i=n.map((e=>{const i=e.clone();return i.variableName="",i}));e.multidimensionalDefinition=i}else e.multidimensionalDefinition=n;s.mosaicRule=e}else s.multidimensionalDefinition=n;if(o){const e=this.getVariableInfo(n[0].variableName),{renderer:i}=s;if("raster-stretch"===(null==i?void 0:i.type)&&(null===(t=e.statistics)||void 0===t?void 0:t.length)){const t=i.clone();t.statistics=e.statistics.map((e=>Object.assign({},e))),s.renderer=t}}}),100),this.updateLayerMultidimensionalSubset=(0,s.d)((()=>{const{activeMultidimensionalSubset:e,layer:i}=this,t=this.getDefaultMultidimensionalSubset(),n=this.isPropertyValueChanged(e.subsetDefinitions,t.subsetDefinitions),s=null!=e.areaOfInterest;if(n||s)if(n)i.multidimensionalSubset=e;else{const t=e.clone();t.subsetDefinitions=[],i.multidimensionalSubset=t}else i.multidimensionalSubset=null}),100),this.hidePanelHeading=!1,this.panelHeading=void 0,this.dismissible=!1,this.hideButtons=!1,this.hideExtentSection=!1,this.hideAOI=!1,this.isDimensionListSortable=!1,this.collapseExtentSection=!1,this.useCompactExtentDropdowns=!1,this.showVariableFilter=void 0,this.watchViewTime=!1,this.watchRasterFunction=!1,this.updateStateWhenCancel=!0,this.makeLiveLayerUpdate=!0,this.showAnimationControls=!1,this.showAnimationOnStartUp=!1,this.showAnimationTooltip=!1,this.animationSetting={playRate:3e3,timeClassName:"imagery-dimension-picker-t",zClassName:"imagery-dimension-picker-z",timeTooltipPlacement:"top",zTooltipPlacement:"auto"},this.layer=void 0,this.view=void 0,this.multidimensionalInfo=void 0,this.activeMultidimensionalDefinition=void 0,this.activeMultidimensionalSubset=void 0,this.sortDirections={},this.animatedDimensions={time:"",z:""}}watchLayer(e,i){var t,n;this.closePopover(),this.multidimensionalInfo=null,null===(t=this.watchHandleViewTime)||void 0===t||t.remove(),this.watchHandleLayer=null,null===(n=this.watchHandleLayer)||void 0===n||n.remove(),this.watchHandleLayer=null,this.initLayer(e)}watchActiveMultidimensionalDefinition(e,i){if(null==e||null==i)return;this.sortDirections={},!this.pauseLayerUpdate&&this.makeLiveLayerUpdate&&this.updateLayerMultidimensionalDefinition(),this.arcgisRasterMultidimensionalChange.emit({multidimensionalDefinition:e});const{animatedDimensions:t,showAnimationControls:n}=this;if(n&&(t.time||t.z)&&e[0].variableName!==i[0].variableName){const i=this.getVariableInfo(e[0].variableName);i.dimensions.some((({name:e})=>e===t.time))||this.destroyValuePicker("time"),i.dimensions.some((({name:e})=>e===t.z))||this.destroyValuePicker("z")}}watchactiveMultidimensionalSubset(e,i){var t;!this.pauseLayerUpdate&&this.makeLiveLayerUpdate&&this.updateLayerMultidimensionalSubset();const{activeMultidimensionalDefinition:n}=this;if((null===(t=e.variables)||void 0===t?void 0:t.length)&&(null==n?void 0:n.length)){const i=this.allVariables.filter((({name:i})=>e.variables.includes(i))).map((({name:e})=>e)),t=n[0].variableName,s=""===t||e.variables.includes(t)?t:i[0],a=this.getNewMultidimensionalDefinition(s);this.isMultidimensionalDefinitionChanged(a)&&(this.activeMultidimensionalDefinition=a)}const s={multidimensionalSubset:e};this.arcgisRasterMultidimensionalChange.emit(s)}async componentWillLoad(){[this.strings]=await(0,a.g)(this.hostElement),[this.esriLang,this.intl,this.DimensionalDefinition,this.MultidimensionalSubset,this.ValuePicker]=await(0,l.l)(["esri/core/lang","esri/intl","esri/layers/support/DimensionalDefinition","esri/layers/support/MultidimensionalSubset","esri/widgets/ValuePicker"]);const{layer:e}=this;e.loaded?await this.initLayer(e):this.initLayer(e),this.containerTop=this.hostElement.getBoundingClientRect().top}disconnectedCallback(){var e,i;this.closePopover(),this.destroyValuePicker("both"),null===(e=this.watchHandleViewTime)||void 0===e||e.remove(),null===(i=this.watchHandleLayer)||void 0===i||i.remove()}async setFocus(e){var i;"dismiss-button"===e||!e&&this.dismissible?null===(i=this.refCloseButtonNode)||void 0===i||i.setFocus():this.refPanelNode.setFocus()}async done(){this.apply()}render(){var e;this.popOver&&this.updatePopoverProps();const i="rtl"===(0,o.g)(this.hostElement),{hidePanelHeading:t,dismissible:s,hideButtons:a,panelHeading:l,hideExtentSection:r,strings:d}=this,u=!(null===(e=this.layer)||void 0===e?void 0:e.loaded);if(!this.multidimensionalInfo){const e=u?null:(0,n.h)("div",{class:"multidimensional-unsupported"},d.general.unsupported);return(0,n.h)("calcite-panel",{loading:u,heading:t?void 0:null!=l?l:d.title,class:{panel:!0,[o.C.rtl]:i},ref:e=>this.refPanelNode=e},s&&this.renderClose(),e,!a&&this.renderDoneButton(),!a&&this.renderCancelButton())}return(0,n.h)(n.H,null,(0,n.h)("calcite-panel",{loading:!1,heading:t?void 0:null!=l?l:d.title,class:{panel:!0,[o.C.rtl]:i},ref:e=>this.refPanelNode=e},s?this.renderClose():null,r?null:this.renderExtent(),this.renderCurrentDisplay(),a?null:this.renderDoneButton(),a?null:this.renderCancelButton()))}renderCurrentDisplay(){var e;const{activeMultidimensionalDefinition:i,strings:t}=this,s=this.activeMultidimensionalSubset.variables,a=this.allVariables.filter((({name:e})=>!s.length||s.includes(e))),{layer:l}=this,o=this.isImageryLayer(l),d=o&&(a.some((({name:e})=>"*"===e))||this.hasNewVariable(this.multidimensionalInfo));let u=i[0].variableName;if(o){const{rasterFunction:i,version:n}=l;i&&"none"!==(null===(e=i.functionName)||void 0===e?void 0:e.toLowerCase())&&(n<=r.m&&a.unshift(Object.assign(Object.assign({},a[0]),{name:t.display.defaultVariable,label:t.display.defaultVariable})),""===u&&(u=d?a[0].name:t.display.defaultVariable))}const c=a.findIndex((e=>e.name===u)),h={clearFilter:t.select.clearFilter,filterText:t.select.filterText,filterLabel:t.extent.searchVariables,selectLabel:t.extent.selectVariables},m=(0,n.h)("div",null,(0,n.h)("calcite-label",null,t.display.variable,(0,n.h)("arcgis-lazy-loading-select",{selectedIndex:-1===c?0:c,list:a.map((e=>Object.assign(Object.assign({},e),{value:e.name}))),strings:h,key:this.sourceKey,onArcgisLazyLoadingSelectChange:e=>{const i=e.detail.selectedValue;this.updateDefinitionVariableName(i)},containerTop:this.containerTop})));u===t.display.defaultVariable&&(u="");const v=this.getVariableInfo(u).dimensions.map((e=>(e=(0,r.g)(e,this.activeMultidimensionalSubset),this.renderDimension(e))));return(0,n.h)("calcite-block",{heading:t.display.current,collapsible:!0,open:!0},m,v)}renderPickListPopover(){if(this.popOver)return;const e=document.createElement("arcgis-field-pick-list"),i=this.refPanelNode.getBoundingClientRect().width;e.popoverProps={refElement:this.refPanelNode,placement:"leading-end",offsetDistance:1,offsetSkidding:48,popoverWidth:i},e.heading=this.strings.extent.selectVariables,e.filterPlaceholderText=this.strings.extent.searchVariables,e.showFieldInfo=!1,e.showFieldName=!1,e.showDescription=!0,e.showSelectionAll=!0,e.showCancel=!1,e.showSort=!1,e.sortBy=d.L.default,e.multiple=!0,this.popOver=e,this.previousPickedListSize=-1,this.updatePopoverProps(),e.addEventListener("arcgisFieldPickListChange",(e=>{let i=e.detail.selectedFields||[];this.updateExtentVariables(i)})),e.addEventListener("arcgisFieldPickListDismissed",(e=>{this.closePopover()})),document.body.appendChild(e)}renderExtent(){const e=this.renderVariableList(),{extent:i}=this.strings,t=this.allVariables.length>1&&(0,n.h)("div",{class:"variable-select"},(0,n.h)("calcite-button",{scale:"s",appearance:"outline-fill",kind:"neutral",round:!0,alignment:"center",iconStart:"plus",onClick:()=>this.renderPickListPopover()},i.variables)),s=[];this.multidimensionalInfo.variables.forEach((({dimensions:e})=>s.push(...e)));const a=this.activeMultidimensionalSubset.dimensions.map((({name:e,extent:i})=>{const t=s.find((({name:i})=>i===e));return this.renderDimensionExtent(t,i)})),l=this.hideAOI?void 0:this.renderAOI();return(0,n.h)("calcite-block",{heading:i.extent,collapsible:!0,open:!this.collapseExtentSection,onCalciteBlockToggle:()=>this.closePopover()},e,t,a,l)}renderVariableList(){const e=this.activeMultidimensionalSubset.variables,i=this.allVariables.filter((({name:i})=>!e.length||e.includes(i))),{strings:t}=this,s=1===this.allVariables.length;return(0,n.h)("div",null,(0,n.h)("calcite-label",null,t.extent.variables,(0,n.h)("calcite-list",{class:"variable-section-boarder"},i.map((({name:e,label:i,description:a})=>(0,n.h)("calcite-list-item",{label:i,description:a,key:e},(0,n.h)("calcite-action",{icon:"x",scale:"s",text:t.general.close,slot:"actions-end",hidden:s,onClick:()=>this._removeVariable(e)})))))))}renderAOI(){const{strings:e}=this,i=[{value:"default",label:e.extent.default,selected:0===this.aoiIndex},{value:"map",label:e.extent.mapExtent,selected:1===this.aoiIndex}],t=i.findIndex((({selected:e})=>e)),s={clearFilter:this.strings.select.clearFilter,filterText:this.strings.select.filterText,filterLabel:this.strings.extent.searchAOI,selectLabel:this.strings.extent.selectAOI};return(0,n.h)("div",null,(0,n.h)("calcite-label",null,e.extent.aoi,(0,n.h)("arcgis-lazy-loading-select",{selectedIndex:t,list:i,strings:s,onArcgisLazyLoadingSelectChange:e=>{var i;const t=e.detail.selectedValue,n="default"===t?null:null===(i=this.view)||void 0===i?void 0:i.extent;this.aoiIndex="default"===t?0:1,this.updateExtentAOI(n)},containerTop:this.containerTop})))}_removeVariable(e){const i=this.activeMultidimensionalSubset.clone();let t=i.subsetDefinitions.filter((i=>i.variableName!==e));0===t.length&&(t=this.getDefaultMultidimensionalSubset().subsetDefinitions),i.subsetDefinitions=t,this.activeMultidimensionalSubset=i}renderDimensionList(e,i){var t;let{selectedValue:s,key:a}=i;const l=(null==a?void 0:a.includes("start"))||(null==a?void 0:a.includes("end"));if(Array.isArray(null===(t=e.values)||void 0===t?void 0:t[0])&&"number"==typeof s){const i=e.values;l?s=i.find((e=>a.includes("start")?e[0]===s:e[1]===s)):(s=i.find((e=>e[0]===s)),null==s&&(s=i.find((e=>e[1]===s))))}const o=s===u||i.selectedValue===u,d=o?"undefined":(0,r.f)(s,e,{intl:this.intl,useRecurringTimeLabel:!0}),c=!i.sortable||"descending"!==this.sortDirections[e.name],h=(c?e.values:[...e.values].reverse()).map((t=>{const n=(0,r.f)(t,e,{intl:this.intl,useRecurringTimeLabel:!0}),s=Array.isArray(t)?t.join(" - "):String(t),a=n===d;return{key:`${i.key}-${s}}`,value:s,label:n,selected:a}}));i.showEnd&&h.push({key:`${e.name}-end-undefined}`,value:String(u),label:this.strings.extent.endUndefined,selected:o});let m=null;if(i.sortable){const i=(0,r.i)(e)?c?"clock-up":"clock-down":c?"sort-ascending-arrow":"sort-descending-arrow";m=(0,n.h)("calcite-action",{icon:i,scale:"s",text:this.strings.display.sort,slot:"actions-end",onClick:()=>{this.updateSorting(e.name)}})}const v=h.findIndex((({selected:e})=>e)),f={clearFilter:this.strings.select.clearFilter,filterText:this.strings.select.filterText,filterLabel:this.strings.extent.searchDimensions,selectLabel:this.strings.extent.selectDimensions};return(0,n.h)("div",{class:"dimension-select-container"},(0,n.h)("arcgis-lazy-loading-select",{selectedIndex:-1===v?0:v,list:h,strings:f,onArcgisLazyLoadingSelectChange:e=>{var t;const n=e.detail.selectedValue.split(" - ").map((e=>Number(e)));null===(t=i.onChange)||void 0===t||t.call(i,1===n.length?n[0]:n)},containerTop:this.containerTop}),m)}renderDimension(e){const{activeMultidimensionalDefinition:i}=this,t=i.find((i=>i.dimensionName===e.name)),s=this.renderDimensionList(e,{selectedValue:t.values[0],sortable:this.isDimensionListSortable,key:e.name,onChange:i=>this.updateDefinitionDimensionValue(e.name,i,!0)}),{strings:a}=this,l="StdTime"===e.name?a.display.stdTimeDimension:"StdZ"===e.name?a.display.stdZDimension:a.display.generalDimension.replace("${dimensionName}",e.name),o=(0,r.i)(e,!0),d=o?"time":"z",u=(0,r.g)(e,this.activeMultidimensionalSubset).values.length<2,{showAnimationControls:c}=this,h=c&&!u?(0,n.h)("calcite-label",{layout:"inline"},(0,n.h)("calcite-switch",{scale:"s",checked:this.animatedDimensions[d]===e.name,label:a.display.showDimensionSlider,onCalciteSwitchChange:i=>{i.target.checked?this.createValuePicker(e):this.destroyValuePicker(o?"time":"z")}}),a.display.showDimensionSlider):null;return c?(0,n.h)("div",{class:"dimension-zone"},(0,n.h)("calcite-label",null,l),(0,n.h)("calcite-label",null,a.display.defaultPosition,s),h):(0,n.h)("div",null,(0,n.h)("calcite-label",null,l,s))}renderDimensionExtent(e,i){var t;const a=[],l=[];e.values.forEach((e=>{Array.isArray(e)?(e[1]<=i[1]&&a.push(e),e[0]>=i[0]&&l.push(e)):(e<i[1]&&a.push(e),e>i[0]&&l.push(e))}));const o=i[1]===i[0]||Array.isArray(e.values[0])&&e.values.some((e=>e[0]===i[0]&&e[1]===i[1])),r=o?e:Object.assign(Object.assign({},e),{values:a}),d=this.renderDimensionList(r,{selectedValue:i[0],sortable:!1,key:e.name+"-start",onChange:i=>this.updateExtentDimensionSubset(e.name,i,"start")}),c=Object.assign(Object.assign({},e),{values:l}),h=this.renderDimensionList(c,{selectedValue:o?u:i[1],sortable:!1,key:e.name+"-end",showEnd:!0,onChange:i=>this.updateExtentDimensionSubset(e.name,i,"end")}),{strings:m}=this,v="StdTime"===e.name?m.extent.stdTimeExtent:"StdZ"===e.name?m.extent.stdZExtent:m.extent.generalExtent.replace("${dimensionName}",e.name),f=e.values,g=f.length;let p;const b=(0,s.d)((()=>{var i;let t,n;Array.isArray(p.value)?(t=f[p.value[0]],n=f[null!==(i=p.value[1])&&void 0!==i?i:p.value[0]]):t=n=f[p.value];const s=Array.isArray(t)?t[0]:t,a=Array.isArray(n)?n[1]:n;this.updateExtentDimensionSubset(e.name,[s,a])}),100);let y=0,D=g-1;const S=null===(t=this.activeMultidimensionalSubset.dimensions.find((({name:i})=>i===e.name)))||void 0===t?void 0:t.extent;S&&(y=f.findIndex((e=>(Array.isArray(e)?e[0]:e)===S[0])),-1===y&&(y=0),D=f.findIndex((e=>(Array.isArray(e)?e[1]:e)===S[1])),-1===D&&(D=g-1));const w=i[0]===i[1]?(0,n.h)("calcite-slider",{disabled:!1,min:0,max:g-1,value:y,step:1,snap:!0,labelTicks:!1,ticks:g,onCalciteSliderInput:b,onCalciteSliderChange:b,ref:e=>p=e}):(0,n.h)("calcite-slider",{disabled:!1,min:0,max:g-1,"min-value":y,"max-value":D,step:1,snap:!0,labelTicks:!1,ticks:g,onCalciteSliderInput:b,onCalciteSliderChange:b,ref:e=>p=e});return(0,n.h)("div",{class:"dimension-zone"},(0,n.h)("calcite-label",null,v),w,(0,n.h)("div",{class:this.useCompactExtentDropdowns?"multidimensional-extent-compact":"multidimensional-extent"},(0,n.h)("div",null,(0,n.h)("calcite-label",null,m.extent.start,d)),(0,n.h)("div",null,(0,n.h)("calcite-label",null,m.extent.end,h))))}renderClose(){const{strings:e}=this;return(0,n.h)("calcite-action",{text:e.general.close,icon:"x",slot:"header-actions-end",onClick:this.cancel,ref:e=>{this.refCloseButtonNode=e}})}renderDoneButton(){const{strings:e}=this;return(0,n.h)("calcite-button",{slot:"footer",onClick:this.apply,appearance:"solid",width:"half",label:e.general.done},e.general.done)}renderCancelButton(){const{strings:e}=this;return(0,n.h)("calcite-button",{slot:"footer",onClick:this.cancel,appearance:"outline-fill",width:"half",label:e.general.cancel},e.general.cancel)}async initLayer(e){var i,t,n,a,l,o,d,u;if(!e)return;if(e.loaded||await e.load(),this.rawMultidimensionalInfo=await(0,r.a)(e,!0),!this.rawMultidimensionalInfo)return;const c=this.isImageryLayer(e);let h="none";if(c){const s=null!==(i=await(0,r.a)(e))&&void 0!==i?i:this.rawMultidimensionalInfo,a=(null===(t=s.variables)||void 0===t?void 0:t.length)>1&&this.hasNewVariable(s);this.multidimensionalInfo=a?this.rawMultidimensionalInfo:s,h=null===(n=e.rasterFunction)||void 0===n?void 0:n.functionName}else this.multidimensionalInfo=this.rawMultidimensionalInfo;this.sourceKey=`${e.url}-${h}`,this.allVariables=this.multidimensionalInfo.variables.map((({name:e,unit:i,description:t,dimensions:n,statistics:s})=>({name:e,label:i?`${e} (${i})`:e,description:t,dimensionNames:n.map((({name:e})=>e)).join(", "),statisticsRange:null==s?void 0:s.map((({min:e,max:i})=>[e,i].join(", "))).join("; ")})));const m=this.getMultidimensionalDefinition(e),v=c?null===(a=e.mosaicRule)||void 0===a?void 0:a.clone():null,f=null===(l=e.renderer)||void 0===l?void 0:l.clone(),g=null===(o=e.multidimensionalSubset)||void 0===o?void 0:o.clone();this.originalLayerSetting={subset:g,mosaicRule:v,definition:m,renderer:f},this.activeMultidimensionalDefinition=this.esriLang.clone(this.originalLayerSetting.definition);let p=null;(null===(u=null===(d=e.multidimensionalSubset)||void 0===d?void 0:d.subsetDefinitions)||void 0===u?void 0:u.length)?(p=e.multidimensionalSubset,p.variables.some((e=>!this.multidimensionalInfo.variables.some((i=>i.name===e))))&&(e.multidimensionalSubset=null,this.originalLayerSetting.subset=null,p=this.getDefaultMultidimensionalSubset())):p=this.getDefaultMultidimensionalSubset(),this.activeMultidimensionalSubset=p,this.showAnimationOnStartUp&&this.launchDimensionalSliders(),this.watchViewTime&&this.view&&!this.watchHandleViewTime&&(this.watchHandleViewTime=this.view.watch("timeExtent",this.updateExtentFromTime)),this.watchRasterFunction&&!this.watchHandleLayer&&c&&(this.watchHandleLayer=e.watch("rasterFunction",(0,s.d)((async(i,t)=>{if((null==i?void 0:i.functionName)===(null==t?void 0:t.functionName))return;const n=await(0,r.a)(e);this.isPropertyValueChanged(n,this.multidimensionalInfo)&&(this.closePopover(),this.initLayer(e))}),100)))}closePopover(){this.popOver&&(document.body.removeChild(this.popOver),this.popOver=null)}getMultidimensionalDefinition(e){const i=(0,r.c)(e);return(null==i?void 0:i.length)?i:this.getNewMultidimensionalDefinition(this.allVariables[0].name)}getNewMultidimensionalDefinition(e){var i;const t=null!==(i=this.getVariableInfo(e).dimensions)&&void 0!==i?i:[],n=t.map((e=>e.name)),s=this.activeMultidimensionalDefinition||[],a=this.esriLang.clone(s),l=s.map((e=>e.dimensionName));return 0===n.length?(a.forEach((i=>{i.variableName=e,i.dimensionName="",i.values=[],i.isSlice=!0})),a):l.length===n.length&&n.every((e=>l.includes(e)))?(a.forEach((i=>{i.variableName=e;const n=t.find((({name:e})=>e===i.dimensionName));(0,r.u)(i,n,this.activeMultidimensionalSubset)})),a):(a.length=0,t.forEach((i=>{var t;let n=null===(t=s.find((e=>e.dimensionName===i.name)))||void 0===t?void 0:t.clone();if(n)n.variableName=e;else{const t=(0,r.b)(i);n=new this.DimensionalDefinition({variableName:e,dimensionName:i.name,values:[t],isSlice:!0})}(0,r.u)(n,i,this.activeMultidimensionalSubset),a.push(n)})),a)}isMultidimensionalDefinitionChanged(e){return JSON.stringify(e)!==JSON.stringify(this.activeMultidimensionalDefinition)}launchDimensionalSliders(){var e;this.destroyValuePicker("both");const{activeMultidimensionalDefinition:i,multidimensionalInfo:t}=this,n=i[0].variableName,s=null!==(e=t.variables.find((({name:e})=>e===n)))&&void 0!==e?e:t.variables[0],a=s.dimensions.find((e=>(0,r.i)(e,!0)));this.createValuePicker(a);const l=s.dimensions.find((e=>!(0,r.i)(e,!0)));this.createValuePicker(l)}destroyValuePicker(e){var i,t,n,s;"time"!==e&&"both"!==e||(null===(i=this.valuePickers.time)||void 0===i||i.handle.remove(),null===(t=this.valuePickers.time)||void 0===t||t.slider.destroy(),this.valuePickers.time=null,this.animatedDimensions.time=""),"z"!==e&&"both"!==e||(null===(n=this.valuePickers.z)||void 0===n||n.handle.remove(),null===(s=this.valuePickers.z)||void 0===s||s.slider.destroy(),this.valuePickers.z=null,this.animatedDimensions.z="")}createValueTicks(e,i){return Array.from({length:i},((t,n)=>0===n?0:n===i-1?e.length-1:Math.round(n*(e.length-1)/(i-1))))}createValuePicker(e){var i,t,n;if(!e||!this.showAnimationControls)return;this.activeMultidimensionalSubset&&(e=(0,r.g)(e,this.activeMultidimensionalSubset));const s=(0,r.i)(e,!0),a=e.values.length<2;let l=s?this.valuePickers.time:this.valuePickers.z;if((a||l&&l.dimensionName!==e.name)&&(this.destroyValuePicker(s?"time":"z"),l=null),a)return;const o=null===(i=this.activeMultidimensionalDefinition.find((({dimensionName:i})=>i===e.name)))||void 0===i?void 0:i.values,d=o?e.values.findIndex((e=>Array.isArray(e)&&Array.isArray(o[0])?e.join()===o.join():e===o[0])):0,u=[...e.values];let c=u[u.length-1];Array.isArray(c)&&(c=c[c.length-1]);const h=!s&&c<=0,m=u.map(((e,i)=>i)),v=m.length,f=v<=4?2:s||v<=10?3:4,g=this.createValueTicks(m,f),p=Math.min(19,v>19?Math.floor(v/2):v),b=this.createValueTicks(m,p),y=[...g],D=document.createElement("div"),{animationSetting:S}=this;D.classList.add(s?S.timeClassName:S.zClassName),document.body.appendChild(D);const w=S.playRate<=0?this.isImageryLayer(this.layer)?3e3:2e3:S.playRate,x={type:"slider",min:0,max:u.length-1,steps:m,minorTicks:b,majorTicks:g,labels:y,reversed:h,visibleElements:{thumbTooltip:this.showAnimationTooltip},labelFormatFunction:(i,t)=>{const n=h?u.length-1-i:i;return"tick"===t?(0,r.f)(u[n],e,{intl:this.intl,useRecurringTimeLabel:!0,useFriendlyISOFormat:!0,useStartOrEndForRangedValue:!0}):(0,r.f)(u[n],e,{intl:this.intl,useRecurringTimeLabel:!0,useFriendlyISOFormat:!0,format:"short-date-long-time"})}},L=this.getSelectedSliderValue(d,h,u.length);if(l){l.handle.remove();const i=l.slider;return i.component=x,i.values=L,l.dimensionValues=u,void(l.handle=i.watch("values",(i=>{const t=h?u.length-1-i[0]:i[0];this.updateDefinitionDimensionValue(e.name,u[t])})))}const M=new this.ValuePicker({caption:e.name,layout:s?"horizontal":"vertical",container:D,label:e.name,playRate:w,component:x,values:L});this.view.ui.add(M,{position:"manual"});const V=M.watch("values",(i=>{const t=h?u.length-1-i[0]:i[0];this.updateDefinitionDimensionValue(e.name,u[t])})),k=s?null!==(t=this.animationSetting.timeTooltipPlacement)&&void 0!==t?t:"top":null!==(n=this.animationSetting.zTooltipPlacement)&&void 0!==n?n:"auto";"auto"!==k&&setTimeout((()=>D.getElementsByTagName("calcite-tooltip")[0].placement=k),1e3);const C={slider:M,dimensionName:e.name,dimensionValues:u,handle:V};s?(this.valuePickers.time=C,this.animatedDimensions.time=e.name):(this.valuePickers.z=C,this.animatedDimensions.z=e.name)}updatePopoverProps(){const e=this.activeMultidimensionalSubset.variables;if(0===this.previousPickedListSize&&e.length===this.multidimensionalInfo.variables.length)return;const{allVariables:i,popOver:t}=this;t.selectedFields=e,t.fields=i.map((e=>({name:e.name,alias:e.name,type:"String",description:e.description})));const n=i[0].description?5:10;t.showFilterLength=null==this.showVariableFilter?n:this.showVariableFilter?1:i.length+1}getDefaultMultidimensionalSubset(e){const{variables:i}=this.multidimensionalInfo,t=[];for(let n=0;n<i.length;n++){const{name:s,dimensions:a}=i[n];if(!(null==e?void 0:e.length)||e.includes(s))if(0===a.length)t.push({variableName:s,dimensionName:"",values:[],isSlice:!1});else for(let e=0;e<a.length;e++){const i=a[e].name,n=[...a[e].extent];t.push({variableName:s,dimensionName:i,values:n,isSlice:!1})}}return new this.MultidimensionalSubset({areaOfInterest:null,subsetDefinitions:t})}getVariableInfo(e){var i;const{variables:t}=this.multidimensionalInfo;return this.isDefaultUnspecifiedVariable(e)?t[0]:null!==(i=t.find((i=>i.name===e)))&&void 0!==i?i:t[0]}getSelectedSliderValue(e,i,t){return[-1===e?0:i?t-1-e:e]}isDefaultUnspecifiedVariable(e){return["","*",this.strings.display.defaultVariable].includes(e)}isPropertyValueChanged(e,i){return JSON.stringify(null!=e?e:void 0)!==JSON.stringify(null!=i?i:void 0)}hasNewVariable(e){return e.variables.some((e=>!this.rawMultidimensionalInfo.variables.some((i=>i.name===e.name))))}isImageryLayer(e){return"imagery"===e.type}get hostElement(){return(0,n.d)(this)}static get watchers(){return{layer:["watchLayer"],activeMultidimensionalDefinition:["watchActiveMultidimensionalDefinition"],activeMultidimensionalSubset:["watchactiveMultidimensionalSubset"]}}};c.style=":host{display:flex;flex:1 1 auto;overflow:hidden}.variable-section-boarder{border:1px solid var(--arcgis-app-border)}.variable-select{display:flex;justify-content:center}.multidimensional-extent>div{margin:10px 0}.multidimensional-extent-compact{display:flex;width:100%}.multidimensional-extent-compact>div{width:50%}.multidimensional-extent-compact>div:first-child{margin:0 20px 0 0}.multidimensional-unsupported{margin:20px}.dimension-zone{padding:10px;border:1px solid var(--arcgis-app-border);margin:10px 0}.dimension-select-container{display:flex;width:100%;align-items:center}.dimension-select-container .dimension-select{flex-grow:1}.arcgis--rtl .extent-compact>div:first-child{margin:0 0 0 20px}"},26426:(e,i,t)=>{t.d(i,{a:()=>d,b:()=>h,c:()=>s,d:()=>n,e:()=>a,f:()=>u,g:()=>m,i:()=>l,m:()=>o,t:()=>r,u:()=>c});const n=(e,i)=>{let t,n="idle";const s=(...s)=>new Promise((a=>{switch(n){case"flushed":n="idle",t?(clearTimeout(t),a(e(...s))):a(null);break;case"invoked":clearTimeout(t),n="idle",a(e(...s));break;case"cancelled":clearTimeout(t),n="idle",a(null);break;default:t&&clearTimeout(t),n="pending",t=setTimeout((()=>(n="idle",a(e(...s)))),i)}}));return s.flush=function(...e){return n="flushed",s(...e)},s.invoke=function(...e){return n="invoked",s(...e)},s.cancel=function(...e){return n="cancelled",s(...e)},s.getStatus=function(){return n},s},s=(e,i)=>{let t;return(...n)=>new Promise((s=>{t||(t=setTimeout((()=>{clearTimeout(t),t=void 0,s(e(...n))}),i))}))};function a(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function l(e){return null!=e}async function o(e,i){return await Promise.all([e,r(i)]),e}function r(e){return new Promise((i=>setTimeout(i,e)))}const d=(e,i)=>Object.fromEntries((e||[]).map((e=>{const{key:t,data:n}=i(e);return[t,n]}))),u=(e,i)=>e.length===i.length&&e.reduce(((e,t)=>e&&i.indexOf(t)>-1),!0);function c(e,i){const t=[],n={};return e.forEach((e=>{const s=i(e);null==n[s]&&(n[s]=e,t.push(e))})),t}function h(e){const i={boolean:{},number:{},string:{}},t=[];return e.filter((e=>{let n=typeof e;return n in i?!i[n].hasOwnProperty(e)&&(i[n][e]=!0):!(t.indexOf(e)>=0)&&t.push(e)}))}const m=(e,i)=>[...Array(Math.ceil(e.length/i))].map(((t,n)=>e.slice(i*n,i+i*n)))},62727:(e,i,t)=>{t.d(i,{a:()=>l,g:()=>d});var n=t(18869),s=t(81068),a=t(28384);function l(e){var i,t,a;const l=null!==(i=(0,n.c)(e,"[lang]"))&&void 0!==i?i:null===(a=null===(t=e.shadowRoot)||void 0===t?void 0:t.ownerDocument)||void 0===a?void 0:a.documentElement,o=((null==l?void 0:l.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return s.l.has(o)?s.l.get(o):s.l.has(o.slice(0,2))?s.l.get(o.slice(0,2)):"en"}const o={};function r(e,i){const t=`${e}${i}`;return o[t]||(o[t]=function(e,i){return new Promise(((t,n)=>{fetch((0,a.a)(`../arcgis-app-assets/i18n/${e}.i18n.${i}.json`)).then((e=>{e.ok?t(e.json()):n()}),(()=>n()))}))}(e,i)),o[t]}async function d(e,i){const t=i||e.tagName.toLowerCase(),a=l(e),o=function(e){var i,t,a;const l=null!==(i=(0,n.c)(e,"[lang]"))&&void 0!==i?i:null===(a=null===(t=e.shadowRoot)||void 0===t?void 0:t.ownerDocument)||void 0===a?void 0:a.documentElement,o=((null==l?void 0:l.lang)||(null===navigator||void 0===navigator?void 0:navigator.language)||"en").toLowerCase();return s.l.has(o)?s.l.get(o):s.l.has(o.slice(0,2))?o:"en"}(e);let d;try{d=await r(t,a)}catch(e){console.warn(`no locale for ${t} (${a}) loading default locale en.`),d=await r(t,"en")}return[d,a,o]}},74746:(e,i,t)=>{t.d(i,{a:()=>c,b:()=>d,c:()=>u,f:()=>o,g:()=>r,i:()=>h,m:()=>s,u:()=>m});var n=t(34077);const s=10.9;function a(e,i){const t=new Date(e),{useFriendlyISOFormat:n,intl:s,format:a}=i;if(n&&s)return s.formatDate(t,Object.assign(Object.assign({},s.convertDateFormatToIntlOptions(null!=a?a:"short-date-long-time")),{timeZone:"UTC"}));let l=new Date(e).toISOString();return l=l.slice(0,l.indexOf("."))+"Z",l}function l(e,i,t="long"){const n=new Date(2022,9,10);return n.setMonth(e-1),i.formatDate(n,{month:t})}function o(e,i,t={}){var n,s,o,r;if(null==e)return"";const{intl:d,useRecurringTimeLabel:u}=t;if(u&&d&&!Array.isArray(e)){const t=null===(n=i.intervalUnit)||void 0===n?void 0:n.toLowerCase().trim(),s=function(e){return"StdTime"===e.name&&!!e.recurring}(i)&&("months"===t||"quarters"===t);if(s)return"months"===t?l(e,d):function(e,i){return`${l(3*(e-1)+1,i,"short")} - ${l(3*e,i,"short")}`}(e,d)}const c=null===(s=i.values)||void 0===s?void 0:s[i.values.length-1];if(t.useStartOrEndForRangedValue&&Array.isArray(e)&&2===e.length&&Array.isArray(c)){const i=e.join("-")===c.join("-");e=i?e[1]:e[0]}if(!h(i))return Array.isArray(e)?e.map((e=>{var i;return null!==(i=null==d?void 0:d.formatNumber(e))&&void 0!==i?i:String(e)})).join(" - "):null!==(o=null==d?void 0:d.formatNumber(e))&&void 0!==o?o:String(e);if(t.useFriendlyISOFormat&&!t.format){let e=null===(r=i.intervalUnit)||void 0===r?void 0:r.toLowerCase().trim(),{interval:n,extent:s}=i;if("months"===e?n>11&&(e="year"):"days"===e?n>364?e="year":n>27&&(e="months"):"hours"===e&&(e="days"),!["years","months","days"].includes(e)&&(null==s?void 0:s.length)){const t=(s[1]-s[0])/i.values.length,n=864e5;t>=365*n?e="years":t>=28*n&&(e="months")}const a="years"===e?"year":"months"===e?"short-month-year":"short-date";t=Object.assign({format:a},t)}return Array.isArray(e)?e.map((e=>a(e,t))).join(" - "):a(e,t)}function r(e,i){var t;const s=null===(t=null==i?void 0:i.dimensions)||void 0===t?void 0:t.find((({name:i})=>i===e.name));if(!(null==s?void 0:s.extent))return e;const a=[...s.extent],l=e.values.filter((e=>Array.isArray(e)?(0,n.i)(a[1])&&a[0]!==a[1]?e[0]>=a[0]&&e[0]<=a[1]&&e[1]>=a[0]&&e[1]<=a[1]:e[0]===a[0]:e>=a[0]&&e<=a[1]));if(0===l.length){const i=e.values[e.values.length-1];Array.isArray(i)&&i[1]===a[0]&&l.push(i)}return Object.assign(Object.assign({},e),{extent:a,values:l})}function d(e){var i;const{values:t,extent:n,name:s}=e;let a=null!==(i=null==t?void 0:t[0])&&void 0!==i?i:n[0];return"stdz"===s.toLowerCase()&&!e.hasRanges&&Math.abs(n[1])<=Math.abs(n[0])&&(a=(null==t?void 0:t.length)?t[t.length-1]:n[1]),a}function u(e){var i,t;return"imagery-tile"===e.type?e.multidimensionalDefinition:null===(t=null!==(i=e.mosaicRule)&&void 0!==i?i:e._defaultServiceMosaicRule)||void 0===t?void 0:t.multidimensionalDefinition}async function c(e,i){var t,n;if("imagery-tile"===e.type)return e.rasterInfo.multidimensionalInfo;const{rasterFunction:a,version:l}=e;return i||l<=s||!a||"none"===(null===(t=a.functionName)||void 0===t?void 0:t.toLowerCase())?e.serviceRasterInfo.multidimensionalInfo:(null!==(n=await e.generateRasterInfo(e.rasterFunction))&&void 0!==n?n:e.serviceRasterInfo).multidimensionalInfo}function h(e,i=!1){return"StdTime"===e.name&&(i||!e.recurring)}function m(e,i,t){i=r(i,t);const n=o(e.values[0],i);if(!i.values.some((e=>n===o(e,i)))){const t=d(i);e.values=[t]}}}}]);
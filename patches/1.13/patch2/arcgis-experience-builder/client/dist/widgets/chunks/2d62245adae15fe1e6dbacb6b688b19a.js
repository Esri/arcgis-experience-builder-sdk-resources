/*! For license information please see 2d62245adae15fe1e6dbacb6b688b19a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[7054],{7054:(e,t,i)=>{i.r(t),i.d(t,{arcgis_item_share:()=>p});var r=i(28384),s=i(44371),a=i(76134),o=i(26426),n=i(62727),l=i(62381),h=i(83397),c=i(26800);i(86739),i(41171),i(66716),i(65508),i(27010),i(58892),i(54871),i(31546),i(18869),i(81068);const p=class{constructor(e){(0,r.r)(this,e),this.workflowCancel=(0,r.c)(this,"workflowCancel",7),this.workflowComplete=(0,r.c)(this,"workflowComplete",7),this.initialShareLevels=[],this.initialSelectedGroupData=[],this.initialSelectedGroupDataLookup={},this.showOptions=!1,this.shareLevelOptions=["private","org","public"],this.possibleShareLevelOptions=["private","org","public"],this.shareLevelIcon={private:"user",org:"organization",public:"globe"},this.isPublicUser=!1,this.hasItemBlockedFromPublic=!1,this.hasPrivateItem=!1,this.shareMode="default",this.hasIndoorsSpaces=!1,this.sharingDetailToEmit=null,this.didUpdateSharingDetail=!1,this.shareItemResult=null,this.handleNewShareResult=async()=>{const{items:e,portal:t,shareItemResult:{newShareLevel:i,newGroupShared:r},selectedGroupData:a}=this;let o=[...e];null!=i&&(o=e.map((e=>{if("private"!==i)return Object.assign(Object.assign({},e),{access:i});const t=null==a?void 0:a.some((({selectedByItemIds:t})=>t.includes(e.id)));return Object.assign(Object.assign({},e),{access:t?"shared":"private"})}))),(null==a?void 0:a.length)||(o=o.map((e=>"shared"===e.access?Object.assign(Object.assign({},e),{access:"private"}):e))),r.length&&(o=o.map((e=>"private"===e.access?Object.assign(Object.assign({},e),{access:"shared"}):e))),this.items=o;const n=(await Promise.all(o.map((e=>(0,s.a)(e,t))))).reduce(((e,{result:t})=>(t&&Object.keys(t).forEach((i=>{e[i]=[...e[i],...t[i]]})),e)),Object.assign({},c.D));this.sharingDetail=n},this.updateSharing=async()=>{var e;this.loadingText=this.i18n.updatingInfo,this.isLoading=!0;const{items:t,selectedShareLevels:i,initialSelectedGroupData:r,selectedGroupData:a,portal:o,user:n,isShareLevelDirty:l,checkItemPDCIssue:h,confirmedPDC:p}=this,{shareGroupIds:u,unshareGroupIds:d}=(0,c.g)(r,a);if(!p&&!await h())return;const g=l||1===t.length?i[0]:null,m=d.length?(0,s.u)(t.map((e=>e.id)),d,{portal:o,user:n}):void 0,v=u.length||l?(0,s.b)(t,g,u,{portal:o,user:n}):void 0,[b]=await Promise.all([v,m]),w={newGroupShared:u.filter((e=>!(null==b?void 0:b.result.some((({notSharedWith:t})=>t.includes(e)))))),newGroupUnshared:d,newShareLevel:g,shareErrors:null!==(e=null==b?void 0:b.result.filter((({error:e})=>e)).map((({itemId:e})=>({item:t.find((t=>t.id===e)),code:"notSharedWith"}))))&&void 0!==e?e:[]};this.shareItemResult=w,this.handleNewShareResult()},this.checkItemPDCIssue=async()=>{const{items:e,portal:t,isShareLevelDirty:i,selectedShareLevels:r}=this,s=e.filter((e=>(0,h.i)(e.typeKeywords,e.type))),a=i&&"public"===r[0];if(s.length>0&&a){this.isLoading=!0;const e=await Promise.all(s.map((e=>(0,h.e)(e,t))));this.isLoading=!1;const i=s.filter(((t,i)=>e[i]));if(i.length){const e=!i.every((e=>e.typeKeywords.includes("Public Data Collection")));return this.confirmationDialogType=e?"publicDataCollectionDisabled":"publicDataCollectionEnabled",!1}}return!0},this.handleNewPendingSelectedGroups=e=>{const{items:t,pendingGroupBrowserData:i,selectedGroupData:r}=this,s=(0,o.a)(i.groupData,(e=>({key:e.group.id,data:e}))),a=t.map((e=>e.id)),n=e.map((e=>s[e.id]||{group:e,selectedByItemIds:a}));this.pendingGroupBrowserData={groupData:n,groupDataLookup:(0,o.a)(n,(e=>({key:e.group.id,data:!0}))),groupCount:n.reduce(((e,t)=>(e[t.group.id]=t.selectedByItemIds.length,e)),{}),isDirty:(0,c.i)(n,r)}},this.revertShareLevel=()=>{this.selectedShareLevels=[...this.initialShareLevels]},this.setShareLevel=e=>{this.selectedShareLevels=this.selectedShareLevels.map((()=>e))},this.revertGroupData=()=>{this.selectedGroupData=[...this.initialSelectedGroupData]},this.revertPendingGroupData=e=>{const{initialSelectedGroupData:t,pendingGroupBrowserData:i,handleNewPendingSelectedGroups:r}=this,s=t.find((({group:t})=>t.id===e)),a=i.groupData,o=a.find((({group:t})=>t.id===e));let n=[];n=s?o?a.map((t=>t.group.id!==e?t:s)):[...a,s]:a.filter((({group:t})=>t.id!==e)),r(n.map((({group:e})=>e)))},this.applyPendingGroupData=()=>{this.selectedGroupData=[...this.pendingGroupBrowserData.groupData],this.unBrowseGroups()},this.closeDialog=e=>{var t,i;null==e||e.stopPropagation();const{workflowCancel:r,currentStep:s}=this;"finish"!==s&&r.emit({newShareLevel:null!==(i=null===(t=this.shareItemResult)||void 0===t?void 0:t.newShareLevel)&&void 0!==i?i:null,cancelAtStep:s})},this.unBrowseGroups=()=>{this.isBrowsingGroups=!1},this.renderGroupBrowser=()=>{const{api:e,i18n:t,user:i,portal:s,config:a,pendingGroupBrowserData:o,browserPagination:n,browserGroups:l,handleNewPendingSelectedGroups:h,isBrowsingGroups:c,isPublicUser:p,items:u,shareMode:d,groupBrowserQ:g,initialSelectedGroupDataLookup:m,revertPendingGroupData:v,hasIndoorsSpaces:b,groupBrowserAllUsers:w,groupBrowserSearchUsername:S,hasPrivateItem:D}=this,f=u.length,G="admin"===d&&!D&&w.length>1;return(0,r.h)("arcgis-group-browser",{view:"compact",class:{hidden:!c},config:a,user:i,api:e,portal:s,selection:"multiple",searchUser:S,selectedGroups:o.groupData.map((e=>e.group)),hasIndoorsSpaces:b,q:g,onArcgisGroupBrowserUpdate:e=>{const{results:t,num:i,start:r,total:s}=e.detail;this.browserGroups=t,this.browserPagination={start:r,num:i,total:s}},onArcgisGroupBrowserLoading:()=>{this.browserGroups=[]},onArcgisGroupBrowserSelect:e=>h(e.detail)},(0,r.h)("arcgis-group-browser-top-bar",{slot:"top-bar","filter-toggle":!0},(0,r.h)("arcgis-group-browser-search",{slot:"search",term:""})),(0,r.h)("arcgis-group-browser-sort",{slot:"sort"}),(0,r.h)("arcgis-group-browser-filters",{slot:"filters"},G&&(0,r.h)("arcgis-group-browser-filter-groups-by-user",{searchUsernames:w.map((e=>e.username)),searchUsername:S,onArcgisGroupBrowserUsernamesFilter:e=>{this.groupBrowserSearchUsername=e.detail}}),(0,r.h)("arcgis-group-browser-filter-owner",{searchUsername:S}),!p&&(0,r.h)(r.F,null,(0,r.h)("arcgis-group-browser-filter-membership",null),(0,r.h)("arcgis-group-browser-filter-member-org",null),(0,r.h)("arcgis-group-browser-filter-special-groups",null)),(0,r.h)("arcgis-group-browser-filter-date",{property:"modified"}),(0,r.h)("arcgis-group-browser-filter-date",{property:"created"})),(0,r.h)("arcgis-group-browser-content",{slot:"content",class:"js-content"},(l||[]).map((e=>{const a=e.id;return(0,r.h)("arcgis-item-share-group-card",{key:a,user:i,portal:s,i18n:t,group:e,groupCount:o.groupCount,initialSelectedGroupDataLookup:m,selectedGroupDataLookup:o.groupDataLookup,totalItemCount:f,onRevertClick:()=>{v(a)}})}))),(0,r.h)("arcgis-group-browser-pagination",{slot:"pagination",class:"js-pagination",total:null==n?void 0:n.total,start:null==n?void 0:n.start,num:null==n?void 0:n.num}))},this.renderShareSelectGroup=()=>{const{config:e,hasItemBlockedFromPublic:t,hasSingleShareLevel:i,i18n:s,initialSelectedGroupData:a,isBrowsingGroups:n,isLoading:l,isPublicUser:h,isShareLevelDirty:p,items:u,loadingText:d,portal:g,possibleShareLevelOptions:m,revertGroupData:v,revertShareLevel:b,selectedGroupData:w,selectedShareLevels:S,setShareLevel:D,shareLevelCount:f,shareLevelIcon:G,shareLevelOptions:L,shareMode:y,showOptions:C,user:k,hasPrivateItem:I}=this,B=u.length,P=B.toString(),O=t?s.sharingLimitedItemDisclaimer:s.cannotShareToLevelDisclaimer;return(0,r.h)("div",{class:{hidden:n}},l&&(0,r.h)("arcgis-new-item-loader",{active:l,text:d}),(0,r.h)("div",{class:"section"},(0,r.h)("arcgis-new-item-description",{header:s.shareLevel.title,headerSideContent:p&&(0,r.h)("calcite-button",{appearance:"transparent",iconStart:"reset",disabled:l,onClick:()=>{(0,c.c)(k,u,w)?this.confirmationDialogType="publicAccountRevertShareLevel":b()}},s.revert)}),(0,r.h)("div",{class:"content-container"},(0,r.h)("calcite-tile-select-group",{layout:"vertical",class:"tile-select"},C&&c.d.map((e=>{const t=!m.includes(e);if(t&&h)return null;const a=f[e]+("private"===e?f.shared:0),o=a>0,n=a.toString(),p=s.shareLevel.level[e].title;return(0,r.h)("div",{class:"tile-select-wrapper",key:e},(0,r.h)("calcite-tile-select",{checked:i&&o,heading:p,"aria-label":t?O:void 0,description:s.shareLevel.level[e][h&&"public"===e?"descriptionPublicUser":"description"],name:"dev-cred-create-mode",inputEnabled:!0,width:"full",type:"radio",value:e,icon:G[e],disabled:l||t,class:{"active-but-not-selected":o&&!i},onCalciteTileSelectChange:e=>{const t=e.target.value;(0,c.e)(k,t,w)?this.confirmationDialogType="publicAccountSetShareToPrivate":D(t)}}),!i&&o&&(0,r.h)("div",{class:"share-hint"},(0,r.h)("arcgis-information",{label:s.shareCountLabel,paddedContent:!0,placement:"bottom-end",overlayPositioning:"fixed"},s.shareCountTooltip.replace("${shareLevel}",p).replace("${numItem}",n).replace("${totalItem}",P)),(0,r.h)("p",null,s.shareCountHint.replace("${numItem}",n).replace("${totalItem}",P))))}))),C&&m.length<L.length&&(0,r.h)("p",{class:"information-text"},s.sharingLimitedDisclaimer),(!C||!m.length)&&(0,r.h)("p",{class:"information-text"},s.noShareDisclaimer))),(0,r.h)("div",{class:"section"},(0,r.h)("arcgis-item-share-group",{items:u,user:k,portal:g,config:e,shareMode:y,i18n:s.shareGroup,isLoading:l,onEditGroupClick:()=>{(0,c.s)(k,S)?this.confirmationDialogType="publicAccountOpenGroupBrowser":this.isBrowsingGroups=!0},onAnalyzeUserGroupComplete:e=>{const{initialSelectedGroups:t,userGroupLookup:i,allUsers:r,searchUsername:s}=e.detail;this.initialSelectedGroupData=t,this.selectedGroupData=t,this.initialSelectedGroupDataLookup=(0,o.a)(t,(({group:e,selectedByItemIds:t})=>({key:e.id,data:0===t.length?"none":t.length===B?"all":"indeterminate"}))),this.groupBrowserSearchUsername=s,this.groupBrowserAllUsers=r,this.groupBrowserQ=(0,c.a)({shareMode:y,currentUsername:s,user:k,userGroupLookup:i,isPrivate:I})},onDirtyChange:e=>this.isSelectedGroupsDirty=e.detail,onRemoveClick:()=>this.selectedGroupData=[],onRevertClick:()=>{(0,c.b)(k,S,a)?this.confirmationDialogType="publicAccountRevertGroup":v()},selectedGroupData:w})))},this.renderShareModal=()=>{const{closeDialog:e,i18n:t,isLoading:i,updateSharing:s,isShareLevelDirty:a,isSelectedGroupsDirty:o,isBrowsingGroups:n,applyPendingGroupData:l,unBrowseGroups:h,renderShareSelectGroup:c,renderGroupBrowser:p,currentStep:u,hasSharingIssue:d,pendingGroupBrowserData:g}=this,m=a||o;return("share"===u||null===d)&&(0,r.h)("calcite-modal",{onCalciteModalClose:e,open:!0,width:n?"m":"s",outsideCloseDisabled:!0,escapeDisabled:!0,class:{"group-browser-modal":n}},(0,r.h)("div",{slot:"header"},t[n?"titleGroup":"title"]),(0,r.h)("div",{slot:"content",class:"stage"},p(),c()),n?(0,r.h)(r.F,null,(0,r.h)("calcite-button",{slot:"primary",appearance:"outline",kind:"brand","data-id":"cancelButton",onClick:h,width:"full"},t.cancel),g.isDirty&&(0,r.h)("calcite-button",{slot:"secondary",appearance:"solid",kind:"brand",onClick:l,width:"full"},t.apply)):(0,r.h)(r.F,null,(0,r.h)("calcite-button",{slot:"primary",appearance:"outline",kind:"brand","data-id":"cancelButton",onClick:()=>e(),width:"full"},t.cancel),m&&(0,r.h)("calcite-button",{slot:"secondary",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:s,width:"full",disabled:i},t.save)))},this.renderDepCheckModal=()=>{const{api:e,config:t,portal:i,user:s,items:a,closeDialog:o,hasSharingIssue:n,sharingDetail:l}=this;return n&&(0,r.h)("arcgis-dependency-check",{api:e,items:a.map((e=>({item:e}))),portal:i,user:s,config:t,isActive:!0,preProcessedSharingDetail:l,onWorkflowCancel:o,onWorkflowComplete:e=>{e.stopPropagation(),this.didUpdateSharingDetail=!0,this.sharingDetailToEmit=Object.assign({},l),this.sharingDetail=Object.assign({},c.D)}})},this.renderConfirmationDialog=()=>{const{confirmationDialogType:e}=this;if(!e)return null;const{i18n:t,isLoading:i,revertShareLevel:s,setShareLevel:a,revertGroupData:o}=this,{title:n,description:l}=t.shareWarning[e],h="publicDataCollectionDisabled"===e;return(0,r.h)("calcite-modal",{onCalciteModalClose:e=>{e.stopPropagation(),this.confirmationDialogType=null},open:!!this.confirmationDialogType,width:"s",outsideCloseDisabled:!0,escapeDisabled:!0},(0,r.h)("div",{slot:"header",class:"header"},n),(0,r.h)("div",{slot:"content"},l),(0,r.h)("calcite-button",{slot:"primary",appearance:h?"solid":"outline",kind:"brand","data-id":"cancelButton",onClick:()=>this.confirmationDialogType=null,width:"full"},t[h?"ok":"cancel"]),!h&&(0,r.h)("calcite-button",{slot:"secondary",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:()=>{switch(e){case"publicAccountOpenGroupBrowser":a("public"),this.isBrowsingGroups=!0;break;case"publicAccountSetShareToPrivate":a("private"),this.selectedGroupData=[];break;case"publicAccountRevertShareLevel":s(),this.selectedGroupData=[];break;case"publicAccountRevertGroup":a("public"),o();break;case"publicDataCollectionEnabled":this.confirmedPDC=!0,this.updateSharing()}this.confirmationDialogType=null},width:"full",disabled:i},t.update))},this.api=void 0,this.user=void 0,this.portal=void 0,this.config=void 0,this.items=void 0,this.hasTrustedOrgs=!1,this.isLoading=void 0,this.selectedShareLevels=[],this.isShareLevelDirty=!1,this.shareLevelCount={private:0,shared:0,org:0,public:0},this.hasSingleShareLevel=!1,this.selectedGroupData=[],this.isSelectedGroupsDirty=!1,this.loadingText=null,this.isBrowsingGroups=!1,this.confirmationDialogType=null,this.confirmedPDC=!1,this.browserPagination=void 0,this.browserGroups=[],this.pendingGroupBrowserData={groupData:[],groupDataLookup:{},groupCount:{},isDirty:!1},this.groupBrowserQ="",this.groupBrowserSearchUsername="",this.groupBrowserAllUsers=[],this.currentStep="share",this.sharingDetail=null,this.hasSharingIssue=null}handleIsBrowsingGroupsChange(){this.isBrowsingGroups&&this.handleNewPendingSelectedGroups(this.selectedGroupData.map((({group:e})=>e)))}handleShareLevelChange(){const{selectedShareLevels:e,initialShareLevels:t,selectedGroupData:i,items:r}=this;this.isShareLevelDirty=(0,c.f)(e,t,r,i),this.shareLevelCount=e.reduce(((e,t)=>(e[t]++,e)),{private:0,shared:0,org:0,public:0}),this.hasSingleShareLevel=e.every((t=>t===e[0]))}async componentWillLoad(){var e;this.items=this.items.map((e=>{var t;return null!==(t=e.sourceJSON)&&void 0!==t?t:e}));const{items:t,portal:i,user:r,el:o}=this,h=await(0,n.g)(o);this.i18n=h[0],this.loadingText=this.i18n.retrievingInfo,a.c.api=this.api,this.isPublicUser=(0,l.n)(r),this.initialShareLevels=t.map((e=>e.access)),this.selectedShareLevels=[...this.initialShareLevels],this.possibleShareLevelOptions=(0,c.h)(r,t,i);const p=(0,c.j)(t,r,i);this.showOptions="group"!==p,this.shareMode=p,this.hasPrivateItem=t.some((e=>"private"===e.access));const u=(null==i?void 0:i.subscriptionInfo)||(null===(e=null==i?void 0:i.sourceJSON)||void 0===e?void 0:e.subscriptionInfo);this.hasItemBlockedFromPublic=t.some(s.c)||(0,l.c)(u)&&t.some(s.d),this.hasIndoorsSpaces=t.some((e=>{var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("EditExtensionIndoorsSpaces")}))}handleSharingDetailChange(){const{sharingDetail:e}=this;this.hasSharingIssue=null!==e?Object.keys(e).some((t=>e[t].length>0)):null}handleHasSharingIssueChange(){const{hasSharingIssue:e}=this;e?this.currentStep="review-sharing":!1===e&&(this.currentStep="finish")}handleCurrentStepChange(){var e,t;const{currentStep:i,didUpdateSharingDetail:r,workflowComplete:s,sharingDetailToEmit:a,shareItemResult:o}=this;if("finish"!==i)return;const n=r;s.emit({dependentLayersWithSourceItems:n&&a?Object.values(a).reduce(((e,t)=>(e.push(...t.map((({layer:e,sourceItem:t})=>({layer:e,sourceItem:t})))),e)),[]):[],newShareLevel:null!==(e=null==o?void 0:o.newShareLevel)&&void 0!==e?e:null,shareErrors:null!==(t=null==o?void 0:o.shareErrors)&&void 0!==t?t:[],didUpdateDependentLayersSharing:n})}render(){const{renderShareModal:e,renderDepCheckModal:t,renderConfirmationDialog:i}=this;return(0,r.h)(r.F,null,e(),t(),i())}get el(){return(0,r.d)(this)}static get watchers(){return{isBrowsingGroups:["handleIsBrowsingGroupsChange"],selectedShareLevels:["handleShareLevelChange"],sharingDetail:["handleSharingDetailChange"],hasSharingIssue:["handleHasSharingIssueChange"],currentStep:["handleCurrentStepChange"]}}};p.style=".stage{height:100%}.group-browser-modal{--calcite-modal-width:1080px;--calcite-modal-content-padding:0}arcgis-group-browser{height:min(700px, 60vh)}.hidden{display:none}.section:not(:last-child){margin-bottom:2rem}calcite-flow{height:100%}.content-container{margin-top:0.5rem}.active-but-not-selected{position:relative;z-index:2}.tile-select-wrapper{position:relative}.share-hint{display:flex;align-items:center;position:absolute;font-size:0.875rem;inset-inline-end:0.5rem;top:0.5rem;z-index:3}.share-hint>p{margin-top:0;margin-bottom:0;-webkit-margin-start:0.5rem;margin-inline-start:0.5rem;margin-top:2px}.information-text{font-weight:500;margin-top:0;margin-bottom:0;margin-top:0.5rem;font-size:0.875rem}.group-item-counter{font-size:0.875rem;margin-top:0;margin-bottom:0}.revert-single-group-cta:first-child,.group-item-counter:first-child{-webkit-margin-start:0.5rem;margin-inline-start:0.5rem}"}}]);
/*! For license information please see acc69216d16f7f3c879ebb038159411d.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[38909],{38909:(e,t,i)=>{i.r(t),i.d(t,{arcgis_new_item_pages_append_select:()=>u});var o=i(28384),n=i(58892),a=i(88009),s=i(54871),r=i(76134),l=i(26426),d=i(64171),c=i(56482),p=i(83247),m=i(83129);i(27010),i(99274),i(61099),i(62381),i(59004),i(41171),i(66716),i(86739),i(65508),i(31546),i(24552),i(85142),i(72022),i(96729),i(58728),i(83397),i(18869),i(46220),i(82463),i(48507),i(48333),i(86274);const u=class{constructor(e){(0,o.r)(this,e),this.newItemUpdatePage=(0,o.c)(this,"newItemUpdatePage",7),this.newItemToggleNavigationEnabled=(0,o.c)(this,"newItemToggleNavigationEnabled",7),this.workflowComplete=(0,o.c)(this,"workflowComplete",7),this.insertOnly=!1,this.isCloudItem=!1,this.isUrlItem=!1,this.options={add:{icon:"add-features",updateType:"add",hidden:!1,disabled:!1},update:{icon:"update-features",updateType:"update",hidden:!1,disabled:!1},upsert:{icon:"add-and-update-features",updateType:"upsert",hidden:!1,disabled:!1},overwrite:{icon:"overwrite-features",updateType:"overwrite",hidden:!1,disabled:!1}},this.selected="add",this.error=void 0,this.loading=!1,this.loaderType="indeterminate",this.loaderMessage=void 0}handleNext(){let e;const{item:t,selected:i,layer:o,layerId:a,appendLayerEntry:s}=this;if(n.a.addAppendSelectOption=i,!s&&"overwrite"!==i&&t.layers.length>1)e="appendSelectLayer";else{if(t.cloudProviderInfo&&"overwrite"===i){if(n.a.newItemMode="file",t.cloudProviderInfo.cloudProvider){const{id:e,mimeType:i,cloudProvider:o}=t.cloudProviderInfo;return this.assignCloudItemStore(t.cloudProviderInfo),void this.handleOverwriteURL(t,e,i,o)}return void this.handleOverwriteURL(t)}if(s){let e=null!=o?o:t.layers[a];e||(e=t.layers[0]),n.a.sourceDataLayer=e}else n.a.sourceDataLayer=t.layers[0];e="appendUpload"}this.newItemUpdatePage.emit(e)}createOptions(){var e,t;const i=this.item,o=!i.sourceData&&!i.cloudProviderInfo,n="GeoPackage"===(null===(e=i.sourceData)||void 0===e?void 0:e.type)&&r.c.portal.isPortal;(-1!==(r.c.portal.isPortal&&!i.isSDS?i.serviceInfo.capabilities:i.adminServiceInfo.capabilities).indexOf("ChangeTracking")||i.serviceInfo.syncEnabled)&&(this.insertOnly=!0,this.options.overwrite.disabled=!0,this.options.update.disabled=!0,this.options.upsert.disabled=!0),(this.appendLayerEntry||n||"Service Definition"===(null===(t=i.sourceData)||void 0===t?void 0:t.type)||o)&&(this.options.overwrite.disabled=!0)}createOverwriteNextText(){switch(!0){case this.isCloudItem:return"signInAndOverwrite";case this.isUrlItem:return"overwriteAndComplete";default:return"next"}}async componentWillLoad(){var e,t,i,o,a,r,l,d,c,p,m;this.selected=n.a.addAppendSelectOption||"add",this.i18n=s.u.i18n.appendSelect,this.item=n.a.existingItem,this.appendLayerEntry=void 0!==n.a.layerId||!!n.a.sublayer,this.layerId=n.a.layerId,this.layer=n.a.sublayer,n.a.id=null,n.a.dateFieldsTimeReference=null!==(l=null!==(i=null===(t=null===(e=this.item)||void 0===e?void 0:e.publishParameters)||void 0===t?void 0:t.dateFieldsTimeReference)&&void 0!==i?i:null===(r=null===(a=null===(o=this.item)||void 0===o?void 0:o.publishParameters)||void 0===a?void 0:a.layers)||void 0===r?void 0:r[0].dateFieldsTimeReference)&&void 0!==l?l:this.item.layers[0].dateFieldsTimeReference,this.isUrlItem=!!(null===(c=null===(d=this.item)||void 0===d?void 0:d.cloudProviderInfo)||void 0===c?void 0:c.url),this.isCloudItem=!!(null===(m=null===(p=this.item)||void 0===p?void 0:p.cloudProviderInfo)||void 0===m?void 0:m.cloudProvider),this.createOptions()}assignCloudItemStore(e){const{cloudProvider:t,id:i,mimeType:o,cloudDriveFileName:a,cloudFileType:s,zipItemType:r}=e;n.a.cloudProvider=(0,d.d)(t),n.a.cloudProviderResource={cloudProvider:t,id:i,mimeType:o,cloudDriveFileName:a,cloudFileType:s,zipItemType:r}}async setUpCloud(e){const t=(0,d.e)(e),{result:i,error:o}=await(0,p.g)(t);return o?(this.handleError(),null):i}async handleOverwriteURL(e,t,i,o){var u,h,v,g,f,w,x;let y,T,b;this.loading=!0,this.loaderMessage=s.u.i18n.append.appendLoadingMessages.overwriting;const I=e.cloudProviderInfo;if(n.a.fileName=e.title,n.a.title=e.title,I.cloudProvider){T=a.A[i],b=[n.a.type];const e=await this.setUpCloud(o);switch(await(0,l.t)(200),o){case"googleConnect":y=(0,d.f)(t,i,e);break;case"dropBoxConnect":y=(0,d.i)(t,e);break;case"oneDriveConnect":y=(0,d.h)(t,e)}}else{"geojson"===I.mimeType?n.a.geoJSONResource={fileName:I.fileName,url:I.url,mimeType:I.mimeType}:n.a.csvResource={fileName:I.fileName,url:I.url,mimeType:I.mimeType};const e=null!==(u=n.a.csvResource)&&void 0!==u?u:n.a.geoJSONResource;T=a.A[e.mimeType],y=e.url,b=[T]}n.a.dataUrl=y,n.a.type=T,n.a.typeKeywords=b,n.a.overwrite=!0;try{this.newItemToggleNavigationEnabled.emit(!1),await(0,m.x)();const t=await(0,p.a)(e,r.c.portal,r.c.user,n.a.id),i=await(0,c.p)({itemId:null!==(v=null===(h=null==e?void 0:e.sourceData)||void 0===h?void 0:h.id)&&void 0!==v?v:e.id,user:r.c.user,title:(null==e?void 0:e.title)||"",itemOwnerUrl:e.itemOwner.userContentUrl},t);await(0,p.u)(t.publishParameters,e,null===(f=null===(g=i.result)||void 0===g?void 0:g.services)||void 0===f?void 0:f[0].serviceItemId),await this.checkStatus({itemId:e.id,jobId:null===(x=null===(w=i.result)||void 0===w?void 0:w.services)||void 0===x?void 0:x[0].jobId},null==i?void 0:i.result)}catch(e){this.handleError()}}async checkStatus(e,t){var i;this.loaderMessage=s.u.i18n.append.appendLoadingMessages.overwriting,this.newItemToggleNavigationEnabled.emit(!0);const o=await(0,m.w)(e.itemId,{jobId:e.jobId}),a=null==o?void 0:o.status,r=Object.assign({id:null===(i=null==t?void 0:t.services)||void 0===i?void 0:i[0].serviceItemId,item:Object.assign({},n.a),overwriteStatus:a,appendType:n.a.addAppendSelectOption},t);return"completed"===(null==o?void 0:o.status.toLowerCase())?(r.overwriteStatus=null==o?void 0:o.status,this.workflowComplete.emit(r),null):("failed"===(null==o?void 0:o.status.toLowerCase())&&this.handleError(),o)}handleError(){s.u.nextText="next",this.newItemToggleNavigationEnabled.emit(!0),this.loading=!1,this.error={title:s.u.i18n.error,description:s.u.i18n.appendUpload.errors.errorWhileUpload}}render(){const{i18n:e,options:t,insertOnly:i,error:n,loaderType:a,loading:r,loaderMessage:l}=this;return(0,o.h)(o.H,{class:{"overflow-hidden":r}},(0,o.h)("arcgis-new-item-loader",{type:a,active:r,text:l}),(0,o.h)("div",{class:"header"},i?e.insertOnlyEnabled:e.chooseUpdate),(0,o.h)("div",{class:"tile-select"},Object.keys(t).map((i=>{const{icon:n,hidden:a,disabled:r}=t[i];return(0,o.h)("calcite-tile-select",{key:i,checked:this.selected===i,heading:e.options[i].title,icon:n,name:"append-select-update",width:"full",type:"radio",value:i,class:"tile-card",hidden:a,disabled:r,inputEnabled:!0,onCalciteTileSelectChange:e=>{this.selected=e.target.value,s.u.nextText="overwrite"===this.selected?this.createOverwriteNextText():"next"}})}))),(0,o.h)("arcgis-new-item-alert",{heading:null==n?void 0:n.title,description:null==n?void 0:n.description,active:!!n,onAlertDismiss:()=>this.error=null}))}get el(){return(0,o.d)(this)}};u.style=".tile-select{display:grid;font-size:1.125rem;margin-right:0.75rem;margin-left:0.75rem;margin-top:1rem;padding-bottom:6rem}@media (min-width: 480px){.tile-select{grid-template-columns:repeat(2, 1fr)}}.tile-card:hover{box-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.08), 0 2px 8px 0 rgba(0, 0, 0, 0.04)}.header{font-size:1rem;font-weight:500;margin-left:0.75rem}.insert-only-info{color:var(--calcite-ui-text-1);font-weight:500;font-size:0.75rem;margin-left:0.75rem}"},64171:(e,t,i)=>{i.d(t,{a:()=>y,b:()=>l,c:()=>r,d:()=>b,e:()=>T,f:()=>v,g:()=>x,h:()=>f,i:()=>p});var o=i(76134);function n(e,t,i,o,n){return new Promise(((a,s)=>{const r=new XMLHttpRequest;r.open(e,t,!1),o&&r.setRequestHeader("Authorization",o),n&&r.setRequestHeader("Content-type",n),i?r.send(i):r.send();const l=JSON.parse(r.responseText);r.status>=400&&s(JSON.parse(r.responseText)),a(l)}))}function a(e,t){return new Promise(((i,o)=>{t=t.replace(/[[]/,"[").replace(/[]]/,"]");const n=new RegExp(`[?&#]${t}=([^&#]*)`).exec(e);null==n?o("InvalidToken"):i(n[1])}))}function s(e,t){return new Promise(((i,o)=>{const n=`${window.location.protocol}//${window.location.hostname}`,a=`https://${t}/home/cloudDriveOauth-callback.html?cloudUrl=${e}&currentSourceUrl=${n}&portalHostName=${t}`,s=document.createElement("iframe");s.src=a,s.className="hide",document.body.appendChild(s);const r=window.addEventListener?"addEventListener":"attachEvent";(0,window[r])("attachEvent"===r?"onmessage":"message",(e=>{e.origin===`https://${t}`&&("popupBlocked"!==e.data&&"windowClosed"!==e.data||o(e.data),i(e.data))}),!1)}))}const r={csv:"file-csv",excel:"file-excel",zip:"file-zip",geojson:"file-code",sheet:"file-report",cad:"file-cad",gpx:"file-gpx",png:"file-image",jpg:"file-image",jpeg:"file-image",tiff:"file-image",gif:"file-image",pdf:"file-pdf",docx:"file-word"},l={csv:"CSV",excel:"Excel",zip:"Zip File",geojson:"GeoJSON",googlesheets:"Google Sheets",cad:"CAD",gpx:"GPX",png:"Image",jpg:"Image",jpeg:"Image",tiff:"Image",gif:"Image",pdf:"PDF",docx:"Microsoft Word",pptx:"Microsoft PowerPoint"},d={csv:".csv",excel:".xls",zip:".zip",geojson:".geojson",googlesheets:""};function c(e){const t=e.split("."),i=t[t.length-1].toLowerCase();return{xls:"excel",xlsx:"excel",csv:"csv",zip:"zip",geojson:"geojson",json:"geojson"}[i]||i}function p(e,t){return`https://content.dropboxapi.com/2/files/download?httpHeaders={"Authorization":"Bearer&#32;${t}","Dropbox-API-Arg":"{\\"path\\":\\"${e}\\"}"}`}class m{constructor(){this.nextStart=0}async connect(){const{config:e,portal:t}=o.c,i=`dropbox${Math.floor(Date.now()/1e3)}`,n=document.documentElement.lang||"en-US",r=`https://www.dropbox.com/oauth2/authorize?redirect_uri=https://${t.portalHostname}/home/cloudDriveOauth-callback2.html&response_type=token&client_id=${e.dropboxClientId}&locale=${n}&state=${i}`;return new Promise((async(e,o)=>{try{const n=await s(r,t.portalHostname),l=await a(n,"state");i!==l&&o("invalidState");const d=await a(n,"access_token");this.token=d,e(d)}catch(e){o(e)}}))}search(e={}){const{token:t}=this;return new Promise((async i=>{const{searchText:o,dropdownFilter:a,next:s}=e,r=`Bearer ${t}`,l=o?` ${o}`:"",p=s?this.nextStart:0;let m=d[a];"excel"===a&&(m="xls");const u=`{"path":"","query":"${l} ${m}","mode": "filename","max_results":10,"start":${p}}`,h=await n("POST","https://api.dropboxapi.com/2/files/search",u,r,"application/json");this.nextStart=h.start,i({files:h.matches.filter((e=>{var t;return"file"===(null===(t=e.metadata)||void 0===t?void 0:t[".tag"])})).map((({metadata:{id:e,name:i,size:o}})=>({id:e,name:i,mimeType:c(i),downloadUrl:`https://content.dropboxapi.com/2/files/download?httpHeaders={"Authorization":"Bearer&#32;${t}","Dropbox-API-Arg":"{\\"path\\":\\"${e}\\"}"}`,size:o}))),next:!!h.more})}))}}function u(e){return e.indexOf("spreadsheetml.sheet")>-1||e.indexOf("ms-excel")>-1?"excel":e.indexOf("application/zip")>-1?"zip":e.indexOf("application/octet-stream")>-1||e.indexOf("application/json")>-1?"geojson":e.indexOf("google-apps.spreadsheet")>-1?"googlesheets":e.indexOf("text/csv")>-1?"csv":"zip"}const h={csv:'(mimeType="text/csv")',excel:'(mimeType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"ormimeType="application/vnd.ms-excel")',zip:'(mimeType="application/x-zip-compressed"ormimeType="application/zip")',geojson:'(name contains "json" or name contains "geojson")and(mimeType="application/octet-stream"ormimeType="application/json")',googlesheets:'(mimeType="application/vnd.google-apps.spreadsheet")'};function v(e,t,i){const o=`https://www.googleapis.com/drive/v3/files/${e}`,n=`&httpHeaders={"Authorization":"Bearer&#32;${i}"}`,a=`${o}/export?mimeType=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet${n}`,s=`${o}?alt=media${n}`;return t.indexOf("google-apps")>-1||t.indexOf("googlesheets")>-1?a:s}class g{async connect(){return new Promise((async(e,t)=>{const{config:i,portal:n}=o.c,r=n.portalHostname,l=document.documentElement.lang||"en-US",d=`google${Math.floor(Date.now()/1e3)}`,c=`https://accounts.google.com/o/oauth2/v2/auth?scope=https://www.googleapis.com/auth/drive.readonly&redirect_uri=https://${r}/home/cloudDriveOauth-callback2.html&response_type=token&client_id=${i.googleClientId}&hl=${l}&state=${d}`;try{const i=await s(c,r);d!==await a(i,"state")&&t("invalidState"),this.token=await a(i,"access_token"),e(this.token)}catch(e){t(e)}}))}async search(e={}){return new Promise((async t=>{const{searchText:i,next:o,dropdownFilter:a}=e,s=`https://www.googleapis.com/drive/v3/files?access_token=${this.token}&pageSize=10&fields=incompleteSearch,nextPageToken,files(id,kind,mimeType,name)&q=${i?`name contains '${i}' and trashed = false and`:"trashed = false and"}${h[a]}${o?`&pageToken=${this.nextToken}`:""}`,r=await n("GET",s,null,null,"application/json");this.nextToken=r.nextPageToken,t({files:r.files.map((({id:e,name:t,mimeType:i})=>({id:e,name:t,mimeType:u(i),downloadUrl:v(e,i,this.token)}))),next:!!r.nextPageToken})}))}}function f(e,t){return`https://graph.microsoft.com/v1.0/me/drive/items/${e}/content?httpHeaders={"Authorization":"Bearer&#32;${t}"}`}class w{async connect(){return new Promise((async(e,t)=>{const{config:i,portal:n}=o.c,r=n.portalHostname,l=document.documentElement.lang||"en-US",d=`onedrive${Math.floor(Date.now()/1e3)}`,c=`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?scope=files.read&redirect_uri=https://${r}/home/cloudDriveOauth-callback2.html&response_type=token&client_id=${i.oneDriveClientId}&locale=${l}&state=${d}`;try{const i=await s(c,r);d!==await a(i,"state")&&t("invalidState"),this.token=await a(i,"access_token"),e(this.token)}catch(e){t(e)}}))}search(e={}){return new Promise((async t=>{const{searchText:i,dropdownFilter:o,next:a}=e,s=`Bearer ${this.token}`,r=`https://graph.microsoft.com/v1.0/me/drive/root/search(q='${i||""} ${d[o]||""}')?select=name,id,file,size&top=10`,l=a?this.nextLink:r,p=await n("GET",l,null,s,"application/json");this.nextLink=p["@odata.nextLink"],t({files:p.value.map((({size:e,id:t,name:i})=>({size:e,id:t,name:i,mimeType:c(i),downloadUrl:`https://graph.microsoft.com/v1.0/me/drive/items/${t}/content?httpHeaders={"Authorization":"Bearer ${this.token}"}`}))),next:!!p["@odata.nextLink"]})}))}}function x(e){return new{dropbox:m,"google drive":g,onedrive:w}[e]}function y(e){return{dropbox:"dropBoxConnect","google drive":"googleConnect",onedrive:"oneDriveConnect"}[e]}function T(e){return new{dropBoxConnect:m,googleConnect:g,oneDriveConnect:w}[e]}function b(e){return{dropBoxConnect:"dropbox",googleConnect:"google drive",oneDriveConnect:"onedrive"}[e]}}}]);
/*! For license information please see 76edc5c104e682ab0c3aa33d0acc0f7b.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[52420],{66103:(e,i,t)=>{t.d(i,{a:()=>n});var a=t(41171),l=t(6907),s=t(83129);async function n(e){var i;const t=(0,l.g)(e),n=`${null===(i=e.existingItem)||void 0===i?void 0:i.url}/${e.sourceDataLayer.id}/append`;try{const i=await(0,a.r)(n,t,{},"post"),{status:l,recordCount:r}=await(0,s.w)(e.id,{},null==i?void 0:i.statusUrl);return{result:{status:l,recordCount:r}}}catch({error:e}){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}}},88009:(e,i,t)=>{t.d(i,{A:()=>r,N:()=>l,a:()=>n,b:()=>s,c:()=>o,d:()=>d,u:()=>a});const a=["esriFieldTypeOID","esriFieldTypeGlobalID"],l="<None>",s={"file geodatabase":"filegeodatabase",shapefile:"shapefile",geojson:"geojson",csv:"CSV","microsoft excel":"excel",geopackage:"geoPackage"},n={Shapefile:"shapefile","File Geodatabase":"fileGeodatabase",CSV:"csv","Microsoft Excel":"excel",GeoJson:"geojson",GeoPackage:"geoPackage"},r={csv:"CSV",excel:"Microsoft Excel",shapefile:"Shapefile",fgdb:"File Geodatabase",geojson:"GeoJson",googlesheets:"Microsoft Excel"},d=["zip","csv","xls","xlsx","geojson","gpkg","json"],o=["zip","csv","xls","xlsx"]},6907:(e,i,t)=>{t.d(i,{c:()=>d,g:()=>o});var a=t(58892),l=t(88009),s=t(61099),n=t(31546),r=function(e,i){var t={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&i.indexOf(a)<0&&(t[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)i.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(t[a[l]]=e[a[l]])}return t};function d(e,i){var t;const a=(null==e?void 0:e.type)||null,l=(null==i?void 0:i.type)||null;return l&&(l===a||(null===(t={esriFieldTypeSmallInteger:["esriFieldTypeSmallInteger"],esriFieldTypeInteger:["esriFieldTypeInteger","esriFieldTypeSmallInteger"],esriFieldTypeSingle:["esriFieldTypeSingle","esriFieldTypeDouble"],esriFieldTypeDouble:["esriFieldTypeDouble","esriFieldTypeSingle","esriFieldTypeInteger","esriFieldTypeSmallInteger"],esriFieldTypeDate:["esriFieldTypeDate"],esriFieldTypeString:["esriFieldTypeString","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeDate","esriFieldTypeGUID"],esriFieldTypeGUID:["esriFieldTypeGUID","esriFieldTypeString"],esriFieldTypeOID:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger"],esriFieldTypeGlobalID:["esriFieldTypeGlobalID","esriFieldTypeGUID","esriFieldTypeString"],esriFieldTypeDateOnly:["esriFieldTypeDateOnly"],esriFieldTypeTimeOnly:["esriFieldTypeTimeOnly"],esriFieldTypeTimestampOffset:["esriFieldTypeTimestampOffset"],esriFieldTypeBigInteger:["esriFieldTypeBigInteger"]}[a])||void 0===t?void 0:t.indexOf(l))>-1)}function o(e){var i;const{timezone:t,analyzeResults:d,type:o,fieldMappings:p,dataLayer:c,id:h,uidPair:u,addAppendSelectOption:m,sourceDataLayer:g}=e;let y,f;const{publishParameters:F}=d,b=r(d,["publishParameters"]),v="upsert"===m||"update"===m,T=function(e){return e.filter((e=>e.source!==l.N)).map((({source:e,name:i})=>({source:e,name:i})))}(p),w=function(e){return e.map((e=>e.name))}(T),x={dateFieldsTimeReference:{timeZone:t||"UTC",respectsDaylightSaving:!0}},I={sourceTableName:c.name,fieldMappings:(null==T?void 0:T.length)?JSON.stringify(T):null,upsert:v,skipInserts:"update"===m,skipUpdates:!1,useGlobalIds:v&&"esriFieldTypeGlobalID"===(null==u?void 0:u.type),updateGeometry:!v||"attributeAndGeometry"===a.a.addAppendSelectUpdateTypeOption,appendFields:w.length?JSON.stringify(w):null,appendItemId:h,appendUploadFormat:n.a[a.a.type].appendUploadFormat,rollbackOnFailure:!0},O=r(F,["layers"]);if("CSV"===o)F.layerInfo.dateFieldsTimeReference=x.dateFieldsTimeReference,f=Object.assign(Object.assign(Object.assign({},x),F),b);else if("Microsoft Excel"===o){const e=function(e,i){const t=Object.assign({},e);return t.locationType=i.locationType,"address"===t.locationType?(t.addressFields=i.addressFields,t.sourceCountry=i.sourceCountry):"coordinates"===t.locationType&&(t.coordinateFieldType=i.coordinateFieldType,"LatitudeAndLongitude"===t.coordinateFieldType?(t.latitudeFieldName=i.latitudeFieldName,t.longitudeFieldName=i.longitudeFieldName):t.coordinateFieldName=i.coordinateFieldName),t}((0,s.a)({},!0),O);e.dateFieldsTimeReference=x.dateFieldsTimeReference,O.name=c.name,f=Object.assign(Object.assign(Object.assign(Object.assign({},x),{layers:[e]}),O),b)}else f=Object.assign(Object.assign(Object.assign({},x),F),b);return y=Object.assign(Object.assign({},I),{appendSourceInfo:JSON.stringify(f)}),"add"===m?y.upsertMatchingField=g.objectIdField||(null===(i=g.uniqueField)||void 0===i?void 0:i.name):v&&(null==u?void 0:u.isUniqueIndex)&&(y.upsertMatchingField=null==u?void 0:u.name),y}},52420:(e,i,t)=>{t.r(i),t.d(i,{arcgis_new_item_pages_append_match_fields:()=>p});var a=t(28384),l=t(58892),s=t(88009),n=t(54871),r=t(6907),d=t(86739),o=t(66103);t(27010),t(61099),t(62381),t(59004),t(76134),t(41171),t(66716),t(31546),t(65508),t(83129),t(24552),t(85142),t(72022),t(96729),t(58728),t(83397),t(18869),t(46220),t(82463),t(48507),t(48333),t(86274);const p=class{constructor(e){(0,a.r)(this,e),this.newItemUpdatePage=(0,a.c)(this,"newItemUpdatePage",7),this.newItemPrevPage=(0,a.c)(this,"newItemPrevPage",7),this.workflowComplete=(0,a.c)(this,"workflowComplete",7),this.newItemToggleNavigationEnabled=(0,a.c)(this,"newItemToggleNavigationEnabled",7),this.newItemDisableCloseButtons=(0,a.c)(this,"newItemDisableCloseButtons",7),this.validatedFields=[],this.fields=void 0,this.i18n=void 0,this.fieldMatches=[],this.error=void 0,this.loading=!1,this.loaderType="indeterminate",this.loaderMessage=void 0}handleNext(){const e=this.validateMatchings();e?this.error=e:(l.a.fieldMappings=this.fieldMatches,"add"!==l.a.addAppendSelectOption?this.newItemUpdatePage.emit("appendSelectUpdate"):this.handleAppend())}validateMatchings(){return this.fieldMatches.every((e=>e.source===s.N))?{title:this.errorLabel,description:this.i18n.errors.noMatchedFields}:this.fieldMatches.filter((e=>!e.disabled&&!e.nullable&&e.source===s.N)).length<=0?null:{title:this.i18n.errors.nonNullableErrorTitle,description:this.i18n.errors.nonNullableErrorDescription}}disableModalButtons(e){this.newItemToggleNavigationEnabled.emit(!e),this.newItemDisableCloseButtons.emit(e)}async handleAppend(){var e,i;const{sourceDataLayer:t,existingItem:a,timezone:s,analyzeResults:r,type:p,fieldMappings:c,dataLayer:h,id:u,uidPair:m,addAppendSelectOption:g}=l.a;this.disableModalButtons(!0),this.loading=!0,this.loaderMessage=n.u.i18n.append.appendLoadingMessages.appendCloseNotice;const y=await(0,o.a)({sourceDataLayer:t,existingItem:a,timezone:s,analyzeResults:r,type:p,fieldMappings:c,dataLayer:h,id:u,uidPair:m,addAppendSelectOption:g});if("completed"!==(null===(i=null===(e=null==y?void 0:y.result)||void 0===e?void 0:e.status)||void 0===i?void 0:i.toLowerCase()))this.disableModalButtons(!1),this.loading=!1,this.error={title:n.u.i18n.error,description:n.u.i18n.append.appendErrorMessages.appendError};else{await(0,d.d)(l.a.id,{permanentDelete:!0});const e=Object.assign({appendType:l.a.addAppendSelectOption},y);this.workflowComplete.emit(e)}}async handlePrev(e){var i;this.loading||"add"!==l.a.addAppendSelectOption||(null===(i=l.a.analyzeResults.publishParameters.layers)||void 0===i?void 0:i.length)>1||(e.preventDefault(),this.newItemPrevPage.emit())}handleFieldChange(e){const i=Object.assign({},e.detail);this.validateFieldMappings(this.validatedFields,i)}sortFields(){this.fieldMatches=this.fieldMatches.sort((function(e,i){const t=e.name.toLowerCase(),a=i.name.toLowerCase();return t<a?-1:t>a?1:0}))}validateFieldMappings(e,i){if(i.initialMatch=i.source,i.source!==this.noneString){const t=e.filter((e=>e.source===i.source));if((null==t?void 0:t.length)>0){const i=t[0].idx;e[i].initialMatch=this.noneString,e[i].source=this.noneString}}e[i.idx]=i,this.validatedFields=e,this.fieldMatches=[...this.validatedFields],this.sortFields()}setNextText(){n.u.nextText="add"===l.a.addAppendSelectOption?"addAndComplete":"next"}componentWillLoad(){const{addAppendSelectOption:e,uidPair:i,sourceDataLayer:t,backupLayerFields:a}=l.a;this.i18n=n.u.i18n.appendMatchFields,this.errorLabel=n.u.i18n.error,this.noneString=n.u.i18n.appendKeyValuePair.noneField;const s=a,r="csv"===t.type?[t.layerInfo]:t.fields;this.setNextText(),this.selectedKeyPair=i;const d="upsert"===e||"update"===e,o="add"===e?null:l.a.serviceUIDFields.map((e=>e.name));let p="add"===e?0:1;r.forEach((e=>{"esriFieldTypeOID"===(null==e?void 0:e.type)||"esriFieldTypeGlobalID"===(null==e?void 0:e.type)||!e.editable||d&&o.includes(e.name)||(this.fieldMatches.push(this.createFieldMapping(e,s,p)),this.validatedFields.push(this.createFieldMapping(e,s,p)),p++)})),"add"!==e&&(this.fieldMatches.unshift(this.selectedKeyPair),this.validatedFields.unshift(this.selectedKeyPair)),this.sortFields()}createFieldMapping(e,i,t){const a=l.a.dataLayer.addressFields?Object.values(l.a.dataLayer.addressFields):null;let s=this.noneString;const n=[{source:this.noneString,name:e.name,type:"None",idx:t}];return i.forEach((i=>{!(0,r.c)(e,i)||"add"!==l.a.addAppendSelectOption&&i.name===this.selectedKeyPair.source||(n.push({source:i.name,name:e.name,type:e.type,idx:t}),e.name.toLowerCase()!==i.name.toLowerCase()||e.type!==i.type&&!(null==a?void 0:a.find((e=>e===i.displayName||e===i.name)))||"add"!==l.a.addAppendSelectOption&&i.name===this.selectedKeyPair.source||(s=i.name))})),{source:s,name:e.name,nullable:e.nullable,type:e.type,idx:t,initialMatch:s,possibleMatches:n}}render(){const{i18n:e,error:i}=this,{originalFileName:t,existingItem:s}=l.a,n={originalField:{header:e.originalField.header,moreInfo:e.originalField.moreInfo.replace("${featureLayerName}",s.title)},uploadedField:{header:e.uploadedField.header,moreInfo:e.uploadedField.moreInfo.replace("${uploadedFileName}",t)}},r=e.description.replace("${uploadedFileName}",t).replace("${featureLayerName}",s.title);return(0,a.h)(a.H,{class:{"overflow-hidden":this.loading}},(0,a.h)("arcgis-new-item-loader",{type:this.loaderType,active:this.loading,text:this.loaderMessage}),(0,a.h)("div",{class:"header"}," ",e.header," "),(0,a.h)("div",{class:"description"},r),(0,a.h)("div",{class:"row",role:"row"},Object.keys(n).map((e=>{const{header:i,moreInfo:t}=n[e];return(0,a.h)("span",{class:"header-cell",role:"columnheader","aria-sort":"none"},i,(0,a.h)("arcgis-information",{class:"header-popover",label:t,placement:"top-start",paddedContent:!0},(0,a.h)("p",{class:"popover-content"},t)))}))),this.fieldMatches.length>0?(0,a.h)("div",{class:"fields-scroll-container"},this.fieldMatches.map((e=>(0,a.h)("arcgis-new-item-append-match-field",{key:e.source,onFieldChange:this.handleFieldChange.bind(this),field:e})))):(0,a.h)("calcite-input-message",{class:"no-fields",icon:!0,status:"valid"},this.i18n.errors.noFields),(0,a.h)("arcgis-new-item-alert",{heading:null==i?void 0:i.title,description:null==i?void 0:i.description,link:{href:null==i?void 0:i.link,title:null==i?void 0:i.linkText},active:!!i,onAlertDismiss:()=>this.error=null}))}get el(){return(0,a.d)(this)}};p.style=".fields-container{display:flex;flex-direction:column;height:100%;overflow-y:auto;overflow-x:hidden}.field-table{margin-bottom:1.5rem;overflow:auto;display:flex;flex-direction:column}.search-container{display:flex;width:100%}.field-search{width:50%;margin-right:0.5rem}.field-select{width:50%}.field-name-column{width:50%;margin-right:0.5rem}.match-field-name-column{width:50%}.fields-scroll-container{display:flex;flex-direction:column;margin-bottom:0.75rem;padding-bottom:0.75rem;border-bottom:0.125rem solid var(--calcite-ui-foreground-3)}.header-row{display:flex;align-content:flex-start;justify-content:center;font-weight:500;font-size:0.875rem;color:var(--calcite-ui-text-1);grid-gap:0.25rem;gap:0.25rem;padding:0.25rem}.header-cell{display:flex;width:100%;font-size:1rem}.hide{display:none}.not-visible{visibility:hidden;height:0}.cell{box-sizing:border-box;width:33.333333%;width:100%}.cell label{margin-top:0.75rem}.row{display:flex;justify-content:space-between;align-items:center;grid-gap:0.25rem;gap:0.25rem;padding:0.25rem;margin-bottom:0.75rem;font-weight:500;font-size:1rem;color:var(--calcite-ui-text-1);border-bottom:0.125rem solid var(--calcite-ui-foreground-3)}.deselected{opacity:var(--calcite-ui-opacity-disabled)}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.label{--calcite-label-margin-bottom:0}.append-timezone{border-top:0.063rem solid var(--calcite-ui-foreground-3)}.from-to-fields{display:flex;flex-direction:row}.description{font-size:0.875rem;font-weight:300;margin-bottom:1rem}.header{font-weight:500;font-size:1rem;color:var(--calcite-ui-text-1);margin-bottom:0.5rem}.no-fields{margin-bottom:1.5rem}.popover-icon{color:var(--calcite-ui-text-3);cursor:pointer;margin-top:0.125rem;-webkit-margin-start:0.75rem;margin-inline-start:0.75rem}.popover-content{font-size:0.75rem;font-weight:400;margin:0}.header-popover{margin-top:-0.313rem}"}}]);
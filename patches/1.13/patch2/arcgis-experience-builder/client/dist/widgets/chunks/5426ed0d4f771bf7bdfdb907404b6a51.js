/*! For license information please see 5426ed0d4f771bf7bdfdb907404b6a51.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[72022],{58728:(t,n,e)=>{e.d(n,{a:()=>u,b:()=>v,c:()=>c,d:()=>d,e:()=>y,f:()=>h,g:()=>a,h:()=>m,i:()=>w,j:()=>o,k:()=>p,q:()=>f,u:()=>$});var r=e(41171),s=e(76134);const i='owner:"esri" AND title:"AppSwitcher Config" AND type: "Application Configuration"';async function o(t){const n=(0,r.g)(t);if(!n)return;const e=`${n}portals/self/settings`;return(0,r.f)((()=>b(e)),"portalSettings",n)}async function a(){var t;const n=await o();return(null===(t=null==n?void 0:n.portalConfigProperties)||void 0===t?void 0:t.showInAppLauncher)||[]}async function l(t){const n=(0,r.g)();if(n&&t)return b(`${n}content/items/${t}/data`)}async function u(){var t;const{portal:n,user:e}=s.c;if(!(null==n?void 0:n.id)||!e)return;const o=await async function(){const t=(0,r.g)();if(t)return b(`${t}search`,{num:1,start:0,sortField:"title",sortOrder:"asc",q:i})}(),a=null===(t=null==o?void 0:o.results)||void 0===t?void 0:t[0];if(!a)return;const u=a.id;return await l(u)}async function c(){const{user:t}=s.c;return b(`${(0,r.g)()}community/users/${t.username}/properties`)}async function d(){const{portal:t}=s.c;return b(`${(0,r.g)()}portals/${t.id}/approvedApps`,{returnAllApps:!1})}async function p(t,n,e="results"){let r,s,i,o,a=1,l=[];n.start=a,n.num||(n.num=100);try{const u=await b(t,n);if(!(null==u?void 0:u[e]))return l;for(l=[...l,...u[e]],a=u.nextStart,r=u.total-l.length,s=Math.ceil(r/100),i=[],o=0;o<s;o++)n.start=a+100*o,i.push(b(t,n));try{return(await Promise.all(i)).forEach((t=>{l=[...l,...t[e]]})),l}catch(t){return l}}catch(t){return l}}async function v(){const{user:t}=s.c;return p(`${(0,r.g)()}community/users/${t.username}/provisionedListings`,{returnAppClientIds:!0,returnAllProvisions:!0},"provisionedListings")}async function y(){const t=`${(0,r.g)()}portals/self/subscriptionInfo`;try{const n=await b(t);return(null==n?void 0:n.orgCapabilities)||[]}catch(t){return[]}}async function f(t,n){if(n&&(null==t?void 0:t.length))return b(`${(0,r.g)()}search`,{num:100,q:`id:(${t.map((t=>`"${t.itemId}"`)).join(" OR ")})`})}const g='owner:"esri" AND title:"BlockedApps Config" AND type: "Application Configuration"';async function m(){var t,n;const e=`${(0,r.g)()}search`;try{const r=await b(e,{num:10,start:0,sortField:"title",sortOrder:"asc",q:g});if(!r)return[];const s=(null===(n=null===(t=r.results)||void 0===t?void 0:t[0])||void 0===n?void 0:n.id)||"",i=await l(s);return(null==i?void 0:i.blockedApps)||[]}catch(t){return[]}}async function w(){const t=`${(0,r.g)()}portals/self/servers`,n=await b(t);return(null==n?void 0:n.servers)||[]}async function h(){const t=`${(0,r.g)()}portals/self/signinSettings`;return await b(t)}async function b(t,n){n||(n={}),n.f="json";const e=(0,r.h)();e&&(n.token=e);const s=new URL(t);Object.keys(n).forEach((t=>s.searchParams.append(t,n[t])));const i=await fetch(s);return await i.json()}async function $(t){const{user:n}=s.c,e=function(t){let n=(0,r.g)();return"/"!==n.slice(-1)&&(n+="/"),`${n}${t}`}(`community/users/${n.username}/setProperties`),i=new FormData;return i.append("properties",JSON.stringify(t)),async function(t,n){n.append("f","json");const e=(0,r.h)();e&&n.append("token",e),fetch(t,{method:"POST",body:n})}(e,i)}},83397:(t,n,e)=>{e.d(n,{a:()=>l,b:()=>u,c:()=>v,d:()=>p,e:()=>y,g:()=>c,i:()=>a,r:()=>o});var r=e(41171),s=e(76134),i=e(62381);const o=async(t,n,e={})=>{const{body:i,usePost:o,addTokenManually:a,api:l=(null===s.c||void 0===s.c?void 0:s.c.api)}=e,u=new URLSearchParams;i&&Object.entries(i).forEach((([t,n])=>{void 0!==n&&u.append(t,n)}));const c=new URL(t);c.searchParams.append("f","json");const d=!1===a?null:await(0,r.d)(n,l);d&&c.searchParams.append("token",d);const p=await fetch(c.toString(),{body:o?u:void 0,method:o?"POST":"GET"}),v=await p.json(),y=v.error;if(y)throw"string"==typeof y?new Error(y):y;return v},a=(t,n)=>"Feature Service"===n&&t.includes("Hosted Service"),l=async(t,n)=>{try{return{result:await o(d(t,n),n)}}catch(t){return console.error(t),{error:{code:"unhandledError"}}}},u=(t,n)=>`${d(t,n)}/data`,c=async(t,n)=>o(u(t,n),n),d=(t,n)=>`${(0,r.g)(n)}content/items/${t}`,p=async(t,n,e)=>{try{const r=d(t,n);return await o(r,n,e)}catch(t){console.warn(t)}},v=async(t,n)=>{try{const e=`${d(t,n)}/groups`;return{result:await o(e,n)}}catch(t){return console.error(t),{error:{code:"unhandledError"}}}},y=async(t,n)=>{let e=!1;return a(t.typeKeywords,t.type)&&(e=await f(t.url,n)),e},f=async(t,n,e=!1)=>{var r,s,a;if(t)try{const a=await o(`${null===(r=(0,i.p)(t))||void 0===r?void 0:r.baseServerUrl}/layers`,n,{addTokenManually:!e});return null===(s=null==a?void 0:a.layers)||void 0===s?void 0:s.reduce(((t,n)=>t||(null==n?void 0:n.capabilities.includes("Editing"))),!1)}catch(e){if(null===(a=null==e?void 0:e.message)||void 0===a?void 0:a.toLowerCase().includes("token required"))return f(t,n,!0)}return!1}},72022:(t,n,e)=>{e.d(n,{H:()=>v,a:()=>f,b:()=>w,c:()=>c,d:()=>d,f:()=>b,g:()=>p,i:()=>m,q:()=>y});var r=e(41171),s=e(96729),i=e(26426),o=e(58728),a=e(86739),l=e(83397),u=e(18869);function c(t=""){return(0,u.s)(t).replace(/[<>\/\\[\]\?]/g,"\\$&").trim()}const d=["nonspatial","point","polygon","multipoint","polyline"];function p(t,n,e){var r;const s={};null===(r=t.results)||void 0===r||r.forEach((t=>{t.tags.forEach((t=>{t&&(s[t]=(s[t]||0)+1)}))}));const o=Object.entries(s).sort(((t,n)=>n[1]-t[1])).map((([t])=>t));return(0,i.b)([...n||[],...o||[],...e||[]])}const v='-type:"Code Attachment" -type:"Featured Items" -type:"Symbol Set" -type:"Color Set" -type:"Windows Viewer Add In" -type:"Windows Viewer Configuration" -type:"Map Area" -typekeywords:"MapAreaPackage" -type:"Indoors Map Configuration" -typekeywords:"SMX"';async function y({portal:t,query:n,user:e,store:i,config:o,allowedSubscriptionContentTypes:a,groupId:u}){var p,y,f;let b=(0,r.g)(t),$={};const{num:S,start:A,sortOrder:O,sortField:k,filters:j,baseQuery:C,baseFilter:P,searchTerm:I,bucket:L,allowedGeometries:E}=n,F=u||"living atlas"===L&&(null!==(p=null==i?void 0:i.state.livingAtlasGroupId)&&void 0!==p?p:await async function(t,n){var e,s;const i=(null===(s=null===(e=(await(0,r.q)({q:t.livingAtlasGroupQuery,num:1,sortField:"title",sortOrder:"asc"},t)).results)||void 0===e?void 0:e[0])||void 0===s?void 0:s.id)||"";return n&&(n.state.livingAtlasGroupId=i),i}(t,i))||"living atlas analysis"===L&&(null!==(y=null==i?void 0:i.state.livingAtlasAnalysisGroupId)&&void 0!==y?y:await async function(t,n){var e,s;const i=(null===(s=null===(e=(await(0,r.q)({q:g(t),num:1,sortField:"title",sortOrder:"asc"},t)).results)||void 0===e?void 0:e[0])||void 0===s?void 0:s.id)||"";return n&&(n.state.livingAtlasAnalysisGroupId=i),i}(t,i));if("subscription content"===L)return async function(t,n,e){return(0,r.f)((async()=>{const r=await w(n,t);if(!(null==r?void 0:r.length))return{total:0,results:[],start:-1,num:100,nextStart:0};const s=null==r?void 0:r.map((t=>t.itemId)),i=await Promise.all(s.map((n=>(0,l.d)(n,t)))),o=(await Promise.all(null==s?void 0:s.map(h))).reduce(((t,n)=>t.concat(n)),i).filter((t=>function(t,n){return null!=n||(n=["Map Service","Image Service","Feature Service","Stream Service","Vector Tile Service","WMS","WFS","WMTS","KML","Feature Collection","Feed"]),n.includes(t.type)}(t,e)));return{total:o.length,results:o,start:o.length?1:0,num:100,nextStart:0}}),"subscriptionContent",`${t.id}-${n.username}`)}(t,e,a);await m(t,L)&&(b="https://www.arcgis.com/sharing/rest/",$.addTokenManually=!1);const q=`${b}${F?`content/groups/${F}/`:""}search`,M=function(t,n){return!t||t.length===(null==d?void 0:d.length)||(null==n?void 0:n.isPortal)?"":`((-typekeywords:"Hosted Service") OR (typekeywords:"Hosted Service" AND geometrytype:(${t.map((t=>`"${t}"`)).join(" OR ")})))`}(E,t),T=Object.keys(j||{}),G=L?await async function({bucket:t,user:n,portal:e,filters:r}){switch(t){case"my":return`owner: ${n.username}`;case"org":return`orgid:${e.id}`;case"favorites":return`group: ${await(0,s.b)()}`;case"group":if(!(null==r?void 0:r.group)||"all"===(null==r?void 0:r.group.group)){const t=await(0,s.a)();return`group:(${null==t?void 0:t.map((({id:t})=>t)).join(" OR ")})`}default:return""}}({bucket:L,user:e,portal:t,store:i,filters:j}):"",U=I?`(${c(I)}) `:"",N=!(!(null==o?void 0:o.semanticSearchEnabled)||!(null===(f=null==t?void 0:t.portalProperties)||void 0===f?void 0:f.semanticSearchEnabled))||e&&!e.orgId,D=Object.assign(Object.assign(Object.assign({},P?{filter:`${P}`}:{}),N?{enriched:!0}:{}),{q:`${C||""} ${M} ${G} ${U} ${v}`,displaySublayers:!0,displayHighlights:!0}),R=[],x=T.reduce(((t,n)=>{const{param:e,value:r,additionalParams:s}=j[n];if(L&&"group"===n&&"group"!==L||"folder"===n&&"my"!==L||"region"===n)return t;"categories"===n&&r&&R.push(j[n].category),"region"===n&&r&&R.push(j[n].categoryValue);const i="categories"===e?{}:{[e]:`${t[e]||""} ${r}`};return Object.assign(Object.assign(Object.assign({},t),i),null!=s?s:{})}),D),H=Object.assign({num:S,start:A,sortField:k,sortOrder:O},x||{}),W=R.length?R.map((t=>`categories=${JSON.stringify([t])}`)).join("&"):"",V=R.length?"?":"",_=await(0,r.r)(`${q}${V}${W}`,H,$);return Object.assign(Object.assign({},_),{queryParams:H})}function f(t,n){if(!n.deepLayerSearchEnabled)return{};const e={};return(t.highlights||[]).forEach((n=>{var r;const s=null===(r=t.results)||void 0===r?void 0:r.find((t=>t.id===n.id));if(!(null==s?void 0:s.sublayers))return;const i=Object.keys(n).filter((t=>"id"!==t&&t.includes("sublayers."))).reduce(((t,e)=>(t[e.replace("sublayers.","")]=n[e].map((t=>t.replaceAll("<em>","").replaceAll("</em>",""))),t)),{}),o=s.sublayers.filter((t=>Object.keys(t).some((n=>{var e;return null===(e=i[n])||void 0===e?void 0:e.some((e=>t[n].includes(e)))})))).map((t=>t.id));e[n.id]=Object.assign(Object.assign({},n),{sublayers:o})})),e}function g(t){return'title:"Living Atlas Analysis Layers" AND owner:'+(!0===t.isPortal?"esri_livingatlas":"esri")}async function m(t,n){var e;if((null==t?void 0:t.isPortal)&&"all"===n){const n=await(0,o.j)(t);if(null===(e=null==n?void 0:n.portalConfigProperties)||void 0===e?void 0:e.searchArcGISOnlineEnabled)return!0}return!1}async function w(t,n){return t&&n?(0,r.f)((async()=>{const e=`${(0,r.g)(n)}community/users/${t.username}/provisionedListings`;return(0,o.k)(e,{},"provisionedListings")}),"provisionedListings",`${n.id}-${t.username}`):[]}async function h(t){var n;return null!==(n=(await(0,a.b)(t,"Listed2ImplicitlyListed","forward")).relatedItems)&&void 0!==n?n:[]}async function b(t,n,e,s){var i;const o=await m(n,s.state.bucket),l=o?`https://www.arcgis.com/sharing/rest/content/items/${t.id}`:(0,a.g)(t.id,n),u=o||!e?{disableIdentityLookup:!0,addTokenManually:!1}:{};try{return{result:await(0,r.r)(l,{},u)}}catch(t){if("SB_0005"===(null===(i=null==t?void 0:t.details)||void 0===i?void 0:i.messageCode))return{error:{code:"disabledSubscription"}}}return{error:{code:"unhandledError"}}}},96729:(t,n,e)=>{e.d(n,{a:()=>a,b:()=>l,c:()=>p,d:()=>c,e:()=>d,f:()=>i,g:()=>u});var r=e(41171),s=e(76134);async function i(t,n){return(0,r.r)(`${(0,r.g)(n)}/community/users/${t}`)}async function o(){return(0,r.r)(`${(0,r.g)()}/community/self`)}async function a(){var t;const n=null===s.c||void 0===s.c?void 0:s.c.user;if(!n)return[];const e=await(0,r.f)((()=>o()),"communitySelf",n.username);return null!==(t=null==e?void 0:e.groups)&&void 0!==t?t:[]}async function l(){const t=null===s.c||void 0===s.c?void 0:s.c.user;return t?(await(0,r.f)((()=>o()),"communitySelf",t.username)).favGroupId:null}async function u(t){var n;const e=null!==(n=null!=t?t:s.c.user)&&void 0!==n?n:s.c.portal.user,{folders:i}=await async function(t){var n,e;const i=null!==(n=null!=t?t:s.c.user)&&void 0!==n?n:s.c.portal.user,o=s.c.portal;null!==(e=i.userContentUrl)&&void 0!==e||(i.userContentUrl=(null==o?void 0:o.restUrl)+"/content/users/"+t.username);const a=await(0,r.r)(i.userContentUrl,{num:1});return Promise.resolve(a)}(e),{username:o}=e;return[{username:o,id:o,title:o,created:"now"},...i]}async function c(t,n){var e;const r=null!==(e=null!=n?n:s.c.user)&&void 0!==e?e:s.c.portal.user;return(await u(r)).find((n=>n.id===t))}function d(t){return{username:t,id:t,title:t,created:"now"}}async function p(t,n){var e;const i=`${(null!==(e=null!=n?n:s.c.user)&&void 0!==e?e:s.c.portal.user).userContentUrl}/createFolder`;return await(0,r.r)(i,{title:t},{},"post")}}}]);
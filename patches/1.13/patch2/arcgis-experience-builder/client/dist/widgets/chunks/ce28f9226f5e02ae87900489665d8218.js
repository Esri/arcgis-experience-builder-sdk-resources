/*! For license information please see ce28f9226f5e02ae87900489665d8218.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([[45518],{45518:(e,t,i)=>{i.r(t),i.d(t,{arcgis_symbol_picker:()=>ie});var s=i(28384),o=i(91579),r=i(74828),l=i(15859),a=i(62727),n=i(81068);function c(e){return{authMode:"public"===e.access?"anonymous":"auto"}}i(66716),i(18869);const m=[{name:"Circle",type:"esriSMS",style:"esriSMSCircle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Square",type:"esriSMS",style:"esriSMSSquare",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Diamond",type:"esriSMS",style:"esriSMSDiamond",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}},{name:"Triangle",type:"esriSMS",style:"esriSMSTriangle",color:[0,0,128,128],size:18,outline:{color:[0,0,128,255],width:1}}],d=[{type:"esriSLS",color:[0,0,0,255],width:.75,style:"esriSLSSolid"}],u=[{type:"esriSFS",color:[0,0,0,64],outline:{type:"esriSLS",color:[0,0,0,255],width:.75,style:"esriSLSSolid"},style:"esriSFSSolid"}];function h(e){return[{title:e.symbolSources.circle,name:"Circle",primitive:"circle"},{title:e.symbolSources.square,name:"Square",primitive:"square"},{title:e.symbolSources.cross,name:"Cross",primitive:"cross"},{title:e.symbolSources.x,name:"X",primitive:"x"},{title:e.symbolSources.kite,name:"Kite",primitive:"kite"},{title:e.symbolSources.triangle,name:"Triangle",primitive:"triangle"}].map((e=>{var t;return{dimensionality:"flat",name:e.name,title:e.title,type:"PointSymbol3D",symbolLayers:[{type:"Icon",resource:{primitive:e.primitive},material:{color:null===(t=null===o.e||void 0===o.e?void 0:o.e.gfxUtils)||void 0===t?void 0:t.defaultThematicColor},outline:{color:[0,0,0]}}]}}))}function y(e){return[{title:e.symbolSources.sphere,name:"Sphere",primitive:"sphere"},{title:e.symbolSources.tallCylinder,name:"Tall_Cylinder",primitive:"cylinder",mixins:{width:5,height:10,depth:5}},{title:e.symbolSources.cylinder,name:"Cylinder",primitive:"cylinder"},{title:e.symbolSources.tallCube,name:"Tall_Cube",primitive:"cube",mixins:{width:5,height:10,depth:5,anchor:"bottom"}},{title:e.symbolSources.cube,name:"Cube",primitive:"cube"},{title:e.symbolSources.tallCone,name:"Tall_Cone",primitive:"cone",mixins:{width:5,height:10,depth:5}},{title:e.symbolSources.cone,name:"Cone",primitive:"cone"},{title:e.symbolSources.invertedCone,name:"Inverted_Cone",primitive:"invertedCone"},{title:e.symbolSources.diamond,name:"Diamond",primitive:"diamond"},{title:e.symbolSources.tetrahedron,name:"Tetrahedron",primitive:"tetrahedron"}].map((e=>({dimensionality:"volumetric",name:e.name,title:e.title,type:"PointSymbol3D",symbolLayers:[Object.assign({type:"Object",resource:{primitive:e.primitive}},e.mixins)]})))}async function p(e,t,i,s){try{await o.e.symbolUtils.renderPreviewHTML(t,Object.assign({node:e},i))}catch(t){e.appendChild(b(s))}return e}function b(e){const t=document.createElement("span");return t.setAttribute("alt",""),t.innerHTML=e,t}function S(e="2d"){return{async getSymbol(t){const{data:i,parentData:s,portalItem:r}=t,l=await async function(e,t,i,s){const r=function(e){for(const t of e.typeKeywords)if(/^Esri.*Style$/.test(t)&&"Esri Style"!==t)return t}(i);let l=null;r||(l=`${i.itemUrl}/data`);const a={data:e,baseUrl:i.itemUrl,styleName:r,styleUrl:l},{portal:n}=i;return o.e.webStyleSymbolUtils.fetchSymbolFromStyle(a,t,{portal:n},s,o.e.styleUtils.symbolUrlFromStyleItem,c(i))}(s,i.name,r,s.cimVersion&&"2d"===e?"cimRef":"webRef");return"point-3d"===l.type&&l.symbolLayers.forEach((e=>{if(e.get("material.color"))if("icon"===e.type){const t=null!=e.material?e.material:{};t.color=o.e.gfxUtils.defaultThematicColor.clone(),e.material=t}else if("object"===e.type){const t=null!=e.material?e.material:{};t.color=t.color||(0,o.d)([255,255,255]),e.material=t}})),l},getThumbnail:async e=>async function(e){var t,i;const s=e.data;let r=null===(t=s.thumbnail)||void 0===t?void 0:t.href;const l=null===(i=s.thumbnail)||void 0===i?void 0:i.imageData,a=s.title||e.strings.symbolSources.noTitle,n=document.createElement("div"),c=!!s.cimRef,m=function(e){var t,i;const s=null===(t=e.formats)||void 0===t?void 0:t.includes("web3d"),o=null===(i=e.formatInfos)||void 0===i?void 0:i.some((e=>"gltf"===e.type||"gltf_basisu"===e.type));return s||o}(s),d={size:m&&"volumetric"===s.dimensionality?42:24,disableUpsampling:!1};if(c&&!m){const t=await e.getSymbol();if(!(0,o.g)(t))return(0,o.j)(t)&&delete d.size,p(n,t,d,a)}return o.e.devEnvironmentUtils.isDevEnvironment()&&(r=o.e.devEnvironmentUtils.adjustStaticAGOUrl(r)),r||l?p(n,new o.e.WebStyleSymbol({name:s.name,styleUrl:`${e.portalItem.itemUrl}/data`,thumbnail:{url:l?`data:image/jpeg;base64, ${l}`:o.e.urlUtils.makeAbsolute(r,e.portalItem.itemUrl)}}),d,a):(n.appendChild(b(a)),n)}(e)}}const g={getSymbol:async e=>o.e.jsonUtils.fromJSON(e.data),async getThumbnail(e){const t=await e.getSymbol(),i={size:"line"===(0,o.h)(t)?{width:24}:24};return o.e.symbolUtils.renderPreviewHTML(t,i)}},v={getSymbol:async e=>o.e.jsonUtils.fromJSON(e.data),async getThumbnail(e){const t=await e.getSymbol();return o.e.symbolUtils.renderPreviewHTML(t,{size:38})}},f=Function.prototype;class I{constructor({data:e,parentData:t,portalItem:i,strategy:s,strings:o}){this.data=e,this.parentData=t,this.portalItem=i,this.strategy=s,this.strings=o}async getSymbol(){if(!this._symbol){const e=this._symbolRequest||(this._symbolRequest=this.strategy.getSymbol(this));this._symbol=await e}return this._symbol.clone()}async getThumbnail(e){if(this._thumbnail)return e.appendChild(this._thumbnail),f;const t=this._thumbnailRequest||(this._thumbnailRequest=this.strategy.getThumbnail(this));return this._thumbnail=await t,()=>e.appendChild(this._thumbnail)}}class _{constructor({portalItem:e,strings:t,symbolType:i}){this.symbolType="2d",this.portalItem=e,this.strings=t,i&&(this.symbolType=i)}get data(){return this._data}get id(){var e;return null===(e=this.portalItem)||void 0===e?void 0:e.id}get keywords(){var e;return(null===(e=this.portalItem)||void 0===e?void 0:e.typeKeywords)||[]}get name(){var e;return null===(e=this.portalItem)||void 0===e?void 0:e.name}get title(){var e;return null===(e=this.portalItem)||void 0===e?void 0:e.title}async fetchData(e){if(o.e.promiseUtils.isAborted(e))throw o.e.promiseUtils.createAbortError();return this._data||(this._data=await this.portalItem.fetchData("json",Object.assign(Object.assign({},e),c(this.portalItem)))),this._data}}class w extends _{constructor(){super(...arguments),this.type="symbol-set"}async getItems(e){if(o.e.promiseUtils.isAborted(e))throw o.e.promiseUtils.createAbortError();if(!this._items){const t=await this.fetchData(e);this._items=t.map((e=>new I({data:e,parentData:t,portalItem:this.portalItem,strategy:g,strings:this.strings})))}return this._items}}class C extends _{constructor(){super(...arguments),this.type="web-style"}async getItems(e){if(o.e.promiseUtils.isAborted(e))throw o.e.promiseUtils.createAbortError();if(!this._items){const t=await this.fetchData(e);this._items=t.items.map((e=>new I({data:e,parentData:t,portalItem:this.portalItem,strategy:S(this.symbolType),strings:this.strings})))}return this._items}}class k{constructor({strings:e}){this.keywords=[],this.name="Basic",this.type="symbol-set",this.title=e.symbolSources.basic}async getItems(e){if(o.e.promiseUtils.isAborted(e))throw o.e.promiseUtils.createAbortError();return this._items||(this._items=this.data.map((e=>new I({data:e,strategy:g,strings:this.strings})))),this._items}}const E="basic-symbol-set:point",T="basic-symbol-set:line",O="basic-symbol-set:polygon";class A extends k{constructor(){super(...arguments),this.data=m,this.id=E,this.keywords=["Point"]}}class N extends k{constructor(){super(...arguments),this.data=d,this.id=T,this.keywords=["Line"]}}class U extends k{constructor(){super(...arguments),this.data=u,this.id=O,this.keywords=["Polygon"]}}class D{constructor({strings:e}){this.keywords=["3d"],this.id="basic-web-style:flat",this.name="Basic",this.type="web-style",this.data={items:h(e)},this.title=e.symbolSources.basic}async getItems(e){if(o.e.promiseUtils.isAborted(e))throw o.e.promiseUtils.createAbortError();return this._items||(this._items=this.data.items.map((e=>new I({data:e,strategy:g,strings:this.strings})))),this._items}}class x{constructor({strings:e}){this.id="basic-web-style:volumetric",this.keywords=["3d","volumetric"],this.name="Basic",this.type="web-style",this.data={items:y(e)},this.title=e.symbolSources.basic}async getItems(e){if(o.e.promiseUtils.isAborted(e))throw o.e.promiseUtils.createAbortError();return this._items||(this._items=this.data.items.map((e=>new I({data:e,parentData:this.data,strategy:v,strings:this.strings})))),this._items}}const F=({item:e,index:t,observer:i})=>{const o=e.data.title?(0,s.h)("calcite-tooltip",{"reference-element":e.data.name},e.data.title):null;return(0,s.h)("span",{class:"marker-item calcite-mode-dark",ref:s=>{s&&(s.item||(s.item=e,s.index=t,i.observe(s)))},id:e.data.name,slot:"thumbnail"},o)};function L(e,t){return function(e){return j({portal:e,queries:{group:e.symbolSetsGroupQuery,item:'type:"Symbol Set" AND (typekeywords:"by value" AND typekeywords:"marker")'}}).then(G)}(e).then((e=>e.map((e=>new w({portalItem:e,strings:t})))))}function M(e,t,i){return async function(e,t){const i="2d"===t?e.stylesGroupQuery2d:e.stylesGroupQuery3d;return i?j({portal:e,queries:{group:i,item:'type:"Style"'}}).then(G):[]}(e,t).then((e=>e.map((e=>new C({portalItem:e,symbolType:t,strings:i})))))}function R(e,t){return"flat"===e?new D({strings:t}):new x({strings:t})}function P(e,t){const i={strings:e};return"line"===t?new N(i):"polygon"===t?new U(i):new A(i)}async function j(e){const t=e.portal,i=e.queries.group,s=e.queries.item,{results:o}=await t.queryGroups({query:i,disableExtraQuery:!0});if(0===o.length)return[];const[r]=o;return(await r.queryItems({query:s,disableExtraQuery:!0,num:100,sortField:r.sortField})).results}function G(e){const t=[];return e.forEach((e=>{e.typeKeywords.indexOf("default")>-1?t.unshift(e):t.push(e)})),t}const V="pointSymbol",q="lineSymbol",J="polygonSymbol",B=e=>!!e.portal;async function H(e,t){return Promise.all(e.map(t)).then((t=>e.filter(((e,i)=>t[i]))))}async function $(e,t,i,s,r,l){const a=Z(i),n="2d"===r?function(e,t){return async function(i,s){const r="point"===e?o.m:"line"===e?o.j:o.g;if(!function(i){if(t.includes("all"))return!0;const{data:s}=i,{dimensionality:o,type:r}=s;if("volumetric"===o)return!1;if("point"===e){if(t.includes("picture")&&"esriPMS"===r)return!0;if(t.includes("simple")&&"esriSMS"===r)return!0}if("line"===e&&t.includes("simple")&&"esriSLS"===r)return!0;if("polygon"===e&&t.includes("simple")&&"esriSFS"===r)return!0;const{formats:l}=s;return!(!X(t)||!X(l))}(i))return!1;const l=t.includes("cim:picture"),a=t.includes("cim:vector"),n=l&&a||!l&&!a,c=Q(s)&&!Y(s)&&!K(s),m=Y(s)&&!Q(s)&&!K(s),d=K(s)&&!Q(s)&&!Y(s),u="line"===e?q:"polygon"===e?J:V;if((c||m||d)&&n||"web-style"!==s.type||i.data.itemType===u)return!0;const h=await i.getSymbol();return!(0,o.i)(h)||r(h)}}(s,a):(c=a,async function(e){if(c.includes("all")||c.includes("3d"))return!0;const{data:{dimensionality:t}}=e;return c.includes("3d:flat")&&"flat"===t||c.includes("3d:volumetric")&&"volumetric"===t});var c;return H(t,(async t=>l?l(t,e,n):n(t,e)))}const z={point:"Point",line:"Line",polygon:"Polygon"};function Q({keywords:e}){return e.includes(z.point)||e.includes("pointSymbol")}function W({keywords:e}){return e.includes("marker")}function Y({keywords:e}){return e.includes(z.line)||e.includes("lineSymbol")}function K({keywords:e}){return e.includes(z.polygon)||e.includes("polygonSymbol")}function X(e){return Array.isArray(e)&&e.some((e=>e.includes("cim")))}function Z(e="all"){const t=Array.isArray(e)?e:[e],i=t.find((e=>"cim"===e&&t.find((e=>e.includes("cim:")))));return i?t.filter((e=>!e.includes("cim:"))):t}const ee="arcgis-symbol-picker__container",te="incompatible-symbols-notice",ie=class{constructor(e){(0,s.r)(this,e),this.arcgisActiveSymbolChange=(0,s.c)(this,"arcgisActiveSymbolChange",7),this.arcgisActiveSymbolItemChange=(0,s.c)(this,"arcgisActiveSymbolItemChange",7),this.arcgisActiveSourceIdChange=(0,s.c)(this,"arcgisActiveSourceIdChange",7),this.arcgisSymbolSourcesChange=(0,s.c)(this,"arcgisSymbolSourcesChange",7),this.arcgisActiveSourceItemsChange=(0,s.c)(this,"arcgisActiveSourceItemsChange",7),this.allCustomFileInfos=[],this.customSymbolsStorageId="arcgis-symbol-picker-custom-symbols",this.actionEls=[],this._onSymbolSourceChange=e=>{const t=e.currentTarget,{selectedItems:i}=t,s=i.find((e=>e.getAttribute("data-value")!==this._activeSourceId));this._activeSourceId=(null==s?void 0:s.getAttribute("data-value"))||this._activeSourceId,t.querySelectorAll("calcite-dropdown-item").forEach((e=>{e!==s&&(e.selected=!1)})),e.stopPropagation()},this.symbol=void 0,this.portal=void 0,this.symbolFilter=void 0,this.activeSourceId=void 0,this.activeSymbolItem=void 0,this.hideHeader=!1,this.symbolType="2d",this.customSymbolItemFilter=void 0,this.customSymbolSourceFilter=void 0,this.itemsPerRow=4,this.symbolSources=void 0,this.activeSymbolItems=void 0,this.messages=void 0,this._activeSourceId=void 0,this._symbolSources=void 0,this._activeSymbolItems=void 0,this.customSymbolError=void 0,this.isGridView=!0,this._activeSymbolFetch=void 0}handleActiveSourceItemIdChanges(){this._activeSourceId&&("custom-symbol-set"===this._activeSourceId?this._setupCustomSymbols():this._fetchAndSetUpSymbolItems(this._symbolSources.find((({id:e})=>e===this._activeSourceId))))}get editGeometry(){return(0,o.h)(this.symbol)}handleFileUploadChange({detail:e}){const t=e,i=t.cim&&JSON.stringify(t.cim.toJSON());if(t.dataURL&&t.dataURL.length>2e5)return void(this.customSymbolError="too-large");if(t.cim&&i.length>2e5)return void(this.customSymbolError="too-large");this.customSymbolError=void 0;const s=this.allCustomFileInfos.find((e=>t.dataURL&&e.dataURL&&e.dataURL===t.dataURL&&e.fileName===t.fileName||t.cim&&e.cim&&e.fileName===t.fileName&&i===JSON.stringify(e.cim.toJSON())));try{let e;if(s)e=this._activeSymbolItems.find((e=>e.data.name===s.fileName));else{const i=[...this.allCustomFileInfos,t];(0,l.s)(this.customSymbolsStorageId,i.map((e=>e.dataURL?e:Object.assign(Object.assign({},e),{cim:JSON.stringify(e.cim.toJSON())}))),!0),this.allCustomFileInfos=i,this._setupCustomSymbols(),e=this._activeSymbolItems[this._activeSymbolItems.length-1]}this.activeSymbolItem=e,this.arcgisActiveSymbolItemChange.emit(this.activeSymbolItem),this.activeSymbolItem.getSymbol().then((e=>this.arcgisActiveSymbolChange.emit(e))),setTimeout((()=>requestAnimationFrame((()=>{var e;null===(e=this.itemPaletteNode)||void 0===e||e.setFocus(),this.updateListSelection()}))),1)}catch(e){this.customSymbolError="storage-full"}}handleInvalidFile(){this.customSymbolError="invalid-file"}handleFileUploadError(){this.customSymbolError="error"}_renderSymbolSourceOptions(e,t){const{messages:i}=this,o=e.filter((e=>"symbol-set"===e.type)),r=e.filter((e=>"web-style"===e.type)),l=!this.symbolFilter||!!(Array.isArray(this.symbolFilter)?this.symbolFilter:[this.symbolFilter]).find((e=>"custom"===e||"picture"===e)),a="3d"!==this.symbolType&&"point"===this.editGeometry&&l&&(0,s.h)("calcite-dropdown-group",{groupTitle:i.customSymbols,selectionMode:"multiple",key:"custom"},(0,s.h)("calcite-dropdown-item",{key:"custom","data-value":"custom-symbol-set",selected:"custom-symbol-set"===t},i.symbols)),n=o.length>0&&(0,s.h)("calcite-dropdown-group",{groupTitle:i.classicSymbols,selectionMode:"multiple",key:"classic"},this._renderSourceDropdownItem(o,t)),c=r.length>0&&(0,s.h)("calcite-dropdown-group",{groupTitle:i.newSymbols,selectionMode:"multiple",key:"webstyles"},this._renderSourceDropdownItem(r,t));return a?n?c?[a,n,c]:[a,n]:[a,c]:n&&c?[n,c]:(0,s.h)("calcite-dropdown-group",{key:"one-group"},this._renderSourceDropdownItem([...o,...r],t))}_renderSourceDropdownItem(e,t){return e.map((e=>(0,s.h)("calcite-dropdown-item",{key:e.id,"data-value":e.id,selected:e.id===t},e.title)))}_setupCustomSymbols(){const e=this.allCustomFileInfos.map((e=>{let t=24,i=24;if(e.width>e.height?i=Math.round(t/e.width*e.height):e.width<e.height&&(t=Math.round(i/e.height*e.width)),e.dataURL){const s=e.fileName.split(".")[1].toLowerCase();return new I({data:{angle:0,contentType:"png"===s?"image/png":"gif"===s?"image/gif":"image/jpeg",height:i,imageData:e.dataURL.split(",")[1],name:e.fileName,type:"esriPMS",url:e.fileName,width:t,xoffset:0,yoffset:0},parentData:null,portalItem:null,strategy:g,strings:this.messages})}return new I({data:{symbol:e.cim,name:e.fileName},parentData:{cimVersion:"2.6.0"},portalItem:null,strategy:{getSymbol:async e=>e.data.symbol,getThumbnail:async e=>p(document.createElement("div"),e.data.symbol,{size:24,disableUpsampling:!1},e.data.title)},strings:this.messages})}));this.setUpSymbolIntersectionObserver(),this.customSymbolError=void 0,this._activeSymbolFetch=null,this._activeSymbolItems=e,this.arcgisActiveSourceIdChange.emit("custom-symbol-set"),this.arcgisActiveSourceItemsChange.emit(e.map((e=>new I(Object.assign({},e)))))}async _fetchAndSetUpSymbolItems(e){this._activeSymbolFetch&&this._activeSymbolFetch.controller.abort();const t=new AbortController,i=t.signal;this._activeSymbolFetch={controller:t,id:e.id};const s=!this._activeSymbolItems&&this.activeSymbolItems||await e.getItems(t);if(null==i?void 0:i.aborted)return;const o=await $(e,s,this.symbolFilter,this.editGeometry,this.symbolType,this.customSymbolItemFilter);(null==i?void 0:i.aborted)||(this.setUpSymbolIntersectionObserver(),this.customSymbolError=void 0,this._activeSymbolFetch=null,this._activeSymbolItems=o,this.arcgisActiveSourceIdChange.emit(this._activeSourceId),this.arcgisActiveSourceItemsChange.emit(o.map((e=>new I(Object.assign({},e))))))}onIncompatibleVectorSymbolsDismiss(e){(0,r.s)(r.l.ARCGIS_COMPONENT_NOTIFICATIONS,{key:r.a.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED,value:"true"}),e.stopPropagation()}tearDownSymbolIntersectionObserver(){var e;null===(e=this._symbolIntersectionObserver)||void 0===e||e.disconnect(),this._symbolIntersectionObserver=null}setUpSymbolIntersectionObserver(){this.tearDownSymbolIntersectionObserver();let e=0;const t={};this._symbolIntersectionObserver=new IntersectionObserver(((i,s)=>{function o(){e++,t[e]&&(t[e](),delete t[e],o())}i.forEach((i=>{if(!i.isIntersecting)return;const r=i.target;r.item.getThumbnail(r).then((i=>{r.index===e?(i(),o()):t[r.index]=i})),r.item.getSymbol(),s.unobserve(r)}))}))}async _fetchSources(){this._sourcesFetchController&&this._sourcesFetchController.abort(),this._sourcesFetchController=new AbortController;const e=this._sourcesFetchController.signal,t=this.portal,i=B(t)?t.portal:t,s=B(t)?t.before:null,r=B(t)?t.after:null,l=i?this.symbolSources||await async function(e,t,i,s,o){const r={};t&&await t(e,r),await e.load();const l=await("2d"===o?async function(e,t){const i=e.symbolSetsGroupQuery;e.symbolSetsGroupQuery='owner:esri AND title:"Map Viewer Beta Symbols"';const[s,o]=await Promise.all([L(e,t),M(e,"2d",t)]),r=e=>e.keywords.every((e=>"Basic"!==e)),l=[P(t,"point"),P(t,"line"),P(t,"polygon"),...s.filter(r),...o.filter(r)];return e.symbolSetsGroupQuery=i,l}(e,s):async function(e,t){const[i]=await Promise.all([M(e,"3d",t)]),s=[R("flat",t),R("volumetric",t),...i.filter((e=>e.keywords.every((e=>"Basic"!==e))))];return s}(e,s));return i&&await i(e,r),l}(i,s,r,this.messages,this.symbolType):[];if(!(null==e?void 0:e.aborted)&&(this._symbolSources=await async function(e,t,i,s,o){const r=Z(t),l="2d"===s?function(e,t){return async i=>{const s=i.keywords.includes("3d"),o=i.keywords.includes("Dictionary"),r="point"===e?Q(i)||W(i):"line"===e?Y(i):K(i),l=Q(i)||W(i)||Y(i)||K(i);if(s||o||!r&&l)return!1;if(t.includes("all"))return!0;const a="point"===e?E:"line"===e?T:O;return!(!t.includes("picture")||i.id==a||"symbol-set"!==i.type)||!(!t.includes("simple")||i.id!==a)||!(!X(t)||"web-style"!==i.type)}}(i,r):function(e){const t={EsriThematicShapesStyle:!0};return async i=>{if(i.keywords.every((e=>!t[e]))&&"web-style"===i.type&&(e.includes("all")||e.includes("3d")))return!0;if(function(e){return"portalItem"in e}(i)){const t=await i.fetchData(),[s]=t.items,{dimensionality:o}=s;return e.includes("3d:flat")&&"flat"===o||e.includes("3d:volumetric")&&"volumetric"===o}return e.includes("3d:flat")&&"basic-web-style:flat"==i.id||e.includes("3d:volumetric")&&"basic-web-style:volumetric"==i.id}}(r);return H(e,(async e=>o?o(e,l):l(e)))}(l,this.symbolFilter,(0,o.h)(this.symbol),this.symbolType,this.customSymbolSourceFilter),this.arcgisSymbolSourcesChange.emit(this._symbolSources),!this._activeSourceId)){let e=this.activeSourceId;e&&(this._symbolSources.find((e=>e.id===this.activeSourceId))||(e=void 0)),this._activeSourceId=e||this._symbolSources[0].id}}_getCustomSymbolsFromStorage(){if("3d"===this.symbolType||"point"!==this.editGeometry)return;const e=(0,l.g)(this.customSymbolsStorageId,!0);e&&(this.allCustomFileInfos=e.map((e=>e.dataURL?e:Object.assign(Object.assign({},e),{cim:o.e.CIMSymbol.fromJSON(JSON.parse(e.cim))}))))}_renderSourceSelection(){const{messages:e}=this,t=this._symbolSources;if(!t)return;const i=this._symbolSources.find((e=>e.id===this._activeSourceId)),o="custom-symbol-set"===this._activeSourceId?e.customSymbols:null==i?void 0:i.title,r=1===t.length,l=(0,s.h)("calcite-dropdown",{class:{"marker-source-select":!0},hidden:r,maxItems:7,onCalciteDropdownSelect:this._onSymbolSourceChange,overlayPositioning:"absolute"},(0,s.h)("calcite-button",{alignment:"space-between",appearance:"outline-fill",kind:"neutral",iconEnd:"chevron-down",scale:"m",slot:"trigger",width:"full"},o),this._renderSymbolSourceOptions(t,this._activeSourceId));return(0,s.h)("div",{class:"section",key:"header"},(0,s.h)("calcite-label",{class:"section"},this.hideHeader?null:this.messages.category,(0,s.h)("div",{class:"categories"},l,(0,s.h)("calcite-action",{active:this.isGridView,appearance:"transparent",icon:"grid",scale:"s",class:"categories-center-action",text:this.messages.gridView,onClick:()=>{this.isGridView=!0,(0,s.f)(this.el)}}),(0,s.h)("calcite-action",{active:!this.isGridView,appearance:"transparent",icon:"list",iconFlipRtl:!0,scale:"s",text:this.messages.listView,onClick:()=>{this.isGridView=!1,(0,s.f)(this.el)}}))))}_renderItemSelection(){const{portal:e,messages:t}=this,i=this._activeSymbolFetch,o=B(e)?e.portal:e;return(0,s.h)("div",{class:{scroller:!0,"marker-selection":!0},key:"gallery"},i?(0,s.h)("calcite-loader",{label:""}):0===this._activeSymbolItems.length&&"custom-symbol-set"===this._activeSourceId?(0,s.h)("arcgis-symbol-picker-file-upload",{portal:o,strings:t}):this._activeSymbolItems.length>0?(0,s.h)("div",{class:"item-palette",key:this._activeSymbolItems.length},this.isGridView?this._renderGridView():this._renderListView(),"custom-symbol-set"===this._activeSourceId&&(0,s.h)("arcgis-symbol-picker-file-upload",{class:"file-upload",portal:o,strings:t})):(0,s.h)("div",{class:"empty-category-content"},this.messages.noSymbolsAvailable))}_renderGridView(){return(0,s.h)("arcgis-item-palette",{key:this._activeSourceId,items:this._activeSymbolItems.map(((e,t)=>({item:e,index:t,observer:this._symbolIntersectionObserver}))),ItemRenderer:F,itemsPerRow:this.itemsPerRow,selected:({item:e})=>{var t;return(null==e?void 0:e.data)===(null===(t=this.activeSymbolItem)||void 0===t?void 0:t.data)},onArcgisItemSelect:e=>{const{detail:{item:t}}=e;this.customSymbolError=void 0,this.arcgisActiveSymbolItemChange.emit(t),this.activeSymbolItem=t,t.getSymbol().then((e=>this.arcgisActiveSymbolChange.emit(e))),e.stopPropagation()},ref:e=>this.itemPaletteNode=e})}_renderListView(){const e="rtl"===(0,n.g)(this.el);return(0,s.h)("calcite-list",{key:this._activeSourceId},this._activeSymbolItems.map(((t,i)=>{var o;return(0,s.h)("calcite-list-item",{key:i,label:t.data.title||t.data.name,value:i,selected:(null===(o=this.activeSymbolItem)||void 0===o?void 0:o.data.name)===t.data.name,onCalciteListItemSelect:e=>{const t=e.target,i=this._activeSymbolItems[t.value];this.customSymbolError=void 0,this.arcgisActiveSymbolItemChange.emit(i),this.activeSymbolItem=i,i.getSymbol().then((e=>this.arcgisActiveSymbolChange.emit(e))),e.stopPropagation()}},(0,s.h)("div",{slot:"actions-start",key:t.data.name,ref:e=>{e&&(t.getThumbnail(e).then((e=>e())),t.getSymbol())}}),"custom-symbol-set"===this._activeSourceId&&(0,s.h)("calcite-action",{slot:"actions-end",appearance:"transparent",text:this.messages.removeSymbol,ref:e=>{e&&(this.actionEls[i]=e)},onClick:()=>{this.removeCustomSymbol(i),(0,s.f)(this.el)},onMouseOver:()=>this.addTooltip({referenceElement:this.actionEls[i],placement:e?"right-start":"left-start",innerHTML:this.messages.removeSymbol}),onMouseOut:()=>this.removeTooltip()},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))})))}updateListSelection(){console.log("updateListSelection"),this.el.querySelectorAll("CALCITE-LIST-ITEM").forEach((e=>{e.selected=e.value===this.activeSymbolItem.data.name,e.selected&&e.setFocus()}))}removeCustomSymbol(e){this.allCustomFileInfos.splice(e,1),(0,l.s)(this.customSymbolsStorageId,this.allCustomFileInfos.map((e=>e.dataURL?e:Object.assign(Object.assign({},e),{cim:JSON.stringify(e.cim.toJSON())}))),!0),this._setupCustomSymbols(),this.activeSymbolItem=void 0}addTooltip(e){this.removeTooltip(),this.tooltipEl=document.createElement("calcite-tooltip"),this.tooltipEl.placement=e.placement||"auto",this.tooltipEl.referenceElement=e.referenceElement,this.tooltipEl.overlayPositioning="fixed",this.tooltipEl.innerHTML=e.innerHTML,this.tooltipEl.open=!0,this.el.parentElement.appendChild(this.tooltipEl)}removeTooltip(){var e;(null===(e=this.tooltipEl)||void 0===e?void 0:e.parentNode)&&(this.tooltipEl.parentNode.removeChild(this.tooltipEl),this.tooltipEl=void 0)}async componentWillLoad(){const[,[e]]=await Promise.all([o.e.load(),(0,a.g)(this.el)]);this.messages=e}componentDidLoad(){this._symbolSources||this._fetchSources(),this._getCustomSymbolsFromStorage()}connectedCallback(){var e,t;this.setUpSymbolIntersectionObserver(),null===(e=this._activeSymbolFetch)||void 0===e||e.controller.abort(),null===(t=this._sourcesFetchController)||void 0===t||t.abort()}disconnectedCallback(){this.tearDownSymbolIntersectionObserver()}render(){const e=this._symbolSources,t=this._activeSymbolFetch;if(!e||t)return(0,s.h)("div",{class:ee},(0,s.h)("calcite-loader",{label:""}));const i="basic-symbol-set"===this._activeSourceId||"custom-symbol-set"===this._activeSourceId,o=this._symbolSources.find((e=>e.id===this._activeSourceId)),l=!i&&"symbol-set"!==(null==o?void 0:o.type),a=null==o?void 0:o.keywords.includes("Adobe");return(0,s.h)("div",{class:ee},this._renderSourceSelection(),this._renderItemSelection(),a?(0,s.h)("calcite-notice",{open:!0,kind:"danger",key:"copyright",scale:"s"},(0,s.h)("div",{slot:"message",innerHTML:this.messages.adobeCopyright.replace("${year}","2022")})):null,l&&"3d"!==this.symbolType&&!(0,r.g)(r.l.ARCGIS_COMPONENT_NOTIFICATIONS,r.a.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED)?(0,s.h)("calcite-notice",{open:!0,class:te,closable:!0,icon:!0,key:"incompatible-symbols",onCalciteNoticeClose:this.onIncompatibleVectorSymbolsDismiss,scale:"s"},(0,s.h)("div",{slot:"message"},this.messages.incompatibleSymbolWarning)):null,this.customSymbolError?(0,s.h)("calcite-notice",{open:!0,class:te,closable:!0,icon:"exclamation-mark-circle",kind:"danger",key:"large-symbol",onCalciteNoticeClose:()=>this.customSymbolError=void 0,scale:"s"},(0,s.h)("div",{slot:"message"},"too-large"===this.customSymbolError?this.messages.customSymbolErrors.tooLarge:"invalid-file"===this.customSymbolError?this.messages.customSymbolErrors.invalidFile:"storage-full"===this.customSymbolError?this.messages.customSymbolErrors.outOfSpace:"error"===this.customSymbolError?this.messages.customSymbolErrors.error:void 0)):null)}get el(){return(0,s.d)(this)}static get watchers(){return{_activeSourceId:["handleActiveSourceItemIdChanges"]}}};ie.style=".scroller.sc-arcgis-symbol-picker{max-height:var(--scroller-max-height, min(100vh - 400px, 300px));overflow-y:auto;min-width:200px;overflow-x:hidden;display:flex;justify-content:center}.sc-arcgis-symbol-picker-h,.arcgis-symbol-picker__container.sc-arcgis-symbol-picker{display:flex;flex:1 1 auto;flex-flow:column nowrap;align-items:stretch}.categories.sc-arcgis-symbol-picker{display:flex;align-content:normal}.categories-center-action.sc-arcgis-symbol-picker{padding:0 5px}.marker-selection.sc-arcgis-symbol-picker{padding:8px}.marker-source-select.sc-arcgis-symbol-picker{width:calc(100% - 74px);display:block}.marker-source-select[hidden].sc-arcgis-symbol-picker+.marker-selection.sc-arcgis-symbol-picker{border-top:1px solid lightgray;background-color:var(--arcgis-app-background)}.marker-selection--dark.sc-arcgis-symbol-picker{background-color:var(--arcgis-app-foreground);color:var(--arcgis-app-background)}.empty-category-content.sc-arcgis-symbol-picker{display:flex;align-items:center;padding:var(--arcgis-app-spacing-half) var(--arcgis-app-spacing-quarter)}.incompatible-symbols-notice.sc-arcgis-symbol-picker{margin:8px 0}.marker-item.sc-arcgis-symbol-picker{height:40px;width:38.5px;display:flex;justify-content:center;align-items:center;background-color:var(--arcgis-app-background)}.marker-item.sc-arcgis-symbol-picker [slot=thumbnail].sc-arcgis-symbol-picker>div.sc-arcgis-symbol-picker{margin:8px 10px;display:flex;justify-content:center;align-items:center}.item-palette.sc-arcgis-symbol-picker{width:100%;display:flex;flex-direction:column}.file-upload.sc-arcgis-symbol-picker{margin-top:20px;width:auto}"},74828:(e,t,i)=>{var s,o;i.d(t,{a:()=>o,g:()=>a,l:()=>s,s:()=>l}),function(e){e.ARCGIS_COMPONENT_NOTIFICATIONS="arcgisComponent_notifications"}(s||(s={})),function(e){e.FEATURE_REDUCTION_WARNING_DISMISSED="arcgis_feature_reduction_warning_dismissed",e.POPUP_WARNING_DISMISSED="arcgis_popup_warning_dismissed",e.INCOMPATIBLE_VECTOR_SYMBOLS_DISMISSED="arcgis_symbol_styler_incompatible_vector_symbols_dismissed",e.EFFECTS_TIP_DISMISSED="arcgis_effects_tip_dismissed",e.LAYER_VIEW_DEFINITION_DISMISSED="arcgis_layer_view_definition_dismissed",e.LAYER_OVERRIDE_STATUS_TIP_DISMISSED="arcgis_layer_override_status_tip_dismissed",e.LAYER_VIEW_JOIN_TIP_DISMISSED="arcgis_layer_view_join_tip_dismissed",e.MULTIDIMENSIONAL_INFO_TIP_DISMISSED="arcgis_multidimensional_info_tip_dismissed"}(o||(o={}));const r=e=>JSON.parse((e=>localStorage.getItem(e))(e))||{},l=(e,t)=>{const i=r(e);i[t.key]=t.value,((e,t)=>{localStorage.setItem(e,t)})(e,JSON.stringify(i))},a=(e,t)=>{const i=r(e);return(null==i?void 0:i.hasOwnProperty(t))?i[t]:null}},15859:(e,t,i)=>{i.d(t,{a:()=>r,b:()=>o,c:()=>n,d:()=>c,g:()=>a,s:()=>l});var s=i(26426);function o(e,t,i,s){!function(e,t,i){let s=null==(i=i||{})?void 0:i.expires;if("number"==typeof s){const e=new Date,t=24*s*60*60*1e3;e.setTime(Date.now()+t),s=i.expires=e}"string"!=typeof s&&(null==s?void 0:s.toUTCString)&&(i.expires=s.toUTCString());let o,r=`${e}=${encodeURIComponent(t)}`;for(o in i){r+=`; ${o}`;const e=i[o];!0!==e&&(r+=`=${e}`)}document.cookie=r}(e,s?JSON.stringify(t):t,i)}function r(e,t){const i=function(e){const t=document.cookie,i=new RegExp(`(?:^|; )${(0,s.e)(e)}=([^;]*)`),o=t.match(i);return o?decodeURIComponent(o[1]):void 0}(e);return i&&t?JSON.parse(i):i}function l(e,t,i){window.localStorage.setItem(e,i?JSON.stringify(t):t)}function a(e,t){const i=window.localStorage.getItem(e);return i&&t?JSON.parse(i):i}function n(e,t,i){window.sessionStorage.setItem(e,i?JSON.stringify(t):t)}function c(e,t){const i=window.sessionStorage.getItem(e);return i&&t?JSON.parse(i):i}}}]);
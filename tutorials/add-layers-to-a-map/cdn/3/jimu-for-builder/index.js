System.register(["jimu-core","jimu-core/react","jimu-theme","jimu-layouts/layout-runtime","jimu-ui","jimu-for-builder/templates","jimu-for-builder","jimu-ui/basic/sql-expression-runtime","jimu-ui/basic/guide","jimu-ui/advanced/setting-components"],(function(e,t){var i={},n={},o={},s={},a={},r={},l={},d={},u={},c={};return{setters:[function(e){i.AjaxState=e.AjaxState,i.AllDataSourceTypes=e.AllDataSourceTypes,i.AppMode=e.AppMode,i.AppType=e.AppType,i.BrowserSizeMode=e.BrowserSizeMode,i.CONSTANTS=e.CONSTANTS,i.ContainerType=e.ContainerType,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.ExtensionManager=e.ExtensionManager,i.GuideLevels=e.GuideLevels,i.GuideManager=e.GuideManager,i.GuideTypes=e.GuideTypes,i.Immutable=e.Immutable,i.IntlProvider=e.IntlProvider,i.Keyboard=e.Keyboard,i.LayoutItemType=e.LayoutItemType,i.LayoutParentType=e.LayoutParentType,i.LayoutType=e.LayoutType,i.MessageActionConnectionType=e.MessageActionConnectionType,i.MessageCarryData=e.MessageCarryData,i.MessageType=e.MessageType,i.MutableStoreManager=e.MutableStoreManager,i.PageMode=e.PageMode,i.PageType=e.PageType,i.React=e.React,i.ReactRedux=e.ReactRedux,i.ResourceType=e.ResourceType,i.ScreenTransitionType=e.ScreenTransitionType,i.SessionManager=e.SessionManager,i.SqlExpressionMode=e.SqlExpressionMode,i.UrlGeneralConfig=e.UrlGeneralConfig,i.WidgetManager=e.WidgetManager,i.WidgetType=e.WidgetType,i.appActions=e.appActions,i.appConfigUtils=e.appConfigUtils,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.defaultMessages=e.defaultMessages,i.esri=e.esri,i.extensionSpec=e.extensionSpec,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.i18n=e.i18n,i.injectIntl=e.injectIntl,i.jimuHistory=e.jimuHistory,i.jsx=e.jsx,i.keyboardUtils=e.keyboardUtils,i.loadDependencies=e.loadDependencies,i.lodash=e.lodash,i.moduleLoader=e.moduleLoader,i.observeStore=e.observeStore,i.polished=e.polished,i.portalUrlUtils=e.portalUrlUtils,i.portalUtils=e.portalUtils,i.queryString=e.queryString,i.translatedLocales=e.translatedLocales,i.urlManagerUtils=e.urlManagerUtils,i.urlUtils=e.urlUtils,i.useIntl=e.useIntl,i.utils=e.utils,i.uuidv1=e.uuidv1,i.version=e.version},function(e){n.PureComponent=e.PureComponent,n.createElement=e.createElement},function(e){o.withTheme=e.withTheme},function(e){s.searchUtils=e.searchUtils,s.utils=e.utils},function(e){a.Button=e.Button,a.Checkbox=e.Checkbox,a.Label=e.Label,a.Link=e.Link,a.Loading=e.Loading,a.LoadingType=e.LoadingType,a.MultiSelect=e.MultiSelect,a.Popper=e.Popper,a.Radio=e.Radio,a.SVG=e.SVG,a.Toast=e.Toast,a.ToastType=e.ToastType,a.Tooltip=e.Tooltip,a.Typography=e.Typography,a.defaultMessages=e.defaultMessages,a.imageUtils=e.imageUtils},function(e){r.getTemplateConfig=e.getTemplateConfig},function(e){l.getAppConfigAction=e.getAppConfigAction},function(e){d.getJimuFieldNamesBySqlExpression=e.getJimuFieldNamesBySqlExpression},function(e){u.EVENTS=e.EVENTS,u.GuideComponent=e.GuideComponent,u.STATUS=e.STATUS,u.findLayoutItem=e.findLayoutItem,u.getTargetSelector=e.getTargetSelector},function(e){c.SettingRow=e.SettingRow}],execute:function(){e((()=>{var e={6499:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m6.036 12.157 8.01-8.01a.5.5 0 1 1 .707.707l-8.01 8.01a1 1 0 0 1-1.415 0L1.146 8.682a.5.5 0 1 1 .708-.707z"></path></svg>'},1617:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M.007.883A1 1 0 0 1 1 0h10l.117.007A1 1 0 0 1 12 1v7l-.007.117A1 1 0 0 1 11 9H4l-4 3V1zM11 1H1v9l2.667-2H11zM3 3.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5M3.5 5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1z" clip-rule="evenodd"></path></svg>'},3153:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.333 0h4c.737 0 1.334.597 1.334 1.333v1.334h8C15.403 2.667 16 3.264 16 4v10.667c0 .736-.597 1.333-1.333 1.333H1.333A1.333 1.333 0 0 1 0 14.667V1.333C0 .597.597 0 1.333 0m0 7.333v7.334h13.334V7.333zm0-1.333h13.334V4H5.334V1.335h-4z" clip-rule="evenodd"></path></svg>'},7528:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 2h12v4H2zM1 7V1h14v6zm1 3h12v4H2zm-1 5V9h14v6z" clip-rule="evenodd"></path></svg>'},9218:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 2h12v12H2zM1 15V1h14v14zm4-9h6v4H5zm-1 5V5h8v6z" clip-rule="evenodd"></path></svg>'},8201:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M17 2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM5 1h10a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1m2 2h6v6H7zm0 8h1v2H7zm2 0h1v1H9zm4 2h-1v1h1zm-6 1h1v1H7zm4 2h-1v1h1zm1-1h1v2h-1zm-3 2v-1H7v1zm2-6h2v1h-2z" clip-rule="evenodd"></path></svg>'},8850:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M3 3h7v7H3zM11 11h1v2h-1zM13 11h1v1h-1zM17 13h-1v1h1zM11 14h1v1h-1zM15 16h-1v1h1zM16 15h1v2h-1zM13 17v-1h-2v1zM15 11h2v1h-2z"></path><path fill="#000" fill-rule="evenodd" d="M20 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2zM2 1h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},9859:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M4 4h2v1H4zM8 4h2v1H8zM14 4h-2v1h2zM15 4h1v2h-1zM16 8h-1v2h1zM4 14h1v2H4zM5 6H4v2h1zM4 10h1v2H4zM16 12h-1v2h1zM16 15v1h-2v-1zM12 15h-2v1h2zM6 15h2v1H6z"></path><path fill="#000" fill-rule="evenodd" d="M18 0a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 1H2a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path></svg>'},1341:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M3 7h6v6H3zM11 7h1v2h-1zM13 7h1v1h-1zM17 9h-1v1h1zM11 10h1v1h-1zM15 12h-1v1h1zM16 11h1v2h-1zM13 13v-1h-2v1zM15 7h2v1h-2z"></path><path fill="#000" fill-rule="evenodd" d="M20 5a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2zM2 4h16a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},2606:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M1.25 2.5h17.5v11.25H1.25zM0 2.5c0-.69.56-1.25 1.25-1.25h17.5c.69 0 1.25.56 1.25 1.25v11.25c0 .69-.56 1.25-1.25 1.25H1.25C.56 15 0 14.44 0 13.75zm3.75 16.25h2.5V17.5h-2.5zm7.5 0h-2.5V17.5h2.5zm2.5 0h2.5V17.5h-2.5z" clip-rule="evenodd"></path></svg>'},8736:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M14 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM2 1h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M20 8a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM8 7h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},5037:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 40"><path fill="#A8A8A8" fill-rule="evenodd" d="M6 30v10H0v-1h5v-9zM3.162 18.582a.5.5 0 0 1 0 .71l-1.416 1.421a2.497 2.497 0 0 0-.003 3.545c.983.983 2.56.98 3.544-.003l1.42-1.42a.504.504 0 0 1 .712.713L6 24.968a3.5 3.5 0 0 1-4.967 0 3.5 3.5 0 0 1 0-4.967l1.416-1.422a.504.504 0 0 1 .713.003m4.967-.71a.5.5 0 0 1 0 .71L4.58 22.129a.504.504 0 0 1-.713-.712l3.548-3.548a.504.504 0 0 1 .713.003m2.838-2.838a3.5 3.5 0 0 1 0 4.967l-1.42 1.419a.504.504 0 0 1-.713-.712l1.423-1.417a2.5 2.5 0 0 0 0-3.547 2.5 2.5 0 0 0-3.547 0l-1.42 1.419a.504.504 0 0 1-.713-.712l1.42-1.42a3.506 3.506 0 0 1 4.97.003M6 0v10H5V1H0V0z"></path></svg>'},6490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m1.373 8 2.07-2.071.83.828L2.2 8.828a3.515 3.515 0 0 0 4.97 4.971l2.072-2.071.828.828L8 14.627A4.686 4.686 0 1 1 1.373 8M13.799 7.172l-2.071 2.07.828.83L14.627 8A4.686 4.686 0 1 0 8 1.373l-2.071 2.07.828.83L8.828 2.2a3.515 3.515 0 0 1 4.971 4.97"></path><path fill="#000" d="M5.515 9.657a.586.586 0 0 0 .828.828l4.142-4.142a.586.586 0 0 0-.828-.828z"></path></svg>'},5886:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M10.167 0H1.833A.845.845 0 0 0 1 .857v10.286c0 .473.373.857.833.857h8.334c.46 0 .833-.384.833-.857V.857A.845.845 0 0 0 10.167 0M2 11V1h8v10zm1.6-8h4.8c.331 0 .6.224.6.5s-.269.5-.6.5H3.6c-.331 0-.6-.224-.6-.5s.269-.5.6-.5m4.8 3H3.6c-.331 0-.6.224-.6.5s.269.5.6.5h4.8c.331 0 .6-.224.6-.5S8.731 6 8.4 6" clip-rule="evenodd"></path></svg>'},6745:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M15 8A7 7 0 1 1 1 8a7 7 0 0 1 14 0m1 0A8 8 0 1 1 0 8a8 8 0 0 1 16 0m-7.676 2.228H7.34c-.213-1.138.621-2.13 1.375-3.025C9.28 6.532 9.8 5.914 9.8 5.328 9.8 4.5 9.2 3.9 7.976 3.9c-.816 0-1.572.36-2.268 1.092l-.648-.6C5.852 3.552 6.788 3 8.096 3c1.692 0 2.772.864 2.772 2.244 0 .864-.652 1.628-1.3 2.387-.71.831-1.413 1.655-1.244 2.597m.3 2.172c0 .48-.348.792-.768.792-.432 0-.78-.312-.78-.792s.348-.804.78-.804c.42 0 .768.324.768.804" clip-rule="evenodd"></path></svg>'},8996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},6963:(e,t,i)=>{"use strict";i.r(t),i.d(t,{AppConfigAction:()=>S.I,AppDataActionManager:()=>w,AppMessageManager:()=>v,AppResourceFilePath:()=>Ce.$,AppResourceManager:()=>Ce.N,AppStateHistoryActionKeys:()=>A.TX,AppStateHistoryExtension:()=>A.Ay,AppStateReduxStoreExtension:()=>b.Ay,AppWidgetManager:()=>C.A,BaseLayoutService:()=>Qe.bf,BaseWidgetSetting:()=>r,BuilderKeyboardComponent:()=>ge,BuilderStateActionTypes:()=>u.M1,BuilderStateReduxStoreExtension:()=>u.Ay,BuilderStateResourceActionKeys:()=>x.vK,BuilderStateResourceExtension:()=>x.Ay,ChooseConnectionType:()=>he,ContentServiceWrapper:()=>Qe.yC,DownloadAppModal:()=>dt,ExpressModeSwitch:()=>ft,ExtActionKeys:()=>b.ck,LayoutServiceProvider:()=>Qe.zM,ToBuilderMessage:()=>fe.M,UrlConfigManager:()=>L,WidgetSettingManager:()=>f,appBuilderSync:()=>j,appConfigUtils:()=>ue,appStateActions:()=>b.Aj,appStateHistoryActions:()=>A.yx,builderActionKeys:()=>u.qR,builderActions:()=>u.Zv,builderAppSync:()=>D,builderStateResourceActions:()=>x.WI,dataSourceService:()=>Qe.no,defaultMessages:()=>E.A,emptyContentService:()=>Qe.YU,getAppConfigAction:()=>S.y,helpUtils:()=>de,init:()=>Ve,loadI18nMessage:()=>Ne,makeSureTemplateConfig:()=>Qe.IE,messageActionUtils:()=>o,placeholderService:()=>Qe.X7,screenGroupService:()=>Qe.rW,sectionService:()=>Qe.HA,templateService:()=>Qe.Qi,templateUtils:()=>ce,utils:()=>n,widgetService:()=>Qe.Q7});var n={};i.r(n),i.d(n,{CUSTOM_GROUP:()=>le,fetchCommonWidgetList:()=>Y,fetchRemoteCustomWidgetList:()=>ee,getBuilderUrl:()=>ae,getDefaultSectionIcon:()=>K,getDefaultTocDialogIcon:()=>Q,getDefaultTocPageIcon:()=>V,getHomePageUrl:()=>re,getPageListByDialogId:()=>J,getPlaceholderItemForWidgetsList:()=>ne,getSectionItemForWidgetsList:()=>ie,getWidgetsGroupLabel:()=>te,showCustomWidgets:()=>se,showRemoteCustomWidgets:()=>oe});var o={};i.r(o),i.d(o,{getAppConfig:()=>we,getMapUseDataSourcesByUseMapWidgetIds:()=>Se,getNewActionItem:()=>ye,getNewMessage:()=>me,getWidgetJson:()=>Ie});var s=i(9244);class a extends s.React.PureComponent{}const r=a;var l=i(8972),d=i(1888),u=i(876),c=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};const{getLocaleToLoad:p,loadLocaleMessages:g}=s.i18n;class h{static getInstance(){return h.instance||(h.instance=new h,window._widgetSettingManager=h.instance),h.instance}constructor(){this.settings={},(0,s.observeStore)(this.onStoreChange.bind(this),["appStateInBuilder","appConfig","widgets"])}getWidgetUri(e){var t,i,n;const o=null===(t=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig;return null===(n=null===(i=null==o?void 0:o.widgets)||void 0===i?void 0:i[e])||void 0===n?void 0:n.uri}getWidgetManifestByUri(e){var t,i,n;const o=null===(i=null===(t=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets,a=Object.keys(o||{}).find((t=>o[t].uri===e));return null===(n=o[a])||void 0===n?void 0:n.manifest}updateWidgetCache(e,t){if("__proto__"!==e&&"constructor"!==e&&"prototype"!==e){this.settings[e]||(this.settings[e]={});for(const i in t){if("__proto__"===i||"constructor"===i||"prototype"===i)return;this.settings[e][i]=t[i]}}}getWidgetSettingClass(e){var t;return null===(t=this.settings[this.getWidgetUri(e)])||void 0===t?void 0:t.settingClazz}destroyWidgetSettingClass(e){const t=this.getWidgetUri(e);t&&delete this.settings[t]}destroyWidgetSettingClassByUri(e){this.checkWidgetUriInConfig(e)||delete this.settings[e]}getItemSettingClass(e){var t;return null===(t=this.settings[this.getWidgetUri(e)])||void 0===t?void 0:t.itemSettingClazz}getSettingI18nMessagesByUri(e){var t;return null===(t=this.settings[e])||void 0===t?void 0:t.settingI18nMessage}destroyAllWidgetSettingClasses(){this.settings={}}loadWidgetSettingClass(e){return c(this,void 0,void 0,(function*(){var t,i,n;const o=null===(n=null===(i=null===(t=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||void 0===n?void 0:n[e];if(!o)return yield Promise.resolve(null);if(!o.manifest)return yield Promise.resolve(null);const a=this.getWidgetUri(e);return this.loadWidgetSettingClassByUri(a)}))}checkWidgetUriInConfig(e){var t,i;const n=(null===(i=null===(t=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||{};return!!Object.keys(n).find((t=>n[t].uri===e))}loadWidgetSettingClassByUri(e){return this.settings[e]||(this.settings[e]={}),this.settings[e].settingClazzPromise||(this.settings[e].settingClazzPromise=this.loadRawSettingClass(e).then((()=>c(this,void 0,void 0,(function*(){return yield this.loadI18nMessagesForSetting(e)})))).then((()=>{const t=this.injectWidgetSettingProps(e);return t?(this.settings[e].settingClazz=t,(0,s.getAppStore)().dispatch(u.Zv.widgetSettingClassLoaded(e)),t):(delete this.settings[e],null)}))),this.settings[e].settingClazzPromise}loadRawSettingClass(e){return c(this,void 0,void 0,(function*(){const t=this.getWidgetManifestByUri(e);let i=`${e}dist/setting/setting`;return t.properties.hasSettingPage||(i="jimu-for-builder/json-editor-setting"),yield this.loadWidgetSettingDependency(e).then((()=>c(this,void 0,void 0,(function*(){return yield s.moduleLoader.loadModule(i)})))).then((t=>{const i=t.default?t.default:t;return this.settings[e].rawSettingClazz=i,i}))}))}loadI18nMessagesForSetting(e){return c(this,void 0,void 0,(function*(){if(this.settings[e]||(this.settings[e]={}),this.settings[e].settingI18nMessagePromise)return yield this.settings[e].settingI18nMessagePromise;const t=this.getWidgetManifestByUri(e);if(!t)return yield Promise.resolve({});if(t.translatedLocales){let i=(0,s.getAppStore)().getState().appContext.locale;i=p(i,t.translatedLocales),this.settings[e].settingI18nMessagePromise=i?g(`${e}dist/setting/translations`,i):Promise.resolve({})}else this.settings[e].settingI18nMessagePromise=Promise.resolve({});return yield this.settings[e].settingI18nMessagePromise.then(((i={})=>((0,s.getAppStore)().dispatch(u.Zv.widgetSettingI18nMessageLoaded(t.name,i)),this.settings[e].settingI18nMessage=i,i)))}))}loadWidgetSettingDependency(e){return c(this,void 0,void 0,(function*(){const t=this.getWidgetManifestByUri(e);if(!t.settingDependency)return void(yield Promise.resolve());const i="string"==typeof t.settingDependency?[t.settingDependency]:t.settingDependency;yield(0,s.loadDependencies)(i)}))}loadItemSettingClass(e){return c(this,void 0,void 0,(function*(){var t,i,n;const o=null===(n=null===(i=null===(t=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||void 0===n?void 0:n[e];return o&&o.manifest?yield this.loadItemSettingClassByUri(this.getWidgetUri(e)):yield Promise.resolve(null)}))}loadItemSettingClassByUri(e){return c(this,void 0,void 0,(function*(){return this.settings[e]||(this.settings[e]={}),this.settings[e].itemSettingClazzPromise||(this.settings[e].itemSettingClazzPromise=this.loadRawItemSettingClass(e).then((t=>(this.settings[e].itemSettingClazz=t,t)))),this.settings[e].itemSettingClazzPromise}))}loadRawItemSettingClass(e){return c(this,void 0,void 0,(function*(){const t=`${e}dist/setting/item-setting`;return yield s.moduleLoader.loadModule(t).then((e=>e.default?e.default:e))}))}injectWidgetSettingProps(e){if(!this.checkWidgetUriInConfig(e))return null;const t=this.settings[e].rawSettingClazz,i=(0,s.injectIntl)(t),n=(0,d.withTheme)(i,!0),o=this.getWidgetManifestByUri(e),a=o.name,r=this.settings[e].settingI18nMessage;class u extends l.PureComponent{constructor(e){super(e),this.state={fullConfig:null}}componentDidMount(){t.getFullConfig&&this.setState({fullConfig:t.getFullConfig(this.props.config)})}componentDidUpdate(e){t.getFullConfig&&e.config!==this.props.config&&this.setState({fullConfig:t.getFullConfig(this.props.config)})}getFullConfig(e){return t.getFullConfig?t.getFullConfig(e):e}render(){if(o.version!==this.props.version)return null;const e={messages:r,savedConfig:this.props.config};this.state.fullConfig?e.config=this.state.fullConfig:e.config=this.getFullConfig(this.props.config);const t=Object.assign({},r,this.props.appI18nMessages);return l.createElement(s.IntlProvider,{locale:this.props.locale,defaultLocale:this.props.locale,messages:t},l.createElement(n,Object.assign({},this.props,e)))}}u.displayName=`WidgetSettingWrapper(${a})`;return s.ReactRedux.connect(((e,i)=>{const n={queryObject:e.queryObject,user:e.user,portalUrl:e.portalUrl,portalSelf:e.portalSelf,locale:e.appContext.locale,appI18nMessages:e.appI18nMessages},o=i.widgetId,s=e.appStateInBuilder.appConfig.widgets[o],a=e.appStateInBuilder.widgetsRuntimeInfo[o];if(!s)return{};const r=Object.assign(n,s,i,a);return Object.assign(r,t.mapExtraStateProps?t.mapExtraStateProps(e,r):{})}))(u)}onStoreChange(e,t){e&&t&&Object.keys(e).forEach((e=>{t[e]}))}}const f=h;var m=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};const{getTranslatedLocale:y}=s.i18n;class v{constructor(){this.actionSettings={}}static getInstance(){return v.instance||(v.instance=new v),v.instance}getAllActions(){const e=this.getAppMessageManager();return e?e.getActions():[]}getAction(e,t){const i=this.getAppMessageManager();return i?i.getAction(e,t):null}getAppMessageManager(){if(window.jimuConfig.isBuilder){if(window._appWindow._messageManager)return window._appWindow._messageManager}else if(window._messageManager)return window._messageManager;return null}getActionSettingComponentUri(e,t,i){if(e.getSettingComponentUri)return e.getSettingComponentUri(t,i);if(e.widgetId){const t=(0,s.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e.widgetId].manifest.messageActions.find((t=>t.name===e.name));return t?t.settingUri:null}return null}getFilteredActions(e,t){if(window._appWindow._messageManager){const i=window._appWindow._messageManager.getActions(),n=[],o={messageType:e,widgetId:t},a=(window.jimuConfig.isBuilder?(0,s.getAppStore)().getState().appStateInBuilder:(0,s.getAppStore)().getState()).appConfig.widgets[t].manifest.publishMessages.find((t=>"string"==typeof t?t===e:t.messageType===e));a&&"string"!=typeof a&&(o.messageCarryData=a.messageCarryData);for(let e=0;e<i.length;e++)i[e].filterMessageDescription(o)&&n.push(i[e]);return n}return[]}getConvertedSettingUri(e,t){const i=this.getAllActions();let n=null;for(let o=0;o<i.length;o++)if(e.includes(i[o].id)){const e=i[o].widgetId;if(e){const a=(0,s.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e],r=a.manifest.messageActions;let l=null;if(r)for(let e=0;e<r.length;e++)r[e].name===i[o].name&&(l=r[e]);return l&&t?(n=a.uri+"dist/"+t,n):null}return t}return n}loadActionSettingClass(e,t){return m(this,void 0,void 0,(function*(){var i;const n=t?this.getConvertedSettingUri(e.actionId,t):null;if(n||Promise.resolve(null),this.actionSettings[n]||(this.actionSettings[n]={}),null===(i=this.actionSettings[n])||void 0===i?void 0:i.clazzPromise)return yield this.actionSettings[n].clazzPromise;const o=e.widgetId,a=(0,s.getAppStore)().getState().appStateInBuilder.appConfig.widgets[o];return this.actionSettings[n].clazzPromise=this.loadRawSettingClass(n).then((e=>m(this,void 0,void 0,(function*(){return f.getInstance().loadI18nMessagesForSetting(a&&a.uri).then((t=>this.injectActionSettingProps(e,t,a&&a.id)))})))).then((e=>(this.actionSettings[n].clazz=e,e))),this.actionSettings[n].clazzPromise}))}loadRawSettingClass(e){return m(this,void 0,void 0,(function*(){return this.actionSettings[e].rawClazzPromise?yield this.actionSettings[e].rawClazzPromise:(this.actionSettings[e].rawClazzPromise=s.moduleLoader.loadModule(e).then((t=>(t=t.default?t.default:t,this.actionSettings[e].rawClazz=t,this.actionSettings[e].rawClazz))),this.actionSettings[e].rawClazzPromise)}))}injectActionSettingProps(e,t,i){const n=(0,s.injectIntl)(e),o=(0,s.getAppStore)().getState().appStateInBuilder.appConfig.widgets[i];let a=null;a=i&&o?(0,s.getAppStore)().getState().appStateInBuilder.appConfig.widgets[i].manifest.name:"Framework";class r extends s.React.PureComponent{render(){const e={messages:t},a=(0,s.getAppStore)().getState().appI18nMessages;let r=null;i&&o?(r=y((0,s.getAppStore)().getState().appContext.locale,o.manifest.translatedLocales.asMutable()),r||(r=o.manifest.translatedLocales&&o.manifest.translatedLocales[0]),r||(r=(0,s.getAppStore)().getState().appContext.locale)):r=(0,s.getAppStore)().getState().appContext.locale;const l=Object.assign({},t,a);return s.React.createElement(s.IntlProvider,{locale:r,messages:l},s.React.createElement(n,Object.assign({},this.props,e)))}}r.displayName=`ActionSettingWrapper(${a})`;for(const t in e)r[t]||(r[t]=e[t]);return r}registerActionRawSettingClass(e,t){this.actionSettings[e]||(this.actionSettings[e]={}),this.actionSettings[e].rawClazz=t,this.actionSettings[e].rawClazzPromise=Promise.resolve(t),this.actionSettings[e].settingI18nMessages={},this.actionSettings[e].settingI18nMessagesPromise=Promise.resolve({})}getActionRawSettingClass(e){return this.actionSettings[e].rawClazz}}var S=i(4617);const{getTranslatedLocale:I}=s.i18n;class w{constructor(){this.actionSettings={}}static getInstance(){return w.instance||(w.instance=new w),w.instance}loadAllActionSettingClasses(){var e;const t=(0,S.y)();return Object.keys((null===(e=t.appConfig)||void 0===e?void 0:e.widgets)||{}).forEach((e=>{var i;const n=t.appConfig.widgets[e],o=[].concat(null===(i=n.manifest)||void 0===i?void 0:i.dataActions).filter((e=>e));o.length>0&&o.forEach((e=>{if(e.settingUri){const t=`${n.uri}dist/${e.settingUri}`;this.actionSettings[t]||(this.actionSettings[t]=s.moduleLoader.loadModule(t).then((e=>{const t=e.default;return f.getInstance().loadI18nMessagesForSetting(n.uri).then((e=>this.injectActionSettingProps(t,e,n.id)))})))}}))})),this.actionSettings}injectActionSettingProps(e,t,i){const n=(0,s.injectIntl)(e),o=(0,s.getAppStore)().getState().appStateInBuilder.appConfig.widgets[i];let a=null;a=i&&o?(0,s.getAppStore)().getState().appStateInBuilder.appConfig.widgets[i].manifest.name:"Framework";class r extends s.React.PureComponent{render(){const e={messages:t},a=(0,s.getAppStore)().getState().appI18nMessages;let r=null;i&&o?(r=I((0,s.getAppStore)().getState().appContext.locale,o.manifest.translatedLocales.asMutable()),r||(r=o.manifest.translatedLocales&&o.manifest.translatedLocales[0]),r||(r=(0,s.getAppStore)().getState().appContext.locale)):r=(0,s.getAppStore)().getState().appContext.locale;const l=Object.assign({},t,a);return s.React.createElement(s.IntlProvider,{locale:r,messages:l},s.React.createElement(n,Object.assign({},this.props,e)))}}r.displayName=`ActionSettingWrapper(${a})`;for(const t in e)r[t]||(r[t]=e[t]);return r}}var C=i(4601),b=i(1575),A=i(2241),x=i(3209),M=i(4108),T=i(1496);class P{constructor(){this.isGeneralUrlConfigEnable=e=>{var t;const i=s.urlManagerUtils.getAppConfig(),n=null===(t=null==i?void 0:i.urlParams)||void 0===t?void 0:t.getIn(["general",e]);let o=null==n?void 0:n.isEnable;return void 0===o&&e===s.UrlGeneralConfig.DataSelection&&(o=!0),o},this.isZoomToSelectionEnable=()=>{var e,t;const i=s.urlManagerUtils.getAppConfig(),n=null===(e=null==i?void 0:i.urlParams)||void 0===e?void 0:e.getIn(["general",s.UrlGeneralConfig.DataSelection]);return null!==(t=null==n?void 0:n.zoomToSelection)&&void 0!==t&&t}}static getInstance(){return P.instance||(P.instance=new P),P.instance}getWidgetsUseUrlParamsInManifest(){const e=s.urlManagerUtils.getAppConfig();let t=null;if(null==e?void 0:e.widgets){t=s.Immutable.from({});for(const i of Object.keys(e.widgets)){const n=e.widgets[i],o=n.manifest.urlParameters;if((null==o?void 0:o.length)>0){t=t.set(i,n);const e=o.map((e=>{var t,i;const o=e.name,s=null!==(t=n.manifest.i18nMessages[`_url_params_${o}_label`])&&void 0!==t?t:e.label;if((e=e.set("label",s)).tooltip){const t=null!==(i=n.manifest.i18nMessages[`_url_params_${o}_tooltip`])&&void 0!==i?i:e.tooltip;e=e.set("tooltip",t)}return e}));t=t.setIn([i,"manifest","urlParameters"],e)}}}return t}updateGeneralUrlConfigEnable(e,t){var i,n;let o=s.urlManagerUtils.getAppConfig(),a=null===(i=o.urlParams)||void 0===i?void 0:i.getIn(["general",e]);a||(a=s.Immutable.from({isEnable:!1})),a=null==a?void 0:a.merge({isEnable:t}),o.urlParams||(o=o.setIn(["urlParams"],s.Immutable.from({general:{}})));const r=null===(n=o.urlParams)||void 0===n?void 0:n.setIn(["general",e],a);this.updateUrlParamsConfig(r)}updateZoomToSelectionEnable(e){var t,i;let n=s.urlManagerUtils.getAppConfig(),o=null===(t=n.urlParams)||void 0===t?void 0:t.getIn(["general",s.UrlGeneralConfig.DataSelection]);o||(o=s.Immutable.from({isEnable:!0})),o=null==o?void 0:o.merge({zoomToSelection:e}),n.urlParams||(n=n.setIn(["urlParams"],s.Immutable.from({general:{}})));const a=null===(i=n.urlParams)||void 0===i?void 0:i.setIn(["general",s.UrlGeneralConfig.DataSelection],o);this.updateUrlParamsConfig(a)}isWidgetParamEnable(e,t,i){var n;let o=!0;const a=null===(n=s.urlManagerUtils.getAppConfig().urlParams)||void 0===n?void 0:n.getIn(["widgets",e]);return o=null==a?void 0:a.getIn(["params",t]),void 0===o&&(o=!0,i&&(o=!1)),o}updateWidgetEnable(e,t){let{appConfig:i,widgetUrlConfig:n}=this.getWidgetsUrlParamsConfig(e);n=null==n?void 0:n.merge({isEnable:t}),this._setWidgetUrlConfig(e,n,i,(0,M.getAppConfigAction)())}updateWidgetParamEnable(e,t,i){let{appConfig:n,widgetUrlConfig:o}=this.getWidgetsUrlParamsConfig(e);o=o.setIn(["params",t],i),this._setWidgetUrlConfig(e,o,n,(0,M.getAppConfigAction)())}getFlatPageInfos(e){let t=[];return null==e||e.forEach((e=>{var i;const n=Object.keys(e)[0];t.push(n),(null===(i=e[n])||void 0===i?void 0:i.length)>0&&(t=t.concat(e[n].flat()))})),t}getWidgetsInPages(e,t){const i=[],n=s.urlManagerUtils.getAppConfig(),o=this.getFlatPageInfos(null==n?void 0:n.pageStructure);return null==o||o.forEach((o=>{const a={type:s.ContainerType.Page,id:o},r=T.searchUtils.getContentsInContainerRecursive(n,a,s.LayoutItemType.Widget,e),l=this._findCommonWidgetsInManifest(r),d={id:o,label:this._getPageLabel(o)};let u=[];l.forEach((e=>{u.push({id:e,label:this._getWidgetLabel(e)})})),t&&(u=u.filter((e=>{var i;return null===(i=e.label)||void 0===i?void 0:i.toLowerCase().includes(t.toLowerCase())}))),i.push({pageInfo:d,widgetsInfo:u})})),i}_findCommonWidgetsInManifest(e){const t=this.getWidgetsUseUrlParamsInManifest(),i=Object.keys(t),n=[];return e.forEach((e=>{i.includes(e)&&n.push(e)})),n}_getWidgetLabel(e){const t=s.urlManagerUtils.getAppConfig().widgets.getIn([e]);return(null==t?void 0:t.label)||e}_getPageLabel(e){const t=s.urlManagerUtils.getAppConfig().pages.getIn([e]);return(null==t?void 0:t.label)||e}getWidgetsUrlParamsConfig(e){var t;const i=s.urlManagerUtils.getAppConfig();let n=null===(t=i.urlParams)||void 0===t?void 0:t.getIn(["widgets",e]);return n||(n=s.Immutable.from({isEnable:!0})),{appConfig:i,widgetUrlConfig:n}}_setWidgetUrlConfig(e,t,i,n){var o;i.urlParams||(i=i.setIn(["urlParams"],s.Immutable.from({widgets:{}})));const a=null===(o=i.urlParams)||void 0===o?void 0:o.setIn(["widgets",e],t);this.updateUrlParamsConfig(a)}updateUrlParamsConfig(e){(0,M.getAppConfigAction)().updateUrlParamsConfig(e).exec()}}const L=P;var D=i(3596),j=i(1332),E=i(4981),R=i(4321),U=i(5886),O=i.n(U),k=i(6490),_=i.n(k),B=i(3153),G=i.n(B),W=i(1617),z=i.n(W),F=i(8736),$=i.n(F),N=i(9859),q=i.n(N),H=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function V(e,t,i){let n;return n=e.type===s.PageType.Folder?{svg:G(),properties:{filename:"folder",originalName:"outlined/application/folder.svg",path:["general","folder"],color:"var(--dark-800)",inlineSvg:!0}}:e.type===s.PageType.Link?{svg:_(),properties:{filename:"link",originalName:"outlined/data/link-tilted.svg",path:["general","link"],color:"var(--dark-800)",inlineSvg:!0}}:{svg:O(),properties:{filename:i||(null==t?void 0:t("page"))||"",originalName:"outlined/data/page.svg",color:"var(--dark-800)",inlineSvg:!0}},n}function Q(){return z()}function K(){return $()}function J(e,t){if(!e)return[];const i=[];return Object.keys(e).some((n=>{e[n].autoOpenDialogId===t&&i.push({id:n,label:e[n].label})})),i}let Z=null;function Y(){return Z||(Z=fetch(`${s.moduleLoader.resolveModuleFullPath("widgets/")}/widgets-info.json`).then((e=>H(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>e.filter((e=>{const t=(0,s.getAppStore)().getState().portalUrl;return!e.manifest.notAllowAdd&&(!s.portalUrlUtils.isAGOLDomain(t)||!e.manifest.notSupportAGOL)})).map((e=>{var t,i;e.manifest=s.appConfigUtils.addWidgetManifestProperties(e.manifest);const n=s.i18n.findLocale((0,s.getAppStore)().getState().appContext.locale,e.manifest.translatedLocales);return{itemType:s.LayoutItemType.Widget,name:e.name,label:(null===(t=e.i18nLabel)||void 0===t?void 0:t[n])||e.manifest.label||e.name,description:(null===(i=e.i18nDescription)||void 0===i?void 0:i[n])||e.manifest.desription||e.name,uri:e.uri,manifest:e.manifest,icon:"../"+e.icon,group:e.group,order:e.order}})))).catch((e=>(console.error("Failed to fetch common widget list. ",e),[])))),Z}let X=null;function ee(){if(!oe())return Promise.resolve([]);if(!X){const e='type:"Experience Builder Widget" AND typekeywords:"Widget"';X=s.esri.restPortal.searchItems({q:e,num:100,start:0,authentication:s.SessionManager.getInstance().getSessionByUrl((0,s.getAppStore)().getState().portalUrl)}).then((e=>e.results)).then((e=>{let t=[];return e.forEach(((e,i)=>{if(!e.url)return;const n=function(e){let t;t=/manifest\.json$/.test(e)?e.substring(0,e.length-13):/\/$/.test(e)?e:e+"/";return t=t.replace(/^http:\/\//,"https://"),t}(e.url),o=s.appConfigUtils.getWidgetContext(n),a={itemType:s.LayoutItemType.Widget,name:e.url,label:e.title,itemId:e.id,manifest:{},icon:`${o.folderUrl}icon.svg`,uri:o.folderUrl,group:le,order:i};t=t.concat(a)})),Promise.allSettled(t.map((e=>fetch(`${e.uri}manifest.json`).then((e=>e.json()))))).then((e=>e.map((e=>"fulfilled"===e.status?e.value:null)))).then((e=>t.map(((t,i)=>Object.assign(Object.assign({},t),{manifest:e[i]||{defaultSize:{width:400,height:400}}})))))})).catch((e=>(console.error("Failed to fetch custom widget list. ",e),[])))}return X}function te(e,t){if(!e||!t)return"";switch(e){case 1:return t.formatMessage({id:"mapCentric",defaultMessage:R.defaultMessages.mapCentric});case 2:return t.formatMessage({id:"dataCentric",defaultMessage:R.defaultMessages.dataCentric});case 3:return t.formatMessage({id:"pageElements",defaultMessage:R.defaultMessages.pageElements});case 4:return t.formatMessage({id:"menuAndTollbars",defaultMessage:R.defaultMessages.menuAndTollbars});case 8:return t.formatMessage({id:"layout",defaultMessage:s.defaultMessages.layout});case 9:return t.formatMessage({id:"section",defaultMessage:s.defaultMessages.section});case 10:return t.formatMessage({id:"locationReferencing",defaultMessage:s.defaultMessages.locationReferencing});case le:return t.formatMessage({id:"custom",defaultMessage:R.defaultMessages.custom});default:return""}}function ie(e){return{itemType:s.LayoutItemType.Section,label:null==e?void 0:e.formatMessage({id:"section",defaultMessage:s.defaultMessages.section}),uri:"",manifest:{properties:{},defaultSize:{width:500,height:500}},icon:$(),name:"section",group:9,order:900}}function ne(e){return{itemType:s.LayoutItemType.Widget,label:null==e?void 0:e.formatMessage({id:"placeholder",defaultMessage:R.defaultMessages.placeholder}),uri:null,manifest:{defaultSize:{width:300,height:300}},icon:q(),name:"placeholder",group:8,order:899}}function oe(){var e,t;return null===(t=null===(e=(0,s.getAppStore)().getState().appContext)||void 0===e?void 0:e.jimuConfig)||void 0===t?void 0:t.isInPortal}function se(e){return oe()||(null==e?void 0:e.some((e=>e.group===le)))}function ae(e,t=!1){const i=(0,s.getAppStore)().getState().queryObject;let n=`${window.jimuConfig.mountPath}builder/?id=${e}`;return i.locale&&(n=s.urlUtils.appendQueryParam(n,"locale",i.locale)),i.__env__&&(n=s.urlUtils.appendQueryParam(n,"__env__",i.__env__)),t&&(n=s.urlUtils.appendQueryParam(n,"mode","express")),n}function re(e,t){const i=(0,s.getAppStore)().getState().queryObject;let n=`${window.jimuConfig.mountPath}`;return i.locale&&(n=s.urlUtils.appendQueryParam(n,"locale",i.locale)),i.__env__&&(n=s.urlUtils.appendQueryParam(n,"__env__",i.__env__)),e&&(n=s.urlUtils.appendQueryParam(n,"express","true")),t&&(n=s.urlUtils.appendQueryParam(n,"views",t)),n}const le=7;var de=i(3634),ue=i(8249),ce=i(7659);class pe extends s.React.PureComponent{constructor(){super(...arguments),this.isSupportKeyboard=()=>{let e=!1;return window.jimuConfig.isBuilder&&"home"!==this.props.currentPageId&&"template"!==this.props.currentPageId?(e=!0,e):e},this.switchAppMode=()=>{var e,t;(null===(t=null===(e=(0,s.getAppStore)().getState().appStateInBuilder)||void 0===e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode)===s.AppMode.Run?D.publishAppModeChangeToApp(s.AppMode.Design):D.publishAppModeChangeToApp(s.AppMode.Run)},this.undo=()=>{this.props.stateHistory.past.length<=1||(0,s.getAppStore)().dispatch(A.yx.InBuilderAppConfigUndo())},this.redo=()=>{this.props.stateHistory.future.length<=0||(0,s.getAppStore)().dispatch(A.yx.InBuilderAppConfigRedo())},this.onKeyboardTrigger=e=>{e.key.includes("-manual")||D.publishKeyboardToApp(e)},this.isMac=()=>{var e,t;return"macOS"===(null===(t=null===(e=window.jimuUA)||void 0===e?void 0:e.os)||void 0===t?void 0:t.name)}}render(){return this.isMac()?this.isSupportKeyboard()?s.React.createElement(s.Keyboard,{onKeyboardTrigger:this.onKeyboardTrigger,bindings:{"shift+alt+keyx":()=>{this.switchAppMode()},"command+keyz":()=>{this.undo()},"command+shift+keyz":()=>{this.redo()}}}):null:this.isSupportKeyboard()?s.React.createElement(s.Keyboard,{onKeyboardTrigger:this.onKeyboardTrigger,bindings:{"shift+alt+keyx":()=>{this.switchAppMode()},"ctrl+keyz":()=>{this.undo()},"ctrl+shift+keyz":()=>{this.redo()}}}):null}}const ge=s.ReactRedux.connect((e=>({currentPageId:e.appRuntimeInfo.currentPageId,stateHistory:e.appStateHistory})))(pe),he=e=>{const{messageDataSource:t,actionDataSource:i,connectionType:n,onUseLayersRelationship:o,onSetCustomFields:a}=e,[r,l]=s.React.useState(!1),d=s.hooks.useLatest(n);s.React.useEffect((()=>{if(!t||!i)return;const e=s.dataSourceUtils.getMainOriginDataSource(t),n=s.dataSourceUtils.getMainOriginDataSource(i),o=()=>{d.current===s.MessageActionConnectionType.UseLayersRelationship&&a()};(null==e?void 0:e.createRelatedDataSources)?e.createRelatedDataSources().then(((e=[])=>{e.includes(n)?l(!0):(l(!1),o())})):(l(!1),o())}),[t,i,d,a]),s.React.useEffect((()=>{d.current||(r?o():a())}),[r,d,a,o]);const u=s.hooks.useTranslation(E.A);return r?(0,s.jsx)(s.React.Fragment,null,(0,s.jsx)(R.Label,{className:"justify-content-start",onClick:o},(0,s.jsx)(R.Radio,{className:"mr-2",role:"radio",checked:n===s.MessageActionConnectionType.UseLayersRelationship}),u("frameworkAction_UseRelationship")),(0,s.jsx)(R.Label,{className:"mt-3 justify-content-start",onClick:a},(0,s.jsx)(R.Radio,{className:"mr-2",role:"radio",checked:!n||n===s.MessageActionConnectionType.SetCustomFields}),u("frameworkAction_CustomFields"))):null};var fe=i(1169);const me=(e,t)=>({id:s.appConfigUtils.getUniqueId("messageConfig"),widgetId:t,messageType:e,actions:[]}),ye=(e,t,i,n)=>{let o;e.id,o=e.id?(0,s.getAppStore)().getState().appStateInBuilder?(0,s.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e.id].manifest.version:null:s.version;let a=ve(t,n,i)?null:void 0;if("function"==typeof t.getDefaultMessageActionConfig){const e={widgetId:i,type:n};a=t.getDefaultMessageActionConfig(e)}return{actionId:t.id+"-"+(new Date).getTime().toString(),widgetId:e.id,messageWidgetId:i,actionName:t.name,description:null,config:a,version:o}},ve=(e,t,i)=>!!v.getInstance().getActionSettingComponentUri(e,t,i);function Se(e){const t=[],i=Ie(e),n=null==i?void 0:i.useMapWidgetIds,o={};return(null==n?void 0:n.length)>0&&n.forEach((e=>{if(e){const i=Ie(e),n=null==i?void 0:i.useDataSources;n&&n.forEach((e=>{var i;const n=null===(i=null==e?void 0:e.asMutable)||void 0===i?void 0:i.call(e,{deep:!0});n&&n.dataSourceId&&!o[n.dataSourceId]&&(o[n.dataSourceId]=!0,t.push(n))}))}})),(0,s.Immutable)(t)}function Ie(e){var t;if(!e)return null;const i=we();return null===(t=null==i?void 0:i.widgets)||void 0===t?void 0:t[e]}function we(){var e,t,i;return window.jimuConfig.isBuilder?null===(t=null===(e=(0,s.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig:null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appConfig}var Ce=i(3557),be=i(6117);function Ae(e){var t,i,n;const{widgetId:o,useDataSource:a,messageType:r,arcGISDataSourceTypes:l}=e,d=null===(i=null===(t=(0,s.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===i?void 0:i.appConfig,u=null===(n=null==d?void 0:d.widgets)||void 0===n?void 0:n[o],c=function(e,t){var i,n,o;const a=null===(n=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===n?void 0:n.appConfig,r=null===(o=null==a?void 0:a.widgets)||void 0===o?void 0:o[e],l=[],d=s.DataSourceManager.getInstance(),u=Se(e),c=(null==r?void 0:r.useDataSources)?null==r?void 0:r.useDataSources:u;return null==c||c.forEach((e=>{const i=d.getDataSource(e.dataSourceId);(null==i?void 0:i.type)!==t.WebMap&&(null==i?void 0:i.type)!==t.WebScene||l.push(e.dataSourceId)})),l.length>0?(0,s.Immutable)(l):null}(o,l),p=function(e,t,i){const n=(null==e?void 0:e.outputDataSources)||[],o=(null==e?void 0:e.useDataSources)||[];if(i)return!1;switch(t){case s.MessageCarryData.OutputDataSource:return 1===(null==n?void 0:n.length);case s.MessageCarryData.UseDataSource:return 1===(null==o?void 0:o.length);case s.MessageCarryData.BothDataSource:return 1===n.length+o.length}}(u,Me(o,r),c),g=a&&a.dataSourceId?(0,s.Immutable)([a.asMutable({deep:!0})]):null,h=c?null:function(e,t){var i;const n=xe(e,t);return(0,s.Immutable)(null!==(i=null==n?void 0:n.map((e=>null==e?void 0:e.mainDataSourceId)))&&void 0!==i?i:[])}(o,r);return{isReadOnly:p,useDataSources:g,fromRootDsIds:c,fromDsIds:h}}function xe(e,t){var i,n,o;const a=Se(e),r=Me(e,t),l=null===(n=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===n?void 0:n.appConfig,d=null===(o=null==l?void 0:l.widgets)||void 0===o?void 0:o[e];let u=(null==d?void 0:d.useDataSources)?null==d?void 0:d.useDataSources:a;u=u||(0,s.Immutable)([]);const c=function(e){var t;const i=null!==(t=null==e?void 0:e.map((e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}))))&&void 0!==t?t:[];return(0,s.Immutable)(i)}(null==d?void 0:d.outputDataSources)||(0,s.Immutable)([]),p=null==u?void 0:u.asMutable({deep:!0}).concat(null==c?void 0:c.asMutable({deep:!0}));switch(r){case s.MessageCarryData.OutputDataSource:return c;case s.MessageCarryData.UseDataSource:return u;case s.MessageCarryData.BothDataSource:return(0,s.Immutable)(p)}}function Me(e,t){const i=Te(e,t);return i||s.MessageCarryData.UseDataSource}function Te(e,t){var i,n,o,a;const r=null===(n=null===(i=(0,s.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===n?void 0:n.appConfig,l=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[e],d=null===(a=null==l?void 0:l.manifest)||void 0===a?void 0:a.publishMessages;let u=null;return d.forEach((e=>{const i=e;(null==i?void 0:i.messageCarryData)&&(null==i?void 0:i.messageType)===t&&(u=null==i?void 0:i.messageCarryData)})),u}function Pe(e){var t,i,n,o,a,r,l,d,u,c,p,g,h,f,m,y,v,S;const{widgetId:I,oldUseDataSource:w,messageType:C,arcGISDataSourceTypes:b}=e,A=(0,s.getAppStore)().getState().appStateInBuilder.appConfig,x=s.DataSourceManager.getInstance(),M=A.widgets[I],T=Se(I),P=(null==M?void 0:M.useDataSources)?null==M?void 0:M.useDataSources:T;let L=null,D=!1;const j=null===(i=null===(t=x.getDataSource(w.dataSourceId))||void 0===t?void 0:t.getDataSourceJson())||void 0===i?void 0:i.isOutputFromWidget,E=xe(I,C),R=(null==E?void 0:E[0])&&(null===(n=null==E?void 0:E[0])||void 0===n?void 0:n.dataSourceId);if(!R)return null;const U=null===(o=x.getDataSource(R))||void 0===o?void 0:o.getDataSourceJson();if(!U||U.type!==b.WebMap&&U.type!==b.WebScene||(D=!0),D){let e=!1;if(M&&P)for(let t=0;t<P.length;t++)if(P[t].dataSourceId===w.rootDataSourceId){e=!0;break}L=e?w:null}else{let e=!1;if(E)for(let t=0;t<(null==E?void 0:E.length);t++){const i=j?null===(r=null===(a=x.getDataSource(w.dataSourceId))||void 0===a?void 0:a.getMainDataSource())||void 0===r?void 0:r.id:w.dataSourceId,n=j?null===(u=null===(d=x.getDataSource(null===(l=null==E?void 0:E[t])||void 0===l?void 0:l.dataSourceId))||void 0===d?void 0:d.getMainDataSource())||void 0===u?void 0:u.id:null===(c=null==E?void 0:E[t])||void 0===c?void 0:c.mainDataSourceId;let o=(j?null===(h=null===(g=x.getDataSource(null===(p=null==E?void 0:E[t])||void 0===p?void 0:p.dataSourceId))||void 0===g?void 0:g.getMainDataSource())||void 0===h?void 0:h.id:null===(f=null==E?void 0:E[t])||void 0===f?void 0:f.dataSourceId)===i;if(C===s.MessageType.DataRecordsSelectionChange&&(o=i===n),o){e=!0;break}}L=e?w:1===(null==E?void 0:E.length)?(0,s.Immutable)({dataSourceId:null===(m=null==E?void 0:E[0])||void 0===m?void 0:m.dataSourceId,mainDataSourceId:null===(y=null==E?void 0:E[0])||void 0===y?void 0:y.mainDataSourceId,dataViewId:null===(v=null==E?void 0:E[0])||void 0===v?void 0:v.dataViewId,rootDataSourceId:null===(S=null==E?void 0:E[0])||void 0===S?void 0:S.rootDataSourceId}):null}return L}function Le(e){return!(!e.messageUseDataSource||!e.actionUseDataSource)&&!(e.messageUseDataSource.mainDataSourceId!==e.actionUseDataSource.mainDataSourceId||!function(e){return!e.messageUseDataSource.rootDataSourceId&&!e.actionUseDataSource.rootDataSourceId||e.messageUseDataSource.rootDataSourceId===e.actionUseDataSource.rootDataSourceId}(e))}function De(e){let t;return t=Array.isArray(e)?Ue(e):Re(e),t}function je(e,t){var i,n,o;const a=s.DataSourceManager.getInstance();if(t){const s=null==t?void 0:t.dataSourceId,r=null==t?void 0:t.rootDataSourceId,l=(null===(i=a.getDataSource(s))||void 0===i?void 0:i.getDataSourceJson())||(null===(n=a.getDataSource(r))||void 0===n?void 0:n.getDataSourceJson()),d=(null===(o=null==e?void 0:e.filter((e=>e.dataSourceId===s)))||void 0===o?void 0:o.length)>0;return l&&d?t:null}return null}function Ee(e,t){let i=!1,n=e,o=null==e?void 0:e.actionUseDataSource;return o&&(o=je(t,o),o||(i=!0,n=n.set("actionUseDataSource",null))),{isConfigChange:i,newActionConfig:n}}const Re=e=>{var t;const i=null==e?void 0:e.asMutable({deep:!0});let n=[];const o=null==i?void 0:i.actionUseDataSource,a=null==i?void 0:i.messageUseDataSource;if(a&&n.push(a),o){const e=(null==i?void 0:i.sqlExprObj)||null,r=(0,be.getJimuFieldNamesBySqlExpression)((0,s.Immutable)(e))||[],l=(null==o?void 0:o.fields)||[];let d=(0,s.Immutable)(o).set("fields",Array.from(new Set(l.concat(r))));(null==a?void 0:a.dataSourceId)===o.dataSourceId&&(n=[],(null===(t=null==a?void 0:a.fields)||void 0===t?void 0:t.length)>0&&(d=d.set("fields",Array.from(new Set(d.fields.concat(a.fields)))))),n.push(null==d?void 0:d.asMutable({deep:!0}))}return n},Ue=e=>{const t=null==e?void 0:e.asMutable({deep:!0}),i={};return t.forEach((e=>{Re((0,s.Immutable)(e)).forEach((e=>{if(null==i?void 0:i[e.dataSourceId]){let t=i[e.dataSourceId].fields||[];t=t.concat((null==e?void 0:e.fields)||[]),t=Array.from(new Set(t)),i[e.dataSourceId].fields=t}else i[e.dataSourceId]=e}))})),Object.keys(i).map((e=>i[e]))};var Oe=i(5037),ke=i.n(Oe),_e=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const Be=e=>{const t=window.SVG,{className:i}=e,n=_e(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:ke()},n)):s.React.createElement("svg",Object.assign({className:o},n))};class Ge extends s.React.PureComponent{constructor(e){super(e),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.getInitConfig=()=>{var e,t,i,n,o;const{messageWidgetId:a,messageType:r,config:l}=this.props,d=s.DataSourceManager.getInstance();let u=null,c=!0;const p=this.getMessageUseDataSource();if(p)u=Pe({widgetId:a,oldUseDataSource:p,messageType:r,arcGISDataSourceTypes:this.state.ArcGISDataSourceTypes});else{const l=xe(a,r);if((null==l?void 0:l[0])&&1===(null==l?void 0:l.length)){const a=null===(e=d.getDataSource(null==l?void 0:l[0].dataSourceId))||void 0===e?void 0:e.getDataSourceJson();u=!a||a.type!==this.state.ArcGISDataSourceTypes.WebMap&&a.type!==this.state.ArcGISDataSourceTypes.WebScene?(0,s.Immutable)({dataSourceId:null===(t=null==l?void 0:l[0])||void 0===t?void 0:t.dataSourceId,mainDataSourceId:null===(i=null==l?void 0:l[0])||void 0===i?void 0:i.mainDataSourceId,dataViewId:null===(n=null==l?void 0:l[0])||void 0===n?void 0:n.dataViewId,rootDataSourceId:null===(o=null==l?void 0:l[0])||void 0===o?void 0:o.rootDataSourceId}):null}}if(void 0!==(null==l?void 0:l.enableQueryWithCurrentExtent)&&(c=this.props.config.enableQueryWithCurrentExtent),r===s.MessageType.ExtentChange){if(Array.isArray(l))return null==l?void 0:l.map((e=>this.getInitActionConfigItem(u,c,e)));return[l?this.getInitActionConfigItem(u,c,l):this.getInitActionConfigItem(u,c,null)]}return this.getInitActionConfigItem(u,c,l)},this.getInitActionConfigItem=(e,t,i)=>{const{useDataSources:n}=this.props,o=je(n,null==i?void 0:i.actionUseDataSource);return{messageUseDataSource:e,actionUseDataSource:o,sqlExprObj:(null==o?void 0:o.dataSourceId)?i.sqlExprObj:null,enableQueryWithCurrentExtent:t}},this.onSettingChange=e=>{const t=De(e);this.props.onSettingChange({actionId:this.props.actionId,config:e,useDataSources:t})},this.handleTriggerLayerChange=e=>{let t=this.props.config;Array.isArray(t)?t=null==t?void 0:t.map((t=>t=t.set("messageUseDataSource",(null==e?void 0:e[0])||null))):(t=t.set("messageUseDataSource",(null==e?void 0:e[0])||null),0===e.length&&(t=t.set("connectionType",null))),this.onSettingChange(t)},this.handleActionLayerChange=e=>{let t=this.props.config;if(Array.isArray(t)){const i={messageUseDataSource:this.getMessageUseDataSource(),actionUseDataSource:null,sqlExprObj:null,enableQueryWithCurrentExtent:!0,enabledDataRelationShip:!0};if(0===(null==e?void 0:e.length))t=(0,s.Immutable)([i]);else{const n=null==e?void 0:e.map((e=>Object.assign(Object.assign({},i),{actionUseDataSource:e})));t=(0,s.Immutable)(n)}}else t=t.set("actionUseDataSource",(null==e?void 0:e[0])||null).set("sqlExprObj",null),0===e.length&&(t=t.set("connectionType",null));this.onSettingChange(t)},this.showSqlExprPopup=()=>{this.setState({isSqlExprShow:!0})},this.toggleSqlExprPopup=()=>{this.setState({isSqlExprShow:!this.state.isSqlExprShow})},this.onSqlExprBuilderChange=e=>{this.handleActionConditionsChange("sqlExprObj",e)},this.handleActionConditionsChange=(e,t)=>{const{config:i}=this.props;let n=i;if(Array.isArray(i)&&1===(null==i?void 0:i.length)){const i=n[0].set(e,t);n=(0,s.Immutable)([i])}else n=i.set(e,t);this.onSettingChange(n)},this.onMessageFieldSelected=(e,t)=>{const{config:i}=this.props,n=i.set("messageUseDataSource",{dataSourceId:i.messageUseDataSource.dataSourceId,mainDataSourceId:i.messageUseDataSource.mainDataSourceId,dataViewId:i.messageUseDataSource.dataViewId,rootDataSourceId:i.messageUseDataSource.rootDataSourceId,fields:e.map((e=>e.jimuName))});this.onSettingChange(n)},this.onActionFieldSelected=(e,t)=>{const{config:i}=this.props,n=i.set("actionUseDataSource",{dataSourceId:i.actionUseDataSource.dataSourceId,mainDataSourceId:i.actionUseDataSource.mainDataSourceId,dataViewId:i.actionUseDataSource.dataViewId,rootDataSourceId:i.actionUseDataSource.rootDataSourceId,fields:e.map((e=>e.jimuName))});this.onSettingChange(n)},this.switchEnabledDataRelationShip=e=>{this.onSettingChange(this.props.config.set("enabledDataRelationShip",e))},this.switchEnabledQueryWithCurrentExtent=e=>{this.handleActionConditionsChange("enableQueryWithCurrentExtent",e)},this.checkIsDisableDataView=e=>{var t,i,n,o;if(this.props.messageType===s.MessageType.DataRecordsSelectionChange)return!0;const a=null===(i=null===(t=(0,s.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===i?void 0:i.appConfig,r=null===(n=null==a?void 0:a.widgets)||void 0===n?void 0:n[e];if(r){return"Map"===(null===(o=null==r?void 0:r.manifest)||void 0===o?void 0:o.label)}return!1},this.onUseLayersRelationship=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",s.MessageActionConnectionType.UseLayersRelationship);this.onSettingChange(e)},this.onSetCustomFields=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",s.MessageActionConnectionType.SetCustomFields);this.onSettingChange(e)},this.checkIsShowFrameworkActionConditions=()=>{var e;return!(window.isExpressBuilder||!(null===(e=this.props.config)||void 0===e?void 0:e.actionUseDataSource)||!this.props.config.messageUseDataSource||Array.isArray(this.props.config))},this.getMessageUseDataSource=()=>{var e;const{config:t}=this.props;return Array.isArray(t)?null===(e=t[0])||void 0===e?void 0:e.messageUseDataSource:null==t?void 0:t.messageUseDataSource},this.checkIsNotRenderActionSetting=()=>{const{Button:e,Icon:t,Switch:i,Collapse:n,SettingSection:o,SettingRow:s,FieldSelector:a,DataSourceSelector:r,ArcGISDataSourceTypes:l,SqlExpressionBuilderPopup:d}=this.state;return!(e&&t&&i&&n&&o&&s&&a&&r&&l&&d)},this.renderFrameworkActionConditions=()=>{var e,t;const{Button:i,Switch:n,Collapse:o,SettingSection:a,SettingRow:r,FieldSelector:l,SqlExpressionBuilderPopup:d}=this.state,{config:u,theme:c}=this.props,p=u.messageUseDataSource&&s.DataSourceManager.getInstance().getDataSource(this.props.config.messageUseDataSource.dataSourceId),g=u.actionUseDataSource&&s.DataSourceManager.getInstance().getDataSource(u.actionUseDataSource.dataSourceId),h=Le(u),f=!u.connectionType||u.connectionType===s.MessageActionConnectionType.SetCustomFields;return(0,s.jsx)(a,{title:this.props.intl.formatMessage({id:"frameworkAction_Conditions",defaultMessage:E.A.frameworkAction_Conditions})},(0,s.jsx)(r,{label:this.props.intl.formatMessage({id:"frameworkAction_RelateMessage",defaultMessage:E.A.frameworkAction_RelateMessage})},(0,s.jsx)(n,{checked:this.props.config.enabledDataRelationShip,onChange:e=>{this.switchEnabledDataRelationShip(e.target.checked)}})),(0,s.jsx)(r,null,(0,s.jsx)(o,{isOpen:this.props.config.enabledDataRelationShip,className:"w-100"},(0,s.jsx)(he,{messageDataSource:p,actionDataSource:g,connectionType:u.connectionType,onUseLayersRelationship:this.onUseLayersRelationship,onSetCustomFields:this.onSetCustomFields}),h&&(0,s.jsx)("div",{className:"w-100 border p-1 mr-2"},this.props.intl.formatMessage({id:"frameworkAction_AutoBind",defaultMessage:E.A.frameworkAction_AutoBind})),!h&&f&&(0,s.jsx)("div",{className:"w-100 d-flex align-items-center mt-3"},(0,s.jsx)("div",{className:"d-flex flex-column relate-panel-left"},(0,s.jsx)(l,{className:"w-100",useDataSources:(0,s.Immutable)([null===(e=this.props.config.messageUseDataSource)||void 0===e?void 0:e.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,placeholder:this.props.intl.formatMessage({id:"frameworkAction_TriggerLayerField",defaultMessage:E.A.frameworkAction_TriggerLayerField}),onChange:this.onMessageFieldSelected,useDropdown:!0,selectedFields:this.props.config.messageUseDataSource&&this.props.config.messageUseDataSource.fields?this.props.config.messageUseDataSource.fields:(0,s.Immutable)([])}),(0,s.jsx)(l,{className:"w-100 action-select-chooser",placeholder:this.props.intl.formatMessage({id:"frameworkAction_ActionLayerField",defaultMessage:E.A.frameworkAction_ActionLayerField}),useDataSources:(0,s.Immutable)([null===(t=this.props.config.actionUseDataSource)||void 0===t?void 0:t.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,onChange:this.onActionFieldSelected,useDropdown:!0,selectedFields:this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.fields?this.props.config.actionUseDataSource.fields:(0,s.Immutable)([])})),(0,s.jsx)(Be,{autoFlip:!0,className:"flex-none",width:12,height:40,color:c.ref.palette.neutral[900]})))),(0,s.jsx)(r,null,(0,s.jsx)(i,{type:"link",disabled:!this.props.config.actionUseDataSource,className:"w-100 d-flex justify-content-start",onClick:this.showSqlExprPopup},(0,s.jsx)("div",{className:"w-100 text-truncate",style:{textAlign:"start"}},this.props.intl.formatMessage({id:"frameworkAction_MoreConditions",defaultMessage:E.A.frameworkAction_MoreConditions}))),this.props.config.actionUseDataSource&&(0,s.jsx)(s.DataSourceComponent,{useDataSource:this.props.config.actionUseDataSource},(e=>(0,s.jsx)(d,{dataSource:e,mode:s.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:this.props.config.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)},id:"filter-widget-sql-expression-builder-popup"})))),(0,s.jsx)(r,null,(0,s.jsx)("div",{className:"sql-expr-display"},this.props.config.sqlExprObj&&g?s.dataSourceUtils.getArcGISSQL(this.props.config.sqlExprObj,g).displaySQL:this.props.intl.formatMessage({id:"frameworkAction_SetExpression",defaultMessage:E.A.frameworkAction_SetExpression}))))},this.renderFrameworkConditionsWhenQueryByExtent=()=>{const{Button:e,Switch:t,SettingSection:i,SettingRow:n,SqlExpressionBuilderPopup:o}=this.state,a=this.props.config;let r,l;Array.isArray(a)?(r=null==a?void 0:a[0],l=a.length>1||r.enableQueryWithCurrentExtent):(r=a,l=r.enableQueryWithCurrentExtent);const d=r.actionUseDataSource&&s.DataSourceManager.getInstance().getDataSource(r.actionUseDataSource.dataSourceId);return(0,s.jsx)(i,{title:this.props.intl.formatMessage({id:"frameworkAction_Conditions",defaultMessage:E.A.frameworkAction_Conditions})},(0,s.jsx)(n,{label:this.props.intl.formatMessage({id:"frameworkAction_QueryByExtent",defaultMessage:E.A.frameworkAction_QueryByExtent})},(0,s.jsx)(t,{checked:l,onChange:e=>{this.switchEnabledQueryWithCurrentExtent(e.target.checked)}})),(0,s.jsx)(n,null,(0,s.jsx)(e,{className:"p-0 text-left",type:"link",disabled:!r.actionUseDataSource,onClick:this.showSqlExprPopup,title:this.props.intl.formatMessage({id:"frameworkAction_MoreConditions",defaultMessage:E.A.frameworkAction_MoreConditions})},this.props.intl.formatMessage({id:"frameworkAction_MoreConditions",defaultMessage:E.A.frameworkAction_MoreConditions}))),(0,s.jsx)(n,null,r.actionUseDataSource&&(0,s.jsx)(s.DataSourceComponent,{useDataSource:r.actionUseDataSource},(e=>(0,s.jsx)(o,{dataSource:e,mode:s.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:r.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)},id:"filter-widget-sql-expression-builder-popup"}))),(0,s.jsx)("div",{className:"sql-expr-display body-1"},r.sqlExprObj&&d?s.dataSourceUtils.getArcGISSQL(r.sqlExprObj,d).displaySQL:this.props.intl.formatMessage({id:"frameworkAction_SetExpression",defaultMessage:E.A.frameworkAction_SetExpression}))))},this.getActionbactionUseDataSource=()=>{const{config:e}=this.props,t=[];return Array.isArray(e)?e.forEach((e=>{(null==e?void 0:e.actionUseDataSource)&&t.push(null==e?void 0:e.actionUseDataSource)})):(null==e?void 0:e.actionUseDataSource)&&t.push(null==e?void 0:e.actionUseDataSource),t},this.checkIsShowConditions=()=>{let e;return e=!Array.isArray(this.props.config)||1===this.props.config.length,!window.isExpressBuilder&&e},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1,currentLayerType:null,isSqlExprShow:!1}}componentDidMount(){s.moduleLoader.loadModules(["jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-arcgis","jimu-ui/advanced/sql-expression-builder"]).then((e=>{this.setState({Button:e[0].Button,Icon:e[0].Icon,Switch:e[0].Switch,Collapse:e[0].Collapse,SettingSection:e[1].SettingSection,SettingRow:e[1].SettingRow,FieldSelector:e[2].FieldSelector,DataSourceSelector:e[2].DataSourceSelector,ArcGISDataSourceTypes:e[3].ArcGISDataSourceTypes,SqlExpressionBuilderPopup:e[4].SqlExpressionBuilderPopup,DSSelectorTypes:(0,s.Immutable)([s.AllDataSourceTypes.FeatureLayer,s.AllDataSourceTypes.SceneLayer,s.AllDataSourceTypes.OrientedImageryLayer,s.AllDataSourceTypes.ImageryLayer,s.AllDataSourceTypes.BuildingComponentSubLayer,s.AllDataSourceTypes.SubtypeGroupLayer,s.AllDataSourceTypes.SubtypeSublayer])},(()=>{let e=this.getInitConfig(),t=this.props.config;t=this.props.messageType===s.MessageType.ExtentChange?(0,s.Immutable)(e):t.set("messageUseDataSource",e.messageUseDataSource).set("actionUseDataSource",e.actionUseDataSource).set("sqlExprObj",e.sqlExprObj),this.onSettingChange(t)}))}))}componentDidUpdate(e,t){const{useDataSources:i,config:n}=this.props;if(e.config&&n){const e=function(e,t){let i=!1,n=e;if(Array.isArray(e))n=e.map((e=>{const n=Ee(e,t);return n.isConfigChange?(i=!0,n.newActionConfig):e}));else{const o=Ee(e,t);o.isConfigChange&&(i=!0,n=o.newActionConfig)}return{isConfigChange:i,newActionConfig:n}}(n,i);(null==e?void 0:e.isConfigChange)&&this.onSettingChange(e.newActionConfig)}}getStyle(e){return s.css`
      .setting-header {
        padding: ${s.polished.rem(10)} ${s.polished.rem(16)} ${s.polished.rem(0)} ${s.polished.rem(16)}
      }
      .jimu-collapse {
        flex: 1;
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }

      .sql-expr-display {
        width: 100%;
        height: auto;
        min-height: 60px;
        line-height: 25px;
        padding: 3px 5px;
        color: ${e.ref.palette.neutral[900]};
        border: 1px solid ${e.ref.palette.neutral[500]};
      }

      .relate-panel-left {
        flex: auto;
        overflow: hidden;
        .action-select-chooser {
          margin-top: ${s.polished.rem(12)};
        }
      }
    `}render(){const{SettingSection:e,DataSourceSelector:t,ArcGISDataSourceTypes:i}=this.state,{messageWidgetId:n,messageType:o}=this.props;if(this.checkIsNotRenderActionSetting())return null;const a=Ae({widgetId:n,useDataSource:this.getMessageUseDataSource(),messageType:o,arcGISDataSourceTypes:i}),r=this.getActionbactionUseDataSource();return this.props.messageType===s.MessageType.ExtentChange?(0,s.jsx)("div",{css:this.getStyle(this.props.theme)},(0,s.jsx)(e,{title:this.props.intl.formatMessage({id:"frameworkAction_ActionLayer",defaultMessage:E.A.frameworkAction_ActionLayer})},(0,s.jsx)(t,{isMultiple:!0,types:this.state.DSSelectorTypes,useDataSources:(0,s.Immutable)(r),hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,enableToSelectOutputDsFromSelf:!0})),this.checkIsShowConditions()&&this.renderFrameworkConditionsWhenQueryByExtent()):(0,s.jsx)("div",{css:this.getStyle(this.props.theme)},(0,s.jsx)(e,{title:this.props.intl.formatMessage({id:"messageAction_TriggerData",defaultMessage:s.defaultMessages.messageAction_TriggerData})},(0,s.jsx)(t,{types:this.state.DSSelectorTypes,useDataSources:a.useDataSources,fromRootDsIds:a.fromRootDsIds,fromDsIds:a.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:()=>a.isReadOnly,disableDataSourceList:a.isReadOnly,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,disableDataView:!0,hideDataView:this.checkIsDisableDataView(this.props.messageWidgetId),enableToSelectOutputDsFromSelf:!0})),(0,s.jsx)(e,{title:this.props.intl.formatMessage({id:"frameworkAction_ActionLayer",defaultMessage:E.A.frameworkAction_ActionLayer})},(0,s.jsx)(t,{isMultiple:Array.isArray(this.props.config),types:this.state.DSSelectorTypes,useDataSources:(0,s.Immutable)(r),closeDataSourceListOnChange:!0,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,enableToSelectOutputDsFromSelf:!0})),this.checkIsShowFrameworkActionConditions()&&this.renderFrameworkActionConditions())}}Ge.defaultProps={config:(0,s.Immutable)({messageUseDataSource:null,actionUseDataSource:null,sqlExprObj:null,enabledDataRelationShip:!0,enableQueryWithCurrentExtent:!0})};const We=s.ReactRedux.connect((e=>({dataSources:e.appStateInBuilder&&e.appStateInBuilder.appConfig&&e.appStateInBuilder.appConfig.dataSources,dataSourcesInfo:e.appStateInBuilder&&e.appStateInBuilder.dataSourcesInfo})))((0,d.withTheme)(Ge));class ze extends s.React.PureComponent{constructor(e){super(e),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.getInitConfig=()=>{var e,t,i,n,o;const{messageWidgetId:a,messageType:r,config:l,useDataSources:d}=this.props,u=s.DataSourceManager.getInstance();let c=null;const p=je(d,null==l?void 0:l.actionUseDataSource);if(this.props.config.messageUseDataSource)c=Pe({widgetId:a,oldUseDataSource:this.props.config.messageUseDataSource,messageType:r,arcGISDataSourceTypes:this.state.ArcGISDataSourceTypes});else{const l=xe(a,r);if((null==l?void 0:l[0])&&1===(null==l?void 0:l.length)){const a=null===(e=u.getDataSource(null==l?void 0:l[0].dataSourceId))||void 0===e?void 0:e.getDataSourceJson();c=!a||a.type!==this.state.ArcGISDataSourceTypes.WebMap&&a.type!==this.state.ArcGISDataSourceTypes.WebScene?(0,s.Immutable)({dataSourceId:null===(t=null==l?void 0:l[0])||void 0===t?void 0:t.dataSourceId,mainDataSourceId:null===(i=null==l?void 0:l[0])||void 0===i?void 0:i.mainDataSourceId,dataViewId:null===(n=null==l?void 0:l[0])||void 0===n?void 0:n.dataViewId,rootDataSourceId:null===(o=null==l?void 0:l[0])||void 0===o?void 0:o.rootDataSourceId}):null}}return p&&p.dataSourceId?{messageUseDataSource:c,actionUseDataSource:p,sqlExprObj:this.props.config.sqlExprObj}:{messageUseDataSource:c,actionUseDataSource:p,sqlExprObj:null}},this.onSettingChange=e=>{const t=De(e);this.props.onSettingChange({actionId:this.props.actionId,config:e,useDataSources:t})},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e[0]):this.handleRemoveLayerForTriggerLayer()},this.handleActionLayerChange=e=>{e&&e.length>0?this.handleActionLayerSelected(e[0]):this.handleRemoveLayerForActionLayer()},this.handleTriggerLayerSelected=e=>{const t=this.props.config.set("messageUseDataSource",e);this.onSettingChange(t)},this.handleActionLayerSelected=e=>{const t=this.props.config.set("actionUseDataSource",e).set("sqlExprObj",null);this.onSettingChange(t)},this.handleRemoveLayerForTriggerLayer=()=>{const e=this.props.config.set("messageUseDataSource",null).set("connectionType",null);this.onSettingChange(e)},this.handleRemoveLayerForActionLayer=()=>{const e=this.props.config.set("actionUseDataSource",null).set("sqlExprObj",null).set("connectionType",null);this.onSettingChange(e)},this.showSqlExprPopup=()=>{this.setState({isSqlExprShow:!0})},this.toggleSqlExprPopup=()=>{this.setState({isSqlExprShow:!this.state.isSqlExprShow})},this.onSqlExprBuilderChange=e=>{const t=this.props.config.set("sqlExprObj",e);this.onSettingChange(t)},this.onMessageFieldSelected=(e,t)=>{const{config:i}=this.props,n=i.set("messageUseDataSource",{dataSourceId:i.messageUseDataSource.dataSourceId,mainDataSourceId:i.messageUseDataSource.mainDataSourceId,dataViewId:i.messageUseDataSource.dataViewId,rootDataSourceId:i.messageUseDataSource.rootDataSourceId,fields:e.map((e=>e.jimuName))});this.onSettingChange(n)},this.onActionFieldSelected=(e,t)=>{const{config:i}=this.props,n=i.set("actionUseDataSource",{dataSourceId:i.actionUseDataSource.dataSourceId,mainDataSourceId:i.actionUseDataSource.mainDataSourceId,dataViewId:i.actionUseDataSource.dataViewId,rootDataSourceId:i.actionUseDataSource.rootDataSourceId,fields:e.map((e=>e.jimuName))});this.onSettingChange(n)},this.switchEnabledDataRelationShip=e=>{const t=this.props.config.set("enabledDataRelationShip",e);this.onSettingChange(t)},this.onUseLayersRelationship=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",s.MessageActionConnectionType.UseLayersRelationship);this.onSettingChange(e)},this.onSetCustomFields=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",s.MessageActionConnectionType.SetCustomFields);this.onSettingChange(e)},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1,currentLayerType:null,isSqlExprShow:!1}}componentDidMount(){s.moduleLoader.loadModules(["jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-arcgis","jimu-ui/advanced/sql-expression-builder"]).then((e=>{this.setState({Button:e[0].Button,Icon:e[0].Icon,Switch:e[0].Switch,Collapse:e[0].Collapse,SettingSection:e[1].SettingSection,SettingRow:e[1].SettingRow,FieldSelector:e[2].FieldSelector,DataSourceSelector:e[2].DataSourceSelector,ArcGISDataSourceTypes:e[3].ArcGISDataSourceTypes,SqlExpressionBuilderPopup:e[4].SqlExpressionBuilderPopup,DSSelectorTypes:(0,s.Immutable)([s.AllDataSourceTypes.FeatureLayer,s.AllDataSourceTypes.SceneLayer,s.AllDataSourceTypes.OrientedImageryLayer,s.AllDataSourceTypes.ImageryLayer,s.AllDataSourceTypes.BuildingComponentSubLayer,s.AllDataSourceTypes.SubtypeGroupLayer,s.AllDataSourceTypes.SubtypeSublayer])},(()=>{const e=this.getInitConfig(),t=this.props.config.set("messageUseDataSource",e.messageUseDataSource).set("actionUseDataSource",e.actionUseDataSource).set("sqlExprObj",e.sqlExprObj);this.onSettingChange(t)}))}))}getStyle(e){return s.css`
      .setting-header {
        padding: ${s.polished.rem(10)} ${s.polished.rem(16)} ${s.polished.rem(0)} ${s.polished.rem(16)}
      }
      .jimu-collapse {
        flex: 1;
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }

      .sql-expr-display {
        width: 100%;
        height: auto;
        min-height: 60px;
        line-height: 25px;
        padding: 3px 5px;
        color: ${e.ref.palette.neutral[900]};
        border: 1px solid ${e.ref.palette.neutral[500]};
      }

      .relate-panel-left {
        flex: auto;
        overflow: hidden;
        .action-select-chooser {
          margin-top: ${s.polished.rem(12)};
        }
      }
    `}render(){var e,t;const{Button:i,Icon:n,Switch:o,Collapse:a,SettingSection:r,SettingRow:l,FieldSelector:d,DataSourceSelector:u,ArcGISDataSourceTypes:c,SqlExpressionBuilderPopup:p}=this.state,{messageWidgetId:g,messageType:h,config:f,theme:m}=this.props;if(!(i&&n&&o&&a&&r&&l&&d&&u&&c&&p))return null;const y=Ae({widgetId:g,useDataSource:f.messageUseDataSource,messageType:h,arcGISDataSourceTypes:c}),v=this.props.config.messageUseDataSource&&s.DataSourceManager.getInstance().getDataSource(this.props.config.messageUseDataSource.dataSourceId),S=this.props.config.actionUseDataSource&&s.DataSourceManager.getInstance().getDataSource(this.props.config.actionUseDataSource.dataSourceId),I=Le(f),w=!f.connectionType||f.connectionType===s.MessageActionConnectionType.SetCustomFields;return(0,s.jsx)("div",{css:this.getStyle(this.props.theme)},(0,s.jsx)(r,{title:this.props.intl.formatMessage({id:"messageAction_TriggerData",defaultMessage:s.defaultMessages.messageAction_TriggerData})},(0,s.jsx)(u,{types:this.state.DSSelectorTypes,useDataSources:y.useDataSources,fromRootDsIds:y.fromRootDsIds,fromDsIds:y.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:()=>y.isReadOnly,disableDataSourceList:y.isReadOnly,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,hideDataView:!0,enableToSelectOutputDsFromSelf:!0})),(0,s.jsx)(r,{title:this.props.intl.formatMessage({id:"frameworkAction_ActionLayer",defaultMessage:E.A.frameworkAction_ActionLayer})},(0,s.jsx)(u,{types:this.state.DSSelectorTypes,useDataSources:this.props.config.actionUseDataSource?(0,s.Immutable)([this.props.config.actionUseDataSource]):(0,s.Immutable)([]),closeDataSourceListOnChange:!0,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,hideDataView:!0,enableToSelectOutputDsFromSelf:!0})),this.props.config&&this.props.config.actionUseDataSource&&this.props.config.messageUseDataSource&&(0,s.jsx)(r,{title:this.props.intl.formatMessage({id:"frameworkAction_Conditions",defaultMessage:E.A.frameworkAction_Conditions})},(0,s.jsx)(l,{label:this.props.intl.formatMessage({id:"frameworkAction_RelateMessage",defaultMessage:E.A.frameworkAction_RelateMessage})},(0,s.jsx)(o,{checked:this.props.config.enabledDataRelationShip,onChange:e=>{this.switchEnabledDataRelationShip(e.target.checked)}})),(0,s.jsx)(l,null,(0,s.jsx)(a,{isOpen:this.props.config.enabledDataRelationShip,className:"w-100"},(0,s.jsx)(he,{messageDataSource:v,actionDataSource:S,connectionType:f.connectionType,onUseLayersRelationship:this.onUseLayersRelationship,onSetCustomFields:this.onSetCustomFields}),I&&(0,s.jsx)("div",{className:"w-100 border p-1 mr-2"},this.props.intl.formatMessage({id:"frameworkAction_AutoBind",defaultMessage:E.A.frameworkAction_AutoBind})),!I&&w&&(0,s.jsx)("div",{className:"w-100 d-flex align-items-center mt-3"},(0,s.jsx)("div",{className:"d-flex flex-column relate-panel-left"},(0,s.jsx)(d,{className:"w-100",useDataSources:(0,s.Immutable)([null===(e=this.props.config.messageUseDataSource)||void 0===e?void 0:e.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,placeholder:this.props.intl.formatMessage({id:"frameworkAction_TriggerLayerField",defaultMessage:E.A.frameworkAction_TriggerLayerField}),onChange:this.onMessageFieldSelected,useDropdown:!0,selectedFields:this.props.config.messageUseDataSource&&this.props.config.messageUseDataSource.fields?this.props.config.messageUseDataSource.fields:(0,s.Immutable)([])}),(0,s.jsx)(d,{className:"w-100 action-select-chooser",placeholder:this.props.intl.formatMessage({id:"frameworkAction_ActionLayerField",defaultMessage:E.A.frameworkAction_ActionLayerField}),useDataSources:(0,s.Immutable)([null===(t=this.props.config.actionUseDataSource)||void 0===t?void 0:t.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,onChange:this.onActionFieldSelected,useDropdown:!0,selectedFields:this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.fields?this.props.config.actionUseDataSource.fields:(0,s.Immutable)([])})),(0,s.jsx)(Be,{autoFlip:!0,className:"flex-none",width:12,height:40,color:m.ref.palette.neutral[900]})))),(0,s.jsx)(l,null,(0,s.jsx)(i,{type:"link",disabled:!this.props.config.actionUseDataSource,className:"w-100 d-flex justify-content-start",onClick:this.showSqlExprPopup},(0,s.jsx)("div",{className:"w-100 text-truncate",style:{textAlign:"start"}},this.props.intl.formatMessage({id:"frameworkAction_MoreConditions",defaultMessage:E.A.frameworkAction_MoreConditions}))),this.props.config.actionUseDataSource&&(0,s.jsx)(s.DataSourceComponent,{useDataSource:this.props.config.actionUseDataSource},(e=>(0,s.jsx)(p,{dataSource:e,mode:s.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:this.props.config.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)},id:"filter-widget-sql-expression-builder-popup"})))),(0,s.jsx)(l,null,(0,s.jsx)("div",{className:"sql-expr-display"},this.props.config.sqlExprObj&&S?s.dataSourceUtils.getArcGISSQL(this.props.config.sqlExprObj,S).displaySQL:this.props.intl.formatMessage({id:"frameworkAction_SetExpression",defaultMessage:E.A.frameworkAction_SetExpression})))))}}ze.defaultProps={config:(0,s.Immutable)({messageUseDataSource:null,actionUseDataSource:null,sqlExprObj:null,enabledDataRelationShip:!0})};const Fe=s.ReactRedux.connect((e=>({dataSources:e.appStateInBuilder&&e.appStateInBuilder.appConfig&&e.appStateInBuilder.appConfig.dataSources,dataSourcesInfo:e.appStateInBuilder&&e.appStateInBuilder.dataSourcesInfo})))((0,d.withTheme)(ze));var $e=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function Ne(){return $e(this,void 0,void 0,(function*(){const e=(0,s.getAppStore)().getState().appContext.locale;return yield function(e,t){return $e(this,void 0,void 0,(function*(){return(e=s.i18n.getLocaleToLoad(e,t))?yield s.i18n.loadLocaleMessages("jimu-for-builder/lib/translations",e).then((e=>e)):Promise.resolve(E.A)}))}(e,s.translatedLocales).then((e=>(e&&(0,s.getAppStore)().dispatch(s.appActions.i18nMessagesLoaded("jimu-for-builder",e)),s.i18n.resetIntls(),e)))}))}var qe=i(7740),He=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function Ve(){return He(this,void 0,void 0,(function*(){return v.getInstance().registerActionRawSettingClass("filter-data-record-action",We),v.getInstance().registerActionRawSettingClass("select-data-record-action",Fe),yield Ne(),function(){He(this,void 0,void 0,(function*(){s.GuideManager.getInstance().registerGuide({id:"opening-tour",module:qe.Wy,type:s.GuideTypes.Program,level:s.GuideLevels.Builder}),s.GuideManager.getInstance().registerGuide({id:"express-mode",module:qe.m2,type:s.GuideTypes.Program,level:s.GuideLevels.Builder});(yield(0,ce.getExpressModeTemplateNames)("app")).forEach((e=>{s.GuideManager.getInstance().registerGuide({id:`general-express-mode-${e}`,module:qe._R,type:s.GuideTypes.Program,level:s.GuideLevels.Builder})})),s.GuideManager.getInstance().registerGuide({id:"general-express-mode",module:qe._R,type:s.GuideTypes.Program,level:s.GuideLevels.Builder}),s.GuideManager.getInstance().registerGuide({id:"insert-widget",module:qe.OE,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"ds-selection",module:qe._b,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-welcome-introduction",module:qe.Nf,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-add-data",module:qe.kM,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-app-setting",module:qe.Q,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-general-setting",module:qe.xk,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-map-widget",module:qe.Td,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-message-action",module:qe.w5,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-placeholder",module:qe.EL,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-section",module:qe.M0,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-theme",module:qe.KE,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-title",module:qe.Xn,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-widget-controller",module:qe.xY,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-window",module:qe.n3,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-sidebar",module:qe.pT,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0}),s.GuideManager.getInstance().registerGuide({id:"express-grid",module:qe.xw,type:s.GuideTypes.Program,level:s.GuideLevels.Common,isInjected:!0})}))}(),yield Promise.resolve({})}))}var Qe=i(6764),Ke=i(9298),Je=i(6499),Ze=i.n(Je),Ye=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const Xe=e=>{const t=window.SVG,{className:i}=e,n=Ye(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:Ze()},n)):s.React.createElement("svg",Object.assign({className:o},n))};var et=i(8996),tt=i.n(et),it=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const nt=e=>{const t=window.SVG,{className:i}=e,n=it(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:tt()},n)):s.React.createElement("svg",Object.assign({className:o},n))};var ot=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};const st=s.css`
  width: 360px !important;
  height: auto !important;
  visibility: visible !important;
  background: var(--ref-palette-custom1-300);
  >.floating-header {
    background: var(--ref-palette-custom1-300);
    color: var(--ref-palette-custom2-600);
    height: 55px;
    border-bottom: 1px solid var(--ref-palette-custom1-500);
    >.actions>.jimu-btn {
      color: var(--ref-palette-custom2-600)
    }
  }
  .floating-content {
    padding: 16px 20px 20px;
  }
  .jimu-widget-setting--row >.jimu-widget-setting--row-label {
    margin-bottom: 12px;
  }
  .jimu-multi-select .jimu-dropdown {
    width: 100%;
  }
  .message-container {
    .message-line {
      position: relative;
      padding-left: 24px;
      margin-top: 8px;
      line-height: 26px;
      .donut-loading, .icon {
        position: absolute;
        left: 0;
        top: calc(50% - 8px);
        width: 16px;
        height: 16px;
      }
    }
  }
  .error-msg {
    display: flex;
    font-weight: 500;
    color: var(--sys-color-error-dark)
  }
  .popper-footer {
    display: flex;
    align-items: center;
    justify-content: flex-end;
    >.btn {
      min-width: 100px;
    }
  }
`;var at;!function(e){e.Start="001",e.CopyingCode="002",e.CompilingWidget="003",e.GeneratingZip="004",e.Completed="005",e.Fail="006"}(at||(at={}));const rt=new Map([[at.Start,1],[at.CopyingCode,2],[at.CompilingWidget,3],[at.GeneratingZip,4],[at.Completed,5],[at.Fail,6]]),lt=[{code:at.CopyingCode,key:"copingCode"},{code:at.CompilingWidget,key:"compilingCustomWidgets"},{code:at.GeneratingZip,key:"generateZipFile"}],dt=e=>{const{appId:t,isOpen:i,onClose:n}=e,o=s.hooks.useTranslation(R.defaultMessages),a=s.React.useRef(i),r=s.React.useRef("");s.React.useEffect((()=>{a.current=i}),[i]);const l=()=>{n(),a.current=!1};s.hooks.useUpdateEffect((()=>{i||(p(!1),h(0),u(["en"]),m(-1),r.current="")}),[i]);const[d,u]=s.React.useState(["en"]),[c,p]=s.React.useState(!1),[g,h]=s.React.useState(0),[f,m]=s.React.useState(-1),y=e=>new Promise((t=>{setTimeout((()=>{t()}),e)})),[v,S]=s.React.useState(!1),I=s.ReactRedux.useSelector((e=>e.appContext.isRTL));return(0,s.jsx)(R.Popper,{floating:!0,reference:"body",open:i,placement:"left",css:st,headerTitle:o("download"),dragBounds:"body",disableResize:!0,"data-test":i,onHeaderClose:l,offset:[0,-(document.documentElement.clientWidth/2+180)],toggle:(e,t)=>{"clickOutside"!==t&&l()}},(0,s.jsx)("div",null,(0,s.jsx)(Ke.SettingRow,{label:(0,s.jsx)("span",null,o("selectRequiredLanguage")),flow:"wrap"},(0,s.jsx)(R.MultiSelect,{className:"w-100",displayByValues:()=>d.length?`${d.length} ${o("SelectionSelected")}`:"","aria-label":o("selectRequiredLanguage"),items:s.translatedLocales.map((e=>{const t={label:o(e),value:e};return"en"===e&&(t.render=()=>(0,s.jsx)("div",{className:"d-flex w-100 align-items-center mb-0"},(0,s.jsx)(R.Checkbox,{checked:!0,disabled:!0}),(0,s.jsx)("div",{style:I?{marginRight:"8px"}:{marginLeft:"8px"},className:"item-text"},t.label))),t})),onClickItem:(e,t,i)=>{"en"!==t&&u([...i])},values:(0,s.Immutable)(d)})),c&&(0,s.jsx)("div",{className:"message-container mt-4"},f>-1&&null!==f&&(0,s.jsx)("div",null,o("indexNumber",{cdnNumber:f})),(v?lt:lt.filter((e=>e.code!==at.CompilingWidget))).map((e=>{const t=rt.get(e.code);return t-1<=g?(0,s.jsx)("div",{className:"message-line",key:e.key},g>t?(0,s.jsx)(Xe,{color:"var(--primary-600)",className:"icon"}):(0,s.jsx)(R.Loading,{type:R.LoadingType.Donut}),o(e.key)):null}))),g===rt.get(at.Fail)&&(0,s.jsx)("div",{className:"error-msg mt-4"},(0,s.jsx)(nt,{className:"mr-1"}),o("failedToLoad"))),(0,s.jsx)("div",{className:"mt-5 popper-footer"},(0,s.jsx)(R.Button,{type:"primary",disabled:!d.length||c,onClick:()=>ot(void 0,void 0,void 0,(function*(){h(0);const e=d.join(","),i=s.SessionManager.getInstance().getMainSession(),n=null==i?void 0:i.token,o=`${window.jimuConfig.mountPath}download/${t}?locale=${e}&token=${n}`;try{p(!0);const e=(yield fetch(o).then((e=>e.json()))).uuid;r.current=e;const i=`${window.jimuConfig.mountPath}download/${t}/status?token=${n}&uuid=${e}`;let s,d=!1;for(;!d&&r.current===e&&a.current;){s=yield fetch(i).then((e=>e.json()));const{status:{code:o,hasCustomWidget:u},cdnNumber:c}=s;if(S(u),h((()=>rt.get(o))),m((()=>c)),!a.current||r.current!==e)break;if(o===at.Fail||o===at.Completed?d=!0:yield y(2e3),!a.current||r.current!==e)break;if(o===at.Completed){l();const i=`${window.jimuConfig.mountPath}download/${t}/getZip?token=${n}&uuid=${e}`;window.open(i)}}}catch(e){h((()=>rt.get(at.Fail)))}}))},o("ok")),(0,s.jsx)(R.Button,{className:"ml-2",onClick:l},o("cancel"))))};var ut=i(6745),ct=i.n(ut),pt=function(e,t){var i={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(i[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(i[n[o]]=e[n[o]])}return i};const gt=e=>{const t=window.SVG,{className:i}=e,n=pt(e,["className"]),o=(0,s.classNames)("jimu-icon jimu-icon-component",i);return t?s.React.createElement(t,Object.assign({className:o,src:ct()},n)):s.React.createElement("svg",Object.assign({className:o},n))},ht=e=>s.css`
    .switch-button.icon-btn {
      border-radius: 12px;
      border: none !important;
      padding: 4px;
      ${e?"padding-left: 20px;":"padding-right: 20px;"}
      background-color: ${e?"var(--sys-color-primary-main)":"var(--sys-color-secondary-light)"};
      >.icon-btn-sizer {
        width: 24px;
        height: 24px;
        border-radius: 8px;
        background: var(--sys-color-secondary-dark);
        svg {
          color: var(--sys-color-primary-text);
        }
      }
    }
  `,ft=e=>{const{checked:t,onChange:i}=e,n=s.hooks.useTranslation(E.A,R.defaultMessages),[o,a]=s.React.useState(!1),r=s.React.useRef(),l=()=>{const e=window.location.href;return!e.includes("set-portalurl")&&!e.includes("landing")},d=(0,s.useIntl)();return(0,s.jsx)("div",{css:ht(t),className:"express-mode-switch-container mr-2"},(0,s.jsx)(R.Typography,{variant:"h6",className:"mb-0"},(0,s.jsx)(R.Tooltip,{placement:"top",title:n(t?"goToFullMode":"goToExpressMode"),id:"express-mode-switch-button-tooltip",enterDelay:0},(0,s.jsx)(R.Button,{icon:!0,className:"switch-button mr-2",type:t?"primary":"default",onClick:()=>{i(!t),l()&&(a(!0),r.current&&clearTimeout(r.current),r.current=setTimeout((()=>{a(!1),clearTimeout(r.current),r.current=null}),2e3))},role:"switch","aria-checked":t,"aria-label":n("expressModeStep1Title"),"aria-describedby":"express-mode-switch-button-tooltip"},(0,s.jsx)(R.SVG,{autoFlip:!0,size:"m",src:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">\r\n                  <path fill-rule="evenodd" clip-rule="evenodd" d="M11.9541 1H4.0704L7.97869 8L4 15H11.9541L16 8L11.9541 1ZM7.97028 3.49994L10.551 8L7.96979 12.5001H10.9349L13.5 8L10.9187 3.49994H7.97028Z" fill="white"/>\r\n                  <path d="M2.80699 8.0293L4 5.37897L2.62351 3L0 8.0293L2.59333 13L3.98491 10.6499L2.80699 8.0293Z" fill="white"/>\r\n                </svg>'}))),(0,s.jsx)(R.Button,{title:n("help"),className:"border-0",icon:!0,size:"sm",type:"tertiary",onClick:()=>{s.GuideManager.getInstance().startGuide({id:"express-mode",type:s.GuideTypes.Program,level:s.GuideLevels.Builder})},"aria-label":n("help"),"aria-haspopup":"dialog"},(0,s.jsx)(gt,{autoFlip:!s.i18n.isSameLanguage(null==d?void 0:d.locale,"he")}))),(0,s.jsx)(R.Toast,{css:s.css`
          top: 104px;
          .jimu-toast-common::before {
            content: '';
            width: 16px;
            height: 16px;
            margin-right: 8px;
            background-image: url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2216%22%20height%3D%2216%22%20viewBox%3D%220%200%2016%2016%22%20fill%3D%22none%22%3E%0A%3Cg%20clip-path%3D%22url(%23clip0_561_41)%22%3E%0A%3Cpath%20d%3D%22M7.35355%2011.0607L12.7071%205.70711L12%205L7.35355%209.64645L4.70711%207L4%207.70711L7.35355%2011.0607Z%22%20fill%3D%22white%22%2F%3E%0A%3Cpath%20fill-rule%3D%22evenodd%22%20clip-rule%3D%22evenodd%22%20d%3D%22M0%208C0%2012.4183%203.58172%2016%208%2016C12.4183%2016%2016%2012.4183%2016%208C16%203.58172%2012.4183%200%208%200C3.58172%200%200%203.58172%200%208ZM15%208C15%2011.866%2011.866%2015%208%2015C4.13401%2015%201%2011.866%201%208C1%204.13401%204.13401%201%208%201C11.866%201%2015%204.13401%2015%208Z%22%20fill%3D%22white%22%2F%3E%0A%3C%2Fg%3E%0A%3Cdefs%3E%0A%3CclipPath%20id%3D%22clip0_561_41%22%3E%0A%3Crect%20width%3D%2216%22%20height%3D%2216%22%20fill%3D%22white%22%2F%3E%0A%3C%2FclipPath%3E%0A%3C%2Fdefs%3E%0A%3C%2Fsvg%3E");
          }
        `,open:o,text:n(t?"switchedToExpressMode":"switchedToFullMode"),type:R.ToastType.Info}))}},1332:(e,t,i)=>{"use strict";i.r(t),i.d(t,{clearLastAppConfigFromHistory:()=>m,letBuilderAddResource:()=>p,letBuilderClearResource:()=>g,letBuilderResponseToKeyboard:()=>h,letBuilderShowLayoutToolbar:()=>f,listenBuilderEvents:()=>a,publishAppIsLoadedToBuilder:()=>c,publishAppSessionChangeToBuilder:()=>r,publishAppStateChangeToBuilder:()=>u,publishCheck498ErrorToBuilder:()=>d,publishCloseBannerToBuilder:()=>w,publishConfirmDeleteToApp:()=>v,publishIsBusyToBuilder:()=>y,publishNoPermissionResourceInfoListChangeToBuilder:()=>l,publishPortalUrlNeedToRegisterClientId:()=>S,publishSidePanelToApp:()=>I});var n=i(9244),o=i(1169);let s;try{s=window.parent&&window.parent._builderPubsub}catch(e){console.error("Can access parent.")}function a(){if(!s)return;s.unsubscribe("to_app");const e=(0,n.getAppStore)();s.subscribe("to_app",(function(e,t){console.debug(e,t)})),s.subscribe(`to_app.${o.w.AppConfigChanged}`,(function(t,i){const o=e.getState();if(o.appRuntimeInfo.currentPageId&&!i.pages[o.appRuntimeInfo.currentPageId]){const e=Object.keys(i.pages).find((e=>i.pages[e].isDefault));n.jimuHistory.changePage(e)}e.dispatch(n.appActions.appConfigChanged(i))})),s.subscribe(`to_app.${o.w.AppInfoChanged}`,(function(t,i){e.dispatch(n.appActions.appInfoChanged(i))})),s.subscribe(`to_app.${o.w.PortalSelfChanged}`,(function(t,i){if(e.dispatch(n.appActions.setPortalSelf(i)),i&&!i.isPortal){const t=`https://${i.urlKey}.${i.customBaseUrl}`;i.urlKey&&!n.portalUrlUtils.isSamePortalUrl(e.getState().portalUrl,t)&&e.dispatch(n.appActions.setPortalInfo({portalUrl:t}))}})),s.subscribe(`to_app.${o.w.UserSignIn}`,(function(t,i){e.dispatch(n.appActions.userSignIn(i))})),s.subscribe(`to_app.${o.w.SetMainPortal}`,(function(t,i){const o=Object.assign({portalUrl:e.getState().portalUrl,clientId:e.getState().clientId,isWebTier:e.getState().isWebTier},i);e.dispatch(n.appActions.setPortalInfo(o))})),s.subscribe(`to_app.${o.w.DialogInfosChanged}`,(function(t,i){e.dispatch(n.appActions.dialogInfosChanged(i))})),s.subscribe(`to_app.${o.w.ChangeAppMode}`,(function(t,i){e.dispatch(n.appActions.appModeChanged(i))})),s.subscribe(`to_app.${o.w.ChangeWidgetStateProp}`,(function(t,i){e.dispatch(n.appActions.widgetStatePropChange(i.widgetId,i.propKey,i.value))})),s.subscribe(`to_app.${o.w.ChangeWidgetMutableStateProp}`,(function(e,t){n.MutableStoreManager.getInstance().updateStateValue(t.widgetId,t.propKey,t.value)})),s.subscribe(`to_app.${o.w.ChangePage}`,(function(e,t){const i=(0,n.getAppStore)().getState().appConfig.pages[t];i.type===n.PageType.Link||i.type===n.PageType.Folder||n.urlUtils.parseAppPath(location.pathname,(0,n.getAppStore)().getState().appConfig).pageId===t?(0,n.getAppStore)().dispatch(n.appActions.currentPageChanged(t)):n.jimuHistory.changePage(t)})),s.subscribe(`to_app.${o.w.ChangeDialog}`,(function(t,i){n.jimuHistory.changeDialog(i),e.dispatch(n.appActions.currentDialogChanged(i))})),s.subscribe(`to_app.${o.w.ChangeSelection}`,(function(t,i){e.dispatch(n.appActions.selectionChanged(i))})),s.subscribe(`to_app.${o.w.BuilderTriggerKeyboard}`,(function(e,t){n.keyboardUtils.triggerEvent(t)})),s.subscribe(`to_app.${o.w.ChangeBrowserSizeMode}`,(function(t,i){e.dispatch(n.appActions.browserSizeModeChanged(i))})),s.subscribe(`to_app.${o.w.BuilderSessionChanged}`,(function(e,t){n.SessionManager.getInstance().syncSessionsFromOtherWindow(t)})),s.subscribe(`to_app.${o.w.BuilderNoPermissionResourceInfoListChanged}`,(function(e,t){n.SessionManager.getInstance().syncNoPermissionResourceInfoListFromOtherWindow(t)})),s.subscribe(`to_app.${o.w.ChangeZoomScale}`,(function(t,i){e.dispatch(n.appActions.zoomScaleChange(i))})),s.subscribe(`to_app.${o.w.ActivePagePartChanged}`,(function(t,i){e.dispatch(n.appActions.activePagePartChanged(i))})),s.subscribe(`to_app.${o.w.AnimationPreview}`,(function(t,i){e.dispatch(n.appActions.setupAnimationPreview(i))})),s.subscribe(`to_app.${o.w.HoverPreview}`,(function(t,i){e.dispatch(n.appActions.setupHoverPreview(i))})),s.subscribe(`to_app.${o.w.SectionNavInfoChanged}`,(function(t,i){e.dispatch(n.appActions.sectionNavInfoChanged(i.sectionId,i.navInfo)),n.jimuHistory.changeViewBySectionNavInfo(i.sectionId,i.navInfo)})),s.subscribe(`to_app.${o.w.ScreenGroupNavInfoChanged}`,(function(t,i){e.dispatch(n.appActions.screenGroupNavInfoChanged(i.screenGroupId,i.activeIndex))})),s.subscribe(`to_app.${o.w.TocHoverInfoChanged}`,(function(e,t){const{layoutInfo:i,hovered:n}=t,{layoutId:o,layoutItemId:s}=i,a=document.querySelector(`div.builder-layout-item[data-layoutid="${o}"][data-layoutitemid="${s}"]`);a&&(n?a.classList.add("hovered"):a.classList.remove("hovered"))})),s.subscribe(`to_app.${o.w.SetClientIdAlertIsCancelled}`,(function(e,t){n.SessionManager.getInstance().onClientIdDialogFinished(null==t?void 0:t.portalUrl,null,new Error("setting clientId is cancelled."))})),s.subscribe(`to_app.${o.w.UtilityStateChanged}`,(function(t,i){e.dispatch(n.appActions.utilityStateChange(i.utilityId,i.state,i.isSignInError))})),s.subscribe(`to_app.${o.w.OpenCookieBannerByPrivacyPanel}`,(function(t,i){const{isOpen:o}=i;e.dispatch(n.appActions.OpenCookieBannerByPrivacyPanel(o))})),s.subscribe(`to_app.${o.w.OpenCookieSettingsWindow}`,(function(t,i){const{isOpen:o}=i;e.dispatch(n.appActions.OpenCookieSettingsWindow(o))})),s.subscribe(`to_app.${o.w.WidgetToolbarStateChange}`,(function(t,i){const{widgetId:o,toolNames:s}=i;e.dispatch(n.appActions.widgetToolbarStateChange(o,s))})),s.subscribe(`to_app.${o.w.WidgetToolbarIsNewFlagChange}`,(function(t,i){const{widgetId:o,toolNames:s,flag:a}=i;e.dispatch(n.appActions.widgetToolbarIsNewFlagChange(o,s,a))})),s.subscribe(`to_app.${o.w.SetWidgetIsInlineEditingState}`,(function(t,i){const{widgetId:o,isInlineEditing:s}=i;e.dispatch(n.appActions.setWidgetIsInlineEditingState(o,s))}))}function r(){C(`to_builder.${o.M.AppSessionChanged}`,n.SessionManager.getInstance().getSessions())}function l(){C(`to_builder.${o.M.AppNoPermissionResourceInfoListChanged}`,n.SessionManager.getInstance().getNoPermissionResourceInfoList())}function d(e){C(`to_builder.${o.M.NeedToCheck498Error}`,e)}function u(){C(`to_builder.${o.M.AppStateChanged}`,(0,n.getAppStore)().getState())}function c(){C(`to_builder.${o.M.AppIsLoaded}`)}function p(e){C(`to_builder.${o.M.AppAddResource}`,e)}function g(e){C(`to_builder.${o.M.AppClearResources}`,e)}function h(e){C(`to_builder.${o.M.AppTriggerKeyboard}`,e)}function f(e){C(`to_builder.${o.M.SetLayoutTools}`,e)}function m(){C(`to_builder.${o.M.ClearLastAppConfigFromHistory}`)}function y(e){C(`to_builder.${o.M.SetIsBusy}`,e)}function v(e){C(`to_builder.${o.M.ConfirmDelete}`,e)}function S(e,t,i,n){C(`to_builder.${o.M.NeedToRegisterClinetId}`,{portalUrl:e,needToSignIn:t,serviceUrl:i,forceLogin:n})}function I(e){C(`to_builder.${o.M.SetSidePanel}`,e)}function w(){C(`to_builder.${o.M.CloseBannerInLiveView}`)}function C(e,t){s&&s.publishSync(e,t)}},4617:(e,t,i)=>{"use strict";i.d(t,{I:()=>v,y:()=>y});var n=i(9244),o=i(1496),s=i(8249),a=i(3596),r=i(1332),l=i(2241),d=i(1575),u=i(876),c=i(6963),p=i(4601),g=i(6764),h=i(320),f=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function m(){var e;return window.jimuConfig.isBuilder?window.isExpressBuilder:null===(e=window.parent)||void 0===e?void 0:e.isExpressBuilder}function y(e=void 0){return e||(e=function(){const e=(0,n.getAppStore)().getState();return window.jimuConfig.isBuilder?e&&e.appStateInBuilder&&e.appStateInBuilder.appConfig:e&&e.appConfig}()),new v(e)}window._getAppConfigAction=y;class v{constructor(e){this.clearDeletedWidgetMessageAction=(e,t)=>{this.getDeletedWidgetsMessageConfigs(e,t).forEach((e=>{this.removeMessageAction(e)}))},this.getDeletedWidgetsMessageConfigs=(e,t)=>{const i=e.messageConfigs,n=t.messageConfigs,o=[];if(!i)return o;const s=Object.keys(i),a=Object.keys(n);for(let e=0;e<s.length;e++)a.includes(s[e])||o.push(i[s[e]]);return o},this.removeMessageAction=e=>{var t;null===(t=null==e?void 0:e.actions)||void 0===t||t.forEach((t=>{const i=c.AppMessageManager.getInstance().getAction(t.widgetId,t.actionName);i&&i.onRemoveListen(e.messageType,e.widgetId)}))},this.appConfig=e}exec(e=!1){if(n.ExtensionManager.getInstance().getExtensions(n.extensionSpec.ExtensionPoints.AppConfigOperations).sort(((e,t)=>e.index-t.index)).forEach((e=>{if(e.appConfigWillChange)try{this.appConfig=e.appConfigWillChange(this.appConfig)}catch(e){console.error("Error in appConfigWillChange.",e)}})),window.jimuConfig.isBuilder){(0,n.getAppStore)().dispatch({type:"IN_BUILDER_APPCONFIG_REDOCLEAR"}),e&&(0,n.getAppStore)().dispatch(l.yx.InBuilderRemoveLastAppConfigFromHistory()),a.publishAppConfigChangeToApp(this.appConfig);const t=(0,n.getAppStore)().getState().appStateInBuilder.appConfig,i=this.appConfig,o=Object.keys(t.widgets).filter((e=>!i.widgets[e]));(0,n.getAppStore)().dispatch(u.Zv.widgetsRemoved(o)),this.clearDeletedWidgetMessageAction(t,i);const s=Object.keys(i.widgets).filter((e=>!t.widgets[e])).map((e=>({widgetId:e,widgetUri:i.widgets[e].uri})));(0,n.getAppStore)().dispatch(u.Zv.widgetsAdded(s));const r=(0,n.getAppStore)().getState().appStateInBuilder.appInfo;(0,n.getAppStore)().dispatch(d.Aj.inBuilderAppConfigChanged(this.appConfig)),(0,n.getAppStore)().dispatch(l.yx.InBuilderPutAppConfigIntoHistory({appConfig:this.appConfig,appInfo:r}))}else{e&&r.clearLastAppConfigFromHistory();const t=(0,n.getAppStore)().getState().appConfig,i=this.appConfig;this.clearDeletedWidgetMessageAction(t,i),(0,n.getAppStore)().dispatch(n.appActions.appConfigChanged(this.appConfig))}return this}editWidgetConfig(e,t){return this.appConfig.widgets[e]?(this.appConfig=this.appConfig.setIn(["widgets",e,"config"],t),this):this}editWidget(e,t){if(!this.appConfig.widgets[e.id])return this;const i=this.appConfig.widgets[e.id];let o=i;return t&&(t.forEach((e=>{e.isOutputFromWidget||(e.isOutputFromWidget=!0)})),o=o.set("outputDataSources",t.map((e=>e.id)))),Object.keys(e).forEach((t=>{null===e[t]&&("outputDataSourcesJson"===t&&e.outputDataSources&&e.outputDataSources.forEach((e=>this.removeDataSource(e))),o=o.without(t),delete e[t])})),i.outputDataSources&&i.outputDataSources.forEach((e=>{o.outputDataSources&&o.outputDataSources.includes(e)||this.removeDataSource(e)})),o.outputDataSources&&o.outputDataSources.forEach((e=>{const o=t&&t.find((t=>t.id===e));if(o)if(i.outputDataSources&&i.outputDataSources.includes(e)){let t=this.appConfig.dataSources[e];if(!t)return void console.error("Unknown error. Widget output data source is not in data source json.",e);Object.keys(o).forEach((e=>{null===o[e]&&(t=t.without(e),delete o[e])})),this.editDataSource(t.merge(o))}else this.addDataSource((0,n.Immutable)(o))})),o=o.merge(e),e.useDataSources&&o.layouts&&o.manifest.properties.passDataSourceToChildren&&this.copyUseDataSourceToAllChildWidgets(i,o),this.appConfig=this.appConfig.setIn(["widgets",e.id],o),this}editWidgetProperty(e,t,i){if(!this.appConfig.widgets||!this.appConfig.widgets[e])return this;if("outputDataSources"===t)return console.error("Please use editWidget to update outputDataSources."),this;const n=this.appConfig.widgets[e],o=this.editJsonProperty(n,t,i);return n===o?this:(this.appConfig=this.appConfig.setIn(["widgets",e],o),t.includes(".")?this:this.editWidget({id:e,[t]:i}))}createWidget(e){return f(this,arguments,void 0,(function*(e,t=!0){try{const i=yield p.A.getInstance().handleNewWidgetJson(e),n=g.Q7.createWidget(this.appConfig,i,[o.utils.getCurrentSizeMode()],t);this.appConfig=n[0];const s=n[1];return this.appConfig.widgets[s]}catch(e){console.error(e)}return null}))}removeWidget(e){return this.appConfig=g.Q7.remove(this.appConfig,e),this}editControllerPanel(e,t){return this.appConfig=this.appConfig.setIn(["controllerPanels",e],t),this}removeControllerPanel(e){var t;return(null===(t=this.appConfig.controllerPanels)||void 0===t?void 0:t[e])&&(this.appConfig=this.appConfig.set("controllerPanels",this.appConfig.controllerPanels.without(e))),this}removeLayoutFromWidget(e,t){var i,n,o;return(null===(i=this.appConfig.widgets[e])||void 0===i?void 0:i.layouts)&&(null===(n=this.appConfig.widgets[e])||void 0===n?void 0:n.layouts[t])?(Object.keys(null===(o=this.appConfig.widgets[e])||void 0===o?void 0:o.layouts[t]).forEach((i=>{var n;const o=null===(n=this.appConfig.widgets[e])||void 0===n?void 0:n.layouts[t][i];this.removeLayout(o)})),this.appConfig=this.appConfig.setIn(["widgets",e,"layouts"],this.appConfig.widgets[e].layouts.without(t)),this):this}createSection(){const e=g.HA.createSection(this.appConfig,[o.utils.getCurrentSizeMode()]);this.appConfig=e[0];const t=e[1];return this.appConfig.sections[t]}editSectionProperty(e,t,i){let n=this.appConfig.sections[e];return n?(n=this.editJsonProperty(n,t,i),this.appConfig=this.appConfig.setIn(["sections",e],n),this):this}editViewProperty(e,t,i){let n=this.appConfig.views[e];return n?(n=this.editJsonProperty(n,t,i),this.appConfig=this.appConfig.setIn(["views",e],n),this):this}addView(e){var t;let i;const s=this.appConfig.sections[e];if((null===(t=s.views)||void 0===t?void 0:t.length)>0){const e=s.views[0],t=this.appConfig.views[e];i=Object.keys(t.layout)}else{const{type:t,id:s}=o.searchUtils.getContentRootContainerInfo(this.appConfig,e,n.LayoutItemType.Section,o.utils.getCurrentSizeMode());t===n.ContainerType.Header||t===n.ContainerType.Footer?i=Object.keys(this.appConfig[s].layout):t===n.ContainerType.Page?i=Object.keys(this.appConfig.pages[s].layout):t===n.ContainerType.Dialog&&(i=Object.keys(this.appConfig.dialogs[s].layout))}const a=g.HA.addView(this.appConfig,e,i);return this.appConfig=a[0],a[1]}duplicateView(e,t,i){const n=this.appConfig.sections[t],o=this.appConfig.views[n.views[0]],s=Object.keys(o.layout),a=g.HA.duplicateView(this.appConfig,t,e,s,i,null);this.appConfig=a[0];const r=a[1];return this.appConfig.views[r]}removeView(e,t){return this.appConfig=g.HA.removeView(this.appConfig,t,e),this}moveViewInSection(e,t,i,n){if(!(this.appConfig.sections&&this.appConfig.sections[e]&&this.appConfig.views&&this.appConfig.views[t]&&this.appConfig.views[i]))return this;if(i===t)return console.error("viewId is same to targetViewId."),this;let o=this.appConfig.sections[e].views.asMutable();o=o.filter((e=>e!==t));let s=o.indexOf(i);return"below"===n&&s++,o=o.slice(0,s).concat(t).concat(o.slice(s)),this.appConfig=this.appConfig.setIn(["sections",e,"views"],o),this}createScreenGroup(){const e=s.getUniqueId("screenGroup"),t=s.getUniqueLabel(this.appConfig,"screenGroup",n.i18n.getIntl().formatMessage({id:"screenGroup"})),i=(0,n.Immutable)({id:e,label:t,screens:[],transitionType:n.ScreenTransitionType.Fade});return this.appConfig=this.appConfig.setIn(["screenGroups",i.id],i),i}editScreenGroupProperty(e,t,i){let n=this.appConfig.screenGroups[e];return n?(n=this.editJsonProperty(n,t,i),this.appConfig=this.appConfig.setIn(["screenGroups",e],n),this):this}editScreenProperty(e,t,i){let n=this.appConfig.screens[e];return n?(n=this.editJsonProperty(n,t,i),this.appConfig=this.appConfig.setIn(["screens",e],n),this):this}moveScreenInGroup(e,t,i,n){var o;if(!(null===(o=this.appConfig.screenGroups)||void 0===o?void 0:o[e])||t===i)return this;const s=this.appConfig.screenGroups[e].screens.asMutable(),a=s[t],r=s[i];s.splice(t,1);const l=s.indexOf(r);return"below"===n?s.splice(l,1,r,a):s.splice(l,1,a,r),this.appConfig=this.appConfig.setIn(["screenGroups",e,"screens"],s),this}removeScreenByIndex(e,t){var i,n;const o=null===(n=null===(i=this.appConfig.screenGroups)||void 0===i?void 0:i[t])||void 0===n?void 0:n.screens,s=null==o?void 0:o[e];return this.removeScreen(s,t)}removeScreen(e,t,i=!1){return this.appConfig=g.rW.removeScreen(this.appConfig,t,e),this}duplicateScreenByIndex(e,t,i=!0){var n,o;const s=null===(o=null===(n=this.appConfig.screenGroups)||void 0===n?void 0:n[t])||void 0===o?void 0:o.screens,a=null==s?void 0:s[e];return this.duplicateScreen(a,t,i)}duplicateScreen(e,t,i=!0){const n=this.appConfig.screenGroups[t],o=this.appConfig.screens[n.screens[0]],s=Object.keys(o.main.layout),a=g.rW.duplicateScreen(this.appConfig,t,e,s,i,null);this.appConfig=a[0];const r=a[1];return this.appConfig.screens[r]}editPageProperty(e,t,i){if(!this.appConfig.pages||!this.appConfig.pages[e])return this;let n=this.appConfig.pages[e];return n=this.editJsonProperty(n,t,i),this.appConfig=this.appConfig.setIn(["pages",e],n),this}addPage(e){return this.appConfig.pages&&this.appConfig.pages[e.id]||(this.appConfig=this.appConfig.setIn(["pages",e.id],e),this.appConfig=this.appConfig.set("pageStructure",this.appConfig.pageStructure.concat([{[e.id]:[]}]))),this}duplicatePage(e,t=!1){if(!this.appConfig.pages||!this.appConfig.pages[e])return null;let i=this.appConfig.pages[e].set("id",s.getUniqueId("page"));if(i=i.set("label",this.getDuplicateLabel("page",i.label)),this.appConfig=this.appConfig.setIn(["pages",i.id],i),i.isDefault&&(i=i.set("isDefault",!1)),i.type!==n.PageType.Link&&i.type!==n.PageType.Folder){const e={},t=g.zM.getServiceFromSizeModeLayout(this.appConfig,i.layout).duplicateSizeModeLayouts(this.appConfig,i.layout,n.LayoutParentType.Page,i.id,e);this.appConfig=t[0],i=i.set("layout",t[1]),this.appConfig=g.Q7.afterBatchCopied(this.appConfig,this.appConfig,e)}const o=this.appConfig.pageStructure.find((t=>!!t[e])),a=[];if(o&&o[e].forEach((e=>{const t=this.duplicatePage(e,!0);a.push(t.id)})),!t)if(o){if(this.appConfig=this.appConfig.set("pageStructure",this.appConfig.pageStructure.concat([{[i.id]:[]}])),a.length>0){const e=i.id;let t=this.appConfig.pageStructure.length-1;t<0&&(t=0),this.appConfig=this.appConfig.setIn(["pageStructure",t+"",e],a)}}else this.appConfig.pageStructure.some(((t,n)=>{const o=Object.keys(t).find((i=>t[i].includes(e)));if(o)return this.appConfig=this.appConfig.setIn(["pageStructure",n+"",o],this.appConfig.pageStructure[n][o].concat(i.id)),!0}));return this.appConfig=this.appConfig.setIn(["pages",i.id],i),i}movePageIntoPage(e,t){return this.appConfig.pages&&this.appConfig.pages[e]&&this.appConfig.pages[t]?e===t?(console.error("SubPage is same to ParentPage."),this):s.isFirstLevelPage(this.appConfig,t)?s.isPageHasSubPage(this.appConfig,e)?(console.error("SubPage has sub page(s)."),this):(this.removePageFromPageStructure(e),this.movePageIntoPageForPageStructure(e,t),this):(console.error("ParentPage is not on the first aspect."),this):this}orderPageToPage(e,t,i){if(!this.appConfig.pages||!this.appConfig.pages[t]||!this.appConfig.pages[e])return this;if(t===e)return console.error("pageId is same to targetPageId."),this;const o=!s.isFirstLevelPage(this.appConfig,t);if((s.isPageHasSubPage(this.appConfig,e)||this.appConfig.pages[e].type===n.PageType.Folder)&&o)return console.error("page structure allow two aspects only"),this;const a=this.appConfig.pageStructure.find((t=>!!t[e]));return this.removePageFromPageStructure(e),o?this.appConfig.pageStructure.some(((n,o)=>{const s=Object.keys(n)[0];let a=n[s].indexOf(t);if(a>-1){let t=this.appConfig.pageStructure[o][s];return"bottom"===i&&(a+=1),t=t.slice(0,a).concat([e]).concat(t.slice(a)),this.appConfig=this.appConfig.setIn(["pageStructure",o+"",s],t),!0}})):this.appConfig.pageStructure.some(((n,o)=>{if(Object.keys(n)[0]===t){"bottom"===i&&(o+=1);const t=this.appConfig.pageStructure.slice(0,o).concat([a||{[e]:[]}]).concat(this.appConfig.pageStructure.slice(o));return this.appConfig=this.appConfig.set("pageStructure",t),!0}})),this}removePage(e,t){if(!this.appConfig.pages||!this.appConfig.pages[e])return this;const i=this.appConfig.pages[e];if(i.type!==n.PageType.Folder&&i.type!==n.PageType.Link){const e=g.zM.getServiceFromSizeModeLayout(this.appConfig,i.layout);this.appConfig=e.removeSizeModeLayouts(this.appConfig,i.layout)}const{pageStructure:o}=this.appConfig,s=o&&o.find((t=>!!t[e]));return s&&s[e].length>0&&s[e].forEach((e=>{this.removePage(e)})),this.removePageFromPageStructure(e),this.appConfig=this.appConfig.set("pages",this.appConfig.pages.without(e)),t&&this.setHomePage(t),this}setHomePage(e){return this.editPageProperty(e,"isDefault",!0)}setUseAutoSortInFixedLayout(e){return this.appConfig=this.appConfig.set("useAutoSortInFixedLayout",e),this}replaceHomePage(e){return Object.keys(this.appConfig.pages).some(((e,t)=>{const i=this.appConfig.pages[e];if(i.isDefault)return this.editPageProperty(i.id,"isDefault",!1),!0})),this.editPageProperty(e,"isDefault",!0)}editDialog(e){const t=this.appConfig.dialogs[e.id].mode;if(t!==e.mode){const i=this.appConfig.dialogs.asMutable({deep:!0});Object.keys(i).forEach((n=>{const o=i[n];o.id===e.id?i[n]=Object.assign({},e.asMutable({deep:!0}),{index:Object.keys(i).filter((e=>i[e].mode!==t)).length}):o.mode===t&&o.index>e.index&&(o.index=o.index-1)})),this.appConfig=this.appConfig.set("dialogs",(0,n.Immutable)(i))}else this.appConfig=this.appConfig.setIn(["dialogs",e.id],e);return this}editDialogProperty(e,t,i){if(!this.appConfig.dialogs||!this.appConfig.dialogs[e])return this;let n=this.appConfig.dialogs[e];return n=this.editJsonProperty(n,t,i),this.editDialog(n)}removeDialog(e){var t;const i=null===(t=this.appConfig.dialogs)||void 0===t?void 0:t[e];if(!i)return this;const o=g.zM.getServiceFromSizeModeLayout(this.appConfig,i.layout);this.appConfig=o.removeSizeModeLayouts(this.appConfig,i.layout);const s=i.mode,a=i.index,r=this.appConfig.dialogs.without(e).asMutable({deep:!0});return Object.keys(r).forEach((e=>{const t=r[e];t.mode===s&&t.index>a&&(t.index=t.index-1)})),this.appConfig=this.appConfig.set("dialogs",(0,n.Immutable)(r)),this}duplicateDialog(e){const t=this.appConfig.dialogs;let i=t[e];if(!t||!i)return null;const o=s.getUniqueId("dialog"),a={},r=g.zM.getServiceFromSizeModeLayout(this.appConfig,i.layout).duplicateSizeModeLayouts(this.appConfig,i.layout,n.LayoutParentType.Dialog,o,a);this.appConfig=r[0];const l=r[1];this.appConfig=g.Q7.afterBatchCopied(this.appConfig,this.appConfig,a);const d=Object.keys(Object.keys(t).filter((e=>t[e].mode===i.mode))).length;return i=i.set("id",o).set("index",d).set("isSplash",!1).set("label",this.getDuplicateLabel("dialog",i.label)).set("layout",l),this.appConfig=this.appConfig.setIn(["dialogs",i.id],i),i}orderDialogToDialog(e,t,i){const o=this.appConfig.dialogs.asMutable({deep:!0}),s=o[e],a=o[t];if(!o||!s||!a)return this;if(t===e)return console.error("dialogId is same to targetDialogId."),this;let r;return a.index>s.index?(r="top"===i?a.index-1:a.index,Object.keys(o).forEach((t=>{const i=o[t];i.mode===a.mode&&i.id!==e&&i.index>s.index&&i.index<=r&&(i.index=i.index-1)}))):(r="top"===i?a.index:a.index+1,Object.keys(o).forEach((t=>{const i=o[t];i.mode===a.mode&&i.id!==e&&i.index>=r&&i.index<s.index&&(i.index=i.index+1)}))),o[e]=Object.assign({},s,{index:r,mode:a.mode}),this.appConfig=this.appConfig.set("dialogs",(0,n.Immutable)(o)),this}replaceSplashDialog(e,t){return t&&this.editDialogProperty(t,"isSplash",!1),e!==t?this.editDialogProperty(e,"isSplash",!0):this}createLayoutForSizeMode(e,t,i,o,s,a){var r;if(!i||!i[t]||i[e])return null;const l=i[t],d=g.zM.getService(this.appConfig,l).duplicateLayout(this.appConfig,i[t],t,e,null,!1);if(d[1]){this.appConfig=d[0];const t=d[1];this.appConfig=this.appConfig.setIn(["layouts",t,"parent"],{id:s,type:o});const l=i.set(e,t);switch(o){case n.LayoutParentType.Dialog:this.appConfig=this.appConfig.setIn(["dialogs",s,"layout"],l);break;case n.LayoutParentType.Page:this.appConfig=this.appConfig.setIn(["pages",s,"layout"],l);break;case n.LayoutParentType.Header:this.appConfig=this.appConfig.setIn(["header","layout"],l);break;case n.LayoutParentType.Footer:this.appConfig=this.appConfig.setIn(["footer","layout"],l);break;case n.LayoutParentType.Screen:this.appConfig=this.appConfig.setIn(["screens",s,"layout"],l);break;case n.LayoutParentType.View:this.appConfig=this.appConfig.setIn(["views",s,"layout"],l);break;case n.LayoutParentType.Widget:{const e=this.appConfig.widgets[s];(null===(r=null==e?void 0:e.layouts)||void 0===r?void 0:r[a])&&(this.appConfig=this.appConfig.setIn(["widgets",s,"layouts",a],l));break}}return l}return null}removeSizeModeLayout(e,t){const i=g.zM.getService(this.appConfig,e);return this.appConfig=i.removeLayout(this.appConfig,e,t),this}addNewSectionToLayout(e){const t=this.createSection(),i=g.zM.getService(this.appConfig,e).createBlankItem(this.appConfig,e);this.appConfig=i[0];const s=i[1],a={layoutId:e,layoutItemId:s};return this.editLayoutItemProperty(a,"type",n.LayoutItemType.Section).editLayoutItemProperty(a,"sectionId",t.id),this.appConfig=g.HA.addParent(this.appConfig,t.id,a,o.utils.getCurrentSizeMode()),s}addPlaceholderToLayout(e){const t=g.zM.getService(this.appConfig,e).createBlankItem(this.appConfig,e);this.appConfig=t[0];const i=t[1],o={layoutId:e,layoutItemId:i};return this.editLayoutItemProperty(o,"type",n.LayoutItemType.Widget),this.appConfig=g.X7.addAsSyncablePlaceholder(this.appConfig,o),i}addNewWidgetToLayout(e,t){return f(this,arguments,void 0,(function*(e,t,i=!1){if(!i&&m())return;const s=yield this.createWidget(t,!0);if(s){const t=g.zM.getService(this.appConfig,e).createBlankItem(this.appConfig,e);this.appConfig=t[0];const i=t[1],a={layoutId:e,layoutItemId:i};this.editLayoutItemProperty(a,"type",n.LayoutItemType.Widget,!0).editLayoutItemProperty(a,"widgetId",s.id,!0);const r=o.utils.getCurrentSizeMode();return this.appConfig=g.Q7.addParent(this.appConfig,s.id,a,r),this.appConfig=g.Q7.afterAdded(this.appConfig,s.id,e,r,r),i}return null}))}addTemplateContentToLayout(e,t,i){const n=g.zM.getService(this.appConfig,e).addContent(this.appConfig,e,i,t,o.utils.getCurrentSizeMode());return this.appConfig=n[0],{layoutId:e,layoutItemId:n[1]}}addContentToPlaceholder(e,t,i){var n;let s=[{layoutInfo:e,sizeMode:o.utils.getCurrentSizeMode()}];const a=g.X7.getPlaceholderInfo(this.appConfig,e);return a&&(s=[{layoutInfo:a.layoutInfo,sizeMode:this.appConfig.mainSizeMode}],Object.keys(null!==(n=a.syncs)&&void 0!==n?n:{}).forEach((e=>{s.push({layoutInfo:a.syncs[e],sizeMode:e})}))),s.forEach((n=>{var s;const{layoutInfo:a,sizeMode:r}=n,{layoutId:l}=a;this.editLayoutItemProperty(a,"type",t),this.appConfig=g.YU.setContentId(this.appConfig,a,i,r);const d=o.searchUtils.findLayoutItem(this.appConfig,a),u=new g.yC(this.appConfig,d);this.appConfig=u.afterAdded(l,r,r),(null===(s=d.setting)||void 0===s?void 0:s.placeholderStyle)&&this.editLayoutItemProperty(e,"setting",d.setting.without("placeholderStyle"))})),this}removeParentsOfOtherSizeModes(e,t,i){const s=o.searchUtils.findLayoutItem(this.appConfig,e);let a=[];const r=[];if(s.type===n.LayoutItemType.Widget){const e=s.widgetId,t=this.appConfig.widgets[e];(null==t?void 0:t.layouts)&&Object.keys(t.layouts).forEach((e=>{const n=t.layouts[e][i];r.push(n)}))}else if(s.type===n.LayoutItemType.Section){const e=s.sectionId;this.appConfig.sections[e].views.forEach((e=>{const t=this.appConfig.views[e];r.push(t.layout[i])}))}else if(s.type===n.LayoutItemType.ScreenGroup){const e=s.screenGroupId;this.appConfig.screenGroups[e].screens.forEach((e=>{const t=this.appConfig.screens[e];r.push(t.main.layout[i]),t.panel&&r.push(t.panel.layout[i])}))}r.length>0&&r.forEach((e=>{const t=o.searchUtils.getContentsInLayoutRecursive(this.appConfig,e,n.LayoutItemType.Widget,i);a=a.concat(t)})),a.length>0&&a.forEach((e=>{t.forEach((t=>{t!==i&&(this.appConfig=g.Q7.removeSizeModeParent(this.appConfig,e,t))}))}))}duplicateLayoutItemInSameLayout(e){const{layoutId:t}=e,i=g.zM.getService(this.appConfig,t),s={},a=o.utils.getCurrentSizeMode(),r=i.duplicateItemInSameLayout(this.appConfig,e,a,s);this.appConfig=r[0];const l=r[1];this.appConfig=g.Q7.afterBatchCopied(this.appConfig,this.appConfig,s);const d=o.searchUtils.findLayoutItem(this.appConfig,{layoutId:t,layoutItemId:l}),u=new g.yC(this.appConfig,d),c=[n.BrowserSizeMode.Large,n.BrowserSizeMode.Medium,n.BrowserSizeMode.Small];return c.forEach((e=>{e!==a&&u.removeSizeModeParent(e)})),this.appConfig=u.getConfig(),this.removeParentsOfOtherSizeModes({layoutId:t,layoutItemId:l},c,a),r[1]}duplicateLayoutItemToOtherLayout(e,t){const i=o.searchUtils.findLayoutItem(this.appConfig,e),a=new g.yC(this.appConfig,i),r={},l=o.utils.getCurrentSizeMode(),d=a.duplicate(l,r);this.appConfig=d[0];const u=d[1];this.appConfig=g.Q7.afterBatchCopied(this.appConfig,this.appConfig,r),this.appConfig=g.Q7.removeParent(this.appConfig,u,e);const c=g.zM.getService(this.appConfig,t).createBlankItem(this.appConfig,t);this.appConfig=c[0];const p=c[1],h={layoutId:t,layoutItemId:p};switch(this.editLayoutItemProperty(h,"type",i.type),i.type){case n.LayoutItemType.Widget:this.editLayoutItemProperty(h,"widgetId",u);break;case n.LayoutItemType.Section:this.editLayoutItemProperty(h,"sectionId",u);break;case n.LayoutItemType.ScreenGroup:this.editLayoutItemProperty(h,"screenGroupId",u)}const f=o.searchUtils.findLayoutItem(this.appConfig,h),m=new g.yC(this.appConfig,f);m.addParent(h,l);const y=[n.BrowserSizeMode.Large,n.BrowserSizeMode.Medium,n.BrowserSizeMode.Small];y.forEach((e=>{e!==l&&m.removeSizeModeParent(e)})),this.appConfig=m.getConfig(),this.removeParentsOfOtherSizeModes(h,y,l);return s.getSizeModeOfALayout(this.appConfig,e.layoutId)===l&&l===this.appConfig.mainSizeMode&&(this.appConfig=g.X7.afterLayoutItemCopied(this.appConfig,e,h)),p}syncPlaceholder(e,t,i){var n,o;const s=g.X7.getPlaceholderInfo(this.appConfig,e);if(null===(n=null==s?void 0:s.syncs)||void 0===n?void 0:n[i]){const{layoutId:t,layoutItemId:n}=s.syncs[i];t===e.layoutId&&n===e.layoutItemId&&(this.appConfig=this.appConfig.setIn(["placeholderInfos",s.id,"syncs"],s.syncs.without(i)))}return t>0&&(null===(o=this.appConfig.placeholderInfos)||void 0===o?void 0:o[t])&&(this.appConfig=this.appConfig.setIn(["placeholderInfos",t,"syncs",i],e)),this}moveLayoutItem(e,t,i,n){const o=g.zM.getService(this.appConfig,t).moveLayoutItem(this.appConfig,e,t,i,n);return this.appConfig=o[0],o[1]}setLayoutItemToPending(e,t){if(!o.searchUtils.findLayoutItem(this.appConfig,e))return this;if(t){const t=g.zM.getService(this.appConfig,e.layoutId);this.appConfig=t.pendItem(this.appConfig,e)}else this.appConfig=this.appConfig.setIn(["layouts",e.layoutId,"content",e.layoutItemId,"isPending"],t);return this}removeLayoutItem(e,t,i){const n=g.zM.getService(this.appConfig,e.layoutId);return this.appConfig=n.removeItem(this.appConfig,e,o.utils.getCurrentSizeMode(),t,i),this}removeLayout(e){return this.removeSizeModeLayout(e,o.utils.getCurrentSizeMode())}clearLayoutContent(e){var t;const i=this.appConfig.layouts[e];return i?(Object.keys(null!==(t=i.content)&&void 0!==t?t:{}).forEach((t=>{this.removeLayoutItem({layoutId:e,layoutItemId:t},!0,!1)})),this):this}duplicateLayout(e,t){if(!this.appConfig.layouts[e])return null;const i=g.zM.getService(this.appConfig,e),n=o.utils.getCurrentSizeMode(),s=i.duplicateLayout(this.appConfig,e,n,n,null,t);this.appConfig=s[0];const a=s[1];return this.appConfig.layouts[a]}editLayoutProperty(e,t,i){let n=this.appConfig.layouts[e];return n?(n=this.editJsonProperty(n,t,i),this.appConfig=this.appConfig.setIn(["layouts",e],n),this):this}editLayoutItemProperty(e,t,i,n=!1){if(!n&&m())return this;const{layoutId:s,layoutItemId:a}=e;let r=o.searchUtils.findLayoutItem(this.appConfig,e);return r?(r=this.editJsonProperty(r,t,i),this.appConfig=this.appConfig.setIn(["layouts",s,"content",a],r),this):this}editLabelOfTocNode(e,t){switch(e.type){case"view":return this.editViewProperty(e.id,"label",t);case"screen":return this.editScreenProperty(e.id,"label",t);case"widget":return this.editWidgetProperty(e.id,"label",t);case"section":return this.editSectionProperty(e.id,"label",t);case"screenGroup":return this.editScreenGroupProperty(e.id,"label",t);case"layoutItem":return this.editLayoutItemProperty({layoutId:e.layoutId,layoutItemId:e.layoutItemId},"label",t);default:return this}}editLayoutItemSize(e,t,i,o=!1){var s;if(0===t||0===i||!o&&m())return this;const{layoutId:a,layoutItemId:r}=e,l=this.appConfig.layouts[a],d=null===(s=null==l?void 0:l.content)||void 0===s?void 0:s[r];if(!l||!d)return this;let u=d.setting||(0,n.Immutable)({});if(l.type===n.LayoutType.FixedLayout){const n=d.bbox.set("width",`${t}px`).set("height",`${i}px`);return u=u.setIn(["autoProps","width"],!1).setIn(["autoProps","height"],!1),this.editLayoutItemProperty(e,"bbox",n).editLayoutItemProperty(e,"setting",u)}return u=u.setIn(["autoProps","width"],!1).setIn(["autoProps","height"],!1).set("heightMode","ratio").set("aspectRatio",Number((i/t).toFixed(2))),this.editLayoutItemProperty(e,"setting",u)}exchangeWidthAndHeight(e=!1){var t,i,s,a,r;if(!e&&m())return this;let l;const d=(0,n.getAppStore)().getState();if(l=window.jimuConfig.isBuilder?null===(i=null===(t=null==d?void 0:d.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo)||void 0===i?void 0:i.selection:null===(s=null==d?void 0:d.appRuntimeInfo)||void 0===s?void 0:s.selection,!l)return this;const{layoutId:u}=l,c=this.appConfig.layouts[u];if((null==c?void 0:c.type)===n.LayoutType.FixedLayout){const e=o.searchUtils.findLayoutItem(this.appConfig,l);if(e){let t=e.bbox,i=!1,o=null!==(a=e.setting)&&void 0!==a?a:(0,n.Immutable)({});const s=null!==(r=o.autoProps)&&void 0!==r?r:{right:!0,bottom:!0};t=t.set("width",t.height).set("height",t.width),["left","right","top","bottom"].forEach((e=>{s[e]&&(t=t.without(e))})),this.editLayoutItemProperty(l,"bbox",t),null==s.width&&null==s.height||(o=o.setIn(["autoProps","width"],s.height).setIn(["autoProps","height"],s.width),i=!0),"ratio"===o.heightMode&&(o=o.set("heightMode","fixed"),i=!0),i&&this.editLayoutItemProperty(l,"setting",o)}}return this}adjustOrderOfItem(e,t,i=!1){if(!i&&m())return this;const{layoutId:n,layoutItemId:o}=e,s=this.appConfig.layouts[n];let a=[].concat(s.order||[]);if(null!=t&&t>=0&&t<=a.length){const e=a.indexOf(o);e>=0&&a.splice(e,1),a.splice(t,0,o)}else a.includes(o)&&(a=a.filter((e=>e!==o))),a.push(o);return this.appConfig=this.appConfig.setIn(["layouts",n,"order"],a),this}createLayout(e){const t=g.zM.getInstance().getServiceByType(e).createBlankLayout(this.appConfig,e);return this.appConfig=t[0],t[1]}createPageFromTemplate(e){return f(this,void 0,void 0,(function*(){const t={},i=yield g.Qi.createPageFromTemplate(this.appConfig,e,t);this.appConfig=i[0];const o=i[1];return this.appConfig=g.Q7.afterBatchCopied(this.appConfig,(0,n.Immutable)(e.config),t),o}))}createDialogFromTemplate(e){return f(this,void 0,void 0,(function*(){const t={},i=yield g.Qi.createDialogFromTemplate(this.appConfig,e,t);this.appConfig=i[0];const o=i[1];return this.appConfig=g.Q7.afterBatchCopied(this.appConfig,(0,n.Immutable)(e.config),t),o}))}applyHeaderTemplate(e){return f(this,void 0,void 0,(function*(){const t={};this.appConfig=yield g.Qi.applyTemplateToHeader(this.appConfig,e,o.utils.getCurrentSizeMode(),t),this.appConfig=g.Q7.afterBatchCopied(this.appConfig,(0,n.Immutable)(e.config),t)}))}applyFooterTemplate(e){return f(this,void 0,void 0,(function*(){const t={};this.appConfig=yield g.Qi.applyTemplateToFooter(this.appConfig,e,o.utils.getCurrentSizeMode(),t),this.appConfig=g.Q7.afterBatchCopied(this.appConfig,(0,n.Immutable)(e.config),t)}))}applyPageBodyTemplate(e,t){return f(this,void 0,void 0,(function*(){const i={};this.appConfig=yield g.Qi.applyTemplateToBody(this.appConfig,e,t,o.utils.getCurrentSizeMode(),i),this.appConfig=g.Q7.afterBatchCopied(this.appConfig,(0,n.Immutable)(t.config),i)}))}applyDialogTemplate(e,t){return f(this,arguments,void 0,(function*(e,t,i=o.utils.getCurrentSizeMode()){const s={};this.appConfig=yield g.Qi.applyTemplateToDialog(this.appConfig,e,t,i,s),this.appConfig=g.Q7.afterBatchCopied(this.appConfig,(0,n.Immutable)(t.config),s)}))}applyGridTemplate(e,t){return f(this,void 0,void 0,(function*(){const i={};this.appConfig=yield g.Qi.applyGridTemplate(this.appConfig,e,t,o.utils.getCurrentSizeMode(),i),this.appConfig=g.Q7.afterBatchCopied(this.appConfig,(0,n.Immutable)(t.config),i)}))}createScreenFromTemplate(e,t){return f(this,void 0,void 0,(function*(){const i={},s=yield g.rW.createScreenFromTemplate(this.appConfig,t,e,[o.utils.getCurrentSizeMode()],i);return this.appConfig=s[0],this.appConfig=g.Q7.afterBatchCopied(this.appConfig,(0,n.Immutable)(t.config),i),s[1]}))}copyUseDataSourceToAllChildWidgets(e,t){const i=o.searchUtils.getChildrenContents(this.appConfig,t.id,n.LayoutItemType.Widget,!0),s=t.useDataSources&&t.useDataSources.map((e=>e.set("fields",[])))[0],a=e.useDataSources&&e.useDataSources.map((e=>e.set("fields",[])))[0];return s&&a&&s.dataSourceId===a.dataSourceId||i.forEach((e=>{let t=this.appConfig.widgets[e];if(t.useDataSources&&a&&t.useDataSources.find((e=>e.dataSourceId===a.dataSourceId))){const i=(0,h.nj)(t.id);(null==i?void 0:i.useDataSourceWillRemove)&&(this.appConfig=i.useDataSourceWillRemove(this.appConfig,a.dataSourceId)),t=this.appConfig.widgets[e],t=t.set("useDataSources",t.useDataSources.filter((e=>e.dataSourceId!==a.dataSourceId)))}s&&(t=t.set("useDataSources",t.useDataSources?t.useDataSources.concat(s):[s]).set("useDataSourcesEnabled",!0)),this.appConfig=this.appConfig.setIn(["widgets",e],t)})),this}addDataSource(e){return this.appConfig=g.no.addDataSource(this.appConfig,e),this}addDataSources(e){return e.forEach((e=>{this.appConfig.dataSources&&this.appConfig.dataSources[e.id]||(this.appConfig=this.appConfig.setIn(["dataSources",e.id],e))})),this}addUtility(e){var t;let i=null!==(t=this.appConfig.utilities)&&void 0!==t?t:(0,n.Immutable)({});return i=i.set(e.id,e),this.appConfig=this.appConfig.set("utilities",i),this}removeUtility(e){var t;let i=null!==(t=this.appConfig.utilities)&&void 0!==t?t:(0,n.Immutable)({});const o=(0,h.Cp)();try{o.forEach((t=>{if(!t.utilityWillRemove)return;const i=this.appConfig.widgets[t.widgetId];i&&i.useUtilities&&i.useUtilities.find((t=>t.utilityId===e))&&(this.appConfig=t.utilityWillRemove(this.appConfig,e))}))}catch(e){console.error("Error when calling utilityWillRemove",e)}return i=i.without(e),this.appConfig=this.appConfig.set("utilities",i),this}updateUtilities(e){return this.appConfig=this.appConfig.set("utilities",e),this}removeDataSource(e){return this.appConfig=g.no.removeDataSource(this.appConfig,e),this}removeUseDataSource(e){return this.appConfig=g.no.removeUseDataSource(this.appConfig,e),this}editDataSource(e){return this.appConfig=this.appConfig.setIn(["dataSources",e.id],e),this}duplicateDataSource(e){const t=g.no.duplicateDataSource(this.appConfig,e);return this.appConfig=t[0],t[1]}addAppProxy(e){return this.appConfig.appProxies&&this.appConfig.appProxies[e.id]||(this.appConfig=this.appConfig.setIn(["appProxies",e.id],e)),this}editAppProxy(e){return this.appConfig=this.appConfig.setIn(["appProxies",e.id],e),this}removeAppProxy(e){return this.appConfig.appProxies&&this.appConfig.appProxies[e]?(this.appConfig=this.appConfig.set("appProxies",this.appConfig.appProxies.without(e)),this):this}addMessage(e){return this.appConfig=this.appConfig.setIn(["messageConfigs",e.id],e),this}editMessage(e){return this.appConfig=this.appConfig.setIn(["messageConfigs",e.id],e),this}removeMessage(e){return this.appConfig.messageConfigs&&this.appConfig.messageConfigs[e.id]?(this.appConfig=this.appConfig.set("messageConfigs",this.appConfig.messageConfigs.without(e.id)),this):this}editTheme(e){return this.appConfig=this.appConfig.set("theme",e),this}editCustomTheme(e){return this.appConfig=this.appConfig.set("customTheme",e),this}editCustomThemeOption(e){return this.appConfig=this.appConfig.set("customThemeOptions",e),this}initHeaderLayout(){const e=this.createLayout(n.LayoutType.FixedLayout);return this.editLayoutProperty(e,"setting.lockDescendants",!0),this.appConfig=this.appConfig.setIn(["layouts",e,"parent"],{id:"",type:n.LayoutParentType.Header}).setIn(["header","layout",this.appConfig.mainSizeMode],e),this}editHeaderProperty(e,t){let i=this.appConfig.header;return i?(i=this.editJsonProperty(i,e,t),this.appConfig=this.appConfig.set("header",i),this):this}initFooterLayout(){const e=this.createLayout(n.LayoutType.FixedLayout);return this.editLayoutProperty(e,"setting.lockDescendants",!0),this.appConfig=this.appConfig.setIn(["layouts",e,"parent"],{id:"",type:n.LayoutParentType.Footer}).setIn(["footer","layout",this.appConfig.mainSizeMode],e),this}editFooterProperty(e,t){let i=this.appConfig.footer;return i?(i=this.editJsonProperty(i,e,t),this.appConfig=this.appConfig.set("footer",i),this):this}setViewportSize(e,t){return this.appConfig=this.appConfig.setIn(["forBuilderAttributes","viewPortSize",e],t),this}setLockLayout(e){return this.appConfig=this.appConfig.setIn(["forBuilderAttributes","lockLayout"],e),this}editAttributes(e){return this.appConfig=this.appConfig.setIn(["attributes"],e),this}updateAnalyticsConfig(e){return this.appConfig=this.appConfig.setIn(["analytics"],e),this}updateCookieBannerConfig(e){return this.appConfig=this.appConfig.setIn(["cookieBanner"],e),this}editCookieBannerConfig(e,t){return this.appConfig="string"==typeof e?this.appConfig.setIn(["cookieBanner",e],t):this.appConfig.setIn(["cookieBanner",...e],t),this}removeCookieBannerConfig(){return this.appConfig=this.appConfig.without("cookieBanner"),this}updateUrlParamsConfig(e){this.appConfig.urlParams||(this.appConfig=this.appConfig.set("urlParams",{}));const t=this.appConfig.urlParams.merge(e);return this.appConfig=this.appConfig.set("urlParams",t),this}getDuplicateLabel(e,t){const[i]=s.parseUniqueLabel(t);let n=s.getUniqueLabel(this.appConfig,e,i);return n===i&&(n=`${i} 1`),n}removePageFromPageStructure(e){if(!this.appConfig.pageStructure)return this;return this.appConfig.pageStructure.find((t=>!!t[e]))?this.appConfig=this.appConfig.set("pageStructure",this.appConfig.pageStructure.flatMap((t=>t[e]?[]:[t]))):this.appConfig.pageStructure.forEach(((t,i)=>{const n=Object.keys(t).find((i=>t[i].includes(e)));if(n)return this.appConfig=this.appConfig.setIn(["pageStructure",i+"",n],t[n].flatMap((t=>t===e?[]:[t]))),!0})),this}movePageIntoPageForPageStructure(e,t){return this.appConfig.pageStructure?(this.appConfig.pageStructure.some(((i,n)=>{const o=Object.keys(i).find((e=>e===t));if(o)return this.appConfig=this.appConfig.setIn(["pageStructure",n+"",o],this.appConfig.pageStructure[n][o].concat([e])),!0})),this):this}editJsonProperty(e,t,i){if(!e)return e;const n=t.split(".").filter((e=>""!==e));if(n.length>0){if(e.getIn(n)===i)return e;if(null==i){if(1===n.length)return e.without(n[0]);const t=n.pop(),i=e.getIn(n);return e.setIn(n,i.without(t))}return e.setIn(n,i)}return e}}},6764:(e,t,i)=>{"use strict";i.d(t,{bf:()=>K,yC:()=>V,zM:()=>r,no:()=>u,YU:()=>z,IE:()=>l.IE,X7:()=>f,rW:()=>W,HA:()=>U,Qi:()=>q,Q7:()=>P});var n=i(9244);class o{addParentToList(e,t,i){if(!t||0===t.length)return[i];if(!t.some((e=>e.layoutId===i.layoutId&&e.layoutItemId===i.layoutItemId))){const n=t[0].layoutId,o=e.layouts[n],s=e.layouts[i.layoutId];if(n===i.layoutId||s.parent.id!==o.parent.id||s.parent.type!==o.parent.type)return[i];return[].concat(t,i)}return t}removeParentFromList(e,t){return e&&0!==e.length?e.filter((e=>e.layoutId!==t.layoutId||e.layoutItemId!==t.layoutItemId)):[]}}var s=i(8249);const a=n.LayoutType.FixedLayout;class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}static getService(e,t){var i;const n=e.layouts[t];return r.getInstance().getServiceByType(null!==(i=null==n?void 0:n.type)&&void 0!==i?i:a)}static getServiceFromSizeModeLayout(e,t){var i;const n=Object.values(t)[0],o=t[e.mainSizeMode];return null!==(i=r.getService(e,n))&&void 0!==i?i:r.getService(e,o)}constructor(){this.serviceMap=new Map}registerService(e,t){this.serviceMap.set(e,t)}getServiceByType(e){return this.serviceMap.get(null!=e?e:a)}}var l=i(320),d=i(1496);const u=new class{removeDataSource(e,t){if(!e.dataSources||!e.dataSources[t])return e;console.debug("removeDataSource",t);let i=e;const n=(0,l.Cp)();try{n.forEach((e=>{if(e.dataSourceWillRemove){if(e.widgetId){const n=i.widgets[e.widgetId];if(!n||!n.useDataSources||!n.useDataSources.find((e=>e.dataSourceId===t||e.mainDataSourceId===t)))return}i=e.dataSourceWillRemove(i,t)}}))}catch(e){console.error("Error when calling dataSourceWillRemove",e)}return i=i.set("dataSources",i.dataSources.without(t)),i=this.removeUseDataSource(i,t),i}removeUseDataSource(e,t){var i,n;if(!t)return e;console.debug("removeUseDataSource",t);let o=e;return Object.entries(null!==(i=o.widgets)&&void 0!==i?i:{}).forEach((([e,i])=>{if(i.useDataSources&&i.useDataSources.find((e=>this.shouldBeRemoved(e,t)))){const n=(0,l.nj)(e);(null==n?void 0:n.useDataSourceWillRemove)&&(o=n.useDataSourceWillRemove(o,t)),o=o.setIn(["widgets",e,"useDataSources"],i.useDataSources.filter((e=>!this.shouldBeRemoved(e,t))))}i.outputDataSources&&i.outputDataSources.find((e=>e===t))&&(o=o.setIn(["widgets",e,"outputDataSources"],i.outputDataSources.filter((e=>e!==t))))})),Object.keys(null!==(n=o.messageConfigs)&&void 0!==n?n:{}).forEach((e=>{var i;const n=null===(i=o.messageConfigs[e].actions)||void 0===i?void 0:i.asMutable({deep:!0});null==n||n.forEach(((i,s)=>{var a;if(null===(a=null==i?void 0:i.useDataSources)||void 0===a?void 0:a.find((e=>this.shouldBeRemoved(e,t)))){if(!i.widgetId){(0,l.Cp)().filter((e=>!e.widgetId)).forEach((e=>{(null==e?void 0:e.useDataSourceWillRemove)&&(o=e.useDataSourceWillRemove(o,t))}))}n[s].useDataSources=i.useDataSources.filter((e=>!this.shouldBeRemoved(e,t))),o=o.setIn(["messageConfigs",e,"actions"],n)}}))})),Object.entries(o.dataSources).forEach((([e,i])=>{i.originDataSources&&i.originDataSources.find((e=>this.shouldBeRemoved(e,t)))&&(o=this.removeDataSource(o,e))})),o}duplicateDataSource(e,t){if(!e.dataSources||!e.dataSources[t])return null;console.debug("duplicate data source",t);const i=e.dataSources[t],n=i.set("id",s.getUniqueId("dataSource")).set("label",(0,l.mz)(e,"dataSource",i.label));return[this.addDataSource(e,n),n]}addDataSource(e,t){return e.dataSources&&e.dataSources[t.id]?e:e.setIn(["dataSources",t.id],t)}updateAfterChangingLayout(e,t,i){if(!e.widgets[t])return e;console.debug(t,"update data source after move to",i);let n=e.widgets[t],o=e;const s=d.searchUtils.getWidgetIdThatUseTheLayoutId(o,i);if(s){const e=o.widgets[s];e.manifest.properties.passDataSourceToChildren&&(n=this.mergeUseDataSource(e,n),o=o.setIn(["widgets",n.id],n))}return o}mergeUseDataSource(e,t){if(!e.useDataSources)return t;const i=e.useDataSources.map((e=>e.without("fields")));return t.useDataSources?(i.forEach((e=>{e.dataViewId?t.useDataSources.find((t=>t.dataSourceId===e.dataSourceId&&t.dataViewId===e.dataViewId))||(t=t.set("useDataSources",t.useDataSources.concat([e]))):t.useDataSources.find((t=>t.dataSourceId===e.dataSourceId))||(t=t.set("useDataSources",t.useDataSources.concat([e])))})),t.set("useDataSourcesEnabled",!0)):t.set("useDataSources",i).set("useDataSourcesEnabled",!0)}shouldBeRemoved(e,t){return!e||e.dataSourceId===t||e.mainDataSourceId===t||e.rootDataSourceId===t}};const c=new class{duplicate(e,t,i){const n=e.messageConfigs;if(!n)return[e,null];console.debug("duplicate message configs from",t,"to",i);let o=e,a=null;return Object.keys(n).forEach((e=>{if(n[e].widgetId===t){const t=n[e].set("id",s.getUniqueId("messageConfig")).set("widgetId",i);a=t.id,o=o.setIn(["messageConfigs",t.id],t)}if(n[e].actions){const s=[];n[e].actions.forEach((e=>{if(e.widgetId===t){const t=e.set("widgetId",i);s.push(t)}})),s.length>0&&(o=o.setIn(["messageConfigs",n[e].id,"actions"],n[e].actions.concat(s)))}})),[o,a]}removeFromWidget(e,t){const i=e.messageConfigs;if(!i)return e;console.debug("remove message and action in",t);const o=Object.keys(i);let s=(0,n.Immutable)({});for(let e=0;e<o.length;e++)i[o[e]].widgetId!==t&&(s=s.setIn([i[o[e]].id],i[o[e]]));const a=Object.keys(s);for(let e=0;e<a.length;e++){const n=s[a[e]].actions;if(0===n.length)continue;const o=n.filter((e=>e.widgetId!==t)),r=Object.assign([],o);s=s.setIn([i[a[e]].id,"actions"],r)}return e.set("messageConfigs",s)}};const p=new class{removeFromWidget(e,t){var i;const n=e.widgets[t];if(!(null===(i=n.manifest)||void 0===i?void 0:i.dataActions)||0===n.manifest.dataActions.length)return e;console.debug("remove data action in",t);const o=n.manifest.dataActions.map((e=>e.name));let s=e;return Object.keys(e.widgets).forEach((i=>{let n=e.widgets[i];n.dataActions&&o.forEach((e=>{var o,a;const r=null===(o=n.dataActions)||void 0===o?void 0:o[e];if(r){const o=null===(a=r.actions)||void 0===a?void 0:a.without(t);0===Object.keys(o||{}).length?(n=n.set("dataActions",n.dataActions.without(e)),0===Object.keys(n.dataActions).length&&(n=n.without("dataActions"))):n=n.setIn(["dataActions",e,"actions"],o),s=s.setIn(["widgets",i],n)}}))})),s}};const g=new class{remove(e,t){let i=e;return console.debug("remove used map widgets",t),Object.keys(i.widgets).forEach((e=>{var n;const o=i.widgets[e];if(null===(n=o.useMapWidgetIds)||void 0===n?void 0:n.includes(t)){const n=o.useMapWidgetIds.filter((e=>e!==t));i=i.setIn(["widgets",e,"useMapWidgetIds"],n)}})),i}};function h(e,t){return e.layoutId===t.layoutId&&e.layoutItemId===t.layoutItemId}const f=new class{isSupported(){var e,t,i;let o;window.jimuConfig.isInBuilder?o=(0,n.getAppStore)().getState():window.jimuConfig.isBuilder&&(o=(0,n.getAppStore)().getState().appStateInBuilder);const s=(null===(e=null==o?void 0:o.appInfo)||void 0===e?void 0:e.type)===n.AppType.Template,a=(null===(t=null==o?void 0:o.appRuntimeInfo)||void 0===t?void 0:t.appMode)===n.AppMode.Design,r=(null===(i=null==o?void 0:o.appRuntimeInfo)||void 0===i?void 0:i.appMode)===n.AppMode.Express;return s&&a||r}getNextPlaceholderId(e){var t;const i=Object.keys(null!==(t=e.placeholderInfos)&&void 0!==t?t:{}).map((e=>+e)).sort(((e,t)=>e-t));let n=1;for(let e=0;e<i.length&&n===i[e];e++)n++;return n}addAsSyncablePlaceholder(e,t){if(!this.isSupported())return e;const i=(0,n.getAppStore)().getState().browserSizeMode;if(i!==e.mainSizeMode)return e;const o=d.searchUtils.getRootContainerInfoOfLayout(e,t.layoutId,i),s=this.getNextPlaceholderId(e);return e.setIn(["placeholderInfos",`${s}`,"id"],s).setIn(["placeholderInfos",`${s}`,"rootContainer"],o).setIn(["placeholderInfos",`${s}`,"layoutInfo"],t)}getPlaceholderInfo(e,t){var i;if(!this.isSupported())return null;let n=null;return Object.keys(null!==(i=e.placeholderInfos)&&void 0!==i?i:{}).some((i=>{var o;const s=e.placeholderInfos[i];return h(s.layoutInfo,t)?(n=s,!0):Object.keys(null!==(o=s.syncs)&&void 0!==o?o:{}).some((e=>!!h(s.syncs[e],t)&&(n=s,!0)))})),n}afterLayoutItemMoved(e,t,i){var n;if(!this.isSupported())return e;let o=e;const s=this.getPlaceholderInfo(e,t);if(s){if(h(s.layoutInfo,t))return o=o.setIn(["placeholderInfos",s.id,"layoutInfo"],i),o;const e=Object.keys(null!==(n=s.syncs)&&void 0!==n?n:{});for(let n=0;n<e.length;n++){const a=e[n];if(h(s.syncs[a],t))return o=o.setIn(["placeholderInfos",s.id,"syncs",a],i),o}}return o}afterLayoutItemCopied(e,t,i){if(!this.isSupported())return e;const n=d.searchUtils.findLayoutItem(e,t);if(n.widgetId||n.sectionId)return e;const o=this.getPlaceholderInfo(e,t);return o&&h(o.layoutInfo,t)?this.addAsSyncablePlaceholder(e,i):e}afterLayoutItemRemoved(e,t){var i;if(!this.isSupported())return e;const n=this.getPlaceholderInfo(e,t);if(n){const o=e.placeholderInfos;if(h(n.layoutInfo,t))return e.set("placeholderInfos",o.without(n.id));const s=Object.keys(null!==(i=n.syncs)&&void 0!==i?i:{});for(let i=0;i<s.length;i++){const o=s[i];if(h(n.syncs[o],t))return 1===s.length?e.setIn(["placeholderInfos",n.id],n.without("syncs")):e.setIn(["placeholderInfos",n.id,"syncs"],n.syncs.without(o))}}return e}};var m=i(4601),y=i(9859),v=i.n(y),S=i(8850),I=i.n(S),w=i(1341),C=i.n(w),b=i(8201),A=i.n(b),x=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function M(e){var t,i;return(null==e?void 0:e.widgetType)===n.WidgetType.Layout||null!==(i=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.hasEmbeddedLayout)&&void 0!==i&&i}function T(e){switch(e){case n.LayoutType.FixedLayout:return I();case n.LayoutType.RowLayout:return C();case n.LayoutType.ColumnLayout:return A();default:return null}}const P=new class extends o{constructor(){super(),this.dsService=u,this.messageActionService=c,this.dataActionService=p,this.useMapService=g}createFromTemplate(e,t,i,o,a,d){return x(this,void 0,void 0,(function*(){var u,c;if(a[i]){const s=e.widgets[a[i]];if(!s.layouts)return[e,a[i]];let l=e;const d=t.config.widgets[i];for(let e=0;e<o.length;e++){const u=o[e],c=Object.keys(d.layouts).filter((e=>{var t;return Object.keys(null!==(t=d.layouts[e])&&void 0!==t?t:{}).length>0}));for(let e=0;e<c.length;e++){const o=c[e];if(s.layouts[o][u])continue;const p=d.layouts[o][u],g=r.getService(t.config,p),h=yield g.createLayoutFromTemplate(l,t,p,u,n.LayoutParentType.Widget,a[i],a);l=h[0];const f=h[1];null!=f&&(l=l.setIn(["widgets",a[i],"layouts",o,u],f))}}return[l,a[i]]}const p=null!==(u=null==d?void 0:d.isBlock)&&void 0!==u&&u;yield(0,l.IE)(t);const g=t.config,h=Object.keys(g.widgets).find((e=>"widgets/layout/row/"===g.widgets[e].uri));i=null!=i?i:h;const f=g.widgets[i],y=[],v=yield m.A.getInstance().handleNewWidgetJson({uri:f.uri});v.label=s.getUniqueLabel(e,"widget",v.manifest?v.manifest.i18nMessages._widgetLabel||v.manifest.label||v.manifest.name:"");const S=this.createWidget(e,v,o,!1);let I=S[0];const w=S[1];if(yield m.A.getInstance().registerManifestProps(I.widgets[w]),p){const e=n.i18n.getIntl().formatMessage({id:"block"}),t=s.getUniqueLabel(I,"widget",e);I=I.setIn(["widgets",w,"label"],t)}if(a[i]=w,(null===(c=f.useMapWidgetIds)||void 0===c?void 0:c.length)>0)for(let e=0;e<f.useMapWidgetIds.length;e++){const i=yield this.createFromTemplate(I,t,f.useMapWidgetIds[e],o,a,d);I=i[0],y.push(i[1])}return y.length>0&&(I=I.setIn(["widgets",w,"useMapWidgetIds"],y)),I=yield this.updateWidgetByTemplate(I,t,w,i,o,a),[I,w]}))}updateWidgetByTemplate(e,t,i,o,s,a){return x(this,void 0,void 0,(function*(){var d,u,c;const p=null===(d=null==e?void 0:e.widgets)||void 0===d?void 0:d[i];if(!p)return e;yield(0,l.IE)(t);let g=e;p.layouts&&Object.keys(p.layouts).forEach((e=>{const t=p.layouts[e];Object.keys(t).forEach((e=>{const i=t[e],n=r.getService(g,i);g=n.removeLayout(g,i,e)}))})),g=g.setIn(["widgets",i],p.without("layouts"));const h=null==t?void 0:t.config,f=null===(u=null==h?void 0:h.widgets)||void 0===u?void 0:u[o],m=[];if(f&&(f.config&&(g=g.setIn(["widgets",i,"config"],f.config)),f.style&&(g=g.setIn(["widgets",i,"style"],f.style)),f.layouts)){const i=f.layouts,o=[];Object.keys(i).forEach((t=>{var n,a;const r=i[t]||{},l=(null!==(a=null===(n=p.manifest)||void 0===n?void 0:n.layouts)&&void 0!==a?a:[]).find((e=>e.name===t));s.forEach((i=>{var n;const s=null!==(n=r[i])&&void 0!==n?n:r[e.mainSizeMode];s&&o.push({layoutName:t,sizeMode:i,layoutId:s,layoutLabel:null==l?void 0:l.label})}))}));for(let e=0;e<o.length;e+=1){const{layoutName:i,sizeMode:s,layoutId:l,layoutLabel:d}=o[e],u=r.getService(h,l),f=yield u.createLayoutFromTemplate(g,t,l,s,n.LayoutParentType.Widget,p.id,a);g=f[0];const y=f[1];m.push(y),g=g.setIn(["widgets",p.id,"layouts",i,s],y).setIn(["layouts",y,"label"],(null===(c=null==p?void 0:p.manifest)||void 0===c?void 0:c.i18nMessages[`_layout_${i}_label`])||d||i)}}return g}))}createWidget(e,t,i,o=!0){let a=e;const l=s.getUniqueId("widget");if(console.debug("createWidget",t),a=a.setIn(["widgets",l],t).setIn(["widgets",l,"id"],l),o&&M(t.manifest)){(t.manifest.layouts||[]).forEach((e=>{i.forEach((i=>{const o=r.getInstance().getServiceByType(e.type).createBlankLayout(a,e.type);a=o[0];const s=o[1];console.debug("embed layout",e.name,s,e.type,"created in",i),a=a.setIn(["layouts",s,"label"],t.manifest.i18nMessages[`_layout_${e.name}_label`]||e.label).setIn(["layouts",s,"parent"],{id:l,type:n.LayoutParentType.Widget}).setIn(["widgets",l,"layouts",e.name,i],s)}))}))}return[a,l]}duplicateEmbedLayout(e,t,i,o){var a;const l=e.widgets[t];if(!l||!l.layouts)return[e,null];let d=e;if(console.debug("duplicate layout of widget",t),(null===(a=l.manifest)||void 0===a?void 0:a.widgetType)===n.WidgetType.Layout&&i!==o){console.debug("deuplicate layout widget and its layout from",i,"to",o);const e=l.set("id",s.getUniqueId("widget")).without("layouts").without("parent");return d=d.setIn(["widgets",e.id],e),Object.keys(l.layouts).forEach((t=>{const s=l.layouts[t];if(s[i]){const a=r.getService(d,s[i]).duplicateLayout(d,s[i],i,o,null,!1);d=a[0];const l=a[1];null!=l&&(d=d.setIn(["layouts",l,"parent"],{type:n.LayoutParentType.Widget,id:e.id}).setIn(["widgets",e.id,"layouts",t,o],l))}})),[d,e.id]}return console.debug("duplicate widget layout only from",i,"to",o),Object.keys(l.layouts).forEach((e=>{const s=l.layouts[e];if(s[i]&&i!==o){const a=r.getService(d,s[i]);s[o]&&(d=a.removeLayout(d,s[o],o));const l=a.duplicateLayout(d,s[i],i,o,null,!1);d=l[0];const u=l[1];null!=u&&(d=d.setIn(["layouts",u,"parent"],{type:n.LayoutParentType.Widget,id:t}).setIn(["widgets",t,"layouts",e,o],u))}})),[d,null]}duplicate(e,t,i,o){console.debug("duplicate a widget",t);const a=e.widgets[t];if(!a)return[e,null];if(null==o?void 0:o[t]){const s=e.widgets[o[t]];if(!s.layouts)return[e,o[t]];const a=Object.keys(s.layouts)[0];if(s.layouts[a][i])return[e,o[t]];const l=e.widgets[t];let d=e;return Object.keys(l.layouts).forEach((e=>{const s=l.layouts[e][i],a=r.getService(d,s).duplicateLayout(d,s,i,i,o,!0);d=a[0];const u=a[1];null!=u&&(d=d.setIn(["widgets",o[t],"layouts",e,i],u).setIn(["layouts",u,"parent"],{type:n.LayoutParentType.Widget,id:o[t]}))})),[d,o[t]]}const d=a.set("id",s.getUniqueId("widget")).set("label",(0,l.mz)(e,"widget",a.label)),u=this.beforeDuplicated(e,t,d,i,o);return o&&(o[t]=d.id),[u,d.id]}tryRemove(e,t,i,o){var s,a,l;const d=null===(s=e.widgets)||void 0===s?void 0:s[t];if(!d)return e;const u=[n.BrowserSizeMode.Large,n.BrowserSizeMode.Medium,n.BrowserSizeMode.Small].filter((e=>e!==o)).some((e=>{var t,i;return(null===(i=null===(t=d.parent)||void 0===t?void 0:t[e])||void 0===i?void 0:i.length)>0})),c=(null===(l=null===(a=d.parent)||void 0===a?void 0:a[o])||void 0===l?void 0:l.length)>1;if(u||c){let n=this.removeParent(e,t,i,o);return d.layouts&&Object.keys(d.layouts).forEach((e=>{const i=d.layouts[e];if(i[o]){const s=r.getServiceFromSizeModeLayout(n,i);n=s.removeSizeModeLayouts(n,{[o]:i[o]}),n=n.setIn(["widgets",t,"layouts",e],i.without(o))}})),n}return this.remove(e,t)}remove(e,t){var i;if(!(null===(i=e.widgets)||void 0===i?void 0:i[t]))return e;console.debug("remove a widget",t);const n=this.beforeRemoved(e,t);return n.set("widgets",n.widgets.without(t))}toTocNode(e,t,i,o){var s,a,l,d;const{layoutId:u,layoutItemId:c}=i,p={label:"",layoutId:u,layoutItemId:c,type:"widget",id:t},g=null===(s=e.widgets)||void 0===s?void 0:s[t];if(!g)return null==t&&(p.label=n.i18n.getIntl().formatMessage({id:"placeholder"}),p.icon=v(),p.flipIcon=!1,p.isLabelReadOnly=!0),p;if(p.label=g.label,p.icon=g.icon,p.flipIcon=null!==(d=null===(l=null===(a=g.manifest)||void 0===a?void 0:a.properties)||void 0===l?void 0:l.flipIcon)&&void 0!==d&&d,!(null==g?void 0:g.layouts))return p;const h=[],f=1===Object.keys(g.layouts).length;return Object.keys(g.layouts).forEach((t=>{var i,n,s,a;const l=null!==(i=g.layouts[t][o])&&void 0!==i?i:g.layouts[t][e.mainSizeMode],d=r.getService(e,l).getTocStructure(e,l);if(d.length>0){const i=e.layouts[l].type,o=null===(s=null===(n=g.manifest)||void 0===n?void 0:n.layouts)||void 0===s?void 0:s.find((e=>e.name===t));h.push({label:f?"":null!=o?null!==(a=g.manifest.i18nMessages[`_layout_${t}_label`])&&void 0!==a?a:o.label:t,icon:T(i),type:"layout",id:l,isLabelReadOnly:!0,children:d})}})),1===h.length?p.children=h[0].children:h.length>1&&(p.children=h),p}afterMoved(e,t,i,n){return e.widgets[t]?(console.debug("update widget",t,"ds after moved to a new layout",n),this.dsService.updateAfterChangingLayout(e,t,n)):e}afterAdded(e,t,i,o,s){var a;const l=e.widgets[t];if(!l)return e;console.debug("after added, update widget",t,"added to a new layout",i,"from",o,"to",s);let d=this.dsService.updateAfterChangingLayout(e,t,i);return Object.keys(null!==(a=l.layouts)&&void 0!==a?a:{}).forEach((e=>{const i=l.layouts[e];if(i[o]&&!i[s]){const a=d.layouts[i[o]],l=r.getService(d,i[o]).duplicateLayout(d,a.id,o,s,null);d=l[0];const u=l[1];null!=u&&(d=d.setIn(["layouts",u,"parent"],{type:n.LayoutParentType.Widget,id:t}).setIn(["widgets",t,"layouts",e,s],u))}})),d}beforeRemoved(e,t){var i,o,s,a,d;const u=e.widgets[t];let c=e;console.debug("clear widget resource before removing",t);(0,l.Cp)().forEach((e=>{if(e.anyWidgetWillRemove)try{c=e.anyWidgetWillRemove(c,t)}catch(e){console.error("Error when calling anyWidgetWillRemove",e)}}));const p=window.isExpressBuilder||(null===(i=window.parent)||void 0===i?void 0:i.isExpressBuilder),g=Object.keys(null!==(o=u.parent)&&void 0!==o?o:{}).length;if(p&&g>1){const t=u.parent[e.mainSizeMode][0];c=f.addAsSyncablePlaceholder(c,t);const i=f.getPlaceholderInfo(c,t);[n.BrowserSizeMode.Large,n.BrowserSizeMode.Medium,n.BrowserSizeMode.Small].filter((t=>t!==e.mainSizeMode)).forEach((e=>{var t;if((null===(t=u.parent[e])||void 0===t?void 0:t.length)>0){const t=u.parent[e][0];c=c.setIn(["placeholderInfos",i.id,"syncs",e],t)}}))}if(Object.keys(null!==(s=u.parent)&&void 0!==s?s:{}).forEach((e=>{u.parent[e].length>0&&u.parent[e].forEach((t=>{if(c.layouts[t.layoutId]){const i=r.getService(c,t.layoutId);c=i.removeItem(c,t,e,!1)}}))})),u.outputDataSources&&u.outputDataSources.forEach((e=>{c=this.dsService.removeDataSource(c,e)})),c=this.messageActionService.removeFromWidget(c,t),c=this.dataActionService.removeFromWidget(c,t),u.layouts&&Object.keys(u.layouts).forEach((e=>{const t=u.layouts[e],i=r.getServiceFromSizeModeLayout(c,t);c=i.removeSizeModeLayouts(c,t)})),null===(d=null===(a=u.manifest)||void 0===a?void 0:a.properties)||void 0===d?void 0:d.canCreateMapView){const e=(0,l.Cp)();try{e.forEach((e=>{if(!e.mapWidgetWillRemove)return;if(e.widgetId===t)return;const i=c.widgets[e.widgetId];i&&i.useMapWidgetIds&&i.useMapWidgetIds.find((e=>e===t))&&(c=e.mapWidgetWillRemove(c,t))}))}catch(e){console.error("Error when calling mapWidgetWillRemove",e)}c=this.useMapService.remove(c,u.id)}const h=(0,l.nj)(t);if(h&&h.widgetWillRemove)try{c=h.widgetWillRemove(c)}catch(e){console.error("Error when calling widgetWillRemove",e)}return c}beforeDuplicated(e,t,i,o,s){var a,l,d;let u=e;if(console.debug("process before duplicate widget",t),M(i.manifest)&&(u=u.setIn(["widgets",i.id],i),Object.keys(null!==(a=i.layouts)&&void 0!==a?a:{}).forEach((t=>{var a;const l=i.layouts[t],d=null!=s?s:{},c=r.getServiceFromSizeModeLayout(u,l).duplicateSizeModeLayouts(u,{[o]:null!==(a=l[o])&&void 0!==a?a:l[e.mainSizeMode]},n.LayoutParentType.Widget,i.id,d);u=c[0],i=i.setIn(["layouts",t],c[1])}))),u=this.messageActionService.duplicate(u,t,i.id)[0],(null===(l=i.outputDataSources)||void 0===l?void 0:l.length)>0){const e=i.outputDataSources.map((e=>{const t=this.dsService.duplicateDataSource(u,e);u=t[0];return t[1].id}));i=i.set("outputDataSources",e);let t=JSON.stringify(i.config);e.forEach(((e,n)=>{const o=i.outputDataSources[n],s=new RegExp(o,"g");t=t.replace(s,e)}));try{const e=JSON.parse(t);i=i.set("config",e)}catch(e){console.error("JSON format error",i)}}return(null===(d=i.useMapWidgetIds)||void 0===d?void 0:d.length)>0&&i.useMapWidgetIds.forEach(((e,t)=>{(null==s?void 0:s[e])&&(i=i.setIn(["useMapWidgetIds",t],s[e]))})),u=u.setIn(["widgets",i.id],i),u}afterBatchCopied(e,t,i){let n=e;return Object.keys(null!=i?i:{}).forEach((o=>{const s=i[o];if(t.widgets[o]&&n.widgets[s]){let a;if(e===t){if(a=(0,l.nj)(o),a&&a.afterWidgetCopied)try{n=a.afterWidgetCopied(o,t,s,n,i)}catch(e){console.error("Error when calling afterWidgetCopied",e)}}else if(a=(0,l.nj)(s),a&&a.afterWidgetCopied)try{n=a.afterWidgetCopied(o,t,s,n,i)}catch(e){console.error("Error when calling afterWidgetCopied",e)}}})),n}addParent(e,t,i,n){var o;const s=e.widgets[t];if(!s)return e;console.debug("add parent",i.layoutId,i.layoutItemId,"to widget",t,"in",n);const a=this.addParentToList(e,null===(o=s.parent)||void 0===o?void 0:o[n],i);return e.setIn(["widgets",t,"parent",n],a)}removeParent(e,t,i,n){const o=e.widgets[t];if(!o||null==o.parent)return e;if(console.debug("remove parent",i.layoutId,i.layoutItemId,"from widget",t,"in",n),n){const s=o.parent[n],a=this.removeParentFromList(s,i);return 0===a.length?e.setIn(["widgets",t,"parent"],o.parent.without(n)):e.setIn(["widgets",t,"parent",n],a)}let s=e;return Object.keys(o.parent).forEach((e=>{const n=o.parent[e],a=this.removeParentFromList(n,i);s=0===a.length?s.setIn(["widgets",t,"parent"],o.parent.without(e)):s.setIn(["widgets",t,"parent",e],a)})),s}clearParent(e,t){const i=e.widgets[t];return i&&null!=i.parent?e.setIn(["widgets",t],i.without("parent")):e}removeSizeModeParent(e,t,i){var n;const o=e.widgets[t];return o&&null!=(null===(n=o.parent)||void 0===n?void 0:n[i])?e.setIn(["widgets",t,"parent"],o.parent.without(i)):e}findParent(e,t,i){var n,o;const s=e.widgets[t];if(!s||!s.parent)return null;const a=null!==(n=s.parent[i])&&void 0!==n?n:s.parent[e.mainSizeMode];if(!a)return null;if(1===a.length)return a[0];const r=a[0].layoutId,l=e.layouts[r];return this.findParent(e,null===(o=l.parent)||void 0===o?void 0:o.id,i)}hasParent(e,t,i){var n,o;const s=e.widgets[t];return!(!s||!s.parent)&&(null===(o=null===(n=s.parent)||void 0===n?void 0:n[i])||void 0===o?void 0:o.length)>0}hasMultipleParents(e,t,i){var n,o;const s=e.widgets[t];return!(!s||!s.parent)&&(null===(o=null===(n=s.parent)||void 0===n?void 0:n[i])||void 0===o?void 0:o.length)>1}};var L=i(8736),D=i.n(L),j=i(2606),E=i.n(j),R=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};const U=new class extends o{createFromTemplate(e,t,i,o,a){return R(this,void 0,void 0,(function*(){if(a[i]){const s=e.sections[a[i]],l=e.views[s.views[0]],d=t.config.sections[i];let u=e;for(let e=0;e<o.length;e++){const i=o[e];if(!l.layout[i])for(let e=0;e<d.views.length;e++){const o=d.views[e],s=t.config.views[o].layout[i],l=r.getService(t.config,s),c=yield l.createLayoutFromTemplate(u,t,s,i,n.LayoutParentType.View,a[o],a);u=c[0];const p=c[1];null!=p&&(u=u.setIn(["views",a[o],"layout",i],p))}}return[u,a[i]]}yield(0,l.IE)(t);let d=e;const u=t.config.sections[i],c=s.getUniqueId("section");d=d.setIn(["sections",c],u).setIn(["sections",c,"id"],c).setIn(["sections",c,"label"],s.getUniqueLabel(e,"section",n.i18n.getIntl().formatMessage({id:"section"})));const p=[];for(let e=0;e<u.views.length;e+=1){const i=u.views[e],n=yield this.createViewFromTemplate(d,t,i,o,a);d=n[0],p.push(n[1]),d=d.setIn(["views",n[1],"parent"],c)}return d=d.setIn(["sections",c,"views"],p),a[i]=c,[d,c]}))}createViewFromTemplate(e,t,i,o,a){return R(this,void 0,void 0,(function*(){let o=e;yield(0,l.IE)(t);const d=t.config,u=d.views[i],c=s.getUniqueId("view");o=o.setIn(["views",c],u).setIn(["views",c,"id"],c).setIn(["views",c,"label"],s.getUniqueLabel(e,"view",n.i18n.getIntl().formatMessage({id:"view"})));const p=[];Object.keys(u.layout||{}).forEach((e=>{p.push({sizeMode:e,layoutId:u.layout[e]})}));for(let e=0;e<p.length;e+=1){const{sizeMode:i,layoutId:s}=p[e],l=r.getService(d,s),u=yield l.createLayoutFromTemplate(o,t,s,i,n.LayoutParentType.View,c,a);o=u[0];const g=u[1];o=o.setIn(["views",c,"layout",i],g)}return a&&(a[i]=c),[o,c]}))}duplicateEmbedLayout(e,t,i,o){var s;const a=null===(s=e.sections)||void 0===s?void 0:s[t];if(!a)return[e,null];let l=e;return console.debug(`duplicate section ${t} from ${i} to ${o}`),a.views.forEach((e=>{const t=l.views[e].layout;if(t[i]&&!t[o]){const s=r.getService(l,t[i]).duplicateLayout(l,t[i],i,o,null,!1);l=s[0];const a=s[1];null!=a&&(l=l.setIn(["layouts",a,"parent"],{type:n.LayoutParentType.View,id:e}).setIn(["views",e,"layout",o],a))}})),[l,null]}duplicate(e,t,i,o){var a;console.debug("dplicate section",t,"in",i);const d=null===(a=e.sections)||void 0===a?void 0:a[t];if(!d)return[e,null];if(null==o?void 0:o[t]){const s=e.sections[o[t]];if(e.views[s.views[0]].layout[i])return[e,o[t]];const a=e.sections[t];let l=e;return a.views.forEach((e=>{const t=l.views[e].layout[i],s=r.getService(l,t).duplicateLayout(l,t,i,i,o,!0);l=s[0];const a=s[1];null!=a&&(l=l.setIn(["views",o[e],"layout",i],a).setIn(["layouts",a,"parent"],{type:n.LayoutParentType.View,id:o[e]}))})),[l,o[t]]}let u=d.set("id",s.getUniqueId("section")).set("label",(0,l.mz)(e,"section",d.label)),c=e.setIn(["sections",u.id],u);const p=d.views.map((e=>{const t=this.duplicateView(c,d.id,e,[i],!1,o);c=t[0];const n=t[1];return c=c.setIn(["views",n,"parent"],u.id),n}));return u=u.set("views",p),c=c.setIn(["sections",u.id],u),o&&(o[t]=u.id),[c,u.id]}removeDirectly(e,t){var i;const n=null===(i=e.sections)||void 0===i?void 0:i[t];let o=e;return n.views.forEach((e=>{const t=o.views[e],i=r.getServiceFromSizeModeLayout(o,t.layout);o=i.removeSizeModeLayouts(o,t.layout),o=o.set("views",o.views.without(e))})),o=o.set("sections",o.sections.without(t)),o}tryRemove(e,t,i,o){var s;const a=null===(s=e.sections)||void 0===s?void 0:s[t];if(!a)return e;console.debug(`remove section ${t} from ${i.layoutId} ${i.layoutItemId}`,o);const l=[n.BrowserSizeMode.Large,n.BrowserSizeMode.Medium,n.BrowserSizeMode.Small].filter((e=>e!==o)).some((e=>{var t,i;return(null===(i=null===(t=a.parent)||void 0===t?void 0:t[e])||void 0===i?void 0:i.length)>0}));if(l){let n=this.removeParent(e,t,i,o);return a.views.forEach((e=>{const t=n.views[e];if(t.layout[o]){const i=r.getServiceFromSizeModeLayout(n,t.layout);n=i.removeSizeModeLayouts(n,{[o]:t.layout[o]}),n=n.setIn(["views",e,"layout"],t.layout.without(o))}})),n}return this.remove(e,t)}remove(e,t){var i,n;const o=null===(i=e.sections)||void 0===i?void 0:i[t];if(!o)return e;console.debug("remove section",t);let s=e;return Object.keys(null!==(n=o.parent)&&void 0!==n?n:{}).forEach((e=>{o.parent[e].length>0&&o.parent[e].forEach((t=>{if(s.layouts[t.layoutId]){const i=r.getService(s,t.layoutId);s=i.removeItem(s,t,e,!1)}}))})),this.removeDirectly(s,t)}toTocNode(e,t,i,n){var o,s;const{layoutId:a,layoutItemId:l}=i,d={label:"",layoutId:a,layoutItemId:l,type:"section",id:t,children:[]},u=null===(o=e.sections)||void 0===o?void 0:o[t];return u?(d.label=u.label,d.icon=null!==(s=u.icon)&&void 0!==s?s:D(),d.flipIcon=!0,u.views.forEach((t=>{var i,o;const s=e.views[t],a=null!==(i=s.layout[n])&&void 0!==i?i:s.layout[e.mainSizeMode],l=r.getService(e,a).getTocStructure(e,a);d.children.push({label:s.label,icon:null!==(o=s.icon)&&void 0!==o?o:E(),flipIcon:!1,type:"view",id:t,children:l})})),d):d}afterMoved(e,t,i,n){return e}afterAdded(e,t,i,o,s){var a;const l=null===(a=e.sections)||void 0===a?void 0:a[t];if(!l)return e;let d=e;return l.views.forEach((e=>{const t=d.views[e];if(t.layout[o]&&!t.layout[s]){const i=d.layouts[t.layout[o]],a=r.getService(d,t.layout[o]).duplicateLayout(d,i.id,o,s,null);d=a[0];const l=a[1];null!=l&&(d=d.setIn(["layouts",l,"parent"],{type:n.LayoutParentType.View,id:e}).setIn(["views",e,"layout",s],l))}})),d}addParent(e,t,i,n){var o;const s=e.sections[t];if(!s)return e;console.debug("add parent",i.layoutId,i.layoutItemId,"to section",t,"in",n);const a=this.addParentToList(e,null===(o=s.parent)||void 0===o?void 0:o[n],i);return e.setIn(["sections",t,"parent",n],a)}removeParent(e,t,i,n){const o=e.sections[t];if(!o||null==o.parent)return e;if(console.debug("remove parent",i.layoutId,i.layoutItemId,"from section",t,"in",n),n){const s=o.parent[n],a=this.removeParentFromList(s,i);return 0===a.length?e.setIn(["sections",t,"parent"],o.parent.without(n)):e.setIn(["sections",t,"parent",n],a)}let s=e;return Object.keys(o.parent).forEach((e=>{const n=o.parent[e],a=this.removeParentFromList(n,i);s=0===a.length?s.setIn(["sections",t,"parent"],o.parent.without(e)):s.setIn(["sections",t,"parent",e],a)})),s}clearParent(e,t){const i=e.sections[t];return i&&null!=i.parent?e.setIn(["sections",t],i.without("parent")):e}removeSizeModeParent(e,t,i){var n;const o=e.sections[t];return o&&null!=(null===(n=o.parent)||void 0===n?void 0:n[i])?e.setIn(["sections",t,"parent"],o.parent.without(i)):e}findParent(e,t,i){var n,o;const s=e.sections[t];if(!s.parent)return null;const a=null!==(n=s.parent[i])&&void 0!==n?n:s.parent[e.mainSizeMode];if(!a)return null;if(1===a.length)return a[0];const r=a[0].layoutId,l=e.layouts[r];return P.findParent(e,null===(o=l.parent)||void 0===o?void 0:o.id,i)}hasParent(e,t,i){var n;const o=e.sections[t];return!!o.parent&&(null===(n=o.parent[i])||void 0===n?void 0:n.length)>0}hasMultipleParents(e,t,i){var n;const o=e.sections[t];return!!o.parent&&(null===(n=o.parent[i])||void 0===n?void 0:n.length)>0}createSection(e,t){console.debug("create a blank section",t);const i=s.getUniqueId("section"),o={id:i,label:s.getUniqueLabel(e,"section",n.i18n.getIntl().formatMessage({id:"section"})),views:[]};let a=e.setIn(["sections",o.id],o);return a=this.addView(a,i,t)[0],[a,i]}createBlankView(e,t){return{id:s.getUniqueId("view"),parent:t,label:s.getUniqueLabel(e,"view",n.i18n.getIntl().formatMessage({id:"view"}))}}addView(e,t,i){var o;const a=null===(o=e.sections)||void 0===o?void 0:o[t];if(!a)return[e,null];let r;const l=this.createBlankView(e,t);a.views?(r=a.views.asMutable(),r.push(l.id)):r=[l.id];let d=e.setIn(["views",l.id],l).setIn(["sections",t,"views"],r);return i.forEach((e=>{const t={id:s.getUniqueId("layout"),type:n.LayoutType.FixedLayout,content:{},parent:{id:l.id,type:n.LayoutParentType.View}};d=d.setIn(["layouts",t.id],t).setIn(["views",l.id,"layout",e],t.id)})),[d,l.id]}duplicateView(e,t,i,o,a,d){if(!e.views||!e.views[i])return[e,null];console.debug("duplicate a view",i,"in",o);let u=e.views[i].set("id",s.getUniqueId("view"));u=u.set("label",(0,l.mz)(e,"view",u.label)),a||(u=u.without("parent"));let c=e.setIn(["views",u.id],u);const p={};o.forEach((e=>{p[e]=u.layout[e]}));const g=null!=d?d:{},h=r.getServiceFromSizeModeLayout(c,p).duplicateSizeModeLayouts(c,p,n.LayoutParentType.View,u.id,g);if(c=h[0],u=u.set("layout",h[1]),c=c.setIn(["views",u.id],u),a){const e=c.sections[t].views.asMutable(),n=e.indexOf(i);e.splice(n,1,i,u.id),c=c.setIn(["sections",t,"views"],e)}return d&&(d[i]=u.id),[c,u.id]}removeView(e,t,i){var n,o;const s=null===(n=e.sections)||void 0===n?void 0:n[t],a=null===(o=e.views)||void 0===o?void 0:o[i];if(!a||!s||1===s.views.length||!s.views.includes(i))return e;console.debug("remove a view",i,"from",t);const l=s.views.filter((e=>e!==i));let d=e.setIn(["sections",t,"views"],l);return d=r.getServiceFromSizeModeLayout(d,a.layout).removeSizeModeLayouts(d,a.layout),d=d.set("views",d.views.without(i)),d}};var O=i(9218),k=i.n(O),_=i(7528),B=i.n(_),G=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};const W=new class extends o{createFromTemplate(e,t,i,o,a){return G(this,void 0,void 0,(function*(){if(a[i])return[e,a[i]];let r=e;console.debug("create screen group",i,"from template in",o),yield(0,l.IE)(t);const d=t.config;i=null!=i?i:Object.keys(d.screenGroups)[0];const u=d.screenGroups[i],c=s.getUniqueId("screenGroup");r=r.setIn(["screenGroups",c],u).setIn(["screenGroups",c,"id"],c).setIn(["screenGroups",c,"label"],s.getUniqueLabel(e,"screenGroup",n.i18n.getIntl().formatMessage({id:"screenGroup"})));const p=[];for(let e=0;e<u.screens.length;e+=1){const i=u.screens[e],n=yield this.createScreenFromTemplate(r,t,i,o,a);r=n[0],p.push(n[1]),r=r.setIn(["screens",n[1],"parent"],c)}return r=r.setIn(["screenGroups",c,"screens"],p),a[i]=c,[r,c]}))}createScreenFromTemplate(e,t,i,o,a){return G(this,void 0,void 0,(function*(){var d,u,c;let p=e;console.debug("create screen",i,"from template in",o),yield(0,l.IE)(t);const g=t.config;i=null!=i?i:Object.keys(g.screens)[0];const h=g.screens[i],f=s.getUniqueId("screen");p=p.setIn(["screens",f],h).setIn(["screens",f,"id"],f).setIn(["screens",f,"label"],s.getUniqueLabel(e,"screen",n.i18n.getIntl().formatMessage({id:"screen"})));const m=[];Object.keys(null!==(u=null===(d=h.panel)||void 0===d?void 0:d.layout)&&void 0!==u?u:{}).forEach((e=>{m.push({sizeMode:e,isSide:!0,layoutId:h.panel.layout[e]})})),Object.keys(null!==(c=h.main.layout)&&void 0!==c?c:{}).forEach((e=>{m.push({sizeMode:e,isSide:!1,layoutId:h.main.layout[e]})}));for(let e=0;e<m.length;e+=1){const{sizeMode:i,layoutId:o,isSide:s}=m[e],l=r.getService(g,o),d=yield l.createLayoutFromTemplate(p,t,o,i,n.LayoutParentType.Screen,f,a);p=d[0];const u=d[1];p=p.setIn(["layouts",u,"parent"],{type:n.LayoutParentType.Screen,id:f}),p=s?p.setIn(["screens",f,"panel","layout",i],u):p.setIn(["screens",f,"main","layout",i],u)}return[p,f]}))}duplicateEmbedLayout(e,t,i,o){var s;const a=null===(s=e.screenGroups)||void 0===s?void 0:s[t];if(!a)return[e,null];let l=e;return a.screens.forEach((e=>{var t;const s=l.screens[e],a=s.main.layout;if(a[i]&&!a[o]){const t=r.getService(l,a[i]).duplicateLayout(l,a[i],i,o,null,!1);l=t[0];const s=t[1];null!=t[1]&&(l=l.setIn(["layouts",s,"parent"],{type:n.LayoutParentType.Screen,id:e}).setIn(["screens",e,"main","layout",o],s))}const d=null===(t=s.panel)||void 0===t?void 0:t.layout;if(d&&d[i]&&!d[o]){const t=r.getService(l,d[i]).duplicateLayout(l,d[i],i,o,null,!1);l=t[0];const s=t[1];null!=t[1]&&(l=l.setIn(["layouts",s,"parent"],{type:n.LayoutParentType.Screen,id:e}).setIn(["screens",e,"panel","layout",o],s))}})),[l,null]}duplicate(e,t,i,o){var a;const d=null===(a=e.screenGroups)||void 0===a?void 0:a[t];if(!d)return[e,null];if(null==o?void 0:o[t]){const s=e.screenGroups[o[t]];if(e.screens[s.screens[0]].main.layout[i])return[e,o[t]];{const s=e.screenGroups[t];let a=e;return s.screens.forEach((e=>{var t;const s=a.screens[e],l=s.main.layout[i],d=r.getService(a,l).duplicateLayout(a,l,i,i,o,!0);a=d[0];const u=d[1];if(null!=u&&(a=a.setIn(["screens",o[e],"main","layout",i],u).setIn(["layouts",u,"parent"],{type:n.LayoutParentType.Screen,id:o[e]})),null===(t=s.panel)||void 0===t?void 0:t.layout){const t=s.panel.layout[i],l=r.getService(a,t).duplicateLayout(a,t,i,i,o,!0);a=l[0];const d=l[1];null!=d&&(a=a.setIn(["screens",o[e],"panel","layout",i],d).setIn(["layouts",d,"parent"],{type:n.LayoutParentType.Screen,id:o[e]}))}})),[a,o[t]]}}console.debug("duplicate screen group",t,"to",i);let u=d.set("id",s.getUniqueId("screenGroup")).set("label",(0,l.mz)(e,"screenGroup",d.label)),c=e.setIn(["screenGroups",u.id],u);const p=d.screens.map((e=>{const t=this.duplicateScreen(c,d.id,e,[i],!1,o);c=t[0];const n=t[1];return c=c.setIn(["screens",n,"parent"],u.id),n}));return u=u.set("screens",p),c=c.setIn(["screenGroups",u.id],u),o&&(o[t]=u.id),[c,u.id]}tryRemove(e,t,i,o){var s;const a=null===(s=e.screenGroups)||void 0===s?void 0:s[t];if(!a)return e;console.debug(`try remove screenGroup ${t} from ${i.layoutId} ${i.layoutItemId}`,o);const l=[n.BrowserSizeMode.Large,n.BrowserSizeMode.Medium,n.BrowserSizeMode.Small].filter((e=>e!==o)).some((e=>{var t;return null!=(null===(t=a.parent)||void 0===t?void 0:t[e])}));if(l){let n=this.removeParent(e,t,i,o);return a.screens.forEach((e=>{var t;const i=n.screens[e];if(i.main.layout[o]){const t=r.getServiceFromSizeModeLayout(n,i.main.layout);n=t.removeSizeModeLayouts(n,{[o]:i.main.layout[o]}),n=n.setIn(["screens",e,"main","layout"],i.main.layout.without(o))}if(null===(t=i.panel)||void 0===t?void 0:t.layout[o]){const t=r.getServiceFromSizeModeLayout(n,i.panel.layout);n=t.removeSizeModeLayouts(n,{[o]:i.panel.layout[o]}),n=n.setIn(["screens",e,"panel","layout"],i.panel.layout.without(o))}})),n}return this.remove(e,t)}remove(e,t){var i,n;const o=null===(i=e.screenGroups)||void 0===i?void 0:i[t];if(!o)return e;let s=e;return console.debug("remove screen group",t),Object.keys(null!==(n=o.parent)&&void 0!==n?n:{}).forEach((e=>{const{layoutId:t}=o.parent[e];if(s.layouts[t]){const i=r.getService(s,t);s=i.removeItem(s,o.parent[e],e,!1)}})),o.screens.forEach((e=>{var t;const i=s.screens[e],n=r.getServiceFromSizeModeLayout(s,i.main.layout);if(s=n.removeSizeModeLayouts(s,i.main.layout),null===(t=i.panel)||void 0===t?void 0:t.layout){const e=r.getServiceFromSizeModeLayout(s,i.panel.layout);s=e.removeSizeModeLayouts(s,i.panel.layout)}s=s.set("screens",s.screens.without(e))})),s=s.set("screenGroups",s.screenGroups.without(t)),s}toTocNode(e,t,i,o){var s,a;const{layoutId:l,layoutItemId:d}=i,u={label:"",layoutId:l,layoutItemId:d,type:"screenGroup",id:t,children:[]},c=null===(s=e.screenGroups)||void 0===s?void 0:s[t];return c?(u.label=c.label,u.icon=null!==(a=c.icon)&&void 0!==a?a:B(),u.flipIcon=!1,c.screens.forEach((t=>{var i,s,a;const l=e.screens[t],d={label:l.label,icon:k(),flipIcon:!1,type:"screen",id:t,children:[]},c=null!==(i=l.main.layout[o])&&void 0!==i?i:l.main.layout[e.mainSizeMode],p=r.getService(e,c).getTocStructure(e,c);if(d.children.push({label:n.i18n.getIntl().formatMessage({id:"mainStage"}),isLabelReadOnly:!0,type:"layout",id:c,children:p}),null===(s=l.panel)||void 0===s?void 0:s.layout){const t=null!==(a=l.panel.layout[o])&&void 0!==a?a:l.panel.layout[e.mainSizeMode],i=r.getService(e,t).getTocStructure(e,t);d.children.push({label:n.i18n.getIntl().formatMessage({id:"scrollingPanel"}),isLabelReadOnly:!0,type:"layout",id:t,children:i})}u.children.push(d)})),u):u}afterMoved(e,t,i,n){return e}afterAdded(e,t,i,o,s){var a;const l=null===(a=e.screenGroups)||void 0===a?void 0:a[t];if(!l)return e;let d=e;return l.screens.forEach((e=>{var t,i;const a=d.screens[e];if(a.main.layout[o]&&!a.main.layout[s]){const t=d.layouts[a.main.layout[o]],i=r.getService(d,a.main.layout[o]).duplicateLayout(d,t.id,o,s,null);d=i[0];const l=i[1];null!=l&&(d=d.setIn(["layouts",l,"parent"],{type:n.LayoutParentType.Screen,id:e}).setIn(["screens",e,"main","layout",s],l))}if((null===(i=null===(t=a.panel)||void 0===t?void 0:t.layout)||void 0===i?void 0:i[o])&&!a.panel.layout[s]){const t=d.layouts[a.panel.layout[o]],i=r.getService(d,a.panel.layout[o]).duplicateLayout(d,t.id,o,s,null);d=i[0];const l=i[1];null!=l&&(d=d.setIn(["layouts",l,"parent"],{type:n.LayoutParentType.Screen,id:e}).setIn(["screens",e,"panel","layout",s],l))}})),d}addParent(e,t,i,n){return e.screenGroups[t]?(console.debug("add parent",i.layoutId,i.layoutItemId,"to",t,"in",n),e.setIn(["screenGroups",t,"parent",n],i)):e}removeParent(e,t,i,n){const o=e.screenGroups[t];if(!o||!o.parent)return e;if(console.debug("remove parent",i.layoutId,i.layoutItemId,"from",t),n){const s=o.parent[n];return(null==s?void 0:s.layoutId)===i.layoutId&&(null==s?void 0:s.layoutItemId)===i.layoutItemId?e.setIn(["screenGroups",t,"parent"],o.parent.without(n)):e}let s=e;return Object.keys(o.parent).forEach((n=>{const a=o.parent[n];a.layoutId===i.layoutId&&a.layoutItemId===i.layoutItemId&&(s=e.setIn(["screenGroups",t,"parent"],o.parent.without(n)))})),s}clearParent(e,t){const i=e.screenGroups[t];return i?e.setIn(["screenGroups",t],i.without("parent")):e}removeSizeModeParent(e,t,i){var n;const o=e.screenGroups[t];return o&&(null===(n=o.parent)||void 0===n?void 0:n[i])?e.setIn(["screenGroups",t,"parent"],o.parent.without(i)):e}findParent(e,t,i){var n;const o=e.screenGroups[t];if(!o||!o.parent)return null;return null!==(n=o.parent[i])&&void 0!==n?n:o.parent[e.mainSizeMode]}hasParent(e,t,i){const n=e.screenGroups[t];return!(!n||!n.parent)&&null!=n.parent[i]}hasMultipleParents(){return!1}duplicateScreen(e,t,i,o,a,d){var u,c,p;const g=null===(u=e.screenGroups)||void 0===u?void 0:u[t],h=null===(c=e.screens)||void 0===c?void 0:c[i];if(!h||!g||!g.screens.includes(i))return[e,null];console.debug("duplicate screen",i,"in",o,"to",t);let f=h.set("id",s.getUniqueId("screen")).set("label",(0,l.mz)(e,"screen",h.label));a||(f=f.without("parent"));let m=e.setIn(["screens",f.id],f);const y={};o.forEach((e=>{y[e]=f.main.layout[e]}));const v=null!=d?d:{},S=r.getServiceFromSizeModeLayout(m,y).duplicateSizeModeLayouts(m,y,n.LayoutParentType.Screen,f.id,v);if(m=S[0],f=f.setIn(["main","layout"],S[1]),null===(p=f.panel)||void 0===p?void 0:p.layout){const e={};o.forEach((t=>{e[t]=f.panel.layout[t]}));const t=r.getServiceFromSizeModeLayout(m,e).duplicateSizeModeLayouts(m,e,n.LayoutParentType.Screen,f.id,v);m=t[0],f=f.setIn(["panel","layout"],t[1])}if(m=m.setIn(["screens",f.id],f),a){const e=g.screens.asMutable(),n=e.indexOf(i);e.splice(n,1,i,f.id),m=m.setIn(["screenGroups",t,"screens"],e)}return d&&(d[i]=f.id),[m,f.id]}removeScreen(e,t,i){var n,o;const s=null===(n=e.screenGroups)||void 0===n?void 0:n[t],a=null===(o=e.screens)||void 0===o?void 0:o[i];if(!a||!s||1===s.screens.length||!s.screens.includes(i))return e;console.debug("remove screen",i,"in",t);const l=s.screens.filter((e=>e!==i));let d=e.setIn(["screenGroups",t,"screens"],l);if(d=r.getServiceFromSizeModeLayout(d,a.main.layout).removeSizeModeLayouts(d,a.main.layout),a.panel){d=r.getServiceFromSizeModeLayout(d,a.panel.layout).removeSizeModeLayouts(d,a.panel.layout)}return d=d.set("screens",d.screens.without(i)),d}};const z=new class{setContentId(e,t,i,o){if(!i)return e;const{layoutId:s,layoutItemId:a}=t,r=d.searchUtils.findLayoutItem(e,t);if(r){let l=e;switch(r.type){case n.LayoutItemType.Widget:l=l.setIn(["layouts",s,"content",a,"widgetId"],i),l=P.addParent(l,i,t,o);break;case n.LayoutItemType.Section:l=l.setIn(["layouts",s,"content",a,"sectionId"],i),l=U.addParent(l,i,t,o);break;case n.LayoutItemType.ScreenGroup:l=l.setIn(["layouts",s,"content",a,"screenGroupId"],i),l=W.addParent(l,i,t,o)}return l}return e}};var F=i(6884),$=i(4981),N=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};const q=new class{createPageFromTemplate(e,t,i){return N(this,void 0,void 0,(function*(){var o;let s=e;yield(0,l.IE)(t);const a=t.config,d=Object.keys(a.pages)[0],u=a.pages[d],c=n.appConfigUtils.getUniqueId("page"),p=n.appConfigUtils.getUniqueLabel(e,"page",n.i18n.getIntl().formatMessage({id:"page"})),g=Object.keys(null!==(o=u.layout)&&void 0!==o?o:{});s=s.setIn(["pages",c],u).setIn(["pages",c,"id"],c).setIn(["pages",c,"isVisible"],!0).setIn(["pages",c,"isDefault"],!1).setIn(["pages",c,"label"],p).setIn(["pages",c,"header"],!1).setIn(["pages",c,"footer"],!1);for(let e=0;e<g.length;e+=1){const o=g[e],l=u.layout[o],d=r.getService(a,l),p=yield d.createLayoutFromTemplate(s,t,l,o,n.LayoutParentType.Page,c,i);s=p[0];const h=p[1];s=s.setIn(["pages",c,"layout",o],h).setIn(["layouts",h,"parent"],{id:c,type:n.LayoutParentType.Page})}return[s,c]}))}createDialogFromTemplate(e,t,i){return N(this,void 0,void 0,(function*(){var o;let s=e;yield(0,l.IE)(t);const a=t.config,d=Object.keys(a.dialogs)[0],u=a.dialogs[d],c=n.appConfigUtils.getUniqueId("dialog"),p=n.appConfigUtils.getUniqueLabel(e,"dialog",n.i18n.getIntl().formatMessage({id:"dialog"})),g=Object.keys(null!==(o=u.layout)&&void 0!==o?o:{}),h=Object.keys(Object.keys(s.dialogs).filter((e=>s.dialogs[e].mode===u.mode))).length;s=s.setIn(["dialogs",c],u).setIn(["dialogs",c,"id"],c).setIn(["dialogs",c,"label"],p).setIn(["dialogs",c,"index"],h).setIn(["dialogs",c,"isSplash"],!1).setIn(["dialogs",c,"closeWhenClickOverlay"],u.closeWhenClickOverlay).setIn(["dialogs",c,"sizeMode"],u.sizeMode);for(let e=0;e<g.length;e+=1){const o=g[e],l=u.layout[o],d=r.getService(a,l),p=yield d.createLayoutFromTemplate(s,t,l,o,n.LayoutParentType.Dialog,c,i);s=p[0];const h=p[1];s=s.setIn(["dialogs",c,"layout",o],h).setIn(["layouts",h,"parent"],{id:c,type:n.LayoutParentType.Dialog})}return[s,c]}))}applyTemplateToHeader(e,t,i,o){return N(this,void 0,void 0,(function*(){var s,a,d,u;if(yield(0,l.IE)(t),!(null===(s=null==t?void 0:t.config)||void 0===s?void 0:s.header))return e;const c=t.config.header.layout,p=Object.values(c)[0],g=null===(a=null==e?void 0:e.header)||void 0===a?void 0:a.layout;if(g){const s=r.getService(t.config,p),a=yield s.replaceSizeModeLayout(e,g,t,(0,n.Immutable)(null===(u=null===(d=null==t?void 0:t.config)||void 0===d?void 0:d.header)||void 0===u?void 0:u.layout),i,n.LayoutParentType.Header,"header",o);let l=a[0];return Object.keys(a[1]).forEach((e=>{const t=a[1][e];l=l.setIn(["header","layout",e],t).setIn(["layouts",t,"parent"],{id:"header",type:n.LayoutParentType.Header})})),Object.keys(t.config.header).forEach((e=>{"layout"!==e&&null!=t.config.header[e]&&(l=l.setIn(["header",e],t.config.header[e]))})),l}return e}))}applyTemplateToFooter(e,t,i,o){return N(this,void 0,void 0,(function*(){var s,a,d,u;if(yield(0,l.IE)(t),!(null===(s=null==t?void 0:t.config)||void 0===s?void 0:s.footer))return e;const c=t.config.footer.layout,p=Object.values(c)[0],g=null===(a=null==e?void 0:e.footer)||void 0===a?void 0:a.layout;if(g){const s=r.getService(t.config,p),a=yield s.replaceSizeModeLayout(e,g,t,(0,n.Immutable)(null===(u=null===(d=null==t?void 0:t.config)||void 0===d?void 0:d.footer)||void 0===u?void 0:u.layout),i,n.LayoutParentType.Footer,"footer",o);let l=a[0];return Object.keys(a[1]).forEach((e=>{const t=a[1][e];l=l.setIn(["footer","layout",e],t).setIn(["layouts",t,"parent"],{id:"footer",type:n.LayoutParentType.Footer})})),Object.keys(t.config.footer).forEach((e=>{"layout"!==e&&null!=t.config.footer[e]&&(l=l.setIn(["footer",e],t.config.footer[e]))})),l}return e}))}applyTemplateToBody(e,t,i,o,s){return N(this,void 0,void 0,(function*(){var a,d;if(yield(0,l.IE)(i),!i.config){const t=yield(0,F.getTemplateConfig)(i.type,i.name);if(i.config=t,!i.config)return e;n.appConfigUtils.fixLayoutIds(i.config),n.utils.replaceI18nPlaceholdersInObject(i.config,n.i18n.getIntl(),$.A)}const u=Object.keys(i.config.pages)[0],c=i.config.pages[u].layout,p=Object.values(c)[0],g=null===(d=null===(a=null==e?void 0:e.pages)||void 0===a?void 0:a[t])||void 0===d?void 0:d.layout;if(g){const a=r.getService(i.config,p),l=yield a.replaceSizeModeLayout(e,g,i,(0,n.Immutable)(c),o,n.LayoutParentType.Page,t,s);let d=l[0];Object.keys(l[1]).forEach((e=>{const i=l[1][e];d=d.setIn(["pages",t,"layout",e],i).setIn(["layouts",i,"parent"],{id:t,type:n.LayoutParentType.Page})}));return["mode","maxWidth","bodyBackgroundColor","bodyBackgroundIMage","bodyBackgroundPosition"].forEach((e=>{const n=i.config.pages[u][e];"layout"!==e&&null!=n&&(d=d.setIn(["pages",t,e],n))})),d}return e}))}applyTemplateToDialog(e,t,i,o,s){return N(this,void 0,void 0,(function*(){var a,d,u;yield(0,l.IE)(i);const c=Object.keys(i.config.dialogs)[0],p=null===(a=null==e?void 0:e.dialogs)||void 0===a?void 0:a[t],g=null==p?void 0:p.layout,h=null===(u=null===(d=null==i?void 0:i.config)||void 0===d?void 0:d.dialogs)||void 0===u?void 0:u[c];if(g&&(null==h?void 0:h.layout)){const a=h.layout,l=Object.values(a)[0],d=r.getService(i.config,l),u=yield d.replaceSizeModeLayout(e,g,i,(0,n.Immutable)(a),o,n.LayoutParentType.Dialog,t,s);let c=u[0];const f=p.mode===h.mode,m=f?p.index:Object.keys(Object.keys(c.dialogs).filter((e=>c.dialogs[e].mode===h.mode))).length;c=c.setIn(["dialogs",t,"index"],m),Object.keys(u[1]).forEach((e=>{const i=u[1][e];c=c.setIn(["dialogs",t,"layout",e],i).setIn(["dialogs",t,"sizeMode",o],h.sizeMode[o]||h.sizeMode[n.BrowserSizeMode.Large]).setIn(["layouts",i,"parent"],{id:t,type:n.LayoutParentType.Dialog})}));return["mode","overlayColor","dialogBackground","border","blockPage","interactionType","interactionStyles","confirmBeforeClose","alwaysShowConfirmation","closeWhenClickOverlay"].forEach((e=>{c=c.setIn(["dialogs",t,e],h[e])})),f||Object.keys(c.dialogs).forEach((e=>{const t=c.dialogs[e];t.mode===p.mode&&t.index>p.index&&(c=c.setIn(["dialogs",t.id,"index"],t.index-1))})),c}return e}))}applyGridTemplate(e,t,i,o,s){return N(this,void 0,void 0,(function*(){var a,d;yield(0,l.IE)(i);const u=null===(d=null===(a=null==e?void 0:e.widgets)||void 0===a?void 0:a[t])||void 0===d?void 0:d.layouts,c=Object.values(i.config.widgets).find((e=>"widgets/layout/grid/"===e.uri)),p="DEFAULT",g=u[p],h=r.getInstance().getServiceByType(n.LayoutType.GridLayout),f=yield h.replaceSizeModeLayout(e,g,i,(0,n.Immutable)(c.layouts[p]),o,n.LayoutParentType.Widget,t,s);let m=f[0];return Object.keys(f[1]).forEach((e=>{const i=f[1][e];m=m.setIn(["widgets",t,"layouts",p,e],i).setIn(["layouts",i,"parent"],{id:t,type:n.LayoutParentType.Widget})})),m}))}};var H=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};class V{constructor(e,t){switch(this.appConfig=e,this.layoutItem=t,t.type){case n.LayoutItemType.Widget:this.service=P,this.contentId=t.widgetId;break;case n.LayoutItemType.Section:this.service=U,this.contentId=t.sectionId;break;case n.LayoutItemType.ScreenGroup:this.service=W,this.contentId=t.screenGroupId}}getConfig(){return this.appConfig}getContentId(){return this.contentId}createFromTemplate(e,t,i,n){return H(this,void 0,void 0,(function*(){if(this.contentId&&this.service){const o=yield this.service.createFromTemplate(this.appConfig,e,this.contentId,t,i,n);return this.appConfig=o[0],o}return[this.appConfig,null]}))}duplicateEmbedLayout(e,t){if(this.service){const i=this.service.duplicateEmbedLayout(this.appConfig,this.contentId,e,t);return this.appConfig=i[0],i}return[this.appConfig,null]}duplicate(e,t){if(this.service){const i=this.service.duplicate(this.appConfig,this.contentId,e,t);return this.appConfig=i[0],i}return[this.appConfig,null]}tryRemove(e,t){return this.service&&(this.appConfig=this.service.tryRemove(this.appConfig,this.contentId,e,t)),this.appConfig}remove(){return this.service&&(this.appConfig=this.service.remove(this.appConfig,this.contentId)),this.appConfig}toTocNode(e,t){return this.service?this.service.toTocNode(this.appConfig,this.contentId,e,t):null}afterMoved(e,t){return this.service&&(this.appConfig=this.service.afterMoved(this.appConfig,this.contentId,e,t)),this.appConfig}afterAdded(e,t,i){return this.service&&(this.appConfig=this.service.afterAdded(this.appConfig,this.contentId,e,t,i)),this.appConfig}addParent(e,t){return this.service&&(this.appConfig=this.service.addParent(this.appConfig,this.contentId,e,t)),this.appConfig}removeParent(e,t){return this.service&&(this.appConfig=this.service.removeParent(this.appConfig,this.contentId,e,t)),this.appConfig}clearParent(){return this.service&&(this.appConfig=this.service.clearParent(this.appConfig,this.contentId)),this.appConfig}removeSizeModeParent(e){return this.service&&(this.appConfig=this.service.removeSizeModeParent(this.appConfig,this.contentId,e)),this.appConfig}findParent(e){var t;return null===(t=this.service)||void 0===t?void 0:t.findParent(this.appConfig,this.contentId,e)}hasParent(e){var t,i;return null!==(i=null===(t=this.service)||void 0===t?void 0:t.hasParent(this.appConfig,this.contentId,e))&&void 0!==i&&i}hasMultipleParents(e){var t,i;return null!==(i=null===(t=this.service)||void 0===t?void 0:t.hasMultipleParents(this.appConfig,this.contentId,e))&&void 0!==i&&i}}var Q=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};class K{createBlankLayout(e,t){const i=s.getUniqueId("layout"),n={id:i,content:{},type:t};console.debug("create a blank layout with type",t);return[e.setIn(["layouts",i],n),i]}duplicateLayout(e,t,i,o,a,r){var l,d,u;const c=e.layouts[t];if(!c)return[e,null];const p=c.set("id",s.getUniqueId("layout"));let g=e.setIn(["layouts",p.id],p);if(console.debug("duplicate layout",t,", from size mode",i,", to size mode",o),Object.keys(null!==(l=p.content)&&void 0!==l?l:{}).forEach((e=>{var s;const l=p.content[e];if(l.isPending){const t=g.layouts[p.id];if(g=g.setIn(["layouts",t.id,"content"],t.content.without(e)),null===(s=t.order)||void 0===s?void 0:s.includes(e)){const i=t.order.filter((t=>t!==e));g=g.setIn(["layouts",t.id,"order"],i)}}else if(r)g=this.duplicateAndReplaceContent(g,{layoutId:t,layoutItemId:e},{layoutId:p.id,layoutItemId:e},i,o,a);else{const t=new V(g,l);if(i!==o&&!t.hasMultipleParents(i)&&t.hasParent(o)){const t=l.set("type",n.LayoutItemType.Widget).without("widgetId");g=g.setIn(["layouts",p.id,"content",e],t)}else{const n=t.duplicateEmbedLayout(i,o);if(g=n[0],n[1]){const t=l.set("widgetId",n[1]);g=g.setIn(["layouts",p.id,"content",e],t);const i=new V(g,t);g=i.addParent({layoutId:p.id,layoutItemId:e},o)}else g=t.addParent({layoutId:p.id,layoutItemId:e},o)}}})),o===n.BrowserSizeMode.Large&&p.type===n.LayoutType.GridLayout&&(null===(d=p.setting)||void 0===d?void 0:d.mainItemId)){const e=null!==(u=null==a?void 0:a[c.setting.mainItemId])&&void 0!==u?u:c.setting.mainItemId;g=g.setIn(["layouts",p.id,"setting","mainItemId"],e)}if(i!==o){const e=this.transformLayout(g,g.layouts[p.id],i,o);g=g.setIn(["layouts",p.id],e)}return[g,p.id]}duplicateSizeModeLayouts(e,t,i,n,o){let s=e;const a={};return Object.keys(null!=t?t:{}).forEach((e=>{const r=t[e],l=this.duplicateLayout(s,r,e,e,o,!0);s=l[0],a[e]=l[1],null!=l[1]&&(s=s.setIn(["layouts",l[1],"parent"],{type:i,id:n}))})),[s,a]}duplicateAndReplaceContent(e,t,i,n,o,s){const{layoutId:a,layoutItemId:r}=t,{layoutId:l,layoutItemId:u}=i;if(!e.layouts||!e.layouts[a]||!e.layouts[l])return e;const c=d.searchUtils.findLayoutItem(e,{layoutId:a,layoutItemId:r}),p=new V(e,c).duplicate(o,s);let g=p[0];const h=p[1];g=g.setIn(["layouts",l,"content",u,"type"],c.type),g=z.setContentId(g,{layoutId:l,layoutItemId:u},h,o);const m=d.searchUtils.findLayoutItem(g,i),y=new V(g,m);return y.removeParent({layoutId:a,layoutItemId:r},n),g=y.getConfig(),n===o&&o===e.mainSizeMode&&(g=f.afterLayoutItemCopied(g,t,i)),g}addContent(e,t,i,n,o){const s=this.createBlankItem(e,t);let a=s[0];const r=s[1];console.debug(`add ${i} to ${t}`),a=a.setIn(["layouts",t,"content",r,"type"],n);const l={layoutId:t,layoutItemId:r};return a=z.setContentId(a,l,i,o),a=this.afterItemAdded(a,l,o,o),[a,r]}removeLayout(e,t,i){var n;const o=e.layouts[t];if(!o)return e;let s=e;return console.debug("remove layout",t,"in size mode",i),Object.keys(null!==(n=o.content)&&void 0!==n?n:{}).forEach((e=>{s=this.removeItem(s,{layoutId:t,layoutItemId:e},i,!0,!1)})),s=this.removeLayoutIdFromParent(s,t,i),s=s.setIn(["layouts"],s.layouts.without(t)),s}removeSizeModeLayouts(e,t){let i=e;return Object.keys(t).forEach((e=>{const n=t[e];i=this.removeLayout(i,n,e)})),i}removeLayoutIdFromParent(e,t,i){var o,s,a;const r=e.layouts[t];if(!r)return e;let l=e;const d=null===(o=r.parent)||void 0===o?void 0:o.id;switch(null===(s=r.parent)||void 0===s?void 0:s.type){case n.LayoutParentType.Header:l.header.layout[i]===t&&(console.debug("remove layout",t,"from header, in size mode",i),l=l.setIn(["header","layout"],l.header.layout.without(i)));break;case n.LayoutParentType.Footer:l.footer.layout[i]===t&&(console.debug("remove layout",t,"from footer, in size mode",i),l=l.setIn(["footer","layout"],l.footer.layout.without(i)));break;case n.LayoutParentType.Dialog:l.dialogs[d].layout[i]===t&&(console.debug("remove layout",t,"from dialog",d,", in size mode",i),l=l.setIn(["dialogs",d,"layout"],l.dialogs[d].layout.without(i)));break;case n.LayoutParentType.Page:l.pages[d].layout[i]===t&&(console.debug("remove layout",t,"from page",d,", in size mode",i),l=l.setIn(["pages",d,"layout"],l.pages[d].layout.without(i)));break;case n.LayoutParentType.View:l.views[d].layout[i]===t&&(console.debug("remove layout",t,"from view",d,", in size mode",i),l=l.setIn(["views",d,"layout"],l.views[d].layout.without(i)));break;case n.LayoutParentType.Screen:l.screens[d].main.layout[i]===t&&(console.debug("remove layout",t,"from screen main",d,", in size mode",i),l=l.setIn(["screens",d,"main","layout"],l.screens[d].main.layout.without(i))),(null===(a=l.screens[d].panel)||void 0===a?void 0:a.layout)&&l.screens[d].panel.layout[i]===t&&(console.debug("remove layout",t,"from screen panel",d,", in size mode",i),l=l.setIn(["screens",d,"panel","layout"],l.screens[d].panel.layout.without(i)));break;case n.LayoutParentType.Widget:const e=l.widgets[d];Object.keys(e.layouts).forEach((n=>{const o=e.layouts[n];o[i]===t&&(console.debug("remove layout",t,"from widget",d,", in size mode",i),l=l.setIn(["widgets",d,"layouts",n],o.without(i)))}))}return l}replaceLayoutIdInParent(e,t,i,o,s){let a=e;switch(console.debug("replace layout",i,"with new one",o,"in parent",t.id,s),t.type){case n.LayoutParentType.Header:a.header.layout[s]===i&&(a=a.setIn(["header","layout",s],o));break;case n.LayoutParentType.Footer:a.footer.layout[s]===i&&(a=a.setIn(["footer","layout",s],o));break;case n.LayoutParentType.Dialog:a.dialogs[t.id].layout[s]===i&&(a=a.setIn(["dialogs",t.id,"layout",s],o));break;case n.LayoutParentType.Page:a.pages[t.id].layout[s]===i&&(a=a.setIn(["pages",t.id,"layout",s],o));break;case n.LayoutParentType.Widget:const e=a.widgets[t.id];e&&Object.keys(e.layouts).some((n=>e.layouts[n][s]===i&&(a=a.setIn(["widgets",t.id,"layouts",n,s],o),!0)))}return a}transformLayout(e,t,i,o){let s;s=window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._extensionManager:n.ExtensionManager.getInstance();const a=s.getExtensions(n.extensionSpec.ExtensionPoints.LayoutTransformer);if(a.length>0){const n=a.find((e=>e.layoutType===t.type));n&&n.transformLayout&&(t=n.transformLayout(t,i,o,e))}return t}createBlankItem(e,t){const i=`${d.utils.getMaximumId(e.layouts[t])+1}`,n={id:i};return[e.setIn(["layouts",t,"content",i],n),i]}duplicateItemInSameLayout(e,t,i,n){const{layoutId:o,layoutItemId:s}=t;if(!e.layouts||!e.layouts[o])return[e,null];console.debug("duplicate layout item",o,s,"in size mode",i);const a=d.searchUtils.findLayoutItem(e,t),r=`${d.utils.getMaximumId(e.layouts[o])+1}`,l=a.set("id",r);let u=e.setIn(["layouts",o,"content",l.id],l);u=this.duplicateAndReplaceContent(u,{layoutId:o,layoutItemId:s},{layoutId:o,layoutItemId:l.id},i,i,n);const c=d.searchUtils.findLayoutItem(u,{layoutId:o,layoutItemId:l.id}),p=new V(u,c);return p.hasMultipleParents(i)&&(p.removeSizeModeParent(i),p.addParent({layoutId:o,layoutItemId:l.id},i),u=p.getConfig()),[u,l.id]}pendItem(e,t){const i=d.searchUtils.findLayoutItem(e,t),{layoutId:n,layoutItemId:o}=t;let s=e;return i&&(s=e.setIn(["layouts",n,"content",o,"isPending"],!0)),s}removeItem(e,t,i,o,s,a){var r,l,u;const{layoutId:c,layoutItemId:p}=t,g=d.searchUtils.findLayoutItem(e,t);if(!g)return e;console.debug(`remove layout item, ${c} ${p}, removeContent=${o}, force=${s}`);const h=f.getPlaceholderInfo(e,t),m=null!==(l=null===(r=e.forBuilderAttributes)||void 0===r?void 0:r.lockLayout)&&void 0!==l&&l,y=window.isExpressBuilder||(null===(u=window.parent)||void 0===u?void 0:u.isExpressBuilder),v=m||y||h&&!a&&(g.widgetId||g.sectionId),S=e.layouts[c].type===n.LayoutType.GridLayout&&g.type===n.LayoutItemType.Widget&&!g.widgetId;let I=e;(!v||y&&S)&&(I=this.beforeItemRemoved(I,t));const w=new V(I,g);if(o?s?w.remove():w.tryRemove(t,i):w.removeParent(t,i),I=w.getConfig(),v)g.type===n.LayoutItemType.Widget&&g.widgetId?I=I.setIn(["layouts",c,"content",p],g.without("widgetId")):g.type===n.LayoutItemType.Section&&g.sectionId&&(I=I.setIn(["layouts",c,"content",p],g.without("sectionId").set("type",n.LayoutItemType.Widget)));else{const e=I.layouts[c];e&&(I=I.setIn(["layouts",c,"content"],e.content.without(p))),a||(I=f.afterLayoutItemRemoved(I,t)),I=this.afterItemRemoved(I,t)}return I}replaceSizeModeLayout(e,t,i,n,o,s,a,r){return Q(this,void 0,void 0,(function*(){if(!n)return[e,t];const l=o===e.mainSizeMode;let d,u=e,c=t;d=l?Object.keys(n).filter((e=>e===o||null==t[e])):[o];for(let e=0;e<d.length;e+=1){const t=d[e],o=yield this.replaceLayout(u,c[t],i,n[t],t,s,a,r);o[1]&&(u=o[0],c=c.set(t,o[1]))}if(null==n[o]){const e=yield this.replaceLayout(u,c[o],i,n[u.mainSizeMode],o,s,a,r);u=e[0],c=c.set(o,e[1])}return[u,c]}))}replaceLayout(e,t,i,n,o,s,a,r){return Q(this,void 0,void 0,(function*(){var l,d,u;if(null==(null===(d=null===(l=i.config)||void 0===l?void 0:l.layouts)||void 0===d?void 0:d[n]))return[e,null];console.debug(`replace ${t} with template ${n} in ${o}`);let c=e;if(null===(u=e.layouts)||void 0===u?void 0:u[t]){const i=e.layouts[t];if((null==i?void 0:i.content)&&Object.keys(i.content).length>0)return[e,null];c=c.set("layouts",c.layouts.without(t))}const p=yield this.createLayoutFromTemplate(c,i,n,o,s,a,r);c=p[0];const g=p[1];return c=this.replaceLayoutIdInParent(c,{type:s,id:a},t,g,o),[c,g]}))}createLayoutFromTemplate(e,t,i,o,a,r,d){return Q(this,void 0,void 0,(function*(){var u,c;let p=e;yield(0,l.IE)(t),console.debug("create layout",i,"from template");const g=t.config.layouts[i],h=s.getUniqueId("layout");p=p.setIn(["layouts",h],g).setIn(["layouts",h,"id"],h).setIn(["layouts",h,"parent"],{type:a,id:r});const f=g.type===n.LayoutType.GridLayout?Object.keys(g.content||{}):null!==(u=g.order)&&void 0!==u?u:[];for(let e=0;e<f.length;e++){const i=f[e],s=g.content[i],a=new V(p,s),r=yield a.createFromTemplate(t,[o],d,{isBlock:g.type===n.LayoutType.FlowLayout});p=r[0];const l=r[1];p=z.setContentId(p,{layoutId:h,layoutItemId:i},l,o)}if(o===n.BrowserSizeMode.Large&&g.type===n.LayoutType.GridLayout&&(null===(c=g.setting)||void 0===c?void 0:c.mainItemId)){const e=d[g.setting.mainItemId];p=p.setIn(["layouts",h,"setting","mainItemId"],e)}return[p,h]}))}getTocStructure(e,t){return null}moveLayoutItem(e,t,i,o,s){var a,l,u,c;const p=d.searchUtils.findLayoutItem(e,t);if(!p)return[e,null];let g=e;const h=e.layouts[t.layoutId],m=d.searchUtils.findLayoutItem(g,t);if(h.type===n.LayoutType.GridLayout&&!m.isPending&&o===s){const e=r.getInstance().getServiceByType(n.LayoutType.GridLayout);g=e.beforeItemRemoved(g,t)}if(console.debug("move layout item from",t.layoutId,t.layoutItemId,"to",i,s),m.isPending&&o===s&&(g=g.setIn(["layouts",t.layoutId,"content",t.layoutItemId],m.without("isPending"))),t.layoutId!==i){const e=r.getService(g,t.layoutId);if(o===s){let i=[t];if(m.type===n.LayoutItemType.Widget){const e=g.widgets[m.widgetId];e&&(null===(l=null===(a=e.parent)||void 0===a?void 0:a[o])||void 0===l?void 0:l.length)>1&&(i=e.parent[o])}else if(m.type===n.LayoutItemType.Section){const e=g.sections[m.sectionId];(null===(c=null===(u=e.parent)||void 0===u?void 0:u[o])||void 0===c?void 0:c.length)>1&&(i=e.parent[o])}i.forEach((t=>{g=e.removeItem(g,t,o,!1,!1,!0)}))}const h=this.createBlankItem(g,i);g=h[0];const y=h[1];g=g.setIn(["layouts",i,"content",y,"type"],p.type),p.type===n.LayoutItemType.Widget?g=g.setIn(["layouts",i,"content",y,"widgetId"],p.widgetId):p.type===n.LayoutItemType.Section&&(g=g.setIn(["layouts",i,"content",y,"sectionId"],p.sectionId));const v={layoutId:i,layoutItemId:y},S=d.searchUtils.findLayoutItem(g,v),I=new V(g,S);return I.addParent(v,s),o===s?I.afterMoved(t.layoutId,i):I.afterAdded(i,o,s),g=I.getConfig(),g=f.afterLayoutItemMoved(g,t,v),[g,v]}return[g,t]}afterItemAdded(e,t,i,n,o){const s=d.searchUtils.findLayoutItem(e,t),a=new V(e,s);return a.afterAdded(t.layoutId,i,n),a.getConfig()}afterItemMoved(e,t,i){return e}beforeItemRemoved(e,t){return e}afterItemRemoved(e,t){return e}}},320:(e,t,i)=>{"use strict";i.d(t,{Cp:()=>u,IE:()=>l,mz:()=>r,nj:()=>d});var n=i(9244),o=i(6884),s=i(4981),a=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function r(e,t,i){const[o]=n.appConfigUtils.parseUniqueLabel(i);let s=n.appConfigUtils.getUniqueLabel(e,t,o);return s===o&&(s=`${o} 1`),s}function l(e){return a(this,void 0,void 0,(function*(){if(!e.config){const t=yield(0,o.getTemplateConfig)(e.type,e.name);n.appConfigUtils.fixLayoutIds(t),n.utils.replaceI18nPlaceholdersInObject(t,n.i18n.getIntl(),s.A),e.config=t}}))}function d(e){return u().find((t=>t.widgetId===e))}function u(){let e;e=window.jimuConfig.isBuilder?window._appWindow._extensionManager:window._extensionManager;return(null==e?void 0:e.getExtensions(n.extensionSpec.ExtensionPoints.AppConfigOperations))||[]}},3557:(e,t,i)=>{"use strict";i.d(t,{$:()=>V,N:()=>Z});var n={};i.r(n),i.d(n,{addItemResource:()=>G,checkItemVersion:()=>x,createItem:()=>b,getItem:()=>P,getItemData:()=>T,getItemResource:()=>D,getItemResources:()=>L,getOriginUrl:()=>m,getRequestMethod:()=>I,getUserContentUrl:()=>v,getUserName:()=>S,importItem:()=>A,removeItem:()=>R,removeItemResource:()=>U,request:()=>f,searchItems:()=>u,searchItemsByPortalUrl:()=>p,updateItem:()=>k,updateItemResource:()=>_});var o,s,a,r=i(9244),l=i(3209);!function(e){e.AGOL="AGOL",e.Portal="Portal",e.Other="Other"}(o||(o={})),function(e){e.TemplateType="Web Experience Template",e.ExperienceType="Web Experience"}(s||(s={})),function(e){e.Published="Published",e.Draft="Draft",e.Changed="Changed"}(a||(a={}));var d=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function u(e){return d(this,arguments,void 0,(function*(e,t=o.Other){return yield c(e,"item",t)}))}function c(e,t){return d(this,arguments,void 0,(function*(e,t,i=o.Other){let n,s;return n=`${i===o.AGOL?"https://www.arcgis.com/":`${window.location.origin}${window.jimuConfig.mountPath}`}sharing/rest/search`,s="string"==typeof e||e instanceof r.esri.restPortal.SearchQueryBuilder?{params:{q:e}}:r.esri.restRequest.appendCustomParams(Object.assign(Object.assign({},e),{f:"json"}),["q","num","start","sortField","sortOrder","portalUrl","f","categories"]),f(n,s,"GET").then((i=>(i.nextStart&&-1!==i.nextStart&&(i.nextPage=function(){return d(this,void 0,void 0,(function*(){let n;return"string"==typeof e||e instanceof r.esri.restPortal.SearchQueryBuilder?n={q:e,start:i.nextStart}:(n=e,n.start=i.nextStart),yield c(n,t)}))}),i)))}))}function p(e,t){return d(this,void 0,void 0,(function*(){return yield g(e,t)}))}function g(e,t){return d(this,void 0,void 0,(function*(){let i,n;i||Promise.resolve(null),i=`${t}/sharing/rest/search`,n="string"==typeof e||e instanceof r.esri.restPortal.SearchQueryBuilder?{params:{q:e}}:r.esri.restRequest.appendCustomParams(Object.assign(Object.assign({},e),{f:"json"}),["q","num","start","sortField","sortOrder","portalUrl","f"]);const o=null==n?void 0:n.authentication,s={params:null==n?void 0:n.params,httpMethod:"GET"};return o&&(s.authentication=o),r.esri.restRequest.request(i,s).then((t=>(t.nextStart&&-1!==t.nextStart&&(t.nextPage=function(){return d(this,void 0,void 0,(function*(){let i;return"string"==typeof e||e instanceof r.esri.restPortal.SearchQueryBuilder?i={q:e,start:t.nextStart}:(i=e,i.start=t.nextStart),yield g(i,"item")}))}),t)))}))}var h=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function f(e){return h(this,arguments,void 0,(function*(e,t={params:{f:"json"}},i="POST"){if("GET"===i){const i=e+function(e){if(!e)return"";const t=Object.keys(e);return t.length?"?"+t.map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&"):""}(t.params);return yield fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>h(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>h(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}return"POST"===i?t.params&&"FormData"===t.params.constructor.name?yield fetch(e,{method:"POST",body:t.params}).then((e=>h(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>h(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.params)}).then((e=>h(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>h(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield Promise.reject(null)}))}function m(e=!1){var t;if(e)return r.urlUtils.getArcgisOnlineUrl();{const e=(null===(t=window.jimuConfig.mountPath)||void 0===t?void 0:t.slice(0,-1))||"";return`${window.location.origin}${e}`}}const y=r.esri.restRequest.request;function v(e=!1){return e?"/sharing/rest/content/":"/sharing/rest/content/users/"}function S(){var e;return null===(e=(0,r.getAppStore)().getState().user)||void 0===e?void 0:e.username}function I(e=!1){return e?y:f}var w=i(3632),C=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function b(e){return C(this,void 0,void 0,(function*(){const t=Object.assign({folderId:null},e);return yield function(e){return C(this,void 0,void 0,(function*(){var t,i;if(e.file&&!e.multipart)return yield Promise.reject(new Error("The request must be a multipart request for file uploading."));if(e.multipart&&!e.filename)return yield Promise.reject(new Error("The file name is required for a multipart request."));const n=S(),o=`${m()}${v()}addItem`;e.params=Object.assign(Object.assign(Object.assign({},e.params),(0,w.I)(e.item)),{portalUrl:null===(i=null===(t=(0,r.getAppStore)())||void 0===t?void 0:t.getState())||void 0===i?void 0:i.portalUrl});const s=r.esri.restRequest.appendCustomParams(e,["owner","folderId","file","dataUrl","text","async","multipart","filename","overwrite"],{params:Object.assign({},e.params)});return s.params.username=n,yield f(o,s)}))}(t)}))}function A(e,t){return C(this,void 0,void 0,(function*(){const i=`${m()}${v()}importItem`;if(!(null==e?void 0:e.appZip))return Promise.reject("No app files");t.params=Object.assign(Object.assign({},t.params),e);const n=Object.keys(t.params),o=new FormData;for(let e=0;e<n.length;e++)o.append(n[e],t.params[n[e]]);return t.params=o,yield f(i,t)}))}function x(e,t){return C(this,void 0,void 0,(function*(){const i=`${m()}${v()}checkItemVersion`;if(!(null==e?void 0:e.appZip))return Promise.reject("No app files");t.params=Object.assign(Object.assign({},t.params),e);const n=Object.keys(t.params),o=new FormData;for(let e=0;e<n.length;e++)o.append(n[e],t.params[n[e]]);return t.params=o,yield f(i,t)}))}var M=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function T(e,t){return M(this,arguments,void 0,(function*(e,t,i=!1){const n=`${m(i)}${v(i)}items/${e}/data`,o=Object.assign({params:{}},t);o.file&&(o.params.f=null),i&&!j()&&delete o.authentication;const s=I(i);return yield s(n,o).catch((e=>{if(!/Unexpected end of (JSON input|data at line 1 column 1)/i.test(e.message))throw e}))}))}function P(e,t){return M(this,arguments,void 0,(function*(e,t,i=!1){const n=`${m(i)}${v(i)}items/${e}`,o=Object.assign({},t);i&&!j()&&delete o.authentication;const s=I(i);return yield s(n,o)}))}function L(e,t){return M(this,arguments,void 0,(function*(e,t,i=!1){const n=`${m(i)}${v(i)}items/${e}/resources`;t.params=Object.assign(Object.assign({},t.params),{num:1e3}),i&&!j()&&delete t.authentication;const o=I(i);return yield o(n,t,"GET")}))}function D(e,t){return M(this,arguments,void 0,(function*(e,t,i=!1){const n=t.fileName,o=`${m(i)}${v(i)}items/${e}/resources/${n}`;i&&!j()&&delete t.authentication;const s=I(i);return yield s(o,t,"GET")}))}function j(){const e=(0,r.getAppStore)().getState().portalUrl;return r.portalUrlUtils.isAGOLDomain(e)}var E=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function R(e){return E(this,void 0,void 0,(function*(){const t=S(),i=m();e.userName=t;const n=`${i}${v()}items/${e.id}/delete`;return yield f(n,e)}))}function U(e){return E(this,void 0,void 0,(function*(){const t=`${m()}${v()}items/${e.id}/removeResources`;return e.params=Object.assign(Object.assign({},e.params),{resource:e.resource}),yield f(t,e)}))}var O=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function k(e){return O(this,void 0,void 0,(function*(){const t=S(),i=m();e.userName=t;const n=`${i}${v()}items/${e.item.id}/update`;if(e.params=Object.assign(Object.assign({},e.params),(0,w.I)(e.item)),e.item.thumbnail&&"string"!=typeof e.item.thumbnail){e.params=Object.assign(Object.assign({},e.params),e.item);const t=Object.keys(e.params),i=new FormData;for(let n=0;n<t.length;n++)i.append(t[n],e.params[t[n]]);e.params=i}return yield f(n,e)}))}function _(e){return O(this,void 0,void 0,(function*(){const t=`${m()}${v()}items/${e.id}/updateResources`;e.params=Object.assign(Object.assign({fileName:e.name,text:e.content},e.params),{file:e.resource}),delete e.params.file,e.params.file=e.resource,void 0!==e.private&&(e.params.access=e.private?"private":"inherit");const i=Object.keys(e.params),n=new FormData;for(let t=0;t<i.length;t++)n.append(i[t],e.params[i[t]]);return e.params=n,yield f(t,e)}))}var B=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function G(e){return B(this,void 0,void 0,(function*(){const t=`${m()}${v()}items/${e.id}/addResources`;e.params=Object.assign(Object.assign({fileName:e.name,text:e.content,access:e.private?"private":"inherit"},e.params),{file:e.resource}),delete e.params.file,e.params.file=e.resource;const i=Object.keys(e.params),n=new FormData;for(let t=0;t<i.length;t++)n.append(i[t],e.params[i[t]]);return e.params=n,yield f(t,e)}))}function W(e){var t,i;if(!(null==e?void 0:e.portalUrl))return!window.jimuConfig.isDevEdition;const n=(null==e?void 0:e.portalUrl)||"",o=(null===(i=null===(t=(0,r.getAppStore)())||void 0===t?void 0:t.getState())||void 0===i?void 0:i.portalUrl)||"",s=(null==o?void 0:o.includes(n))||(null==n?void 0:n.includes(o));return(r.portalUrlUtils.isAGOLDomain(n)&&r.portalUrlUtils.isAGOLDomain(o)||s)&&!z(e)}function z(e){return!!((null==e?void 0:e.portalUrl)||"").endsWith("localhost:")||e.isLocalApp}function F(e){if(!(null==e?void 0:e.portalUrl))return!1;const t=(null==e?void 0:e.portalUrl)||"",i=r.portalUrlUtils.isAGOLDomain(t),n=!W(e),o=!z(e);return n&&o&&i}r.SessionManager.getInstance().isTrustedServer((0,r.getAppStore)().getState().portalUrl);var $=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};const{importItem:N,checkItemVersion:q}=n;function H(e,t,i){const o=i?n[i]:n[e],s=r.esri.restPortal[e];return t?W(t)?s:o:window.jimuConfig.isDevEdition?o:s}var V,Q=i(8249),K=i(4321),J=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};!function(e){e.Config="config/config.json",e.Image="images/image-resources-list.json",e.Icon="images/icon-resources-list.json"}(V||(V={}));class Z{constructor(){this.resourceMap={},this.blobToResourceMap={},this.resources={},this.getResourcesInDraft=()=>this.resources,this.setResourcesInDraft=e=>{this.resources=Object.assign(Object.assign({},this.getResourcesInDraft()),e)},this.getImageResourceListFromDraft=e=>J(this,void 0,void 0,(function*(){const t=this.getResourcesInDraft();if(t.imageResources)return yield Promise.resolve(t.imageResources);{const t=this.getSession(),i=this.getPortalUrlWithFull(e),{resources:n}=yield this.fetchAppResourceInfoList(e);if((null==n?void 0:n.some((({resource:e})=>e===V.Image)))||!1){const n=(yield this.fetchAppResource(e,{fileName:V.Image,readAs:"json"}))||{};return Object.values(n).forEach((e=>{e.url.includes("?token=")&&(e.url=e.url.slice(0,e.url.indexOf("?token="))),e.url=e.url.replace("${appResourceUrl}",i)+"?token="+(null==t?void 0:t.token)})),yield Promise.resolve(n)}return yield this.upLoadImageResourceList({})}})),this.getIconResourceListFromDraft=e=>J(this,void 0,void 0,(function*(){const{iconResources:t}=this.getResourcesInDraft();if(t)return yield Promise.resolve(t);const i=this.getSession(),n=this.getPortalUrlWithFull(e),{resources:o}=yield this.fetchAppResourceInfoList(e);if((null==o?void 0:o.some((({resource:e})=>e===V.Icon)))||!1){const t=yield this.fetchAppResource(e,{fileName:V.Icon,readAs:"json"});if(t)return Object.values(t).forEach((e=>{e.svg=e.svg.replace("${appResourceUrl}",n)+"?token="+(null==i?void 0:i.token),"string"==typeof e.properties.path&&(e.properties.path=e.properties.path.replace("${appResourceUrl}",n)+"?token="+(null==i?void 0:i.token))})),yield Promise.resolve(t)}return yield this.upLoadIconResourceList({})})),this.getInUseImageResources=e=>{var t;const i=null===(t=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig;let n=(0,Q.getCleanAppConfig)(i);n=r.utils.replaceStringInObject(Object.assign({},n),{matcher:e=>/^blob:\http(s?):\/\/(.)/.test(e),handler:e=>{var t;return(null===(t=this.blobToResourceMap[e])||void 0===t?void 0:t.resourceUrl)||e}});const o={};r.utils.replaceStringInObject(Object.assign({},n),{matcher:e=>/^\$\{appResourceUrl\}+(.)/.test(e),handler:e=>o[e]=e});const s=[];Object.values(e).forEach((e=>{const t=`\${appResourceUrl}/${e.resourcesPrefix}/${e.fileName}`;o[t]&&s.push(e)}));return this.formatRelatedImageResources(e,s)},this.getInUseIconResources=e=>{var t;const i=null===(t=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig;let n=(0,Q.getCleanAppConfig)(i);n=r.utils.replaceStringInObject(Object.assign({},n),{matcher:e=>/^blob:\http(s?):\/\/(.)/.test(e),handler:e=>{var t;return(null===(t=this.blobToResourceMap[e])||void 0===t?void 0:t.resourceUrl)||e}});const o={};r.utils.replaceStringInObject(Object.assign({},n),{matcher:e=>/^\$\{appResourceUrl\}+(.)/.test(e),handler:e=>o[e]=e});const s=[];return Object.values(e).forEach((e=>{const t=`\${appResourceUrl}/images/icon_picker_in_setting/${e.properties.filename}`;o[t]&&s.push(e)})),s},this.upLoadAppConfig=(e,t,i)=>J(this,void 0,void 0,(function*(){const n=yield this.upLoadLocalResource(t),o=new Blob([JSON.stringify(n)],{type:"application/json"}),s={appId:e,file:o,fileName:"config.json",type:r.ResourceType.Config,owner:i};return yield this.upLoadAppResource(s).then((()=>J(this,void 0,void 0,(function*(){return yield Promise.resolve(t)})))).catch((e=>J(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))})),this.upLoadImageResourceList=(e,t)=>J(this,void 0,void 0,(function*(){const i=Object.assign({},e);return yield this.upLoadResourceList(V.Image,i,t)})),this.upLoadIconResourceList=(e,t)=>J(this,void 0,void 0,(function*(){return yield this.upLoadResourceList(V.Icon,e,t)})),this.upLoadAppResource=e=>J(this,void 0,void 0,(function*(){e.resourcesPrefix=Z.getResourcePrefix(e);const{appId:t=this.getAppId(),fileName:i,originalName:n,resourcesPrefix:o}=e,s=(o?o+"/":"")+i,a="${appResourceUrl}/"+s,l=(0,r.uuidv1)(),d={id:l,appId:t,fileName:i,originalName:n,resourcesPrefix:o,url:e.url,blobUrl:e.blobUrl,resourceUrl:a,type:e.type,status:r.AjaxState.Fetching,widgetId:e.widgetId,owner:e.owner},u=Object.assign({},d);u.file=e.file;const c=this.fetchAppResourceInfoList(t).then((e=>J(this,[e],void 0,(function*({resources:e}){if(0===(null==e?void 0:e.length))return yield this.addAppResource(u);if((null==e?void 0:e.length)>0)return e.some((({resource:e})=>e===s))?yield this.updateAppResource(u):yield this.addAppResource(u);throw new Error("return value from fetchAppResourceInfoList is not right")})))).catch((e=>J(this,void 0,void 0,(function*(){return console.error(e),this.setResourceItemInfoStatus(u,r.AjaxState.Error),yield Promise.reject(e)}))));return u.promise=c,this.setResourceMap(l,d),yield c})),this.upLoadLocalResource=e=>J(this,void 0,void 0,(function*(){const t=this.blobToResourceMap,i=new RegExp("^blob:http(s?)://(.)"),n=[];const o={matcher:function(e){return i.test(e)},handler:function(e){let i=e;return i=t[e],!n.includes(i.id)&&n.push(i.id),i.resourceUrl}},s=r.utils.replaceStringInObject(e,o);return yield this.checkResourcesUploadStatus(n).then((e=>J(this,void 0,void 0,(function*(){return e===r.AjaxState.Success?yield Promise.resolve(s):yield Promise.reject()}))))})),this.fetchAppResourceInfoList=(e,t)=>J(this,void 0,void 0,(function*(){const i=this.getSession();return yield function(e,t){return $(this,void 0,void 0,(function*(){return H("getItemResources",e)(e.id,t,F(e))}))}({id:e,isLocalApp:window.jimuConfig.isDevEdition},Object.assign({authentication:i},t)).catch((e=>J(this,void 0,void 0,(function*(){return console.log(e),yield Promise.reject(e)}))))})),this.fetchAppResource=(e,t)=>J(this,void 0,void 0,(function*(){const i=this.getSession();return yield function(e,t){return $(this,void 0,void 0,(function*(){return H("getItemResource",e)(e.id,t,F(e))}))}({id:e,isLocalApp:window.jimuConfig.isDevEdition},Object.assign({authentication:i},t)).catch((e=>J(this,void 0,void 0,(function*(){return console.log(e),yield Promise.reject(null)}))))})),this.clearResources=e=>{this.clearResourceMap(),this.clearResourcesWithoutSaved(e),(0,r.getAppStore)().dispatch(l.WI.ClearResources())},this.updateImageResourceItemInfo=e=>{const t=this.getAppId();this.getImageResourceListFromDraft(t).then((t=>{const i=Object.assign({},e);delete i.blobUrl,delete i.type,t[i.fileName.split(".")[0]]=i,this.setResourcesInDraft({imageResources:t})}))}}static getInstance(){return Z._instance||(Z._instance=new Z,window._appResourceManager=Z._instance),window._appResourceManager}static assignBlobUrlToResourceItem(e){return J(this,void 0,void 0,(function*(){try{const t=window.URL.createObjectURL(e.file),{width:i,height:n}=yield K.imageUtils.getImageOriginalSizeByUrl(t).catch((()=>({width:0,height:0})));return e.url=t,e.blobUrl=t,e.originalWidth=i,e.originalHeight=n,yield Promise.resolve(e)}catch(e){return yield Promise.reject(e)}}))}static getBlobByBlobUrl(e){return J(this,void 0,void 0,(function*(){return yield new Promise(((t,i)=>{const n=new XMLHttpRequest;n.responseType="blob",n.open("GET",e,!0),n.onerror=i,n.onload=()=>{200===n.status?t(n.response):i()},n.send()}))}))}static getResourcePrefix({resourcesPrefix:e,widgetId:t,type:i}){if(e)return e;return new Map([[r.ResourceType.Config,"config"],[r.ResourceType.Image,t?`images/${t}`:"images/templates"]]).get(i)||"templates"}addAppResource(e){return J(this,void 0,void 0,(function*(){const t=this.getSession();return yield this.getAppInfo({id:e.appId,isLocalApp:window.jimuConfig.isDevEdition}).then((i=>J(this,void 0,void 0,(function*(){return yield function(e){return $(this,void 0,void 0,(function*(){return H("addItemResource")(e)}))}({id:e.appId,resource:e.file,name:e.fileName,owner:i.owner,params:{resourcesPrefix:e.resourcesPrefix},authentication:t}).then((t=>J(this,void 0,void 0,(function*(){return this.setResourceItemInfoStatus(e,r.AjaxState.Success),yield Promise.resolve(t)}))),(t=>J(this,void 0,void 0,(function*(){return this.setResourceItemInfoStatus(e,r.AjaxState.Error),yield Promise.reject(t)}))))}))))}))}updateAppResource(e){return J(this,void 0,void 0,(function*(){const t=this.getSession();return yield this.getAppInfo({id:e.appId,isLocalApp:window.jimuConfig.isDevEdition}).then((i=>J(this,void 0,void 0,(function*(){return yield function(e){return $(this,void 0,void 0,(function*(){return H("updateItemResource")(e)}))}({id:e.appId,resource:e.file,name:e.fileName,owner:i.owner,params:{resourcesPrefix:e.resourcesPrefix},authentication:t}).then((t=>J(this,void 0,void 0,(function*(){return this.setResourceItemInfoStatus(e,r.AjaxState.Success),yield Promise.resolve(t)}))),(t=>J(this,void 0,void 0,(function*(){return this.setResourceItemInfoStatus(e,r.AjaxState.Error),yield Promise.reject(t)}))))}))))}))}removeAppResource(e){return J(this,void 0,void 0,(function*(){const t=this.getSession(),i=e.appId?e.appId:this.getAppId();return yield this.getAppInfo({id:i,isLocalApp:window.jimuConfig.isDevEdition}).then((n=>J(this,void 0,void 0,(function*(){return yield function(e){return $(this,void 0,void 0,(function*(){return H("removeItemResource")(e)}))}({id:i,owner:n.owner,resource:e.fileName,authentication:t}).then((e=>J(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))),(e=>J(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}))))}))}getAppId(){var e;return null===(e=(0,r.getAppStore)().getState().appStateInBuilder)||void 0===e?void 0:e.appId}getSession(){return r.SessionManager.getInstance().getMainSession()}getPortalUrlWithTemplate(){return"${appResourceUrl}/"}getPortalUrlWithFull(e){return function(e){const t=F(e)?r.urlUtils.getArcgisOnlineUrl():(0,r.getAppStore)().getState().portalUrl;return(null==e?void 0:e.isLocalApp)?m()+"/apps/":r.portalUrlUtils.getPlatformUrlByOrgUrl(t)+"/sharing/rest/content/items/"}({isLocalApp:window.jimuConfig.isDevEdition})+e+"/resources"}setResourceMap(e,t){const{id:i,resourceUrl:n}=t;this.resourceMap[e]=Object.assign(Object.assign({},this.resourceMap[e]),t),this.blobToResourceMap[t.blobUrl]={id:i,resourceUrl:n},(0,r.getAppStore)().dispatch(l.WI.AddResource(e,this.resourceMap[e]))}setResourceItemInfoStatus(e,t){this.resourceMap&&this.resourceMap[e.id]&&(e.status=t,delete e.file,this.setResourceMap(e.id,e))}clearResourceMap(){for(const e in this.resourceMap)this.resourceMap[e]&&window.URL.revokeObjectURL(this.resourceMap[e].blobUrl);this.resourceMap={},this.blobToResourceMap={}}clearValueWithoutInResourcesInDraft(e,t){return J(this,void 0,void 0,(function*(){if(this.getAppId()!==e&&Object.keys(this.resources).forEach((e=>{this.resources[e]=null})),t.length>0){const i=yield this.getImageResourceListFromDraft(e),n=yield this.getIconResourceListFromDraft(e),o=[...Object.values(i).map((({resourcesPrefix:e,fileName:t})=>`${e}/${t}`)),...Object.values(n).map((({properties:{filename:e}})=>`images/icon_picker_in_setting/${e}`))],s=t.filter((e=>!o.includes(e)));return yield Promise.resolve(s)}return yield Promise.resolve(t)}))}clearResourcesWithoutSaved(e){return J(this,void 0,void 0,(function*(){if(e)try{const t=this.getPortalUrlWithFull(e),i=this.getPortalUrlWithTemplate(),{resources:n}=yield this.fetchAppResourceInfoList(e,{httpMethod:"GET"}),o=(null==n?void 0:n.some((({resource:e})=>e===V.Config)))||!1?yield this.fetchAppResource(e,{fileName:V.Config,readAs:"json"}):{},s=new RegExp("^\\$\\{appResourceUrl\\}+(.)"),a=new RegExp("^"+t),l={};r.utils.replaceStringInObject(o,{matcher:e=>s.test(e)||a.test(e),handler:e=>l[e]=e});const d=[];null==n||n.forEach((({resource:e})=>{e===V.Config||e===V.Image||e===V.Icon||l[i+e.replace("_compress","")]||l[t+e.replace("_compress","")]||d.push(e)}));const u=(yield this.clearValueWithoutInResourcesInDraft(e,d)).map((t=>this.removeAppResource({appId:e,fileName:t})));Promise.all(u)}catch(e){console.error(e)}}))}formatRelatedImageResources(e,t){const i={},n={},o=[];for(let e=0;e<t.length;e++){const i=t[e].fileName.split(".")[0];o.push(i)}return Object.keys(e).forEach((t=>{e[t].referredIds=[];const i=e[t].originId;o.includes(t)&&(n[t]=e[t]),o.includes(i)&&(n[i]=e[i])})),Object.keys(n).forEach((e=>{n[e].referredIds=[];const t=n[e].originId;t!==e&&(i[t]?i[t].referredIds.push(e):(i[t]=Object.assign({},n[t]),i[t].referredIds=[e]))})),Object.keys(i).forEach((e=>{n[e]&&(n[e].referredIds=i[e].referredIds)})),n}checkResourcesUploadStatus(e){return J(this,void 0,void 0,(function*(){if(e.length>0){const t=e.map((e=>this.resourceMap[e].promise));return yield Promise.all(t).then((()=>J(this,void 0,void 0,(function*(){return yield Promise.resolve(r.AjaxState.Success)}))),(()=>J(this,void 0,void 0,(function*(){return yield Promise.resolve(r.AjaxState.Error)})))).catch((e=>J(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject()}))))}return yield Promise.resolve(r.AjaxState.Success)}))}upLoadResourceList(e){return J(this,arguments,void 0,(function*(e,t={},i){const n=i||this.getAppId(),o=yield this.upLoadLocalResource(t),s=r.appConfigUtils.cleanPortalInfoFromResource(o),a=new Blob([JSON.stringify(s)],{type:"application/json"}),[l,d]=e.split("/"),u={appId:n,file:a,resourcesPrefix:l,fileName:d,type:r.ResourceType.Image};return yield this.upLoadAppResource(u).then((()=>J(this,void 0,void 0,(function*(){return yield Promise.resolve(s)})))).catch((e=>J(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}))}getAppInfo(e){return J(this,void 0,void 0,(function*(){const t=function(e){if(z(e))return{};const t=r.SessionManager.getInstance().getMainSession();return W(e)?t:{}}(e);return yield function(e,t){return $(this,void 0,void 0,(function*(){return H("getItem",e)(e.id,t,F(e))}))}(e,{authentication:t}).then((e=>J(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}}},2241:(e,t,i)=>{"use strict";i.d(t,{Ay:()=>r,TX:()=>n,yx:()=>a});var n,o=i(9244),s=i(3596);!function(e){e.InBuilderPutAppConfigIntoHistory="IN_BUILDER_PUT_APPCONFIG_INTO_HISTORY",e.InBuilderRemoveLastAppConfigFromHistory="IN_BUILDER_REMOVE_LAST_APPCONFIG_FROM_HISTORY",e.InBuilderReplaceLastAppConfigInHistory="IN_BUILDER_REPLACE_LAST_APPCONFIG_IN_HISTORY",e.InBuilderAppConfigUndo="IN_BUILDER_APPCONFIG_UNDO",e.InBuilderAppConfigRedo="IN_BUILDER_APPCONFIG_REDO",e.InBuilderAppConfigRedoClear="IN_BUILDER_APPCONFIG_REDOCLEAR",e.InBuilderAppConfigClear="IN_BUILDER_APPCONFIG_CLEAR"}(n||(n={}));const a={InBuilderAppConfigUndo:()=>({type:n.InBuilderAppConfigUndo}),InBuilderAppConfigRedo:()=>({type:n.InBuilderAppConfigRedo}),InBuilderPutAppConfigIntoHistory:e=>({type:n.InBuilderPutAppConfigIntoHistory,appState:e}),InBuilderRemoveLastAppConfigFromHistory:()=>({type:n.InBuilderRemoveLastAppConfigFromHistory}),InBuilderReplaceLastAppConfigInHistory:e=>({type:n.InBuilderReplaceLastAppConfigInHistory,appState:e}),InBuilderAppConfigRedoClear:()=>({type:n.InBuilderAppConfigRedoClear}),InBuilderAppConfigClear:()=>({type:n.InBuilderAppConfigClear})};class r{constructor(){this.id="app-state-history-extension"}getActions(){return[n.InBuilderPutAppConfigIntoHistory,n.InBuilderRemoveLastAppConfigFromHistory,n.InBuilderReplaceLastAppConfigInHistory,n.InBuilderAppConfigUndo,n.InBuilderAppConfigRedo,n.InBuilderAppConfigRedoClear,n.InBuilderAppConfigClear]}getInitLocalState(){return{past:[],future:[]}}getReducer(){return(e,t,i)=>{switch(t.type){case n.InBuilderAppConfigUndo:return this.handleAppStateUndo(e);case n.InBuilderAppConfigRedo:return this.handleAppStateRedo(e);case n.InBuilderPutAppConfigIntoHistory:return this.handleAppStateAdd(e,t.appState);case n.InBuilderRemoveLastAppConfigFromHistory:return this.handleAppStateRemoveLast(e);case n.InBuilderReplaceLastAppConfigInHistory:return this.handleAppStateReplaceLast(e,t.appState);case n.InBuilderAppConfigRedoClear:return this.handleAppStateRedoClear(e);case n.InBuilderAppConfigClear:return this.handleAppStateClear(e);default:return e}}}handleAppStateUndo(e){if(e.past.length<2)return console.warn("Can not undo since no history there"),e;const t=e.past[e.past.length-2],i=e.past[e.past.length-1],n=e.past.slice(0,e.past.length-1),a=[i].concat(e.future);return o.lodash.defer((()=>{(0,s.publishAppConfigChangeToApp)(t.appConfig),(0,s.publishAppInfoChangeToApp)(t.appInfo)})),e.merge({past:n,future:a})}handleAppStateRedo(e){if(e.future.length<1)return console.warn("Can not redo since no history there"),e;const t=e.future[0],i=e.future.slice(1),n=e.past.concat([t]);return o.lodash.defer((()=>{(0,s.publishAppConfigChangeToApp)(t.appConfig),(0,s.publishAppInfoChangeToApp)(t.appInfo)})),e.merge({past:n,future:i})}handleAppStateAdd(e,t){const i=e.past[e.past.length-1];if(null!==t&&(e.past.length>0&&(i.appConfig!==t.appConfig||i.appInfo!==t.appInfo)||0===e.past.length)){const i=e.past.concat([t]);return e.set("past",i).set("future",[])}return e}handleAppStateRemoveLast(e){if(e.past.length>0){const t=e.past.slice(0,e.past.length-1);return e.set("past",t)}return e}handleAppStateReplaceLast(e,t){let i=e.past;return e.past.length>0?(i=i.slice(0,e.past.length-1).concat(t),e.set("past",i)):e}handleAppStateRedoClear(e){return e.set("future",[])}handleAppStateClear(e){return e.set("future",[]).set("past",[])}getStoreKey(){return"appStateHistory"}}},1575:(e,t,i)=>{"use strict";i.d(t,{Aj:()=>s,Ay:()=>a,ck:()=>n});var n,o=i(9244);!function(e){e.InAppAppStateChanged="IN_APP_APP_STATE_CHANGED",e.InBuilderAppConfigChanged="IN_BUILDER_APP_CONFIG_CHANGED"}(n||(n={}));const s={inAppAppStateChanged:e=>({type:n.InAppAppStateChanged,appState:e}),inBuilderAppConfigChanged:e=>({type:n.InBuilderAppConfigChanged,appConfig:e})};class a{constructor(){this.id="builder-app-state-redux-store-extension"}getActions(){return Object.keys(n).map((e=>n[e]))}getInitLocalState(){return null}getReducer(){return(e,t,i)=>{switch(t.type){case n.InAppAppStateChanged:return t.appState;case n.InBuilderAppConfigChanged:return o.appConfigUtils.updateStateWhenAppConfigChange(e,t.appConfig);default:return e}}}getStoreKey(){return"appStateInBuilder"}}},4601:(e,t,i)=>{"use strict";i.d(t,{A:()=>o});var n=i(9244);class o extends n.WidgetManager{static getInstance(){return window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._widgetManager:n.WidgetManager.getInstance()}}},3596:(e,t,i)=>{"use strict";i.r(t),i.d(t,{listenAppEvents:()=>W,publishActivePagePartChangeToApp:()=>M,publishAnimationPreviewToApp:()=>T,publishAppConfigChangeToApp:()=>c,publishAppInfoChangeToApp:()=>p,publishAppModeChangeToApp:()=>h,publishChangeBrowserSizeModeToApp:()=>C,publishChangeSelectionToApp:()=>y,publishChangeSessionToApp:()=>b,publishChangeWidgetMutableStatePropToApp:()=>I,publishChangeWidgetStatePropToApp:()=>v,publishChangeZoomScaleToApp:()=>x,publishDialogChangeToApp:()=>m,publishDialogInfosChangeToApp:()=>g,publishHoverPreviewToApp:()=>P,publishKeyboardToApp:()=>w,publishNoPermissionResourceInfoListChangeToApp:()=>A,publishOpenCookieBannerByPrivacyPanelToApp:()=>U,publishOpenCookieBannerToApp:()=>R,publishOpenCookieSettingsWindowToApp:()=>O,publishPageChangeToApp:()=>f,publishScreenGroupNavInfoToApp:()=>D,publishSectionNavInfoToApp:()=>L,publishSetClientIdAlertIsCancelled:()=>E,publishSetWidgetIsInlineEditingStateToApp:()=>B,publishTocHoverInfoToApp:()=>j,publishUtilityStateChangeToApp:()=>S,publishWidgetToolbarIsNewFlagChangeToApp:()=>_,publishWidgetToolbarStateChangeToApp:()=>k});var n=i(9244),o=i(1575),s=i(2241),a=i(876),r=i(1169),l=i(3557),d=i(7659),u=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function c(e){G(`to_app.${r.w.AppConfigChanged}`,e)}function p(e){G(`to_app.${r.w.AppInfoChanged}`,e)}function g(e){G(`to_app.${r.w.DialogInfosChanged}`,e)}function h(e){G(`to_app.${r.w.ChangeAppMode}`,e)}function f(e){G(`to_app.${r.w.ChangePage}`,e)}function m(e){G(`to_app.${r.w.ChangeDialog}`,e)}function y(e){G(`to_app.${r.w.ChangeSelection}`,e)}function v(e){G(`to_app.${r.w.ChangeWidgetStateProp}`,e)}function S(e,t,i){G(`to_app.${r.w.UtilityStateChanged}`,{utilityId:e,state:t,isSignInError:i})}function I(e){G(`to_app.${r.w.ChangeWidgetMutableStateProp}`,e)}function w(e){G(`to_app.${r.w.BuilderTriggerKeyboard}`,e)}function C(e){G(`to_app.${r.w.ChangeBrowserSizeMode}`,e)}function b(){G(`to_app.${r.w.BuilderSessionChanged}`,n.SessionManager.getInstance().getSessions())}function A(){G(`to_app.${r.w.BuilderNoPermissionResourceInfoListChanged}`,n.SessionManager.getInstance().getNoPermissionResourceInfoList())}function x(e){G(`to_app.${r.w.ChangeZoomScale}`,e)}function M(e){G(`to_app.${r.w.ActivePagePartChanged}`,e)}function T(e){G(`to_app.${r.w.AnimationPreview}`,e)}function P(e){G(`to_app.${r.w.HoverPreview}`,e)}function L(e,t){G(`to_app.${r.w.SectionNavInfoChanged}`,{sectionId:e,navInfo:t})}function D(e,t){G(`to_app.${r.w.ScreenGroupNavInfoChanged}`,{screenGroupId:e,activeIndex:t})}function j(e,t){G(`to_app.${r.w.TocHoverInfoChanged}`,{layoutInfo:e,hovered:t})}function E(e){G(`to_app.${r.w.SetClientIdAlertIsCancelled}`,{portalUrl:e})}function R(e){G(`to_app.${r.w.OpenCookieBanner}`,{isOpen:e})}function U(e){G(`to_app.${r.w.OpenCookieBannerByPrivacyPanel}`,{isOpen:e})}function O(e){G(`to_app.${r.w.OpenCookieSettingsWindow}`,{isOpen:e})}function k(e,t){G(`to_app.${r.w.WidgetToolbarStateChange}`,{widgetId:e,toolNames:t})}function _(e,t,i){G(`to_app.${r.w.WidgetToolbarIsNewFlagChange}`,{widgetId:e,toolNames:t,flag:i})}function B(e,t){G(`to_app.${r.w.SetWidgetIsInlineEditingState}`,{widgetId:e,isInlineEditing:t})}function G(e,t){window._builderPubsub.publishSync(e,t)}function W(){window._builderPubsub.subscribe(`to_builder.${r.M.AppSessionChanged}`,((e,t)=>{n.SessionManager.getInstance().syncSessionsFromOtherWindow(t)})),window._builderPubsub.subscribe(`to_builder.${r.M.AppNoPermissionResourceInfoListChanged}`,((e,t)=>{n.SessionManager.getInstance().syncNoPermissionResourceInfoListFromOtherWindow(t)})),window._builderPubsub.subscribe(`to_builder.${r.M.NeedToCheck498Error}`,((e,t)=>{n.SessionManager.getInstance().handleInvalidToken(t)})),window._builderPubsub.subscribe("to_builder",(function(e,t){console.debug(e,t)})),window._builderPubsub.subscribe(`to_builder.${r.M.AppStateChanged}`,((e,t)=>{var i;if((0,n.getAppStore)().getState().builder.currentAppId!==t.appId&&((0,n.getAppStore)().dispatch(a.Zv.changeCurrentApp(t.appId)),(0,n.getAppStore)().dispatch(s.yx.InBuilderAppConfigClear()),(0,n.getAppStore)().getState().queryObject.id!==t.appId&&n.jimuHistory.changeQueryObject({id:t.appId})),!(0,n.getAppStore)().getState().appStateInBuilder||(0,n.getAppStore)().getState().appStateInBuilder.appConfig!==t.appConfig){const e=t.appConfig,r=null===(i=(0,n.getAppStore)().getState().appStateInBuilder)||void 0===i?void 0:i.appConfig;if(e&&r){if(Object.keys(e.widgets||{}).find((t=>e.widgets[t]&&r.widgets[t]&&e.widgets[t].version!==r.widgets[t].version)))return void(0,n.getAppStore)().dispatch(o.Aj.inAppAppStateChanged(t));const i=Object.keys(r.widgets).filter((t=>!e.widgets[t]));(0,n.getAppStore)().dispatch(a.Zv.widgetsRemoved(i));const s=Object.keys(e.widgets).filter((e=>!r.widgets[e])).map((t=>({widgetId:t,widgetUri:e.widgets[t].uri})));(0,n.getAppStore)().dispatch(a.Zv.widgetsAdded(s))}if(e&&!r&&!t.userLocaleChanged)if(n.GuideManager.getInstance().showTemplateGuide(),window.parent.isExpressBuilder){const t=e.template;(0,d.getExpressModeTemplateNames)("app").then((e=>{e.includes(t)&&n.GuideManager.getInstance().startGuide({id:`general-express-mode-${t}`,type:n.GuideTypes.Program,level:n.GuideLevels.Builder},!0)}))}else n.GuideManager.getInstance().startGuide({id:"opening-tour",type:n.GuideTypes.Program,level:n.GuideLevels.Builder},!0);t.appConfig&&(0,n.getAppStore)().dispatch(s.yx.InBuilderPutAppConfigIntoHistory({appConfig:t.appConfig,appInfo:t.appInfo}))}(0,n.getAppStore)().dispatch(o.Aj.inAppAppStateChanged(t))})),window._builderPubsub.subscribe(`to_builder.${r.M.AppAddResource}`,((e,t)=>{const i=l.N.getInstance();l.N.getBlobByBlobUrl(t.file).then((e=>u(this,void 0,void 0,(function*(){t.file=e,i.upLoadAppResource(t),t.type===n.ResourceType.Image&&t.originId&&l.N.getInstance().updateImageResourceItemInfo(t)}))))})),window._builderPubsub.subscribe(`to_builder.${r.M.AppClearResources}`,((e,t)=>{l.N.getInstance().clearResources(t)})),window._builderPubsub.subscribe(`to_builder.${r.M.AppTriggerKeyboard}`,((e,t)=>{n.keyboardUtils.triggerEvent(t)})),window._builderPubsub.subscribe(`to_builder.${r.M.SetLayoutTools}`,((e,t)=>{(0,n.getAppStore)().dispatch(a.Zv.setLayoutTools(t))})),window._builderPubsub.subscribe(`to_builder.${r.M.ClearLastAppConfigFromHistory}`,(e=>{(0,n.getAppStore)().dispatch(s.yx.InBuilderRemoveLastAppConfigFromHistory())})),window._builderPubsub.subscribe(`to_builder.${r.M.SetIsBusy}`,((e,t)=>{(0,n.getAppStore)().dispatch(n.appActions.setIsBusy(t))})),window._builderPubsub.subscribe(`to_builder.${r.M.ConfirmDelete}`,((e,t)=>{(0,n.getAppStore)().dispatch(a.Zv.confirmDeleteContentChanged(t))})),window._builderPubsub.subscribe(`to_builder.${r.M.NeedToRegisterClinetId}`,((e,t)=>{(0,n.getAppStore)().dispatch(n.appActions.addToRegisterClientIdList(t.portalUrl,t.needToSignIn,t.serviceUrl,t.forceLogin))})),window._builderPubsub.subscribe(`to_builder.${r.M.AppIsLoaded}`,((e,t)=>{var i;const o=(0,n.getAppStore)().getState(),s={portalUrl:o.portalUrl,clientId:o.clientId,isWebTier:o.isWebTier};G(`to_app.${r.w.SetMainPortal}`,s),(0,n.observeStore)(((e,t)=>{G(`to_app.${r.w.SetMainPortal}`,{portalUrl:t})}),["portalUrl"]),(0,n.getAppStore)().getState().portalSelf&&G(`to_app.${r.w.PortalSelfChanged}`,(0,n.getAppStore)().getState().portalSelf),(0,n.observeStore)(((e,t)=>{G(`to_app.${r.w.PortalSelfChanged}`,t)}),["portalSelf"]),n.portalUtils.getAppInfo(null===(i=(0,n.getAppStore)().getState().queryObject)||void 0===i?void 0:i.id).then((e=>{if(window.isExpressBuilder&&!e.typeKeywords.includes(n.CONSTANTS.TYPE_KEYWORDS_OF_EXPRESS_APP)){const e=(0,n.getAppStore)().getState().queryObject.without("mode"),t=new URL(window.location.href);t.search=n.queryString.stringify(e),window.location.href=t.toString()}else if(!window.isExpressBuilder&&e.typeKeywords.includes(n.CONSTANTS.TYPE_KEYWORDS_OF_EXPRESS_APP)){const e=(0,n.getAppStore)().getState().queryObject.set("mode","express"),t=new URL(window.location.href);t.search=n.queryString.stringify(e),window.location.href=t.toString()}G(`to_app.${r.w.AppInfoChanged}`,e)})),(0,n.getAppStore)().getState().user&&G(`to_app.${r.w.UserSignIn}`,(0,n.getAppStore)().getState().user),b()}))}},3209:(e,t,i)=>{"use strict";i.d(t,{Ay:()=>a,WI:()=>s,vK:()=>n});var n,o=i(9244);!function(e){e.AddResource="ADD_RESOURCE",e.UpdateResource="UPDATE_RESOURCE",e.ClearResources="CLEAR_RESOURCES"}(n||(n={}));const s={AddResource:(e,t)=>({type:n.AddResource,resourceKey:e,resourceItemInfo:t}),UpdateResource:(e,t)=>({type:n.UpdateResource,resourceKey:e,resourceItemInfo:t}),ClearResources:()=>({type:n.ClearResources})};class a{constructor(){this.id="builder-state-resource-extension"}getActions(){return Object.keys(n).map((e=>n[e]))}getInitLocalState(){return(0,o.Immutable)({})}getReducer(){return(e,t,i)=>{switch(t.type){case n.AddResource:case n.UpdateResource:return e.set(t.resourceKey,t.resourceItemInfo);case n.ClearResources:return(0,o.Immutable)({});default:return e}}}getStoreKey(){return"resourcesInfo"}}},876:(e,t,i)=>{"use strict";i.d(t,{Ay:()=>a,M1:()=>n,Zv:()=>s,qR:()=>n});var n,o=i(9244);!function(e){e.SelectTemplate="SELECT_TEMPLATE",e.WidgetSettingClassLoaded="WIDGET_SETTING_CLASS_LOADED",e.WidgetsRemoved="WIDGETS_REMOVED",e.WidgetsAdded="WIDGETS_ADDED",e.ChangeCurrentApp="CHANGE_CURRENT_APP",e.RefreshAppList="REFRSH_APPLIST",e.SetLayoutTools="SET_LAYOUT_TOOLS",e.WidgetSettingI18nMessageLoaded="WIDGET_SETTING_I18N_MESSAGE_LOADED",e.ConfirmDeleteContentChanged="CONFIRM_DELETE_CONTENT_CHANGED",e.MessageActionSettingOpenStateChange="MESSAGE_ACTION_OPEN_STATE_CHANGE"}(n||(n={}));const s={selectTemplate:e=>({type:n.SelectTemplate,templateName:e}),refreshAppListAction:e=>({type:n.RefreshAppList,isRefresh:e}),widgetSettingClassLoaded:e=>({type:n.WidgetSettingClassLoaded,wigetUri:e}),changeMessageActionSettingOpenState:(e,t)=>({type:n.MessageActionSettingOpenStateChange,widgetId:e,open:t}),widgetsAdded:e=>({type:n.WidgetsAdded,widgets:e}),widgetsRemoved:e=>({type:n.WidgetsRemoved,widgetIds:e}),changeCurrentApp:e=>({type:n.ChangeCurrentApp,appId:e}),setLayoutTools:e=>({type:n.SetLayoutTools,tools:e}),widgetSettingI18nMessageLoaded:(e,t)=>({type:n.WidgetSettingI18nMessageLoaded,widgetName:e,i18nMessages:t}),confirmDeleteContentChanged:e=>({type:n.ConfirmDeleteContentChanged,itemToDelete:e})};class a{constructor(){this.id="builder-state-redux-store-extension"}getActions(){return Object.keys(n).map((e=>n[e]))}getInitLocalState(){return(0,o.Immutable)({templateName:null,currentAppId:null,refreshAppList:!1,isMobile:!1,widgetSettingI18nMessages:(0,o.Immutable)({}),widgetsSettingClassStatus:(0,o.Immutable)({})})}getReducer(){return(e,t,i)=>{switch(t.type){case n.SelectTemplate:return e.set("templateName",t.templateName);case n.WidgetSettingClassLoaded:return e=e.setIn(["widgetsSettingClassStatus",t.wigetUri],!0),function(e,t){var i,n;const o=(null===(n=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig)||void 0===n?void 0:n.widgets)||{};return Object.keys(o).filter((e=>o[e].uri===t))}(i,t.wigetUri).forEach((t=>{e=e.setIn(["widgetsSettingRuntimeInfo",t,"isClassLoaded"],!0)})),e;case n.WidgetsAdded:return t.widgets.forEach((t=>{e.widgetsSettingClassStatus[t.widgetUri]&&(e=e.setIn(["widgetsSettingRuntimeInfo",t.widgetId,"isClassLoaded"],!0))})),e;case n.WidgetsRemoved:return e.set("widgetsSettingRuntimeInfo",e.widgetsSettingRuntimeInfo.without(...t.widgetIds));case n.ChangeCurrentApp:return(e=this.getInitLocalState()).set("currentAppId",t.appId).set("widgetsSettingRuntimeInfo",{});case n.MessageActionSettingOpenStateChange:return(null==e?void 0:e.widgetMessageActionSettingStatus)||(e=e.set("widgetMessageActionSettingStatus",{})),e=e.setIn(["widgetMessageActionSettingStatus",t.widgetId],t.open);case n.RefreshAppList:return e.set("refreshAppList",t.isRefresh);case n.SetLayoutTools:return e.set("toolbarConfig",t.tools);case n.WidgetSettingI18nMessageLoaded:return e.setIn(["widgetSettingI18nMessages",t.widgetName],t.i18nMessages);case n.ConfirmDeleteContentChanged:{const{itemToDelete:i}=t;return e.set("contentToDelete",i)}default:return e}}}getStoreKey(){return"builder"}}},7740:(e,t,i)=>{"use strict";i.d(t,{_b:()=>u,kM:()=>U,Q:()=>G,xk:()=>N,xw:()=>qe,Td:()=>K,w5:()=>ee,m2:()=>M,EL:()=>se,M0:()=>ue,pT:()=>fe,KE:()=>Ie,Xn:()=>xe,Nf:()=>De,xY:()=>Oe,n3:()=>We,_R:()=>L,OE:()=>S,Wy:()=>r});var n=i(9244),o=i(8151),s=i(4981);class a extends n.React.PureComponent{constructor(e){var t,a,r,l;super(e),this.currentStep=0,this.handleChange=e=>{var t,i,s;const{index:a,nextIndex:r,event:l}=e;if(2===a?n.jimuHistory.changeView("opts-section","insert"):4===a?(0,n.getAppStore)().dispatch(n.appActions.widgetStatePropChange("right-sidebar","collapse",!0)):11===a?n.jimuHistory.changeView("opts-section","page"):12===a?n.jimuHistory.changeView("opts-section","data"):13===a&&n.jimuHistory.changeView("opts-section","theme"),2===r&&l===o.EVENTS.STEP_AFTER)(0,n.getAppStore)().dispatch(n.appActions.widgetStatePropChange("left-sidebar","collapse",!0));else if(7===r&&l===o.EVENTS.STEP_AFTER){const e=null===(t=this.props)||void 0===t?void 0:t.pageMode;this.setState({conditionalStepIndexes:Object.assign(Object.assign({},this.state.conditionalStepIndexes),{7:e===n.PageMode.AutoScroll?1:0})})}null===(s=null===(i=this.props)||void 0===i?void 0:i.onStepChange)||void 0===s||s.call(i,e)},this.handleClick=(e,t,i)=>{this.setState({stepIndex:i+1})};const d=n.utils.replaceI18nPlaceholdersInObject(i(9114),n.i18n.getIntl(),s.A);this.state={stepIndex:null!==(t=e.stepIndex)&&void 0!==t?t:0,steps:null!==(a=d.steps)&&void 0!==a?a:[],conditionalStepIndexes:null!==(r=e.conditionalStepIndexes)&&void 0!==r?r:{},run:null===(l=e.run)||void 0===l||l}}componentDidUpdate(e){(null==e?void 0:e.run)!==this.props.run&&this.setState({run:this.props.run}),(null==e?void 0:e.stepIndex)!==this.props.stepIndex&&this.setState({stepIndex:this.props.stepIndex})}render(){const{stepIndex:e,steps:t,run:i,conditionalStepIndexes:s}=this.state;return(0,n.jsx)(o.GuideComponent,{run:i,stepIndex:e,steps:t,conditionalStepIndexes:s,onStepChange:this.handleChange,onActionTriggered:this.handleClick})}}const r=n.ReactRedux.connect((e=>{var t,i,n,o,s,a;const r=null===(i=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo)||void 0===i?void 0:i.currentPageId;return{queryObject:e.queryObject,pageMode:null===(a=null===(s=null===(o=null===(n=e.appStateInBuilder)||void 0===n?void 0:n.appConfig)||void 0===o?void 0:o.pages)||void 0===s?void 0:s[r])||void 0===a?void 0:a.mode}}))(a),{useState:l,useEffect:d}=n.React;const u=n.ReactRedux.connect(((e,t)=>{var i,s,a;const r=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig,l=null===(s=e.appStateInBuilder)||void 0===s?void 0:s.appRuntimeInfo.selection;let d;if(l){const e=(0,o.findLayoutItem)(r,l);e&&e.type===n.LayoutItemType.Widget&&e.widgetId&&(d=r.widgets[e.widgetId])}return{dataSourcesInfo:null===(a=e.appStateInBuilder)||void 0===a?void 0:a.dataSourcesInfo,widgetDs:null==d?void 0:d.useDataSources,widgetJson:d}}))((e=>{const t=n.utils.replaceI18nPlaceholdersInObject(i(5132),n.i18n.getIntl(),s.A),{dataSourcesInfo:a,widgetDs:r,widgetJson:u}=e,[c,p]=l(!1),[g,h]=l(0),[f,m]=l(!1),[y,v]=l({0:0,2:0}),S=function(e,t){if(!e||!t)return!1;const i=Object.keys(null!=e?e:{}).length;return Object.keys(null!=t?t:{}).length>i}(function(e){const t=n.React.useRef();return d((()=>{t.current=e})),t.current}(a),a);return d((()=>{var t;0===e.stepIndex&&"arcgis-map"===(null===(t=null==u?void 0:u.manifest)||void 0===t?void 0:t.name)&&v({0:1,2:1})}),[u,e.stepIndex]),d((()=>{p(e.run)}),[e.run]),d((()=>{h(e.stepIndex)}),[e.stepIndex]),d((()=>{c&&r&&m(!r.length),!c&&S&&(h(g+1),p(!0))}),[r,S,c]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:c,stepIndex:g,steps:t.steps,conditionalStepIndexes:y,onActionTriggered:(t,i,n)=>{var o;0===n?h(1):1===n&&p(!1),null===(o=null==e?void 0:e.onActionTriggered)||void 0===o||o.call(e,t,i,n)},onStepChange:t=>{const{index:i,event:n}=t;2===i&&n===o.EVENTS.TOOLTIP&&m(!0),null==e||e.onStepChange(Object.assign(Object.assign({},t),{run:c}))},disabled:f,isInjected:!0}))}));var c=i(3596),p=i(4617),g=i(1496);const{useState:h,useEffect:f,useMemo:m,useRef:y}=n.React;function v(e,t=""){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]},{widgetName:t})}const S=n.ReactRedux.connect((e=>{var t,i,n;return{appConfig:null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig,widgetSelection:null===(n=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appRuntimeInfo)||void 0===n?void 0:n.selection}}))((e=>{const{params:t,appConfig:i,widgetSelection:s}=e,a=null==t?void 0:t.widgetName,[r,l]=h(!1),[d,u]=h(0),[S,I]=h(!1),w=y(null),C=y(null),b=m((()=>[{title:v("insertWidgetStep1Title"),content:{image:{src:"jimu-for-builder/guide-assets/Insert-widget.gif",alt:v("insertWidgetStep1Title"),border:!0,width:400,height:220,autoFlip:!0},text:v("insertWidgetStep1Content")},placement:"auto",target:`[data-sectionid='opts-section'] .widget-card-item[data-widget-name='${a}']`,spotlightClicks:!0,requiredAction:{type:"custom"},disableNextButton:!0}]),[a]),A=()=>{document.body.removeEventListener("dragstart",w.current),document.body.removeEventListener("dragend",C.current)};return f((()=>{A(),l(e.run)}),[e.run]),f((()=>{u(e.stepIndex)}),[e.stepIndex]),f((()=>{if(!r){const e=g.searchUtils.findLayoutItem(i,s);let t;e&&e.type===n.LayoutItemType.Widget&&e.widgetId&&(t=null==i?void 0:i.widgets[e.widgetId]),S&&(null==t?void 0:t.manifest.name)===a&&(u(1),l(!0))}}),[a,r,S,i,s]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:r,stepIndex:d,steps:b,onStepChange:t=>{const{index:i,event:n,step:s,status:a}=t,r=(0,o.getTargetSelector)(s),d=document.querySelector(r);if(d){(e=>{if(!e)return!1;const t=e.getBoundingClientRect(),i=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth;if(!(t.top>=0&&t.left>=0&&t.bottom<=i&&t.right<=n))return!1;const o=t.left+t.width/2,s=t.top+t.height/2,a=document.elementFromPoint(o,s);return a===e||e.contains(a)})(d)||d.scrollIntoView({behavior:"smooth",block:"center"}),0===i&&n===o.EVENTS.TOOLTIP&&((0,c.publishChangeSelectionToApp)(null),(0,p.y)().setLockLayout(!1).exec(),((t,i)=>{w.current=e=>{var n,o;(null===(o=null===(n=e.target)||void 0===n?void 0:n.parentElement)||void 0===o?void 0:o.querySelector(i))===e.target?(l(!1),t.addEventListener("dragend",C.current)):A()},C.current=i=>{var n;"none"===(null===(n=null==i?void 0:i.dataTransfer)||void 0===n?void 0:n.dropEffect)?(u(0),l(!0)):(I(!0),e.onStepChange({isInjected:!0,status:o.STATUS.FINISHED})),t.removeEventListener("dragend",C.current),A()},t&&document.body.addEventListener("dragstart",w.current)})(d,r)),null==e||e.onStepChange(t)}else console.warn("insert widget target not found:",r);a!==o.STATUS.FINISHED&&a!==o.STATUS.SKIPPED||A()},isInjected:!0}))}));var I=i(4321),w=i(3634);const{useState:C,useEffect:b,useMemo:A}=n.React;function x(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const M=n.ReactRedux.connect(null)((e=>{const[t,i]=C(!1),[s,a]=C(""),[r,l]=C(0),d=A((()=>[{title:x("expressModeStep1Title"),content:{text:x("expressModeStep1Content")},placement:"auto",target:".page-renderer .header .express-mode-switch-container .typography",spotlightClicks:!1,spotlightPadding:8,width:440}]),[]);return b((()=>{(0,w.getBuildAppsHelpLink)("express-mode").then((e=>{e&&a(e)}))})),b((()=>{i(e.run)}),[e.run]),b((()=>{l(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:r,steps:d,footerNav:(()=>{const e=x("expressModeLearnMore");return n.React.createElement(I.Link,{style:{marginRight:"auto",textDecoration:"none",paddingLeft:0,minWidth:"auto"},to:s,target:"_blank",title:e,"aria-label":e},e)})(),onStepChange:t=>{null==e||e.onStepChange(t)}}))})),{useState:T,useEffect:P}=n.React;const L=n.ReactRedux.connect(((e,t)=>{var i,n,o,s,a,r;const l=null===(i=null==t?void 0:t.widgetJson)||void 0===i?void 0:i.id,d=null===(n=e.appStateInBuilder)||void 0===n?void 0:n.appConfig;return{layouts:null==d?void 0:d.layouts,widgets:null==d?void 0:d.widgets,sections:null==d?void 0:d.sections,messageConfigs:null==d?void 0:d.messageConfigs,controllerPanels:null==d?void 0:d.controllerPanels,placeholderInfos:null==d?void 0:d.placeholderInfos,dataSourcesInfo:null===(o=e.appStateInBuilder)||void 0===o?void 0:o.dataSourcesInfo,widgetsState:null===(s=e.appStateInBuilder)||void 0===s?void 0:s.widgetsState,widgetDs:null===(r=null===(a=null==d?void 0:d.widgets)||void 0===a?void 0:a[l])||void 0===r?void 0:r.useDataSources}}))((e=>{const t=n.utils.replaceI18nPlaceholdersInObject(i(2802),n.i18n.getIntl(),s.A),{dataSourcesInfo:a,widgetDs:r}=e,[l,d]=T(!1),[u,c]=T(0),[p,g]=T(!1),h=function(e,t){if(!e||!t)return!1;const i=Object.keys(null!=e?e:{}).length;return Object.keys(null!=t?t:{}).length>i}(function(e){const t=n.React.useRef();return P((()=>{t.current=e})),t.current}(a),a);return P((()=>{}),[e.stepIndex]),P((()=>{d(e.run)}),[e.run]),P((()=>{c(e.stepIndex)}),[e.stepIndex]),P((()=>{l&&r&&g(!r.length),!l&&h&&(c(2),d(!0))}),[r,h,l]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:l,stepIndex:u,steps:t.steps,onActionTriggered:(t,i,n)=>{var o;null===(o=null==e?void 0:e.onActionTriggered)||void 0===o||o.call(e,t,i,n)},onStepChange:t=>{null==e||e.onStepChange(t)},disabled:p}))})),{useState:D,useEffect:j,useMemo:E}=n.React;function R(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const U=n.ReactRedux.connect(null)((e=>{const[t,i]=D(!1),[s,a]=D(0),r=E((()=>[{type:"splash",title:R("openingGuideStep1Title"),content:{image:{src:"jimu-for-builder/guide-assets/start-splash.svg",alt:R("openingGuideStep1Title"),width:237,height:286},text:R("welcomeStep1Content"),direction:"horizontal"},placement:"center",target:"#app",width:600}]),[]);return j((()=>{i(e.run)}),[e.run]),j((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:r,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:O,useEffect:k,useMemo:_}=n.React;function B(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const G=n.ReactRedux.connect(null)((e=>{const[t,i]=O(!1),[s,a]=O(0),r=_((()=>[{title:B("expressTopBarTitle"),content:{htm:B("expressTopBarContent"),direction:"horizontal"},placement:"auto",target:"div.widget-builder-header > div.d-flex.align-items-center.justify-content-end",width:480}]),[]);return k((()=>{i(e.run)}),[e.run]),k((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:r,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:W,useEffect:z,useMemo:F}=n.React;function $(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const N=n.ReactRedux.connect(null)((e=>{const[t,i]=W(!1),[s,a]=W(0),r=F((()=>[{title:$("expressFullEditModeTitle"),content:{text:$("expressFullEditModeContent"),direction:"horizontal"},placement:"auto",target:".tool_more_content .jimu-dropdown button",width:380}]),[]);return z((()=>{i(e.run)}),[e.run]),z((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:r,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:q,useEffect:H,useMemo:V}=n.React;function Q(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const K=n.ReactRedux.connect(((e,t)=>{var i,n;return{widgets:null===(n=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig)||void 0===n?void 0:n.widgets}}))((e=>{const[t,i]=q(!1),[s,a]=q(0),[r,l]=q(null),d=V((()=>[{title:Q("mapWidgetTitle"),content:{image:{src:"jimu-for-builder/guide-assets/configure-widget-1.svg",alt:Q("mapWidgetTitle"),width:340,height:220},htm:Q("mapWidgetContent"),direction:"vertical"},requiredAction:{type:"click"},disableNextButton:!0,targetInCanvas:!0,placement:"bottom",target:r?`[data-widgetid="${null==r?void 0:r.id}"] .arcgis-map`:".arcgis-map",width:380,height:420},{title:Q("expressSelectDataTitle"),content:{image:{src:"jimu-for-builder/guide-assets/configure-map.gif",alt:Q("expressSelectDataTitle"),width:340,height:220},text:Q("expressSelectDataContent"),direction:"vertical"},placement:"left-start",target:"[data-widgetid='dynamic-setting'] .widget-setting-tab:not([data-is-parent='true'])",width:380},{title:Q("expressMessageActionTitle"),content:{image:{src:"jimu-for-builder/guide-assets/message-action.gif",alt:Q("expressMessageActionTitle"),width:340,height:220},text:Q("expressMessageActionContent")},placement:"left-end",target:"[data-widgetid='dynamic-setting'] .widget-setting-tab:not([data-is-parent='true']) .message-action-con .message-action-con",width:380,height:400}]),[r]);return H((()=>{i(e.run)}),[e.run]),H((()=>{if(!e.widgets)return;const t=Object.values(e.widgets).find((e=>"arcgis-map"===e.manifest.name));t?l(t):(l(null),e.onStepChange({isInjected:!0,status:o.STATUS.FINISHED}))}),[e.widgets]),H((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:d,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:J,useEffect:Z,useMemo:Y}=n.React;function X(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const ee=n.ReactRedux.connect(null)((e=>{const[t,i]=J(!1),[s,a]=J(0),r=Y((()=>[{type:"splash",title:X("openingGuideStep1Title"),content:{image:{src:"jimu-for-builder/guide-assets/start-splash.svg",alt:X("openingGuideStep1Title"),width:237,height:286},text:X("welcomeStep1Content"),direction:"horizontal"},placement:"center",target:"#app",width:600}]),[]);return Z((()=>{i(e.run)}),[e.run]),Z((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:r,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:te,useEffect:ie,useMemo:ne}=n.React;function oe(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const se=n.ReactRedux.connect(null)((e=>{const[t,i]=te(!1),[s,a]=te(0),r=ne((()=>[{title:oe("expressPlaceholderTitle"),content:{image:{src:"jimu-for-builder/guide-assets/placeholder.gif",alt:oe("expressPlaceholderTitle"),width:340,height:220},htm:oe("expressPlaceholderContent"),direction:"vertical"},targetInCanvas:!0,placement:"auto",target:"div.builder-layout-item div.add-btn",width:380}]),[]);return ie((()=>{var t;const i=document.querySelector('iframe[name="_appWindow"]');(null===(t=null==i?void 0:i.contentDocument)||void 0===t?void 0:t.querySelector("div.builder-layout-item div.add-btn"))||e.onStepChange({isInjected:!0,status:o.STATUS.FINISHED})}),[]),ie((()=>{i(e.run)}),[e.run]),ie((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:r,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:ae,useEffect:re,useMemo:le}=n.React;function de(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const ue=n.ReactRedux.connect((e=>{var t,i;return{widgets:null===(i=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets}}))((e=>{const[t,i]=ae(!1),[s,a]=ae(0),[r,l]=ae(null),d=le((()=>[{title:de("expressSectionTitle"),content:{image:{src:"jimu-for-builder/guide-assets/section-view.gif",alt:de("expressSectionTitle")},htm:de("expressSectionContent"),direction:"vertical"},targetInCanvas:!0,placement:"auto",target:r?`[data-widgetid="${null==r?void 0:r.id}"] .widget-view-navigation`:".widget-view-navigation",width:380}]),[r]);return re((()=>{if(!e.widgets)return;const t=Object.values(e.widgets).find((e=>"navigator"===e.manifest.name));t?l(t):(l(null),e.onStepChange({isInjected:!0,status:o.STATUS.FINISHED}))}),[e.widgets]),re((()=>{i(e.run)}),[e.run]),re((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:d,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:ce,useEffect:pe,useMemo:ge}=n.React;function he(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const fe=n.ReactRedux.connect((e=>{var t,i,n;return{widgets:null===(i=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets,widgetsState:null===(n=e.appStateInBuilder)||void 0===n?void 0:n.widgetsState}}))((e=>{const[t,i]=ce(!1),[s,a]=ce(0),[r,l]=ce(null),d=ge((()=>[{title:he("expressSidebarTitle"),content:{image:{src:"jimu-for-builder/guide-assets/sidebar-visible.gif",alt:he("expressSidebarTitle"),width:340,height:220},htm:he("expressSidebarContent1")+he("expressSidebarContent"),direction:"vertical"},requiredAction:{type:"click"},disableNextButton:!0,placement:"auto",target:r?`[data-widgetid="${null==r?void 0:r.id}"] .side-collapsable>div:nth-child(2)>div`:".side-collapsable>div:nth-child(2)>div",width:380,targetInCanvas:!0}]),[r]);return pe((()=>{var t,i;if(!e.widgets)return;const n=Object.values(e.widgets).find((e=>"sidebar"===e.manifest.name));if(n&&(null===(t=null==n?void 0:n.config)||void 0===t?void 0:t.toggleBtn)){l(n);const e=document.querySelector('iframe[name="_appWindow"]'),t=null===(i=null==e?void 0:e.contentDocument)||void 0===i?void 0:i.querySelector(`[data-widgetid="${n.id}"] .side-collapsable>div:nth-child(2)>div`);t&&t.classList.add("active")}else e.onStepChange({isInjected:!0,status:o.STATUS.FINISHED})}),[e.widgets]),pe((()=>{i(e.run)}),[e.run]),pe((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:d,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:me,useEffect:ye,useMemo:ve}=n.React;function Se(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const Ie=n.ReactRedux.connect(null)((e=>{const[t,i]=me(!1),[s,a]=me(0),r=ve((()=>[{title:Se("expressThemeTitle"),content:{text:Se("expressThemeContent"),direction:"vertical"},placement:"auto",target:"div.d-flex.layout-item.is-widget > div > div > div > ul",width:480}]),[]);return ye((()=>{i(e.run)}),[e.run]),ye((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:r,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:we,useEffect:Ce,useMemo:be}=n.React;function Ae(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const xe=n.ReactRedux.connect((e=>{var t,i;return{widgets:null===(i=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets}}))((e=>{const[t,i]=we(!1),[s,a]=we(0),[r,l]=we(null),d=be((()=>[{title:Ae("expressTextTitle"),content:{image:{src:"jimu-for-builder/guide-assets/start-splash.svg",alt:Ae("expressTextTitle"),width:237,height:286},text:Ae("expressTextContent"),direction:"horizontal"},targetInCanvas:!0,placement:"auto",target:r?`[data-widgetid="${null==r?void 0:r.id}"] .rich-displayer`:".rich-displayer",width:480}]),[r]);return Ce((()=>{e.onStepChange({isInjected:!0,status:o.STATUS.FINISHED})}),[]),Ce((()=>{if(!e.widgets)return;const t=Object.values(e.widgets).find((e=>"text"===e.manifest.name));t?l(t):(l(null),e.onStepChange({isInjected:!0,status:o.STATUS.FINISHED}))}),[e.widgets]),Ce((()=>{i(e.run)}),[e.run]),Ce((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:d,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:Me,useEffect:Te,useMemo:Pe}=n.React;function Le(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const De=n.ReactRedux.connect(null)((e=>{const[t,i]=Me(!1),[s,a]=Me(0),r=Pe((()=>[{type:"splash",title:Le("openingGuideStep1Title"),content:{image:{src:"jimu-for-builder/guide-assets/guide-cover.png",alt:Le("openingGuideStep1Title"),width:272,height:256},text:Le("welcomeStep1Content"),direction:"horizontal"},placement:"center",target:"#app",width:600,height:350}]),[]);return Te((()=>{i(e.run)}),[e.run]),Te((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:r,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:je,useEffect:Ee,useMemo:Re}=n.React;function Ue(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const Oe=n.ReactRedux.connect((e=>{var t,i;return{widgets:null===(i=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets}}))((e=>{const[t,i]=je(!1),[s,a]=je(0),[r,l]=je(null),d=Re((()=>[{title:Ue("widgetControllerTitle"),content:{image:{src:"jimu-for-builder/guide-assets/widget-controller.gif",alt:Ue("widgetControllerTitle"),width:340,height:220},text:Ue("widgetControllerContent"),direction:"vertical"},targetInCanvas:!0,requiredAction:{type:"click"},disableNextButton:!0,placement:"auto",target:r?`[data-widgetid="${null==r?void 0:r.id}"] .widget-controller`:".widget-controller",width:380},{title:Ue("expressWidgetControllerAddWidgetTitle"),content:{image:{src:"jimu-for-builder/guide-assets/wc-add-widget.gif",alt:Ue("expressWidgetControllerAddWidgetTitle"),width:340,height:220},text:Ue("expressWidgetControllerAddWidgetContent"),direction:"vertical"},targetInCanvas:!1,placement:"auto",target:'[data-widgetid="header"] .d-flex.align-items-center.justify-content-end div.d-flex.align-items-center',width:380}]),[r]);return Ee((()=>{if(!e.widgets)return;const t=Object.values(e.widgets).find((e=>"controller"===e.manifest.name));t?l(t):(l(null),e.onStepChange({isInjected:!0,status:o.STATUS.FINISHED}))}),[e.widgets]),Ee((()=>{i(e.run)}),[e.run]),Ee((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:d,onStepChange:t=>{null==e||e.onStepChange(t)},onActionTriggered:(e,t,i)=>{if(0===i){const e=setInterval((()=>{document.querySelector('[data-widgetid="header"] [data-extname="controller-add-widget"]')&&(clearInterval(e),a(1))}),100)}},isInjected:!0}))})),{useState:ke,useEffect:_e,useMemo:Be}=n.React;function Ge(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const We=n.ReactRedux.connect(null)((e=>{const[t,i]=ke(!1),[s,a]=ke(0),r=Be((()=>[{title:Ge("expressWindowTitle"),content:{htm:Ge("expressWindowContent"),direction:"horizontal"},requiredAction:{type:"click"},disableNextButton:!0,placement:"auto",target:".page-window-select",width:380,height:160},{title:Ge("expressWindowTitle2"),content:{image:{src:"jimu-for-builder/guide-assets/configure-window-1.gif",alt:Ge("expressWindowTitle2"),width:340,height:220},htm:Ge("expressWindowContent2"),direction:"vertical"},requiredAction:{type:"click"},disableNextButton:!0,placement:"right",target:"div .popper-box div.dropdown-menu--inner div:nth-child(2)",width:380},{title:Ge("expressWindowTitle1"),content:{image:{src:"jimu-for-builder/guide-assets/configure-window-2.gif",alt:Ge("expressWindowTitle1"),width:340,height:220},text:Ge("expressWindowContent1"),direction:"vertical"},targetInCanvas:!0,placement:"auto",target:"div.modal-content.app-dialog-content",width:380}]),[]);return _e((()=>{i(e.run)}),[e.run]),_e((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:r,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))})),{useState:ze,useEffect:Fe,useMemo:$e}=n.React;function Ne(e){return n.i18n.getIntl().formatMessage({id:e,defaultMessage:s.A[e]})}const qe=n.ReactRedux.connect((e=>{var t,i;return{widgets:null===(i=null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets}}))((e=>{const[t,i]=ze(!1),[s,a]=ze(0),r=$e((()=>[{title:Ne("expressGridTitle"),content:{image:{src:"jimu-for-builder/guide-assets/manage-grids.gif",alt:Ne("expressGridTitle"),width:340,height:220},text:Ne("expressGridContent"),direction:"vertical"},placement:"auto",target:".grid-col-item:first-child",width:380,targetInCanvas:!0}]),[]);return Fe((()=>{var t;const i=document.querySelector('iframe[name="_appWindow"]');(null===(t=null==i?void 0:i.contentDocument)||void 0===t?void 0:t.querySelector(".grid-col-item"))||e.onStepChange({isInjected:!0,status:o.STATUS.FINISHED})}),[]),Fe((()=>{i(e.run)}),[e.run]),Fe((()=>{a(e.stepIndex)}),[e.stepIndex]),n.React.createElement(o.GuideComponent,Object.assign({},e,{run:t,stepIndex:s,steps:r,onStepChange:t=>{null==e||e.onStepChange(t)},isInjected:!0}))}))},3632:(e,t,i)=>{"use strict";function n(e){const t=JSON.parse(JSON.stringify(e));return t.data&&("undefined"!=typeof Blob&&e.data instanceof Blob||"ReadStream"===e.data.constructor.name?t.file=e.data:t.text=e.data,delete t.data),t}i.d(t,{I:()=>n})},1169:(e,t,i)=>{"use strict";var n,o;i.d(t,{M:()=>o,w:()=>n}),function(e){e.AppConfigChanged="app_config_changed",e.AppInfoChanged="app_info_changed",e.PortalSelfChanged="portal_self_changed",e.DialogInfosChanged="dialog_infos_changed",e.UserSignIn="user_sign_in",e.SetMainPortal="set_main_portal",e.ChangeAppMode="change_app_mode",e.ChangePage="change_page",e.ChangeDialog="change_dialog",e.ChangeSelection="change_selection",e.ChangeWidgetStateProp="change_widget_state_prop",e.ChangeWidgetMutableStateProp="change_widget_mutable_state_prop",e.ChangeZoomScale="change_zoom_scale",e.BuilderTriggerKeyboard="builder_trigger_keyboard",e.ChangeBrowserSizeMode="change_browser_size_mode",e.BuilderSessionChanged="builder_session_changed",e.BuilderNoPermissionResourceInfoListChanged="builder_no_permission_resource_info_list_changed",e.ActivePagePartChanged="active_page_part_changed",e.AnimationPreview="animation_preview",e.HoverPreview="hover_preview",e.SectionNavInfoChanged="section_navinfo_changed",e.ScreenGroupNavInfoChanged="screengroup_navinfo_changed",e.TocHoverInfoChanged="toc_hover_info_changed",e.SetClientIdAlertIsCancelled="set_client_id_alert_is_cancelled",e.UtilityStateChanged="utility_state_changed",e.OpenCookieBanner="open_cookie_banner",e.OpenCookieBannerByPrivacyPanel="open_cookie_banner_by_privacy_panel",e.OpenCookieSettingsWindow="open_cookie_settings_window",e.WidgetToolbarStateChange="widget_toolbar_state_change",e.WidgetToolbarIsNewFlagChange="widget_toolbar_is_new_flag_change",e.SetWidgetIsInlineEditingState="set__widget_is_inline_editing_state"}(n||(n={})),function(e){e.AppStateChanged="app_state_changed",e.AppSessionChanged="app_session_changed",e.AppNoPermissionResourceInfoListChanged="app_no_permission_resource_info_list_changed",e.NeedToCheck498Error="need_to_check_498_error",e.AppAddResource="app_add_resource",e.AppClearResources="app_clear_resources",e.AppTriggerKeyboard="app_trigger_keyboard",e.SetLayoutTools="app_set_layout_tools",e.ClearLastAppConfigFromHistory="clear_last_app_config_from_history",e.SetIsBusy="app_set_isbusy",e.AppIsLoaded="app_is_loaded",e.ConfirmDelete="confirm_delete",e.NeedToRegisterClinetId="need_to_register_client_id",e.SetSidePanel="app_side_panel",e.CloseBannerInLiveView="close_banner_in_live_view"}(o||(o={}))},4981:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});const n={frameworkAction_SetData:"Select data",frameworkAction_ActionLayer:"Action data",frameworkAction_Conditions:"Conditions",frameworkAction_RelateMessage:"Trigger / action connection",frameworkAction_UseRelationship:"Use layer's relationship",frameworkAction_CustomFields:"Set custom connection fields",frameworkAction_TriggerLayerField:"Select a trigger field",frameworkAction_None:"none",frameworkAction_Equals:"equals",frameworkAction_ActionLayerField:"Select an action field",frameworkAction_MoreConditions:"More conditions",frameworkAction_SetExpression:"Please set your expression first.",frameworkAction_ChooseLayer:"Select data",frameworkAction_AutoBind:"Auto bound.",frameworkAction_NoLayer:"No data.",frameworkAction_QueryByExtent:"Query by current extent",defaultTextPlaceholder:"Double click to edit text",titlePlaceholder:"Here is the title",subTitlePlaceholder:"Here is the subtitle",shortTitlePlaceholder:"Title",shortSubTitlePlaceholder:"Subtitle",copyrightPlaceholder:"Copyright info",cardTitle:"Card title",bookmark:"Bookmark",number:"Number",templateSearchResult:"Search result",logo:"Logo",appItemCopy:"Copy",openingGuideStep1Title:"Getting started",openingGuideStep1Content:"This tour will show you how to navigate in Experience Builder",openingGuideStep2Title:"Canvas",openingGuideStep2Content:"You can interact with widgets in your experience visually on the canvas.",openingGuideStep3Title:"Sidebar",openingGuideStep3Content:"Allows you to open the widget, page, data, and theme panels.",openingGuideStep4Title:"Insert widget",openingGuideStep4Content:"Click on the Map widget and drag it onto the canvas.",openingGuideStep5Title:"Resize widget",openingGuideStep5Content:"You can change the size of widget on the canvas.",openingGuideStep7Title:"Style",openingGuideStep7Content:"Click the Style tab to switch to the style setting panel.",openingGuideStep8Title:"Size and position",openingGuideStep8Content:"Click the Full size button located at the top right hand corner.",openingGuideStep8Title2:"Style",openingGuideStep8Content2:"Allows you to customize properties such as size, position, background, animation, border, and transform.",openingGuideStep9Title:"Action",openingGuideStep9Content:"Click the Action tab to switch to the action setting panel.",openingGuideStep10Title:"Action",openingGuideStep10Content:"Interactions between widgets can be configured using triggers and actions. Widget actions are in response to linked trigger actions in other widgets.",openingGuideStep11Title:"Header",openingGuideStep11Content:"Click Live view to make your experience interactive inside the builder.",openingGuideStep12Title:"Page",openingGuideStep12Content:"Shows the structure of your experience. You can create and organize pages and folders and change page settings.",openingGuideStep13Title:"Data",openingGuideStep13Content:"Displays all the data listed in your experience and the widgets connected to the data.",openingGuideStep14Title:"Theme",openingGuideStep14Content:"Defines the color scheme for the appearance of your experience.",openingGuideStep15Title:"End of tour",openingGuideStep15Content:"You can always return if you need a refresher.",DSSelectionStep1Title:"Widget content",DSSelectionStep1Content:"Click on Select map to add a new data source.",DSSelectionStep2Title:"Add new data",DSSelectionStep2Content:"Click add new data and select a web map for a data source.",DSSelectionStep3Title:"Select data",DSSelectionStep3Content:"Click the web map in the select data panel.",DSSelectionStep4Title:"Widget content",DSSelectionStep4Content:"Click on Select data to add a new data source.",DSSelectionStep5Title:"Select data",DSSelectionStep5Content:"Click the feature layer in the select data panel.",insertWidgetStep1Title:"Insert widget",insertWidgetStep1Content:"Click on the widget and drag it onto the canvas.",expressModeStep1Title:"Express mode",expressModeStep1Content:"Use express mode to focus on essential functions and content when designing an experience. You can move an experience from express mode to full mode if you need more advanced features and layout settings.",expressModeLearnMore:"Learn more",welcomeStep1Content:"This tour will show you how to navigate in Experience Builder express mode.",mapWidgetTitle:"Configure Widget",mapWidgetContent:"<p>Activate a widget by clicking on it. Widget configuration will open on the right side panel. For example, please <b>click on the map</b>.</p>",expressSelectDataTitle:"Configure map",expressSelectDataContent:"Select map source, enable map tools and configure other settings.",expressMessageActionTitle:"Message action",expressMessageActionContent:"Configure message actions to communicate with other widgets.",widgetControllerTitle:"Widget controller",widgetControllerContent:"Click at the Widget controller area, managing buttons will show on the top bar. Configure Widget controller behaviors on the right side.",expressWidgetControllerAddWidgetTitle:"Add or manage widgets in Widget controller",expressWidgetControllerAddWidgetContent:"Click the Add button on the top bar to add widgets to the Widget controller. Use the Manage widget button to reorder or group widgets. To remove a widget, click on it and a Delete button will show on the top bar.",expressTextTitle:"Configure title",expressTextContent:"Double click to change the title for your app.",expressSectionTitle:"Add or manage views",expressSectionContent:"<p><b>Click on the View navigation area</b>, managing buttons will show on the top bar. You can add new views, reorder or remove views. You can add a widget to each view.</p>",expressSidebarTitle:"Configure widget in Sidebar",expressSidebarContent:"<p><b>Click the expand button</b> to open the sidebar. Click the widget inside to configure.</p>",expressSidebarTitle1:"Configure Sidebar",expressSidebarContent1:"You can decide whether to show the sidebar by enabling or disabling the sidebar Collapse button.",expressGridTitle:"Managing grids",expressGridContent:"Click on a grid and managing buttons will show on the top bar. You can remove a grid or split it in a preferred way.",expressPlaceholderTitle:"Add or manage widget",expressPlaceholderContent:"<p>Click the Add button on Placeholder to add a widget and configure it on the right side. <br> To remove the widget, click on the widget and a delete button will show on the top bar.</p>",expressThemeTitle:"Theme & General settings",expressThemeContent:"Select a preferred theme from Theme tab. Configure app general settings from General tab.",expressWindowTitle:"Page or Window switch",expressWindowContent:"<p><b>Click the outline menu</b> to switch between page and window.</p>",expressWindowTitle1:"Configure window",expressWindowContent1:"Configure Window behaviors on the right side. Double click text to edit. For other widgets, click to activate configuration on the right side.",expressWindowTitle2:"Configure window",expressWindowContent2:"<p><b>Click Window option</b> to switch Window settings. Hover on the Window option and click the Set as splash icon beside it to set a splash window. You can choose window design from templates.</p>",expressTopBarTitle:"Top bar options",expressTopBarContent:"<ul><li>Review different screen sizes </li><li>Undo or Redo operations </li><li>Save, publish and preview the experience.</li><li>More</li></ul>",expressFullEditModeTitle:"Full mode",expressFullEditModeContent:"You can switch to full mode which allows advanced experience design.",expressEndGuideTitle:"Congratulations! You have completed the tour!",expressEndGuideContent:"Now start to build your experience. You can always return to the guide by clicking the Help button on the bottom left corner of the builder if you need a refresher.",goToExpressMode:"Go to express mode",goToFullMode:"Go to full mode",switchedToExpressMode:"Switched to express mode",switchedToFullMode:"Switched to full mode"}},8249:(e,t,i)=>{"use strict";i.r(t),i.d(t,{cleanAppStructure:()=>f,getCleanAppConfig:()=>m,getRealPageCount:()=>c,getRealPageCountExcludeOnePage:()=>g,getSizeModeOfALayout:()=>l,getSubRealPageCount:()=>p,getUniqueId:()=>s,getUniqueLabel:()=>a,isFirstLevelPage:()=>d,isLabelDuplicated:()=>y,isPageHasSubPage:()=>u,isRealPage:()=>h,parseUniqueLabel:()=>r});var n=i(9244);i(1496);function o(e,t){return Object.values(null!=t?t:{}).forEach((t=>{e=function(e,t){var i;const s=e.layouts[t];return s?(delete s.parent,Object.keys(null!==(i=s.content)&&void 0!==i?i:{}).forEach((t=>{const i=s.content[t];switch(i.type){case n.LayoutItemType.Widget:{const t=e.widgets[i.widgetId];t&&(delete t.parent,t.layouts&&Object.values(t.layouts).forEach((t=>{e=o(e,t)})));break}case n.LayoutItemType.Section:{const t=e.sections[i.sectionId];delete t.parent,t.views.forEach((t=>{const i=e.views[t];delete i.parent,e=o(e,i.layout)}));break}case n.LayoutItemType.ScreenGroup:{const t=e.screenGroups[i.screenGroupId];delete t.parent,t.screens.forEach((t=>{var i;const n=e.screens[t];delete n.parent,e=o(e,n.main.layout),(null===(i=n.panel)||void 0===i?void 0:i.layout)&&(e=o(e,n.panel.layout))}));break}}})),e):e}(e,t)})),e}const{getUniqueId:s,getUniqueLabel:a,parseUniqueLabel:r,getSizeModeOfALayout:l}=n.appConfigUtils;function d(e,t){return!!e.pageStructure.find((e=>!!e[t]))}function u(e,t){const i=e.pageStructure.find((e=>!!e[t]));return i&&i[t].length>0}function c(e){let t=0;return Object.keys(e.pages).forEach(((i,n)=>{h(e,i)&&t++})),t}function p(e,t){if(!d(e,t))return 0;let i=0;return e.pageStructure.forEach(((n,o)=>{const s=Object.keys(n)[0];s===t&&n[s].forEach((t=>{h(e,t)&&i++}))})),i}function g(e,t){let i=0;return h(e,t)&&(i=1),c(e)-p(e,t)-i}function h(e,t){const i=e.pages[t];return!!i&&i.type===n.PageType.Normal}function f(e){var t,i,n,s;return Object.values(null!==(t=e.pages)&&void 0!==t?t:{}).forEach((t=>{e=o(e,t.layout)})),Object.values(null!==(i=e.dialogs)&&void 0!==i?i:{}).forEach((t=>{e=o(e,t.layout)})),(null===(n=e.header)||void 0===n?void 0:n.layout)&&(e=o(e,e.header.layout)),(null===(s=e.footer)||void 0===s?void 0:s.layout)&&(e=o(e,e.footer.layout)),e}function m(e){let t=e.asMutable({deep:!0});var i;return Object.keys(t.widgets).forEach((e=>{var i,n,o;const s=t.widgets[e];s.label===(null===(i=s.manifest)||void 0===i?void 0:i.name)&&delete s.label,s.icon===s.context.folderUrl+"icon.svg"&&delete s.icon,"object"==typeof s.icon&&(s.icon.svg!==s.context.folderUrl+"icon.svg"||"#fff"!==(null===(n=s.icon.properties)||void 0===n?void 0:n.color)&&(null===(o=s.icon.properties)||void 0===o?void 0:o.color)||delete s.icon),delete s.context,delete s.manifest,delete s._originManifest})),t.layouts=(i=t.layouts,Object.keys(i).forEach((e=>{const t=i[e];delete t.id,t.content&&Object.keys(t.content).forEach((e=>{delete t.content[e].id}))})),i),t=n.appConfigUtils.cleanPortalInfoFromResource(t),t=f(t),t}function y(e,t,i,n){let o;return"page"===t?o=e.pages:"view"===t?o=e.views:"dialog"===t&&(o=e.dialogs),!!o&&Object.keys(o).some((e=>e!==i&&o[e].label===n))}window._getCleanAppConfig=m},3634:(e,t,i)=>{"use strict";i.r(t),i.d(t,{getBuildAppsHelpLink:()=>l,getHomeHelpLink:()=>d,getWhatsNewLink:()=>u,getWidgetHelpLink:()=>c,isSupportLanguage:()=>r});var n=i(9244),o=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};const s=i(6546),a=["en","de","es","fr","ja","ru","zh-cn"];function r(){const e=window.locale.toLowerCase();let t=!1;if(a.includes(e))t=!0;else{const i=e.split("-")[0];for(let e=0;e<a.length;e++)if(i===a[e].split("-")[0]){t=!0;break}}return t}function l(e){return o(this,void 0,void 0,(function*(){return yield p("build-apps",e)}))}function d(){return o(this,void 0,void 0,(function*(){return window.jimuConfig.isDevEdition?yield p(void 0,"home",!0):yield p("get-started","what-is-arcgis-experience-builder",!0)}))}function u(){return o(this,void 0,void 0,(function*(){return yield p("get-started","whats-new",!0)}))}function c(e){return o(this,void 0,void 0,(function*(){return yield p("widgets",e)}))}function p(e,t,i){return o(this,void 0,void 0,(function*(){let l,u=null;if(t=t.toLowerCase(),window.jimuConfig.isDevEdition){l="https://developers.arcgis.com/experience-builder/";const i=s.dev;u=e?i[e][t]&&`${i[e].prefix}${i[e][t]}`:i[t]&&`${i[t]}`;let n=l+"#";return u?(n=l+u,yield Promise.resolve(n)):yield Promise.resolve(n)}{const c=(0,n.getAppStore)().getState().portalUrl;if(window.jimuConfig.isInPortal){const l=r()?n.i18n.findLocale(window.locale,a):"en",p=s.portal;u=e?`${p[e][t]}`:`${p[t]}`;const g={"Content-Type":"text/json"},h=function(e,t){let i="";const o=(0,n.getAppStore)().getState().portalSelf,s=null==o?void 0:o.helpBase.split("/");i=(null==s?void 0:s.includes("https:"))?s.slice(0,3).join("/")+"/"+t:e+"/"+(null==s?void 0:s[2])+"/"+t;return i}(c,l),f=h.includes("https:")?h+"/experience-builder":h;return yield fetch(c+"/sharing/rest/portals/helpmap?f=json",{method:"get",headers:g}).then((e=>o(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>o(this,void 0,void 0,(function*(){if(e&&e.helpMap&&e.helpMap.m&&u&&e.helpMap.m[u]){const t=h+"/"+e.helpMap.m[u];return yield Promise.resolve(t)}return i?yield Promise.resolve(f):yield d()})))).catch((e=>o(this,void 0,void 0,(function*(){return console.warn(e),i?yield Promise.resolve(f):yield d()}))))}{const i=s.online;u=e?i[e][t]&&`${i[e].prefix}${i[e][t]}`:i[t]&&`${i[t]}`;const o=function(e){const t=n.urlUtils.getUrlHost(e),i=t.split(".");i.splice(0,1);const o=i.join(".");return"www.arcgis.com"===t||"maps.arcgis.com"===o}(c)?"doc":"docdev";l="https://"+o+".arcgis.com/en/experience-builder/";let a=l+"#";if(!u)return yield Promise.resolve(a);if(a=l+u,r()){n.portalUrlUtils.getPortalSelfInfoUrl(c);const e=function(e,t,i){let o;const s=(0,n.getAppStore)().getState().portalSelf;if(s&&s.helpBase){try{o=s.helpBase.split("/").slice(0,4).join("/")+"/experience-builder/"}catch(e){return i}return o?o+t:i}return i}(0,u,a);return yield Promise.resolve(e)}return yield Promise.resolve(a)}}}))}},7659:(e,t,i)=>{"use strict";i.r(t),i.d(t,{getExpressModeTemplateNames:()=>a,processForTemplate:()=>s});var n=i(9244),o=function(e,t,i,n){return new(i||(i=Promise))((function(o,s){function a(e){try{l(n.next(e))}catch(e){s(e)}}function r(e){try{l(n.throw(e))}catch(e){s(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(a,r)}l((n=n.apply(e,t||[])).next())}))};function s(e,t,i){(null==e?void 0:e.config)&&n.appConfigUtils.fixLayoutIds(e.config);const o=t?n.i18n.getIntl(t,"setting"):n.i18n.getIntl();return e=n.utils.replaceI18nPlaceholdersInObject(e,o,i)}const a=e=>o(void 0,void 0,void 0,(function*(){const t=n.moduleLoader.resolveModuleFullPath("templates/"),i=yield fetch(`${t}templates-info.json`).then((e=>e.json()));if(i[e]){const t=i[e].filter((e=>e.tags&&e.tags.includes("WAB classic"))).map((e=>e.name));return Promise.resolve(t)}return Promise.resolve([])}))},9244:e=>{"use strict";e.exports=i},8972:e=>{"use strict";e.exports=n},4108:e=>{"use strict";e.exports=l},6884:e=>{"use strict";e.exports=r},1496:e=>{"use strict";e.exports=s},1888:e=>{"use strict";e.exports=o},4321:e=>{"use strict";e.exports=a},9298:e=>{"use strict";e.exports=c},8151:e=>{"use strict";e.exports=u},6117:e=>{"use strict";e.exports=d},6546:e=>{"use strict";e.exports=JSON.parse('{"online":{"home":"#","get-started":{"prefix":"get-started/","what-is-arcgis-experience-builder":"what-is-arcgis-experience-builder.htm","whats-new":"whats-new.htm"},"build-apps":{"prefix":"build-apps/","add-a-page":"add-a-page.htm","add-a-dialog":"add-windows.htm","add-utility-services":"add-utility-services.htm","add-custom-widgets":"getting-started-widget.htm","add-screen-groups":"add-screen-groups.htm","express-mode":"express-mode.htm","select-data":"select-data.htm","change-app-theme":"change-app-theme.htm","general-settings":"general-settings.htm"},"widgets":{"prefix":"configure-widgets/","overview":"widgets-overview.htm","3d-toolbox":"3d-toolbox-widget.htm","accordion":"accordion-widget.htm","add-data":"add-data-widget.htm","analysis":"analysis-widget.htm","arcgis-map":"map-widget.htm","basemap-gallery":"basemap-gallery-widget.htm","ba-infographic":"business-analyst-infographic-widget.htm","bookmark":"bookmark-widget.htm","branch-version-management":"branch-version-management-widget.htm","button":"button-widget.htm","building-explorer":"building-explorer-widget.htm","card":"card-widget.htm","chart":"chart-widget.htm","column":"column-widget.htm","controller":"widget-controller-widget.htm","coordinates":"coordinates-widget.htm","coordinate-conversion":"coordinate-conversion-widget.htm","divider":"divider-widget.htm","draw":"draw-widget.htm","directions":"directions-widget.htm","edit":"edit-widget.htm","elevation-profile":"elevation-profile-widget.htm","embed":"embed-widget.htm","feature-info":"feature-info-widget.htm","feature-report":"feature-report-widget.htm","filter":"filter-widget.htm","fixed":"fixed-panel-widget.htm","floor-filter":"floor-filter-widget.htm","fly-controller":"fly-controller-widget.htm","grid":"grid-widget.htm","image":"image-widget.htm","legend":"legend-widget.htm","list":"list-widget.htm","map-layers":"map-layers-widget.htm","measurement":"measurement-widget.htm","menu":"menu-widget.htm","navigator":"view-navigation-widget.htm","near-me":"near-me-widget.htm","oriented-imagery":"oriented-imagery-widget.htm","placeholder":"placeholder-widget.htm","print":"print-widget.htm","query":"query-widget.htm","row":"row-widget.htm","search":"search-widget.htm","section":"section-widget.htm","select":"select-widget.htm","share":"share-widget.htm","sidebar":"sidebar-widget.htm","suitability-modeler":"suitability-modeler-widget.htm","survey123":"survey-widget.htm","swipe":"swipe-widget.htm","table":"table-widget.htm","text":"text-widget.htm","timeline":"timeline-widget.htm","my-location":"my-location-widget.htm","utility-network-trace":"utility-network-trace-widget.htm"}},"portal":{"home":"120001864","get-started":{"what-is-arcgis-experience-builder":"120001877","whats-new":"120002535"},"build-apps":{"add-a-page":"120001863","add-a-dialog":"120002539","add-utility-services":"120003733","add-custom-widgets":"120003728","add-screen-groups":"120002592","express-mode":"120005009","select-data":"120002590","change-app-theme":"120004139","general-settings":"120004779"},"widgets":{"overview":"#","3d-toolbox":"120003734","accordion":"120004999","add-data":"120004128","analysis":"120004647","arcgis-map":"120001851","basemap-gallery":"120004168","bookmark":"120002536","button":"120001841","building-explorer":"120004868","branch-version-management":"120002654","ba-infographic":"120003631","card":"120002537","chart":"120002727","column":"120001842","controller":"120001862","coordinates":"120003879","coordinate-conversion":"120002728","divider":"120002538","draw":"120003632","directions":"120003635","edit":"120002844","elevation-profile":"120002905","embed":"120001843","feature-info":"120001844","feature-report":"120004895","filter":"120001845","fixed":"120001846","floor-filter":"120003634","fly-controller":"120001847","grid":"120003880","image":"120001848","legend":"120001849","list":"120001850","map-layers":"120001852","measurement":"120004869","menu":"120001853","navigator":"120001861","near-me":"120004170","oriented-imagery":"120002843","placeholder":"120001854","print":"120003716","query":"120002729","row":"120001855","search":"120002845","section":"120001856","select":"120004732","share":"120001857","sidebar":"120001858","suitability-modeler":"120002906","survey123":"120001859","swipe":"120004169","table":"120002591","text":"120001860","timeline":"120003717","my-location":"120004870","utility-network-trace":"120003633","add-line-event":"120004827","add-point-event":"120004828","dynamic-segmentation":"120004989","identify":"120004829","merge-events":"120004830","search-by-route":"120004831","split-event":"120004832"}},"dev":{"home":"#","get-started":{"prefix":"guide/","what-is-arcgis-experience-builder":"getting-started-widget","whats-new":"whats-new"},"build-apps":{"prefix":"guide/","add-a-page":"add-a-page","add-a-dialog":"add-windows","add-utility-services":"add-utility-services","add-custom-widgets":"getting-started-widget","add-screen-groups":"add-screen-groups","express-mode":"express-mode","select-data":"select-data","change-app-theme":"change-app-theme","general-settings":"general-settings"},"widgets":{"prefix":"guide/","overview":"widgets-overview","3d-toolbox":"3d-toolbox-widget","accordion":"accordion-widget","add-data":"add-data-widget","analysis":"analysis-widget","arcgis-map":"map-widget","basemap-gallery":"basemap-gallery-widget","ba-infographic":"business-analyst-infographic-widget","bookmark":"bookmark-widget","branch-version-management":"branch-version-management-widget","button":"button-widget","building-explorer":"building-explorer-widget","card":"card-widget","chart":"chart-widget","column":"column-widget","controller":"widget-controller-widget","coordinates":"coordinates-widget","coordinate-conversion":"coordinate-conversion-widget","divider":"divider-widget","draw":"draw-widget","directions":"directions-widget","edit":"edit-widget","elevation-profile":"elevation-profile-widget","embed":"embed-widget","feature-info":"feature-info-widget","feature-report":"feature-report-widget","filter":"filter-widget","fixed":"fixed-panel-widget","floor-filter":"floor-filter-widget","fly-controller":"fly-controller-widget","grid":"grid-widget","image":"image-widget","legend":"legend-widget","list":"list-widget","map-layers":"map-layers-widget","measurement":"measurement-widget","menu":"menu-widget","navigator":"view-navigation-widget","near-me":"near-me-widget","oriented-imagery":"oriented-imagery-widget","placeholder":"placeholder-widget","print":"print-widget","query":"query-widget","row":"row-widget","search":"search-widget","section":"section-widget","select":"select-widget","share":"share-widget","sidebar":"sidebar-widget","suitability-modeler":"suitability-modeler-widget","survey123":"survey-widget","swipe":"swipe-widget","table":"table-widget","text":"text-widget","timeline":"timeline-widget","my-location":"my-location-widget","utility-network-trace":"utility-network-trace-widget","add-line-event":"add-line-event-widget","add-point-event":"add-point-event-widget","dynamic-segmentation":"dynamic-segmentation-widget","identify":"identify-widget","merge-events":"merge-events-widget","search-by-route":"search-by-route-widget","split-event":"split-event-widget"}}}')},5132:e=>{"use strict";e.exports=JSON.parse('{"steps":[{"steps":[{"title":"${DSSelectionStep4Title}","content":"${DSSelectionStep4Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\']) .component-data-source-selector .jimu-btn","requiredAction":{"type":"click"},"disableNextButton":true},{"title":"${DSSelectionStep1Title}","content":"${DSSelectionStep1Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\']) .component-data-source-selector .jimu-btn","requiredAction":{"type":"click"},"disableNextButton":true}]},{"title":"${DSSelectionStep2Title}","content":{"image":{"src":"jimu-for-builder/guide-assets/add-data.gif","alt":"${DSSelectionStep2Title}","width":400,"height":220},"text":"${DSSelectionStep2Content}"},"placement":"left-end","target":".component-data-source-list .ds-add-data","requiredAction":{"type":"click"},"disableNextButton":true},{"steps":[{"title":"${DSSelectionStep5Title}","content":"${DSSelectionStep5Content}","placement":"left","target":".component-data-source-list .ds-list","spotlightClicks":true},{"title":"${DSSelectionStep3Title}","content":"${DSSelectionStep3Content}","placement":"left","target":".component-data-source-list .ds-list","spotlightClicks":true}]}]}')},2802:e=>{"use strict";e.exports=JSON.parse('{"steps":[{"injectedGuide":"express-welcome-introduction"},{"injectedGuide":"express-map-widget"},{"injectedGuide":"express-widget-controller"},{"injectedGuide":"express-placeholder"},{"injectedGuide":"express-grid"},{"injectedGuide":"express-section"},{"injectedGuide":"express-sidebar"},{"injectedGuide":"express-window"},{"injectedGuide":"express-theme"},{"injectedGuide":"express-app-setting"},{"injectedGuide":"express-general-setting"},{"title":"${expressEndGuideTitle}","content":{"image":{"src":"jimu-for-builder/guide-assets/congratulations.png","alt":"${expressEndGuideTitle}","width":183,"height":160},"text":"${expressEndGuideContent}","direction":"horizontal"},"placement":"center","width":540,"height":260,"target":"[data-widgetid=\'app-loader\']"}]}')},9114:e=>{"use strict";e.exports=JSON.parse('{"steps":[{"type":"splash","title":"${openingGuideStep1Title}","content":{"image":{"src":"jimu-for-builder/guide-assets/start-splash.svg","alt":"${openingGuideStep1Title}","width":237,"height":286},"text":"${openingGuideStep1Content}","direction":"horizontal"},"placement":"center","target":"#app","width":600},{"title":"${openingGuideStep2Title}","content":{"image":{"src":"jimu-for-builder/guide-assets/start1-canvas.svg","alt":"Canvas","width":400,"height":220,"autoFlip":true},"text":"${openingGuideStep2Content}"},"target":"[data-widgetid=\'app-loader\']"},{"title":"${openingGuideStep3Title}","placement":"right","content":{"image":{"src":"jimu-for-builder/guide-assets/start2-sidebar.gif","alt":"${openingGuideStep3Title}","width":400,"height":220,"border":true,"autoFlip":true},"text":"${openingGuideStep3Content}"},"target":"[data-widgetid=\'left-sidebar\'] .side"},{"injectedGuide":"insert-widget","params":{"widgetName":"arcgis-map"}},{"title":"${openingGuideStep5Title}","content":{"image":{"src":"jimu-for-builder/guide-assets/resize-widget.gif","alt":"${openingGuideStep5Title}","width":400,"height":220,"autoFlip":true},"text":"${openingGuideStep5Content}"},"target":".selected.is-widget .widget-map-usemask","spotlightPadding":15,"targetInCanvas":true,"spotlightClicks":true},{"injectedGuide":"ds-selection"},{"title":"${openingGuideStep7Title}","content":"${openingGuideStep7Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\'])  .tab-title-item:nth-child(2)","requiredAction":{"type":"click"},"disableNextButton":true},{"steps":[{"title":"${openingGuideStep8Title}","content":"${openingGuideStep8Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\'])  .tab-content","spotlightClicks":true},{"title":"${openingGuideStep8Title2}","content":"${openingGuideStep8Content2}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\'])  .tab-content","spotlightClicks":true}]},{"title":"${openingGuideStep9Title}","content":"${openingGuideStep9Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\'])  .tab-title-item:nth-child(3)","requiredAction":{"type":"click"},"disableNextButton":true},{"title":"${openingGuideStep10Title}","content":{"image":{"src":"jimu-for-builder/guide-assets/start-action.gif","alt":"${openingGuideStep10Title}","width":400,"height":220},"text":"${openingGuideStep10Content}"},"placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\'])  .tab-content"},{"title":"${openingGuideStep11Title}","content":"${openingGuideStep11Content}","placement":"bottom","target":".widget-builder-header","spotlightClicks":true},{"title":"${openingGuideStep12Title}","content":"${openingGuideStep12Content}","placement":"right","target":"[data-sectionid=\'opts-section\']"},{"title":"${openingGuideStep13Title}","content":"${openingGuideStep13Content}","placement":"right","target":"[data-sectionid=\'opts-section\']"},{"title":"${openingGuideStep14Title}","content":"${openingGuideStep14Content}","placement":"right","target":"[data-sectionid=\'opts-section\']"},{"title":"${openingGuideStep15Title}","content":"${openingGuideStep15Content}","placement":"center","target":"[data-widgetid=\'app-loader\']"}]}')}},t={};function p(i){var n=t[i];if(void 0!==n)return n.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,p),o.exports}return p.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return p.d(t,{a:t}),t},p.d=(e,t)=>{for(var i in t)p.o(t,i)&&!p.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},p.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),p.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},p(6963)})())}}}));
System.register(["jimu-core","jimu-arcgis"],(function(e,t){var a={},r={};return{setters:[function(e){a.AbstractDataAction=e.AbstractDataAction,a.DataLevel=e.DataLevel,a.DataSourceStatus=e.DataSourceStatus,a.DataSourceTypes=e.DataSourceTypes,a.MutableStoreManager=e.MutableStoreManager,a.defaultMessages=e.defaultMessages,a.getAppStore=e.getAppStore,a.i18n=e.i18n,a.utils=e.utils},function(e){r.ADD_TO_MAP_DATA_ID_PREFIX=e.ADD_TO_MAP_DATA_ID_PREFIX,r.ActionType=e.ActionType,r.DataChangeStatus=e.DataChangeStatus,r.DataChangeType=e.DataChangeType,r.MapViewManager=e.MapViewManager,r.zoomToUtils=e.zoomToUtils}],execute:function(){e((()=>{"use strict";var e={62686:e=>{e.exports=r},79244:e=>{e.exports=a}},t={};function i(a){var r=t[a];if(void 0!==r)return r.exports;var n=t[a]={exports:{}};return e[a](n,n.exports,i),n.exports}i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var n={};i.r(n),i.d(n,{default:()=>d});var o=i(79244),u=i(62686),s=function(e,t,a,r){return new(a||(a=Promise))((function(i,n){function o(e){try{s(r.next(e))}catch(e){n(e)}}function u(e){try{s(r.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?i(e.value):(t=e.value,t instanceof a?t:new a((function(e){e(t)}))).then(o,u)}s((r=r.apply(e,t||[])).next())}))};class d extends o.AbstractDataAction{constructor(){super(...arguments),this._viewManager=u.MapViewManager.getInstance()}isSupported(e,t){return s(this,void 0,void 0,(function*(){var a,r;if(e.length>1)return!1;const i=e[0],n=null==i?void 0:i.dataSource,s=this._getActiveViewId(this.widgetId,(0,o.getAppStore)().getState().jimuMapViewsInfo),d=this._viewManager.getJimuMapViewById(s);if(!n||n.getStatus()===o.DataSourceStatus.NotReady)return!1;if(t!==o.DataLevel.DataSource)return!1;if(n.type===o.DataSourceTypes.ElevationLayer)return!1;if(n.type===o.DataSourceTypes.SubtypeSublayer)return!1;if([o.DataSourceTypes.SceneLayer,o.DataSourceTypes.SceneService,o.DataSourceTypes.BuildingSceneLayer,o.DataSourceTypes.BuildingGroupSubLayer,o.DataSourceTypes.BuildingComponentSubLayer].includes(n.type)&&"2d"===(null===(a=null==d?void 0:d.view)||void 0===a?void 0:a.type))return!1;if(d&&d.view){const e=d.view.map.layers.toArray().filter((e=>e.id&&e.id.includes(u.ADD_TO_MAP_DATA_ID_PREFIX)));if(e.length>0){if(e.some((e=>{const t=d.getJimuLayerViewByAPILayer(e);return!(!t||t.getLayerDataSource()!==n)})))return!1}}return n.supportSpatialInfo&&n.supportSpatialInfo()&&!!n.createJSAPILayerByDataSource&&!n.isInAppConfig()&&0===(null===(r=i.records)||void 0===r?void 0:r.length)}))}onExecute(e,t){return s(this,void 0,void 0,(function*(){var t,a;const r=this._getActiveViewId(this.widgetId,(0,o.getAppStore)().getState().jimuMapViewsInfo),i=(null===(t=o.MutableStoreManager.getInstance().getStateValue([this.widgetId]))||void 0===t?void 0:t.addToMapDatas)||{},n=o.i18n.getIntl(),s=e[0],d=s.name||"",c=n.formatMessage({id:"action_addedData",defaultMessage:o.defaultMessages.action_addedData},{label:d});i[`${u.ADD_TO_MAP_DATA_ID_PREFIX}dataAction_${o.utils.getUUID()}`]={mapWidgetId:this.widgetId,jimuMapViewId:r,dataSourceId:s.dataSource.id,type:u.ActionType.DataAction,dataChangeType:u.DataChangeType.Create,dataChangeStatus:u.DataChangeStatus.Pending,title:c},o.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"addToMapDatas",i);const p=this._viewManager.getJimuMapViewById(r);return p&&(null===(a=s.dataSource)||void 0===a||a.createJSAPILayerByDataSource().then((e=>{u.zoomToUtils.zoomTo(null==p?void 0:p.view,e,{padding:{left:50,right:50,top:50,bottom:50}})}))),yield Promise.resolve(!0)}))}_getActiveViewId(e,t){let a=Object.keys(t||{}).find((a=>t[a].mapWidgetId===e&&t[a].isActive));return a||(a=Object.keys(t||{}).find((a=>t[a].mapWidgetId===e))),a}}return n})())}}}));
/*! For license information please see arcgis_processing-templates_node_modules_arcgis_imagery-components-581aff.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_processing-templates_node_modules_arcgis_imagery-components-581aff"],{21917:(e,t,s)=>{s.r(t),s.d(t,{arcgis_imagery_lazy_loading_list:()=>o,arcgis_imagery_lazy_loading_select:()=>r});var i=s(41126),n=s(14886);const o=class{constructor(e){(0,i.r)(this,e),this.arcgisChange=(0,i.c)(this,"arcgisChange",7),this.manager=(0,n.u)(this),this.hasSelectedScrolled=!1,this.suspendObserver=!1,this.filterHeight=56,this.itemHeight=33,this.itemHeightAdjusted=!1,this.listChange=()=>{if(!this.refListNode)return;const e=this.refListNode.selectedItems[0];if(!e)return;const t=e.value,s=this.list.findIndex((({value:e})=>e===t));this.arcgisChange.emit({selectedValue:t,selectedIndex:s})},this.setLastNode=e=>{e&&(this.refLastNode&&this.observer?.unobserve(this.refLastNode),this.refLastNode=e)},this.setFirstNode=e=>{e&&(this.refFirstNode&&this.observer?.unobserve(this.refFirstNode),this.refFirstNode=e)},this.setSecondNode=e=>{e&&(this.refSecondNode=e)},this.setSecondLastNode=e=>{e&&(this.refSecondLastNode=e)},this.setSelectedNode=e=>{this.refSelectedNode=e},this.updateFilter=(0,n.d)((()=>{if(!this.refFilterNode)return;const e=this.refFilterNode.filteredItems;if(!e.length)return;const t=new Set(e.map((({label:e})=>e)));this.suspendObserver=!0,this.filterList=this.list.filter((({label:e})=>t.has(e))),this.pageRanges=[0,1],this.pageId=0}),100),this.list=void 0,this.popoverProps=void 0,this.selectedIndex=0,this.messages=void 0,this.showFilter=!1,this.pageSize=500,this.removeOldPages=!1,this.position="auto",this.pageBufferSize=10,this.useFlyOut=!1,this.pageId=0,this.filterList=void 0}watchList(){this.lockedMenuPosition=void 0}watchSelectedIndex(e){this.updatePageId(e)}componentWillLoad(){const e=Math.floor(this.list.length/this.pageSize);e<2||(this.updatePageId(),this.setupObserver(e))}componentDidRender(){if(this.useFlyOut&&!this.itemHeightAdjusted&&this.refSelectedNode){const e=this.refSelectedNode.getBoundingClientRect().height;if(e&&this.itemHeight!==e){this.itemHeight=e;const{refMenuNode:t}=this;if(t){const{height:e,translateX:s,translateY:i}=this.getListPosition();t.style.height=`${e}px`,t.style.transform=`translate(${s}px, ${i}px)`}}this.itemHeightAdjusted=!0}requestAnimationFrame((()=>{!this.hasSelectedScrolled&&this.refSelectedNode&&(this.refSelectedNode.scrollIntoView(),this.hasSelectedScrolled=!0),this.pendingScroll&&this.pendingScroll(),requestAnimationFrame((()=>{const{observer:e,refFirstNode:t,refLastNode:s}=this;e&&(this.suspendObserver=!1,t&&e.observe(t),s&&e.observe(s))}))}))}disconnectedCallback(){this.observer?.disconnect()}render(){let e;if(this.suspendObserver=!0,this.useFlyOut){const{width:t,height:s,translateX:i,translateY:n}=this.getListPosition();e={width:`${t}px`,height:`${s}px`,transform:`translate(${i}px, ${n}px)`}}const t=this.list.map((({label:e})=>({label:e})));return(0,i.h)(i.H,{key:"c283b0d62374ca40697989bb8144f6eb4f120597",class:this.useFlyOut?"js-app-flyout":""},(0,i.h)("div",{key:"9376a193cfcb735f985991bf77f7ef153edfd48c",class:this.useFlyOut?"pop-menu pop-menu-flyout":"pop-menu",style:e,ref:e=>this.refMenuNode=e},this.showFilter&&(0,i.h)("div",{key:"8b5a5b69d3539484f8a4a3f11b92971628836180"},(0,i.h)("calcite-filter",{key:"b9b29861021c735a8c4883e9e201c42ce72bbb9c",items:t,messageOverrides:this.messages,onCalciteFilterChange:this.updateFilter,ref:e=>this.refFilterNode=e})),(0,i.h)("div",{key:"6a8910c384cfe2bd83ddc5b4c7fed11f27296a32",class:"pop-list"},this.renderList())))}renderList(){const{pageBufferSize:e}=this,t=Math.floor(e/2),s=this.getSubList(),n=this.getSelectedIndex(),o=this.list[n];return(0,i.h)("calcite-list",{label:this.messages.label,ref:e=>{this.refListNode&&this.refListNode.removeEventListener("calciteListChange",this.listChange),e?.addEventListener("calciteListChange",this.listChange),this.refListNode=e},selectionMode:"single-persist",filterEnabled:!1,displayMode:"nested",scale:"s"},s.map((({value:n,label:r},h)=>(0,i.h)("calcite-list-item",{value:n,label:r,key:r,selected:n===o.value,ref:this.hasSelectedScrolled||r!==o.label?h===s.length-t?this.setLastNode:h===s.length-e?this.setSecondLastNode:h===t?this.setFirstNode:h===e?this.setSecondNode:void 0:this.setSelectedNode}))))}getSelectedIndex(e=this.selectedIndex){return e>=this.list.length?0:e}getListPosition(){const{width:e,left:t,top:s,bottom:i,containerTop:n,containerBottom:o=0}=this.popoverProps,r=this.filterList??this.list,h=this.itemHeight*r.length+(this.showFilter?this.filterHeight:0),d=(o>i?o:document.body.clientHeight)-i,l=s-n;this.lockedMenuPosition||("auto"===this.position?this.lockedMenuPosition=1.5*h<=d||l/(l+d)<.618?"down":"up":this.lockedMenuPosition="down"===this.position?"down":"up");const a="down"===this.lockedMenuPosition,c=a?Math.min(h,d-2):Math.min(h,l-2);return{width:e,height:c,translateX:t,translateY:a?i:Math.max(n,s-c)}}getSubList(){const{pageRanges:e,removeOldPages:t}=this,s=e&&!t?Math.min(e[0],this.pageId):this.pageId,i=e&&!t?Math.max(e[1],this.pageId+1):this.pageId+1,n=this.filterList??this.list,{pageBufferSize:o}=this,r=n.slice(0===s?0:s*this.pageSize-o,i*this.pageSize+o);return t||(this.pageRanges=[s,i]),r}setupObserver(e){this.observer=new IntersectionObserver(((t,s)=>{if(this.suspendObserver)return;let i=!1;if(1===(t=t.filter((({isIntersecting:e})=>e))).length){const s=t[0];if(this.refLastNode&&"label"in s.target&&s.target.label===this.refLastNode.label)this.pageId<e&&(this.pageId++,i=!0,this.removeOldPages&&(this.pendingScroll=()=>{this.pageId>0&&this.refSecondNode?.scrollIntoView(!0)}));else if(this.pageId>0){if(this.pageId--,this.removeOldPages)this.pendingScroll=()=>{this.refSecondLastNode?.scrollIntoView(!1),this.pendingScroll=void 0};else{const e=s.target;this.pendingScroll=()=>{e.scrollIntoView(),this.pendingScroll=void 0}}i=!0}}else if(2===t.length&&this.pageId===e){if(this.pageId--,!this.removeOldPages){const e=this.refLastNode;this.pendingScroll=()=>{e?.scrollIntoView(),this.pendingScroll=void 0}}i=!0}i&&(this.refLastNode&&s.unobserve(this.refLastNode),this.refFirstNode&&s.unobserve(this.refFirstNode))}))}updatePageId(e=this.selectedIndex){e=this.getSelectedIndex(e);const t=Math.floor(e/this.pageSize);t!==this.pageId&&(this.pageId=t)}get el(){return(0,i.g)(this)}static get watchers(){return{list:["watchList"],selectedIndex:["watchSelectedIndex"]}}};o.style=":host {\n  display: flex;\n  flex-direction: column;\n  overflow: hidden;\n}\n\n.pop-menu {\n  display: flex;\n  flex-direction: column;\n  position: absolute;\n  max-height: 100%;\n  width: 100%;\n  overflow-y: hidden;\n  border: 1px solid var(--calcite-color-border-3);\n\n  &.pop-menu-flyout {\n    top: 0px;\n    left: 0px;\n    z-index: 100;\n  }\n}\n\n.pop-list {\n  overflow-y: scroll;\n}\n";const r=class{constructor(e){(0,i.r)(this,e),this.arcgisChange=(0,i.c)(this,"arcgisChange",7),this.manager=(0,n.u)(this),this.handleOutsideClick=e=>{if(this.open){if(this.list.length>1){const t=e.composedPath();if(t.includes(this.el)||this.menuPopOver&&t.includes(this.menuPopOver))return}this.closeMenuPopOverAndDisconnectHandles()}},this.list=void 0,this.selectedIndex=0,this.containerTop=0,this.containerBottom=0,this.pageSize=500,this.removeOldPages=!1,this.messages=void 0,this.ariaLabeledBy=void 0,this.showFilterLength=20,this.pageId=0,this.open=!1}watchSelectedIndex(e){this.menuPopOver&&(this.menuPopOver.selectedIndex=e)}watchPageSize(e){this.menuPopOver&&(this.menuPopOver.pageSize=e)}disconnectedCallback(){this.closeMenuPopOverAndDisconnectHandles()}render(){const{selectedIndex:e,list:t}=this,s=e>=t.length?t[0]:t[e];return(0,i.h)("calcite-button",{key:"63b078924a0d6f7d24ccd4d362c38ae9a4454e21",scale:"s",width:"full",appearance:"outline-fill",kind:this.open?"brand":"neutral",class:this.open?void 0:"lazy-select-button",alignment:"icon-end-space-between",iconEnd:this.open?"chevron-up":"chevron-down","aria-haspopup":"true","aria-expanded":this.open?"true":"false","aria-label":this.ariaLabeledBy?void 0:this.messages?.selectLabel,"aria-labelledby":this.ariaLabeledBy,onClick:()=>this.renderSelectMenu(),ref:e=>this.refNode=e},s.label)}renderSelectMenu(){if(this.menuPopOver)return void this.closeMenuPopOverAndDisconnectHandles();if(!this.refNode)return;this.open=!0,document.addEventListener("pointerdown",this.handleOutsideClick),window.addEventListener("resize",this.handleOutsideClick);const e=document.createElement("arcgis-imagery-lazy-loading-list"),{height:t,top:s}=this.el.getBoundingClientRect(),{width:i,left:n,bottom:o,top:r,height:h}=this.refNode.getBoundingClientRect(),d=t-h-(o-s);e.popoverProps={width:i,left:n,top:r,bottom:o,height:d,containerTop:this.containerTop,containerBottom:this.containerBottom},e.useFlyOut=!0,e.messages=this.messages,e.showFilter=this.list.length>=this.showFilterLength,e.pageSize=this.pageSize,e.removeOldPages=this.removeOldPages,this.menuPopOver=e,e.addEventListener("arcgisChange",(e=>{this.selectedIndex=e.detail.selectedIndex,this.arcgisChange.emit(e.detail),this.closeMenuPopOverAndDisconnectHandles()})),document.body.appendChild(e),e.list=this.list,e.selectedIndex=this.selectedIndex,this.setupMarginObservers()}closeMenuPopOverAndDisconnectHandles(){this.disconnectObservers(),document.removeEventListener("pointerdown",this.handleOutsideClick),window.removeEventListener("resize",this.handleOutsideClick);const{menuPopOver:e}=this;e&&(this.menuPopOver=void 0,setTimeout((()=>{document.body.removeChild(e)}),100)),this.open=!1}setupMarginObservers(){if(!this.refNode)return;const{top:e,bottom:t}=this.refNode.getBoundingClientRect(),{clientHeight:s}=document.body;this.disconnectObservers();const i=`0px 0px ${t-s}px 0px`;this.topObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting||this.closeMenuPopOverAndDisconnectHandles()}))}),{rootMargin:i});const n=-e+"px 0px 0px 0px";this.bottomObserver=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting||this.closeMenuPopOverAndDisconnectHandles()}))}),{rootMargin:n}),this.topObserver.observe(this.refNode),this.bottomObserver.observe(this.refNode)}disconnectObservers(){this.topObserver?.disconnect(),this.bottomObserver?.disconnect(),this.topObserver=void 0,this.bottomObserver=void 0}get el(){return(0,i.g)(this)}static get watchers(){return{selectedIndex:["watchSelectedIndex"],pageSize:["watchPageSize"]}}};r.style=":host{width:100%;overflow:hidden}.lazy-select-button{--calcite-color-foreground-3:var(--calcite-color-border-input)}"}}]);
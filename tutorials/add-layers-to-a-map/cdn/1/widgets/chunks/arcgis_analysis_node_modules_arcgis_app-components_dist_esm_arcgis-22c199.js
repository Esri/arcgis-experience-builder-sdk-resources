/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-22c199.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-22c199"],{87613:(e,t,a)=>{a.r(t),a.d(t,{arcgis_delete_folder:()=>w,arcgis_delete_items:()=>f,arcgis_item_category_schema_editor:()=>T,arcgis_schema_editor:()=>I});var r=a(35110),i=a(46710),s=a(1984),o=a(58832),n=a(70392),l=a(66913),c=a(86587),h=a(23505),d=a(74484),g=a(76338),u=a(26077),m=a(91659),p=a(46346),y=a(75858);a(63280),a(21104),a(73838),a(67148),a(56086);const C=async(e,t)=>(0,l.r)(`${e.userContentUrl}/${t.id}`);async function v(e,t,a,r){try{const i=`${(0,n.g)(e)}search`;return{result:(await(0,l.r)(i,{q:`owner:${t.username} ownerfolder:${a.id} ${r||""}`,num:1})).total}}catch(e){return{result:0}}}const w=class{constructor(e){(0,r.r)(this,e),this.arcgisDeleteFolderClose=(0,r.c)(this,"arcgisDeleteFolderClose",7),this.arcgisDeleteFolderSuccess=(0,r.c)(this,"arcgisDeleteFolderSuccess",7),this.arcgisDeleteFolderFail=(0,r.c)(this,"arcgisDeleteFolderFail",7),this.updateItems=async()=>{var e;const t=await C(null!==(e=this.user)&&void 0!==e?e:i.c.user,this.folder);this.items=t.items},this.renderMessage=()=>{var e,t;const{i18n:a,folder:i,mode:s,folderTotal:o,portal:n,lang:l,items:h}=this;let d="",g="";switch(s){case"UNPROTECTED":case"UNRECYCLABLE":case"UNRECYCLABLE_UNPROTECTED":d=(null===(e=null==n?void 0:n.sourceJSON)||void 0===e?void 0:e.recycleBinEnabled)?a.message.mustBeEmptyProceed.replace("${title}",i.title):(0,c.b)(l,a.disabledMessage,o||(null==h?void 0:h.length)||0).replace("${label}",i.title);break;case"PROTECTED_UNRECYCLABLE":case"PROTECTED_UNPROTECTED":case"PROTECTED_UNRECYCLABLE_UNPROTECTED":(null===(t=null==n?void 0:n.sourceJSON)||void 0===t?void 0:t.recycleBinEnabled)?(d=a.message.mustBeEmpty.replace("${title}",i.title),g=a.message.aFewCannotBeDeleted):d=(0,c.b)(l,a.disabledMessage,o||(null==h?void 0:h.length)||0).replace("${label}",i.title);break;case"PROTECTED":d=a.message.cannotBeDeleted.replace("${title}",i.title)}return(0,r.h)(r.F,null,d&&(0,r.h)("p",{innerHTML:d}),g&&(0,r.h)("p",null,g))},this.handlePostDeleteItems=async()=>{0===(await C(i.c.user,this.folder)).total?await this.handleDeleteFolder():this.arcgisDeleteFolderFail.emit(this.i18n.deleteProtectedItemsInFolder)},this.handleDeleteFolder=async()=>{(await(async(e,t,a)=>{const r=`${(null!=a?a:t.user).userContentUrl}/${e.id}/delete`;return await(0,l.r)(r,{},{},"post")})(this.folder,this.portal,this.user)).success&&this.arcgisDeleteFolderSuccess.emit(this.i18n.success.replace("${title}",this.folder.title))},this.portal=void 0,this.user=void 0,this.folder=void 0,this.active=void 0,this.items=void 0,this.deleteItemsRef=void 0,this.mode=void 0,this.isEmpty=void 0,this.folderTotal=void 0}async componentWillLoad(){var e,t;const a=await(0,s.g)(this.el);this.i18n=a[0],this.lang=a[1];const r=null!==(e=this.user)&&void 0!==e?e:i.c.user,n=null!==(t=this.portal)&&void 0!==t?t:i.c.portal;this.isEmpty=(await async function(e,t,a){return{result:0===(await v(e,t,a)).result}}(n,r,this.folder)).result,this.folderTotal=(await async function(e,t,a){return{result:(await v(e,t,a,o.H)).result}}(n,r,this.folder)).result,this.updateItems()}render(){var e;const{portal:t,user:a,active:i,i18n:s,folder:o,items:n,mode:l,isEmpty:c}=this;return c?(0,r.h)("calcite-modal",{widthScale:"s",open:i,onCalciteModalClose:()=>this.arcgisDeleteFolderClose.emit()},(0,r.h)("div",{slot:"header"},s.deleteFolder),(0,r.h)("div",{slot:"content",innerHTML:s.message.empty.replace("${title}",null==o?void 0:o.title)}),(0,r.h)("calcite-button",{slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{this.arcgisDeleteFolderClose.emit(),this.active=!1},width:"full"},s.cancel),(0,r.h)("calcite-button",{slot:"primary",appearance:"solid",kind:"danger","data-id":"nextButton",onClick:async()=>{await this.handleDeleteFolder(),this.active=!1},width:"full"},s.delete)):(0,r.h)("arcgis-delete-items",{items:n,portal:t,user:a,active:i,showSelectedItemsCount:!1,showConfirmDeleteMessage:"PROTECTED"===l&&(null===(e=null==t?void 0:t.sourceJSON)||void 0===e?void 0:e.recycleBinEnabled),closeOnConfirm:!1,onArcgisDeleteItemsModeChange:e=>{this.mode=e.detail},onArcgisDeleteItemsClose:()=>{this.arcgisDeleteFolderClose.emit(),this.active=!1},onArcgisDeleteItemsDelete:async()=>{await this.handlePostDeleteItems(),this.active=!1}},(0,r.h)("div",{slot:"header"},s.deleteFolder),(0,r.h)("div",{slot:"message"},this.renderMessage()))}get el(){return(0,r.d)(this)}},f=class{constructor(e){(0,r.r)(this,e),this.arcgisDeleteItemsDelete=(0,r.c)(this,"arcgisDeleteItemsDelete",7),this.arcgisDeleteItemsError=(0,r.c)(this,"arcgisDeleteItemsError",7),this.arcgisDeleteItemsClose=(0,r.c)(this,"arcgisDeleteItemsClose",7),this.arcgisDeleteItemsModeChange=(0,r.c)(this,"arcgisDeleteItemsModeChange",7),this.deletePrimaryAction="RECYCLE",this.headerTitle="",this.preventNonRecyclableItemDelete=!1,this.configurePermanentlyDeleteOverrideUI=()=>{const{i18n:e}=this;this.headerTitle=e.permanentlyDelete,this.primaryButtonText=e.permanentlyDelete,this.deleteMode="UNRECYCLABLE",this.permanentDeleteOverrideEnabled=!0},this.renderContent=()=>{const{portal:e,items:t,deleteItemsBuckets:a,deleteMode:i,permanentDeleteOverrideEnabled:s,configurePermanentlyDeleteOverrideUI:o,showConfirmDeleteMessage:n}=this;return(0,r.h)(r.F,null,(0,r.h)("slot",{name:"message"}),e.sourceJSON.recycleBinEnabled?(0,r.h)("arcgis-delete-items-recycle-enabled",{items:t,buckets:a,mode:i,permanentlyDeleteOverridden:s,onArcgisDeleteItemsPermanentlyDeleteOverride:()=>{o()},onArcgisDeleteItemsPermanentlyDeleteBucketToggle:({detail:e})=>{this.preventNonRecyclableItemDelete=e},showSelectedItemsCount:this.showSelectedItemsCount}):n?(0,r.h)("arcgis-delete-items-recycle-disabled",{buckets:a,mode:i}):null)},this.handleDelete=async()=>{var e,t;this.isLoading=!0;const{unprotectedItems:a,unrecyclableItems:r}=this.deleteItemsBuckets;let i=null,s=null;try{this.permanentDeleteOverrideEnabled?i=await this.deleteItems(this.items,!0):(s=null!==(e=a.length>0&&await this.deleteItems(a.map((e=>e.item))))&&void 0!==e?e:null,i=null!==(t=r.length>0&&!this.preventNonRecyclableItemDelete&&await this.deleteItems(r.map((e=>e.item)),!0))&&void 0!==t?t:null),this.arcgisDeleteItemsDelete.emit({deletedItems:s,permanentlyDeletedItems:i}),this.closeOnConfirm&&(this.active=!1)}catch(e){this.arcgisDeleteItemsError.emit({messageCode:e.details.messageCode}),this.isLoading=!1}},this.deleteItems=async(e,t=!1)=>1===e.length?[await(0,d.d)(e[0],this.portal,t)]:(await(0,d.a)(e,this.portal,t)).results,this.user=void 0,this.portal=void 0,this.items=[],this.active=!1,this.showSelectedItemsCount=!0,this.showConfirmDeleteMessage=!0,this.closeOnConfirm=!0,this.store=(0,h.c)({}),this.deleteItemsBuckets={protectedItems:[],unprotectedItems:[],unrecyclableItems:[]},this.permanentDeleteOverrideEnabled=!1,this.isLoading=!1}async componentWillLoad(){const e=await(0,s.g)(this.el);this.i18n=e[0],this.store.state.i18n=this.i18n,this.store.state.portal=this.portal,this.store.state.locale=(0,s.a)(this.el),this.determineDeleteState()}async handleItemUpdate(){this.determineDeleteState({fetch:!0})}async determineDeleteState(e={fetch:!0}){const{fetch:t}=e;t&&(this.isLoading=!0,this.deleteItemsBuckets=Object.assign({},await(0,d.b)(this.items,this.portal)),this.isLoading=!1),this.deleteMode=(0,d.c)(this.deleteItemsBuckets),this.arcgisDeleteItemsModeChange.emit(this.deleteMode),this.deletePrimaryAction=(0,d.e)(this.deleteMode),this.primaryButtonText=this.i18n["PERMANENTLY_DELETE"===this.deletePrimaryAction?"permanentlyDelete":"delete"],this.headerTitle=this.i18n["PERMANENTLY_DELETE"===this.deletePrimaryAction?"permanentlyDelete":"deleteItems"]}render(){const{i18n:e,active:t,isLoading:a,headerTitle:i,primaryButtonText:s,deletePrimaryAction:o,permanentDeleteOverrideEnabled:n,renderContent:l}=this;return(0,r.h)("calcite-modal",{open:t,widthScale:"s",kind:"danger",outsideCloseDisabled:!0,onCalciteModalClose:()=>{this.arcgisDeleteItemsClose.emit(),this.active=!1}},(0,r.h)("span",{slot:"header",class:"header"},(0,r.h)("slot",{name:"header"},i)),(0,r.h)("div",{slot:"content",class:"content"},a?(0,r.h)("calcite-scrim",{loading:!0}):l()),!a&&(0,r.h)(r.F,null,(0,r.h)("div",{slot:"back"},n&&(0,r.h)("calcite-button",{appearance:"outline-fill",kind:"neutral","data-id":"backButton",onClick:()=>{this.permanentDeleteOverrideEnabled=!1,this.determineDeleteState({fetch:!1})},width:"full",disabled:a},e.back)),(0,r.h)("calcite-button",{slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{this.active=!1},width:"full"},e.cancel),"NONE"!==o&&(0,r.h)("calcite-button",{slot:"primary",appearance:"solid",kind:"danger","data-id":"nextButton",onClick:async()=>this.handleDelete(),width:"full",disabled:a},null!=s?s:e.delete)))}get el(){return(0,r.d)(this)}static get watchers(){return{items:["handleItemUpdate"]}}};f.style=".content{display:flex;min-height:72px;flex-direction:column;justify-content:center}::slotted([slot=message]){margin-bottom:1rem}";const S=async(e,t,a)=>{const r=a?`${(0,n.g)(t)}/content/groups/${a.id}/`:`${(0,n.g)(t)}`,i=a?{q:o.H,countFields:"access,contentstatus,groupCategories"}:{q:`orgid:${e.orgId} ${o.H}`,countFields:"categories"};try{const{aggregations:e}=await(0,l.r)(`${r}search`,Object.assign(Object.assign({},i),{countSize:200,num:0,f:"json"}));return{result:a?e.counts.find((({fieldName:e})=>"groupCategories"===e)):e.counts[0]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},D=e=>{e.forEach((e=>{e.description&&delete e.description,e.categories?D(e.categories):e.categories=[]}))},E=e=>{const t=structuredClone(e);return D(t),t},T=class{constructor(e){(0,r.r)(this,e),this.workflowCancel=(0,r.c)(this,"workflowCancel",7),this.newSchemaWorkflowComplete=(0,r.c)(this,"newSchemaWorkflowComplete",7),this.deleteAllSchema=(0,r.c)(this,"deleteAllSchema",7),this.hasChangeSinceLastOpen=!1,this.didFetchTemplates=!1,this.templateInfo={custom:{schema:[{title:"Categories",categories:[]}]},arcgis:{schema:[],learnMoreId:"120001580"},iso:{schema:[],learnMoreId:"120001581"},inspire:{schema:[],learnMoreId:"120001582"}},this.fetchCategoryData=async()=>{var e,t;const{user:a,portal:r,setCategorySchema:i,group:s,templateInfo:o,didFetchTemplates:n}=this,[{result:l},{result:c}]=await Promise.all([(0,g.g)({user:a,portal:r,group:s}),S(a,r,s)]);if(null===(t=null===(e=null==l?void 0:l[0])||void 0===e?void 0:e.categories)||void 0===t?void 0:t.length)i(l),this.categoryAggregationData=c;else if(this.rootCategoryTitle=u.U.replace("/",""),this.categorySchema=[],this.newCategoryMode=!0,!n){this.isFetchingTemplate=!0;const{result:e}=await(async e=>{try{const[{categorySchema:t},{categorySchema:a},{categorySchema:r}]=await Promise.all([(0,g.a)(e,"LivingAtlas"),(0,g.a)(e,"Inspire"),(0,g.a)(e,"ISO")]);return{result:{LivingAtlas:t,Inspire:a,ISO:r}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(r);o.arcgis.schema=e.LivingAtlas,o.iso.schema=e.ISO,o.inspire.schema=e.Inspire,this.didFetchTemplates=!0,this.isFetchingTemplate=!1}},this.setCategorySchema=e=>{this.rootCategoryTitle=e[0].title,this.categorySchema=e[0].categories},this.closeDialog=()=>{this.schemaToConfirm=null,this.hasUnsavedChanges=!1,this.workflowCancel.emit({hasChangeSinceLastOpen:this.hasChangeSinceLastOpen})},this.updateSchema=async({schemaToUpdate:e,ignoreNewCategoryMode:t=!1,optimisticUpdate:a=!0})=>{const{portal:r,rootCategoryTitle:i,handleError:s,fetchCategoryData:o,newCategoryMode:c,group:h,deleteAllSchema:d}=this;if(c&&!t)return this.hasUnsavedChanges=e.length>0,this.categorySchema=e,!0;this.hasChangeSinceLastOpen=!0;const g=this.categorySchema;return a&&(this.categorySchema=e),(async()=>{if(this.error=null,0===e.length){const{error:e}=await(async(e,t)=>{try{const a=t?(0,y.g)(e,t):`${(0,n.g)(e)}/portals/${e.id}/`;return await(0,l.r)(`${a}deleteCategorySchema`,{},{},"post"),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(r,h);return void(e?(s("generic"),a&&(this.categorySchema=g)):(this.newCategoryMode=!0,d.emit()))}const{error:t}=await(async({portal:e,group:t,categorySchema:a})=>{try{const r=t?(0,y.g)(e,t):`${(0,n.g)(e)}/portals/${e.id}/`;return await(0,l.r)(`${r}assignCategorySchema`,{categorySchema:JSON.stringify({categorySchema:a})},{},"post"),{}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})({portal:r,categorySchema:[{title:i,categories:c?E(e):e}],group:h});t?(s("generic"),a&&(this.categorySchema=g)):(this.hasUnsavedChanges=!1,await o())})(),!0},this.finishSetupNewCategorySchema=async()=>{const{newSchemaWorkflowComplete:e,categorySchema:t,updateSchema:a}=this;await a({schemaToUpdate:t,ignoreNewCategoryMode:!0})&&(this.newCategoryMode=!1,e.emit({newSchema:t}))},this.renderTemplates=()=>{const{templateInfo:e,i18n:t,chosenTemplate:a,config:i,setCategorySchema:s}=this,{helpBase:o,helpMap:n}=i;return(0,r.h)("div",{class:"template-container"},(0,r.h)("p",{class:"template-title"},t.template.title),(0,r.h)("calcite-tile-select-group",null,Object.keys(e).map((i=>{const{learnMoreId:l}=e[i];return(0,r.h)("calcite-tile-select",{key:i,checked:a===i,description:t.template.templateList[i].message,heading:t.template.templateList[i].title,width:"auto",value:i,onCalciteTileSelectChange:t=>{const a=t.target.value;this.chosenTemplate=a,s(e[a].schema),this.hasUnsavedChanges="custom"!==a}},l&&(0,r.h)("calcite-link",{href:`${o}${n[l]}`,role:"presentation",class:"template-link",iconEnd:"launch",target:"_blank",rel:"noopener noreferrer"},t.template.learnMore))}))))},this.renderConfirmationModal=()=>{var e;const{i18n:t,handleUpdateSchemaWithCount:a,schemaToConfirm:i}=this;if(!i)return null;const s=t.warning["delete"===i.type?"deleteInUseCategory":"changeTitleInUseCategory"];return(0,r.h)("calcite-modal",{kind:"danger",scale:"m",widthScale:"s",onCalciteModalClose:e=>{e.stopPropagation(),this.schemaToConfirm=null},open:!!i,class:"confirm-modal",style:{"--calcite-modal-scrim-background":"rgba(255, 255, 255, 0.5)"}},(0,r.h)("div",{slot:"header"},s.title),(0,r.h)("div",{slot:"content",class:"confirm-modal-content"},s.message.replace("${numItem}",null===(e=i.count)||void 0===e?void 0:e.toLocaleString()).replace("${newTitle}","change-title"===i.type?i.newTitle:"")),(0,r.h)("calcite-button",{slot:"secondary",appearance:"outline","data-id":"cancelButton",onClick:()=>{this.schemaToConfirm=null,"change-title"===i.type&&(this.categorySchema=[...this.categorySchema])},width:"full"},t.cancel),(0,r.h)("calcite-button",{slot:"primary",appearance:"solid","data-id":"nextButton",onClick:a,width:"full"},s.cta))},this.handleUpdateSchemaWithCount=async()=>{const{group:e,schemaToConfirm:t,portal:a,updateSchema:r,categoryAggregationData:i}=this;this.isUpdatingCategoryWithCount=!0,this.schemaToConfirm=null,await r({schemaToUpdate:t.schema})&&(await(0,g.c)({path:t.path,portal:a,updateInfo:"delete"===t.type?{type:"delete"}:{type:"change-title",newTitle:t.newTitle},group:e}),"change-title"===t.type&&(i.fieldValues=i.fieldValues.map((e=>{const a=t.path.toLowerCase(),r=(0,u.a)(a,t.newTitle.toLowerCase());return e.value.toLowerCase()===a?Object.assign(Object.assign({},e),{value:r}):e})),this.categoryAggregationData=Object.assign({},i))),this.isUpdatingCategoryWithCount=!1},this.handleError=e=>{const{i18n:t}=this;let a=t.error[e].message;"maxCharacter"===e&&(a=a.replace("${maxCharacter}",`${p.M}`)),this.error={title:t.error[e].title,message:a}},this.getUnsavedChangesConfirmation=()=>window.confirm(this.i18n.hasUnsavedChanges),this.user=void 0,this.portal=void 0,this.config=void 0,this.group=void 0,this.isActive=void 0,this.newCategoryMode=!1,this.categorySchema=[],this.categoryAggregationData={fieldName:"categories",fieldValues:[]},this.hasUnsavedChanges=void 0,this.error=null,this.isFetchingSchemaOnActiveChange=!1,this.isFetchingTemplate=!1,this.isUpdatingCategoryWithCount=!1,this.schemaToConfirm=void 0,this.rootCategoryTitle=void 0,this.chosenTemplate="custom"}async componentWillLoad(){const e=await(0,s.g)(this.el);this.i18n=e[0]}componentDidLoad(){this.handleIsActiveChange()}async handleIsActiveChange(){this.hasChangeSinceLastOpen=!1,this.chosenTemplate="custom",this.error=null,this.schemaToConfirm=null,!this.isActive||(0,m.d)(this.user)&&!this.group||(this.isFetchingSchemaOnActiveChange=!0,await this.fetchCategoryData(),this.isFetchingSchemaOnActiveChange=!1)}render(){const{newCategoryMode:e,categorySchema:t,categoryAggregationData:a,rootCategoryTitle:i,isActive:s,isFetchingSchemaOnActiveChange:o,closeDialog:n,i18n:l,group:c,updateSchema:h,error:d,renderTemplates:g,chosenTemplate:u,isFetchingTemplate:m,workflowCancel:p,finishSetupNewCategorySchema:y,hasUnsavedChanges:C,handleError:v,renderConfirmationModal:w,isUpdatingCategoryWithCount:f,getUnsavedChangesConfirmation:S}=this;return!s||o?null:(0,r.h)("calcite-modal",{open:s,beforeClose:async()=>{if(C&&!S())throw new Error},onCalciteModalClose:n,scale:"m",class:{modal:!0,"modal--large":e}},(0,r.h)("div",{slot:"header",class:"header"},l[c?"modalGroupHeader":"modalHeader"]),(0,r.h)("div",{slot:"content",class:"stage"},w(),(0,r.h)("calcite-alert",{icon:!0,open:!!d,label:null==d?void 0:d.title,kind:"danger",onCalciteAlertClose:()=>this.error=null},(0,r.h)("div",{slot:"message"},null==d?void 0:d.message)),(m||f)&&(0,r.h)("calcite-scrim",{loading:!0},l.loadingText),e&&g(),(0,r.h)("div",{class:{"inner-container":!0,"inner-container--new-category":e}},!e&&(0,r.h)("p",{class:"help-text"},l.helpText),(0,r.h)("arcgis-schema-editor",{newCategoryMode:e,showInputByDefault:"custom"===u,canEditCategory:()=>!0,categoryAggregationData:a,categorySchema:t,rootCategoryPath:`/${i}`,canCollapseAll:!e,saveNewTitle:async({newSchema:e,categoryCount:t,path:a,newTitle:r})=>t?(this.schemaToConfirm={schema:e,count:t,path:a,newTitle:r,type:"change-title"},!0):h({schemaToUpdate:e,optimisticUpdate:!1}),saveNewCategory:async({newSchema:e})=>h({schemaToUpdate:e}),onArcgisSchemaEditorDelete:async({detail:{newSchema:e,categoryCount:t,path:a}})=>t?this.schemaToConfirm={schema:e,count:t,path:a,type:"delete"}:h({schemaToUpdate:e}),onArcgisSchemaEditorListOrderChange:async({detail:{newSchema:e}})=>h({schemaToUpdate:e}),onArcgisSchemaEditorInvalidMove:({detail:{errorCode:e}})=>{v(e)},onArcgisSchemaEditorTitleInvalid:({detail:{errorCode:e}})=>{v(e)}}))),e&&(0,r.h)(r.F,null,(0,r.h)("calcite-button",{slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{C&&!S()||p.emit()},width:"full"},l.cancel),(0,r.h)("calcite-button",{slot:"primary",appearance:"solid","data-id":"nextButton",onClick:y,width:"full",disabled:!C},l.finishSetup)))}get el(){return(0,r.d)(this)}static get watchers(){return{isActive:["handleIsActiveChange"]}}};T.style=".stage{--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));display:flex}.modal{--calcite-modal-content-padding:0;--calcite-modal-width:48rem;--calcite-modal-height:90vh;--calcite-modal-content-background:var(--calcite-color-background)}.modal--large{--calcite-modal-width:1080px}.template-container{overflow:auto;width:20rem;padding:1rem}.template-title{margin-top:0px;margin-bottom:0px;margin-bottom:1rem;font-size:1.125rem}.template-link{font-size:0.75rem}.inner-container{overflow:auto;width:100%;padding:2rem}.inner-container--new-category{padding-inline-start:0.5rem;padding:1rem}.help-text{margin-top:0px}.confirm-modal{--calcite-modal-width:32rem;--calcite-modal-height:auto}.confirm-modal-content{padding:1rem}";const I=class{constructor(e){(0,r.r)(this,e),this.arcgisSchemaEditorListOrderChange=(0,r.c)(this,"arcgisSchemaEditorListOrderChange",7),this.arcgisSchemaEditorDelete=(0,r.c)(this,"arcgisSchemaEditorDelete",7),this.arcgisSchemaEditorInvalidMove=(0,r.c)(this,"arcgisSchemaEditorInvalidMove",7),this.arcgisSchemaEditorTitleInvalid=(0,r.c)(this,"arcgisSchemaEditorTitleInvalid",7),this.prevChangeEventPayload=null,this.prevSchema=null,this.handleExpandCollapseAllClick=()=>{this.isCollapsedAll=!this.isCollapsedAll,this.itemRef.expandOrCollapseAll(this.isCollapsedAll)},this.handleListOrderChange=e=>{const{categorySchema:t,arcgisSchemaEditorListOrderChange:a,uiCategory:r,rootCategoryPath:i}=this,s=(0,p.g)(r,e,i);a.emit(Object.assign(Object.assign({},e),{newSchema:s})),this.prevSchema=t},this.handleDeleteClick=e=>{const{arcgisSchemaEditorDelete:t,uiCategory:a,rootCategoryPath:r}=this,i=(0,p.a)(a,e,r);t.emit(Object.assign(Object.assign({},e),{path:(0,p.b)({uiPath:e.path,rootCategoryPath:r,uiCategory:a}),newSchema:i})),this.prevSchema=this.categorySchema},this.handleSaveNewTitle=async e=>{const{saveNewTitle:t,uiCategory:a,arcgisSchemaEditorTitleInvalid:r,rootCategoryPath:i}=this,s=e.path,o=(0,p.c)({targetParentCategory:(0,p.d)(a,s,i).parentCategory,targetCategory:{path:s,title:e.newTitle}});if(o)return r.emit(Object.assign(Object.assign({},e),{errorCode:o})),!1;const n=this.categorySchema,l=(0,p.e)(a,e,i),c=await t(Object.assign(Object.assign({},e),{path:(0,p.b)({uiPath:s,rootCategoryPath:i,uiCategory:a}),newSchema:l}));if(c){this.prevSchema=n;const{targetCategory:t,parentCategory:r}=(0,p.d)(a,e.path,i);t.title=e.newTitle,t.path=(0,u.b)(r.path,t)}return c},this.handleSaveNewCategory=async e=>{const{saveNewCategory:t,uiCategory:a,arcgisSchemaEditorTitleInvalid:r,rootCategoryPath:i}=this,s=e.path,{parentCategory:o,targetCategory:n}=(0,p.d)(a,s,i),l=(0,p.c)({targetParentCategory:null!=n?n:o,targetCategory:{path:s,title:e.newTitle}});if(l)return r.emit(Object.assign(Object.assign({},e),{errorCode:l})),!1;const c=this.categorySchema,h=(0,p.f)(a,e,i),d=await t(Object.assign(Object.assign({},e),{newSchema:h}));return d&&(this.prevSchema=c),d},this.isMoveValid=e=>{const{maxDepth:t,arcgisSchemaEditorInvalidMove:a,prevChangeEventPayload:r,rootCategoryPath:i}=this,{fromCategory:s,toCategory:o,fromItemCategory:n}=e,{fromCategory:l,fromItemCategory:c,toCategory:h,fromIndex:d,toIndex:g}=null!=r?r:{};if(r&&l.path===s.path&&c.path===n.path&&h.path===o.path&&d===e.fromIndex&&g===e.toIndex)return this.prevChangeEventPayload=null,null;this.prevChangeEventPayload=e;const{path:u}=o;if("number"==typeof t&&u&&(0,p.h)(u,i)>t)return a.emit(Object.assign(Object.assign({},e),{errorCode:"maxDepthExceeded"})),!1;const m=(0,p.c)({targetParentCategory:o,targetCategory:n});return!m||(a.emit(Object.assign(Object.assign({},e),{errorCode:m})),!1)},this.categorySchema=void 0,this.rootCategoryPath=void 0,this.categoryAggregationData=void 0,this.showInputByDefault=!1,this.newCategoryMode=void 0,this.maxDepth=2,this.maxCategories=900,this.canCollapseAll=!0,this.canEditCategory=void 0,this.saveNewTitle=void 0,this.saveNewCategory=void 0,this.isCollapsedAll=!1,this.uiCategory=void 0,this.canAddCategory=!1,this.canDeleteCategory=!1}async componentWillLoad(){const e=await(0,s.g)(this.el);this.i18n=e[0],this.categorySchemaChangeHandler()}async revertSchema(){this.categorySchema=this.prevSchema}categorySchemaChangeHandler(){const{categorySchema:e,categoryAggregationData:t,rootCategoryPath:a}=this;this.uiCategory=(0,p.i)({categorySchema:e,categoryAggregationData:t,rootCategoryPath:a});const r=(0,p.j)(e);this.canAddCategory=r<this.maxCategories,this.canDeleteCategory=!0}render(){const{uiCategory:e,rootCategoryPath:t,newCategoryMode:a,showInputByDefault:i,canAddCategory:s,canDeleteCategory:o,canEditCategory:n,canCollapseAll:l,i18n:c,isCollapsedAll:h,maxDepth:d,handleExpandCollapseAllClick:g,handleListOrderChange:u,handleSaveNewTitle:m,handleSaveNewCategory:p,isMoveValid:y}=this;return(0,r.h)(r.H,null,l&&(0,r.h)("calcite-button",{iconStart:h?"chevron-down":"chevron-up",appearance:"transparent",onClick:g,class:"expand-collapse-all"},h?c.expandAll:c.collapseAll),(0,r.h)("arcgis-schema-editor-category",{category:e,rootCategoryPath:t,newCategoryMode:a,showInputByDefault:i,canAddCategory:s,canDeleteCategory:o,canEditCategory:n,i18n:c,maxDepth:d,isMoveValid:y,onListOrderChanged:e=>u(e.detail),onArcgisSchemaEditorInternalDeleteClick:e=>this.handleDeleteClick(e.detail),saveNewTitle:m,saveNewCategory:p,ref:e=>this.itemRef=e}))}get el(){return(0,r.d)(this)}static get watchers(){return{rootCategoryPath:["categorySchemaChangeHandler"],categorySchema:["categorySchemaChangeHandler"],categoryAggregationData:["categorySchemaChangeHandler"]}}};I.style=".expand-collapse-all{margin-bottom:1rem}"},26077:(e,t,a)=>{a.d(t,{U:()=>r,a:()=>o,b:()=>i,g:()=>s});const r="/Categories",i=(e,t,a=!0)=>{const r=null!=e?e:"";return`${r}${r.endsWith("/")?"":"/"}${a?t.title.toLocaleLowerCase():t.title}`};function s(e){var t;let a=null===(t=null==e?void 0:e[0])||void 0===t?void 0:t.title;return a&&"/"!==a.charAt(0)&&(a=`/${a}`),a||r}const o=(e,t)=>`${e.replace(/\/([^\/]+)$/,`/${t}`)}`},76338:(e,t,a)=>{a.d(t,{a:()=>g,b:()=>d,c:()=>m,f:()=>h,g:()=>c,u:()=>u});var r=a(66913),i=a(26077),s=a(46710),o=a(75858),n=a(91659),l=a(70392);const c=async({portal:e,user:t,group:a,useCache:r=!1})=>{var i;try{const s=await(a?d(a.id,e,r):h(e,t,r));return{result:null!==(i=null==s?void 0:s.categorySchema)&&void 0!==i?i:null}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}};async function h(e,t,a=!0){if(null!=e||(e=s.c.portal),null!=t||(t=s.c.user),!(null==e?void 0:e.id)||t&&(0,n.d)(t))return null;const i=()=>(0,r.r)(`${(0,l.g)(e)}portals/${e.id}/categorySchema`);return a?(0,r.f)(i,"categorySchema",e.id):i()}async function d(e,t,a=!0){if(null!=t||(t=null===s.c||void 0===s.c?void 0:s.c.portal),!e||!t)return null;const i=()=>(0,r.r)(`${(0,o.g)(t,{id:e})}categorySchema`);return a?(0,r.f)(i,"categorySchema",e):i()}async function g(e,t,a=!0){const i=()=>async function(e,t){var a;const i=(0,l.g)(e),s=await(0,r.r)(`${i}portals/self`),n=await(0,r.r)(`${i}community/groups?q=${s.contentCategorySetsGroupQuery}`),c=null===(a=null==n?void 0:n.results)||void 0===a?void 0:a[0],h=(await(0,r.r)((0,o.a)(e,c),{q:`typekeywords: ${t}`})).results[0];return(0,r.r)(`${i}content/items/${h.id}/data`)}(e,t);return a?(0,r.f)(i,"categorySchema",t):i()}async function u({categories:e,itemIds:t,portal:a}){try{const i=`${(0,l.g)(a)}/content/updateItems`,s=JSON.stringify(t.map((t=>({[t]:{categories:Array.isArray(e)?e:e[t]}}))));return{result:await(0,r.r)(i,{items:s},{},"post")}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}const m=async({path:e,portal:t,group:a,updateInfo:r})=>{try{const s=(await p({category:e,portal:t,group:a,num:1})).total;if(0===s)return console.warn(`No items found with category ${e} when updating schema`),{};const o=100,n=Math.ceil(s/o),l=[];for(let s=0;s<n;s++)l.push(p({category:e,portal:t,group:a,start:s*o,num:o}).then((({results:t})=>{const a={};return t.forEach((t=>{const s="change-title"===r.type?t.categories.map((t=>{const a=(0,i.a)(e,r.newTitle);return t===e?a:t.replace(`${e}/`,`${a}/`)})):t.categories.filter((t=>!t.startsWith(e)));a[t.id]=s})),a})));const c=await Promise.all(l);return await Promise.all(c.map((e=>u({categories:e,itemIds:Object.keys(e),portal:t})))),{}}catch(t){return console.error(`Error ${r.type} items schema from path ${e}:`,t),{error:{code:"unhandledError"}}}},p=({category:e,num:t=100,start:a=0,portal:i,group:s})=>{const n={start:a,num:t,categories:JSON.stringify([e])},c=s?(0,o.a)(i,s):`${(0,l.g)(i)}search`;return(0,r.r)(c,Object.assign(Object.assign({},n),{q:s?void 0:`orgid: ${i.id}`}))}},74484:(e,t,a)=>{a.d(t,{D:()=>h,a:()=>l,b:()=>d,c:()=>g,d:()=>n,e:()=>u,g:()=>c,i:()=>C}),a(46710),a(21104);var r=a(78635),i=a(67148),s=a(91659),o=a(66913);const n=async(e,t,a=!1)=>{const r=`${(0,s.A)(e.owner,t)}/items/${e.id}/delete`;return(0,o.r)(r,{permanentDelete:a},{},"post")},l=async(e,t,a=!1)=>{const r=(0,s.z)(e),i=[];for(const e in r){const n={items:r[e].join(","),permanentDelete:a},l=`${(0,s.A)(e,t)}/deleteItems`;i.push((0,o.r)(l,n,{},"post"))}return{results:(await Promise.all(i)).flatMap((e=>e.results))}};async function c(e,t){const a=await(0,o.r)(`${e.restUrl}/portals/helpmap?culture=${t}`);return null==a?void 0:a.helpMap.m}const h=14,d=async(e,t,a=!1)=>{const n=[],l=[],c=[];return await Promise.all(e.map((async h=>{var d,g;try{const g=await(async(e,t)=>{const a=t.sourceJSON.recycleBinEnabled?"/canRecycle":"/canDelete",r=`${(0,s.A)(e.owner,t)}/items/${e.id}${a}`;return await(0,o.r)(r)})(h,t);if(g.success){const s=await(async(e,t)=>{const{type:a,typeKeywords:r}=e,s=["Scene Service","Map Service","WFS","OGCFeatureServer","Vector Tile Service","3DTiles Service"].includes(a),o=["Map Service","Vector Tile Service"].includes(a);let n,l=s?"Service2Service":e.typeKeywords.includes("Route Layer")?"Service2Route":"Service2Data",c="Service2Service"===l||"Service2Route"===l?"reverse":"forward";r.indexOf("Bulk Published Service")>-1&&(l="DataStore2BPService",c="reverse");try{const a=await(0,i.g)(e.id,t,{relationshipType:l,direction:c});if(n=(null==a?void 0:a.total)?a.relatedItems.shift():null,s){if(o&&!(e=>e&&e.typeKeywords.includes("View Service")||!1)(n)||!n){const a=await(0,i.g)(e.id,t,{relationshipType:"Service2Data",direction:"forward"});return(null==a?void 0:a.total)?a.relatedItems.shift():n}return n}return n}catch(e){console.error(e)}})(h,t),o=await(async(e,t)=>{const{type:a,typeKeywords:s}=e,o=(0,r.i)(s,a)?"Service2Service":"Service2Data",n="Service2Service"===o&&"Feed"!==a?"forward":"reverse",l=await(0,i.g)(e.id,t,{relationshipType:o,direction:n});return l.total>0&&l.relatedItems})(h,t),c=await(async(e,t,a)=>{const{typeKeywords:i,type:s}=e;return!t&&(null==a?void 0:a.length)&&!(0,r.i)(i,s)})(h,s,o),g=!(c||!o||p(h,o)||y(h,o)),u=null!==(d=a&&1===e.length&&c&&{item:h,error:{message:"Delete discouraged"}})&&void 0!==d?d:null;u?l.push(u):c&&!m(e,o)?n.push({item:h,error:{message:"Delete discouraged"}}):g&&!m(e,o)?n.push({item:h,error:{messageCode:"CONT_00481",offendingItems:o}}):l.push({item:h})}else h.protected?n.push({item:h,error:{messageCode:"CONT_0048"}}):c.push({item:h})}catch(t){const a=(null===(g=null==t?void 0:t.details)||void 0===g?void 0:g.raw)||Object.assign({},t);switch(t.messageCode||a.messageCode){case"CONT_00481":{const{offendingItems:t}=a;m(e,t)?l.push({item:h}):n.push({item:h,error:a});break}case"CONT_0048":default:n.push({item:h,error:a});break;case"CONT_0298":c.push({item:h})}}}))),Promise.resolve({protectedItems:n,unprotectedItems:l,unrecyclableItems:c})},g=e=>{const{protectedItems:t,unrecyclableItems:a,unprotectedItems:r}=e,i=[];return t.length>0&&i.push("PROTECTED"),a.length>0&&i.push("UNRECYCLABLE"),r.length>0&&i.push("UNPROTECTED"),i.join("_")},u=e=>{let t="DELETE";switch(e){case"PROTECTED":t="NONE";break;case"UNRECYCLABLE":case"PROTECTED_UNRECYCLABLE":t="PERMANENTLY_DELETE"}return t},m=(e,t)=>{var a;const r=null!==(a=null==t?void 0:t.map((e=>{var t;return null!==(t=e.itemId)&&void 0!==t?t:e.id})))&&void 0!==a?a:[],i=e.filter((e=>r.includes(e.id))),s=r.every((t=>e.some((e=>e.id===t)))),o=i.every((e=>!e.protected));return s&&o},p=(e,t)=>{const{typeKeywords:a,type:i}=e;return"Feed"===e.type&&(0,r.i)(a,i)&&1===(null==t?void 0:t.length)&&"Feature Service"===t[0].type&&t[0].typeKeywords.includes("Hosted Service")},y=(e,t)=>{const{typeKeywords:a,type:i}=e;return"Feature Service"===e.type&&(0,r.i)(a,i)&&1===(null==t?void 0:t.length)&&"Feed"===t[0].type&&t[0].typeKeywords.includes("Hosted Service")},C=({item:e})=>{var t,a;const{typeKeywords:i,type:s}=e;return(0,r.i)(i,s)&&"Feature Service"===e.type&&!!(null!==(a=null===(t=e.sourceJSON)||void 0===t?void 0:t.origin)&&void 0!==a?a:null==e?void 0:e.origin)}},75858:(e,t,a)=>{a.d(t,{a:()=>s,g:()=>i});var r=a(70392);const i=(e,t)=>(0,r.a)(`${(0,r.g)(e)}community/groups/${t.id}`),s=(e,t)=>`${((e,t)=>(0,r.a)(`${(0,r.g)(e)}content/groups/${t.id}`))(e,t)}search`},67148:(e,t,a)=>{a.d(t,{a:()=>n,b:()=>c,g:()=>l,r:()=>o});var r=a(66913),i=a(70392),s=a(46710);const o=async(e,t,a={})=>{const{body:i,usePost:o,addTokenManually:n,api:l=(null===s.c||void 0===s.c?void 0:s.c.api),customToken:c}=a,h=new URLSearchParams;i&&Object.entries(i).forEach((([e,t])=>{void 0!==t&&h.append(e,t)}));const d=new URL(e);if(d.searchParams.append("f","json"),c)d.searchParams.append("token",c);else{const e=!1===n?null:await(0,r.b)(t,l);e&&d.searchParams.append("token",e)}const g=await fetch(d.toString(),{body:o?h:void 0,method:o?"POST":"GET"}),u=await g.json(),m=u.error;if(m)throw"string"==typeof m?new Error(m):m;return u},n=async(e,t)=>{var a;try{return{result:await o(e,t,{addTokenManually:!1})}}catch(e){const t="token required";return(null===(a=null==e?void 0:e.message)||void 0===a?void 0:a.toLowerCase().includes(t))?{error:{code:"tokenRequired"}}:(console.error(e),{error:{code:"unhandledError"}})}};async function l(e,t,{relationshipType:a,direction:s}){const o=`${(0,i.g)(t)}content/items/${e}/relatedItems`;return await(0,r.r)(o,{relationshipType:a,direction:s})}const c=async(e,t)=>{try{return{result:(await(0,r.r)(`${(0,i.g)(t)}/search`,{filter:`id:(${e.join(" OR ")})`,num:100})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}},58832:(e,t,a)=>{a.d(t,{H:()=>r});const r='-typekeywords:("MapAreaPackage") -type:("Map Area" OR "Indoors Map Configuration" OR "Code Attachment")'},78635:(e,t,a)=>{a.d(t,{i:()=>r});const r=(e,t)=>"Feature Service"===t&&e.includes("Hosted Service")},46346:(e,t,a)=>{a.d(t,{M:()=>C,a:()=>n,b:()=>y,c:()=>p,d:()=>c,e:()=>s,f:()=>o,g:()=>i,h:()=>l,i:()=>h,j:()=>m});var r=a(26077);const i=(e,{fromCategory:{path:t},toCategory:{path:a},fromIndex:r,toIndex:i},s)=>{const o=structuredClone(e),n=c(o,t,s);let l=n;t!==a&&(l=c(o,a,s));const[h]=n.targetCategory.categories.splice(r,1);return l.targetCategory.categories.splice(i,0,h),d(o)},s=(e,{newTitle:t,path:a},r)=>{const i=structuredClone(e);return c(i,a,r).targetCategory.title=t,d(i)},o=(e,{newTitle:t,path:a},r)=>{const i=structuredClone(e),s=a.replace(/\/[^/]+$/,"");if(s){const{targetCategory:e}=c(i,s,r);e.categories.push({title:t,categories:[],count:0,path:null})}else i.categories.push({title:t,categories:[],count:0,path:null});return d(i)},n=(e,{path:t},a)=>{const r=structuredClone(e),{targetIndex:i,parentCategory:s}=c(r,t,a);return null==s||s.categories.splice(i,1),d(r)},l=(e,t)=>{var a;return null!==(a=null==e?void 0:e.toLocaleLowerCase().replace(t.toLowerCase(),"").slice(1).split("/").length)&&void 0!==a?a:0},c=(e,t,a)=>{var i;const s=a.toLocaleLowerCase();if(null==t||t===s)return{targetCategory:e,targetIndex:1,parentCategory:null,originalPath:t};const o=t.slice(1).split("/");let n=0===t.toLocaleLowerCase().indexOf(s)?(0,r.b)("",{title:o.shift()}):"",l=null,c=e,h=0,d=n;do{n=(0,r.b)(n,{title:o.shift()}),l=c,h=c.categories.findIndex((e=>e.path.toLocaleLowerCase()===n.toLocaleLowerCase())),c=c.categories[h],d+=`/${null!==(i=null==c?void 0:c.title)&&void 0!==i?i:""}`}while(o.length>0&&c.categories.length);return d=d.replace(s,a),{targetCategory:c,targetIndex:h,parentCategory:l,originalPath:d}},h=({categoryAggregationData:e,categorySchema:t,rootCategoryPath:a})=>{var r,i;const s=a.toLocaleLowerCase();return{title:"",path:null,count:null!==(i=null===(r=e.fieldValues.find((e=>e.value===s)))||void 0===r?void 0:r.count)&&void 0!==i?i:0,categories:u({parentPath:null,categorySchema:t,categoryAggregationData:e,lowerCaseRootCategoryPath:s})}},d=e=>e.categories.map(g),g=e=>({title:e.title,categories:e.categories.map(g)}),u=({categoryAggregationData:e,categorySchema:t,parentPath:a,lowerCaseRootCategoryPath:i})=>t.map((t=>{var s,o;const n=(0,r.b)(null!=a?a:i,t),l=null===(s=e.fieldValues.find((e=>e.value===n)))||void 0===s?void 0:s.count,c=u({parentPath:n,categorySchema:null!==(o=t.categories)&&void 0!==o?o:[],categoryAggregationData:e,lowerCaseRootCategoryPath:i});return{title:t.title,path:n,count:null!=l?l:0,categories:c}})),m=e=>e.reduce(((e,t)=>{var a;return e+1+m(null!==(a=t.categories)&&void 0!==a?a:[])}),0),p=({targetCategory:e,targetParentCategory:t})=>{var a;const r=null===(a=e.title.toLocaleLowerCase())||void 0===a?void 0:a.trim();return r?r.length>C?"maxCharacter":t.categories.some((t=>t.title.toLowerCase()===r&&t.path!==e.path))?"destinationHasSameName":null:"emptyTitle"},y=({rootCategoryPath:e,uiCategory:t,uiPath:a})=>c(t,a,e).originalPath,C=100}}]);
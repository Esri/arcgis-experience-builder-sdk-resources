/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_data-s-ad8215.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_data-s-ad8215"],{57983:(e,t,r)=>{r.d(t,{a:()=>p,b:()=>f,c:()=>u,d:()=>l,e:()=>o,f:()=>s,g:()=>g,h:()=>d,i:()=>b,j:()=>h,k:()=>w,l:()=>i,m:()=>c});var a=r(66913),n=r(46710);function o(e,t){const r={type:"folder",path:`/fileShares/${t}`,info:{datastoreConnectionType:"shared",path:e.publisherFolderPath,hostName:e.publisherFolderPathHostname}};return"newPath"===e.serverFolderPath?(r.clientPath=e.publisherFolderPath,r.info.path=e.newServerFolderPath,r.info.datastoreConnectionType="replicated"):"nfsHostAndPath"===e.serverFolderPath&&(r.clientPath=e.publisherFolderPath,r.provider="UserManaged",r.info.datastoreConnectionType="replicated",r.info.fileServerPath=e.nfsSharePath,r.info.fileServerHost=e.nfsHostName,r.info.fileServerType="nfs"),r}function s(e,t){const r={type:"egdb",path:"/enterpriseDatabases/"+t,info:{dataStoreConnectionType:"shared"}};return"newConnection"===e.serverDatabaseOption?(r.info.connectionString=e.serverConnectionString,r.info.clientConnectionString=e.publisherConnectionString,r.info.dataStoreConnectionType="replicated"):"bigQuery"===e.databaseProvider||"snowflake"===e.databaseProvider?r.info.JDBCConnection=e.jdbcConnection:r.info.connectionString=e.publisherConnectionString,r}const i=async(e,t,r,a)=>{let n,o;if((null==r?void 0:r.length)>0){try{o=JSON.parse(r)}catch(e){return{error:{code:"invalidJSON"}}}n=function(e,t){const{type:r,project_id:a,private_key_id:n,private_key:o,client_email:s,client_id:i,auth_uri:c,token_uri:d,auth_provider_x509_cert_url:l,client_x509_cert_url:u}=t;return{oAuthType:0,projectId:e,url:"jdbc:bigquery://https://www.googleapis.com/bigquery/v2:443",oAuthPvtKeyFile:{type:r,project_id:a,private_key_id:n,private_key:o,client_email:s,client_id:i,auth_uri:c,token_uri:d,auth_provider_x509_cert_url:l,client_x509_cert_url:u}}}(e,o)}else(null==a?void 0:a.length)>0&&(n=function(e,t,r){return{name:"BigqueryArcgisPlatform_RefreshToken",className:"com.esri.sds.bigquery.jdbc.GBQDataSource",oAuthType:2,projectId:e,defaultDataset:t,url:"jdbc:bigquery://https://www.googleapis.com/bigquery/v2:443",oAuthRefreshToken:r}}(e,t,a));return{result:{type:"egdb",path:"/enterpriseDatabases/bigQuerySvrDevDataJdbc",id:null,clientPath:null,info:{JDBCConnection:n}}}};function c(e){const{user:t,password:r,database:a,role:n,server:o,warehouse:s,schema:i}=e;return{path:"/enterpriseDatabases/snowflakeJdbc",type:"egdb",info:{JDBCConnection:{user:t,password:r,database:a,role:n,connectionUrl:`jdbc:snowflake://${o}`,warehouse:s,schema:i}}}}function d(e,t){if("Arango"===e.noSqlProvider){const t={type:"nosql",path:"/nosqlDatabases/Arango_enterprise",info:{systemManaged:!1,dsFeature:"graphStore",isManagedData:!1,category:"database",factory:"nosql",provider:"ArangoDB",implementation:"ArangoDB",purposes:["knowledge-graph"],connectionProperties:{hosts:[],useSsl:e.useSsl,username:e.username,password:e.password,database:e.database}}};return""!==e.hosts?t.info.connectionProperties.hosts=e.hosts.split(","):delete t.info.connectionProperties.hosts,t}const r={type:"nosql",path:`/nosqlDatabases/${t}`,info:{provider:"Neo4J",isManaged:!1,dsFeature:"graphStore",factory:"nosql",implementation:"Neo4j",category:"database",systemManaged:!1,isManagedData:!1,purposes:["knowledge-graph"],connectionProperties:{connectionUri:e.connectionUri,username:e.username,password:e.password,database:e.database,fallbackServerAddresses:[]}}};return""!==e.fallBackServers?r.info.connectionProperties.fallbackServerAddresses.push(e.fallBackServers.split(",")):delete r.info.connectionProperties.fallbackServerAddresses,r}function l(e,t){const r="bdfs"===e.addDataStoreType?e.bdfsCloudProvider:e.provider,a={info:{}},n={credentialType:"accesskey"};return"amazon"===r&&("accessKey"===e.credentialType?(n.accessKeyId=e.accessKey,n.secretAccessKey=e.secretKey):n.credentialType=e.credentialType,"custom"===e.selectedRegion.id?n.regionEndpointUrl=e.storageURL:(n.regionEndpointUrl=y(e.regions,e.selectedRegion),n.region=e.selectedRegion.id),a.info.objectStore=e.bucketName,a.provider="amazon"),"google"===r&&(n.accessKeyId=e.accessKey,n.secretAccessKey=e.secretKey,n.regionEndpointUrl="https://storage.googleapis.com",a.info.objectStore=e.bucketName,a.provider="Google"),"azure"===r&&("sharedKey"===e.azureAuthenticationType?(n.credentialType="accessKey",n.accountKey=e.accountKey):"activeDirectory"===e.azureAuthenticationType?(n.credentialType=e.azureIdentityType,"servicePrincipal"===e.azureIdentityType?(n.tenantId=e.tenantId,n.clientId=e.clientId,n.clientSecret=e.clientSecret):"userAssignedIdentity"===e.azureIdentityType&&(n.managedIdentityClientId=e.clientId)):"sasToken"===e.azureAuthenticationType?(n.credentialType=e.azureAuthenticationType,n.sasToken=e.token):"anonymous"===e.azureAuthenticationType&&(n.credentialType=e.azureAuthenticationType),"other"===e.environment.id||"anonymous"===e.azureAuthenticationType?n.regionEndpointUrl=e.endpoint:n.accountEndpoint=y(e.regions,e.environment),n.accountName=e.accountName,a.info.objectStore=e.containerName,a.provider="azure"),"azuredatalakegen2store"===r&&("other"===e.environment.id?n.regionEndpointUrl=e.endpoint:n.accountEndpoint=y(e.regions,e.environment),n.credentialType="accessKey",n.accountKey=e.accountKey,a.info.folder=e.cloudFolder?`${e.containerName}/${e.cloudFolder}`:e.containerName,n.accountName=e.accountName,a.provider="azureDataLakeStore"),"alibaba"===r&&(n.accessKeyId=e.accessKey,n.secretAccessKey=e.secretKey,a.info.objectStore=e.bucketName,a.provider="Alibaba",n.regionEndpointUrl="custom"===e.selectedRegion.id?e.storageURL:y(e.regions,e.selectedRegion)),n.defaultEndpointsProtocol="https",e.cloudFolder&&"azuredatalakegen2store"!==r&&(a.info.objectStore=a.info.objectStore+"/"+e.cloudFolder),a.type="cloudStore",a.path="/cloudStores/"+t,a.info.connectionString=JSON.stringify(n),a}function u(e,t){return{type:"bigDataFileShare",path:`/bigDataFileShares/${t}`,info:{connectionString:JSON.stringify({path:e.bdfsFilesharePath}),connectionType:"fileShare"}}}function p(e,t){return{type:"bigDataFileShare",path:`/bigDataFileShares/${t}`,info:{connectionString:JSON.stringify({path:e.bdfsHdfsPath,username:e.bdfsHdfsUsername}),connectionType:"hdfs"}}}function f(e,t){const r={type:"bigDataFileShare",path:"/bigDataFileShares/"+t,info:{connectionString:"",connectionType:"hive"}},a=e.useNonDefaultDatabase;return r.info.connectionString=JSON.stringify({metaStoreUris:e.metastoreUris,database:a&&e.nonDefaultDatabaseName||"default"}),r}function h(e,t){return JSON.stringify({info:{connectionString:JSON.stringify({path:t}),connectionType:"dataStore"},path:`/bigDataFileShares/${e}`,type:"bigDataFileShare"})}function y(e,t){let r;return e.forEach((function(e){e.id===t.id&&(r=e.blobStoreEndpoint||e.storageEndpointSuffix)})),r}const g=async(e,t)=>{const r=e.results.out_connectionString.paramUrl,n=`${t}/Get%20Database%20Connection%20String/jobs/${e.jobId}/${r}`,o=await(0,a.r)(n);return v(o)},v=e=>{const t=e.value;return{connectionStringProps:m(t),connectionString:t}},m=e=>{let t=[];return e&&e.split(";").forEach((e=>{const r=e.split("=");2!==r.length||S(t,r[0])||t.push({key:r[0],value:r[1]})})),t},S=(e,t)=>e.some((e=>e.key===t)),b=()=>{var e;const t=n.c.portal,r=t.portalDeploymentType||(null===(e=t.sourceJSON)||void 0===e?void 0:e.portalDeploymentType);return t.isPortal&&"ArcGISEnterpriseOnKubernetes"===r},w=e=>e?`${e}/rest/services/System/PublishingTools/GPServer`:""},77429:(e,t,r)=>{r.d(t,{a:()=>k,b:()=>T,c:()=>S,d:()=>w,e:()=>h,f:()=>v,g:()=>f,h:()=>y,p:()=>p,r:()=>N,v:()=>m});var a=r(70392),n=r(67148),o=r(46710),s=r(88703),i=r(57983),c=r(52299),d=r(12856),l=r(66913);const u=async(e,t)=>{var r;const n=o.c.portal,s=`${(0,a.g)(n)}portals/${n.id}/jobs/${encodeURIComponent(e)}/?key=${encodeURIComponent(t)}`;try{return{result:await(0,l.p)(s,{pendingStatuses:["processing","submitted"],successStatuses:["succeeded"]},"post")}}catch(e){console.error(e);const t=null===(r=e.messages)||void 0===r?void 0:r[0];return(null==t?void 0:t.includes("ERROR 000623"))?{error:{code:"invalidDataStorePublishType"}}:{error:{code:"unhandledError",message:JSON.stringify(e)}}}},p=async(e,t,r)=>{var n;try{const{folder:o,type:s,cacheStoreId:i,serviceName:f,pathInCachedStore:h,description:y,serverId:g,tags:v}=e;let m;switch(s){case"i3sRestCache":case"extractedScenePackage":m="SceneServer";break;case"vectorCacheDataset":m="VectorTileServer";break;case"cacheDataset":m=r?"ImageServer":"MapServer"}const S={serviceConfiguration:JSON.stringify({type:m,serviceName:f,properties:{pathInCachedStore:h,cacheStoreId:i}}),serverId:g,tags:v,f:"json"},b=`${(0,a.g)()}portals/self/datastores/publish`,{jobId:w,key:D}=await(0,l.r)(b,S,{},"post"),{error:T,result:N}=await u(w,D);if("invalidDataStorePublishType"===(null==T?void 0:T.code))return"cacheDataset"===e.type?p(e,t,!0):{error:{code:"invalidDataStorePublishType",message:JSON.stringify(T.message)}};if(T)return{error:{code:"failToPublishFromDataStore",message:JSON.stringify(T.message)}};const _=null===(n=null==N?void 0:N.result)||void 0===n?void 0:n.services[0];(0,c.o)(o)||await(0,d.m)(_.serviceItemId,o.id);const I={snippet:y,f:"json"};return await(0,d.u)(_.serviceItemId,I),{result:_}}catch(e){return console.error(e),{error:{code:"failToPublishFromDataStore",message:JSON.stringify(e)}}}},f=async(e,t,r,n)=>{const s=o.c.portal,i=`${(0,a.g)(s)}portals/${s.id}/datastores/describe`,c={datastoreId:e,serverId:n,path:t,type:r,f:"json"};try{const{jobId:e,key:t}=await(0,l.r)(i,c,{},"post"),{result:r}=await u(e,t);return{result:r.result}}catch(e){return console.error(e),{error:{code:"failToListDataStoreContents",message:JSON.stringify(e)}}}},h=async(e,t)=>{const r=o.c.portal,n=`${(0,a.g)(r)}portals/${r.id}/datastores/validate`,s={datastoreId:t,serverId:e.id,f:"json"};try{const{status:e}=await(0,l.r)(n,s,{},"post");return{result:e}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}},y=async(e,t,r)=>{let a;try{const{result:n}=await(0,l.a)(e,t,{},"post").then((e=>{if("success"===e.status)return a=e.item.itemName,g(e.item,r)}));return{result:Object.assign(Object.assign({},n),{itemName:a})}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}},g=async(e,t)=>{const r=(0,i.k)(t),a=`${r}/Get%20Database%20Connection%20String/submitJob`,n={in_inputData:e.itemID,in_connDataType:"UPLOADED_CONNECTION_FILE_ID"};try{const{jobId:e,jobStatus:t}=await(0,l.r)(a,n,{},"post");if("esriJobSubmitted"===(t||"")){const a=`${r}/Get%20Database%20Connection%20String/jobs/${e}`,n=await(0,l.p)(a,{requestParams:{jobId:e,jobStatus:t},pendingStatuses:["esriJobNew","esriJobSubmitted","esriJobWaiting","esriJobExecuting"],successStatuses:["esriJobSucceeded"]});return{result:await(0,i.g)(n,r)}}return{result:null}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}},v=async e=>{const t={useProxy:!0};try{const r=await(0,l.r)("https://esriresources.s3.amazonaws.com/1120/regionsforcloudstorage.dat",{},t);let a;return"amazon"===e?a=r.Amazon.regions:"azure"===e||"azuredatalakegen2store"===e?a=r.environments:"alibaba"===e?a=r.Alibaba.regions:"google"===e&&(a=r.Google.regions),{result:a}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}},m=async(e,t,r)=>{var a;const o=`${t.helperServices.datastoreManagement.url}/${e}/data/validateDataItem`,s=JSON.stringify(r);try{return{result:await(0,n.r)(o,t,{body:{item:s,f:"json"},usePost:!0})}}catch(e){console.error("Data Store validation error",e);const t=[["incorrect username or password","invalidUsernameOrPassword"],["connectionUrl is invalid","invalidSnowflakeServer"],["The requested warehouse does not exist or not authorized","invalidSnowflakeWarehouse"],["The requested database does not exist or not authorized","invalidSnowflakeDatabase"],["The requested schema does not exist or not authorized","invalidSnowflakeSchema"],["specified in the connect string does not exist or not authorized","invalidSnowflakeRole"],["has not enabled BigQuery","invalidBigQueryProjectId"],["private_key must be specified","invalidCredentials"],["JDBCConnection is invalid","invalidConnection"],["AWS Access Key ID you provided does not exist","invalidCredentials"],["The request signature we calculated does not match the signature you provided.","invalidCredentials"],["The specified bucket does not exist","invalidAWSBucket"],["No such host is known","invalidConnection"],["Server failed to authenticate the request","invalidCredentials"],["accountEndpoint must be specified","invalidConnection"],["Container","invalidAzureContainer"]];let r=(null===(a=JSON.stringify(e))||void 0===a?void 0:a.toLowerCase())||"";for(const[e,a]of t)if(r.includes(e.toLowerCase()))return{error:{code:a}};return{error:{code:"unhandledError"}}}},S=async(e,t,r)=>{const a=await Promise.all(t.map((t=>b(e,t,r))));return t.map(((e,t)=>{var r,n,o,s,i,c;const d=a[t],l=null===(r=null==d?void 0:d.machines)||void 0===r?void 0:r[0],u=null===(n=null==l?void 0:l.dataItems)||void 0===n?void 0:n[0];return!(null==d?void 0:d.status)||"success"!==(null==d?void 0:d.status)&&(null==l?void 0:l.machine.toLowerCase())!==e.name.toLowerCase().split(":")[0]?Object.assign(Object.assign({},e),{serverStatus:"error",errorMsg:(null===(c=null==d?void 0:d.error)||void 0===c?void 0:c.message)&&JSON.parse(d.error.message).message||(null==u?void 0:u.message),error:null==u?void 0:u.error}):Object.assign(Object.assign({},e),{serverStatus:(null==d?void 0:d.status)||(null===(o=null==d?void 0:d.machines[0])||void 0===o?void 0:o.status),errorMsg:"error"===(null==l?void 0:l.status)&&(null===(s=null==d?void 0:d.error)||void 0===s?void 0:s.message)&&JSON.parse(null===(i=null==d?void 0:d.error)||void 0===i?void 0:i.message).message||(null==u?void 0:u.message),error:null==u?void 0:u.error})}))},b=async(e,t,r)=>{let n;const s=e.bdfsType;let c=null;"bdfs"===r?"fileshare"===s?n=(0,i.c)(e):"hdfs"===s?n=(0,i.a)(e):"hive"===s?n=(0,i.b)(e):"cloud"===s&&("new"===e.bdfsCloudType?(n=(0,i.d)(e),n.info.isManaged=!1):c={serverId:t.id,datastoreId:e.bdfsExistingDatastore.id,f:"json"}):("folder"===r?n=(0,i.e)(e):"database"===r?n=(0,i.f)(e):"cloud"===r?n=(0,i.d)(e):"nosql"===r&&(n=(0,i.h)(e)),n.info.isManaged=!1);const d=o.c.portal,u=`${(0,a.g)(d)}portals/${d.id}/datastores/validate`;c=!c&&e.allowServicesRestart?{datastore:JSON.stringify(n),serverId:t.id,options:JSON.stringify({allowServicesRestart:!0}),f:"json"}:{datastore:JSON.stringify(n),serverId:t.id,f:"json"};try{const{status:e,machines:t}=await(0,l.r)(u,c,{},"post");return{status:e,machines:t}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}},w=async e=>{let t=[],r=e;if((0,i.i)()){const e=[];r.forEach((r=>{if(r.isHosted){const e={name:r.adminUrl,type:"Linux"};t.push(e)}else"FEDERATED_SERVER"===r.serverRole&&e.push(r)}));const a=await Promise.allSettled(e.map((e=>{const t=`${e.adminUrl}/admin/machines?f=json`;return(0,l.r)(t,{},{},"post")})));await Promise.allSettled(a.map((e=>{var a;return _(null===(a=null==e?void 0:e.value)||void 0===a?void 0:a.machines,r).then((e=>{t=[...t,...e]}))})))}else{const e=await Promise.allSettled(r.map((e=>{const t=`${e.adminUrl}/admin/machines?f=json`;return(0,l.r)(t,{},{},"post")})));await Promise.allSettled(e.map((e=>{var a;return D(null===(a=null==e?void 0:e.value)||void 0===a?void 0:a.machines,r).then((e=>{r=[...e.serverList],t=e.serverTypes}))})))}return{servers:r,serverTypes:t}},D=async(e,t)=>{let r=[];t.map(((t,r)=>{(null==e?void 0:e[r])?t.shouldFilter=!1:t.shouldFilter=!0})),t.filter((e=>!e.shouldFilter));for(let a=0;a<t.length;a++){const n=e[0].machineName,o=`${e[0].adminURL}/machines/${n}?f=json`;await(0,l.r)(o,{},{},"post").then((e=>{if(e){const n={name:t[a].adminUrl,type:e.platform.indexOf("Windows")>-1?"Windows":"Linux"};r.push(n)}}))}return{serverTypes:r,serverList:t}},T=async()=>{const e={q:`orgid:${o.c.user.orgId} type:"Data Store"`,num:1e4},t=`${(0,a.g)()}search`,r=["cloudStore_amazon","cloudStore_azure","cloudStore_azuredatalakegen2store","cloudStore_azureDataLakeStore"];try{const a=[],{results:n}=await(0,l.r)(t,e);return null==n||n.forEach((({id:e,title:t,type:n,typeKeywords:o})=>{!o.includes("bigDataFileShare")&&o.some((e=>r.includes(e)))&&a.push({id:e,title:t,type:n,typeKeywords:o})})),{result:a}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}},N=async e=>{const t=`${(0,a.g)()}content/items/${e}/data`;try{const{id:e,path:r,provider:a}=await(0,l.r)(t);return{id:e,path:r,provider:a}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}},_=async(e,t)=>{let r=[];return await Promise.all(t.map(((a,n)=>{if(!a.isHosted){const a=e[0].machineName,o=`${e[0].adminURL}/machines/${a}?f=json`;return(0,l.r)(o,{},{},"post").then((e=>{if(!e.isHosted){const a={name:t[n].adminUrl,type:e.platform.indexOf("Windows")>-1?"Windows":"Linux"};r.push(a)}}))}}))),r},I=async(e,t,r,n,c,d)=>{const{portal:u}=o.c,p=`${(0,a.g)(u)}portals/${u.id}`,f=t.dataStoreSelectedServers,h=await Promise.all(f.map((r=>{const a={serverId:r,datastoreId:e.id};(0,i.i)()&&"folder"===t.addDataStoreType&&t.allowServicesRestart&&(a.options=JSON.stringify({allowServicesRestart:!0}));const n=`${p}/datastores/addToServer`;return(0,l.r)(n,a,{},"post")})));let y={success:!1,id:null,folder:null};for(const o of h)if(o.success){if("bdfs"===t.addDataStoreType&&"cloud"===t.bdfsType&&"new"===t.bdfsCloudType)return y=await P(t,r,n,c,d,e.id),y;if(["folder","database","nosql","cloud"].includes(t.addDataStoreType))y={success:!0,id:e.id,folder:e.id};else{const t=async()=>{const r=`${(0,a.g)()}content/items/${e.id}/relatedItems`,n=await(0,l.r)(r,{relationshipType:"BDFSDataStore2BDFSCatalogService",direction:"forward"});return n.total?(y={success:!0,id:n.relatedItems[0].id,folder:e.id},y):(await(0,s.t)(1e4),t())};y=t()}}return y},P=async(e,t,r,n,s,d,u)=>{const p=`${(0,a.g)()}content/items/${d}/data`,f=await(0,l.r)(p),h=u||f.path,y=h.split("/")[2].split("_")[0],g={type:"Data Store",title:t||y,tags:r,categories:n,snippet:s,text:""};g.text=(0,i.j)(g.title,h),e.addDataStoreType="bdfsDataStore";let v=await(0,c.q)(g,null);return v.success&&o.c.portal.isPortal&&(v=await I(v,e)),v},k=async(e,t,r,a,n)=>{const s=e.addDataStoreType,d={type:"Data Store",title:t,tags:r,categories:a,snippet:n,text:"",typeKeywords:e.typeKeywords};let l;const u=e.bdfsType;if("bdfs"===s){if("fileshare"===u)l=(0,i.c)(e,t);else if("hdfs"===u)l=(0,i.a)(e,t);else if("hive"===u)l=(0,i.b)(e,t);else if("cloud"===u){if("new"!==e.bdfsCloudType)return await P(e,t,r,a,n,e.bdfsExistingDatastore.id,e.bdfsExistingDatastore.path);l=(0,i.d)(e,t),l.info.isManaged=!1}}else"folder"===s?l=(0,i.e)(e,t):"database"===s?l=(0,i.f)(e,t):"cloud"===s?l=(0,i.d)(e,t):"nosql"===s&&(l=(0,i.h)(e,t)),l.info.isManaged=!1;d.text=JSON.stringify(l);let p=await(0,c.q)(d,null);return p.success&&o.c.portal.isPortal&&(p=await I(p,e,t,r,a,n)),p}}}]);
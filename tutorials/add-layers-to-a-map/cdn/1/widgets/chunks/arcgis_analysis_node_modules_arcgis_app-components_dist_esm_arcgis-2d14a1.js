/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2d14a1.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-2d14a1"],{38909:(e,t,i)=>{i.r(t),i.d(t,{arcgis_new_item_pages_append_select:()=>h});var o=i(35110),a=i(82669),n=i(24147),s=i(84873),r=i(46710),l=i(88703),d=i(34160),c=i(74504),p=i(64031),m=i(52299);i(23505),i(38477),i(30007),i(91659),i(56086),i(66913),i(21104),i(73838),i(70392),i(12856),i(91306),i(17752),i(73208),i(35105),i(16082),i(67148),i(79233),i(64307),i(76743),i(63280),i(9657),i(53040),i(51287),i(20982),i(37526),i(7803);const h=class{constructor(e){(0,o.r)(this,e),this.newItemUpdatePage=(0,o.c)(this,"newItemUpdatePage",7),this.newItemToggleNavigationEnabled=(0,o.c)(this,"newItemToggleNavigationEnabled",7),this.workflowComplete=(0,o.c)(this,"workflowComplete",7),this.insertOnly=!1,this.isCloudItem=!1,this.isUrlItem=!1,this.options={add:{icon:"add-features",updateType:"add",hidden:!1,disabled:!1},update:{icon:"update-features",updateType:"update",hidden:!1,disabled:!1},upsert:{icon:"add-and-update-features",updateType:"upsert",hidden:!1,disabled:!1},overwrite:{icon:"overwrite-features",updateType:"overwrite",hidden:!1,disabled:!1}},this.selected="add",this.error=void 0,this.loading=!1,this.loaderType="indeterminate",this.loaderMessage=void 0}handleNext(){let e;const{item:t,selected:i,layer:o,layerId:n,appendLayerEntry:s}=this;if(a.a.addAppendSelectOption=i,!s&&"overwrite"!==i&&t.layers.length>1)e="appendSelectLayer";else{if(t.cloudProviderInfo&&"overwrite"===i){if(a.a.newItemMode="file",t.cloudProviderInfo.cloudProvider){const{id:e,mimeType:i,zipItemType:o,cloudProvider:a}=t.cloudProviderInfo;return this.assignCloudItemStore(t.cloudProviderInfo),void this.handleOverwriteURL(t,e,i,o,a)}return void this.handleOverwriteURL(t)}if(s){let e=null!=o?o:t.layers[n];e||(e=t.layers[0]),a.a.sourceDataLayer=e}else a.a.sourceDataLayer=t.layers[0];e="appendUpload"}this.newItemUpdatePage.emit(e)}createOptions(){var e,t;const i=this.item,o=!1===i.serviceInfo.sourceSchemaChangesAllowed,a=!i.sourceData&&!i.cloudProviderInfo,n="GeoPackage"===(null===(e=i.sourceData)||void 0===e?void 0:e.type)&&r.c.portal.isPortal;(-1!==(r.c.portal.isPortal&&!i.isSDS?i.serviceInfo.capabilities:i.adminServiceInfo.capabilities).indexOf("ChangeTracking")||i.serviceInfo.syncEnabled)&&(this.insertOnly=!0,this.options.overwrite.disabled=!0,this.options.update.disabled=!0,this.options.upsert.disabled=!0),(this.appendLayerEntry||n||"Service Definition"===(null===(t=i.sourceData)||void 0===t?void 0:t.type)||a||o)&&(this.options.overwrite.disabled=!0)}createOverwriteNextText(){switch(!0){case this.isCloudItem:return"signInAndOverwrite";case this.isUrlItem:return"overwriteAndComplete";default:return"next"}}async componentWillLoad(){var e,t,i,o,n,r,l,d,c,p,m,h,u;this.selected=a.a.addAppendSelectOption||"add",this.i18n=s.u.i18n.appendSelect,this.item=a.a.existingItem,this.appendLayerEntry=void 0!==a.a.layerId||!!a.a.sublayer,this.layerId=a.a.layerId,this.layer=a.a.sublayer,this.item&&(a.a.id=null,a.a.dateFieldsTimeReference=null!==(l=null!==(i=null===(t=null===(e=this.item)||void 0===e?void 0:e.publishParameters)||void 0===t?void 0:t.dateFieldsTimeReference)&&void 0!==i?i:null===(r=null===(n=null===(o=this.item)||void 0===o?void 0:o.publishParameters)||void 0===n?void 0:n.layers)||void 0===r?void 0:r[0].dateFieldsTimeReference)&&void 0!==l?l:null===(c=null===(d=this.item)||void 0===d?void 0:d.layers)||void 0===c?void 0:c[0].dateFieldsTimeReference,this.isUrlItem=!!(null===(m=null===(p=this.item)||void 0===p?void 0:p.cloudProviderInfo)||void 0===m?void 0:m.url),this.isCloudItem=!!(null===(u=null===(h=this.item)||void 0===h?void 0:h.cloudProviderInfo)||void 0===u?void 0:u.cloudProvider),this.createOptions())}assignCloudItemStore(e){const{cloudProvider:t,id:i,mimeType:o,cloudDriveFileName:n,cloudFileType:s,zipItemType:r}=e;a.a.cloudProvider=(0,d.d)(t),a.a.cloudProviderResource={cloudProvider:t,id:i,mimeType:o,cloudDriveFileName:n,cloudFileType:s,zipItemType:r}}async setUpCloud(e){const t=(0,d.e)(e),{result:i,error:o}=await(0,p.g)(t);return o?(this.handleError(),null):i}async handleOverwriteURL(e,t,i,o,h){var u,v,g,w,f,x,y;let T,I,b;this.loading=!0,this.loaderMessage=s.u.i18n.append.appendLoadingMessages.overwriting;const $=e.cloudProviderInfo;if(a.a.fileName=e.title,a.a.title=e.title,$.cloudProvider){I="zip"===i?o:n.A[i],b=[a.a.type];const e=await this.setUpCloud(h);switch(await(0,l.t)(200),h){case"googleConnect":T=(0,d.f)(t,i,e);break;case"dropBoxConnect":T=(0,d.i)(t,e);break;case"oneDriveConnect":T=(0,d.h)(t,e)}}else{"geojson"===$.mimeType?a.a.geoJSONResource={fileName:$.fileName,url:$.url,mimeType:$.mimeType}:a.a.csvResource={fileName:$.fileName,url:$.url,mimeType:$.mimeType};const e=null!==(u=a.a.csvResource)&&void 0!==u?u:a.a.geoJSONResource;I=n.A[e.mimeType],T=e.url,b=[I]}a.a.dataUrl=T,a.a.type=I,a.a.typeKeywords=b,a.a.overwrite=!0;try{this.newItemToggleNavigationEnabled.emit(!1),await(0,m.w)();const t=await(0,p.a)(e,r.c.portal,r.c.user,a.a.id),i=await(0,c.p)({itemId:null!==(g=null===(v=null==e?void 0:e.sourceData)||void 0===v?void 0:v.id)&&void 0!==g?g:e.id,user:r.c.user,title:(null==e?void 0:e.title)||"",itemOwnerUrl:e.itemOwner.userContentUrl},t);await(0,p.u)(t.publishParameters,e,null===(f=null===(w=i.result)||void 0===w?void 0:w.services)||void 0===f?void 0:f[0].serviceItemId),await this.checkStatus({itemId:e.id,jobId:null===(y=null===(x=i.result)||void 0===x?void 0:x.services)||void 0===y?void 0:y[0].jobId},null==i?void 0:i.result)}catch(e){this.handleError()}}async checkStatus(e,t){var i;this.loaderMessage=s.u.i18n.append.appendLoadingMessages.overwriting,this.newItemToggleNavigationEnabled.emit(!0);const o=await(0,m.v)(e.itemId,{jobId:e.jobId}),n=null==o?void 0:o.status,r=Object.assign({id:null===(i=null==t?void 0:t.services)||void 0===i?void 0:i[0].serviceItemId,item:Object.assign({},a.a),overwriteStatus:n,appendType:a.a.addAppendSelectOption},t);return"completed"===(null==o?void 0:o.status.toLowerCase())?(r.overwriteStatus=null==o?void 0:o.status,this.workflowComplete.emit(r),null):("failed"===(null==o?void 0:o.status.toLowerCase())&&this.handleError(),o)}handleError(){s.u.nextText="next",this.newItemToggleNavigationEnabled.emit(!0),this.loading=!1,this.error={title:s.u.i18n.error,description:s.u.i18n.appendUpload.errors.errorWhileUpload}}render(){const{i18n:e,options:t,insertOnly:i,error:a,loaderType:n,loading:r,loaderMessage:l}=this;return(0,o.h)(o.H,{class:{"overflow-hidden":r}},(0,o.h)("arcgis-new-item-loader",{type:n,active:r,text:l}),(0,o.h)("div",{class:"header"},i?e.insertOnlyEnabled:e.chooseUpdate),(0,o.h)("div",{class:"tile-select"},Object.keys(t).map((i=>{const{icon:a,hidden:n,disabled:r}=t[i];return(0,o.h)("calcite-tile-select",{key:i,checked:this.selected===i,heading:e.options[i].title,icon:a,name:"append-select-update",width:"full",type:"radio",value:i,class:"tile-card",hidden:n,disabled:r,inputEnabled:!0,onCalciteTileSelectChange:e=>{this.selected=e.target.value,s.u.nextText="overwrite"===this.selected?this.createOverwriteNextText():"next"}})}))),(0,o.h)("arcgis-new-item-alert",{heading:null==a?void 0:a.title,description:null==a?void 0:a.description,active:!!a,onAlertDismiss:()=>this.error=null}))}get el(){return(0,o.d)(this)}};h.style=".tile-select{margin-right:0.75rem;margin-left:0.75rem;margin-top:1rem;display:grid;padding-bottom:6rem;font-size:1.125rem}@media (min-width: 480px){.tile-select{grid-template-columns:repeat(2, 1fr)}}.tile-card:hover{--tw-shadow:0 4px 16px 0 rgba(0, 0, 0, 0.08), 0 2px 8px 0 rgba(0, 0, 0, 0.04);--tw-shadow-colored:0 4px 16px 0 var(--tw-shadow-color), 0 2px 8px 0 var(--tw-shadow-color);box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.header{margin-left:0.75rem;font-size:1rem;font-weight:500}.insert-only-info{margin-left:0.75rem;font-size:0.75rem;font-weight:500;color:var(--calcite-color-text-1)}"},34160:(e,t,i)=>{i.d(t,{a:()=>y,b:()=>l,c:()=>r,d:()=>I,e:()=>T,f:()=>v,g:()=>x,h:()=>w,i:()=>p});var o=i(46710);function a(e,t,i,o,a){return new Promise(((n,s)=>{const r=new XMLHttpRequest;r.open(e,t,!1),o&&r.setRequestHeader("Authorization",o),a&&r.setRequestHeader("Content-type",a),i?r.send(i):r.send();const l=JSON.parse(r.responseText);r.status>=400&&s(JSON.parse(r.responseText)),n(l)}))}function n(e,t){return new Promise(((i,o)=>{t=t.replace(/[[]/,"[").replace(/[]]/,"]");const a=new RegExp(`[?&#]${t}=([^&#]*)`).exec(e);null==a?o("InvalidToken"):i(a[1])}))}function s(e,t){return new Promise(((i,o)=>{const a=`${window.location.protocol}//${window.location.hostname}`,n=`https://${t}/home/cloudDriveOauth-callback.html?cloudUrl=${e}&currentSourceUrl=${a}&portalHostName=${t}`,s=document.createElement("iframe");s.src=n,s.className="hide",document.body.appendChild(s);const r=window.addEventListener?"addEventListener":"attachEvent";(0,window[r])("attachEvent"===r?"onmessage":"message",(e=>{e.origin===`https://${t}`&&("popupBlocked"!==e.data&&"windowClosed"!==e.data||o(e.data),i(e.data))}),!1)}))}const r={csv:"file-csv",excel:"file-excel",zip:"file-zip",geojson:"file-code",sheet:"file-report",cad:"file-cad",gpx:"file-gpx",png:"file-image",jpg:"file-image",jpeg:"file-image",tiff:"file-image",gif:"file-image",pdf:"file-pdf",docx:"file-word"},l={csv:"CSV",excel:"Excel",zip:"Zip File",geojson:"GeoJSON",googlesheets:"Google Sheets",cad:"CAD",gpx:"GPX",png:"Image",jpg:"Image",jpeg:"Image",tiff:"Image",gif:"Image",pdf:"PDF",docx:"Microsoft Word",pptx:"Microsoft PowerPoint"},d={csv:".csv",excel:".xls",zip:".zip",geojson:".geojson",googlesheets:""};function c(e){const t=e.split("."),i=t[t.length-1].toLowerCase();return{xls:"excel",xlsx:"excel",csv:"csv",zip:"zip",geojson:"geojson",json:"geojson"}[i]||i}function p(e,t){return`https://content.dropboxapi.com/2/files/download?httpHeaders={"Authorization":"Bearer&#32;${t}","Dropbox-API-Arg":"{\\"path\\":\\"${e}\\"}"}`}class m{constructor(){this.nextStart=0}async connect(){const{config:e,portal:t}=o.c,i=`dropbox${Math.floor(Date.now()/1e3)}`,a=document.documentElement.lang||"en-US",r=`https://www.dropbox.com/oauth2/authorize?redirect_uri=https://${t.portalHostname}/home/cloudDriveOauth-callback2.html&response_type=token&client_id=${e.dropboxClientId}&locale=${a}&state=${i}`;return new Promise((async(e,o)=>{try{const a=await s(r,t.portalHostname),l=await n(a,"state");i!==l&&o("invalidState");const d=await n(a,"access_token");this.token=d,e(d)}catch(e){o(e)}}))}search(e={}){const{token:t}=this;return new Promise((async i=>{const{searchText:o,dropdownFilter:n,next:s}=e,r=`Bearer ${t}`,l=o?` ${o}`:"",p=s?this.nextStart:0;let m=d[n];"excel"===n&&(m="xls");const h=`{"path":"","query":"${l} ${m}","mode": "filename","max_results":10,"start":${p}}`,u=await a("POST","https://api.dropboxapi.com/2/files/search",h,r,"application/json");this.nextStart=u.start,i({files:u.matches.filter((e=>{var t;return"file"===(null===(t=e.metadata)||void 0===t?void 0:t[".tag"])})).map((({metadata:{id:e,name:i,size:o}})=>({id:e,name:i,mimeType:c(i),downloadUrl:`https://content.dropboxapi.com/2/files/download?httpHeaders={"Authorization":"Bearer&#32;${t}","Dropbox-API-Arg":"{\\"path\\":\\"${e}\\"}"}`,size:o}))),next:!!u.more})}))}}function h(e){return e.indexOf("spreadsheetml.sheet")>-1||e.indexOf("ms-excel")>-1?"excel":e.indexOf("application/zip")>-1?"zip":e.indexOf("application/octet-stream")>-1||e.indexOf("application/json")>-1?"geojson":e.indexOf("google-apps.spreadsheet")>-1?"googlesheets":e.indexOf("text/csv")>-1?"csv":"zip"}const u={csv:'(mimeType="text/csv")',excel:'(mimeType="application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"ormimeType="application/vnd.ms-excel")',zip:'(mimeType="application/x-zip-compressed"ormimeType="application/zip")',geojson:'(name contains "json" or name contains "geojson")and(mimeType="application/octet-stream"ormimeType="application/json")',googlesheets:'(mimeType="application/vnd.google-apps.spreadsheet")'};function v(e,t,i){const o=`https://www.googleapis.com/drive/v3/files/${e}`,a=`&httpHeaders={"Authorization":"Bearer&#32;${i}"}`,n=`${o}/export?mimeType=application/vnd.openxmlformats-officedocument.spreadsheetml.sheet${a}`,s=`${o}?alt=media${a}`;return t.indexOf("google-apps")>-1||t.indexOf("googlesheets")>-1?n:s}class g{async connect(){return new Promise((async(e,t)=>{const{config:i,portal:a}=o.c,r=a.portalHostname,l=document.documentElement.lang||"en-US",d=`google${Math.floor(Date.now()/1e3)}`,c=`https://accounts.google.com/o/oauth2/v2/auth?scope=https://www.googleapis.com/auth/drive.readonly&redirect_uri=https://${r}/home/cloudDriveOauth-callback2.html&response_type=token&client_id=${i.googleClientId}&hl=${l}&state=${d}`;try{const i=await s(c,r);d!==await n(i,"state")&&t("invalidState"),this.token=await n(i,"access_token"),e(this.token)}catch(e){t(e)}}))}async search(e={}){return new Promise((async t=>{const{searchText:i,next:o,dropdownFilter:n}=e,s=`https://www.googleapis.com/drive/v3/files?access_token=${this.token}&pageSize=10&fields=incompleteSearch,nextPageToken,files(id,kind,mimeType,name)&q=${i?`name contains '${i}' and trashed = false and`:"trashed = false and"}${u[n]}${o?`&pageToken=${this.nextToken}`:""}`,r=await a("GET",s,null,null,"application/json");this.nextToken=r.nextPageToken,t({files:r.files.map((({id:e,name:t,mimeType:i})=>({id:e,name:t,mimeType:h(i),downloadUrl:v(e,i,this.token)}))),next:!!r.nextPageToken})}))}}function w(e,t){return`https://graph.microsoft.com/v1.0/me/drive/items/${e}/content?httpHeaders={"Authorization":"Bearer&#32;${t}"}`}class f{async connect(){return new Promise((async(e,t)=>{const{config:i,portal:a}=o.c,r=a.portalHostname,l=document.documentElement.lang||"en-US",d=`onedrive${Math.floor(Date.now()/1e3)}`,c=`https://login.microsoftonline.com/common/oauth2/v2.0/authorize?scope=files.read&redirect_uri=https://${r}/home/cloudDriveOauth-callback2.html&response_type=token&client_id=${i.oneDriveClientId}&locale=${l}&state=${d}`;try{const i=await s(c,r);d!==await n(i,"state")&&t("invalidState"),this.token=await n(i,"access_token"),e(this.token)}catch(e){t(e)}}))}search(e={}){return new Promise((async t=>{const{searchText:i,dropdownFilter:o,next:n}=e,s=`Bearer ${this.token}`,r=`https://graph.microsoft.com/v1.0/me/drive/root/search(q='${i||""} ${d[o]||""}')?select=name,id,file,size&top=10`,l=n?this.nextLink:r,p=await a("GET",l,null,s,"application/json");this.nextLink=p["@odata.nextLink"],t({files:p.value.map((({size:e,id:t,name:i})=>({size:e,id:t,name:i,mimeType:c(i),downloadUrl:`https://graph.microsoft.com/v1.0/me/drive/items/${t}/content?httpHeaders={"Authorization":"Bearer ${this.token}"}`}))),next:!!p["@odata.nextLink"]})}))}}function x(e){return new{dropbox:m,"google drive":g,onedrive:f}[e]}function y(e){return{dropbox:"dropBoxConnect","google drive":"googleConnect",onedrive:"oneDriveConnect"}[e]}function T(e){return new{dropBoxConnect:m,googleConnect:g,oneDriveConnect:f}[e]}function I(e){return{dropBoxConnect:"dropbox",googleConnect:"google drive",oneDriveConnect:"onedrive"}[e]}}}]);
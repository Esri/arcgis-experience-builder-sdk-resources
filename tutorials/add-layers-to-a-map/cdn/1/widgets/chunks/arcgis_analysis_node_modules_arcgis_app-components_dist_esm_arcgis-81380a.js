/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-81380a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-81380a"],{6531:(i,t,a)=>{a.r(t),a.d(t,{arcgis_item_classification:()=>o});var s=a(35110),e=a(1984),l=a(59306),n=a(46710);a(63280),a(86587),a(21104),a(73838),a(66913),a(70392),a(23505);const o=class{constructor(i){(0,s.r)(this,i),this.orgClassificationType=null,this.orgItemClassificationValue=null,this.retrieveClassificationSchema=async()=>{var i,t,a;try{const s=`${this.config.restBaseUrl}portals/self/ClassificationSchema`,e=await(0,l.r)(s);this.classificationSchema=e,this.classificationCategoryArr=null===(t=null===(i=e.classificationMetadata)||void 0===i?void 0:i.classificationValueProperties)||void 0===t?void 0:t.map((i=>({value:i.value,label:i.value,textColor:i.textColor,backgroundColor:i.backgroundColor}))),this.setAttributeCategory(null===(a=e.attributeCategories)||void 0===a?void 0:a[0]),this.retrieveItemClassificationValue()}catch(i){console.log("error: ",i),this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==i?void 0:i.message})}},this.retrieveItemClassificationValue=async()=>{var i,t,a,s,e;try{const n=`${this.config.restBaseUrl}content/users/${this.userName}/items/${this.itemId}`,o=null===(i=(await(0,l.a)(n)).item)||void 0===i?void 0:i.classification;this.itemClassificationValue=o?JSON.parse(o):{classification:null===(t=this.classificationSchema)||void 0===t?void 0:t.classificationMetadata.defaultValue},this.orgItemClassificationValue=structuredClone(this.itemClassificationValue),this.classificationType=this.convertClassificationType(this.retrieveClassificationType(o?{value:JSON.parse(o).classification}:{value:null===(a=this.classificationSchema)||void 0===a?void 0:a.classificationMetadata.defaultValue})),this.orgClassificationType=o?this.getClassificationType(null===(s=this.itemClassificationValue)||void 0===s?void 0:s.classification):structuredClone(null===(e=this.itemClassificationValue)||void 0===e?void 0:e.classification),this.displayClassificationVal(this.itemClassificationValue),o&&(this.doesValidate=this.validateClassificationVal(JSON.parse(o)))}catch(i){console.log("error: ",i),this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==i?void 0:i.message})}},this.hasNonexistingAttribute=i=>!!i.find((i=>!this.classificationSchema.attributes[i])),this.hasDisabledAttribute=(i,t)=>{let a=!1;return(async()=>{for(const s in i){const e=i[s];try{if(!await(0,l.i)(e,this.classificationSchema,JSON.stringify(t))){a=!0;break}}catch(i){a=!0;break}}})(),a},this.hasUpdatedAttributeValues=(i,t)=>{let a=!1;return(async()=>{for(const s in i){const e=i[s],n=t[e];if((this.classificationSchema.layouts.default.layoutElements[e].uiElement||"text").includes("-select"))try{const i=await(0,l.e)(e,this.classificationSchema,JSON.stringify(this.itemClassificationValue));n.forEach((t=>{i.find((i=>i.label!==t))&&(a=!0)}))}catch(i){return void(a=!0)}}})(),a},this.validateClassificationVal=i=>{var t;const a=null===(t=Object.keys(i))||void 0===t?void 0:t.filter((i=>"classification"!==i));return 0===a.length||!this.hasNonexistingAttribute(a)&&!this.hasDisabledAttribute(a,i)&&!this.hasUpdatedAttributeValues(a,i)},this.saveItemClassificationValue=async()=>{try{this.isSaving=!0;const i=`${this.config.restBaseUrl}content/users/${this.userName}/items/${this.itemId}/update`;(await(0,l.s)(i,this.itemClassificationValue)).success&&(this.isSaving=!1,this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"success",alertIndicatorIcon:"check-circle",alertIndicatorInfo:this.i18n.classificationValueSaved}),this.closeClassificationEditModal("save"),this.retrieveClassificationSchema())}catch(i){console.log("error: ",i),this.isSaving=!1,this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:null==i?void 0:i.message})}},this.handleDisplayNotificationModal=i=>{this.alertIndicator=i,this.isNotificationModalActive=!0},this.handleCloseNotificationModal=()=>this.isNotificationModalActive=!1,this.itemId=void 0,this.userName=void 0,this.config=void 0,this.isDisplayModal=void 0,this.setIsDisplayModal=void 0,this.displayClassificationVal=void 0,this.api=void 0,this.classificationSchema=null,this.classificationCategoryArr=[],this.classificationType=null,this.itemClassificationValue=null,this.attributeCategory="General",this.doesValidate=!0,this.isSaving=!1,this.isResetting=!1,this.isNotificationModalActive=!1,this.alertIndicator={alertIndicatorActive:!1,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:""}}async componentWillLoad(){var i;const t=await(0,e.g)(this.el);null!==(i=n.c.api)&&void 0!==i||(n.c.api=this.api),this.i18n=t[0],this.retrieveClassificationSchema()}getClassificationType(i){return this.classificationCategoryArr.find((t=>t.value===i))}retrieveClassificationType(i){var t;return null===(t=this.classificationSchema)||void 0===t?void 0:t.classificationMetadata.classificationValueProperties.find((t=>t.value===i.value))}convertClassificationType(i){return{value:i.value,label:i.value,textColor:i.textColor,backgroundColor:i.backgroundColor}}setClassificationType(i){this.classificationType=i}setItemClassificationValue(i){this.itemClassificationValue=i}setAttributeCategory(i){this.attributeCategory=i}openClassificationEditModal(){this.setIsDisplayModal(!0),this.doesValidate||this.handleDisplayNotificationModal({alertIndicatorActive:!0,alertIndicatorType:"danger",alertIndicatorIcon:"exclamation-mark-triangle",alertIndicatorInfo:this.i18n.itemClassificationValidateError})}closeClassificationEditModal(i){"cancel"===i&&(this.classificationType=this.orgClassificationType,this.itemClassificationValue=this.orgItemClassificationValue),this.setIsDisplayModal(!1)}resetClassificationValue(){this.setClassificationType(this.convertClassificationType(this.retrieveClassificationType(Object.assign({},this.classificationSchema.classificationMetadata.classificationValueProperties[0])))),this.setItemClassificationValue({classification:this.classificationSchema.classificationMetadata.defaultValue})}displayIntoTip(){console.log("test")}renderHeader(){return(0,s.h)("h3",{slot:"header"},this.i18n.itemClassificationEditLabel,(0,s.h)("calcite-icon",{class:"classification-info-tip",scale:"s",icon:"information",onClick:this.displayIntoTip}))}renderContent(){return(0,s.h)("div",{slot:"content",class:"portal-item-classification-content"},(0,s.h)("item-classification-info",{i18n:this.i18n,itemClassificationValue:this.itemClassificationValue,classificationSchema:this.classificationSchema}),(0,s.h)("item-classification-category",{i18n:this.i18n,classificationCategoryArr:this.classificationCategoryArr,classificationType:this.classificationType,setClassificationType:this.setClassificationType.bind(this),setItemClassificationValue:this.setItemClassificationValue.bind(this)}),!!this.classificationSchema&&!!this.itemClassificationValue&&(0,s.h)("item-classification-content",{itemClassificationValue:this.itemClassificationValue,classificationSchema:this.classificationSchema,attributeCategory:this.attributeCategory,setAttributeCategory:this.setAttributeCategory.bind(this),setItemClassificationValue:this.setItemClassificationValue.bind(this),onArcgisItemClassificationContentDisplayNotification:i=>this.handleDisplayNotificationModal(i.detail),isSaving:this.isSaving}))}renderFooter(){const{i18n:i}=this;return(0,s.h)(s.F,null,(0,s.h)("calcite-button",{"aria-label":i.reset,scale:"l",slot:"back",width:"full",appearance:"outline",disabled:this.isSaving,onClick:()=>this.resetClassificationValue()},this.isResetting?(0,s.h)("div",{class:"resetIndicator"},(0,s.h)("calcite-loader",{label:"resettingClassification",scale:"m",inline:!0}),(0,s.h)("span",{class:"resetIndicator"},i.resetting)):(0,s.h)("div",null,i.reset)),(0,s.h)("calcite-button",{"aria-label":i.save,scale:"l",slot:"primary",width:"full",onClick:()=>this.saveItemClassificationValue()},this.isSaving?(0,s.h)("div",{class:"saveIndicator"},(0,s.h)("calcite-loader",{label:"savingClassification",scale:"m",inline:!0}),(0,s.h)("span",{class:"savingIndicator"},i.saving)):(0,s.h)("div",null,i.save)),(0,s.h)("calcite-button",{"aria-label":i.cancel,scale:"l",slot:"secondary",width:"full",appearance:"outline",onClick:()=>this.closeClassificationEditModal("cancel"),disabled:this.isSaving},(0,s.h)("div",null,i.cancel)))}renderModal(){return(0,s.h)(s.F,null,this.renderHeader(),this.renderContent(),this.renderFooter())}render(){return(0,s.h)(s.F,null,(0,s.h)("button",{onClick:()=>this.openClassificationEditModal()},this.i18n.openModal),(0,s.h)("calcite-modal",{class:"portal-item-classification-viewer",open:this.isDisplayModal,scale:"m",widthScale:"m",outsideCloseDisabled:!0,onCalciteModalClose:()=>this.closeClassificationEditModal("cancel")},this.renderModal()),this.isNotificationModalActive&&(0,s.h)("item-classification-notification",{i18n:this.i18n,alertIndicator:this.alertIndicator,onArcgisItemClassificationNotificationClose:()=>{this.handleCloseNotificationModal()}}))}get el(){return(0,s.d)(this)}};o.style=".portal-item-classification-viewer{--calcite-modal-content-padding:0}.saveIndicator{display:inline-flex;width:100%;align-items:center;justify-content:center}.savingIndicator{margin:0 10px}.classification-info-tip{margin-left:3px;cursor:pointer}"},59306:(i,t,a)=>{a.d(t,{a:()=>n,e:()=>d,i:()=>r,r:()=>o,s:()=>c});var s=a(46710),e=a(21104),l=a(66913);function n(i){return(0,l.r)(i)}function o(i){return(0,l.r)(i)}function c(i,t){const a={classification:JSON.stringify(t)};return(0,l.r)(i,a,{},"post")}async function r(i,t,a){var s;const e=null===(s=null==t?void 0:t.attributes)||void 0===s?void 0:s[i],l=null==e?void 0:e.isAttributeEnabled;if(!e)return!1;if(!l)return!0;const n={schemaJsonString:JSON.stringify(t),valueJsonString:a,attributeId:i};return(await h(l)).execute(n)}async function d(i,t,a){var s,e;const l=null===(s=null==t?void 0:t.attributes)||void 0===s?void 0:s[i],n=null==l?void 0:l.valueExpression,o=null==l?void 0:l.validValues,c=null==l?void 0:l.validValuesMap;if(!l)return null;if(null==o?void 0:o.length)return o;if(c&&(null===(e=Object.keys(c))||void 0===e?void 0:e.length))return c;if(!n)return null;const r={schemaJsonString:JSON.stringify(t),valueJsonString:a,attributeId:i};return(await h(n)).execute(r)}async function h(i){const[t]=await(0,e.l)([3===(null===s.c||void 0===s.c?void 0:s.c.api)?"webpack-bundles/arcade":"esri/arcade"]);return t.createArcadeExecutor(i,{variables:[{name:"schemaJsonString",type:"text"},{name:"valueJsonString",type:"text"},{name:"attributeId",type:"text"}]})}}}]);
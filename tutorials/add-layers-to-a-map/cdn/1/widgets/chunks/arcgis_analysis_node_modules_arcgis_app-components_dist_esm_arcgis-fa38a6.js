/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-fa38a6.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-fa38a6"],{9739:(e,t,r)=>{r.r(t),r.d(t,{arcgis_dependency_check:()=>ie,arcgis_group_badges:()=>ae,arcgis_group_card:()=>se,arcgis_group_thumbnail_stack:()=>oe,arcgis_item_card:()=>ne,arcgis_item_share:()=>ve,arcgis_item_share_group:()=>we,arcgis_item_share_group_card:()=>ye,arcgis_item_share_summary_editable:()=>fe,arcgis_selected:()=>xe,arcgis_selected_item:()=>_e,arcgis_sublayer_type:()=>Se});var i=r(35110),a=r(66913),s=r(88703),o=r(91659),n=r(1984),l=r(870),c=r(12856),d=r(70392),p=r(67148),u=r(53948),h=r(9657),m=r(78635),g=r(56086);const v=async(e,t,r,i,s=!1)=>{const{portal:n,user:l}=i,u=`${(0,d.g)(n)}content/users/${l.username}/shareItems`;let h=[];const m=t?function(e){switch(e){case"public":return{org:!1,everyone:!0};case"org":return{org:!0,everyone:!1};case"private":case"shared":return{org:!1,everyone:!1};default:return{}}}(t):{};if(e.every((e=>(0,o.i)(e,l))))try{h=(await(0,p.r)(u,n,{body:Object.assign({items:e.map((e=>e.id)).join(","),groups:(null==r?void 0:r.length)?r.join(","):void 0,confirmItemControl:!0},m),usePost:!0})).results}catch(e){return console.error(e),{error:{code:"unhandledError"}}}else h=(await Promise.all(e.map((({id:e})=>async function(e,t,r,i,s=!1){try{const o=`${(0,c.g)(e,i)}/share`,n=Object.assign({groups:(null==r?void 0:r.length)?r.join(","):null,confirmItemControl:!0},t);let l;return l=s?await(0,p.r)(o,i,{body:n,usePost:!0}):await(0,a.r)(o,n,{},"post"),{result:l}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}(e,m,r,n,s))))).map((e=>e.result));return{result:h}};function b(e){const{typeKeywords:t,type:r,url:i}=e,a=t&&y.some((e=>t.includes(e))),s="Image Service"===r&&(null==i?void 0:i.includes("://iservices"))&&i.includes("arcgis.com"),o=f.includes(r);return a||s||o}function w(e){var t;const r=null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("Hosted Service");return["Vector Tile Service","Map Service","Scene Service","Feature Service"].includes(e.type)&&r}const y=["Location Tracking Service","Location Tracking View","IoTFeed","IoTFeatureLayer","IoTMapImageLayer","IoTStreamLayer","Administrative Report","EditExtensionIndoorsSpaces","ArcgisWorkflowJobLocation"],f=["Knowledge Graph","Pro Project","Data Store"],x=async(e,t)=>{const r=e.id;let i,a={items:[],layers:[]};switch(e.type){case"Group Layer":({result:a,error:i}=await _(r,t));break;case"Web Map":case"Web Scene":({result:a,error:i}=await S(r,t));break;case"Web Mapping Application":({result:a,error:i}=await k(r,t));break;case"Web Experience":case"Web Experience Template":({result:a,error:i}=await D(r,e.typeKeywords,t));break;case"Big Data File Share":({result:a,error:i}=await C(e,t));break;case"Data Store":({result:a,error:i}=await L(e,t))}return{result:a,error:i}},_=async(e,t)=>{try{const r=await(0,h.g)(e,t);return{result:{items:[],layers:[Object.assign({},r)]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},S=async(e,t)=>{var r,i;try{const a=await(0,h.g)(e,t),{operationalLayers:s,baseMap:o,tables:n,ground:l}=a;return{result:{items:[],layers:[...null!=s?s:[],...null!==(r=null==o?void 0:o.baseMapLayers)&&void 0!==r?r:[],...null!==(i=null==l?void 0:l.layers)&&void 0!==i?i:[],...null!=n?n:[]]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},k=async(e,t)=>{var r;try{const r=await(0,h.g)(e,t);if(!r)return{result:{items:[],layers:[]}};const i=I(r),a=(await Promise.all(i.map((e=>(0,h.a)(e,t))))).map((({result:e})=>e)).filter((e=>e)),s=await Promise.all(a.map((e=>x(e,t)))),{items:o,layers:n}=G(s.map((({result:e})=>e)).flat().filter((e=>e)));return{result:{items:[...a,...o],layers:n}}}catch(e){return(0,u.i)(null!==(r=null==e?void 0:e.message)&&void 0!==r?r:"")?{result:{items:[],layers:[]}}:(console.error(e),{error:{code:"unhandledError"}})}},I=e=>{var t,r,i,a,s,o,n,l,c,d;return[...(null===(t=null==e?void 0:e.map)||void 0===t?void 0:t.itemId)?[e.map.itemId]:[],...null!==(a=null===(i=null===(r=e.values)||void 0===r?void 0:r.itemCollection)||void 0===i?void 0:i.map((e=>e.id)))&&void 0!==a?a:[],...null!==(n=null===(o=null===(s=e.values)||void 0===s?void 0:s.webmap)||void 0===o?void 0:o.split(","))&&void 0!==n?n:[],...null!==(d=null===(c=null===(l=e.values)||void 0===l?void 0:l.webscene)||void 0===c?void 0:c.split(","))&&void 0!==d?d:[]]},D=async(e,t,r)=>{const i=`${(0,c.g)(e,r)}/resources/config/config.json`,a=(0,h.b)(e,r),s=[];t.includes("status: Draft")?s.push(i):t.includes("status: Changed")?s.push(i,a):s.push(a);try{const e=[],t=[],i=[];return await Promise.all(s.map((async a=>{const s=await(0,p.r)(a,r);if(!(null==s?void 0:s.dataSources)&&!(null==s?void 0:s.utilities))return;const o=(await Promise.all(function(e){const t=e.dataSources||{},r=e.utilities||{};return[...Object.values(t),...Object.values(r)].map((e=>e.itemId)).filter((e=>e))}(s).map((e=>(0,h.a)(e,r))))).map((({result:e})=>e)).filter((e=>e)),n=await Promise.all(o.map((e=>x(e,r)))),{items:l,layers:c}=G(n.flatMap((({result:e})=>e)).filter((e=>e)));i.push(...c),e.push(...l),t.push(...o)}))),{result:{items:[...t,...e],layers:i}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},C=async(e,t)=>{try{const{relatedItems:r}=await(0,p.g)(e.id,t,{relationshipType:"BDFSDataStore2BDFSCatalogService",direction:"reverse"}),i=r[0].typeKeywords;if(i.includes("bigDataFileShare")&&i.includes("dataStore")){const{result:e}=await L(r[0],t),{items:i}=e,a=await(0,h.c)(r[0].id,t);return{result:{items:[...i,a],layers:[]}}}return{result:{items:await Promise.all(r.map((e=>(0,h.c)(e.id,t)))),layers:[]}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},L=async(e,t)=>{try{const{relatedItems:r}=await(0,p.g)(e.id,t,{relationshipType:"CloudDataStore2BDFSDataStore",direction:"reverse"});return{result:{items:await Promise.all(r.map((e=>(0,h.c)(e.id,t)))),layers:[]}}}catch(e){return console.error("error:",e),{error:{code:"unhandledError"}}}},G=e=>({items:e.flatMap((e=>e.items)),layers:e.flatMap((e=>e.layers))});async function P(e,t,r=!1){try{const{result:i}=await(0,h.d)(e,t);return{result:[...i.admin,...i.member,...i.other].filter((e=>r||!e.isFav)).map((e=>e.id))}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}}const T=e=>!("layerType"in e)&&e.url&&e.popupInfo,O={needsGroupUpdate:!1,needsShareLevelUpdate:!1,canEditShareLevel:!0,premium:!1,bdfsDatastore:!1},U={private:0,shared:1,org:2,public:3},B=async(e,t)=>{const{owningSystemUrl:r}=await(0,a.f)((async()=>(0,g.g)(e)),"portalInfo",e.id);return(await Promise.all(t.map((async e=>{try{const{owningSystemUrl:t}=await(0,g.a)(e);return{owningSystemUrl:t,url:e}}catch(t){return console.error(t),{owningSystemUrl:null,url:e}}})))).filter((({owningSystemUrl:e})=>e===r)).map((({url:e})=>e))},E=async(e,t)=>{const r=e.filter((e=>{return!!(null==e?void 0:e.url)&&(t={layerType:e.layerType},["table","ArcGISFeatureLayer","ArcGISTiledMapServiceLayer","VectorTileLayer","GroupLayer","ArcGISImageServiceLayer","ArcGISTiledImageServiceLayer","SubtypeGroupLayer","ArcGISStreamLayer"].includes(t.layerType));var t})),i=await F(r.map((e=>e.url)),t),s=[],o=[],n=[];await Promise.all(i.map((async e=>{const{result:r,error:i}=await(0,a.f)((()=>(0,p.a)(e,t)),"itemMetadata",`${e}--no-token`);"tokenRequired"!==(null==i?void 0:i.code)?z(r)?s.push(A(r,e)):n.push(r):o.push(e)})));const l=n.map((e=>null==e?void 0:e.serviceItemId)),c=await B(t,o),d=(await Promise.all(c.map((async e=>({response:await(0,p.r)(e,t,{addTokenManually:!0}),url:e}))))).reduce(((e,{response:t,url:r})=>z(t)?(s.push(A(t,r)),e):[...e,null==t?void 0:t.serviceItemId]),[]),u=await Promise.all([...l,...d].map((async e=>e?(0,h.c)(e,t):null))),m=s.length<=0?[]:await E(s.map((e=>({url:e,layerType:"VectorTileLayer"}))),t);return[...u.filter((e=>!!e)),...m]},z=e=>!!(null==e?void 0:e.sources),A=(e,t)=>{var r;const i=null===(r=Object.values(e.sources)[0])||void 0===r?void 0:r.url;return i?i.includes("..")?(({path:e,url:t})=>{const r=t.split("/"),i=e.split("/");return r.slice(0,r.length-i.length).join("/")})({url:t,path:i}):i:null},F=async(e,t)=>{const r=e.filter((e=>!!e&&!!(0,d.p)(e))),i=e.filter((e=>!e||!(0,d.p)(e)));return[...await B(t,r),...i]},j=async(e,t,r,i={clearDataCacheOnDone:!0})=>{if("private"===e.access)return{result:{needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needBDFSDatastoreUpdate:[],needAuthentication:[]}};const{result:s,error:o}=await M(e,t,r);if(o)return{error:o};const n={needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needBDFSDatastoreUpdate:[],needAuthentication:$(e)?[{sourceItem:e,detail:{bdfsDatastore:!1,canEditShareLevel:!0,needsGroupUpdate:!1,needsShareLevelUpdate:!1,premium:!1}}]:[]};return await Promise.all(null==s?void 0:s.map((async r=>{const i=await H({mainItem:e,sharingDetailResult:r,portal:t});i&&n[i].push(r)}))),i.clearDataCacheOnDone&&V.forEach((e=>(0,a.c)(e))),{result:n}},M=async(e,t,r)=>{let i,n=[],l=[...r||[]];if(!(null==l?void 0:l.length)){const{error:r,result:a}=await x(e,t);i=r,l=a.layers,n=a.items}if(i)return{error:i};if(l.length<=0&&n.length<=0)return{error:{code:"dataNotAvailable"}};try{if("Big Data File Share"!==e.type&&"Data Store"!==e.type){const{result:e,error:r}=await(async(e,t)=>{const r=[],i=e=>{if(T(e))r.push({id:e.id,url:e.url,layerType:"table",getType:"normal"});else{if("GroupLayer"===e.layerType)return e.itemId&&r.push({id:e.id,itemId:e.itemId,layerType:"GroupLayer",getType:"normal"}),void e.layers.forEach((e=>{if(T(e)||"GroupLayer"===e.layerType)return void i(e);const t=e.url;if(!t)return void i(e);const r=(0,d.p)(t);i(Object.assign(Object.assign({},e),{url:null!=(null==r?void 0:r.index)?r.baseServerUrl:e.url}))}));if((e=>"VectorTileLayer"===e.layerType&&"styleUrl"in e)(e))r.push({id:e.id,url:e.styleUrl,itemId:e.itemId,layerType:e.layerType,getType:"normal"});else if((e=>"ArcGISTiledMapServiceLayer"===e.layerType)(e)){const t=(e=>"ArcGISTiledMapServiceLayer"===e.layerType&&"layers"in e&&!1===e.layers[0].disablePopup)(e);if(t){const t=e.layers[0];r.push({id:t.id,url:t.layerUrl,getType:"normal",layerType:e.layerType,itemId:t.layerItemId})}r.push({id:e.id,getType:t?"normal":"tile-layer-with-no-popup",itemId:e.itemId,layerType:e.layerType,url:e.url})}else(e.itemId||e.url)&&r.push({id:e.id,url:e.url,itemId:e.itemId,layerType:e.layerType,getType:"normal"})}};e.forEach(i);const o=(0,s.a)(r,(e=>e.itemId?{key:e.itemId,data:{searchType:"item-id",layerType:e.layerType}}:{key:e.url,data:{searchType:"url",layerType:e.layerType}})),n=Object.keys(o).filter((e=>"item-id"===o[e].searchType));try{const e=(await Promise.all(n.map((e=>(0,h.c)(e,t))))).filter((e=>!!e)),i=r.filter((({getType:e,itemId:t})=>"tile-layer-with-no-popup"===e&&!!t)),l=(await Promise.all(i.map((e=>(async(e,t)=>{try{const r=e.itemId,i=await(0,a.f)((()=>(0,h.g)(r,t)),"itemData",r),{layerItemId:s}=null==i?void 0:i.layers[0];return s?{result:await(0,h.c)(s,t)}:{error:{code:"unhandledError"}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(e,t))))).map((({result:e})=>e)),c=e.filter((e=>!(0,m.i)(e.typeKeywords,e.type))),d=await E(c.map((e=>{const{url:t,id:r}=e,i=o[r];return i?{layerType:i.layerType,url:t}:null})),t),p=(0,s.a)(d,(e=>({key:e.url,data:e}))),u=Object.keys(o).map((e=>{const t=o[e];return t&&"url"===t.searchType?{layerType:t.layerType,url:e}:null})).filter((e=>e)),g=await E(u,t),v=[];return e.filter((e=>e)).forEach((e=>{const t=e.url;v.push({sourceItem:e});const r=p[t];r&&e.id!==r.id&&v.push({sourceItem:r})})),[...l,...g].forEach((e=>{e&&v.push({layer:null,sourceItem:e})})),{result:v}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(l,t);if(r)return{error:r};n.push(...e.map((({sourceItem:e})=>e)))}const{result:r,error:i}=await P(e.id,t);if(i)return{error:i};const c=(0,s.u)(n,(e=>e.id)),p=await Promise.all(c.map((async i=>{const a=await async function({mainItemAccess:e,mainItemSharingGroups:t,portal:r,sourceItem:i}){const{access:a,itemControl:s}=i,n=Object.assign({},O),l="public"===e;return b(i)&&l?Object.assign(Object.assign({},n),{needsShareLevelUpdate:!0,canEditShareLevel:!1}):("public"!==a?(n.canEditShareLevel=R(s),n.needsGroupUpdate=await N({sourceItem:i,isMainItemSharingToPublic:l,mainItemSharingGroups:t,portal:r}),n.needsShareLevelUpdate=W({mainItemAccess:e,sourceItemAccess:a})):n.premium=function(e){return(0,o.a)(e)||(0,o.b)(e)}(i),n)}({sourceItem:i,mainItemAccess:e.access,mainItemSharingGroups:r,portal:t});return{sourceItem:i,detail:a}})));return{result:p}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}},R=e=>"admin"===e,$=e=>e.typeKeywords.includes("DeveloperBasemap"),N=async({sourceItem:e,isMainItemSharingToPublic:t,portal:r,mainItemSharingGroups:i})=>{if(t)return!1;const{result:a}=await P(e.id,r);return!function(e,t){return!(null==e?void 0:e.length)||e.filter((e=>!(t||[]).includes(e))).length<=0}(i,a)},W=({mainItemAccess:e,sourceItemAccess:t})=>!("private"===t&&"shared"===e)&&U[e]>U[t];async function K(e,t,r,i,a=!0){const{user:s}=i,o=a?await Promise.all(t.map((async e=>{const{result:t}=await P(e.id,i);return t}))):[],n=o.flat(1);return v(e,r,n,{portal:i,user:s},!0)}const H=async({mainItem:e,sharingDetailResult:t,portal:r})=>{var i;const{sourceItem:a,detail:s}=t,{canEditShareLevel:n,needsGroupUpdate:l,needsShareLevelUpdate:c,premium:d}=s;if(s.bdfsDatastore)return"needBDFSDatastoreUpdate";if(!l&&!c&&!d)return null;if(!n&&!d)return"notEditableLayers";switch(e.access){case"public":if(d)return"premiumLayers";if("public"!==a.access){if((0,o.c)(r.subscriptionInfo||(null===(i=r.sourceJSON)||void 0===i?void 0:i.subscriptionInfo))&&w(a))return"notEditableLayers";if(await(0,h.i)(a,r))return a.typeKeywords.includes("Public Data Collection")?"needEditableLayers":"needDataCollectionLayers"}return"needsShareLevelUpdateLayers";case"org":case"shared":case"private":return d?null:"needsShareLevelUpdateLayers";default:J(e.access)}},V=["itemData","itemMetadata"],J=e=>{throw new Error(`Unexpected share level ${e}`)};var q=r(46710),Q=r(86587),Y=r(29471),X=r(23505),Z=r(96138),ee=r(2409),te=r(79233),re=r(29208);r(21104),r(73838),r(63280),r(91306),r(82669),r(84873),r(17752),r(25484);const ie=class{constructor(e){(0,i.r)(this,e),this.workflowCancel=(0,i.c)(this,"workflowCancel",7),this.workflowComplete=(0,i.c)(this,"workflowComplete",7),this.analyzeSharingDetail=async()=>{let e,{preProcessedSharingDetail:t,items:r,portal:i,i18n:o}=this;if(this.loadingText="loadingInfo",!this.preProcessedSharingDetail){const s=await Promise.all(r.map((({item:e,overrideLayers:t})=>j(e,i,t,{clearDataCacheOnDone:!1}))));V.forEach((e=>(0,a.c)(e))),t=s.reduce(((t,{error:r,result:i})=>(e=null==r?void 0:r.code,i&&Object.keys(i).forEach((e=>{t[e]=[...t[e],...i[e]]})),t)),{needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needBDFSDatastoreUpdate:[],needAuthentication:[]})}return Object.keys(t).forEach((e=>{t[e]=(0,s.u)(t[e],(({sourceItem:e})=>e.id))})),this.sharingDetail=t,this.sharingDetail&&"dataNotAvailable"!==e?this.filterAndGetSharingDetails():(this.errorMessage=o.unableToGetItem,[])},this.filterAndGetSharingDetails=()=>{const{sharingDetail:e}=this;if(Object.keys(e).every((t=>{var r;return!(null===(r=e[t])||void 0===r?void 0:r.length)})))return;const{needEditableLayers:t,needsShareLevelUpdateLayers:r,needBDFSDatastoreUpdate:i}=e;this.needsShareLevelUpdateLayers=r,this.needEditableLayers=t,this.needBDFSDatastoreUpdate=i,this.shareableItemCount=[...r,...t,...i].length;const a=Object.keys(e).reduce(((t,r)=>{var i;return null===(i=e[r])||void 0===i||i.forEach((e=>{t.push({item:e.sourceItem,state:r})})),t}),[]);return this.displayItems=a,a},this.closeDialog=()=>{this.workflowCancel.emit()},this.updateSharing=async()=>{const{needsShareLevelUpdateLayers:e,needEditableLayers:t,needBDFSDatastoreUpdate:r,portal:i,items:a}=this;this.isLoading=!0,this.loadingText="updatingSharing";const s=[...e,...t],o=s.map((({sourceItem:e})=>e)),n=s.some((({detail:e})=>e.needsShareLevelUpdate)),l=n?a[0].item.access:null,c=r.map((({sourceItem:e})=>e)),d=c.filter((e=>!e.typeKeywords.includes("bigDataFileShare")));d.length>0&&await K(d,[],l,i);const p=s.some((({detail:e})=>e.needsGroupUpdate))&&"public"!==l;n||p?await K(o,a.map((({item:e})=>e)),l,i,p):console.warn("Unexpected state: no need to update share level or group"),this.isLoading=!1,this.workflowComplete.emit({updatedSourceItems:[...o,...c],oldSharingDetail:this.sharingDetail})},this.getStatusInfoForLayerState=e=>{const{helpBase:t,helpMap:r}=this.config;switch(e){case"needEditableLayers":return{i18nKey:"sharingPDCEnabled",kind:"info"};case"needPubliclyEditableLayers":case"needDataCollectionLayers":return{i18nKey:"pdc",kind:"danger",link:`${t}${null==r?void 0:r[120004130]}`};case"premiumLayers":return{i18nKey:"premium",kind:"info",link:`${t}${null==r?void 0:r[120001307]}`};case"notEditableLayers":return{i18nKey:"noPermission",kind:"danger"};case"needAuthentication":return{i18nKey:"needsAuthentication",kind:"danger"};default:return null}},this.renderPreviewItemNotice=()=>{const{previewItemState:e,getStatusInfoForLayerState:t,i18n:r}=this,a=e?t(e):null;if(!a)return null;const{i18nKey:s,kind:o,link:n}=a,l=r.needShare;return(0,i.h)("calcite-notice",{open:!0,closable:!1,scale:"m",kind:o,slot:"preview-summary-top",class:"preview-notice"},(0,i.h)("div",{slot:"message"},l[s].panel),n&&"noPermission"!==s&&"sharingPDCEnabled"!==s&&"needsAuthentication"!==s&&(0,i.h)("calcite-link",{slot:"link",href:n,target:"_blank",rel:"noopener"},l[s].learnMore))},this.user=void 0,this.portal=void 0,this.config=void 0,this.api=void 0,this.isActive=!0,this.items=void 0,this.preProcessedSharingDetail=void 0,this.isLoading=void 0,this.sharingDetail=void 0,this.sections=[],this.needsShareLevelUpdateLayers=[],this.needEditableLayers=[],this.needBDFSDatastoreUpdate=[],this.displayItems=[],this.previewItemState=null,this.loadingText="loadingInfo",this.errorMessage=null,this.shareableItemCount=0}async componentWillLoad(){this.items=this.items.map((e=>{var t;return Object.assign(Object.assign({},e),{item:null!==(t=e.item.sourceJSON)&&void 0!==t?t:e.item})}));const{el:e}=this,t=await(0,n.g)(e);this.i18n=t[0]}handleNewPreProcessedSharingDetail(){var e;null===(e=this.itemBrowserRef)||void 0===e||e.refresh()}componentDidLoad(){}render(){const{updateSharing:e,isActive:t,api:r,closeDialog:a,i18n:s,isLoading:n,loadingText:c,shareableItemCount:d,errorMessage:p,portal:u,user:h,config:m,analyzeSharingDetail:g,getStatusInfoForLayerState:v,displayItems:b,renderPreviewItemNotice:w}=this,y=d>0,f=!!p,x=s.needShare;return(0,i.h)("calcite-modal",{onCalciteModalClose:a,open:t,outsideCloseDisabled:!0,escapeDisabled:!0},(0,i.h)("div",{slot:"header",class:"header"},s.updateSharing),(0,i.h)("div",{slot:"content",class:"stage"},(0,i.h)("calcite-alert",{icon:!0,open:f,label:p,kind:"danger",onCalciteAlertClose:()=>this.errorMessage=null},(0,i.h)("div",{slot:"message"},p)),(0,i.h)("arcgis-new-item-loader",{active:n,text:s[c]}),(0,i.h)("arcgis-item-browser",{fetch:async()=>{var e;const t=null!==(e=await g())&&void 0!==e?e:[];return{total:t.length,nextStart:0,num:t.length,start:0,results:t.map((({item:e})=>e))}},onArcgisItemBrowserPreview:({detail:e})=>{var t,r;e||(this.previewItemState=null),this.previewItemState=null!==(r=null===(t=b.find((({item:t})=>t.id===e.id)))||void 0===t?void 0:t.state)&&void 0!==r?r:null},hideContentTop:!0,contentPaddedBottom:!0,hidePreviewFooters:!0,portal:u,user:h,config:m,selection:"none",api:r,num:l.a,ref:e=>this.itemBrowserRef=e},(0,i.h)("arcgis-item-browser-content",{class:"compact-grid-content",slot:"content"},(0,i.h)("div",{class:"top-bar"},(0,i.h)("div",{class:"top-notice",innerHTML:s[u.isPortal?"noticeEnterprise":"notice"]}),(0,i.h)("div",null,s.canBeShared.replace("${count}",d.toString()).replace("${total}",b.length.toString()))),b.map((({item:e,state:t})=>{const r=v(t),a="info"===(null==r?void 0:r.kind);return(0,i.h)("arcgis-item-card",{key:e.id,item:e,portal:u,user:h,baseUrl:m.baseUrl,preview:"top",showOwner:!0,showDateUpdated:!0,showItemType:!0,showSummary:!0,showBadges:!0},r&&(0,i.h)("div",{slot:"content-top",class:{"status-banner":!0,"status-banner--info":a}},(0,i.h)("calcite-icon",{icon:a?"information":"exclamationMarkTriangle",scale:"s"}),(0,i.h)("span",null,x[r.i18nKey].notice)),(0,i.h)("div",{slot:"actions-end",class:"open-item"},(0,i.h)("calcite-button",{scale:"s",appearance:"transparent",kind:"neutral",onClick:()=>window.open((0,o.g)(e.id,m.baseUrl),"_blank","noopener")},s.goToItem)))}))),w())),(0,i.h)("calcite-button",{slot:"secondary",appearance:y?"outline":"solid",kind:"brand","data-id":"cancelButton",onClick:()=>this.isActive=!1,width:"full"},s[y?"cancel":"ok"]),y&&(0,i.h)("calcite-button",{slot:"primary",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:e,width:"full",disabled:n},s.update))}get el(){return(0,i.d)(this)}static get watchers(){return{preProcessedSharingDetail:["handleNewPreProcessedSharingDetail"]}}};ie.style=".stage{height:100%;overflow:hidden;transform:translate(0, 0)}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}calcite-modal{--calcite-modal-content-padding:0;--calcite-modal-width:1080px}.top-bar{font-weight:500;padding-left:1rem;padding-right:1rem;padding-top:1.5rem;padding-bottom:0.5rem;font-size:0.875rem}@media screen and (min-width: 1080px){.top-bar{padding-left:0px;padding-right:0px}}.top-notice{margin-bottom:0.75rem;padding-bottom:0.75rem;border-bottom:1px solid var(--calcite-color-border-1)}.open-item{margin-inline-start:0.25rem;padding-inline-start:0.25rem;border-inline-start:1px solid var(--calcite-color-border-1)}.status-banner{display:flex;align-items:center;padding-left:1rem;padding-right:1rem;padding-top:0.25rem;padding-bottom:0.25rem;font-size:0.75rem;border-bottom:1px solid var(--calcite-color-border-2)}.status-banner>calcite-icon{margin-inline-end:0.5rem;color:var(--calcite-color-status-danger)}.status-banner>span{margin-top:2px}.status-banner--info>calcite-icon{color:var(--calcite-color-status-info)}.compact-grid-content{--arcgis-item-browser-content-spacing:0.5rem}.preview-notice{margin-bottom:1rem}";const ae=class{constructor(e){(0,i.r)(this,e),this.group=void 0,this.portal=void 0,this.width="full",this.appearance=void 0,this.empty=!1,this.showTooltips=!1,this.scale="m",this.badges=[]}componentWillLoad(){this.group&&this.updateBadges(this.group)}updateBadges(e){var t;this.badges=function(e,t){const r=[];return t.id&&(e.capabilities&&e.capabilities.includes("updateitemcontrol")&&r.push("SharedUpdate"),e.isOpenData&&e.orgId===t.id&&r.push("OpenData"),t.featuredItemsGroupQuery&&t.featuredItemsGroupQuery===`id:${e.id}`&&r.push("Gallery")),(e.collaborationInfo&&e.collaborationInfo.collaborationId||e.capabilities&&e.capabilities.includes("distributed"))&&r.push("Collaboration"),e.membershipAccess||t.isPortal||"none"===e.orgId||r.push("AnyOrg"),"collaboration"===e.membershipAccess&&r.push("Partnered"),r.includes("SharedUpdate")&&!r.includes("Partnered")&&e.orgId!==t.id&&r.splice(r.indexOf("SharedUpdate"),1),r}(e,this.portal),(null===(t=this.badges)||void 0===t?void 0:t.length)||(this.empty=!0)}render(){const{width:e,scale:t,badges:r,showTooltips:a,appearance:s}=this;return(0,i.h)(i.H,null,r.map((r=>(0,i.h)("arcgis-group-badge",{appearance:s,key:r,class:"badge",badgeType:r,width:e,scale:t,showTooltip:a}))))}get el(){return(0,i.d)(this)}static get watchers(){return{group:["updateBadges"]}}};ae.style=":host{display:flex;flex-wrap:wrap}.badge{display:inline-block;margin-inline-end:0.25rem}";const se=class{constructor(e){var t;(0,i.r)(this,e),this.arcgisGroupCardSelect=(0,i.c)(this,"arcgisGroupCardSelect",7),this.arcgisGroupBrowserCardPreview=(0,i.c)(this,"arcgisGroupBrowserCardPreview",7),this.arcgisGroupBrowserInternalUIAction=(0,i.c)(this,"arcgisGroupBrowserInternalUIAction",7),this.handleResizeEvent=({detail:e})=>{this.resize(e.width)},this.handleCardClick=()=>{const{group:e,preview:t}=this;this.link||("top"!==t?this.radioButton?(this.radioButton.checked=!0,this.arcgisGroupCardSelect.emit({group:e,selected:!0})):this.checkbox&&(this.selected=!this.selected,this.arcgisGroupCardSelect.emit({group:e,selected:this.selected})):this.arcgisGroupBrowserCardPreview.emit(e))},this.group=void 0,this.user=void 0,this.portal=void 0,this.api=4,this.baseUrl=null===(t=null===q.c||void 0===q.c?void 0:q.c.config)||void 0===t?void 0:t.baseUrl,this.selected=void 0,this.indeterminate=void 0,this.view="list",this.selection="none",this.preview=void 0,this.name=void 0,this.showOwner=!0,this.showDateUpdated=!0,this.showDateCreated=!1,this.showViewableBy=!0,this.showSummary=!1,this.showBadges=!0,this.link=void 0,this.newTab=void 0,this.hover=void 0,this.formFactor=void 0,this.updatedText="",this.createdText="",this.loaded=void 0,this.width=void 0}async restoreFocus(){this.link&&this.linkEl?this.linkEl.focus():"top"===this.preview&&this.sectionEl&&this.sectionEl.focus()}async componentWillLoad(){var e,t;const{el:r}=this,i=await(0,n.g)(r);this.i18n=i[0],this.store=(0,Y.g)(this.el)||(0,X.c)({filters:{},type:"group-browser"}),null!==(e=this.formFactor)&&void 0!==e||(this.formFactor=(null===(t=this.store)||void 0===t?void 0:t.state.panel)?"xs":"lg"),(0,Z.s)(this.store).observe(this.el),this.el.addEventListener("arcgisBrowserResize",this.handleResizeEvent),this.updatedText=this.i18n.lastUpdated.replace("${date}",(0,Q.a)(this.group.modified)),this.createdText=this.i18n.created.replace("${date}",(0,Q.a)(this.group.created))}async componentDidLoad(){await(0,s.t)(100),this.loaded=!0}disconnectedCallback(){var e,t,r,i;null===(r=null===(t=null===(e=this.store)||void 0===e?void 0:e.state)||void 0===t?void 0:t.resizeObserver)||void 0===r||r.unobserve(this.el),null===(i=this.el)||void 0===i||i.removeEventListener("arcgisBrowserResize",this.handleResizeEvent)}resize(e){switch(!0){case e>Z.b.md:this.formFactor="lg";break;case e>Z.b.sm:this.formFactor="md";break;case e>Z.b.xs:this.formFactor="sm";break;case e>Z.b.xxs:this.formFactor="xs";break;default:this.formFactor="xxs"}this.width=e}getAccessInfo(e){const t={public:{text:this.i18n.everyone,icon:"globe"},private:{text:this.i18n.groupMembers,icon:"lock"},org:{text:this.i18n.organization,icon:"organization"}};return t[e]||t.private}renderCompactView(){const{group:e,portal:t,selection:r,selected:a,formFactor:s,i18n:o,link:n,loaded:l,newTab:c,showBadges:d}=this,p=this.link?"a":"div",u=Object.assign({href:n},c?{target:"_blank",rel:"noopener noreferrer"}:{});return(0,i.h)("section",Object.assign({class:{"group-card":!0,"group-card--hoverable":"none"!==r,[`group-card--${s}`]:!0,"group-card--loaded":l},onMouseOver:()=>this.hover=!0,onMouseOut:()=>this.hover=!1},n?{}:{onClick:this.handleCardClick},{ref:e=>this.sectionEl=e}),(0,i.h)(p,Object.assign({class:{"group-card__upper":!0,"group-card__upper--link":!!n,"group-card__upper--compact":!0}},n?u:{},{ref:e=>this.linkEl=e}),"single"===r&&(0,i.h)("calcite-radio-button",{class:"group-card__input",checked:a,value:e.title,name:this.name,ref:e=>this.radioButton=e,onClick:e=>{e.stopPropagation()},onCalciteRadioButtonChange:()=>{this.arcgisGroupCardSelect.emit({group:e,selected:!a})}},(0,i.h)("span",{class:"screen-readers-only"},o.select.replace("${title}",e.title))),"multiple"===r&&(0,i.h)("calcite-checkbox",{class:"group-card__input",checked:a,indeterminate:this.indeterminate,onClick:e=>{e.stopPropagation()},onCalciteCheckboxChange:()=>{this.arcgisGroupCardSelect.emit({group:e,selected:!this.selected})},value:e.id,ref:e=>this.checkbox=e},(0,i.h)("span",{class:"screen-readers-only"},e.title)),(0,i.h)("div",{class:"flex-0 group-card__thumbnail group-card__thumbnail--compact"},(0,i.h)("arcgis-group-thumbnail",{group:e,portal:t,scale:"l"})),(0,i.h)("div",{class:"group-card-flex-1"},(0,i.h)("h3",{class:"group-card__title group-card__title--compact"},(0,i.h)("span",{class:"group-card__title__span"},e.title))),d&&(0,i.h)("arcgis-group-badges",{group:e,portal:t,class:"group-card__badges--compact",scale:"s",showTooltips:!0,width:"narrow"}),(0,i.h)("slot",{name:"content-end"})))}render(){var e,t;const{group:r,portal:a,selection:s,selected:o,formFactor:n,api:l,i18n:c,link:d,loaded:p,newTab:u,showDateCreated:h,showDateUpdated:m,showOwner:g,showBadges:v,showSummary:b}=this,w=null!==(e=this.baseUrl)&&void 0!==e?e:null===(t=q.c.config)||void 0===t?void 0:t.baseUrl,y=Y.a.preview===this.group.id,f="top"===this.preview,x=this.link?"a":"div",_=Object.assign({href:d},u?{target:"_blank",rel:"noopener noreferrer"}:{}),S={tabIndex:0,role:"button","aria-haspopup":"dialog","aria-labelledby":"open-details",onKeyPress:e=>{"Enter"!==e.key&&" "!=e.key||(e.preventDefault(),this.handleCardClick())}},k=this.getAccessInfo(r.access);return(0,i.h)(i.H,null,"compact"===this.view?this.renderCompactView():(0,i.h)("section",Object.assign({class:{"group-card":!0,"group-card--hoverable":"none"!==s,[`group-card--${n}`]:!0,"group-card--loaded":p}},d?{}:{onClick:this.handleCardClick},f&&!d?S:{},{ref:e=>this.sectionEl=e}),(0,i.h)("slot",{name:"content-top"}),(0,i.h)(x,Object.assign({class:{"group-card__upper":!0,"group-card__upper--link":!!d}},d?_:{},{onMouseOver:()=>this.hover=!0,onMouseOut:()=>this.hover=!1}),(0,i.h)("div",{class:"group-card-flex group-card__top"},"single"===s&&(0,i.h)("calcite-radio-button",{class:"group-card__input",checked:o,value:r.title,name:this.name,ref:e=>this.radioButton=e,onClick:e=>{e.stopPropagation()},onCalciteRadioButtonChange:()=>{this.arcgisGroupCardSelect.emit({group:r,selected:!o})}},(0,i.h)("span",{class:"screen-readers-only"},c.select.replace("${title}",r.title))),"multiple"===s&&(0,i.h)("calcite-checkbox",{class:"group-card__input",checked:o,indeterminate:this.indeterminate,onClick:e=>{e.stopPropagation()},onCalciteCheckboxChange:()=>{this.arcgisGroupCardSelect.emit({group:r,selected:!this.selected})},value:r.id,ref:e=>this.checkbox=e},(0,i.h)("span",{class:"screen-readers-only"},r.title)),(0,i.h)("div",{class:"flex-0 group-card__thumbnail"},(0,i.h)("arcgis-group-thumbnail",{group:r,portal:a,scale:"xl"})),(0,i.h)("div",{class:"group-card-flex-1"},(0,i.h)("div",{class:"group-card-flex"},(0,i.h)("div",{class:"group-card__content"},(0,i.h)("h3",{class:{"group-card__title":!0,"group-card__title--padded":b&&!!r.snippet}},(0,i.h)("span",{class:"group-card__title__span"},r.title)),b&&r.snippet&&(0,i.h)("p",{class:"group-card__summary"},r.snippet.length>250?`${r.snippet.substring(0,250)}…`:r.snippet),(0,i.h)("div",{class:{"group-card__details":!0,"group-card__details--stacked":this.width<580}},h&&(0,i.h)("span",{class:"group-card__detail group-card__divider"},this.createdText),m&&(0,i.h)("span",{class:"group-card__detail group-card__divider"},this.updatedText),this.showViewableBy&&(0,i.h)("span",{class:"group-card__detail group-card__divider"},(0,i.h)("calcite-icon",{icon:k.icon,scale:"s",class:"group-card__detail__icon"})," ",c.viewableBy.replace("${level}",k.text)),v&&this.width>=Z.b.sm&&(0,i.h)("arcgis-group-badges",{appearance:this.hover?"outline-fill":"solid",group:r,portal:a,width:this.width<840?"narrow":"full",class:"group-card__badges group-card__detail group-card__divider",scale:"s",showTooltips:!0})),v&&this.width<Z.b.sm&&(0,i.h)("arcgis-group-badges",{appearance:this.hover?"outline-fill":"solid",group:r,portal:a,width:this.width<Z.b.xxs?"narrow":"full",class:"group-card__badges",scale:"s",showTooltips:!0}))),(0,i.h)("slot",{name:"content-end"})))),(0,i.h)("div",{class:"group-card__footer",onClick:e=>{e.stopPropagation()}},(0,i.h)("div",{class:"group-card__footer__start"},(0,i.h)("slot",{name:"actions-start"}),g&&(0,i.h)("div",{class:"group-card__profile-wrap",onClick:e=>{e.preventDefault(),e.stopPropagation()}},(0,i.h)("arcgis-user-popup",{underline:!0,username:r.owner,api:l,portal:a,baseUrl:w,class:"group-card__owner",onArcgisUserPopupInternalUIAction:e=>{e.stopPropagation(),this.arcgisGroupBrowserInternalUIAction.emit(e.detail)}}))),"action"===this.preview&&(0,i.h)("calcite-button",{scale:"s",appearance:y?"solid":"outline-fill",kind:"neutral",onClick:e=>{e.preventDefault(),e.stopPropagation(),this.arcgisGroupBrowserCardPreview.emit(this.group)}},y?c.hidePreview:c.preview),(0,i.h)("slot",{name:"actions-end"}))))}get el(){return(0,i.d)(this)}};se.style=':host{display:block;min-width:0px}.group-card{position:relative;display:flex;height:100%;flex-direction:column;color:var(--calcite-color-text-1);opacity:0;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);transition-duration:150ms;outline-color:transparent;background-color:var(--calcite-color-foreground-1);transition-property:background-color, outline, outline-offset, opacity;border:1px solid var(--calcite-color-border-3)}.group-card:focus{z-index:10;outline:2px solid var(--calcite-color-brand);outline-offset:-2px}.group-card--loaded{opacity:1}.group-card--selected{border-color:var(--calcite-color-brand)}.group-card--hoverable{cursor:pointer}.group-card__top{padding:1rem}.group-card__hover-text{position:absolute;inset:0px;display:flex;align-items:center;justify-content:center;text-align:center;font-size:1rem;font-weight:500;opacity:0;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;background-color:rgba(21, 21, 21, 0.7);color:white}.group-card__upper{flex:1 1 0%;background-color:var(--calcite-color-foreground-1);transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s}.group-card__upper:hover{background-color:var(--calcite-color-background)}.group-card__upper:hover .group-card__hover-text,.group-card:focus .group-card__hover-text{opacity:1}.group-card__upper--compact{display:flex;align-items:center;padding-top:0.5rem;padding-bottom:0.5rem;padding-left:0.75rem;padding-right:0.75rem}.group-card__upper--link{color:var(--calcite-color-text-1);text-decoration-line:none;outline-color:transparent}.group-card__upper--link:focus{z-index:10;outline:2px solid var(--calcite-color-brand);outline-offset:2px}.group-card__title__span{position:relative;display:inline;border-style:none;background-color:transparent;padding:0px;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;background-image:linear-gradient(transparent, transparent);background-position-x:0%, 100%;background-position-y:min(1.25em, 100%);background-repeat:no-repeat, no-repeat;background-size:100% 1px, 100% 1px}.group-card--previewed .group-card__title__span{background-image:linear-gradient(var(--calcite-color-text-3), var(--calcite-color-text-3))}.group-card__content{display:flex;min-width:0px;flex:1 1 0%;flex-direction:column}.group-card__details{display:flex;flex-direction:row;flex-wrap:wrap}.group-card__details--stacked{flex-direction:column}.group-card__detail{font-size:0.875rem;color:var(--calcite-color-text-2)}.group-card__detail__icon{margin-inline-end:0.5rem}.group-card__calendar-icon{color:var(--calcite-color-text-3);margin-inline-end:0.5rem}.group-card__footer{margin-top:auto;display:flex;align-items:center;background-color:var(--calcite-color-foreground-1);padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;border-top:1px solid var(--calcite-color-border-3)}.group-card__footer__start{display:flex;min-width:0px;flex:1 1 0%;flex-direction:row;align-items:center;overflow:hidden;margin-inline-end:0.75rem}.group-card__footer__start--selectable{margin-inline-start:1.5rem}.group-card__profile-wrap{max-width:100%;padding:0.25rem}.group-card__updated{font-size:0.875rem;color:var(--calcite-color-text-2)}.group-card__updated--xs{margin-top:0.5rem}.group-card__divider{display:flex;align-items:center;flex:0 0 auto}.group-card__divider:not([empty]):before{content:"";height:1.25rem;width:1px;background-color:var(--calcite-color-border-1);margin-inline:0.75rem}.group-card__details--stacked .group-card__divider:before{display:none}.group-card__divider:first-child:before{display:none}.group-card-flex{display:flex}.group-card-flex-1{min-width:0px;flex:1 1 0%}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.group-card__input{margin-inline-end:1rem;margin-top:0.125rem}.group-card__title{margin-top:0px;margin-bottom:0px;overflow-wrap:break-word;padding-top:0px;padding-bottom:0px;font-size:1rem;font-weight:500;line-height:1.375}.group-card__title--compact{overflow:hidden;text-overflow:ellipsis;white-space:nowrap;margin-inline-end:1rem}.group-card__summary{margin:0px;margin-top:0.25rem;margin-bottom:0.25rem;flex:1 1 0%;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0px;font-size:0.875rem;line-height:1.25}.group-card__thumbnail{margin-inline-end:1rem}.group-card__thumbnail--compact{width:2.75rem;height:2.75rem}.group-card__badges{margin-top:0.25rem}.group-card__owner{min-width:0px}.group-card--panel{margin-bottom:0px;cursor:pointer;border-bottom:1px solid var(--calcite-color-border-1);outline:1px solid rgba(0, 0, 0, 0)}.group-card--panel:hover{background-color:var(--calcite-color-foreground-2)}.group-card--border-top{border-top:1px solid var(--calcite-color-border-1)}.group-card--border-top:hover{--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow)}.group-card--xs .group-card__top,.group-card--xxs .group-card__top{padding:0.75rem}.group-card--xs .group-card__title--padded,.group-card--xxs .group-card__title--padded{margin-bottom:0.25rem}.group-card--xs .group-card__footer,.group-card--xxs .group-card__footer{padding-top:0.25rem;padding-bottom:0.25rem;padding-left:0.75rem;padding-right:0.75rem}.group-card--xs .group-card__detail,.group-card--xxs .group-card__detail{margin-top:0.25rem;margin-bottom:0.25rem;font-size:0.75rem;line-height:1.35}.group-card--xs .group-card__title,.group-card--xxs .group-card__title{font-size:0.875rem}.group-card--xxs .group-card__thumbnail{padding-inline-start:0.75rem;width:4.25rem}.group-card--xs .group-card__thumbnail{padding-inline-start:0.5rem;width:5rem}';const oe=class{constructor(e){(0,i.r)(this,e),this.groups=void 0,this.portal=void 0,this.scale="m",this.tooltip=!1,this.maxGroups=3,this.total=void 0}render(){const{groups:e,portal:t,maxGroups:r,scale:a,total:s,tooltip:o}=this,n=(null!=s?s:e.length)-r;return(0,i.h)(i.H,null,e.slice(0,r).map((e=>(0,i.h)("arcgis-group-thumbnail",{scale:a,group:e,portal:t,tooltip:o,class:"thumbnail"}))),n>0&&(0,i.h)("calcite-chip",{value:n,scale:a},"+",n))}get el(){return(0,i.d)(this)}};oe.style=":host{display:flex}.thumbnail{margin-inline-end:0.25rem}";const ne=class{constructor(e){var t;(0,i.r)(this,e),this.arcgisItemInternalUIAction=(0,i.c)(this,"arcgisItemInternalUIAction",7),this.arcgisItemCardActionsOpen=(0,i.c)(this,"arcgisItemCardActionsOpen",7),this.arcgisItemCardSelect=(0,i.c)(this,"arcgisItemCardSelect",7),this.arcgisItemBrowserCardPreview=(0,i.c)(this,"arcgisItemBrowserCardPreview",7),this.handleResizeEvent=e=>{e.forEach((e=>{e.contentRect.width>0&&this.resize(e.contentRect.width)}))},this.handleCardClick=()=>{if(this.link)return;const e="top"===this.preview,{item:t,selection:r}=this;!e||this.recycleBin?"single"===r?this.arcgisItemCardSelect.emit({item:t,selected:!0}):"multiple"===r&&this.arcgisItemCardSelect.emit({item:t,selected:!(0,ee.i)({item:t,selectedItems:this.selectedItems})}):this.arcgisItemBrowserCardPreview.emit(t)},this.item=void 0,this.portal=void 0,this.user=void 0,this.api=4,this.baseUrl=null===(t=null===q.c||void 0===q.c?void 0:q.c.config)||void 0===t?void 0:t.baseUrl,this.link=void 0,this.newTab=void 0,this.selected=void 0,this.selection=void 0,this.name=void 0,this.preview=void 0,this.showOwner=!0,this.showDateUpdated=!0,this.showItemType=!0,this.showSummary=!1,this.showBadges=!0,this.showAccess=void 0,this.showFavorite=void 0,this.showThumbnail=!0,this.actions=[],this.recycleBin=void 0,this.selectedItems=void 0,this.panel=void 0,this.view=void 0,this.bucket=void 0,this.width=void 0,this.groups=void 0,this.hover=void 0,this.formFactor=void 0,this.updatedText="",this.shortUpdatedText="",this.loaded=void 0,this.noSpaceForDate=!0}async restoreFocus(){this.link&&this.linkEl?this.linkEl.focus():"top"===this.preview&&this.sectionEl&&this.sectionEl.focus()}resize(e){switch(!0){case e>Z.b.md:this.formFactor="lg";break;case e>Z.b.sm:this.formFactor="md";break;case e>Z.b.xs:this.formFactor="sm";break;case e>Z.b.xxs:this.formFactor="xs";break;default:this.formFactor="xxs"}}async componentWillLoad(){var e,t,r,i,a;const s=await(0,n.g)(this.el);this.i18n=s[0],null!==(e=this.formFactor)&&void 0!==e||(this.formFactor="lg"),this.width||(null!==(t=this.resizeObserver)&&void 0!==t||(this.resizeObserver=new ResizeObserver(this.handleResizeEvent)),this.resizeObserver.observe(this.el));const o=(0,Q.a)(this.item.modified);this.updatedText=this.i18n.lastUpdated.replace("${date}",o),this.shortUpdatedText=o,this.portal=null!==(r=this.portal)&&void 0!==r?r:q.c.portal,this.user=null!==(i=this.user)&&void 0!==i?i:q.c.user,this.api=null!==(a=this.api)&&void 0!==a?a:q.c.api}async componentDidLoad(){await(0,s.t)(100),this.loaded=!0}disconnectedCallback(){var e;null===(e=this.resizeObserver)||void 0===e||e.unobserve(this.el)}renderSelection(e){const{i18n:t,item:r}=this,a=this.selection,s={"item-browser-card__input":!0,"item-browser-card__input--end":"grid"===this.view};return"single"===a?(0,i.h)("calcite-radio-button",{class:s,checked:e,value:r.title,name:this.name,onClick:e=>{e.stopPropagation()},onCalciteRadioButtonChange:()=>{this.arcgisItemCardSelect.emit({item:r,selected:!0})}},(0,i.h)("span",{class:"screen-readers-only"},t.select.replace("${title}",r.title))):"multiple"===a?(0,i.h)("calcite-checkbox",{class:s,checked:e,onClick:e=>{e.stopPropagation()},onCalciteCheckboxChange:()=>{this.arcgisItemCardSelect.emit({item:r,selected:!e})},value:r.id},(0,i.h)("span",{class:"screen-readers-only"},r.title)):null}renderOwner(){var e,t;const{item:r,api:a,portal:s,formFactor:o}=this,n=(null==s?void 0:s.isPortal)&&"all"===this.bucket?"https://www.arcgis.com/home/":null!==(e=this.baseUrl)&&void 0!==e?e:null===(t=q.c.config)||void 0===t?void 0:t.baseUrl;return this.showOwner?(0,i.h)("div",{class:"item-browser-card__profile-wrap",onClick:e=>{e.preventDefault(),e.stopPropagation()}},(0,i.h)("arcgis-user-popup",{underline:!0,item:r,api:a,portal:s,baseUrl:n,showName:"grid"!==this.view,checkOnline:s.isPortal&&"all"===this.bucket,class:"item-browser-card__owner",scale:"xxs"===o?"s":"m",onArcgisUserPopupInternalUIAction:e=>{e.stopPropagation(),this.arcgisItemInternalUIAction.emit(e.detail)}})):null}renderItemType(){const{item:e,portal:t,showItemType:r,formFactor:a}=this;return r?(0,i.h)("arcgis-item-type",{class:{"item-browser-card__divider":!this.panel},scale:["xxs","xs"].includes(a)?"s":"m",item:e,portal:t}):null}render(){var e;const{item:t,user:r,portal:a,formFactor:s,i18n:o,loaded:n,showDateUpdated:l,showItemType:c,showOwner:d,showBadges:p,showSummary:u,showThumbnail:h,link:m,newTab:g,showAccess:v,actions:b}=this,w=this.preview===this.item.id,y="grid"===this.view,f="top"===this.preview,x={tabIndex:0,role:"button","aria-haspopup":"dialog","aria-labelledby":"open-details",onKeyPress:e=>{"Enter"!==e.key&&" "!=e.key||(e.preventDefault(),this.handleCardClick())}},_=this.selection,S=["single","multiple"].includes(_)&&(0,ee.i)({item:this.item,selectedItems:this.selectedItems}),k=this.link?"a":"div",I=Object.assign({href:m},g?{target:"_blank",rel:"noopener noreferrer"}:{}),D=["xxs","xs"].includes(s);return(0,i.h)(i.H,null,(0,i.h)("section",Object.assign({class:{"item-browser-card":!0,"item-browser-card--hoverable":!0,[`item-browser-card--${s}`]:!0,"item-browser-card--panel":this.panel,"item-browser-card--loaded":n,"item-browser-card--previewed":this.preview===t.id,"item-browser-card--selected":S},onMouseOver:()=>this.hover=!0,onMouseOut:()=>this.hover=!1},m?{}:{onClick:this.handleCardClick},f&&!m?x:{},{ref:e=>this.sectionEl=e}),(0,i.h)("slot",{name:"content-top"}),(0,i.h)(k,Object.assign({class:{"item-browser-card__upper":!0,"item-browser-card__upper--link":!!m}},m?I:{},{ref:e=>this.linkEl=e}),y&&h&&(0,i.h)("figure",{class:"item-browser-card__thumbnail--grid"},(0,i.h)("arcgis-item-browser-card-thumbnail",{item:t,user:r,portal:a}),f&&!m&&(0,i.h)("div",{class:"item-browser-card__hover-text",id:"open-details"},(null==this?void 0:this.preview)===t.id?o.closeDetails:o.openDetails)),(0,i.h)("div",{class:"item-browser-card-flex item-browser-card__top"},!y&&this.renderSelection(S),(0,i.h)("div",{class:"item-browser-card-flex-1"},(0,i.h)("div",{class:"item-browser-card-flex"},(0,i.h)("div",{class:"item-browser-card__content"},(0,i.h)("div",{class:"item-browser-card-flex"},(0,i.h)("h3",{class:{"item-browser-card__title":!0,"item-browser-card__title--padded":c||u&&!!t.snippet,"item-browser-card__title--grid":y,"item-browser-card-flex-1":!0}},(0,i.h)("span",{class:"item-browser-card__title__span"},t.title)),y&&this.renderSelection(S)),u&&t.snippet&&!D&&(0,i.h)("p",{class:"item-browser-card__summary"},t.snippet.length>250?`${t.snippet.substring(0,250)}…`:t.snippet),this.panel&&this.renderItemType(),(0,i.h)("div",{class:"item-browser-card__details"},!this.panel&&this.renderItemType(),l&&"xxs"!==s&&(0,i.h)("span",{class:{"item-browser-card__detail":!0,"item-browser-card__divider":!0}},["xxs","xs","sm"].includes(s)||y?this.shortUpdatedText:this.updatedText),p&&(0,i.h)("arcgis-item-badges",{item:t,user:r,portal:a,width:"lg"!==s||y?"narrow":"full",showTooltips:!0,class:{"item-browser-card__badges":!0,"item-browser-card__divider":!0},scale:"s"}))),!y&&h&&(0,i.h)("figure",{class:"item-browser-card__thumbnail"},(0,i.h)("arcgis-item-browser-card-thumbnail",{item:t,user:r,portal:a}))),(0,i.h)("slot",{name:"content-end"})))),(0,i.h)("div",{class:"item-browser-card__footer",onClick:e=>{const t=e.target.classList;t.contains("item-browser-card__footer")||t.contains("item-browser-card__footer__start")||e.stopPropagation()},onKeyPress:e=>{"Enter"!==e.key&&" "!=e.key||e.stopPropagation()}},(0,i.h)("div",{class:{"item-browser-card__footer__start":!0,"item-browser-card__footer__start--owner":d}},(0,i.h)("slot",{name:"actions-start"}),this.renderOwner()),v&&(0,i.h)("div",{class:"item-browser-card__access-wrap",onClick:e=>{e.preventDefault(),e.stopPropagation()}},(0,i.h)("slot",{name:"share-summary"},(0,i.h)("arcgis-item-share-summary",{item:t,class:"item-browser-card__access",scale:"xxs"===s?"s":"m",showText:!y&&"lg"===s,user:r,groups:this.groups}))),(v||y&&d)&&(null===(e=this.actions)||void 0===e?void 0:e.length)>0&&(0,i.h)("span",{class:{"item-browser-card__footer-divider":!0,"item-browser-card__footer-divider--list":!y}}),this.showFavorite&&(0,i.h)("arcgis-item-favorite",{item:t,portal:a,user:r||(null===q.c||void 0===q.c?void 0:q.c.user),iconOnly:!0}),"action"===this.preview&&!this.recycleBin&&(0,i.h)("calcite-button",{scale:"s",appearance:w?"solid":"outline",kind:"neutral",onClick:e=>{e.preventDefault(),e.stopPropagation(),this.arcgisItemBrowserCardPreview.emit(this.item)}},w?o.hidePreview:o.preview),(null==_?void 0:_.includes("sublayer"))&&(0,i.h)("arcgis-item-browser-card-sublayer-select",{item:t,user:r,portal:a,selection:"multiple-sublayer"===_?"multiple":"single"}),(0,i.h)("slot",{name:"actions-end"}),b.length>0&&(0,i.h)("calcite-action",{scale:"s",slot:"trigger",alignment:"center",appearance:"solid",text:o.moreOptions,textEnabled:!1,icon:"ellipsis",onClick:e=>{this.arcgisItemCardActionsOpen.emit({el:e.target,actions:b})}}))))}get el(){return(0,i.d)(this)}static get watchers(){return{width:["resize"]}}};ne.style=':host{display:block;min-width:0px}.item-browser-card{position:relative;box-sizing:border-box;display:flex;height:100%;flex-direction:column;color:var(--calcite-color-text-1);opacity:0;--tw-shadow:0 0 #0000;--tw-shadow-colored:0 0 #0000;box-shadow:var(--tw-ring-offset-shadow, 0 0 #0000), var(--tw-ring-shadow, 0 0 #0000), var(--tw-shadow);transition-duration:150ms;outline-color:transparent;background-color:var(--calcite-color-foreground-1);transition-property:background-color, outline, outline-offset, opacity;border:1px solid var(--calcite-color-border-3)}.item-browser-card:focus{z-index:10;outline:2px solid var(--calcite-color-brand);outline-offset:-2px}.item-browser-card--loaded{opacity:1}.item-browser-card--selected{border-color:var(--calcite-color-brand)}.item-browser-card--hoverable{cursor:pointer}.item-browser-card__top{padding:1rem}.item-browser-card__hover-text{position:absolute;inset:0px;display:flex;align-items:center;justify-content:center;text-align:center;font-size:1rem;font-weight:500;opacity:0;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;background-color:rgba(21, 21, 21, 0.7);color:white}.item-browser-card__upper{flex:1 1 0%;background-color:var(--calcite-color-foreground-1);transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s}.item-browser-card__upper:hover{background-color:var(--calcite-color-background)}.item-browser-card__upper:hover .item-browser-card__hover-text,.item-browser-card:focus .item-browser-card__hover-text{opacity:1}.item-browser-card__upper--link{color:var(--calcite-color-text-1);text-decoration-line:none;outline-color:transparent}.item-browser-card__upper--link:focus{z-index:10;outline:2px solid var(--calcite-color-brand);outline-offset:2px}.item-browser-card__title__span{position:relative;display:inline;border-style:none;background-color:transparent;padding:0px;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;background-image:linear-gradient(transparent, transparent);background-position-x:0%, 100%;background-position-y:min(1.25em, 100%);background-repeat:no-repeat, no-repeat;background-size:100% 1px, 100% 1px}.item-browser-card--previewed .item-browser-card__title__span{background-image:linear-gradient(var(--calcite-color-text-3), var(--calcite-color-text-3))}.item-browser-card--previewed{outline:1px solid var(--calcite-color-brand);outline-offset:-2px}.item-browser-card--previewed .item-browser-card__top{background-color:var(--calcite-color-background)}.item-browser-card__content{display:flex;min-width:0px;flex:1 1 0%;flex-direction:column}.item-browser-card__details{margin-top:0.25rem;display:flex;flex-direction:row}.item-browser-card__detail{font-size:0.875rem;color:var(--calcite-color-text-2)}.item-browser-card__calendar-icon{color:var(--calcite-color-text-3);margin-inline-end:0.5rem}.item-browser-card__footer{margin-top:auto;display:flex;align-items:center;background-color:var(--calcite-color-foreground-1);padding-left:1rem;padding-right:1rem;padding-top:0.5rem;padding-bottom:0.5rem;border-top:1px solid var(--calcite-color-border-3)}.item-browser-card__footer__start{display:flex;min-width:0px;flex:1 1 0%;flex-direction:row;align-items:center;justify-content:space-between;overflow:hidden;margin-inline-end:0.75rem}.item-browser-card__footer__start--owner{margin-inline-start:-0.25rem}.item-browser-card__footer-divider{border-right:1px solid var(--calcite-color-border-input);margin-inline-start:0.75rem;margin-inline-end:0.5rem;display:inline-block;height:1.5rem;width:0px}.item-browser-card__footer-divider--list{margin-left:1rem;margin-right:1rem}.item-browser-card__profile-wrap{box-sizing:border-box;max-width:100%;padding:0.25rem}.item-browser-card__summary{margin:0px;padding:0px;font-size:0.875rem;color:var(--calcite-color-text-2)}.item-browser-card__divider{display:flex;align-items:center;flex:0 0 auto}.item-browser-card__divider:not([empty]):before{content:"";height:1.25rem;width:1px;background-color:var(--calcite-color-border-1);margin-inline:0.75rem}.item-browser-card__divider:first-child:before{display:none}.item-browser-card-flex{display:flex}.item-browser-card-flex-1{min-width:0px;flex:1 1 0%}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.item-browser-card__input{margin-inline-end:1rem;margin-top:0.125rem}.item-browser-card__input--end{margin-inline-end:0px;margin-inline-start:1rem}.item-browser-card__title{margin-top:0px;margin-bottom:0px;overflow-wrap:break-word;padding-top:0px;padding-bottom:0px;font-size:1.125rem;font-weight:500;line-height:1.375}.item-browser-card__title--grid{font-size:1rem}.item-browser-card__title--padded{margin-bottom:0.5rem}.item-browser-card__snippet{margin:0px;margin-bottom:0.75rem;flex:1 1 0%;padding:0px;font-size:0.875rem}.item-browser-card__badges--stacked{margin-top:0.5rem}.item-browser-card__thumbnail{margin:0px;box-sizing:content-box;width:8rem;padding:0px;padding-inline-start:2rem;flex:0 0 auto}.item-browser-card__thumbnail--grid{position:relative;margin:0px;width:100%;padding:0px;border-bottom:1px solid var(--calcite-color-foreground-2)}.item-browser-card__owner{min-width:0px}.item-browser-card__access-wrap{display:flex;align-items:center}.item-browser-card--panel{margin-bottom:0px;cursor:pointer;display:block;width:100%}.item-browser-card--xs .item-browser-card__top,.item-browser-card--xxs .item-browser-card__top{padding:0.75rem}.item-browser-card--xs .item-browser-card__title--padded,.item-browser-card--xxs .item-browser-card__title--padded{margin-bottom:0.25rem}.item-browser-card--xs .item-browser-card__footer,.item-browser-card--xxs .item-browser-card__footer{padding-top:0.25rem;padding-bottom:0.25rem;padding-left:0.75rem;padding-right:0.75rem}.item-browser-card--xs .item-browser-card__detail,.item-browser-card--xxs .item-browser-card__detail{font-size:0.75rem}.item-browser-card--xs .item-browser-card__title,.item-browser-card--xxs .item-browser-card__title{font-size:0.875rem}.item-browser-card--xxs .item-browser-card__title{font-size:0.75rem}.item-browser-card--xxs .item-browser-card__thumbnail{padding-inline-start:0.75rem;width:55px}.item-browser-card--xxs .item-browser-card__footer__start{margin-inline-end:0.5rem}.item-browser-card--xs .item-browser-card__thumbnail{width:5rem;padding-inline-start:0.5rem}';const le=({portal:e,selectedGroupData:t,user:r})=>!ce(e)||function(e){return(e.privileges||[]).includes("portal:user:shareToGroup")}(r)||(0,o.I)(r)&&((e,t)=>{const{username:r,orgId:i}=e;return t.every((({group:e})=>{const t=r===(null==e?void 0:e.owner),a=i===e.orgId;return t||a}))})(r,t),ce=e=>!(!e.urlKey||!e.customBaseUrl)||e.isPortal,de=({shareMode:e,currentUsername:t,user:r,userGroupLookup:i,isPrivate:a})=>{var s;let o,n=[];if(i){let o=[];"admin"===e&&(null===(s=i[t])||void 0===s?void 0:s.length)&&t!==r.username&&(o=[...i[t]]),"admin"===e&&a||i[r.username].forEach((e=>{o.some((t=>t.id===e.id))||o.push(e)})),null==o||o.forEach((e=>{var t;const r=null===(t=e.userMembership)||void 0===t?void 0:t.memberType;!e.isViewOnly||"owner"!==r&&"admin"!==r||n.push(e.id)}))}n.length&&(o=`(isviewonly:false OR id:(${n.join(" OR ")}))`);const l=n.length?` OR id:(${n.join(" OR ")})`:"";switch(e){case"default":return o||`(owner:${t} OR isviewonly:false)`;case"group":return`owner:${t} -capabilities:updateitemcontrol`;case"admin":return r.username===t?`(isviewonly:false${l} OR owner:${r.username}) -capabilities:updateitemcontrol`:`(owner:${t} OR isviewonly:false${l})`;default:return""}},pe={needEditableLayers:[],needPubliclyEditableLayers:[],needDataCollectionLayers:[],needsShareLevelUpdateLayers:[],premiumLayers:[],notEditableLayers:[],needAuthentication:[],needBDFSDatastoreUpdate:[]},ue=["private","org","public"],he=(e,t)=>t.every((t=>(0,o.i)(t,e))),me=(e,t)=>{const r=null==e?void 0:e.orgId;return t.every((t=>{var i,a;return(0,o.i)(t,e)||t.orgId===r||(null===(i=t.sourceJSON)||void 0===i?void 0:i.orgId)===r||(null===(a=t.portal)||void 0===a?void 0:a.id)===r||t.isOrgItem}))},ge=(e,t)=>e.length!==t.length||t.some((t=>{const r=e.find((e=>e.group.id===t.group.id));return!r||!(0,s.f)(r.selectedByItemIds,t.selectedByItemIds)})),ve=class{constructor(e){(0,i.r)(this,e),this.workflowCancel=(0,i.c)(this,"workflowCancel",7),this.workflowComplete=(0,i.c)(this,"workflowComplete",7),this.initialShareLevels=[],this.initialSelectedGroupData=[],this.initialSelectedGroupDataLookup={},this.showOptions=!1,this.shareLevelOptions=["private","org","public"],this.possibleShareLevelOptions=["private","org","public"],this.shareLevelIcon={private:"user",org:"organization",public:"globe"},this.isPublicUser=!1,this.hasItemBlockedFromPublicOrPublicDev=!1,this.hasItemBlockedFromPublic=!1,this.hasPrivateItem=!1,this.shareMode="default",this.hasIndoorsSpaces=!1,this.sharingDetailToEmit=null,this.didUpdateSharingDetail=!1,this.shareItemResult=null,this.handleNewShareResult=async()=>{const{portal:e,shareItemResult:{newItems:t}}=this,r=(await Promise.all(t.map((t=>j(t,e))))).reduce(((e,{result:t})=>(t&&Object.keys(t).forEach((r=>{e[r]=[...e[r],...t[r]]})),e)),Object.assign({},pe));this.sharingDetail=r},this.updateSharing=async()=>{var e;this.loadingText=this.i18n.updatingInfo,this.isLoading=!0;const{items:t,selectedShareLevels:r,initialSelectedGroupData:i,selectedGroupData:a,portal:s,user:o,isShareLevelDirty:n,checkItemPDCIssue:l,confirmedPDC:c}=this,{shareGroupIds:u,unshareGroupIds:h}=((e,t)=>{const r=e.filter((e=>!t.some((t=>t.group.id===e.group.id)))),i=t.filter((t=>{const r=e.find((e=>e.group.id===t.group.id));return!r||r.selectedByItemIds.length<t.selectedByItemIds.length}));return{unshareGroupIds:r.map((e=>e.group.id)),shareGroupIds:i.map((e=>e.group.id))}})(i,a);if(!c&&!await l())return;const m=n||1===t.length?r[0]:null,g=h.length?(async(e,t,r)=>{const{portal:i,user:a}=r,s=`${(0,d.g)(i)}content/users/${a.username}/unshareItems`;try{return{result:(await(0,p.r)(s,i,{body:{items:e.join(","),groups:(null==t?void 0:t.length)?t.join(","):null},usePost:!0})).results}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(t.map((e=>e.id)),h,{portal:s,user:o}):void 0,b=u.length||n?v(t,m,u,{portal:s,user:o}):void 0,[w]=await Promise.all([b,g]),y=u.filter((e=>!(null==w?void 0:w.result.some((({notSharedWith:t})=>t.includes(e))))));let f=[...t];null!=m&&(f=t.map((e=>{if("private"!==m)return Object.assign(Object.assign({},e),{access:m});const t=null==a?void 0:a.some((({selectedByItemIds:t})=>t.includes(e.id)));return Object.assign(Object.assign({},e),{access:t?"shared":"private"})}))),(null==a?void 0:a.length)||(f=f.map((e=>"shared"===e.access?Object.assign(Object.assign({},e),{access:"private"}):e))),y.length&&(f=f.map((e=>"private"===e.access?Object.assign(Object.assign({},e),{access:"shared"}):e)));const x={newGroupShared:y,newGroupUnshared:h,newShareLevel:m,newItems:f,shareErrors:null!==(e=null==w?void 0:w.result.filter((({error:e})=>e)).map((({itemId:e})=>({item:t.find((t=>t.id===e)),code:"notSharedWith"}))))&&void 0!==e?e:[]};this.shareItemResult=x,this.items=f,this.handleNewShareResult()},this.checkItemPDCIssue=async()=>{const{items:e,portal:t,isShareLevelDirty:r,selectedShareLevels:i}=this,a=e.filter((e=>(0,m.i)(e.typeKeywords,e.type))),s=r&&"public"===i[0];if(a.length>0&&s){this.isLoading=!0;const e=await Promise.all(a.map((e=>(0,h.i)(e,t))));this.isLoading=!1;const r=a.filter(((t,r)=>e[r]));if(r.length){const e=!r.every((e=>e.typeKeywords.includes("Public Data Collection")));return this.confirmationDialogType=e?"publicDataCollectionDisabled":"publicDataCollectionEnabled",!1}}return!0},this.handleNewPendingSelectedGroups=e=>{const{items:t,pendingGroupBrowserData:r,selectedGroupData:i}=this,a=(0,s.a)(r.groupData.length>0?r.groupData:i,(e=>({key:e.group.id,data:e}))),o=t.map((e=>e.id)),n=e.map((e=>a[e.id]||{group:e,selectedByItemIds:o}));this.pendingGroupBrowserData={groupData:n,groupDataLookup:(0,s.a)(n,(e=>({key:e.group.id,data:!0}))),groupCount:n.reduce(((e,t)=>(e[t.group.id]=t.selectedByItemIds.length,e)),{}),isDirty:ge(n,i)}},this.revertShareLevel=()=>{this.selectedShareLevels=[...this.initialShareLevels]},this.setShareLevel=e=>{this.selectedShareLevels=this.selectedShareLevels.map((()=>e))},this.revertGroupData=()=>{this.selectedGroupData=[...this.initialSelectedGroupData]},this.revertPendingGroupData=e=>{const{initialSelectedGroupData:t,pendingGroupBrowserData:r,handleNewPendingSelectedGroups:i}=this,a=t.find((({group:t})=>t.id===e)),s=r.groupData,o=s.find((({group:t})=>t.id===e));let n=[];n=a?o?s.map((t=>t.group.id!==e?t:a)):[...s,a]:s.filter((({group:t})=>t.id!==e)),i(n.map((({group:e})=>e)))},this.applyPendingGroupData=()=>{this.selectedGroupData=[...this.pendingGroupBrowserData.groupData],this.unBrowseGroups()},this.closeDialog=e=>{var t,r;null==e||e.stopPropagation();const{workflowCancel:i,currentStep:a}=this;"finish"!==a&&i.emit({newShareLevel:null!==(r=null===(t=this.shareItemResult)||void 0===t?void 0:t.newShareLevel)&&void 0!==r?r:null,cancelAtStep:a})},this.unBrowseGroups=()=>{this.isBrowsingGroups=!1},this.renderGroupBrowser=()=>{const{api:e,i18n:t,user:r,portal:a,config:s,pendingGroupBrowserData:o,browserPagination:n,browserGroups:l,handleNewPendingSelectedGroups:c,isBrowsingGroups:d,isPublicUser:p,items:u,shareMode:h,groupBrowserQ:m,initialSelectedGroupDataLookup:g,revertPendingGroupData:v,hasIndoorsSpaces:b,groupBrowserAllUsers:w,groupBrowserSearchUsername:y,hasPrivateItem:f}=this,x=u.length,_="admin"===h&&!f&&w.length>1;return(0,i.h)("arcgis-group-browser",{view:"compact",class:{hidden:!d},config:s,user:r,api:e,portal:a,selection:"multiple",searchUser:y,selectedGroups:o.groupData.map((e=>e.group)),hasIndoorsSpaces:b,q:m,onArcgisGroupBrowserUpdate:e=>{const{results:t,num:r,start:i,total:a}=e.detail;this.browserGroups=t,this.browserPagination={start:i,num:r,total:a}},onArcgisGroupBrowserLoading:()=>{this.browserGroups=[]},onArcgisGroupBrowserSelect:e=>c(e.detail)},(0,i.h)("arcgis-group-browser-top-bar",{slot:"top-bar","filter-toggle":!0},(0,i.h)("arcgis-group-browser-search",{slot:"search",term:""})),(0,i.h)("arcgis-group-browser-sort",{slot:"sort"}),(0,i.h)("arcgis-group-browser-filters",{slot:"filters"},_&&(0,i.h)("arcgis-group-browser-filter-groups-by-user",{searchUsernames:w.map((e=>e.username)),searchUsername:y,onArcgisGroupBrowserUsernamesFilter:e=>{this.groupBrowserSearchUsername=e.detail}}),(0,i.h)("arcgis-group-browser-filter-owner",{searchUsername:y}),!p&&(0,i.h)(i.F,null,(0,i.h)("arcgis-group-browser-filter-membership",null),(0,i.h)("arcgis-group-browser-filter-member-org",null),(0,i.h)("arcgis-group-browser-filter-special-groups",null)),(0,i.h)("arcgis-group-browser-filter-date",{property:"modified"}),(0,i.h)("arcgis-group-browser-filter-date",{property:"created"})),(0,i.h)("arcgis-group-browser-content",{slot:"content",class:"js-content"},(l||[]).map((e=>{const s=e.id;return(0,i.h)("arcgis-item-share-group-card",{key:s,user:r,portal:a,i18n:t,group:e,groupCount:o.groupCount,initialSelectedGroupDataLookup:g,selectedGroupDataLookup:o.groupDataLookup,totalItemCount:x,onRevertClick:()=>{v(s)}})}))),(0,i.h)("arcgis-group-browser-pagination",{slot:"pagination",class:"js-pagination",total:null==n?void 0:n.total,start:null==n?void 0:n.start,num:null==n?void 0:n.num}))},this.renderShareSelectGroup=()=>{const{config:e,hasItemBlockedFromPublicOrPublicDev:t,hasSingleShareLevel:r,i18n:a,initialSelectedGroupData:n,isBrowsingGroups:l,isLoading:c,isPublicUser:d,isShareLevelDirty:p,items:u,loadingText:h,portal:m,possibleShareLevelOptions:g,revertGroupData:v,revertShareLevel:b,selectedGroupData:w,selectedShareLevels:y,setShareLevel:f,shareLevelCount:x,shareLevelIcon:_,shareLevelOptions:S,shareMode:k,showOptions:I,user:D,hasPrivateItem:C}=this,L=u.length,G=L.toString(),P=t?a.sharingLimitedItemDisclaimer:a.cannotShareToLevelDisclaimer;return(0,i.h)("div",{class:{hidden:l}},c&&(0,i.h)("arcgis-new-item-loader",{active:c,text:h}),(0,i.h)("div",{class:"section"},(0,i.h)("arcgis-new-item-description",{header:a.shareLevel.title,headerSideContent:p&&(0,i.h)("calcite-button",{appearance:"transparent",iconStart:"reset",disabled:c,onClick:()=>{((e,t,r,i)=>!ce(i)&&!(0,o.H)(e)&&(({items:e,groupData:t})=>e.filter((e=>{const t=e.access;return"private"===t||"shared"===t})).reduce(((e,r)=>e||(({item:e,groupData:t})=>t.reduce(((t,r)=>t||!!r.selectedByItemIds&&r.selectedByItemIds.includes(e.id)),!1))({item:r,groupData:t})),!1))({items:t,groupData:r}))(D,u,w,m)?this.confirmationDialogType="publicAccountRevertShareLevel":b()}},a.revert)}),(0,i.h)("div",{class:"content-container"},(0,i.h)("calcite-tile-select-group",{layout:"vertical",class:"tile-select"},I&&ue.map((e=>{const t=!g.includes(e);if(t&&d)return null;const s=x[e]+("private"===e?x.shared:0),n=s>0,l=s.toString(),p=a.shareLevel.level[e].title,u=(e=>`share-level-${e}`)(e);return(0,i.h)("div",{class:"tile-select-wrapper",key:e},t&&(0,i.h)("calcite-tooltip",{referenceElement:u},(0,i.h)("span",{class:"tooltip-container"},P)),(0,i.h)("calcite-tile-select",{id:u,checked:r&&n,heading:p,"aria-label":t?P:void 0,description:a.shareLevel.level[e][d&&"public"===e?"descriptionPublicUser":"description"],name:"dev-cred-create-mode",inputEnabled:!0,width:"full",type:"radio",value:e,icon:_[e],disabled:c||t,class:{"active-but-not-selected":n&&!r},onCalciteTileSelectChange:e=>{const t=e.target.value;m.isPortal||!((e,t,r,i)=>!ce(i)&&!(0,o.H)(e)&&"private"===t&&Object.keys(r).length>0)(D,t,w,m)?f(t):this.confirmationDialogType="publicAccountSetShareToPrivate"}}),!r&&n&&(0,i.h)("div",{class:"share-hint"},(0,i.h)("arcgis-information",{label:a.shareCountLabel,paddedContent:!0,placement:"bottom-end",overlayPositioning:"fixed"},a.shareCountTooltip.replace("${shareLevel}",p).replace("${numItem}",l).replace("${totalItem}",G)),(0,i.h)("p",null,a.shareCountHint.replace("${numItem}",l).replace("${totalItem}",G))))}))),I&&g.length<S.length&&!this.hasItemBlockedFromPublic&&!d&&(0,i.h)("p",{class:"information-text"},a.sharingLimitedDisclaimer),(!I||!g.length)&&(0,i.h)("p",{class:"information-text"},a.noShareDisclaimer))),(0,i.h)("div",{class:"section"},(0,i.h)("arcgis-item-share-group",{items:u,user:D,portal:m,config:e,shareMode:k,i18n:a.shareGroup,isLoading:c,onEditGroupClick:()=>{((e,t,r)=>!ce(r)&&!(0,o.G)(e)&&t.some((e=>"private"===e)))(D,y,m)?this.confirmationDialogType="publicAccountOpenGroupBrowser":this.isBrowsingGroups=!0},onAnalyzeUserGroupComplete:e=>{const{initialSelectedGroups:t,userGroupLookup:r,allUsers:i,searchUsername:a}=e.detail;this.initialSelectedGroupData=t,this.selectedGroupData=t,this.initialSelectedGroupDataLookup=(0,s.a)(t,(({group:e,selectedByItemIds:t})=>({key:e.id,data:0===t.length?"none":t.length===L?"all":"indeterminate"}))),this.groupBrowserSearchUsername=a,this.groupBrowserAllUsers=i,this.groupBrowserQ=de({shareMode:k,currentUsername:a,user:D,userGroupLookup:r,isPrivate:C})},onDirtyChange:e=>this.isSelectedGroupsDirty=e.detail,onRemoveClick:()=>this.selectedGroupData=[],onRevertClick:()=>{((e,t,r)=>(0,o.d)(e)&&t.some((e=>"private"===e))&&r.length>0)(D,y,n)?this.confirmationDialogType="publicAccountRevertGroup":v()},selectedGroupData:w})))},this.renderShareModal=()=>{const{closeDialog:e,i18n:t,isLoading:r,updateSharing:a,isShareLevelDirty:s,isSelectedGroupsDirty:o,isBrowsingGroups:n,applyPendingGroupData:l,unBrowseGroups:c,renderShareSelectGroup:d,renderGroupBrowser:p,currentStep:u,hasSharingIssue:h,pendingGroupBrowserData:m}=this,g=s||o;return("share"===u||null===h)&&(0,i.h)("calcite-modal",{onCalciteModalClose:e,open:!0,widthScale:n?"m":"s",outsideCloseDisabled:!0,escapeDisabled:!0,class:{"group-browser-modal":n}},(0,i.h)("div",{slot:"header"},t[n?"titleGroup":"title"]),(0,i.h)("div",{slot:"content",class:"stage"},p(),d()),n?(0,i.h)(i.F,null,(0,i.h)("calcite-button",{slot:"primary",appearance:"outline",kind:"brand","data-id":"cancelButton",onClick:c,width:"full"},t.cancel),m.isDirty&&(0,i.h)("calcite-button",{slot:"secondary",appearance:"solid",kind:"brand",onClick:l,width:"full"},t.apply)):(0,i.h)(i.F,null,(0,i.h)("calcite-button",{slot:"primary",appearance:"outline",kind:"brand","data-id":"cancelButton",onClick:()=>e(),width:"full"},t.cancel),g&&(0,i.h)("calcite-button",{slot:"secondary",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:a,width:"full",disabled:r},t.save)))},this.renderDepCheckModal=()=>{const{api:e,config:t,portal:r,user:a,items:s,closeDialog:o,hasSharingIssue:n,sharingDetail:l}=this;return n&&(0,i.h)("arcgis-dependency-check",{api:e,items:s.map((e=>({item:e}))),portal:r,user:a,config:t,isActive:!0,preProcessedSharingDetail:l,onWorkflowCancel:o,onWorkflowComplete:e=>{e.stopPropagation(),this.didUpdateSharingDetail=!0,this.sharingDetailToEmit=Object.assign({},l),this.sharingDetail=Object.assign({},pe)}})},this.renderConfirmationDialog=()=>{const{confirmationDialogType:e}=this;if(!e)return null;const{i18n:t,isLoading:r,revertShareLevel:a,setShareLevel:s,revertGroupData:o}=this,{title:n,description:l}=t.shareWarning[e],c="publicDataCollectionDisabled"===e;return(0,i.h)("calcite-modal",{onCalciteModalClose:e=>{e.stopPropagation(),this.confirmationDialogType=null},open:!!this.confirmationDialogType,widthScale:"s",outsideCloseDisabled:!0,escapeDisabled:!0},(0,i.h)("div",{slot:"header",class:"header"},n),(0,i.h)("div",{slot:"content"},l),(0,i.h)("calcite-button",{slot:"primary",appearance:c?"solid":"outline",kind:"brand","data-id":"cancelButton",onClick:()=>this.confirmationDialogType=null,width:"full"},t[c?"ok":"cancel"]),!c&&(0,i.h)("calcite-button",{slot:"secondary",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:()=>{switch(e){case"publicAccountOpenGroupBrowser":s("public"),this.isBrowsingGroups=!0;break;case"publicAccountSetShareToPrivate":s("private"),this.selectedGroupData=[];break;case"publicAccountRevertShareLevel":a(),this.selectedGroupData=[];break;case"publicAccountRevertGroup":s("public"),o();break;case"publicDataCollectionEnabled":this.confirmedPDC=!0,this.updateSharing()}this.confirmationDialogType=null},width:"full",disabled:r},t.update))},this.api=void 0,this.user=void 0,this.portal=void 0,this.config=void 0,this.items=void 0,this.hasTrustedOrgs=!1,this.isLoading=void 0,this.selectedShareLevels=[],this.isShareLevelDirty=!1,this.shareLevelCount={private:0,shared:0,org:0,public:0},this.hasSingleShareLevel=!1,this.selectedGroupData=[],this.isSelectedGroupsDirty=!1,this.loadingText=null,this.isBrowsingGroups=!1,this.confirmationDialogType=null,this.confirmedPDC=!1,this.browserPagination=void 0,this.browserGroups=[],this.pendingGroupBrowserData={groupData:[],groupDataLookup:{},groupCount:{},isDirty:!1},this.groupBrowserQ="",this.groupBrowserSearchUsername="",this.groupBrowserAllUsers=[],this.currentStep="share",this.sharingDetail=null,this.hasSharingIssue=null}handleIsBrowsingGroupsChange(){this.isBrowsingGroups&&this.handleNewPendingSelectedGroups(this.selectedGroupData.map((({group:e})=>e)))}handleShareLevelChange(){const{selectedShareLevels:e,initialShareLevels:t,selectedGroupData:r,items:i}=this;this.isShareLevelDirty=((e,t,r,i)=>e.some(((e,a)=>{const s=t[a];if("shared"===s&&"private"===e){const e=r[a];return!i.some((t=>t.selectedByItemIds.includes(e.id)))}return s!==e})))(e,t,i,r),this.shareLevelCount=e.reduce(((e,t)=>(e[t]++,e)),{private:0,shared:0,org:0,public:0}),this.hasSingleShareLevel=e.every((t=>t===e[0]))}async componentWillLoad(){var e;const{portal:t,user:r,el:i}=this,a=await(0,n.g)(i);this.i18n=a[0],this.loadingText=this.i18n.retrievingInfo;const s=this.items.map((e=>e.id)),{result:l,error:c}=await(0,p.b)(s,this.portal);this.items=l&&!c?l:this.items.map((e=>{var t;return null!==(t=e.sourceJSON)&&void 0!==t?t:e})),q.c.api=this.api,this.isPublicUser=(0,o.d)(r);const{items:d}=this;this.initialShareLevels=this.items.map((e=>e.access)),this.selectedShareLevels=[...this.initialShareLevels],this.possibleShareLevelOptions=((e,t,r)=>{const i=(0,o.d)(e);let a=ue;return i?a=["private","public"]:r.canSharePublic||(0,o.f)(e)||(a=["private","org"]),a=a.filter((i=>((e,t,r,i)=>{var a;if("private"===e)return!0;const s=he(r,t),n=me(r,t),l=(0,o.f)(r)&&!(0,o.u)(r)&&n,c=(0,o.f)(r)&&(0,o.u)(r)&&n,d=(0,o.d)(r);if("org"===e)return!d&&((0,o.H)(r)&&(s||l)||(0,o.J)(r)&&(l||c));if("public"===e){const e=(0,o.c)((null==i?void 0:i.subscriptionInfo)||(null===(a=null==i?void 0:i.sourceJSON)||void 0===a?void 0:a.subscriptionInfo));if(1===t.length&&(b(t[0])||e&&w(t[0])))return!1;const n=i.canSharePublic;return d||(0,o.K)(r)&&(s&&n||l)||(0,o.L)(r)&&(l||c)}})(i,t,e,r))),a})(r,d,t);const u=((e,t,r)=>{var i;const a=e[0];if((0,o.i)(a,t))return"default";const s=!a.orgId&&!(null===(i=a.sourceJSON)||void 0===i?void 0:i.orgId)||me(t,[a]);return(0,o.M)({items:e,user:t,portal:r})&&s?"admin":"group"})(d,r,t);this.showOptions="group"!==u,this.shareMode=u,this.hasPrivateItem=d.some((e=>"private"===e.access));const h=(null==t?void 0:t.subscriptionInfo)||(null===(e=null==t?void 0:t.sourceJSON)||void 0===e?void 0:e.subscriptionInfo);this.hasItemBlockedFromPublic=d.some(b),this.hasItemBlockedFromPublicOrPublicDev=this.hasItemBlockedFromPublic||(0,o.c)(h)&&d.some(w),this.hasIndoorsSpaces=d.some((e=>{var t;return null===(t=e.typeKeywords)||void 0===t?void 0:t.includes("EditExtensionIndoorsSpaces")}))}handleSharingDetailChange(){const{sharingDetail:e}=this;this.hasSharingIssue=null!==e?Object.keys(e).some((t=>e[t].length>0)):null}handleHasSharingIssueChange(){const{hasSharingIssue:e}=this;e?this.currentStep="review-sharing":!1===e&&(this.currentStep="finish")}handleCurrentStepChange(){var e,t,r,i,a;const{currentStep:s,didUpdateSharingDetail:o,workflowComplete:n,sharingDetailToEmit:l,shareItemResult:c}=this;if("finish"!==s)return;const d=o;n.emit({dependentLayersWithSourceItems:d&&l?Object.values(l).reduce(((e,t)=>(e.push(...t.map((({layer:e,sourceItem:t})=>({layer:e,sourceItem:t})))),e)),[]):[],newShareLevel:null!==(e=null==c?void 0:c.newShareLevel)&&void 0!==e?e:null,newGroupShared:null!==(t=null==c?void 0:c.newGroupShared)&&void 0!==t?t:[],newGroupUnshared:null!==(r=null==c?void 0:c.newGroupUnshared)&&void 0!==r?r:[],newItems:null!==(i=null==c?void 0:c.newItems)&&void 0!==i?i:[],didUpdateDependentLayersSharing:d,shareErrors:null!==(a=null==c?void 0:c.shareErrors)&&void 0!==a?a:[]})}render(){const{renderShareModal:e,renderDepCheckModal:t,renderConfirmationDialog:r}=this;return(0,i.h)(i.F,null,e(),t(),r())}get el(){return(0,i.d)(this)}static get watchers(){return{isBrowsingGroups:["handleIsBrowsingGroupsChange"],selectedShareLevels:["handleShareLevelChange"],sharingDetail:["handleSharingDetailChange"],hasSharingIssue:["handleHasSharingIssueChange"],currentStep:["handleCurrentStepChange"]}}};ve.style=".stage{height:100%}.group-browser-modal{--calcite-modal-width:1080px;--calcite-modal-content-padding:0;--calcite-modal-height:min(800px, 80vh)}.hidden{display:none}.section:not(:last-child){margin-bottom:2rem}calcite-flow{height:100%}.content-container{margin-top:0.5rem}.active-but-not-selected{position:relative;z-index:2}.tile-select-wrapper{position:relative}.share-hint{display:flex;align-items:center;position:absolute;font-size:0.875rem;inset-inline-end:0.5rem;top:0.5rem;z-index:3}.share-hint>p{margin-bottom:0px;margin-inline-start:0.5rem;margin-top:2px}.information-text{font-weight:500;margin-top:0px;margin-bottom:0px;margin-top:0.5rem;font-size:0.875rem}.group-item-counter{font-size:0.875rem;margin-top:0px;margin-bottom:0px}.revert-single-group-cta:first-child,.group-item-counter:first-child{margin-inline-start:0.5rem}";const be=(e,t)=>(0,p.r)(`${(0,d.b)(e)}/community/groups`,e,{body:t,usePost:!0}),we=class{constructor(e){(0,i.r)(this,e),this.editGroupClick=(0,i.c)(this,"editGroupClick",7),this.dirtyChange=(0,i.c)(this,"dirtyChange",7),this.analyzeUserGroupComplete=(0,i.c)(this,"analyzeUserGroupComplete",7),this.removeClick=(0,i.c)(this,"removeClick",7),this.revertClick=(0,i.c)(this,"revertClick",7),this.hasGroups=!1,this.user=void 0,this.portal=void 0,this.config=void 0,this.items=void 0,this.shareMode=void 0,this.isLoading=void 0,this.i18n=void 0,this.selectedGroupData=[],this.initialSelectedGroups=[],this.canShareItemToGroup=!1,this.isDirty=!1,this.isSharingMixed=!1}handleSelectedGroupsChange(e){const{user:t,initialSelectedGroups:r,items:i,portal:a}=this;this.canShareItemToGroup=le({selectedGroupData:e,user:t,portal:a}),this.isDirty=ge(e,r),this.isSharingMixed=((e,t)=>t.some((({selectedByItemIds:t})=>t.length!==e.length)))(i,e),this.dirtyChange.emit(this.isDirty)}async componentDidLoad(){const{user:e,portal:t,items:r,shareMode:i}=this;this.isLoading=!0;const{result:n}=await(async({items:e,portal:t,shareMode:r,user:i})=>{try{const a=await(async({user:e,items:t,portal:r})=>{var i;if((0,o.N)(t,e)&&(0,o.M)({items:t,user:e,portal:r})&&(0,o.O)(e)){const e=t[0];return null!==(i=e.itemOwner)&&void 0!==i?i:await(0,te.f)(e.owner,r)}return e})({user:i,items:e,portal:t}),s=i.username===a.username?[i]:[i,a],n=await(async({user:e,portal:t,shareMode:r,itemOwner:i})=>{const a=await Promise.all([(0,te.f)(e.username,t),"admin"===r&&i.username!==e.username?(0,te.f)(i.username,t):null]);return Object.assign({[e.username]:a[0].groups},!!a[1]&&{[i.username]:a[1].groups})})({portal:t,user:i,shareMode:r,itemOwner:a}),l=(await Promise.all(s.map((a=>(async({user:e,portalUser:t,portal:r,shareMode:i,userGroupLookup:a,items:s})=>{var o;const n={q:de({shareMode:i,currentUsername:t.username,user:e,userGroupLookup:a,isPrivate:"private"===(null===(o=s[0])||void 0===o?void 0:o.access)}),num:100,searchUserAccess:"groupMember",searchUserName:e.username};try{const e=await be(r,n);if(-1===e.nextStart)return{result:e.results};const t=Math.ceil(e.total/100)-1,i=[];for(let e=0;e<t;e++)i.push(new Promise((async t=>{const i=100*(e+1)+1;t((await be(r,Object.assign(Object.assign({},n),{start:i}))).results)})));const a=(await Promise.all(i)).flat();return{result:[...e.results,...a]}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})({user:a,portalUser:i,portal:t,shareMode:r,userGroupLookup:n,items:e}))))).flatMap((e=>e.result)),c=l.map((({id:e})=>e));return{result:{uniqueGroups:l.filter(((e,t)=>c.indexOf(e.id)===t)),userGroupLookup:n,allUsers:s,searchUsername:i.username===a.username?i.username:a.username}}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})({user:e,portal:t,items:r,shareMode:i}),{uniqueGroups:l,userGroupLookup:c,searchUsername:p,allUsers:u}=n,{result:h}=await(async(e,t,r)=>{try{const i=await Promise.all((0,s.g)(t,100).map((async t=>(0,a.r)(`${(0,d.g)(r)}/content/itemsgroups`,{items:e.join(","),groups:t.join(",")})))),o={};return i.forEach((e=>{Object.keys(e).forEach((t=>{const r=e[t];o[t]?o[t].items=[...o[t].items,...r.items]:o[t]=r}))})),{result:o}}catch(e){return console.error(e),{error:{code:"unhandledError"}}}})(r.map((e=>e.id)),l.map((e=>e.id)),t),m=l.filter((({id:e})=>!!h[e])).map((e=>({group:e,selectedByItemIds:r.filter((({id:t})=>!!h[e.id].items.find((e=>e.itemId===t)))).map((e=>e.id))})));this.hasGroups=l.length>0,this.canShareItemToGroup=le({selectedGroupData:m,user:e,portal:t}),this.initialSelectedGroups=m,this.isLoading=!1,this.analyzeUserGroupComplete.emit({allUsers:u,initialSelectedGroups:m,userGroupLookup:c,searchUsername:p})}render(){const{i18n:e,isLoading:t,canShareItemToGroup:r,removeClick:a,revertClick:s,selectedGroupData:o,hasGroups:n,isDirty:l,isSharingMixed:c}=this;return(0,i.h)(i.H,null,(0,i.h)("arcgis-new-item-description",{header:e.title,headerSideContent:l?(0,i.h)("calcite-button",{appearance:"transparent",iconStart:"reset",disabled:t,onClick:()=>s.emit()},e.revert):o.length>0&&(0,i.h)("calcite-button",{appearance:"transparent",iconStart:"x",disabled:t,onClick:()=>a.emit()},e.remove)}),(0,i.h)("div",{class:"content"},(0,i.h)("div",{class:"group-container"},o.length>0?(0,i.h)("arcgis-group-thumbnail-stack",{groups:o.map((({group:e})=>e))}):(0,i.h)("p",{class:"information-text"},e[n?"noneYet":"noGroup"])),n&&r&&(0,i.h)("calcite-button",{iconStart:"group",appearance:"outline-fill",disabled:t,onClick:()=>this.editGroupClick.emit()},e.edit)),!t&&c&&(0,i.h)("p",{class:"information-text text-padding"},e.mixedGroupSharing))}get el(){return(0,i.d)(this)}static get watchers(){return{selectedGroupData:["handleSelectedGroupsChange"]}}};we.style=".content{display:flex;align-items:center;justify-content:space-between;margin-top:1rem}.information-text{font-size:0.875rem;margin-top:0px;margin-bottom:0px}.text-padding{margin-top:0.5rem}";const ye=class{constructor(e){(0,i.r)(this,e),this.revertClick=(0,i.c)(this,"revertClick",7),this.user=void 0,this.portal=void 0,this.group=void 0,this.groupCount=void 0,this.initialSelectedGroupDataLookup=void 0,this.selectedGroupDataLookup=void 0,this.totalItemCount=void 0,this.i18n=void 0}render(){const{group:e,groupCount:t,totalItemCount:r,initialSelectedGroupDataLookup:a,selectedGroupDataLookup:s,revertClick:o,portal:n,user:l,i18n:c}=this,d=r.toString(),p=e.id,u=t[e.id];let h="none";switch(!0){case u<r:h="indeterminate";break;case u===r:h="all"}const m=a[p],g=(!!m||"none"!==h)&&m!==h;return(0,i.h)("arcgis-group-card",{group:e,portal:n,user:l,name:e.title,selected:!!s[p],indeterminate:"indeterminate"===h,selection:"multiple",preview:"action",view:"compact",showOwner:!0,showDateUpdated:!0,showSummary:!0,key:p},(0,i.h)("span",{slot:"content-end"},u&&u>0&&(0,i.h)("span",{class:"group-item-counter"},c[g?"willShareCountHint":"sharedCountHint"].replace("${numItem}",u.toLocaleString()).replace("${totalItem}",d)),g&&(0,i.h)("calcite-button",{class:"revert-single-group-cta",appearance:"transparent",onClick:e=>{e.stopPropagation(),o.emit()}},c.revert)))}get el(){return(0,i.d)(this)}};ye.style=":host{display:contents}";const fe=class{constructor(e){(0,i.r)(this,e),this.arcgisItemShareSummaryUpdate=(0,i.c)(this,"arcgisItemShareSummaryUpdate",7),this.handleShareComplete=async e=>{await(0,s.t)(300);const t=e.detail.newGroupUnshared,r=e.detail.newGroupShared,i=(this.groups||[]).concat((null==r?void 0:r.length)?r:[]).filter((e=>!(null==t?void 0:t.includes(e))));this.isSharing=!1,this.item=Object.assign(Object.assign({},this.item),{access:e.detail.newShareLevel}),this.groups=i,this.arcgisItemShareSummaryUpdate.emit({itemId:this.item.id,itemTitle:this.item.title,access:e.detail.newShareLevel,groups:i})},this.item=void 0,this.portal=void 0,this.config=void 0,this.groups=void 0,this.showText=!0,this.user=void 0,this.allowEdit=void 0,this.scale="m",this.isSharing=!1,this.sharingActive=!1}async setFocus(){var e;null===(e=this.wrapper)||void 0===e||e.focus()}async componentWillLoad(){const{el:e}=this,t=await(0,n.g)(e,"arcgis-item-share-summary");this.i18n=t[0]}getIcon(e){return{private:"user",shared:"user",org:"organization",public:"globe"}[e]||"globe"}getFormattedStrings(){const{item:e,i18n:t,groups:r}=this;if(!(null==r?void 0:r.length))return{tooltip:t[e.access],access:t[e.access],groups:"shared"===e.access?t.shared:""};const i=`${(null==r?void 0:r.length)||0}`;return{access:"shared"===e.access?t.private:t[e.access],tooltip:t[`${e.access}Groups`].replace("${num}",i),groups:t.groups.replace("${num}",i)}}renderIcons(e,t){const{item:r,showText:a}=this;return(0,i.h)(i.F,null,(0,i.h)("calcite-icon",{class:"icon",icon:this.getIcon(r.access),scale:"s",key:"access"}),a&&(0,i.h)("span",{class:"text"},e),t&&(0,i.h)(i.F,null,(0,i.h)("calcite-icon",{class:"icon",icon:"plus",scale:"s"}),(0,i.h)("calcite-icon",{class:"icon",icon:"group",scale:"s"}),a&&(0,i.h)("span",{class:"text"},t)))}render(){const{showText:e,allowEdit:t,i18n:r,isSharing:a,item:o,user:n,portal:l,config:c}=this,{tooltip:d,access:p,groups:u}=this.getFormattedStrings();return(0,i.h)(i.H,null,t?(0,i.h)("button",{class:"wrapper wrapper--button",ref:e=>{this.wrapper=e},onClick:()=>{this.isSharing=!0}},this.renderIcons(p,u)):(0,i.h)("div",{class:"wrapper",ref:e=>{this.wrapper=e}},this.renderIcons(p,u)),!e&&(0,i.h)("calcite-tooltip",{referenceElement:this.wrapper,closeOnClick:!0,label:r.updateSharing.replace("${level}",d),placement:"bottom-start",offsetDistance:6,offsetSkidding:0,ref:e=>{e.referenceElement=this.wrapper},style:{pointerEvents:"none",zIndex:"calc(var(--calcite-z-index-modal) + 1)"}},d),a&&(0,i.h)("arcgis-tunnel",{reference:this.el},(0,i.h)("arcgis-item-share",{items:[o],portal:l||q.c.portal,user:n,api:4,config:c||q.c.config,onWorkflowCancel:async e=>{var t;"share"!==(null===(t=e.detail)||void 0===t?void 0:t.cancelAtStep)&&this.handleShareComplete(e),await(0,s.t)(300),this.isSharing=!1},onWorkflowComplete:this.handleShareComplete})))}get el(){return(0,i.d)(this)}};fe.style=":host{display:inline-flex;align-items:center;justify-content:center;min-width:var(--arcgis-item-share-summary-spacing)}:host([scale=s]){--arcgis-item-share-summary-text-size:0.75rem;--arcgis-item-share-summary-spacing:1rem;--arcgis-item-share-summary-padding:3px}:host([scale=s][show-text]){--arcgis-item-share-summary-padding:3px 8px}:host([scale=m]){--arcgis-item-share-summary-text-size:0.875rem;--arcgis-item-share-summary-spacing:1rem;--arcgis-item-share-summary-padding:7px}:host([scale=m][show-text]){--arcgis-item-share-summary-padding:7px 12px}:host([scale=l]){--arcgis-item-share-summary-text-size:1rem;--arcgis-item-share-summary-spacing:1rem;--arcgis-item-share-summary-padding:9px}:host([scale=l][show-text]){--arcgis-item-share-summary-padding:9px 16px}.wrapper{display:flex;align-items:center;background-color:var(--calcite-color-foreground-1);padding:var(--arcgis-item-share-summary-padding);border:1px solid var(--calcite-color-border-1);border-radius:calc(var(--arcgis-item-share-summary-spacing) + 0.5rem);font-size:var(--arcgis-item-share-summary-text-size)}.wrapper--button{cursor:pointer;outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s;font-family:inherit;line-height:1}.wrapper--button:hover{background-color:var(--calcite-color-foreground-2)}.wrapper--button:focus{outline:2px solid var(--calcite-color-brand);outline-offset:2px}.icon{display:block;flex-shrink:0;flex-grow:0;width:var(--arcgis-item-share-summary-spacing);height:var(--arcgis-item-share-summary-spacing)}.text{font-weight:400;color:var(--calcite-color-text-1);font-size:var(--arcgis-item-share-summary-text-size);line-height:1;margin-inline-start:calc(var(--arcgis-item-share-summary-spacing) / 4)}";const xe=class{constructor(e){(0,i.r)(this,e),this.arcgisSelectedDeselectAll=(0,i.c)(this,"arcgisSelectedDeselectAll",7),this.arcgisSelectedSelectPage=(0,i.c)(this,"arcgisSelectedSelectPage",7),this.checked=void 0,this.indeterminate=void 0,this.heading=void 0,this.emptyText=void 0,this.total=void 0,this.totalSelected=void 0,this.hideCheckbox=!1,this.hideSelectedText=!1,this.loading=void 0,this.selectedText=void 0}async componentWillLoad(){const{element:e}=this,t=await(0,n.g)(e);this.i18n=t[0]}renderButton(){const{totalSelected:e,selectedText:t,hideSelectedText:r,i18n:a}=this,s={class:"button",slot:"trigger",kind:"neutral",appearance:"outline-fill",iconEnd:e?"caret-down":null},o=null!=t?t:r?`(${e||0})`:a.selected.replace("${number}",`${e||0}`);return e?(0,i.h)("calcite-button",Object.assign({},s),o):(0,i.h)("span",{class:"white-button white-button--inactive"},o)}render(){const{i18n:e,checked:t,indeterminate:r,heading:a,totalSelected:s}=this;return(0,i.h)(i.H,null,(0,i.h)("div",{class:"wrapper"},!this.hideCheckbox&&(0,i.h)("calcite-label",{for:"selected-checkbox",class:{"white-button":!0}},(0,i.h)("span",{class:"screen-readers-only"},t?e.deselect:e.selectPage),(0,i.h)("calcite-checkbox",{class:"checkbox",id:"selected-checkbox",disabled:!this.total,checked:t,indeterminate:r,onCalciteCheckboxChange:e=>{e.stopPropagation(),e.currentTarget.checked?this.arcgisSelectedSelectPage.emit():this.arcgisSelectedDeselectAll.emit()}})),s?(0,i.h)("calcite-dropdown",{widthScale:"l",closeOnSelectDisabled:!0},this.renderButton(),(0,i.h)("calcite-dropdown-group",{selectionMode:"none",groupTitle:a},s<1&&(0,i.h)("span",{class:"empty"},this.emptyText),(0,i.h)("slot",null))):this.renderButton()))}get element(){return(0,i.d)(this)}};xe.style=".hide{display:none}.wrapper{display:flex;opacity:1;transition-property:opacity}.empty{display:block;padding:0.75rem;font-size:0.75rem;color:var(--calcite-color-text-3)}.loading{opacity:0}.button{margin-inline-end:0.5rem}@media (forced-colors: active){calcite-checkbox{border:1px solid var(--calcite-color-border-1)}}.white-button{border:1px solid var(--calcite-color-border-1);border-inline-end:none;font-family:inherit;box-sizing:border-box;display:flex;height:2rem;cursor:pointer;-webkit-appearance:none;-moz-appearance:none;appearance:none;align-items:center;background-color:var(--calcite-color-foreground-1);padding-left:0.75rem;padding-right:0.75rem;padding-top:0.5rem;padding-bottom:0.5rem;outline-color:transparent;transition:all var(--calcite-animation-timing) ease-in-out 0s, outline 0s, outline-offset 0s}.white-button:hover{box-shadow:inset 0 0 0 1px var(--calcite-color-foreground-3)}.white-button:focus{outline:2px solid var(--calcite-color-brand);outline-offset:2px}.white-button--inactive{pointer-events:none;margin-inline-end:0.5rem;border-inline-end:1px solid var(--calcite-color-border-1)}.white-button--disabled{pointer-events:none;opacity:0.25}.white-button__icon{margin-inline-start:0.75rem}calcite-dropdown[open] .white-button{border-bottom-color:var(--calcite-color-brand)}.page-range{font-size:0.875rem;font-weight:400;line-height:2rem;color:var(--calcite-color-text-2)}.screen-readers-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border-width:0}.checkbox{margin-top:0.75rem}";const _e=class{constructor(e){(0,i.r)(this,e),this.arcgisSelectedItemRemove=(0,i.c)(this,"arcgisSelectedItemRemove",7),this.heading=void 0,this.description=void 0}render(){return(0,i.h)(i.H,null,(0,i.h)("calcite-dropdown-item",{"selection-mode":"none",onClick:e=>{e.preventDefault(),e.stopPropagation(),this.arcgisSelectedItemRemove.emit()}},(0,i.h)("div",{class:"selected-item__wrapper"},(0,i.h)("slot",{name:"content-start"}),(0,i.h)("div",{class:"selected-item__content"},(0,i.h)("h4",{class:"selected-item__title",title:this.heading},this.heading),this.description&&(0,i.h)("p",{class:"selected-item__description"},this.description)),(0,i.h)("slot",{name:"content-end"}),(0,i.h)("calcite-icon",{icon:"x",scale:"s"}))))}get element(){return(0,i.d)(this)}};_e.style=".selected-item__wrapper{display:flex;width:15rem;align-items:center}.selected-item__content{box-sizing:border-box;flex:1 1 0%;width:100%;padding-inline-start:0.5rem;max-width:12rem}.selected-item__title{margin:0px;margin-top:0.25rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0px;font-size:0.875rem;font-weight:500;color:var(--calcite-color-text-1)}.selected-item__description{margin:0px;margin-top:0.25rem;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;padding:0px;font-size:0.75rem;font-weight:400;color:var(--calcite-color-text-1)}";const Se=class{constructor(e){(0,i.r)(this,e),this.geometry=void 0,this.type=void 0,this.scale=void 0,this.name=void 0,this.showName=!0,this.showIcon=!0,this.showType=!0,this.renderer=void 0}async componentWillLoad(){const e=await(0,n.g)(this.el);this.i18n=e[0]}render(){const{geometry:e,name:t,type:r,showName:a,showIcon:s,showType:o,renderer:n,i18n:l}=this,c=(0,re.g)({type:r,geometry:e});return n?n(Object.assign(Object.assign({},c),{name:t})):(0,i.h)(i.H,null,s&&(0,i.h)("calcite-icon",{icon:c.icon,class:"icon",scale:this.scale}),(o||a)&&(0,i.h)("div",{class:"text"},a&&(0,i.h)("div",{class:"name"},t),o&&(0,i.h)("div",{class:"type"},l[c.type])))}get el(){return(0,i.d)(this)}};Se.style=":host{display:flex;align-items:center;line-height:1.35;--sublayer-type-font-size:var(--calcite-font-size--1)}.text{flex:1 1 0%;margin-inline-start:0.5rem;color:inherit}.name{font-weight:500;word-wrap:break-word;word-break:break-word;font-size:var(--sublayer-type-font-size)}.type{font-weight:400;font-size:var(--sublayer-type-font-size)}"},53948:(e,t,r)=>{r.d(t,{a:()=>a,b:()=>s,i:()=>o});const i=["appExtensionError","forbiddenCredential","disabledSubscription","unauthorized","timeout","itemExists","exceedsFileSize","fileExists","emptyFile","unavailableGeocoder","dataNotAvailable","invalidShapefile","invalidFileGeodatabase","providePath","useSameFileName","invalidExtension","tokenRequired","serviceNameInvalid","titleInvalid","titleRequired","titleInUseService","summaryInvalid","missingUserOrPortal","dataStoreTitleInvalid","serviceNameExists","folderNameExists","serviceNotExist","unsupportedWFSVersion","invalidWMTS","invalidSpatialRef","emptyFeatureLayer","invalidFeatureLayerUrl","invalidUrl","httpWarning","flowAborted","duplicateFieldNames","failToFetchText","mapServiceError","noTilingSchemeFound","noMatchSpatialRef","invalidDataStorePublishType","noRegisteredServersForDataStore","noContentInDataStore","failToPublishFromDataStore","failToListDataStoreContents","invalidUsernameOrPassword","invalidConnection","invalidCredentials","invalidBigQueryProjectId","invalidSnowflakeServer","invalidSnowflakeRole","invalidSnowflakeWarehouse","invalidSnowflakeSchema","invalidSnowflakeDatabase","invalidAWSBucket","invalidAzureContainer","invalidJSON","unknownAGSType","unhandledError","incompatibleGeometries","multiPatchRestriction","invalidUniqueIdentifier","cannotAddNullData","exceededMaxFieldLength","invalidFieldType"],a=e=>i.includes(null==e?void 0:e.code),s=e=>e&&e.hasOwnProperty("code")&&e.hasOwnProperty("message")&&e.hasOwnProperty("details")&&(!e.details||Array.isArray(e.details)),o=e=>{const t=e.toLocaleLowerCase();return t.includes("unexpected end of")||t.includes("did not match the expected pattern")}},96138:(e,t,r)=>{r.d(t,{D:()=>a,b:()=>i,s:()=>s});const i={xxs:320,xs:480,sm:640,md:768,lg:1024,xl:1280},a=960;function s(e){var t,r;return null!==(t=(r=e.state).resizeObserver)&&void 0!==t||(r.resizeObserver=new ResizeObserver(o)),e.state.resizeObserver}function o(e){e.forEach((e=>{if(e.contentRect.width>0){const t=new CustomEvent("arcgisBrowserResize",{detail:{width:e.contentRect.width,height:e.contentRect.height}});e.target.dispatchEvent(t)}}))}},2409:(e,t,r)=>{function i(e){const t=e;return!(!(null==t?void 0:t.item)||!t.sublayer)}function a(e){const t=e;return!(!(null==t?void 0:t.item)||!t.task)}function s({item:e,sublayer:t,task:r,selectedItem:s}){var o,n,l;return a(s)&&r?(null==e?void 0:e.id)===(null===(o=s.item)||void 0===o?void 0:o.id)&&r===s.task:i(s)&&t?(null==e?void 0:e.id)===(null===(n=s.item)||void 0===n?void 0:n.id)&&t.id===(null===(l=s.sublayer)||void 0===l?void 0:l.id):(null==e?void 0:e.id)===s.id}function o({item:e,sublayer:t,task:r,selectedItems:i}){return(i||[]).some((i=>s({item:e,sublayer:t,task:r,selectedItem:i})))}function n({item:e,sublayer:t,task:r,selectedItems:i}){return(i||[]).filter((i=>!s({item:e,sublayer:t,task:r,selectedItem:i})))}function l({item:e,sublayer:t,task:r,selectedItems:i}){const a=r?{item:e,task:r}:t?{item:e,sublayer:t}:e;return o({item:e,sublayer:t,task:r,selectedItems:i})?[...i]:[...i,a]}function c({item:e,selectedItems:t}){return t.filter((t=>{var r;return(null===(r=t.item)||void 0===r?void 0:r.id)===(null==e?void 0:e.id)}))}function d(e){return a(e)||i(e)?e.item:e}function p({selectedItems:e,items:t}){let r=!1;const s=e.map((e=>{const s=d(e),o=t.find((e=>e.id===s.id));return o&&(r=!0),function(e,t){return a(t)||i(t)?Object.assign(Object.assign({},t),{item:e}):e}(o,e)}));return r?s:e}r.d(t,{a:()=>a,b:()=>i,d:()=>n,f:()=>c,g:()=>d,i:()=>o,s:()=>l,u:()=>p})},29471:(e,t,r)=>{r.d(t,{a:()=>o,g:()=>s});var i=r(23505),a=r(25484);function s(e){return(0,a.g)(e,"arcgis-group-browser")}const o=(0,i.c)({filters:{},type:"group-browser"}).state},25484:(e,t,r)=>{r.d(t,{a:()=>s,b:()=>n,g:()=>c,i:()=>a,o:()=>o});var i=r(63280);const a=e=>"item-browser"===e.state.type,s=(e,t,r)=>{t.onChange("filters",(t=>{t[e]&&t[e].value||r()}))},o=(e,t)=>{e.onChange("preview",(e=>{t()}))},n=(e,t)=>{e.onChange("groupId",(e=>{t()}))},l=new Map;function c(e,t){const r=l.get(e);if(r)return r;const a=(0,i.c)(e,t);return a?(l.set(e,a.store),a.store):null}},870:(e,t,r)=>{r.d(t,{I:()=>i,a:()=>a});const i=["folder","group","contentType"],a=99999},29208:(e,t,r)=>{function i({geometry:e,type:t}){switch(t){case"Catalog Layer":return{icon:"catalog-dataset",type:"catalog",isGeometry:!1};case"Parcel Layer":return{icon:"parcel-layer",type:"parcel",isGeometry:!1};case"Oriented Imagery Layer":return{icon:"oriented-imagery-layer",type:"oriented imagery",isGeometry:!1};case"Table":return{icon:"table",type:"table",isGeometry:!0}}switch(e){case"point":case"esriGeometryPoint":return{type:"point",icon:"point",isGeometry:!0};case"esriGeometryMultipoint":case"multipoint":return{type:"multipoint",icon:"layer-points",isGeometry:!0};case"line":case"polyline":case"esriGeometryPolyline":return{type:"line",icon:"line",isGeometry:!0};case"polygon":case"esriGeometryPolygon":return{type:"polygon",icon:"polygon",isGeometry:!0};case"multipatch":case"esriGeometryMultiPatch":return{type:"multipatch",icon:"cube",isGeometry:!0};default:return{type:"table",icon:"table",isGeometry:!0}}}r.d(t,{g:()=>i})}}]);
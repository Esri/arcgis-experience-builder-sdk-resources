System.register(["jimu-core","jimu-theme","jimu-ui","jimu-ui/basic/list-tree"],(function(e,t){var s={},a={},l={},r={};return{setters:[function(e){s.ClauseCascade=e.ClauseCascade,s.ClauseDisplayType=e.ClauseDisplayType,s.ClauseLabelDisplay=e.ClauseLabelDisplay,s.ClauseLogic=e.ClauseLogic,s.ClauseOperator=e.ClauseOperator,s.ClauseSourceType=e.ClauseSourceType,s.ClauseType=e.ClauseType,s.DataSourceManager=e.DataSourceManager,s.EMPTY_OPTION_VALUE=e.EMPTY_OPTION_VALUE,s.Immutable=e.Immutable,s.JimuFieldType=e.JimuFieldType,s.QueryScope=e.QueryScope,s.React=e.React,s.ReactRedux=e.ReactRedux,s.SqlExpressionMode=e.SqlExpressionMode,s.classNames=e.classNames,s.css=e.css,s.dataSourceUtils=e.dataSourceUtils,s.dateUtils=e.dateUtils,s.defaultMessages=e.defaultMessages,s.i18n=e.i18n,s.injectIntl=e.injectIntl,s.jsx=e.jsx,s.lodash=e.lodash,s.moduleLoader=e.moduleLoader,s.polished=e.polished},function(e){a.registerStyles=e.registerStyles,a.withStyles=e.withStyles,a.withTheme=e.withTheme},function(e){l.AdvancedSelect=e.AdvancedSelect,l.Button=e.Button,l.Checkbox=e.Checkbox,l.Dropdown=e.Dropdown,l.DropdownButton=e.DropdownButton,l.DropdownItem=e.DropdownItem,l.DropdownMenu=e.DropdownMenu,l.InputGroup=e.InputGroup,l.Modal=e.Modal,l.ModalBody=e.ModalBody,l.ModalFooter=e.ModalFooter,l.ModalHeader=e.ModalHeader,l.NumericInput=e.NumericInput,l.Popper=e.Popper,l.QueryScopeContext=e.QueryScopeContext,l.Radio=e.Radio,l.Select=e.Select,l.TextInput=e.TextInput,l.defaultMessages=e.defaultMessages},function(e){r.List=e.List,r.TreeItemActionType=e.TreeItemActionType}],execute:function(){e((()=>{var e={28455:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 1C4.15 1 1 4.15 1 8s3.15 7 7 7 7-3.15 7-7-3.15-7-7-7m1.167 11.667H6.834v-2.334h2.333zm-2.333-4.5V3.333h2.333v4.834z" clip-rule="evenodd"></path></svg>'},59788:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.146 4.653a.485.485 0 0 1 .708 0L8 10.24l5.146-5.587a.485.485 0 0 1 .708 0 .538.538 0 0 1 0 .738l-5.5 5.956a.485.485 0 0 1-.708 0l-5.5-5.956a.538.538 0 0 1 0-.738" clip-rule="evenodd"></path></svg>'},34750:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M7.5 0a.5.5 0 0 0-.5.5V7H.5a.5.5 0 0 0 0 1H7v6.5a.5.5 0 0 0 1 0V8h6.5a.5.5 0 0 0 0-1H8V.5a.5.5 0 0 0-.5-.5"></path></svg>'},54357:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},48891:e=>{"use strict";e.exports=s},34796:e=>{"use strict";e.exports=a},30726:e=>{"use strict";e.exports=l},59587:e=>{"use strict";e.exports=r}},t={};function i(s){var a=t[s];if(void 0!==a)return a.exports;var l=t[s]={exports:{}};return e[s](l,l.exports,i),l.exports}i.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return i.d(t,{a:t}),t},i.d=(e,t)=>{for(var s in t)i.o(t,s)&&!i.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var o={};return(()=>{"use strict";i.r(o),i.d(o,{ClauseInputEditor:()=>s,ClauseRelationship:()=>E,InputEditorRender:()=>Ge,SqlExpressionRuntime:()=>et,SqlExpressionSizeMode:()=>t,_SqlExpressionRuntime:()=>Xe,getCamelCase:()=>N,getClauseArrayByChange:()=>V,getClauseDefaultLabel:()=>P,getClauseLabel:()=>k,getClauseValObjByOperator:()=>Be,getCodedValueInputEditorsByOperatorAndSourceType:()=>Le,getDefaultClauseSet:()=>Ae,getDefaultClauseValObj:()=>ke,getDefaultGroupExpression:()=>He,getDefaultSingleClause:()=>Pe,getDisplayTypes:()=>_e,getInputEditor:()=>Fe,getInputEditorListByOperatorAndSourceType:()=>qe,getJimuFieldNamesBySqlExpression:()=>M,getJimuFieldTypeByEsriType:()=>We,getOperatorsByEsriType:()=>ze,getOperatorsByShortType:()=>T,getShownClauseNumberByExpression:()=>w,getTotalClauseNumberByExpression:()=>F,getUpdatedGroupExpression:()=>Qe,isAskForValueSupportedByOperatorAndSourceType:()=>Re,isCaseSensitiveSupportedByOperatorAndSourceType:()=>Ue,isSqlExpressionValid:()=>j,updateSQLExpressionByVersion:()=>A});var e={};i.r(e),i.d(e,{SqlExpressionClauseRuntime:()=>l,VIDoubleDateTimePicker:()=>r,VIDoubleNumberSelector:()=>r,VIPillSelector:()=>n,VIPredefinedSelector:()=>u});var t,s,a=i(48891);function l(e){const t=e.theme;return a.css`
    margin: 10px 0;

    .sql-expression-label, .sql-expression-displaylabel{
      width: 100%;
      font-size: ${a.polished.rem(13)};
      color: ${t.colors.black};
    }
    .sql-expression-input{
      width: 100%;

    }
    .sql-expression-hint{
      margin-top: 4px;
      font-size: ${a.polished.rem(12)};
      color: ${t.colors.palette.dark[300]};
      font-style: italic;
    }

    .clause-inline{
      display: flex;
      justify-content: space-between;
      align-items: center;

      .sql-expression-label{
        width: calc(40% - 8px);
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }
      .sql-expression-label, .sql-expression-displaylabel{
        line-height: 32px;
      }
      .sql-expression-input{
        width: calc(60% - 8px);
      }
    }

  `}function r(e){return a.css`
    justify-content: space-between;
    .double-input-connector{
      width: 30px;
      min-width: 30px;
      margin: 0 0.25rem;
      text-align: center;
      white-space: nowrap;
      text-overflow: ellipsis;
      overflow: hidden;
    }
  `}function n(e){const t=e.theme;return a.css`
    /** setting */
    .pill-selector-button{
      justify-content: space-between;
      display: flex;
      align-items: center;

      .pill-display-label{
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
        width: calc(100% - 20px);
      }
    }

    .pill-selector-popper{
      padding: 12px;
      max-width: 320px;
      max-height: 320px;
      overflow-y: auto;

      .jimu-btn{
        margin: 4px;
        max-width: 100%;
        white-space: nowrap;
        text-overflow: ellipsis;
        overflow: hidden;
      }
    }

    /** runtime */
    .pill-runtime-container{
      /* width: calc(100% + 10px); */
      width: 100%;
      .pill-btn-container{
        display: flex;
        flex-wrap: wrap;
        margin-left: -5px;
        margin-top: -5px;

        .pill-btn{
          margin: 5px;
          max-width: calc(100% - 10px);
          white-space: nowrap;
          text-overflow: ellipsis;
          overflow: hidden;
          /* &:first-of-type{
            margin-left: 0;
          }
          &:last-of-type{
            margin-right: 0;
          } */

          &.pill-dash-btn{
            border: 1px dashed ${t.colors.white}; /*TODO*/
          }
        }

        &.skeleton-btn-container {
          div {
            margin: 5px;
            height: 32px;
            background-color: ${t.colors.palette.light[200]};
            &.pill-skeleton1 {
              width: 72px;
            }
            &.pill-skeleton2 {
              width: 48px;
            }
            &.pill-skeleton3 {
              width: 64px;
            }
          }
        }
      }

      &.block-pills .pill-btn{
        display: block;
        margin-top: 10px;
      }
    }
  `}function u(e){const t=e.theme;return a.css`
    .predefined-list{
      min-height: 150px;

      .predefined-list-header{
        border-bottom: 1px solid ${t.colors.palette.dark[200]};
        line-height: 30px;

        .dragIcon{
          width: 26px;
        }
      }

      .predefined-list-content{
        max-height: calc(100vh - 255px);
        overflow-y: auto;

        .jimu-tree-item_template-card .jimu-tree-item__body{
          background-color: ${t.colors.palette.light[400]};
        }

        .predefined-item{
          display: flex;
          flex-grow: 1;
          padding: 5px 0px;
          margin-bottom: 2px;
        }
      }

      .predefined-value, .predefined-label{
        width: 160px;
        &.value-input-isValid{
          outline: 1px solid ${t.colors.palette.danger[700]};

          button:focus, input:focus, .dropdown-button[aria-expanded="true"] {
            border: none !important;
          }
        }
        .predefined-button-con {
          margin-left: -1px;
        }
      }
      .predefined-label {
        margin-left: 1.5rem;
      }

      .predefined-cbx{
        display: flex;
        width: 150px;
        justify-content: center;
        align-items: center;
      }

      .predefined-delete{
        width:100px;
        text-align: right;
      }

    }

    .invalide-label{
      color: ${t.colors.palette.danger[700]};
      font-size: 12px;
      margin-top: '-32px';
      margin-bottom: '8px'
    }
  `}function p(e,t=!1){const s="calc(100% - 8px)",a={inputEditorWidth:`calc(${s} * 0.44)`,dropDownWidth:`calc(${s} * 0.32)`,hasConnector:{inputEditorWidth:"calc((100% - 38px) * 0.5)"}};return e&&(t?(a.inputEditorWidth="calc(calc(100% - 4px) * 0.6)",a.dropDownWidth="calc(calc(100% - 4px) * 0.4)"):a.inputEditorWidth="100%"),a}!function(e){e.Small="SMALL",e.Medium="MEDIUM",e.Large="LARGE"}(t||(t={})),function(e){e.DoubleNumberSelector="DOUBLE_NUMBER_SELECTOR",e.TextInput="TEXT_BOX",e.UniquePredefinedSelector="UNIQUE_PREDEFINED_SELECTOR",e.MultiplePredefinedSelector="MULTIPLE_PREDEFINED_SELECTOR",e.FieldSelector="FIELD_SELECTOR",e.SimpleSelect="SIMPLE_SELECT",e.UniquePillWrapSelector="UNIQUE_PILL_WRAP_SELECTOR",e.MultipleSelect="MULTIPLE_SELECT",e.MultiplePillWrapSelector="MULTIPLE_PILL_WRAP_SELECTOR",e.DatePicker="DATE_PICKER",e.DateTimePicker="DATE_TIME_PICKER",e.DateRangeSelector="DATE_RANGE_SELECTOR",e.DoubleDatePicker="DOUBLE_DATE_PICKER",e.DoubleDateTimePicker="DOUBLE_DATE_TIME_PICKER",e.NumberListSelector="NUMBER_LIST_SELECTOR",e.BlankSelector="BLANK_SELECTOR"}(s||(s={}));const c=[s.FieldSelector],d=[s.SimpleSelect,s.UniquePillWrapSelector],h=[s.MultipleSelect,s.MultiplePillWrapSelector],m=[s.TextInput],v=[s.TextInput],g=[s.DoubleNumberSelector],y=[s.DatePicker,s.DateTimePicker],S=[s.DoubleDatePicker,s.DoubleDateTimePicker],f=[s.NumberListSelector],C=[s.SimpleSelect,s.UniquePillWrapSelector],O=[s.BlankSelector],I=[s.UniquePredefinedSelector],b=[s.MultiplePredefinedSelector],E={[a.ClauseOperator.StringOperatorIs]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:m,codedValueInputEditors:C,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c},[a.ClauseSourceType.SingleSelectFromUnique]:{normalInputEditors:d,codedValueInputEditors:C,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorIsNot]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:m,codedValueInputEditors:C,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c},[a.ClauseSourceType.SingleSelectFromUnique]:{normalInputEditors:d,codedValueInputEditors:C,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorContains]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:m,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.MultipleSelectFromPredefined]:{normalInputEditors:b,codedValueInputEditors:b,supportAskForValue:!0,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorDoesNotContain]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:m,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.MultipleSelectFromPredefined]:{normalInputEditors:b,codedValueInputEditors:b,supportAskForValue:!0,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorStartsWith]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:m,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.MultipleSelectFromPredefined]:{normalInputEditors:b,codedValueInputEditors:b,supportAskForValue:!0,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorDoesNotStartWith]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:m,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.MultipleSelectFromPredefined]:{normalInputEditors:b,codedValueInputEditors:b,supportAskForValue:!0,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorEndsWith]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:m,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.MultipleSelectFromPredefined]:{normalInputEditors:b,codedValueInputEditors:b,supportAskForValue:!0,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorDoesNotEndWith]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:m,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.MultipleSelectFromPredefined]:{normalInputEditors:b,codedValueInputEditors:b,supportAskForValue:!0,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorIsAnyOf]:{[a.ClauseSourceType.MultipleSelectFromUnique]:{normalInputEditors:h,codedValueInputEditors:h,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.MultipleSelectFromPredefined]:{normalInputEditors:b,codedValueInputEditors:b,supportAskForValue:!0,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorIsNoneOf]:{[a.ClauseSourceType.MultipleSelectFromUnique]:{normalInputEditors:h,codedValueInputEditors:h,supportAskForValue:!0,supportCaseSensitive:!0},[a.ClauseSourceType.MultipleSelectFromPredefined]:{normalInputEditors:b,codedValueInputEditors:b,supportAskForValue:!0,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorIsBlank]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:O,supportCaseSensitive:!0}},[a.ClauseOperator.StringOperatorIsNotBlank]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:O,supportCaseSensitive:!0}},[a.ClauseOperator.NumberOperatorIs]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:v,codedValueInputEditors:C,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c},[a.ClauseSourceType.SingleSelectFromUnique]:{normalInputEditors:d,codedValueInputEditors:C,supportAskForValue:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0}},[a.ClauseOperator.NumberOperatorIsNot]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:v,codedValueInputEditors:C,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c},[a.ClauseSourceType.SingleSelectFromUnique]:{normalInputEditors:d,codedValueInputEditors:C,supportAskForValue:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0}},[a.ClauseOperator.NumberOperatorIsAtLeast]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:v,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c},[a.ClauseSourceType.SingleSelectFromUnique]:{normalInputEditors:d,supportAskForValue:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0}},[a.ClauseOperator.NumberOperatorIsAtMost]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:v,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c},[a.ClauseSourceType.SingleSelectFromUnique]:{normalInputEditors:d,supportAskForValue:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0}},[a.ClauseOperator.NumberOperatorIsLessThan]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:v,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c},[a.ClauseSourceType.SingleSelectFromUnique]:{normalInputEditors:d,supportAskForValue:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0}},[a.ClauseOperator.NumberOperatorIsGreaterThan]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:v,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c},[a.ClauseSourceType.SingleSelectFromUnique]:{normalInputEditors:d,supportAskForValue:!0},[a.ClauseSourceType.SingleSelectFromPredefined]:{normalInputEditors:I,codedValueInputEditors:I,supportAskForValue:!0}},[a.ClauseOperator.NumberOperatorIsBetween]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:g,supportAskForValue:!0}},[a.ClauseOperator.NumberOperatorIsNotBetween]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:g,supportAskForValue:!0}},[a.ClauseOperator.NumberOperatorIsAnyOf]:{[a.ClauseSourceType.MultipleSelectFromUnique]:{normalInputEditors:h,codedValueInputEditors:h,supportAskForValue:!0},[a.ClauseSourceType.MultipleSelectFromPredefined]:{normalInputEditors:b,codedValueInputEditors:b,supportAskForValue:!0}},[a.ClauseOperator.NumberOperatorIsNoneOf]:{[a.ClauseSourceType.MultipleSelectFromUnique]:{normalInputEditors:h,codedValueInputEditors:h,supportAskForValue:!0},[a.ClauseSourceType.MultipleSelectFromPredefined]:{normalInputEditors:b,codedValueInputEditors:b,supportAskForValue:!0}},[a.ClauseOperator.NumberOperatorIsBlank]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:O}},[a.ClauseOperator.NumberOperatorIsNotBlank]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:O}},[a.ClauseOperator.DateOperatorIsOn]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:y,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c},[a.ClauseSourceType.SingleSelectFromUnique]:{normalInputEditors:d,codedValueInputEditors:C,supportAskForValue:!0}},[a.ClauseOperator.DateOperatorIsNotOn]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:y,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c},[a.ClauseSourceType.SingleSelectFromUnique]:{normalInputEditors:d,codedValueInputEditors:C,supportAskForValue:!0}},[a.ClauseOperator.DateOperatorIsIn]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:[s.DateRangeSelector],supportAskForValue:!0}},[a.ClauseOperator.DateOperatorIsNotIn]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:[s.DateRangeSelector],supportAskForValue:!0}},[a.ClauseOperator.DateOperatorIsBefore]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:y,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c}},[a.ClauseOperator.DateOperatorIsAfter]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:y,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c}},[a.ClauseOperator.DateOperatorIsOnOrBefore]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:y,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c}},[a.ClauseOperator.DateOperatorIsOnOrAfter]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:y,supportAskForValue:!0},[a.ClauseSourceType.Field]:{normalInputEditors:c}},[a.ClauseOperator.DateOperatorIsInTheLast]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:f,supportAskForValue:!0}},[a.ClauseOperator.DateOperatorIsNotInTheLast]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:f,supportAskForValue:!0}},[a.ClauseOperator.DateOperatorIsInTheNext]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:f,supportAskForValue:!0}},[a.ClauseOperator.DateOperatorIsNotInTheNext]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:f,supportAskForValue:!0}},[a.ClauseOperator.DateOperatorIsBetween]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:S,supportAskForValue:!0}},[a.ClauseOperator.DateOperatorIsNotBetween]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:S,supportAskForValue:!0}},[a.ClauseOperator.DateOperatorIsBlank]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:O}},[a.ClauseOperator.DateOperatorIsNotBlank]:{[a.ClauseSourceType.UserInput]:{normalInputEditors:O}}};function T(e,t){let s=[];if("STRING"===e)s=[a.ClauseOperator.StringOperatorIs,a.ClauseOperator.StringOperatorIsNot,a.ClauseOperator.StringOperatorStartsWith,a.ClauseOperator.StringOperatorDoesNotStartWith,a.ClauseOperator.StringOperatorEndsWith,a.ClauseOperator.StringOperatorDoesNotEndWith,a.ClauseOperator.StringOperatorContains,a.ClauseOperator.StringOperatorDoesNotContain,a.ClauseOperator.StringOperatorIsAnyOf,a.ClauseOperator.StringOperatorIsNoneOf,a.ClauseOperator.StringOperatorIsBlank,a.ClauseOperator.StringOperatorIsNotBlank];else if("NUMBER"===e)s=[a.ClauseOperator.NumberOperatorIs,a.ClauseOperator.NumberOperatorIsNot,a.ClauseOperator.NumberOperatorIsAtLeast,a.ClauseOperator.NumberOperatorIsAtMost,a.ClauseOperator.NumberOperatorIsLessThan,a.ClauseOperator.NumberOperatorIsGreaterThan,a.ClauseOperator.NumberOperatorIsBetween,a.ClauseOperator.NumberOperatorIsNotBetween,a.ClauseOperator.NumberOperatorIsAnyOf,a.ClauseOperator.NumberOperatorIsNoneOf,a.ClauseOperator.NumberOperatorIsBlank,a.ClauseOperator.NumberOperatorIsNotBlank];else if("DATE"===e&&(s=[a.ClauseOperator.DateOperatorIsOn,a.ClauseOperator.DateOperatorIsNotOn,a.ClauseOperator.DateOperatorIsIn,a.ClauseOperator.DateOperatorIsNotIn,a.ClauseOperator.DateOperatorIsBefore,a.ClauseOperator.DateOperatorIsAfter,a.ClauseOperator.DateOperatorIsOnOrBefore,a.ClauseOperator.DateOperatorIsOnOrAfter,a.ClauseOperator.DateOperatorIsBetween,a.ClauseOperator.DateOperatorIsNotBetween,a.ClauseOperator.DateOperatorIsBlank,a.ClauseOperator.DateOperatorIsNotBlank],t)){const e=[a.ClauseOperator.DateOperatorIsInTheLast,a.ClauseOperator.DateOperatorIsNotInTheLast,a.ClauseOperator.DateOperatorIsInTheNext,a.ClauseOperator.DateOperatorIsNotInTheNext];s.splice(8,0,...e)}return s}const x=[a.ClauseSourceType.SingleSelectFromUnique,a.ClauseSourceType.MultipleSelectFromUnique];function V(e,t,s){const a=s.split("_"),l=parseInt(a[a.length-1]);let r=e.slice(0,l);return t&&(r=r.concat(t)),r=r.concat(e.slice(l+1,e.length)),r}function N(e){return(e=e.toLowerCase()).replace(/\_(\w)/g,(function(e,t){return t.toUpperCase()}))}function D(e,t,s,l){let r=null;if(x.includes(t.valueOptions.sourceType)&&t.askForValueOptions&&t.askForValueOptions.cascade!==a.ClauseCascade.None){const i=function(e,t,s){const l={sql:"",logicalOperator:e.logicalOperator,parts:[]},r=t.askForValueOptions.cascade,i=s.split("_");let o=null,n=parseInt(i[1]);return i.length>2&&(o=parseInt(i[1]),n=parseInt(i[3])),r===a.ClauseCascade.Previous?e.parts.some(((e,t)=>{if(null!==o)if(t<o)l.parts.push(e);else{if(t!==o)return!0;{const t=e,s={type:t.type,logicalOperator:t.logicalOperator,parts:[]};t.parts.some(((e,t)=>{if(!(t<n))return!0;s.parts.push(e)})),l.parts.push(s)}}else{if(!(t<n))return!0;l.parts.push(e)}})):r===a.ClauseCascade.All&&e.parts.some(((e,t)=>{if(null!==o)if(t!==o)l.parts.push(e);else{const t=e,s={type:t.type,logicalOperator:t.logicalOperator,parts:[]};t.parts.some(((e,t)=>{t!==n&&s.parts.push(e)})),l.parts.push(s)}else t!==n&&l.parts.push(e)})),l}(e,t,s);r=a.dataSourceUtils.getArcGISSQL((0,a.Immutable)(i),l).sql}return r}function M(e){if(!e)return[];const t={};return function e(s){s.parts&&s.parts.forEach((function(s){s.type===a.ClauseType.Set?e(s):t[s.jimuFieldName]=!0}))}(e),Object.keys(t).map((e=>e))}function j(e){let t=!0;return e?(function e(s){s.parts&&s.parts.forEach((function(s){s.type===a.ClauseType.Set?e(s):s.valueOptions.isValid||(t=!1)}))}(e),t):t}function w(e){let t=0;return e&&e.parts.some((e=>{e.type===a.ClauseType.Single&&e.displayType!==a.ClauseDisplayType.None?t++:e.type===a.ClauseType.Set&&e.parts.some((e=>{e.displayType!==a.ClauseDisplayType.None&&t++}))})),t}function F(e){let t=0;return e&&e.parts.some((e=>{e.type===a.ClauseType.Single?t++:e.type===a.ClauseType.Set&&e.parts.some((e=>{t++}))})),t}function k(e,t,s,l=!1){const{displayType:r,displayLabel:i,askForValueOptions:o}=e;let n="";return r!==a.ClauseDisplayType.None&&(n=r===a.ClauseDisplayType.UseAskForValue?o.label:i,null===n&&(n=P(e,t,s,l))),n}function P(e,t,s,l=!1){var r;if(!t)return"";let i=(t.alias||t.name)+" "+s;if(l&&(i=s),e.displayType===a.ClauseDisplayType.UseLabel){const s=null===(r=e.valueOptions)||void 0===r?void 0:r.value;s&&(i=`${i} ${s.map((e=>t.type===a.JimuFieldType.String?`'${null==e?void 0:e.label}'`:(null==e?void 0:e.label)||"?")).join(", ")}`)}return i}function A(e,t,s){let l=null;if(e.parts){const r=e.asMutable({deep:!0});return l=r.parts,l.forEach((e=>{e.type===a.ClauseType.Set?e.parts.forEach((e=>{U(e,t,s)})):U(e,t,s)})),r}return null}function U(e,t,s){if("1.1.0"===t&&!e.displayType)if(e.askForValueOptions){if(e.displayType=a.ClauseDisplayType.UseAskForValue,""!==e.askForValueOptions.label){const t=P(e,e.jimuFieldName?(0,a.Immutable)(s.getSchema().fields[e.jimuFieldName]):null,a.i18n.getIntl().formatMessage({id:N(e.operator)}));e.askForValueOptions.label===t&&(e.askForValueOptions.label=null),e.askForValueOptions.label=null}}else e.displayType=a.ClauseDisplayType.None}var R=i(30726);class L extends a.React.PureComponent{constructor(e){super(e),this.setStateForDisplayUI=()=>{const e=this.props.fieldObj?this.props.fieldObj.type:null;this.setState({displayUI:this.getDisplayUI(e)})},this.getInputValue=(e=this.props.value)=>{var t,s,a;return null!==(a=null===(s=null===(t=e.value)||void 0===t?void 0:t[0])||void 0===s?void 0:s.value)&&void 0!==a?a:""},this.getDisplayUI=e=>{let t="";switch(e){case a.JimuFieldType.Number:t="number";break;case a.JimuFieldType.String:case null:t="text"}return t},this.onNumberChange=e=>{this.setState({inputValue:e})},this.onAcceptNumericValue=e=>{const t=e+""!="NaN"?e:null;this.onChange(t)},this.onTextChange=e=>{this.setState({inputValue:e.target.value})},this.onAcceptTextValue=e=>{(e=e.trim())!==this.state.inputValue&&this.setState({inputValue:e}),this.onChange(""===e?null:e)},this.onChange=e=>{if(!this.props.fieldObj)return;const t=null!==e?[{value:e,label:e+""}]:null,s=ke(this.props.value.sourceType,this.props.value.inputEditor,t);this.props&&this.props.onChange(s)},this.state={displayUI:null,inputValue:this.getInputValue()}}componentDidMount(){const e=this.props.fieldObj?this.props.fieldObj.type:null;this.setState({displayUI:this.getDisplayUI(e)})}componentDidUpdate(e,t){const{fieldObj:s,value:a}=this.props;s===e.fieldObj&&a.sourceType===e.value.sourceType&&a.inputEditor===e.value.inputEditor||this.setStateForDisplayUI();const l=this.getInputValue();l!==this.getInputValue(e.value)&&this.setState({inputValue:l})}render(){const e=this.props.runtime?void 0:"sm",t=p(this.props.isSmallSize||this.props.runtime).inputEditorWidth;return"number"===this.state.displayUI?a.React.createElement(R.NumericInput,{"aria-label":this.props["aria-label"],"aria-describedby":this.props["aria-describedby"],size:e,style:{width:t},showHandlers:!1,value:this.state.inputValue,onChange:this.onNumberChange,onAcceptValue:this.onAcceptNumericValue}):a.React.createElement(R.TextInput,{"aria-label":this.props["aria-label"],"aria-describedby":this.props["aria-describedby"],size:e,style:{width:t},value:this.state.inputValue,onChange:this.onTextChange,onAcceptValue:this.onAcceptTextValue})}}const B=L;class _ extends a.React.PureComponent{constructor(e){super(e),this.getSelectedFields=()=>{const e=this.props.value.value;return e?(0,a.Immutable)([e[0].value]):null},this.onChange=e=>{const t=e[0],s={value:t.jimuName,label:t.alias?t.alias:t.name},a=ke(this.props.value.sourceType,this.props.value.inputEditor,[s]);this.props&&this.props.onChange(a)},this.state={FieldSelector:null,type:this.props.fieldObj.type}}componentDidMount(){this.__unmount=!1,a.moduleLoader.loadModule("jimu-ui/advanced/data-source-selector").then((e=>{this.__unmount||this.setState({FieldSelector:e.FieldSelector})}))}componentWillUnmount(){this.__unmount=!0}componentDidUpdate(e,t){this.props.fieldObj!==e.fieldObj&&this.setState({type:this.props.fieldObj.type})}render(){return this.state.FieldSelector?a.React.createElement("div",{style:{width:p(this.props.isSmallSize).inputEditorWidth}},a.React.createElement(this.state.FieldSelector,{types:(0,a.Immutable)([this.state.type]),dataSources:[this.props.dataSource],onChange:this.onChange,hiddenFields:(0,a.Immutable)([this.props.fieldObj.jimuName]),selectedFields:this.getSelectedFields(),isDataSourceDropDownHidden:!0,useDropdown:!0,dropdownProps:{size:this.props.runtime?void 0:"sm"}})):null}}const q=_;var W=i(34796);class z extends a.React.PureComponent{constructor(){super(...arguments),this.i18nMessage=e=>this.props.intl.formatMessage({id:e,defaultMessage:R.defaultMessages[e]}),this.onValue1Change=e=>{this.value1=parseFloat(e.target.value),this.onChange()},this.onValue2Change=e=>{this.value2=parseFloat(e.target.value),this.onChange()},this.onChange=()=>{const e=[],t=null!==this.value1&&this.value1+""!="NaN"?{value:this.value1,label:this.value1+""}:null,s=null!==this.value2&&this.value2+""!="NaN"?{value:this.value2,label:this.value2+""}:null;e.push(t),e.push(s);const a=ke(this.props.value.sourceType,this.props.value.inputEditor,e);this.props&&this.props.onChange(a)}}render(){var e,t;const s=this.props.runtime?void 0:"sm";this.value1=(null===(e=this.props.value)||void 0===e?void 0:e.value)&&this.props.value.value[0]?this.props.value.value[0].value:null,this.value2=(null===(t=this.props.value)||void 0===t?void 0:t.value)&&this.props.value.value[1]?this.props.value.value[1].value:null;const l=p(!1);return a.React.createElement("div",{className:(0,a.classNames)(this.props.className,"double-number-picker d-flex align-items-center")},a.React.createElement(R.NumericInput,{"aria-label":this.props["aria-label"],"aria-describedby":this.props["aria-describedby"],size:s,style:{width:l.hasConnector.inputEditorWidth},value:this.value1,showHandlers:!1,onBlur:this.onValue1Change,onPressEnter:this.onValue1Change}),a.React.createElement("div",{className:"double-input-connector"},this.i18nMessage("andLowerCase")),a.React.createElement(R.NumericInput,{"aria-label":this.i18nMessage("andLowerCase"),size:s,style:{width:l.hasConnector.inputEditorWidth},value:this.value2,showHandlers:!1,onBlur:this.onValue2Change,onPressEnter:this.onValue2Change}))}}const H=(0,W.withStyles)((0,a.injectIntl)(z),"VIDoubleNumberSelector");class Q extends a.React.PureComponent{constructor(){super(...arguments),this.onValueChange=e=>{const t=ke(this.props.value.sourceType,this.props.value.inputEditor,e);this.props&&this.props.onChange(t)},this.useDynamicValues=()=>this.props.runtime&&!this.props.codedValues}render(){const e=this.props.value&&this.props.value.value?this.props.value.value:[],t=this.props,{value:s,fieldObj:l,codedValues:r}=t,i=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(s[a[l]]=e[a[l]])}return s}(t,["value","fieldObj","codedValues"]);return a.React.createElement("div",{style:{width:p(this.props.isSmallSize||this.props.runtime).inputEditorWidth}},a.React.createElement(R.AdvancedSelect,Object.assign({},i,{staticValues:r,field:this.props.fieldObj,selectedValues:e,isMultiple:this.props.isMultiple,allTag:"allDynamicTag",appendToBody:!!this.props.runtime,strategy:this.props.runtime?"absolute":"fixed",useCodedValues:!this.useDynamicValues(),fluid:!0,size:this.props.runtime?void 0:"sm",onChange:this.onValueChange})))}}const $=Q;var G=i(59788),J=i.n(G);const K=e=>{const t=window.SVG,{className:s}=e,l=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(s[a[l]]=e[a[l]])}return s}(e,["className"]),r=(0,a.classNames)("jimu-icon jimu-icon-component",s);return t?a.React.createElement(t,Object.assign({className:r,src:J()},l)):a.React.createElement("svg",Object.assign({className:r},l))};var Y=function(e,t,s,a){return new(s||(s=Promise))((function(l,r){function i(e){try{n(a.next(e))}catch(e){r(e)}}function o(e){try{n(a.throw(e))}catch(e){r(e)}}function n(e){var t;e.done?l(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(i,o)}n((a=a.apply(e,t||[])).next())}))};class Z extends a.React.PureComponent{constructor(e){super(e),this.getDataSource=()=>this.dsManager.createLocalDataSource(this.props.dataSource,this.localDsRandomId),this.sortValuePairs=e=>e?e.sort(((e,t)=>{var s;return null===(s=e.label)||void 0===s?void 0:s.localeCompare(t.label,this.props.intl.locale,{numeric:!0,sensitivity:"base"})})):null,this.isMultiple=()=>this.props.value.sourceType===a.ClauseSourceType.MultipleSelectFromUnique,this.i18nMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:R.defaultMessages[e]},t),this.updateList=(e=this.props.fieldObj)=>Y(this,void 0,void 0,(function*(){var t,s;if(this._isMounted&&!this.props.codedValues&&e){let l;const r=yield a.dataSourceUtils.queryFeatureCountByField(e,this.dataSource,this.props.sql,this.context.scope,this.context.widgetId);(null===(s=null===(t=this.dataSource.getLayerDefinition())||void 0===t?void 0:t.advancedQueryCapabilities)||void 0===s?void 0:s.supportsDistinct)&&(l=r);const i=yield this.getListByPageSize(l,r,1);this._isMounted&&this.setState({isListReady:!0,list:i.list,listWithSetValues:this.getListWithSetValues(i.list)})}})),this.getListByPageSize=(e,t,s)=>Y(this,void 0,void 0,(function*(){var l,r;const{codedValues:i,fieldObj:o,sql:n,intl:u}=this.props;if(this._isMounted&&!i&&o){const i=Math.max(null!==(r=null===(l=this.props.dataSource)||void 0===l?void 0:l.getQueryPageSize())&&void 0!==r?r:0,20),p=yield a.dataSourceUtils.queryValueLabelsByFieldAndPageSize(o,this.dataSource,i*s,u,n,this.context.scope,this.context.widgetId);return this._isMounted&&p.list.length<20&&(e&&p.list.length<e||!e&&p.list.length<t-p.reducedCount)?this.getListByPageSize(e,t,s+1):Promise.resolve(p)}})),this.getListWithSetValues=e=>{var t;const s=(null===(t=this.props.value)||void 0===t?void 0:t.value)||[];let a=e;return this.props.codedValues||(a=this.sortValuePairs(e.concat(s))),a.forEach(((e,t)=>{var s;e.value===(null===(s=a[t+1])||void 0===s?void 0:s.value)&&a.splice(t,1)})),a},this.getDisplayLabel=e=>{let t="";const s=e.value||[],a=s.length;return t=this.isMultiple()?this.i18nMessage("numSelected",{number:a}):a?s[0].label:this.i18nMessage("allTag"),t},this.onTogglePopper=()=>{setTimeout((()=>{this.setState({isOpen:!this.state.isOpen})}),100)},this.isPillActive=e=>{var t;return!!((null===(t=this.props.value)||void 0===t?void 0:t.value)?this.props.value.value:[]).filter((t=>t.value===e)).length},this.onPillClick=(e,t)=>{var s;const l=t.target.className.indexOf("active")<0;if(!this.isMultiple()&&!l)return;let r=l?[e]:[];this.isMultiple()?null===(s=this.props.value.value)||void 0===s||s.forEach((t=>{(l||!l&&e.value!==t.value)&&r.push({value:t.value,label:t.label})})):(this.setState({isOpen:!1}),r.length&&r[0].value===a.EMPTY_OPTION_VALUE&&(r=[])),r=r.length?r:null;const i=ke(this.props.value.sourceType,this.props.value.inputEditor,r);this.props&&this.props.onChange(i)},this.onDisplayChange=e=>{const t=ke(this.props.value.sourceType,e,this.props.value.value);this.props&&this.props.onChange(t)},this.getSkeletons=()=>a.React.createElement("div",{className:"pill-btn-container skeleton-btn-container"},a.React.createElement("div",{className:"pill-skeleton1"}),a.React.createElement("div",{className:"pill-skeleton2"}),a.React.createElement("div",{className:"pill-skeleton3"})),this.getPills=e=>{const t=this.i18nMessage("allTag");return a.React.createElement("div",{className:"pill-btn-container"},!this.isMultiple()&&a.React.createElement(R.Button,{className:"pill-btn",size:this.props.runtime?void 0:"sm",value:a.EMPTY_OPTION_VALUE,active:null===this.props.value.value,"aria-checked":null===this.props.value.value,onClick:e=>{this.onPillClick({value:a.EMPTY_OPTION_VALUE,label:t},e)}},t),e.map(((e,t)=>{if(null!==e.value){const s=0===(this.props.codedValues||this.state.list).filter((t=>t.value===e.value)).length,l=this.isPillActive(e.value);return a.React.createElement(R.Button,{key:t,className:(0,a.classNames)("pill-btn",{"pill-dash-btn":s&&l}),size:this.props.runtime?void 0:"sm",value:e.value,active:l,"aria-checked":l,onClick:t=>{this.onPillClick(e,t)}},e.label)}})))},Z.count++,this.dsManager=a.DataSourceManager.getInstance(),this.localDsRandomId=X(),this.dataSource=this.getDataSource();const t=this.sortValuePairs(this.props.codedValues);this.state={list:[],listWithSetValues:[],codedValues:t,isOpen:!1,isListReady:null!==t},this._isMounted=!0}componentDidMount(){this.updateList()}componentWillUnmount(){this._isMounted=!1,this.dsManager.destroyDataSource(this.dataSource.id)}componentDidUpdate(e){this.props.fieldObj!==e.fieldObj||this.props.codedValues!==e.codedValues||this.props.sql!==e.sql?(this.props.codedValues!==e.codedValues&&this.props.codedValues&&this.setState({isListReady:!0,codedValues:this.sortValuePairs(this.props.codedValues)}),this.updateList()):this.props.datasourceInfo!==e.datasourceInfo||this.props.datasourceBelongInfo!==e.datasourceBelongInfo?(this.dataSource=this.getDataSource(),this.updateList()):this.props.value!==e.value&&this.setState({listWithSetValues:this.getListWithSetValues(this.state.list)})}render(){const{className:e,value:t,runtime:s}=this.props,l=this.getDisplayLabel(t);let r=this.state.codedValues||this.state.listWithSetValues;return r.length>20&&(r=r.slice(0,20)),a.React.createElement("div",{className:(0,a.classNames)(e,"h-100")},s?a.React.createElement("div",{className:"pill-runtime-container"},this.state.isListReady?this.getPills(r):this.getSkeletons()):a.React.createElement("div",{className:"h-100 d-flex"},a.React.createElement(R.Button,{size:"sm",type:"default",className:"pill-selector-button h-100",ref:e=>{this.pillButton=e},title:l,style:{width:p(this.props.isSmallSize||s).inputEditorWidth,justifyContent:this.isMultiple()||null!==t.value?"space-between":"flex-end"},onClick:this.onTogglePopper},a.React.createElement("div",{className:"pill-display-label"},l),a.React.createElement(K,{size:"s"})),a.React.createElement(R.Popper,{open:this.state.isOpen,toggle:this.onTogglePopper,className:e,showArrow:!0,reference:this.pillButton},a.React.createElement("div",{className:"pill-selector-popper"},a.React.createElement("div",{className:"pill-setting-container"},this.state.isListReady?this.getPills(r):this.getSkeletons())))))}}Z.contextType=R.QueryScopeContext,Z.count=-1;const X=()=>`PILL_SELECT-${Z.count}`,ee=a.ReactRedux.connect(((e,t)=>{const s=window.jimuConfig.isBuilder?e.appStateInBuilder:e;return s&&t.dataSource?{datasourceInfo:s.dataSourcesInfo[t.dataSource.id]||null,datasourceBelongInfo:t.dataSource.isDataView?s.dataSourcesInfo[t.dataSource.belongToDataSource.id]:null}:{datasourceInfo:null,datasourceBelongInfo:null}}))(Z),te=(0,W.withStyles)((0,a.injectIntl)(ee),"VIPillSelector");class se extends a.React.PureComponent{constructor(e){super(e),this.getInputEditor=e=>{let t="";switch(e){case s.DatePicker:case s.DoubleDatePicker:t="date";break;case s.DateTimePicker:case s.DoubleDateTimePicker:t="datetime";break;default:t=null}return t},this.onChange=(e,t)=>{const s=e?[{value:e,label:t||"",isUTC:!0}]:null,a=ke(this.props.value.sourceType,this.props.value.inputEditor,s);this.props&&this.props.onChange(a)},this.getValueWithTZ=()=>{var e,t,s;const{value:l,dataSource:r}=this.props;if(!(null===(e=l.value)||void 0===e?void 0:e[0])||"string"==typeof(null===(t=l.value)||void 0===t?void 0:t[0].value))return l;const i=null===(s=l.value)||void 0===s?void 0:s[0].value,o=a.dataSourceUtils.getDateFieldValue(i,r);return(0,a.Immutable)(l).setIn(["value","0","value"],o).asMutable({deep:!0})},this.getDateFromUTC=e=>{const t=e.value;let s=new Date(t);return e.isUTC||(s=new Date(t+a.dataSourceUtils.getLocalTimeOffset())),s},this.state={value:this.getValueWithTZ(),DatePicker:null,displayUI:null}}componentDidMount(){this.__unmount=!1,a.moduleLoader.loadModule("jimu-ui/basic/date-picker").then((e=>{this.__unmount||(this.props.value.inputEditor?this.setState({DatePicker:e.DatePicker,displayUI:this.getInputEditor(this.props.value.inputEditor)}):this.setState({DatePicker:e.DatePicker}))}))}componentWillUnmount(){this.__unmount=!0}componentDidUpdate(e,t){this.__unmount||(this.props.fieldObj!==e.fieldObj||this.props.value.sourceType!==e.value.sourceType||this.props.value.inputEditor!==e.value.inputEditor?this.setState({displayUI:this.getInputEditor(this.props.value.inputEditor)}):this.props.value!==e.value&&this.setState({value:this.getValueWithTZ()}))}render(){var e;const{runtime:t,style:s,fieldObj:l,dataSource:r,isSmallSize:i}=this.props,{value:o}=this.state;if(!this.state.DatePicker)return null;let n=null,u=null===(e=null==l?void 0:l.format)||void 0===e?void 0:e.dateFormat,c=!1,d=!1;if(this.state.displayUI){if(null==o?void 0:o.value){const e=o.value[0].value;n="string"==typeof e?e:this.getDateFromUTC(o.value[0])}"date"===this.state.displayUI?u?u.indexOf("Time")>0&&(u=u.split("24")[0].split("ShortTime")[0].split("LongTime")[0]):u=a.dateUtils.DATE_TIME_DEFAULT_FORMAT.date:"datetime"===this.state.displayUI&&(c=!0,u?u.indexOf("Time")<0&&(u=u+" "+a.dateUtils.DATE_TIME_DEFAULT_FORMAT.time):u=a.dateUtils.DATE_TIME_DEFAULT_FORMAT.dateTime,u.indexOf("LongTime")>=0&&(d=!0))}return a.React.createElement(this.state.DatePicker,{"aria-label":this.props["aria-label"],"aria-describedby":this.props["aria-describedby"],style:s||{width:p(i||t).inputEditorWidth},strategy:t?"absolute":"fixed",disablePortal:!t,selectedDate:n,showTimeInput:c,isTimeLong:d,format:u,showQuickNavToToday:t,supportVirtualDateList:!t,showTwoMonths:t,showDoneButton:!0,dataSource:r,onChange:(e,t)=>{this.onChange(e,t)}})}}const ae=se,le=[a.dateUtils.VirtualDateType.ThisWeek,a.dateUtils.VirtualDateType.ThisMonth,a.dateUtils.VirtualDateType.ThisQuarter,a.dateUtils.VirtualDateType.ThisYear];class re extends a.React.PureComponent{constructor(){super(...arguments),this.onValueChange=(e,t)=>{const s=e.target.value;let a=null;""!==s&&(a=[{value:s,label:t.props.label}]);const l=ke(this.props.value.sourceType,this.props.value.inputEditor,a);this.props&&this.props.onChange(l)},this.stopPropagation=e=>{e.stopPropagation(),e.nativeEvent.stopImmediatePropagation()}}render(){const e=this.props.value&&this.props.value.value?this.props.value.value[0].value:"";return a.React.createElement(R.Select,{"aria-label":this.props["aria-label"],"aria-describedby":this.props["aria-describedby"],size:this.props.runtime?void 0:"sm",style:{width:p(this.props.isSmallSize||this.props.runtime).inputEditorWidth},value:e,onChange:this.onValueChange,menuProps:{onClick:this.stopPropagation}},a.React.createElement("option",{key:0,value:"",label:""}," "),le.map(((e,t)=>{const s=N(e),l=this.props.intl.formatMessage({id:s,defaultMessage:R.defaultMessages[s]});return a.React.createElement("option",{key:t,value:e,label:l},l)})))}}const ie=(0,a.injectIntl)(re);class oe extends a.React.PureComponent{constructor(){super(...arguments),this.i18nMessage=e=>this.props.intl.formatMessage({id:e,defaultMessage:R.defaultMessages[e]}),this.onChange=()=>{const e=(this.value1.value||[null]).concat(this.value2.value||[null]),t=ke(this.props.value.sourceType,this.props.value.inputEditor,e);this.props&&this.props.onChange(t)}}render(){const e=this.props.value,t=(null==e?void 0:e.value)&&e.value[0]?[e.value[0]]:null,s=(null==e?void 0:e.value)&&e.value[1]?[e.value[1]]:null;this.value1=ke(e.sourceType,e.inputEditor,t),this.value2=ke(e.sourceType,e.inputEditor,s);const l=p(!1);return a.React.createElement("div",{className:(0,a.classNames)(this.props.className,"double-datetime-picker d-flex align-items-center w-100")},a.React.createElement(ae,{"aria-label":this.props["aria-label"],"aria-describedby":this.props["aria-describedby"],style:{width:l.hasConnector.inputEditorWidth},value:this.value1,fieldObj:this.props.fieldObj,runtime:this.props.runtime,dataSource:this.props.dataSource,onChange:e=>{this.value1=e,this.onChange()}}),a.React.createElement("div",{className:"double-input-connector"},this.i18nMessage("andLowerCase")),a.React.createElement(ae,{"aria-label":this.i18nMessage("andLowerCase"),style:{width:l.hasConnector.inputEditorWidth},value:this.value2,fieldObj:this.props.fieldObj,runtime:this.props.runtime,dataSource:this.props.dataSource,onChange:e=>{this.value2=e,this.onChange()}}))}}const ne=(0,W.withStyles)((0,a.injectIntl)(oe),"VIDoubleDateTimePicker"),ue=[a.dateUtils.TimeUnit.Minute,a.dateUtils.TimeUnit.Hour,a.dateUtils.TimeUnit.Day,a.dateUtils.TimeUnit.Week,a.dateUtils.TimeUnit.Month,a.dateUtils.TimeUnit.Year];class pe extends a.React.PureComponent{constructor(e){super(e),this.i18nMessage=e=>this.props.intl.formatMessage({id:e,defaultMessage:R.defaultMessages[e]}),this.onUnitSelect=e=>{e!==this.unit&&(this.unit=e,this.onChange())},this.onChange=()=>{const e=[{value:this.value,label:this.unit}],t=ke(this.props.value.sourceType,this.props.value.inputEditor,e);this.props&&this.props.onChange(t)},this.toggle=()=>{this.setState({isOpen:!this.state.isOpen})},this.state={isOpen:!1}}render(){const{value:e,runtime:t,isSmallSize:s}=this.props,l=e.value[0];this.value=l.value?l.value:null,this.unit=l.label;const r=this.i18nMessage(N(this.unit)),i=p(s||t,!0);return(0,a.jsx)("div",{className:"d-flex number-list-selector",style:{justifyContent:t?"space-between":"flex-start"}},(0,a.jsx)(R.NumericInput,{"aria-label":this.props["aria-label"],"aria-describedby":this.props["aria-describedby"],style:{width:i.inputEditorWidth},placeholder:this.i18nMessage("amount"),showHandlers:!1,value:this.value,onChange:e=>{this.value=e,this.onChange()},size:t?void 0:"sm"}),(0,a.jsx)(R.Dropdown,{className:"ml-1",style:{width:i.dropDownWidth},isOpen:this.state.isOpen,toggle:this.toggle,menuItemCheckMode:"singleCheck",activeIcon:!0},(0,a.jsx)(R.DropdownButton,{"aria-label":this.i18nMessage("unit"),type:"default",title:r,onClick:this.toggle,size:t?void 0:"sm",arrow:(0,a.jsx)(K,{size:"s"})},r),(0,a.jsx)(R.DropdownMenu,{showArrow:!0},(0,a.jsx)(R.DropdownItem,{header:!0},this.i18nMessage("selectUnit")),ue.map(((e,t)=>(0,a.jsx)(R.DropdownItem,{key:t,onClick:()=>{this.onUnitSelect(e)},active:this.unit===e},this.i18nMessage(N(e))))))))}}const ce=(0,a.injectIntl)(pe);var de=i(34750),he=i.n(de);const me=e=>{const t=window.SVG,{className:s}=e,l=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(s[a[l]]=e[a[l]])}return s}(e,["className"]),r=(0,a.classNames)("jimu-icon jimu-icon-component",s);return t?a.React.createElement(t,Object.assign({className:r,src:he()},l)):a.React.createElement("svg",Object.assign({className:r},l))};var ve=i(59587),ge=i(54357),ye=i.n(ge);const Se=e=>{const t=window.SVG,{className:s}=e,l=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(s[a[l]]=e[a[l]])}return s}(e,["className"]),r=(0,a.classNames)("jimu-icon jimu-icon-component",s);return t?a.React.createElement(t,Object.assign({className:r,src:ye()},l)):a.React.createElement("svg",Object.assign({className:r},l))};const fe=a.React.forwardRef(((e,t)=>{const{onKeyDown:s,onClick:l}=e,r=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(s[a[l]]=e[a[l]])}return s}(e,["onKeyDown","onClick"]);return a.React.createElement(R.Button,Object.assign({ref:t},r,{onClick:l,onKeyDown:e=>{!l||"Enter"!==e.key&&" "!==e.key||e.preventDefault()},onKeyUp:e=>{!l||"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),l(e))}}))}));class Ce extends a.React.PureComponent{constructor(e){super(e),this.externalDsStyle={maxWidth:"960px"},this.i18nMessage=e=>{const{intl:t}=this.props;return t?t.formatMessage({id:e,defaultMessage:R.defaultMessages[e]}):""},this.onSelectValueChange=e=>{null===e?this.onChange({value:a.EMPTY_OPTION_VALUE,label:null,alias:null}):this.onChange({value:e[0].value,label:e[0].label,alias:e[0].label})},this.onNumberValueBlur=e=>{const t=parseFloat(e.target.value),s=t+""!="NaN"?t:null;if(s===this.props.value.value)return;const a=null===s?null:s+"";this.onChange({value:s,label:a,alias:a})},this.onNumberValueKeyUp=()=>{this.numberValueInputRef.blur()},this.onStringValueChange=e=>{const t=e.target.value;this.setState({currentValue:t})},this.onStringValueAccept=e=>{let t=""!==(e=e.trim())?e:null,s=t;e===this.allTag&&(t=a.EMPTY_OPTION_VALUE,s=null),t!==this.props.value.value&&this.onChange({value:t,label:e,alias:s})},this.onAliasUpdate=e=>{let t=e.trim();this.isEmptyItem()&&t===this.allTag&&(t=null),t!==this.props.value.alias&&(t=""!==t?t:this.props.value.alias,this.onChange({value:this.props.value.value,label:this.props.value.label,alias:t,selected:this.props.value.selected}))},this.onAliasChange=e=>{this.setState({currentAlias:e.target.value})},this.setSelected=()=>{this.onChange({value:this.props.value.value,label:this.props.value.label,alias:this.props.value.alias,selected:!this.props.value.selected})},this.onChange=e=>{var t;const s=null!==(t=e.selected)&&void 0!==t?t:this.props.value.selected;this.props&&this.props.onChange(this.props.index,(0,a.Immutable)({value:e.value,label:e.label,alias:e.alias,selected:s}))},this.deleteItem=()=>{this.props&&this.props.onChange(this.props.index,null)},this.toggleAdvancedSelect=()=>{this.state.isOpen&&a.lodash.debounce((()=>{var e;null===(e=this.dropdownBtnRef)||void 0===e||e.focus()}),200)(),this.setState({isOpen:!this.state.isOpen})},this.isEmptyItem=(e=this.props.value)=>(null==e?void 0:e.value)===a.EMPTY_OPTION_VALUE,this.getInputValue=()=>{const{value:e}=this.props;return this.isEmptyItem(e)?this.allTag:e.value},this.getInputAlias=(e=this.props.value)=>e.alias||(this.isEmptyItem(e)?this.allTag:""),this.getItem=(e,t)=>{let s=!1;this.props.allValues.forEach(((e,a)=>{if(null===t.value||e.value===t.value&&a<this.props.index)return s=!0,!0}));const l=this.isEmptyItem(t),r=this.getInputAlias(t);return(0,a.jsx)(a.React.Fragment,null,(0,a.jsx)("div",{className:"d-flex justify-content-between ml-2"},(0,a.jsx)("div",{className:(0,a.classNames)("predefined-value",{"value-input-isValid":s})},this.state.isOpen?(0,a.jsx)(R.AdvancedSelect,Object.assign({},e,{fluid:!0,size:"sm",useKeyUpEvent:!0,appendToBody:!1,strategy:"fixed",field:this.props.field,selectedValues:[t],excludeValues:this.props.excludeValues,isEmptyOptionHidden:this.props.isMultiple,isOpen:this.state.isOpen,toggle:this.toggleAdvancedSelect,onChange:this.onSelectValueChange})):(0,a.jsx)(R.InputGroup,null,this.props.field.type===a.JimuFieldType.Number?(0,a.jsx)(R.NumericInput,{size:"sm","data-draggable":"true",showHandlers:!1,disabled:l,ref:e=>{this.numberValueInputRef=e},value:this.state.currentValue,onBlur:this.onNumberValueBlur,onPressEnter:this.onNumberValueKeyUp}):(0,a.jsx)(R.TextInput,{size:"sm","data-draggable":"true",disabled:l,ref:e=>{this.stringValueInputRef=e},value:this.state.currentValue||"",onChange:this.onStringValueChange,onAcceptValue:this.onStringValueAccept}),(0,a.jsx)("div",{className:"predefined-button-con"},(0,a.jsx)(fe,{icon:!0,size:"sm",type:"default",className:"border-left-0",ref:e=>{this.dropdownBtnRef=e},onClick:()=>{this.setState({isOpen:!0})}},(0,a.jsx)(K,{size:"s"}))))),(0,a.jsx)("div",{className:"predefined-label"},(0,a.jsx)(R.TextInput,{size:"sm",type:"text","data-draggable":"true",ref:e=>{this.aliasInputRef=e},value:this.state.currentAlias,onChange:this.onAliasChange,onAcceptValue:this.onAliasUpdate})),(0,a.jsx)("div",{className:"predefined-cbx"},this.props.isMultiple?(0,a.jsx)(R.Checkbox,{className:"mt-1",checked:t.selected,onChange:this.setSelected,"aria-label":null!=r?r:"","aria-checked":t.selected}):(0,a.jsx)(R.Radio,{style:{cursor:"pointer"},checked:t.selected,onChange:this.setSelected,"aria-label":null!=r?r:"","aria-checked":t.selected})),(0,a.jsx)("div",{className:"predefined-delete"},(0,a.jsx)(fe,{type:"tertiary",onClick:this.deleteItem,icon:!0,size:"sm",title:this.i18nMessage("delete"),"aria-label":this.i18nMessage("delete")},(0,a.jsx)(Se,null)))))},this.allTag=this.i18nMessage("allTag"),this.state={currentValue:this.getInputValue(),currentAlias:this.getInputAlias(),isOpen:!1}}componentDidUpdate(e,t){const{value:s}=this.props;e.value.value!==s.value?this.setState({currentValue:this.getInputValue(),currentAlias:this.getInputAlias()}):e.value.alias!==s.alias&&this.state.currentAlias!==s.alias&&this.setState({currentAlias:this.getInputAlias()})}render(){const e=this.props,{value:t,isMultiple:s}=e,l=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(s[a[l]]=e[a[l]])}return s}(e,["value","isMultiple"]);return(0,a.jsx)("div",{className:"predefined-item"},this.getItem(l,t))}}const Oe=(0,a.injectIntl)(Ce);class Ie extends a.React.PureComponent{constructor(){super(...arguments),this.externalDsStyle={maxWidth:"960px"},this.i18nMessage=e=>{const{intl:t}=this.props;return t?t.formatMessage({id:e,defaultMessage:R.defaultMessages[e]}):""},this.addItem=()=>{const e=this.props.isMultiple||0!==this.props.values.length?{value:null,label:null,alias:null,selected:!1}:{value:a.EMPTY_OPTION_VALUE,label:null,alias:null,selected:!0},t=this.props.values.concat({value:e.value,label:e.label,alias:e.label,selected:e.selected});this.props.onChange(t)},this.onChange=(e,t)=>{const s=this.props.values.asMutable({deep:!0}),l=s[e].selected;let r=s.slice(0,e);t&&(r=r.concat(t)),r=r.concat(s.slice(e+1,s.length)),(null==t?void 0:t.selected)&&!this.props.isMultiple?r.forEach((e=>{e.selected&&e.value!==t.value&&(e.selected=!1)})):l&&null===t&&!this.props.isMultiple&&r[0]&&(r[0].selected=!0),this.props.onChange((0,a.Immutable)(r))},this.createItemElement=(e,t,s)=>(0,a.jsx)(Oe,Object.assign({key:s,index:s,value:e,excludeValues:this.props.values.filter((t=>t.value!==e.value&&null!==t.value)),allValues:this.props.values},t,{onChange:this.onChange}))}render(){const e=this.props,{values:t,onChange:s}=e,l=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(s[a[l]]=e[a[l]])}return s}(e,["values","onChange"]);return(0,a.jsx)("div",{className:"predefined-container"},(0,a.jsx)("div",{className:"d-flex justify-content-end"},(0,a.jsx)(R.Button,{size:"sm",onClick:()=>{this.addItem()},type:"default","aria-label":this.i18nMessage("add")},(0,a.jsx)(me,{className:"mr-1"}),this.i18nMessage("add"))),(0,a.jsx)("div",{className:"predefined-list"},(0,a.jsx)("div",{className:"d-flex predefined-list-header pl-2"},(0,a.jsx)("div",{className:"d-flex justify-content-between"},(0,a.jsx)("div",{className:"predefined-value"},this.i18nMessage("value")),(0,a.jsx)("div",{className:"predefined-label"},this.i18nMessage("label")),(0,a.jsx)("div",{className:"predefined-cbx"},this.i18nMessage("default")),(0,a.jsx)("div",{className:"predefined-delete"}))),(0,a.jsx)("div",{className:"predefined-list-content"},(0,a.jsx)(ve.List,{size:"sm",className:"setting-ui-unit-list",itemsJson:this.props.values.asMutable({deep:!0}).map(((e,t)=>({itemStateDetailContent:e,itemKey:`${t}`}))),dndEnabled:!0,onDidDrop:(e,t)=>{const{itemJsons:[,s]}=t.props;this.props.onChange((0,a.Immutable)(s.map((e=>e.itemStateDetailContent))))},overrideItemBlockInfo:({itemBlockInfo:e})=>({name:ve.TreeItemActionType.RenderOverrideItem,children:[{name:ve.TreeItemActionType.RenderOverrideItemDroppableContainer,children:[{name:ve.TreeItemActionType.RenderOverrideItemDraggableContainer,children:[{name:ve.TreeItemActionType.RenderOverrideItemBody,children:[{name:ve.TreeItemActionType.RenderOverrideItemDragHandle},{name:ve.TreeItemActionType.RenderOverrideItemMainLine}]}]}]}]}),renderOverrideItemMainLine:(e,t)=>{const{itemJsons:s}=t.props,a=s[0],r=s[1];return this.createItemElement(a.itemStateDetailContent,l,r.indexOf(a))}}))))}}const be=(0,a.injectIntl)(Ie);var Ee=i(28455),Te=i.n(Ee);const xe=e=>{const t=window.SVG,{className:s}=e,l=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(s[a[l]]=e[a[l]])}return s}(e,["className"]),r=(0,a.classNames)("jimu-icon jimu-icon-component",s);return t?a.React.createElement(t,Object.assign({className:r,src:Te()},l)):a.React.createElement("svg",Object.assign({className:r},l))};class Ve extends a.React.PureComponent{constructor(e){var t,s;super(e),this.externalDsStyle={maxWidth:"700px"},this.i18nMessage=(e,t)=>this.props.intl.formatMessage({id:e,defaultMessage:R.defaultMessages[e]},t),this.handleToggle=e=>{var t,s;e?this.setState({isOpen:!this.state.isOpen}):null===(s=null===(t=this.headerRef.parentElement)||void 0===t?void 0:t.nextSibling)||void 0===s||s.focus()},this.handleOkBtn=()=>{if(!this.isPredefinedValid())return void this.setState({isValid:!1});this.handleToggle(!0);const e=ke(this.props.value.sourceType,this.props.value.inputEditor,this.state.value);this.props&&this.props.onChange(e)},this.isPredefinedValid=()=>{let e=!1;if(this.state.value){const t=this.state.value.asMutable({deep:!0}).map((e=>e.value)).filter((e=>null!==e));e=Array.from(new Set(t)).length===this.state.value.length}return e},this.handleCancelBtn=()=>{var e,t;this.setState({isValid:!0,value:(0,a.Immutable)(null!==(t=null===(e=this.props.value)||void 0===e?void 0:e.value)&&void 0!==t?t:[])}),this.handleToggle(!0)},this.onSettingValueChange=e=>{this.setState({value:e,isValid:!0})},this.isValuesSet=()=>this.state.value.length>0,this.onValueChangeForRuntime=e=>{const t=e?e.map((e=>e.value)):[a.EMPTY_OPTION_VALUE],s=this.state.value.asMutable({deep:!0});s.forEach((e=>{e.selected=t.includes(e.value)}));const l=ke(this.props.value.sourceType,this.props.value.inputEditor,s);this.props&&this.props.onChange(l)},this.getValuesForRuntime=e=>{const t=[];return e.forEach((e=>{const s=e.value===a.EMPTY_OPTION_VALUE&&null===e.alias?this.i18nMessage("allTag"):e.alias;t.push({value:e.value,label:s,selected:e.selected})})),{selectedValues:t.filter((e=>e.selected)),staticValues:t}},this.state={isValid:!0,isOpen:!!e.isOpen,value:(0,a.Immutable)(null!==(s=null===(t=this.props.value)||void 0===t?void 0:t.value)&&void 0!==s?s:[])}}componentDidUpdate(e,t){var s,l;this.props.value!==e.value&&this.setState({value:(0,a.Immutable)(null!==(l=null===(s=this.props.value)||void 0===s?void 0:s.value)&&void 0!==l?l:[])})}render(){const e=this.props,{runtime:t,value:s,fieldObj:l,isMultiple:r,intl:i}=e,o=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(s[a[l]]=e[a[l]])}return s}(e,["runtime","value","fieldObj","isMultiple","intl"]),n={width:p(this.props.isSmallSize||t).inputEditorWidth};if(t){const e=s&&s.value?s.value:[],t=this.getValuesForRuntime(e);return a.React.createElement("div",{style:n},a.React.createElement(R.AdvancedSelect,Object.assign({},o,{field:l,isMultiple:r,selectedValues:t.selectedValues,staticValues:t.staticValues,isEmptyOptionHidden:!0,fluid:!0,onChange:this.onValueChangeForRuntime})))}const u=this.i18nMessage(r?"multiplePredefinedLabel":"uniquePredefinedLabel"),c=i.formatMessage({id:"ok",defaultMessage:a.defaultMessages.ok}),d=i.formatMessage({id:"cancel",defaultMessage:a.defaultMessages.cancel});return a.React.createElement("div",{style:n},a.React.createElement("div",{className:"w-100"},a.React.createElement(R.Button,{className:(0,a.classNames)("w-100 h-100 nowrap",{"frame-active":this.isValuesSet()}),type:"secondary",size:"sm",onClick:()=>{this.handleToggle(!0)},title:u,"aria-label":u},a.React.createElement("div",{className:"w-100 px-2 text-truncate"},u)),a.React.createElement(R.Modal,{backdrop:"static",centered:!0,isOpen:this.state.isOpen,toggle:()=>{this.handleToggle(void 0)},contentClassName:"border-0 h-100",className:this.props.className,style:this.externalDsStyle,returnfocusafterclose:"true",size:"lg"},a.React.createElement(R.ModalHeader,{tag:"h4",toggle:this.handleCancelBtn},a.React.createElement("span",{ref:e=>{this.headerRef=e}},u)),a.React.createElement(R.ModalBody,null,a.React.createElement(be,Object.assign({},o,{field:l,values:this.state.value,isMultiple:r,onChange:this.onSettingValueChange}))),a.React.createElement(R.ModalFooter,null,a.React.createElement("div",{className:"m-0 w-100 d-block"},!this.state.isValid&&a.React.createElement("div",{className:"invalide-label"},a.React.createElement(xe,{color:this.props.theme.colors.palette.danger[700],className:"mr-2"}),this.i18nMessage("predefinedValueInValidTip")),a.React.createElement("div",{className:"d-flex"},a.React.createElement(R.Button,{type:"primary",onClick:this.handleOkBtn,className:"ml-auto mr-2",style:{minWidth:"64px"},"aria-label":c},c),a.React.createElement(R.Button,{type:"secondary",onClick:this.handleCancelBtn,style:{minWidth:"64px"},"aria-label":d},d)))))))}}const Ne=(0,W.withStyles)((0,W.withTheme)((0,a.injectIntl)(Ve)),"VIPredefinedSelector");class De extends a.React.PureComponent{render(){return a.React.createElement("div",null)}}const Me=De;var je=function(e,t){var s={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.indexOf(a)<0&&(s[a]=e[a]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var l=0;for(a=Object.getOwnPropertySymbols(e);l<a.length;l++)t.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(e,a[l])&&(s[a[l]]=e[a[l]])}return s};const we={[s.TextInput]:B,[s.DoubleNumberSelector]:H,[s.FieldSelector]:q,[s.SimpleSelect]:$,[s.UniquePillWrapSelector]:te,[s.MultipleSelect]:$,[s.MultiplePillWrapSelector]:te,[s.UniquePredefinedSelector]:Ne,[s.MultiplePredefinedSelector]:Ne,[s.DatePicker]:ae,[s.DateTimePicker]:ae,[s.DateRangeSelector]:ie,[s.DoubleDatePicker]:ne,[s.DoubleDateTimePicker]:ne,[s.NumberListSelector]:ce,[s.BlankSelector]:Me};function Fe(e){const{valueOptions:t,onChange:l}=e,r=je(e,["valueOptions","onChange"]),i=we[e.valueOptions.inputEditor],o=Object.assign({value:t},r),n=[s.MultipleSelect,s.MultiplePredefinedSelector].includes(t.inputEditor);return a.React.createElement(i,Object.assign({},o,{isMultiple:n,onChange:l}))}function ke(e,t,l,r){return{isValid:void 0===r||r,sourceType:e||a.ClauseSourceType.UserInput,inputEditor:t||s.TextInput,value:l||(t===s.NumberListSelector?[{value:null,label:a.dateUtils.TimeUnit.Day}]:null)}}function Pe(){return{type:a.ClauseType.Single,jimuFieldName:"",operator:null,valueOptions:ke(null,null,null,!1),displayType:a.ClauseDisplayType.None,askForValueOptions:null,displayLabel:null}}function Ae(){const e=Pe(),t=Pe();return{type:a.ClauseType.Set,logicalOperator:a.ClauseLogic.And,parts:[e,t]}}function Ue(e,t){return E[e][t].supportCaseSensitive||!1}function Re(e,t){return E[e][t].supportAskForValue||!1}function Le(e,t){return E[e][t].codedValueInputEditors||null}function Be(e,t,s){const l=a.ClauseSourceType.UserInput;return ke(l,qe(e,l,t,s)[0])}function _e(e,t,l,r,i){const o={};let n=null,u=null,p=s.TextInput;const c=E[l];if(c){for(const e in c)o[e]=[],u=u||e;Object.keys(o).forEach((s=>{var c;n&&(r=null);const d=qe(l,s,r,i);if(o[s]=d.inputEditorTypes,n=n||d.codedValues,s===u){const e=[a.ClauseOperator.DateOperatorIsOn,a.ClauseOperator.DateOperatorIsNotOn,a.ClauseOperator.DateOperatorIsBefore,a.ClauseOperator.DateOperatorIsAfter,a.ClauseOperator.DateOperatorIsOnOrBefore,a.ClauseOperator.DateOperatorIsOnOrAfter];p=d.inputEditorTypes[0],s===a.ClauseSourceType.UserInput&&(null===(c=t.format)||void 0===c?void 0:c.dateFormat)&&t.format.dateFormat.includes("Time")&&e.includes(l)&&(p=d.inputEditorTypes[1])}e===a.SqlExpressionMode.Simple&&(o[s]=[s===u?p:d.inputEditorTypes[0]],delete o[a.ClauseSourceType.SingleSelectFromPredefined],delete o[a.ClauseSourceType.MultipleSelectFromPredefined])}))}else u=a.ClauseSourceType.UserInput,o[u]=[p];return{displayTypes:o,codedValues:n,defaultSourceType:u,defaultInputEditorType:p}}function qe(e,t,l,r){t=t||a.ClauseSourceType.UserInput;const i=E[e];let o=[],n=null;if(i){const e=i[t];o=e.normalInputEditors,e.codedValueInputEditors&&l&&r&&(n=null==l?void 0:l.getFieldCodedValueList(r),(null==n?void 0:n.length)>0&&(o=e.codedValueInputEditors))}else o=[s.TextInput];return{inputEditorTypes:o,codedValues:n}}function We(e){let t=null;return"esriFieldTypeString"===e?t=a.JimuFieldType.String:"esriFieldTypeDate"===e?t=a.JimuFieldType.Date:["esriFieldTypeOID","esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].includes(e)&&(t=a.JimuFieldType.Number),t}function ze(e,t){return T(We(e),t)}function He(e,t){const s=[],l=e.map((e=>e.id)),r=function(e,t,s){if(!e){const l=t.getSchema().fields,r=T((s=s||l[Object.keys(l)[0]]).type,!1)[0],i=_e(a.SqlExpressionMode.All,s,r,t,s.jimuName),o=ke(i.defaultSourceType,i.defaultInputEditorType,null,!1);e={type:a.ClauseType.Single,jimuFieldName:s.jimuName,operator:r,displayType:a.ClauseDisplayType.None,askForValueOptions:null,displayLabel:null,valueOptions:o}}return e}(null,e[0],t);return s.push({dataSourceId:l[0],fieldList:[r.jimuFieldName],logicalOperator:a.ClauseLogic.And,clause:r}),l.slice(1,l.length).forEach((e=>{s.push(function(e){return{dataSourceId:e,logicalOperator:a.ClauseLogic.And,fieldList:[]}}(e))})),(0,a.Immutable)(s)}function Qe(e,t,s=!1){if(!e)return null;let l;return l=s?e.asMutable({deep:!0}).concat({dataSourceId:t,logicalOperator:a.ClauseLogic.And,fieldList:[]}):e.filter((e=>e.dataSourceId!==t)),(0,a.Immutable)(l)}class $e extends a.React.PureComponent{constructor(e){super(e),this._setStateForInputEditor=()=>{const e={valueOptions:this.props.valueOptions,fieldObj:this.props.fieldObj,onChange:this.props.onChange,dataSource:this.props.dataSource,codedValues:this.props.codedValues||null,runtime:this.props.runtime||!1,sql:this.props.sql||null,isSmallSize:this.props.isSmallSize,"aria-label":this.props["aria-label"],"aria-describedby":this.props["aria-describedby"]};this.setState({inputEditor:Fe(e)})},this.state={inputEditor:null}}componentDidMount(){this._setStateForInputEditor()}componentDidUpdate(e,t){this.props.fieldObj===e.fieldObj&&this.props.valueOptions===e.valueOptions&&this.props.codedValues===e.codedValues&&this.props.sql===e.sql&&this.props.isSmallSize===e.isSmallSize||this._setStateForInputEditor()}render(){return a.React.createElement("div",{className:"input-editor w-100 h-100 "+(this.props.isFromBuilder?"is-sql-builder":"")},this.state.inputEditor)}}const Ge=$e;class Je extends a.React.PureComponent{constructor(e){var t;super(e),this.i18nMessage=e=>this.props.intl.formatMessage({id:e,defaultMessage:R.defaultMessages[e]}),this.getCodedValues=()=>{let e=null;return this.props.clause.valueOptions.sourceType===a.ClauseSourceType.UserInput&&(e=qe(this.props.clause.operator,this.props.clause.valueOptions.sourceType,this.props.dataSource,this.props.clause.jimuFieldName).codedValues),e},this.onValueOptsChange=e=>{const t=Object.assign({},this.props.clause,{valueOptions:e});this.props&&this.props.onChange(t,this.props.id)},this.hintId=(null===(t=this.props.clause.askForValueOptions)||void 0===t?void 0:t.hint)?`clause-hint-${Math.round(1e9*Math.random())}`:null}render(){this.fieldObj=(0,a.Immutable)(this.props.dataSource.getSchema().fields[this.props.clause.jimuFieldName]);const e=this.i18nMessage(N(this.props.clause.operator)),t=k(this.props.clause,this.fieldObj,e),{displayType:s,askForValueOptions:l}=this.props.clause,r=l&&l.hint;return(0,a.jsx)("div",{className:(0,a.classNames)("sql-expression-single",this.props.className,{"m-0":s===a.ClauseDisplayType.None})},s===a.ClauseDisplayType.UseAskForValue&&(0,a.jsx)(a.React.Fragment,null,(0,a.jsx)("div",{className:l.display===a.ClauseLabelDisplay.Inline&&""!==l.label?"clause-inline":"clause-block"},""!==l.label&&(0,a.jsx)("div",{className:"sql-expression-label"},t),(0,a.jsx)("div",{className:"sql-expression-input"},(0,a.jsx)(Ge,{"aria-label":t,"aria-describedby":this.hintId,onChange:this.onValueOptsChange,dataSource:this.props.dataSource,codedValues:this.getCodedValues(),valueOptions:this.props.clause.valueOptions,fieldObj:this.fieldObj,runtime:!0,sql:D(this.props.expression,this.props.clause,this.props.id,this.props.dataSource)}))),r&&(0,a.jsx)("div",{className:"w-100 sql-expression-hint",id:this.hintId},r)),s===a.ClauseDisplayType.UseLabel&&(0,a.jsx)("div",{className:"w-100 sql-expression-displaylabel"},t))}}const Ke=(0,W.withStyles)((0,a.injectIntl)(Je),"SqlExpressionClauseRuntime");class Ye extends a.React.PureComponent{constructor(e){super(e),this.i18nMessage=e=>this.props.intl.formatMessage({id:e,defaultMessage:R.defaultMessages[e]}),this.onClauseChange=(e,t)=>{const s=V(this.state.partsArray,e,t),l=0===this.state.partsArray.length?null:{type:a.ClauseType.Set,logicalOperator:this.props.clauseSet.logicalOperator,parts:s};this.props.onChange&&this.props.onChange(l,this.props.id),this.setState({partsArray:s})},this.state={partsArray:this.props.clauseSet&&this.props.clauseSet.parts?this.props.clauseSet.parts:[]}}componentDidUpdate(e,t){this.props.clauseSet!==e.clauseSet&&this.setState({partsArray:this.props.clauseSet.parts})}render(){return(0,a.jsx)("div",{className:this.props.className?this.props.className:""},0===this.state.partsArray.length?null:(0,a.jsx)("div",{className:"sql-expression-set"},this.state.partsArray.map(((e,t)=>{const s=this.props.id+"_clause_"+t;return e.displayLabel!==a.ClauseDisplayType.None&&(0,a.jsx)(Ke,{key:t.toString(),id:s,clause:e,isHosted:this.props.isHosted,expression:this.props.expression,dataSource:this.props.dataSource,onChange:this.onClauseChange})}))))}}const Ze=(0,W.withTheme)((0,a.injectIntl)(Ye));class Xe extends a.React.PureComponent{constructor(e){var t;super(e),this.i18nMessage=e=>this.props.intl.formatMessage({id:e,defaultMessage:R.defaultMessages[e]}),this.onChange=(e,t)=>{const s=V(this.props.expression.parts.asMutable({deep:!0}),e,t);let l=(0,a.Immutable)({sql:this.props.expression.sql,displaySQL:this.props.expression.displaySQL,logicalOperator:this.props.expression.logicalOperator,parts:s});const r=a.dataSourceUtils.getArcGISSQL(l,this.props.dataSource);l=l.set("sql",r.sql).set("displaySQL",r.displaySQL),this.props.onChange&&this.props.onChange(l)};const s=this.props.dataSource;s&&(this.isHosted=a.dataSourceUtils.isAGOLHostedService(s.getDataSourceJson().url||(null===(t=s.layer)||void 0===t?void 0:t.url))),this.state={}}render(){return(0,a.jsx)("div",{className:this.props.className?this.props.className:""},(0,a.jsx)(R.QueryScopeContext.Provider,{value:{scope:this.props.queryScope||a.QueryScope.InRuntimeView,widgetId:this.props.widgetId}},(0,a.jsx)("div",{style:this.props.style,className:"sql-expression-builder"},this.props.expression?(0,a.jsx)("div",{className:"sql-expression-container"},0===this.props.expression.parts.length?(0,a.jsx)("div",{className:"no-data-tip"},this.i18nMessage("noClauseTip")):this.props.expression.parts.map(((e,t)=>e.type===a.ClauseType.Single?e.displayLabel!==a.ClauseDisplayType.None&&(0,a.jsx)(Ke,{key:t,id:"clause_"+t,expression:this.props.expression,clause:e,isHosted:this.isHosted,dataSource:this.props.dataSource,onChange:this.onChange}):(0,a.jsx)(Ze,{key:t,id:"clauseset_"+t,expression:this.props.expression,clauseSet:e,isHosted:this.isHosted,dataSource:this.props.dataSource,onChange:this.onChange})))):(0,a.jsx)("div",{className:"no-data-tip"},this.i18nMessage("noAddedDataSourceCanBeUsed")))))}}const et=(0,W.withTheme)((0,a.injectIntl)(Xe));(0,W.registerStyles)("jimu-ui/basic/sql-expression-runtime/",e)})(),o})())}}}));
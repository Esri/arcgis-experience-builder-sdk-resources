System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-theme","jimu-arcgis"],(function(e,t){var a={},o={},s={},r={},i={},n={};return{setters:[function(e){a.AllDataSourceTypes=e.AllDataSourceTypes,a.CONSTANTS=e.CONSTANTS,a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.MessageCarryData=e.MessageCarryData,a.MessageType=e.MessageType,a.React=e.React,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.jsx=e.jsx,a.polished=e.polished},function(e){o.Checkbox=e.Checkbox,o.Label=e.Label,o.NumericInput=e.NumericInput,o.Radio=e.Radio},function(e){s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection},function(e){r.DEFAULT_DATA_VIEW_ID=e.DEFAULT_DATA_VIEW_ID,r.DataSourceSelector=e.DataSourceSelector},function(e){i.withTheme=e.withTheme},function(e){n.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes}],execute:function(){e((()=>{"use strict";var e={62686:e=>{e.exports=n},79244:e=>{e.exports=a},1888:e=>{e.exports=i},14321:e=>{e.exports=o},13089:e=>{e.exports=r},79298:e=>{e.exports=s}},t={};function u(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,u),s.exports}u.d=(e,t)=>{for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};u.r(c),u.d(c,{default:()=>E});var l=u(79244),d=u(14321),p=u(79298),g=u(13089);const m="Trigger data",S="All data",h="Customized data",D="Return to the initial map extent when selection is cleared",f="Zoom scale",I="Automatic",y="Custom",T="Type a scale";var v=u(1888),C=u(62686);function A(e,t){var a,o;const s=j(),r=null===(a=null==s?void 0:s.widgets)||void 0===a?void 0:a[e],i=null===(o=null==r?void 0:r.manifest)||void 0===o?void 0:o.publishMessages;let n=l.MessageCarryData.UseDataSource;return null==i||i.forEach((e=>{const a=e;(null==a?void 0:a.messageCarryData)&&(null==a?void 0:a.messageType)===t&&(n=null==a?void 0:a.messageCarryData)})),n}function M(e,t){if(t===l.MessageType.DataSourceFilterChange){const t=l.DataSourceManager.getInstance().getDataSource(e);if(t&&t.type===l.DataSourceTypes.ImageryLayer)return!1}return!0}function b(e,t,a,o){var s,r;let i=null;const n=x(e,a);if(!(n&&n.length>0))return null;let u=!1;if(t){const e=null===(r=null===(s=l.DataSourceManager.getInstance().getDataSource(t.dataSourceId))||void 0===s?void 0:s.getDataSourceJson())||void 0===r?void 0:r.isOutputFromWidget;u=n.some((a=>!!a&&(U(a.dataSourceId)?a.dataSourceId===t.rootDataSourceId:e||o?t.mainDataSourceId===a.mainDataSourceId:t.dataSourceId===a.dataSourceId)))}if(u)i=t;else if(i=null,n&&1===n.length){const e=n[0];e&&e.dataSourceId&&!U(e.dataSourceId)&&(i=(0,l.Immutable)({dataSourceId:e.dataSourceId,mainDataSourceId:e.mainDataSourceId,dataViewId:e.dataViewId,rootDataSourceId:e.rootDataSourceId}))}return i}function x(e,t){var a;const o=A(e,t),s=j(),r=null===(a=null==s?void 0:s.widgets)||void 0===a?void 0:a[e],i=(null==r?void 0:r.useDataSources)||(0,l.Immutable)([]),n=function(e){var t;const a=null!==(t=null==e?void 0:e.map((e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}))))&&void 0!==t?t:[];return(0,l.Immutable)(a)}(null==r?void 0:r.outputDataSources)||(0,l.Immutable)([]),u=function(e){const t=[],a=R(e),o=null==a?void 0:a.useMapWidgetIds,s={};(null==o?void 0:o.length)>0&&o.forEach((e=>{if(e){const a=R(e),o=null==a?void 0:a.useDataSources;o&&o.forEach((e=>{var a;const o=null===(a=null==e?void 0:e.asMutable)||void 0===a?void 0:a.call(e,{deep:!0});o&&o.dataSourceId&&!s[o.dataSourceId]&&(s[o.dataSourceId]=!0,t.push(o))}))}}));return(0,l.Immutable)(t)}(e),c=n,d=(null==r?void 0:r.useDataSources)?i:u,p=(0,l.Immutable)(d.asMutable({deep:!0}).concat(c.asMutable({deep:!0})));switch(o){case l.MessageCarryData.OutputDataSource:return c;case l.MessageCarryData.UseDataSource:return d;case l.MessageCarryData.BothDataSource:return p}}function R(e){var t;if(!e)return null;const a=j();return null===(t=null==a?void 0:a.widgets)||void 0===t?void 0:t[e]}function w(e,t,a){const o=A(null==e?void 0:e.id,t),s=(null==e?void 0:e.outputDataSources)||[],r=(null==e?void 0:e.useDataSources)||[];if(a)return!1;switch(o){case l.MessageCarryData.OutputDataSource:return 1===(null==s?void 0:s.length);case l.MessageCarryData.UseDataSource:return 1===(null==r?void 0:r.length);case l.MessageCarryData.BothDataSource:return 1===s.length+r.length}}function j(){var e,t,a;return window.jimuConfig.isBuilder?null===(t=null===(e=(0,l.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig:null===(a=(0,l.getAppStore)().getState())||void 0===a?void 0:a.appConfig}function L(e,t){let a=[];const o=x(e,t);return o&&o.forEach((e=>{const t=null==e?void 0:e.dataSourceId;t&&U(t)&&a.push(t)})),a=Array.from(new Set(a)),a.length>0?(0,l.Immutable)(a):void 0}function O(e,t){const a=x(e,t),o=[];return a&&a.forEach((e=>{const t=null==e?void 0:e.mainDataSourceId;t&&!U(t)&&o.push(t)})),(0,l.Immutable)(o)}function U(e){const t=j();if(e&&t.dataSources){const a=t.dataSources[e];if(a&&(a.type===C.ArcGISDataSourceTypes.WebMap||a.type===C.ArcGISDataSourceTypes.WebScene))return!0}return!1}const N=(0,l.Immutable)([l.AllDataSourceTypes.FeatureLayer,l.AllDataSourceTypes.SceneLayer,l.AllDataSourceTypes.BuildingComponentSubLayer,l.AllDataSourceTypes.ImageryLayer,l.AllDataSourceTypes.OrientedImageryLayer,l.AllDataSourceTypes.SubtypeGroupLayer,l.AllDataSourceTypes.SubtypeSublayer]);class _ extends l.React.PureComponent{constructor(e){super(e),this.NoLockTriggerLayerWidgets=["Map"],this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.onAllDataRadioChecked=()=>{const e=this.props.config.set("useAnyTriggerData",!0);this.updateMessageActionConfigAndUseDataSources(e)},this.onCustomizeDataRadioChecked=()=>{const e=this.props.config.set("useAnyTriggerData",!1);this.updateMessageActionConfigAndUseDataSources(e)},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e):this.handleRemoveLayerForTriggerLayer()},this.handleTriggerLayerSelected=e=>{let t=null;if(this.fromRootDsIds)t=e;else{t=x(this.props.messageWidgetId,this.props.messageType).filter((t=>!!e.find((e=>{var a;return e.dataViewId&&e.dataViewId!==l.CONSTANTS.OUTPUT_DATA_VIEW_ID||(null===(a=this.props.config.useDataSources)||void 0===a?void 0:a.find((t=>e.mainDataSourceId===t.mainDataSourceId)))?e.dataSourceId===t.dataSourceId:e.mainDataSourceId===t.mainDataSourceId}))))}let a=this.props.config.set("useDataSource",t[0]);a=a.set("useDataSources",t),this.updateMessageActionConfigAndUseDataSources(a)},this.handleRemoveLayerForTriggerLayer=()=>{let e=this.props.config.set("useDataSource",null);e=e.set("useDataSources",[]),this.updateMessageActionConfigAndUseDataSources(e)},this.handleIsUseCustomZoomToOption=e=>{if(e&&(!this.props.config.zoomToOption||!this.props.config.zoomToOption.scale)){const t=this.props.config.set("isUseCustomZoomToOption",e).setIn(["zoomToOption","scale"],5e3);return void this.updateMessageActionConfigAndUseDataSources(t)}const t=this.props.config.set("isUseCustomZoomToOption",e);this.updateMessageActionConfigAndUseDataSources(t)},this.handleSetCustomZoomScale=e=>{const t=this.props.config.setIn(["zoomToOption","scale"],e);this.updateMessageActionConfigAndUseDataSources(t)},this.onGoToInitialMapExtentWhenSelectionClearedCheckboxChanged=(e,t)=>{t=!!t;const a=this.props.config.set("goToInitialMapExtentWhenSelectionCleared",t);this.updateMessageActionConfigAndUseDataSources(a)},this.getTriggerLayerContent=()=>{const e=this.props.messageType===l.MessageType.DataRecordsSelectionChange,t=this.props.messageType===l.MessageType.DataSourceFilterChange;if(!e&&!t)return null;const a=function(e,t,a,o){var s;const r=j(),i=null===(s=null==r?void 0:r.widgets)||void 0===s?void 0:s[e],n=L(e,o);let u,c=!1;c=!(n&&n.length>0)&&w(i,o,n),u=n&&n.length>0?void 0:O(e,o).filter((e=>M(e,o)));return{isReadOnly:c,useDataSource:t,useDataSources:a||(0,l.Immutable)([]),fromRootDsIds:n,fromDsIds:u}}(this.props.messageWidgetId,this.props.config.useDataSource,this.props.config.useDataSources,this.props.messageType);let o;o=a.useDataSources?(0,l.Immutable)(a.useDataSources):a.useDataSource?(0,l.Immutable)([a.useDataSource]):(0,l.Immutable)([]);const s=!a.isReadOnly;let r,i,n,u=null;e?(u=!0,r=!1,i=!0,n=a.isReadOnly):(u=(e,t)=>!x(this.props.messageWidgetId,this.props.messageType).filter((e=>e.mainDataSourceId===t)).find((t=>{let a;return a=t.dataViewId?t.dataViewId:g.DEFAULT_DATA_VIEW_ID,a===e.id})),r=!0,i=!1,n=!1),this.fromRootDsIds=a.fromRootDsIds;const c=!!this.props.config.useAnyTriggerData,m=this.props.intl.formatMessage({id:"mapAction_AllData",defaultMessage:S}),D=this.props.intl.formatMessage({id:"mapAction_CustomizeData",defaultMessage:h});return(0,l.jsx)("div",null,(0,l.jsx)(p.SettingRow,null,(0,l.jsx)(d.Label,{className:"d-flex align-items-center",style:{cursor:"pointer"}},(0,l.jsx)(d.Radio,{className:"mr-2",checked:c,onChange:()=>{this.onAllDataRadioChecked()}}),m)),(0,l.jsx)(p.SettingRow,null,(0,l.jsx)(d.Label,{className:"d-flex align-items-center",style:{cursor:"pointer"}},(0,l.jsx)(d.Radio,{className:"mr-2",checked:!c,onChange:()=>{this.onCustomizeDataRadioChecked()}}),D)),(0,l.jsx)(p.SettingRow,null,(0,l.jsx)(g.DataSourceSelector,{className:(0,l.classNames)([{"d-none":c}]),types:N,useDataSources:o,fromRootDsIds:a.fromRootDsIds,fromDsIds:a.fromDsIds,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,disableRemove:()=>a.isReadOnly,disableDataSourceList:n,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,isMultiple:s,hideDataView:u,isMultipleDataView:r,disableDataView:i,hideCreateViewButton:!0,enableToSelectOutputDsFromSelf:!0})))},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1}}componentDidMount(){const e=function(e,t,a){let o=null;const s=[];if(e.useDataSource){const r=!1;o=b(t,e.useDataSource,a,r),e.useDataSources&&e.useDataSources.forEach((e=>{const o=b(t,e,a,r);o&&s.push(o)}))}else{let e=x(t,a);e=e.filter((e=>M(e.dataSourceId,a))),e.length>0&&e.forEach(((e,t)=>{let a;U(e.dataSourceId)?a=null:(a=(0,l.Immutable)({dataSourceId:e.dataSourceId,mainDataSourceId:e.mainDataSourceId,rootDataSourceId:e.rootDataSourceId,dataViewId:e.dataViewId}),o||(o=a),s.push(a))}))}return{useDataSource:o,useDataSources:s}}(this.props.config,this.props.messageWidgetId,this.props.messageType);let t=this.props.config.set("useDataSource",e.useDataSource);t=t.set("useDataSources",e.useDataSources),this.updateMessageActionConfigAndUseDataSources(t)}getStyle(e){return l.css`
      .setting-header {
        padding: ${l.polished.rem(10)} ${l.polished.rem(16)} ${l.polished.rem(0)} ${l.polished.rem(16)}
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }
    `}updateMessageActionConfigAndUseDataSources(e){const t=function(e){const t=[];return e&&e.useDataSources&&e.useDataSources.forEach((e=>{if(e){const a=(0,l.Immutable)(e).asMutable({deep:!0});t.push(a)}})),t}(e);this.props.onSettingChange({actionId:this.props.actionId,config:e,useDataSources:t})}render(){const e=this.props.messageType===l.MessageType.DataRecordsSelectionChange,t=this.props.messageType===l.MessageType.DataSourceFilterChange,a=e||t,o=this.props.config.goToInitialMapExtentWhenSelectionCleared||!1;return(0,l.jsx)("div",{css:this.getStyle(this.props.theme)},a&&(0,l.jsx)(p.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:m})},this.getTriggerLayerContent()),(0,l.jsx)(p.SettingSection,{title:this.props.intl.formatMessage({id:"mapZoomToAction_ZoomScale",defaultMessage:f})},(0,l.jsx)(p.SettingRow,null,(0,l.jsx)(d.Label,{className:"d-flex align-items-center",style:{cursor:"pointer"}},(0,l.jsx)(d.Radio,{className:"mr-2",checked:!this.props.config.isUseCustomZoomToOption,onChange:()=>{this.handleIsUseCustomZoomToOption(!1)}}),this.props.intl.formatMessage({id:"mapZoomToAction_Automatic",defaultMessage:I}))),(0,l.jsx)(p.SettingRow,null,(0,l.jsx)(d.Label,{className:"d-flex align-items-center",style:{cursor:"pointer"}},(0,l.jsx)(d.Radio,{style:{cursor:"pointer"},className:"mr-2",checked:this.props.config.isUseCustomZoomToOption,onChange:()=>{this.handleIsUseCustomZoomToOption(!0)}}),this.props.intl.formatMessage({id:"mapZoomToAction_Custom",defaultMessage:y}))),this.props.config.isUseCustomZoomToOption&&(0,l.jsx)(p.SettingRow,null,(0,l.jsx)(d.NumericInput,{className:"w-100",placeholder:this.props.intl.formatMessage({id:"mapZoomToAction_TypeScale",defaultMessage:T}),value:this.props.config.zoomToOption&&this.props.config.zoomToOption.scale,onChange:this.handleSetCustomZoomScale}))),e&&(0,l.jsx)(p.SettingSection,null,(0,l.jsx)(d.Label,{className:"d-flex align-items-center"},(0,l.jsx)(d.Checkbox,{checked:o,className:"mr-2",onChange:this.onGoToInitialMapExtentWhenSelectionClearedCheckboxChanged}),this.props.intl.formatMessage({id:"mapAction_ReturnToInitialMapExtent",defaultMessage:D}))))}}_.defaultProps={config:(0,l.Immutable)({useDataSource:null})};const E=(0,v.withTheme)(_);return c})())}}}));
/*! For license information please see vendors-node_modules_arcgis_map-components_dist_esm_arcgis-version-management_entry_js.bundle.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-node_modules_arcgis_map-components_dist_esm_arcgis-version-management_entry_js"],{461:(e,t,i)=>{i.r(t),i.d(t,{arcgis_version_management:()=>l});var s=i(9650),n=i(4532),o=i(8740),r=i(3191),a=i(8952);i(3793);const c=(0,r.m)(o.al),l=class{constructor(e){(0,s.r)(this,e),this.arcgisReady=(0,s.c)(this,"arcgisReady",7),this.arcgisVersioningStateChanged=(0,s.c)(this,"arcgisVersioningStateChanged",7),this.manager=(0,a.u)(this),this.reactiveUtils=(0,n.l)(o.h),this.viewModel=c(this),this.messages=(0,r.u)({blocking:!0}),this.allowEditingDisabled=!1,this.autoDestroyDisabled=!1,this.closable=!1,this.icon=void 0,this.label=void 0,this.mode=void 0,this.pageSize=5,this.position="top-right",this.referenceElement=void 0,this.state=this.viewModel.state,this.versioningStates=this.viewModel.versioningStates,this.view=this.viewModel.view}async componentWillLoad(){const{watch:e}=this.reactiveUtils;this.manager.onLifecycle((()=>[e((()=>this.viewModel.state),(e=>{const{flowElement:t}=this,i=t?.getElementsByTagName("arcgis-version-management-version-properties")[0],s=t?.getElementsByTagName("arcgis-version-management-version-list")[0];if("disabled"===e)return i&&this._removeVersionPropertiesFlowItem(t),void(s&&this._removeVersionListFlowItem(t));s&&(s.versionListElementProps={...s.versionListElementProps,executionError:this.viewModel.executionError},s.versionListElementProps={...s.versionListElementProps,state:e}),i&&(i.versionPropertiesElementProps={...i.versionPropertiesElementProps,state:e})}))]))}async destroy(){await this.manager.destroy()}render(){const{allowEditingDisabled:e,closable:t,flowElement:i,label:n,messages:o,pageSize:r,viewModel:a,viewModel:{loadError:c,state:l}}=this,h=Array.from(a.serviceNameLookup,(([e,t])=>({url:e,name:t}))),d="disabled"!==l?(0,s.h)(s.F,null,h.map((c=>{const h={allowEditing:!e,closable:t,currentUser:a.userLookup.get(c.url),currentVersionIdentifier:a.versioningStateLookup.get(c.url).currentVersionInfo.versionIdentifier,executionError:void 0,flowElement:i,hasAdvEditingUte:a.advancedEditingUserTypeExtensionLookup.get(c.url),heading:n,isVersioningApiAvailable:(a.serverVersionLookup.get(c.url)??0)>=11.2,pageSize:r,serviceName:c.name,state:l,serviceUrl:c.url,strings:o,versionInfos:a.versioningStateLookup.get(c.url)?.versionInfos??[]};return(0,s.h)("arcgis-version-management-service-item",{serviceItemElementProps:h,onArcgisGetVersions:async e=>{await this._refreshVersionList(e.detail.serviceUrl)},onArcgisFlowItemBack:()=>{this._removeVersionListFlowItem(i)},onArcgisFlowItemClose:()=>{this._handleFlowItemClose()},onArcgisManageVersion:e=>{this._handleManageVersionAction(e,i)},onArcgisNewVersion:e=>{const t=this._createVersionPropertiesFlowItem(e.detail.serviceUrl,void 0);i?.appendChild(t)}})}))):void 0,m="disabled"===l?(0,s.h)("calcite-notice",{class:"notice",closable:!1,kind:"warning",open:!0,scale:"s",slot:"footer",width:"full"},(0,s.h)("div",{slot:"message"},this._getLoadError(c))):void 0;return(0,s.h)("calcite-flow",{ref:e=>{this.flowElement=e},class:"dialog"===this.mode?"":"calcite-flow-widget"},(0,s.h)("calcite-flow-item",{closable:this.closable,heading:n??void 0,onCalciteFlowItemClose:()=>{this._handleFlowItemClose()}},(0,s.h)("calcite-panel",{loading:"loading"===l||"executing"===l},d,m)))}_createVersionPropertiesFlowItem(e,t){const{closable:i,flowElement:s,viewModel:n,viewModel:{state:o}}=this,r=document.createElement("arcgis-version-management-version-properties");return r.versionPropertiesElementProps={closable:i,currentUser:n.userLookup.get(e),hasAdvEditingUte:n.advancedEditingUserTypeExtensionLookup.get(e),serviceUrl:e,state:o,strings:this.messages,versionInfo:t},r.addEventListener("arcgisCreateVersion",(t=>{const{createVersionParameters:i,switchToVersion:o}=t.detail;n.createVersion(i).then((async t=>{t&&this.arcgisVersioningStateChanged.emit({type:"version-created",versionIdentifier:t.versionIdentifier,versioningState:n.versioningStateLookup.get(e)}),o&&await this.viewModel.changeVersion(e,t.versionIdentifier.name,t.versionIdentifier.guid).then((i=>{i&&this.arcgisVersioningStateChanged.emit({type:"version-switched",versionIdentifier:t.versionIdentifier,versioningState:n.versioningStateLookup.get(e)})})),await this._refreshVersionList(e)})).finally((()=>{this._removeVersionPropertiesFlowItem(s)}))})),r.addEventListener("arcgisAlterVersion",(async t=>{const{flowElement:i}=this,{alterVersionParameters:s}=t.detail;await n.alterVersion(s).then((async t=>{t&&this.arcgisVersioningStateChanged.emit({type:"version-changed",versionIdentifier:s.versionIdentifier,versioningState:n.versioningStateLookup.get(e)}),await this._refreshVersionList(e)})).finally((()=>{this._removeVersionPropertiesFlowItem(i)}))})),r.addEventListener("arcgisFlowItemBack",(()=>{this._removeVersionPropertiesFlowItem(this.flowElement)})),r.addEventListener("calciteFlowItemBack",(e=>{e.preventDefault(),this._removeVersionPropertiesFlowItem(this.flowElement)})),r.addEventListener("calciteFlowItemClose",(()=>{this._handleFlowItemClose()})),r}_getLoadError(e){const{messages:t}=this;switch(e){case"no-feature-services":return t.loadErrors.noFeatureServices;case"no-view-property":return t.loadErrors.noViewProperty;default:return e}}_handleFlowItemClose(){const e=document.querySelector("arcgis-version-management"),t=e.parentElement;t?.removeChild(e)}async _handleManageVersionAction(e,t){const{actionType:i,serviceUrl:s,versionInfo:n}=e.detail,{viewModel:o}=this;switch(i){case"changeVersion":o.changeVersion(s,n.versionIdentifier.name,n.versionIdentifier.guid).then((e=>{e&&this.arcgisVersioningStateChanged.emit({type:"version-switched",versionIdentifier:n.versionIdentifier,versioningState:o.versioningStateLookup.get(s)});const i=t?.getElementsByTagName("arcgis-version-management-version-list")[0];i&&i&&(i.versionListElementProps={...i.versionListElementProps,currentVersionIdentifier:o.versioningStateLookup.get(s).currentVersionInfo.versionIdentifier})}));break;case"deleteVersion":o.deleteVersion(s,n.versionIdentifier.name,n.versionIdentifier.guid).then((async e=>{e&&this.arcgisVersioningStateChanged.emit({type:"version-deleted",versionIdentifier:n.versionIdentifier,versioningState:o.versioningStateLookup.get(s)}),await this._refreshVersionList(s)}));break;case"editVersion":{const e=this._createVersionPropertiesFlowItem(s,n);t.appendChild(e);break}}}async _refreshVersionList(e){const{flowElement:t,viewModel:i}=this;if(t){const s=await i.getVersionInfos(e),n=t.getElementsByTagName("arcgis-version-management-service-item");for(const t of n)t.serviceItemElementProps.serviceUrl===e&&(t.serviceItemElementProps={...t.serviceItemElementProps,versionInfos:s});const o=t.getElementsByTagName("arcgis-version-management-version-list")[0];o&&(o.versionListElementProps={...o.versionListElementProps,currentVersionIdentifier:i.versioningStateLookup.get(e).currentVersionInfo.versionIdentifier,versionInfos:s})}}_removeVersionListFlowItem(e){for(const t of e.childNodes)"ARCGIS-VERSION-MANAGEMENT-VERSION-LIST"===t.nodeName.toUpperCase()&&e.removeChild(t),"CALCITE-FLOW-ITEM"===t.nodeName.toUpperCase()&&(t.hidden=!1)}_removeVersionPropertiesFlowItem(e){for(const t of e.childNodes)"ARCGIS-VERSION-MANAGEMENT-VERSION-PROPERTIES"===t.nodeName.toUpperCase()&&e.removeChild(t),"ARCGIS-VERSION-MANAGEMENT-VERSION-LIST"===t.nodeName.toUpperCase()&&(t.getElementsByTagName("calcite-flow-item")[0].hidden=!1)}static get assetsDirs(){return["assets"]}get el(){return(0,s.g)(this)}};l.style=".calcite-flow-widget{width:350px}calcite-block{margin:0}calcite-pagination{justify-content:center}"},4532:(e,t,i)=>{i.d(t,{l:()=>c,m:()=>l,u:()=>d});var s=i(8952),n=i(8740),o=e=>a(void 0,e),r=class extends s.C{constructor(e,t){super(e);const i=this.exports;try{(0,s.s)(this.component);const e=t(this.component,this),n=this.exports!==i;if(e instanceof Promise){n||this.setProvisionalExports(e);const t=e.then((e=>{this.exports=e,super.catchUpLifecycle()})).catch((e=>{this._ready.reject(e),console.error(e)}));this.onLoad((async()=>await t))}else n&&void 0===e||(this.exports=e),queueMicrotask((()=>super.catchUpLifecycle()))}catch(e){this._ready.reject(e),console.error(e)}}catchUpLifecycle(){}},a=(0,s.p)(r),c=o,l=e=>(t={})=>o(((i,o)=>{const r=i;function a(e){const t=o.exports,i=t._original??t,s=h(i,e);s._original=i,o.exports=s}if(o.onLifecycle((()=>(0,n.s)(i.el,e("./assets"),(({t9nLocale:e,t9nStrings:t,lang:s})=>{const n={...t,_lang:s,_t9nLocale:e,_loading:!1};o.exports=n;const c=t.componentLabel??t.widgetLabel;"string"==typeof c&&"label"in i&&null==i.label&&(i.label??(i.label=c)),a(r.messageOverrides)}),t.name))),"messageOverrides"in r&&o.onLifecycle((()=>(0,s.w)(r,"messageOverrides",a))),t.blocking)return o.ready;const c=(0,n.g)(i.el);return{_lang:c.lang,_t9nLocale:c.t9nLocale,_loading:!0}}));function h(e,t){if(!t)return e;const i={...e};return Object.entries(t).forEach((([t,s])=>{i[t]="object"==typeof s?h(e[t],s):s??e[t]})),i}var d=e=>v,m="arcgisPropertyChange",v=(...e)=>o(((t,i)=>{let n=t[m];return t.manager.isLit&&(n=t.constructor.createEvent(m,void 0,t)),i.onLoad((()=>i.onLifecycle((()=>e.map((e=>(0,s.w)(t,e,(()=>n.emit({name:e}))))))))),n}))},3191:(e,t,i)=>{i.d(t,{m:()=>c,u:()=>a});var s=i(4532),n=i(9650),o=i(8952),r=i(3793);const a=(0,s.m)(n.a),c=(e,t)=>(t,i)=>h(t,e,i);class l extends o.A{hostConnected(){this.component.manager.loadedCalled&&(0,r.a)(this.component)}async hostLoad(){await super.hostLoad(),this.component.manager.destroyed||(this._watchMetaProperties(),o.a.reEmitAccessorEvents(this,this._instance,this.reactiveUtils,"viewModel"))}hostLoaded(){const{el:e}=this.component,t=e.shadowRoot?.firstElementChild??e.firstElementChild??void 0;e.childElem=t??e.childElem;let i=!1;const s=this.component.el.view;Object.defineProperty(this.component.el,"view",{get:()=>this._instance.view,set:e=>{const t=this.component.el.view,s=e;this._instance.view=s,this._instance.map=s?.map,this._watchViewDestroy(),this.component.requestUpdate("view",t),e&&!i&&(i=!0,this.component.arcgisReady.emit())},configurable:!0,enumerable:!0}),s&&(this._instance.view=s),this.component.el.isConnected&&((0,r.a)(this.component),this._watchViewDestroy())}hostDisconnected(){"object"==typeof this.component.el.childElem&&this.component.el.view?.ui?.remove(this.component.el.childElem)}hostDestroy(){super.hostDestroy(),this._watchViewDestroyHandle?.remove()}_watchMetaProperties(){(0,o.w)(this.component,"position",(e=>{null!=this.component.el.childElem&&"string"==typeof e&&(0,r.a)(this.component)})),(0,o.w)(this.component,"referenceElement",(()=>(0,r.a)(this.component)))}_watchViewDestroy(){this._watchViewDestroyHandle?.remove(),this._watchViewDestroyHandle=this.reactiveUtils.when((()=>!0===this.component.el.view?.destroyed),(()=>{this.component.destroy().catch(console.error)}),{sync:!0})}}const h=(0,o.p)(l)}}]);
/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_guid-a-551971.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_guid-a-551971"],{64307:(t,e,n)=>{n.d(e,{a:()=>p,b:()=>c,c:()=>d,d:()=>v,e:()=>a,f:()=>b,g:()=>u,h:()=>m,i:()=>h,j:()=>g,q:()=>f,u:()=>$});var r=n(66913),s=n(70392),i=n(46710);const o='owner:"esri" AND title:"AppSwitcher Config" AND type: "Application Configuration"';async function a(t){const e=(0,s.g)(t);if(!e)return;const n=`${e}portals/self/settings`;return(0,r.f)((()=>w(n)),"portalSettings",e)}async function l(t){const e=(0,s.g)();if(e&&t)return w(`${e}content/items/${t}/data`)}async function u(){var t;const{portal:e,user:n}=i.c;if(!(null==e?void 0:e.id)||!n)return;const r=await async function(){const t=(0,s.g)();if(t)return w(`${t}search`,{num:1,start:0,sortField:"title",sortOrder:"asc",q:o})}(),a=null===(t=null==r?void 0:r.results)||void 0===t?void 0:t[0];if(!a)return;const u=a.id;return await l(u)}async function c(){const{user:t}=i.c;return w(`${(0,s.g)()}community/users/${t.username}/properties`)}async function d(){const{portal:t}=i.c;return w(`${(0,s.g)()}portals/${t.id}/approvedApps`,{returnAllApps:!1})}async function g(t,e,n="results"){let r,s,i,o,a=1,l=[];e.start=a,e.num||(e.num=100);try{const u=await w(t,e);if(!(null==u?void 0:u[n]))return l;for(l=[...l,...u[n]],a=u.nextStart,r=u.total-l.length,s=Math.ceil(r/100),i=[],o=0;o<s;o++)e.start=a+100*o,i.push(w(t,e));try{return(await Promise.all(i)).forEach((t=>{l=[...l,...t[n]]})),l}catch(t){return l}}catch(t){return l}}async function p(){const{user:t}=i.c;return g(`${(0,s.g)()}community/users/${t.username}/provisionedListings`,{returnAppClientIds:!0,returnAllProvisions:!0},"provisionedListings")}async function v(){const t=`${(0,s.g)()}portals/self/subscriptionInfo`;try{const e=await w(t);return(null==e?void 0:e.orgCapabilities)||[]}catch(t){return[]}}async function f(t,e){if(e&&(null==t?void 0:t.length))return w(`${(0,s.g)()}search`,{num:100,q:`id:(${t.map((t=>`"${t.itemId}"`)).join(" OR ")})`})}const y='owner:"esri" AND title:"BlockedApps Config" AND type: "Application Configuration"';async function m(){var t,e;const n=`${(0,s.g)()}search`;try{const r=await w(n,{num:10,start:0,sortField:"title",sortOrder:"asc",q:y});if(!r)return[];const s=(null===(e=null===(t=r.results)||void 0===t?void 0:t[0])||void 0===e?void 0:e.id)||"",i=await l(s);return(null==i?void 0:i.blockedApps)||[]}catch(t){return[]}}async function h(){const t=`${(0,s.g)()}portals/self/servers`,e=await w(t);return(null==e?void 0:e.servers)||[]}async function b(){const t=`${(0,s.g)()}portals/self/signinSettings`;return await w(t)}async function w(t,e){e||(e={}),e.f="json";const n=(0,r.g)();n&&(e.token=n);const s=new URL(t);Object.keys(e).forEach((t=>s.searchParams.append(t,e[t])));const i=await fetch(s);return await i.json()}async function $(t){const{user:e}=i.c,n=function(t){let e=(0,s.g)();return"/"!==e.slice(-1)&&(e+="/"),`${e}${t}`}(`community/users/${e.username}/setProperties`),o=new FormData;return o.append("properties",JSON.stringify(t)),async function(t,e){e.append("f","json");const n=(0,r.g)();n&&e.append("token",n),fetch(t,{method:"POST",body:e})}(n,o)}},15059:(t,e,n)=>{n.d(e,{g:()=>r});const r=()=>[2,1,1,1,3].map((t=>{let e="";for(let n=0;n<t;n++)e+=(65536*(1+Math.random())|0).toString(16).substring(1);return e})).join("-")},58832:(t,e,n)=>{n.d(e,{H:()=>r});const r='-typekeywords:("MapAreaPackage") -type:("Map Area" OR "Indoors Map Configuration" OR "Code Attachment")'},16082:(t,e,n)=>{n.d(e,{M:()=>v,a:()=>q,b:()=>b,c:()=>C,d:()=>O,e:()=>A,f:()=>I,g:()=>m,h:()=>P,i:()=>$,q:()=>h});var r=n(67148),s=n(56086),i=n(79233),o=n(58832),a=n(66913),l=n(88703),u=n(70392),c=n(64307),d=n(76743),g=n(9657),p=n(12856);const v=175,f=["nonspatial","point","polygon","multipoint","polyline"];let y;function m(t,e,n){var r;const s={};null===(r=t.results)||void 0===r||r.forEach((t=>{t.tags.forEach((t=>{t&&(s[t]=(s[t]||0)+1)}))}));const i=Object.entries(s).sort(((t,e)=>e[1]-t[1])).map((([t])=>t));return(0,l.b)([...e||[],...i||[],...n||[]])}async function h({portal:t,query:e,user:n,contentUser:l,store:c,config:p,allowedSubscriptionContentTypes:m,groupId:h,showHiddenItems:b}){var j,A,q,I,P,C,F,_;let E=(0,u.g)(t),L={};const{num:M,start:R,sortOrder:T,sortField:D,filters:N,baseQuery:x,baseFilter:G,searchTerm:B,bucket:H,allowedGeometries:U}=e;if((null==y?void 0:y.signal)&&y.abort(),c.state.recycleBin)return y=new AbortController,"my"===H?S({query:e,portal:t,user:l||n}):k({query:e,portal:t});const W=h||"group"===H&&(null===(j=null==N?void 0:N.group)||void 0===j?void 0:j.id)&&"all"!==(null===(A=null==N?void 0:N.group)||void 0===A?void 0:A.group)&&(null===(q=null==N?void 0:N.group)||void 0===q?void 0:q.group)||"living atlas"===H&&(null!==(I=null==c?void 0:c.state.livingAtlasGroupId)&&void 0!==I?I:await async function(t,e){var n,r;const i=(null===(r=null===(n=(await(0,s.q)({q:t.livingAtlasGroupQuery,num:1,sortField:"title",sortOrder:"asc"},t)).results)||void 0===n?void 0:n[0])||void 0===r?void 0:r.id)||"";return e&&(e.state.livingAtlasGroupId=i),i}(t,c))||"living atlas analysis"===H&&(null!==(P=null==c?void 0:c.state.livingAtlasAnalysisGroupId)&&void 0!==P?P:await async function(t,e){var n,r;const i=(null===(r=null===(n=(await(0,s.q)({q:w(t),num:1,sortField:"title",sortOrder:"asc"},t)).results)||void 0===n?void 0:n[0])||void 0===r?void 0:r.id)||"";return e&&(e.state.livingAtlasAnalysisGroupId=i),i}(t,c));if("subscription content"===H)return async function(t,e,n){return(0,a.f)((async()=>{const s=await O(e,t);if(!(null==s?void 0:s.length))return{total:0,results:[],start:-1,num:100,nextStart:0};const i=null==s?void 0:s.map((t=>t.itemId)),o=await Promise.all(i.map((e=>(0,g.c)(e,t)))),a=await Promise.all(null==i?void 0:i.map((e=>async function(t,e){var n;return null!==(n=(await(0,r.g)(t,e,{relationshipType:"Listed2ImplicitlyListed",direction:"forward"})).relatedItems)&&void 0!==n?n:[]}(e,t)))),l=a.reduce(((t,e)=>t.concat(e)),o).filter((t=>function(t,e){return null!=e||(e=["Map Service","Image Service","Feature Service","Stream Service","Vector Tile Service","WMS","WFS","WMTS","KML","Feature Collection","Feed"]),e.includes(t.type)}(t,n)));return{total:l.length,results:l,start:l.length?1:0,num:100,nextStart:0}}),"subscriptionContent",`${t.id}-${e.username}`)}(t,n,m);await $(t,H)&&(E="https://www.arcgis.com/sharing/rest/",L.addTokenManually=!1);const z=W?`content/groups/${W}/`:"",J=`${E}${z}search`,Q=function(t,e){return!(null==t?void 0:t.length)||t.length===(null==f?void 0:f.length)||(null==e?void 0:e.isPortal)?"":`((-typekeywords:"Hosted Service") OR (typekeywords:"Hosted Service" AND geometrytype:(${t.map((t=>`"${t}"`)).join(" OR ")})))`}(U,t),V=Object.keys(N||{}),K=H?await async function({bucket:t,contentUser:e,user:n,portal:r,filters:s}){switch(t){case"my":return`owner: ${(e||n).username}`;case"org":return`orgid:${r.id} ${r.isPortal?"-owner:esri_apps":""}`;case"favorites":return`group: ${await(0,i.b)()}`;case"group":if(!(null==s?void 0:s.group)||"all"===(null==s?void 0:s.group.group)){const t=await(0,i.a)(n);return(null==t?void 0:t.length)>v?"":`group:(${null==t?void 0:t.map((({id:t})=>t)).join(" OR ")})`}default:return""}}({bucket:H,user:n,contentUser:l,portal:t,store:c,filters:N}):"",X=B&&(null===(C=(0,d.c)(B))||void 0===C?void 0:C.length)?`(${(0,d.c)(B)}) `:"",Y=!(!(null==p?void 0:p.semanticSearchEnabled)||!(null===(F=null==t?void 0:t.portalProperties)||void 0===F?void 0:F.semanticSearchEnabled))||n&&!n.orgId,Z=Object.assign(Object.assign(Object.assign({},G?{filter:`${G}`}:{}),Y?{enriched:!0}:{}),{q:`${x||""} ${Q} ${K} ${X} ${b?"":o.H}`,displaySublayers:!0,displayHighlights:!0}),tt=[],et=V.reduce(((t,e)=>{const{param:n,value:r,additionalParams:s}=N[e];if(H&&"group"===e&&"group"!==H||"group"===e&&z||"folder"===e&&"my"!==H||"region"===e&&!["living atlas","living atlas analysis"].includes(H))return t;"categories"===e&&r&&tt.push(N[e].category),"region"===e&&r&&tt.push(N[e].categoryValue);const i="categories"===n?{}:{[n]:`${t[n]||""} ${r}`};return Object.assign(Object.assign(Object.assign({},t),i),null!=s?s:{})}),Z),nt=Object.assign(Object.assign({num:M,start:R},"relevance"===D?{}:{sortField:D,sortOrder:T}),et||{}),rt=tt.length?tt.map((t=>`categories=${JSON.stringify([t])}`)).join("&"):"",st=tt.length?"?":"";try{const t=await(0,a.r)(`${J}${st}${rt}`,nt,L);return Object.assign(Object.assign({},t),{queryParams:nt})}catch(t){if(498===(null===(_=null==t?void 0:t.details)||void 0===_?void 0:_.httpStatus)&&"Invalid token."===(null==t?void 0:t.message)){const t=await(0,a.r)(`${J}${st}${rt}`,nt,Object.assign(Object.assign({},L),{addTokenManually:!1}));return Object.assign(Object.assign({},t),{queryParams:nt})}}}function b(t,e){if(!e.deepLayerSearchEnabled)return{};const n={};return(t.highlights||[]).forEach((e=>{var r;const s=null===(r=t.results)||void 0===r?void 0:r.find((t=>t.id===e.id));if(!(null==s?void 0:s.sublayers))return;const i=Object.keys(e).filter((t=>"id"!==t&&t.includes("sublayers."))).reduce(((t,n)=>{const r=function(t){const e=t.replace("sublayers.","");return{fieldaliases:"fieldAliases",title:"title"}[e]||e}(n);return t[r]=e[n].map((t=>t.replaceAll("<em>","").replaceAll("</em>",""))),t}),{}),o=s.sublayers.filter((t=>Object.keys(t).some((e=>{var n;return null===(n=i[e])||void 0===n?void 0:n.some((n=>t[e].includes(n)))})))).map((t=>t.id));n[e.id]=Object.assign(Object.assign({},e),{sublayers:o})})),n}function w(t){return'title:"Living Atlas Analysis Layers" AND owner:'+(!0===t.isPortal?"esri_livingatlas":"esri")}async function $(t,e){var n;if((null==t?void 0:t.isPortal)&&"all"===e){const e=await(0,c.e)(t);if(null===(n=null==e?void 0:e.portalConfigProperties)||void 0===n?void 0:n.searchArcGISOnlineEnabled)return!0}return!1}async function O(t,e){return t&&e?(0,a.f)((async()=>{const n=`${(0,u.g)(e)}community/users/${t.username}/provisionedListings`;return(0,c.j)(n,{},"provisionedListings")}),"provisionedListings",`${e.id}-${t.username}`):[]}async function j(t,e){return new Promise((async(n,r)=>{var s;null===(s=null==y?void 0:y.signal)||void 0===s||s.addEventListener("abort",(()=>{r(new DOMException("Aborted","AbortError"))}));const{start:i,num:o,sortField:l,sortOrder:u}=t,c=await(0,a.r)(e,{foldersContent:!0,inRecycleBin:!0,start:i,num:o,sortField:l,sortOrder:u});return n(Object.assign(Object.assign({},c),{results:c.items,queryParams:t}))}))}const A=async({portal:t,user:e,forOrg:n})=>{var r;const s={start:0,num:100,sortField:"size",sortOrder:"desc"},i=n?await k({portal:t,query:s}):await S({query:s,portal:t,user:e});return null===(r=null==i?void 0:i.results)||void 0===r?void 0:r.reduce(((t,e)=>t+e.size),0)};async function S({query:t,portal:e,user:n}){return j(t,`${(0,u.g)(e)}content/users/${n.username}/`)}async function k({query:t,portal:e}){return j(t,`${(0,u.g)(e)}content/portals/${e.id}/`)}async function q(t,e,n){if(!(null==e?void 0:e.length)||!(null==n?void 0:n.length)||e.length>100)return{result:{}};try{const r=await(0,a.r)(`${(0,u.g)(t)}content/itemsgroups`,{items:n.map((t=>t.id)).join(","),groups:e.map((t=>t.id)).join(",")}),s=Object.values(r).reduce(((t,e)=>{const{groupId:n,items:r}=e;return r.forEach((({itemId:e})=>{t[e]=[...t[e]||[],n]})),t}),{});return{result:s}}catch(t){return{result:{}}}}async function I(t,e){try{const n=`${(0,u.g)(t)}search`;return{result:(await(0,a.r)(n,{q:`id:(${e.join(" OR ")})`})).results}}catch(t){return{result:[]}}}async function P(t,e,n,r){var s;const i=await $(e,r.state.bucket),o=i?`https://www.arcgis.com/sharing/rest/content/items/${t.id}`:(0,p.g)(t.id,e),l=i||!n?{disableIdentityLookup:!0,addTokenManually:!1}:{};try{return{result:await(0,a.r)(o,{},l)}}catch(t){if("SB_0005"===(null===(s=null==t?void 0:t.details)||void 0===s?void 0:s.messageCode))return{error:{code:"disabledSubscription"}}}return{error:{code:"unhandledError"}}}function C({bucket:t,oldBucket:e,filters:n,switchingBucket:r,keepSpecialFilters:s}){const i=Object.assign({},n);if("my"===t||s||delete i.folder,"group"===t||s||delete i.group,r){const n=["group","living atlas","living atlas analysis","subscription content"];(n.includes(t)||n.includes(e))&&delete i.categories,"living atlas"===t?(delete i.modified,delete i.created,delete i.sharing,delete i.collaborations):delete i.region}return i}},76743:(t,e,n)=>{n.d(e,{c:()=>s});var r=n(63280);function s(t=""){return(0,r.s)(t).replace(/[<>\/\\[\]\?]/g,"\\$&").trim()}}}]);
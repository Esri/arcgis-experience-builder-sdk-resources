/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-f2d6be"],{44315:(t,e,a)=>{a.r(e),a.d(e,{arcgis_categorize_items:()=>d});var r=a(35110),o=a(76338),s=a(67148),i=a(26077),n=a(88703),c=a(1984),l=a(870);a(66913),a(46710),a(23505),a(21104),a(73838),a(70392),a(75858),a(91659),a(56086),a(63280),a(86587);const d=class{constructor(t){(0,r.r)(this,t),this.arcgisCategorizeItemsCancel=(0,r.c)(this,"arcgisCategorizeItemsCancel",7),this.arcgisCategorizeItemsSubmit=(0,r.c)(this,"arcgisCategorizeItemsSubmit",7),this.closeDialog=()=>{this.arcgisCategorizeItemsCancel.emit()},this.handleCategorySelected=({paths:t,selected:e})=>{const{itemIds:a,itemToCategoriesLookup:r}=this,o=Object.assign({},this.categorySelectionCountMap);if(t.forEach((t=>{o[t]=e?[...a]:[]})),a.forEach((a=>{r[a]||(r[a]=[]);const o=r[a];r[a]=e?[...o,...t]:o.filter((e=>!t.includes(e)))})),e){const e=t.reduce(((t,e)=>{let a="";return e.split("/").filter(Boolean).forEach((r=>{a=`${a}/${r}`,a!==e&&t.push(a)})),t}),[]);e.forEach((t=>{o[t]=[]})),a.forEach((t=>{const a=r[t];r[t]=a.filter((t=>!e.includes(t)))}))}this.categorySelectionCountMap=o},this.handleItemCategoryChange=(t,e)=>{var a;const{itemToCategoriesLookup:r,categorySelectionCountMap:o,rootCategoryPath:s}=this,i=null!==(a=r[t])&&void 0!==a?a:[],c=e.map((t=>t.startsWith(s)?t:`${s}${t}`));(0,n.f)(i,c)||(i.forEach((e=>{const a=o[e];o[e]=(null!=a?a:[]).filter((e=>e!==t))})),c.forEach((e=>{const a=o[e];o[e]=[...null!=a?a:[],t]})),r[t]=[...c],this.categorySelectionCountMap=Object.assign({},o))},this.updateCategory=async()=>{const{itemIds:t,portal:e,itemToCategoriesLookup:a,i18n:r}=this;this.isLoading=!0;const{result:s,error:i}=await(0,o.u)({categories:a,itemIds:t,portal:e});if(this.isLoading=!1,s&&!i)return this.arcgisCategorizeItemsSubmit.emit(a),void(this.hasUnsavedChanges=!1);this.error=r.errorMessage},this.checkHasChange=()=>{const{itemIds:t,itemToCategoriesLookup:e,initialItemToCategoriesLookup:a}=this;this.hasUnsavedChanges=!!e&&!!a&&t.some((t=>!(0,n.f)(e[t],a[t])))},this.renderItemCard=t=>{const{portal:e,user:a,config:o,itemToCategoriesLookup:s,handleItemCategoryChange:i,categorySchema:n,rootCategoryPath:c}=this,l=s[t.id];return(0,r.h)("arcgis-item-browser-card",{key:t.id,item:t,portal:e,user:a,baseUrl:o.baseUrl,showItemType:!0},(0,r.h)("div",{slot:"content-end",class:"category-picker-container"},(0,r.h)("arcgis-categories-picker",{portal:e,categories:l,schema:n,rootCategoryPath:c,onArcgisCategoriesPickerChange:({detail:e})=>i(t.id,e),hideLabel:!0})))},this.isActive=void 0,this.items=void 0,this.user=void 0,this.portal=void 0,this.config=void 0,this.categorySchema=void 0,this.isLoading=!1,this.categorySelectionCountMap=void 0,this.itemToCategoriesLookup={},this.error=void 0,this.hasUnsavedChanges=!1,this.rootCategoryPath=void 0}async componentWillLoad(){const t=await(0,c.g)(this.el);this.i18n=t[0]}async componentDidLoad(){const{portal:t,user:e}=this;this.isLoading=!0;const a=this.items.map((t=>t.id)),{result:r,error:n}=await(0,s.b)(a,this.portal);this.items=r&&!n?r:this.items,this.updateInternalData(this.items);const{result:c,error:l}=await(0,o.g)({portal:t,user:e});!l&&c&&(this.categorySchema=c[0].categories,this.rootCategoryPath=(0,i.g)(c)),this.isLoading=!1}async updateInternalData(t){this.itemIds=t.map((t=>t.id)),this.isLoading=!0;const{result:e,error:a}=await(0,s.b)(this.itemIds,this.portal);this.isLoading=!1;const r=e&&!a?e:t;this.itemToCategoriesLookup=r.reduce(((t,e)=>(t[e.id]=e.categories,t)),{}),this.categorySelectionCountMap=(t=>{const e={};return t.forEach((({categories:t,id:a})=>{t.forEach((t=>{e[t]||(e[t]=[]),e[t].push(a)}))})),e})(r),this.initialItemToCategoriesLookup=structuredClone(this.itemToCategoriesLookup)}handleIsActiveChange(){this.isActive&&this.updateInternalData(this.items)}handleCountMapChange(){this.checkHasChange()}render(){const{items:t,categorySchema:e,categorySelectionCountMap:a,updateCategory:o,isLoading:s,i18n:i,closeDialog:n,isActive:c,renderItemCard:d,handleCategorySelected:h,error:u,hasUnsavedChanges:g,rootCategoryPath:p}=this,m=t.length;return(0,r.h)("calcite-modal",{open:c,onCalciteModalClose:n,scale:"m",class:"modal"},s&&(0,r.h)("calcite-scrim",{loading:!0},i.loadingText),(0,r.h)("div",{slot:"header"},i.modalTitle),(0,r.h)("div",{slot:"content",class:"stage"},(0,r.h)("calcite-alert",{icon:!0,open:!!u,label:u,kind:"danger",onCalciteAlertClose:()=>this.error=null},(0,r.h)("div",{slot:"message"},u)),(0,r.h)("arcgis-item-browser",{fetch:async()=>({nextStart:0,num:m,results:t,start:1,total:m}),portal:this.portal,user:this.user,config:this.config,hideContentTop:!0,contentPaddedBottom:!0,hidePreviewFooters:!0,view:"list",selection:"none",num:l.a},(0,r.h)("arcgis-category-tree",{slot:"filters",rootCategoryPath:p,categorySchema:e,categorySelectionCountMap:null!=a?a:{},total:m,onArcgisCategorizeCategorySelected:({detail:t})=>h(t)}),(0,r.h)("arcgis-item-browser-content",{slot:"content"},t.map((t=>d(t)))))),(0,r.h)("calcite-button",{slot:"secondary",appearance:"outline","data-id":"cancelButton",onClick:n,width:"full"},i.cancel),(0,r.h)("calcite-button",{slot:"primary",appearance:"solid","data-id":"nextButton",onClick:o,width:"full",disabled:!g},i.save))}get el(){return(0,r.d)(this)}static get watchers(){return{items:["updateInternalData"],isActive:["handleIsActiveChange"],categorySelectionCountMap:["handleCountMapChange"]}}};d.style=".stage{height:100%;overflow:hidden;--tw-translate-x:0px;transform:translate(var(--tw-translate-x), var(--tw-translate-y)) rotate(var(--tw-rotate)) skewX(var(--tw-skew-x)) skewY(var(--tw-skew-y)) scaleX(var(--tw-scale-x)) scaleY(var(--tw-scale-y));background-color:var(--calcite-color-background)}@media screen and (min-width: 1080px){.stage{height:min(700px, 60vh)}}.modal{--calcite-modal-content-padding:0;--calcite-modal-width:1080px;z-index:900}.category-picker-container{margin-top:0.5rem}"},26077:(t,e,a)=>{a.d(e,{U:()=>r,a:()=>i,b:()=>o,g:()=>s});const r="/Categories",o=(t,e,a=!0)=>{const r=null!=t?t:"";return`${r}${r.endsWith("/")?"":"/"}${a?e.title.toLocaleLowerCase():e.title}`};function s(t){var e;let a=null===(e=null==t?void 0:t[0])||void 0===e?void 0:e.title;return a&&"/"!==a.charAt(0)&&(a=`/${a}`),a||r}const i=(t,e)=>`${t.replace(/\/([^\/]+)$/,`/${e}`)}`},76338:(t,e,a)=>{a.d(e,{a:()=>u,b:()=>h,c:()=>p,f:()=>d,g:()=>l,u:()=>g});var r=a(66913),o=a(26077),s=a(46710),i=a(75858),n=a(91659),c=a(70392);const l=async({portal:t,user:e,group:a,useCache:r=!1})=>{var o;try{const s=await(a?h(a.id,t,r):d(t,e,r));return{result:null!==(o=null==s?void 0:s.categorySchema)&&void 0!==o?o:null}}catch(t){return console.error(t),{error:{code:"unhandledError"}}}};async function d(t,e,a=!0){if(null!=t||(t=s.c.portal),null!=e||(e=s.c.user),!(null==t?void 0:t.id)||e&&(0,n.d)(e))return null;const o=()=>(0,r.r)(`${(0,c.g)(t)}portals/${t.id}/categorySchema`);return a?(0,r.f)(o,"categorySchema",t.id):o()}async function h(t,e,a=!0){if(null!=e||(e=null===s.c||void 0===s.c?void 0:s.c.portal),!t||!e)return null;const o=()=>(0,r.r)(`${(0,i.g)(e,{id:t})}categorySchema`);return a?(0,r.f)(o,"categorySchema",t):o()}async function u(t,e,a=!0){const o=()=>async function(t,e){var a;const o=(0,c.g)(t),s=await(0,r.r)(`${o}portals/self`),n=await(0,r.r)(`${o}community/groups?q=${s.contentCategorySetsGroupQuery}`),l=null===(a=null==n?void 0:n.results)||void 0===a?void 0:a[0],d=(await(0,r.r)((0,i.a)(t,l),{q:`typekeywords: ${e}`})).results[0];return(0,r.r)(`${o}content/items/${d.id}/data`)}(t,e);return a?(0,r.f)(o,"categorySchema",e):o()}async function g({categories:t,itemIds:e,portal:a}){try{const o=`${(0,c.g)(a)}/content/updateItems`,s=JSON.stringify(e.map((e=>({[e]:{categories:Array.isArray(t)?t:t[e]}}))));return{result:await(0,r.r)(o,{items:s},{},"post")}}catch(t){return console.error(t),{error:{code:"unhandledError"}}}}const p=async({path:t,portal:e,group:a,updateInfo:r})=>{try{const s=(await m({category:t,portal:e,group:a,num:1})).total;if(0===s)return console.warn(`No items found with category ${t} when updating schema`),{};const i=100,n=Math.ceil(s/i),c=[];for(let s=0;s<n;s++)c.push(m({category:t,portal:e,group:a,start:s*i,num:i}).then((({results:e})=>{const a={};return e.forEach((e=>{const s="change-title"===r.type?e.categories.map((e=>{const a=(0,o.a)(t,r.newTitle);return e===t?a:e.replace(`${t}/`,`${a}/`)})):e.categories.filter((e=>!e.startsWith(t)));a[e.id]=s})),a})));const l=await Promise.all(c);return await Promise.all(l.map((t=>g({categories:t,itemIds:Object.keys(t),portal:e})))),{}}catch(e){return console.error(`Error ${r.type} items schema from path ${t}:`,e),{error:{code:"unhandledError"}}}},m=({category:t,num:e=100,start:a=0,portal:o,group:s})=>{const n={start:a,num:e,categories:JSON.stringify([t])},l=s?(0,i.a)(o,s):`${(0,c.g)(o)}search`;return(0,r.r)(l,Object.assign(Object.assign({},n),{q:s?void 0:`orgid: ${o.id}`}))}},75858:(t,e,a)=>{a.d(e,{a:()=>s,g:()=>o});var r=a(70392);const o=(t,e)=>(0,r.a)(`${(0,r.g)(t)}community/groups/${e.id}`),s=(t,e)=>`${((t,e)=>(0,r.a)(`${(0,r.g)(t)}content/groups/${e.id}`))(t,e)}search`},67148:(t,e,a)=>{a.d(e,{a:()=>n,b:()=>l,g:()=>c,r:()=>i});var r=a(66913),o=a(70392),s=a(46710);const i=async(t,e,a={})=>{const{body:o,usePost:i,addTokenManually:n,api:c=(null===s.c||void 0===s.c?void 0:s.c.api),customToken:l}=a,d=new URLSearchParams;o&&Object.entries(o).forEach((([t,e])=>{void 0!==e&&d.append(t,e)}));const h=new URL(t);if(h.searchParams.append("f","json"),l)h.searchParams.append("token",l);else{const t=!1===n?null:await(0,r.b)(e,c);t&&h.searchParams.append("token",t)}const u=await fetch(h.toString(),{body:i?d:void 0,method:i?"POST":"GET"}),g=await u.json(),p=g.error;if(p)throw"string"==typeof p?new Error(p):p;return g},n=async(t,e)=>{var a;try{return{result:await i(t,e,{addTokenManually:!1})}}catch(t){const e="token required";return(null===(a=null==t?void 0:t.message)||void 0===a?void 0:a.toLowerCase().includes(e))?{error:{code:"tokenRequired"}}:(console.error(t),{error:{code:"unhandledError"}})}};async function c(t,e,{relationshipType:a,direction:s}){const i=`${(0,o.g)(e)}content/items/${t}/relatedItems`;return await(0,r.r)(i,{relationshipType:a,direction:s})}const l=async(t,e)=>{try{return{result:(await(0,r.r)(`${(0,o.g)(e)}/search`,{filter:`id:(${t.join(" OR ")})`,num:100})).results}}catch(t){return console.error(t),{error:{code:"unhandledError"}}}}},870:(t,e,a)=>{a.d(e,{I:()=>r,a:()=>o});const r=["folder","group","contentType"],o=99999}}]);
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_-11958c"],{84440:(e,t,i)=>{i.r(t),i.d(t,{rfx_color_picker:()=>u,rfx_dte_raster_input:()=>p,rfx_dtex_field_select:()=>f,rfx_grid:()=>m});var r=i(14947),a=i(95323),s=(i(34319),i(90949)),l=(i(46574),i(46717),i(55139),i(57098),i(74656),i(91123),i(78979),i(46869),i(83345),i(99248),i(16888),i(43278),i(86944),i(59498)),o=i(92123),n=i(95166),c=i(826),h=i(70049),d=i(27703);i(25829),i(22760),i(86578);const u=class{constructor(e){(0,r.r)(this,e),this.rfxColorPickerValueChange=(0,r.c)(this,"rfxColorPickerValueChange",7),this.onColorSwatchClick=e=>{const t=e.target.value;this.popoverElememt.open=!1,this.value=new a.default(t).toRgba(),this.rfxColorPickerValueChange.emit({value:this.value})},this.value=[0,0,0,255]}render(){const e=new a.default(this.value).toHex();return(0,r.h)("div",null,(0,r.h)("calcite-color-picker-swatch",{active:!1,color:e,id:"color-picker-swatch",scale:s.U.Scale,ref:e=>{}}),(0,r.h)("calcite-popover",{autoClose:!0,pointerDisabled:!0,referenceElement:"color-picker-swatch",placement:"auto",scale:s.U.Scale,label:"color-picker-popover",ref:e=>{this.popoverElememt=e}},(0,r.h)("calcite-color-picker",{scale:s.U.Scale,value:e,format:"auto",onCalciteColorPickerInput:this.onColorSwatchClick})))}get hostElement(){return(0,r.a)(this)}},g="rfx-dte-raster-input__layer-load-fail",p=class{constructor(e){(0,r.r)(this,e),this.rfxArgumentChange=(0,r.c)(this,"rfxArgumentChange",7),this.scalarValues=[],this.loaded=!1,this.layerLoadFailed=!1,this.inputLayers=void 0,this.value=void 0,this.allowScalar=!1,this.overlayPositioning=s.a.absolute,this.maxItems=5,this.rfxVariable=void 0,this.mode=void 0,this.rfxBrowseLayerClick=void 0}onRFxVariableChange(e){e.value?this.value=e.value:this.argRFT=(0,n.d)(e)}async connectedCallback(){return await this.load(),this.loaded=!0,Promise.resolve()}async componentWillLoad(){({strings:this.strings}=await(0,l.b)(this.hostElement,(0,r.g)(".")))}async getSelectedLayer(){return!1===this.loaded&&await this.load(),void 0!==this.value&&"object"==typeof this.value?this._getSelectedLayer(this.value):Promise.resolve(void 0)}async updateBrowsedLayer(e){return e.forEach((e=>{0===this.inputLayers.filter((t=>e.url===t.url)).length&&this.inputLayers.push(e),this.value=(0,h.d)(e),this.rfxArgumentChange.emit({value:this.value})})),Promise.resolve(void 0)}async load(){(0,o.m)(this.rfxVariable)||this.onRFxVariableChange(this.rfxVariable),(0,o.m)(this.value)||await this.processValueLayer()}async processValueLayer(){if("scalar"===this.value.type?.toLowerCase())return void this.scalarValues.push(this.value);const e=this.value?.url;if((0,o.m)(e))return;const t=(0,h.e)(this.value,this.inputLayers);if((0,o.m)(t)){const e=await(0,h.f)(this.value);if(void 0===e)return void(this.layerLoadFailed=!0);this.inputLayers=[...this.inputLayers,e]}const i=await this._getSelectedLayer(this.value);void 0!==i&&(this.value=(0,h.d)(i),this.rfxArgumentChange.emit({value:this.value,inputLayers:this.inputLayers})),this.inputLayers=(0,d.a)(this.inputLayers,["title","url"])}async _handleComboBoxChange(e){this.layerLoadFailed=!1;const t=e.target.value;if((0,o.m)(t))this.value=void 0;else{if("browse"===t)return this.value=void 0,void this.rfxBrowseLayerClick({referenceElement:this.hostElement});if(-1!==t.indexOf("&layerName")){const e=await this._getSelectedLayer(this.getLayerNameAndUrlFromValue(t));void 0!==e&&(this.value=(0,h.d)(e))}else 1==this.allowScalar&&(this.value={type:"Scalar",value:t})}this.rfxArgumentChange.emit({value:this.value})}getLayerNameAndUrlFromValue(e){const t=e.split("&layerName=")[0];return{name:e.split("&layerName=")[1],url:t}}async _getSelectedLayer(e){const t=(0,h.g)(e.url);let i;if(void 0!==e.url&&void 0!==e.name&&(i=this.inputLayers.find((i=>i.url===t&&i.title===e.name))),i&&(await i.load(),(0,o.k)(i)))try{i.rasterInfo=await i.generateRasterInfo(i.rasterFunction)}catch(e){console.error(e)}return i}getFormattedValueFromVariable(){if(!(0,o.m)(this.argRFT)){const e=this.argRFT.function?.name;return`<${e}.${this.strings.outputRaster}>`}return this.mode===c.a.ANALYSIS?this.getDefaultPlaceHolder():`<${this.strings.rfxVariable}: ${this.rfxVariable.name}>`}getDefaultPlaceHolder(){return this.allowScalar?this.strings.allowScalar:this.strings.selectLayer}getPlaceHolderText(){return(0,o.m)(this.rfxVariable)?this.getDefaultPlaceHolder():this.getFormattedValueFromVariable()}getValueString(e){return`${e.url}&layerName=${e.title??e.name}`}renderInputOptions(e){let t=[];return this.inputLayers&&Array.isArray(this.inputLayers)&&(t=this.inputLayers.map(((t,i)=>{const a=this.getValueString(t);if(void 0!==t?.url)return(0,r.h)("calcite-combobox-item",{key:`layer-item-${i}`,value:a,selected:a===e,textLabel:t.title,icon:"imagery"===t.type?"image-layer":"tiled-imagery-layer",scale:s.U.Scale})}))),0!==this.scalarValues?.length&&this.scalarValues.forEach((e=>{t.push((0,r.h)("calcite-combobox-item",{key:`layer-item-${this.inputLayers.length+1}`,value:e.value,textLabel:e.value,selected:!0,scale:s.U.Scale}))})),t}render(){const e=(0,h.g)(this.value?.url),t=(0,o.m)(this.value)?this.value:"Scalar"===this.value?.type?this.value.value:this.getValueString({url:e,name:this.value?.name});return(0,r.h)("div",{class:"esriRFxRasterInput"},(0,r.h)("calcite-combobox",{label:"rfx-dte-raster-input-combobox",placeholder:this.getPlaceHolderText(),selectionMode:"single",scale:s.U.Scale,disabled:void 0!==this.argRFT,allowCustomValues:this.allowScalar,value:t,onCalciteComboboxChange:e=>this._handleComboBoxChange(e),overlayPositioning:this.mode===c.a.EDITOR?s.a.fixed:this.overlayPositioning,clearDisabled:!0,maxItems:this.mode===c.a.EDITOR?this.maxItems:0},(0,r.h)(r.F,null,(0,r.h)("calcite-combobox-item",{class:"browse-layer",key:"layer-item-browse",value:"browse",textLabel:this.strings.browseLayer,scale:s.U.Scale,icon:"search",filterDisabled:!0}),...this.renderInputOptions(t))),(0,r.h)("calcite-input-message",{class:g,status:"invalid",scale:s.U.Scale,hidden:!1===this.layerLoadFailed,icon:"exclamationMarkTriangle"},this.strings.layerFailedToLoad))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.a)(this)}static get watchers(){return{rfxVariable:["onRFxVariableChange"]}}};p.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-dte-raster-input__browse-layer{--calcite-ui-text-1:var(--calcite-color-text-link);--calcite-ui-text-3:var(--calcite-color-text-link)}.rfx-dte-raster-input__layer-load-fail{margin-top:0.5rem;color:var(--calcite-color-status-danger)}";const f=class{constructor(e){(0,r.r)(this,e),this.rfxArgumentChange=(0,r.c)(this,"rfxArgumentChange",7),this.rfxFieldOptionsLoaded=(0,r.c)(this,"rfxFieldOptionsLoaded",7),this.handleFieldSelectChange=e=>{const t=e.target;this.value=t.value,this.rfxArgumentChange.emit({value:this.value})},this.layerArg=void 0,this.rasterInputVariable=void 0,this.otherOptions=void 0,this.value=void 0,this.options=void 0,this.fieldType=void 0,this.isInGrid=!1,this.inputLayers=void 0,this.showDefaultFields=!0}onrasterInputVariableChange(){this.processLayerArg()}async componentWillLoad(){({strings:this.strings}=await(0,l.b)(this.hostElement,(0,r.g)("."))),await this.processLayerArg(),this.processDefaultValue()}render(){return(0,r.h)("div",null,(0,r.h)("rfx-dtex-common-select",{isInGrid:this.isInGrid,options:this.options,value:this.value,placeHolderText:this.strings.selectField,onRfxArgumentChange:this.handleFieldSelectChange}))}async getSelectedRasterLayer(e){e=(0,h.g)(e);const t=this.inputLayers.find((t=>t.url===e));if(t&&(await t.load(),(0,o.k)(t)))try{t.rasterInfo=await t.generateRasterInfo(t.rasterFunction)}catch(e){console.error(e)}return t}async processLayerArg(){if((0,o.m)(this.rasterInputVariable))if((0,o.m)(this.layerArg))this.setDefaultFieldOptions();else{const e=this.layerArg.input;e?(await this.updateFields(),e.addEventListener("rfxArgumentChange",(async()=>{await this.updateFields()}))):this.setDefaultFieldOptions()}else await this.updateFields();this.rfxFieldOptionsLoaded.emit()}async updateFields(){let e;if((0,o.m)(this.rasterInputVariable?.value)){if(!(0,o.m)(this.layerArg)){const t=this.layerArg.input;e="function"==typeof t.getSelectedLayer?await t.getSelectedLayer():void 0}}else e=await this.getSelectedRasterLayer(this.rasterInputVariable?.value?.url);if(e){if((0,o.g)(e))this.options=this.convertFieldsToOptions(e.fields),this.otherOptions&&this.addOtherOptions();else if((0,o.k)(e)||(0,o.l)(e))if(e.sourceJSON?.hasRasterAttributeTable){const t=(0,o.k)(e)?e.serviceRasterInfo.attributeTable:e.rasterInfo.attributeTable;(0,o.m)(t?.fields)?this.setDefaultFieldOptions():this.setFieldOptions(t.fields)}else this.setDefaultFieldOptions()}else this.setDefaultFieldOptions();this.processDefaultValue()}addOtherOptions(){const e=[],t=this.options,i=this.otherOptions;Object.keys(i).forEach((function(t){const r={key:t,label:i[t]};e.push(r)})),t&&t.length>0?(e.forEach((function(e){t.some((function(t){if(t.key===e.key)return!0}))||t.push(e)})),this.options=t):this.options=e}setFieldOptions(e){const t=["esriFieldTypeString"],i=["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"].concat(t),r=this.fieldType;if(e?.length>0){const a=(e=JSON.parse(JSON.stringify(e))).filter((e=>"list"===r?t.indexOf(e.type)>-1:i.indexOf(e.type)>-1));this.options=this.convertFieldsToOptions(a)}else this.setDefaultFieldOptions()}setDefaultFieldOptions(){!0===this.showDefaultFields&&(this.options=this.isInGrid?[{key:"VALUE",label:this.strings.value}]:[{key:"VALUE",label:this.strings.value},{key:"COUNT",label:this.strings.count}])}convertFieldsToOptions(e){const t=[];return e.map((e=>{t.push({key:e.name,label:e.alias})})),t}processDefaultValue(){(0,o.m)(this.options)||this.options?.length<1||(void 0!==this.value&&null!==this.value||(this.value=this.options[0].key),this.isInGrid||this.options.some((e=>e.key===this.value))||(this.value=this.options[0].key),(0,o.m)(this.rasterInputVariable)&&(0,o.m)(this.layerArg)||this.rfxArgumentChange.emit({value:this.value}))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.a)(this)}static get watchers(){return{rasterInputVariable:["onrasterInputVariableChange"]}}},m=class{constructor(e){(0,r.r)(this,e),this.rfxGridOptionChange=(0,r.c)(this,"rfxGridOptionChange",7),this.rfxGridRowClick=(0,r.c)(this,"rfxGridRowClick",7),this.gridValueChange=e=>{e.stopImmediatePropagation();const t=e.type,i=e.target;let r,a,s;switch(t){case"calciteCheckboxChange":case"calciteSwitchChange":r=i.checked;break;default:r=i.value}if(i?.tagName===c.A.RFX_DTE_RASTER_INPUT&&r?.hasOwnProperty("url")){const e=(0,h.a)();e.value=(0,h.c)(r),a=e,s=i?.inputLayers,(0,o.m)(s)||(this.inputLayers=s)}const[l,n]=i.id.split("-");let d;this.gridOptions=this.gridOptions.map(((e,t)=>(e.id===Number.parseInt(n,10)&&(i.id.indexOf(l)>-1&&(this.gridLayout[l].uiType===c.G.select?e[l].value=a??r:e[l]=a??r),d=t),e))),this.canAdd&&this.addRow(),this.rfxGridOptionChange.emit({gridOptions:this.gridOptions,rowIndex:d})},this.onRemoveClick=e=>{const t=e.target.id.split("-")[1],i=this.gridOptions.findIndex((e=>e.id===Number.parseInt(t,10)));this.gridOptions=this.gridOptions.filter((e=>e.id!==Number.parseInt(t,10))),this.rfxGridOptionChange.emit({gridOptions:this.gridOptions,rowIndex:i}),0===this.gridOptions.length&&(this.gridOptions=[{id:this.gridOptions.length}])},this.onGridRowClick=e=>{e.stopPropagation();const t=e.currentTarget.id.split("_")[2],i=this.gridOptions.findIndex((e=>e.id===Number.parseInt(t,10)));this.rfxGridRowClick.emit({gridOptions:this.gridOptions,rowIndex:i})},this.gridOptions=[],this.inputLayers=void 0,this.canAdd=!0,this.canRemove=!0,this.hasHeader=!0,this.isStacked=!1,this.gridLayout=void 0,this.hasIdColumn=!0,this.hasBorder=!1,this.rfxBrowseLayerClick=void 0}async componentWillLoad(){({strings:this.strings}=await(0,l.b)(this.hostElement,(0,r.g)(".")))}adjustValueListItemIds(){this.gridOptions.forEach(((e,t)=>{e.id=t}))}isLastRowEmpty(e){return!Object.keys(this.gridLayout).some((t=>{const i=this.gridLayout[t].uiType===c.G.select?e[t].value:e[t];return!(0,o.m)(i)}))}addRow(){const e=this.gridOptions[this.gridOptions.length-1];if(this.isLastRowEmpty(e))return;this.adjustValueListItemIds();const t={id:this.gridOptions.length};for(const e in this.gridLayout)if(this.gridLayout.hasOwnProperty(e)){const i=this.gridLayout[e].uiType===c.G.select,r=this.gridOptions[0][e];i&&(t[e]={...r,value:void 0})}this.gridOptions.push(t)}renderGridRow(e,t){const i=Number.parseInt(t,10)+1,a=Object.keys(this.gridLayout).map((t=>{const i=this.gridLayout[t];switch(i.uiType){case c.G.textInput:return(0,r.h)("td",null,(0,r.h)("calcite-input-text",{class:i.style,scale:s.U.Scale,key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],onCalciteInputTextChange:this.gridValueChange,title:e[t]}));case c.G.text:return(0,r.h)("td",{key:`${t}_${e.id}`},i.constValue||e[t]);case c.G.raster:return(0,r.h)("td",null,(0,r.h)("rfx-dte-raster-input",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,inputLayers:this.inputLayers,allowScalar:i.allowScalar,rfxVariable:e.rasterElement,value:e[t]?.value,overlayPositioning:s.a.fixed,onRfxArgumentChange:this.gridValueChange,rfxBrowseLayerClick:this.rfxBrowseLayerClick}));case c.G.number:return(0,r.h)("td",null,(0,r.h)("calcite-input-number",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],onCalciteInputNumberChange:this.gridValueChange,scale:s.U.Scale,numberButtonType:"none",title:e[t]}));case c.G.boolean:return(0,r.h)("td",null,(0,r.h)("calcite-checkbox",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,checked:e[t],onCalciteCheckboxChange:this.gridValueChange}));case c.G.switch:return(0,r.h)("td",null,(0,r.h)("calcite-switch",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,checked:e[t],onCalciteSwitchChange:this.gridValueChange}));case c.G.field:return(0,r.h)("td",null,(0,r.h)("rfx-dtex-field-select",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,inputLayers:this.inputLayers,isInGrid:!0,rasterInputVariable:e.layer,value:e[t],onRfxArgumentChange:this.gridValueChange}));case c.G.color:return(0,r.h)("td",null,(0,r.h)("rfx-color-picker",{key:`${t}-${e.id}`,id:`${t}-${e.id}`,value:e[t],onRfxColorPickerValueChange:this.gridValueChange}));case c.G.select:return(0,r.h)("td",null,(0,r.h)("rfx-dtex-common-select",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,options:e[t].options,value:e[t].value,allowCustomValues:i.allowCustomValues,isInGrid:!0,onRfxArgumentChange:this.gridValueChange}));case c.G.icon:return(0,r.h)("td",null,e[t]?(0,r.h)("calcite-icon",{class:i.style,key:`${t}-${e.id}`,id:`${t}-${e.id}`,icon:i.icon,scale:s.C.s,textLabel:i.label}):null)}}));return!0===this.hasIdColumn&&a.unshift((0,r.h)("td",null,(0,r.h)("div",{key:`idColumn_${e.id}`},i))),!0===this.canRemove&&a.push((0,r.h)("td",null,(0,r.h)("calcite-icon",{id:`remove-${e.id}`,key:`remove-${e.id}`,scale:s.U.Scale,icon:"x",onClick:i===this.gridOptions.length?void 0:this.onRemoveClick}))),a}renderHeader(){return(0,r.h)("thead",null,(0,r.h)("tr",null,!0===this.hasIdColumn&&(0,r.h)("th",null,this.strings.id),Object.keys(this.gridLayout).map((e=>{const t=this.gridLayout[e];return(0,r.h)("th",{class:`${t.style}`},t.label)})),!0===this.canRemove&&(0,r.h)("th",null," ")))}renderGridOptions(){return this.gridOptions.map(((e,t)=>(0,r.h)("tr",{id:`grid_row_${e.id}`,key:`grid_row_${e.id}`,onClick:t===this.gridOptions.length-1?void 0:this.onGridRowClick},this.renderGridRow(e,t))))}render(){return(0,r.h)(r.H,null,(0,r.h)("table",{class:`rfx-grid__grid-container ${this.hasBorder?"border":""} ${this.isStacked?"stacked":""}`},this.hasHeader&&this.renderHeader(),(0,r.h)("tbody",null,...this.renderGridOptions())))}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.a)(this)}};m.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.rfx-grid__grid-container{width:100%;border-collapse:collapse}.rfx-grid__grid-container div{box-sizing:border-box}.rfx-grid__grid-container body{width:100%;height:100%;margin:0;padding:0}.rfx-grid__grid-container td{padding:0.5em;text-align:center}.rfx-grid__grid-container th{background:var(--calcite-color-foreground-2);padding:0.5em;border:1px solid var(--calcite-color-foreground-3);text-align:center;font-weight:normal}.rfx-grid__grid-container.border td{border:1px solid var(--calcite-color-foreground-3)}.rfx-grid__grid-container.stacked td,.rfx-grid__grid-container.stacked th{text-align:inherit;display:block;width:auto}"}}]);
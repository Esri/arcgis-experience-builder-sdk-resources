/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-image-i-1fa07f.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-image-i-1fa07f"],{85524:(e,t,i)=>{i.r(t),i.d(t,{arcgis_image_item_filters_popover:()=>o});var l=i(35110),s=i(1984),n=i(86587),r=i(21104),a=i(68132);i(63280),i(73838);const o=class{constructor(e){(0,l.r)(this,e),this.arcgisImageItemFiltersPopoverClosed=(0,l.c)(this,"arcgisImageItemFiltersPopoverClosed",7),this.arcgisImageItemFilterApplied=(0,l.c)(this,"arcgisImageItemFilterApplied",7),this.handleImageItemQueryApplied=()=>{const{view:e,activeQueryField:t,isOverviewsIncluded:i,isRangeValueModeSelected:l,selectedAOI:s,selectedQueryFieldValues:n}=this;let r=[];r=(0,a.q)(t.type)||"date"===t.type?l?n:[n[1]]:n;const o=(0,a.g)(e),c={selectedAOI:s,queryField:t,queryValues:r,isIncludeOverviews:i,displayExtent:s===a.A.DisplayExtent?o:null};this.arcgisImageItemFilterApplied.emit(c)},this.getLayerAttributeValues=async e=>{var t,i;const{layer:l,view:s,selectedAOI:n,fetchAbortController:r}=this;r&&r.abort();try{this.fetchAbortController=new AbortController,this.isQueryingFieldValues=!0,this.fieldValuesForInput=[],this.selectedQueryFieldValues=[];const r=(0,a.g)(s);if((0,a.m)(e)||!(0,a.q)(e.type)&&"date"!==e.type){const t=await(0,a.t)(l,e,n===a.A.DisplayExtent?r:null,null===(i=this.fetchAbortController)||void 0===i?void 0:i.signal);this.fieldValuesForInput=t,this.selectedQueryFieldValues=t.length>0?[t[0]]:[]}else{const[i,s]=await(0,a.s)(l,e.name,n===a.A.DisplayExtent||n===a.A.Visible?r:null,null===(t=this.fetchAbortController)||void 0===t?void 0:t.signal);this.fieldMinMaxValuesForInput=[i,s],this.selectedQueryFieldValues=[i,s]}this.isQueryingFieldValues=!1}catch(e){this.isQueryingFieldValues=!!(0,a.o)(e)}},this.layer=void 0,this.open=void 0,this.view=void 0,this.referenceElement=void 0,this.activeQueryField=void 0,this.selectedAOI=a.A.DisplayExtent,this.isOverviewsIncluded=!1,this.isQueryingImageItems=!1,this.isQueryingFieldValues=!1,this.selectedQueryFieldValues=[],this.fieldValuesForInput=[],this.fieldMinMaxValuesForInput=[],this.isRangeValueModeSelected=!0,this.isShowingIncludeOverviewTooltip=!1,this.isShowingRangeModeTooltip=!1}async componentWillLoad(){var e;[this.strings]=await(0,s.g)(this.hostElement,"arcgis-image-collection-explorer");const t=(0,a.h)(null===(e=this.layer)||void 0===e?void 0:e.fields),i=(0,a.i)(t),l=this.activeQueryField||i;this.activeQueryField=l,this.activeQueryField&&this.getLayerAttributeValues(this.activeQueryField);const[n]=await(0,r.l)(["esri/core/reactiveUtils"]);this.watchExtentChangeHandler=n.watch((()=>[this.view.stationary,this.view.extent]),(([e])=>{!e||this.selectedAOI!==a.A.DisplayExtent&&this.selectedAOI!==a.A.Visible||this.getLayerAttributeValues(this.activeQueryField)}))}disconnectedCallback(){var e;null===(e=this.watchExtentChangeHandler)||void 0===e||e.remove()}render(){const{strings:e,open:t}=this;return(0,l.h)(l.H,{class:"js-app-flyout"},(0,l.h)("calcite-popover",{dir:(0,n.g)(this.hostElement),open:t,label:e.filters,referenceElement:this.referenceElement,closable:!0,heading:e.filters,placement:"leading-start",pointerDisabled:!0,triggerDisabled:!0,offsetDistance:10,onCalcitePopoverClose:()=>this.arcgisImageItemFiltersPopoverClosed.emit()},(0,l.h)("calcite-panel",null,this.renderFilterInput())))}renderFilterInput(){return(0,l.h)("div",{class:"filter-wrapper"},this.renderAOISelectDropdown(),this.renderAttributeSelectDropdown(),this.renderAttributeInputField(),this.renderIncludeOverviewSwitchButton(),this.renderApplyButton())}renderAOISelectDropdown(){const{strings:e,selectedAOI:t}=this,i=[{name:a.A.DisplayExtent,label:e.displayExtent,description:e.displayExtentDesc},{name:a.A.Visible,label:e.visible,description:e.visibleDesc},{name:a.A.All,label:e.all,description:e.allDesc}],s=i.find((e=>e.name===t)),n=i.map((e=>(0,l.h)("calcite-dropdown-item",{"data-value":e.name,selected:e.name===s.name},(0,l.h)("strong",null,e.label),(0,l.h)("div",null,e.description))));return(0,l.h)("calcite-label",null,e.areaOfInterest,(0,l.h)("calcite-dropdown",{widthScale:"m",placement:"bottom",onCalciteDropdownSelect:e=>{var t,i;const l=e.currentTarget,s=null===(i=null===(t=null==l?void 0:l.selectedItems)||void 0===t?void 0:t[0])||void 0===i?void 0:i.getAttribute("data-value");this.selectedAOI=s,this.activeQueryField&&this.getLayerAttributeValues(this.activeQueryField)}},(0,l.h)("calcite-button",{class:"aoi-select-button",slot:"trigger",alignment:"space-between","icon-end":"chevron-down",appearance:"transparent",kind:"neutral",width:"full"},s.label),(0,l.h)("calcite-dropdown-group",null,n)))}renderAttributeSelectDropdown(){const{strings:e,activeQueryField:t,layer:i}=this,s=(0,a.h)(null==i?void 0:i.fields),n=s.map((e=>(0,l.h)("calcite-option",{value:e.name,label:e.alias,selected:e.name===t.name})));return(0,l.h)("calcite-label",null,e.attribute,(0,l.h)("calcite-select",{label:e.attribute,onCalciteSelectChange:e=>{const i=e.currentTarget.selectedOption.value;if(i!==t.name){const e=s.find((e=>e.name===i));this.selectedQueryFieldValues=[],this.activeQueryField=e,this.getLayerAttributeValues(this.activeQueryField)}}},n))}renderAttributeInputField(){const{strings:e,activeQueryField:t,isQueryingFieldValues:i}=this,s=t.type;return i?(0,l.h)("calcite-loader",{label:e.loading,scale:"s",inline:!0}):(0,a.m)(t)||!(0,a.q)(s)&&"date"!==s?this.renderAttributeDropdownInput():this.renderAttributeSliderInput()}renderSliderSelectedVals(){const{selectedQueryFieldValues:e,activeQueryField:t,isRangeValueModeSelected:i}=this;if(2!==(null==e?void 0:e.length))return null;let s,n;return[s,n]=e,"date"===t.type&&(s=(0,a.k)(s),n=(0,a.k)(n)),(0,l.h)("div",{class:"slider-value-container"},i&&(0,l.h)("calcite-input",{"read-only":!0,value:null==s?void 0:s.toString()}),(0,l.h)("calcite-input",{"read-only":!0,value:null==n?void 0:n.toString()}))}renderAttributeSliderInput(){var e;const{strings:t,fieldMinMaxValuesForInput:i,isRangeValueModeSelected:s,selectedQueryFieldValues:n,activeQueryField:r,isQueryingFieldValues:o}=this,c=i.filter((e=>"number"==typeof e)),d=2===c.length&&c[0]!==c[1];if(2===c.length&&c[0]===c[1]){const[i]=c;return(0,l.h)("calcite-select",{label:t.select,onCalciteSelectChange:e=>{const t=e.currentTarget.selectedOption.value;this.selectedQueryFieldValues=[t]}},(0,l.h)("calcite-option",{value:i,label:"date"===r.type?(0,a.k)(i):i.toString(),selected:(null===(e=this.selectedQueryFieldValues)||void 0===e?void 0:e.length)>0&&i.toString()===this.selectedQueryFieldValues[0].toString()}))}if(d){const e=c[0],t=c[1];return(0,l.h)("div",null,this.renderRangeModeSwitchButton(),this.renderSliderSelectedVals(),s?(0,l.h)("calcite-slider",{key:"range-value-slider",minValue:n[0],maxValue:n[1],min:e,max:t,snap:!0,precise:!0,onCalciteSliderInput:e=>{const t=e.target;this.selectedQueryFieldValues=[t.value[0],t.value[1]]}}):(0,l.h)("calcite-slider",{key:"single-value-slider",value:n[1],min:e,max:t,snap:!0,precise:!0,onCalciteSliderInput:e=>{const t=e.target;this.selectedQueryFieldValues=[n[0],t.value]}}))}return!o&&this.renderEmptyAttributeValueErrorMessage()}renderAttributeDropdownInput(){const{strings:e,activeQueryField:t,fieldValuesForInput:i,isQueryingFieldValues:s}=this;if(i.length>0){const n=(0,a.m)(t),r=i.map((e=>{var i;if(!e)return;const s=n?t.domain.getName(e):e.toString();return(0,l.h)("calcite-option",{value:e,label:s,selected:(null===(i=this.selectedQueryFieldValues)||void 0===i?void 0:i.length)>0&&e.toString()===this.selectedQueryFieldValues[0].toString()})}));return(0,l.h)("calcite-select",{label:e.select,disabled:s,width:"full",onCalciteSelectChange:e=>{let t=e.currentTarget.selectedOption.value;this.selectedQueryFieldValues=[t]}},r)}return!s&&this.renderEmptyAttributeValueErrorMessage()}renderEmptyAttributeValueErrorMessage(){const{strings:e}=this;return(0,l.h)("calcite-input-message",{icon:"exclamation-mark-triangle",status:"invalid"},e.noFieldAttributesErrorMessage)}renderRangeModeSwitchButton(){const{strings:e,isRangeValueModeSelected:t,isShowingRangeModeTooltip:i}=this;return(0,l.h)("calcite-label",{layout:"inline"},e.rangeMode,(0,l.h)("calcite-action",{icon:"information",scale:"s",text:e.rangeMode,ref:e=>this.rangeModeHelpIconActionEl=e,onMouseOver:()=>{this.isShowingRangeModeTooltip=!0},onMouseOut:()=>{this.isShowingRangeModeTooltip=!1},onClick:e=>{e.stopPropagation()}}),(0,l.h)("calcite-tooltip",{open:i,referenceElement:this.rangeModeHelpIconActionEl},e.rangeModelHelpMessage),(0,l.h)("calcite-switch",{style:{marginInlineStart:"auto"},checked:t,onCalciteSwitchChange:e=>{const t=e.target.checked;this.isRangeValueModeSelected=t}}))}renderIncludeOverviewSwitchButton(){const{strings:e,isOverviewsIncluded:t,isShowingIncludeOverviewTooltip:i}=this;return(0,l.h)("calcite-label",{layout:"inline"},e.includeOverviews,(0,l.h)("calcite-action",{icon:"information",scale:"s",text:e.includeOverviewsHelpMessage,ref:e=>this.isIncludeOverviewsHelpIconActionEl=e,onMouseOver:()=>{this.isShowingIncludeOverviewTooltip=!0},onMouseOut:()=>{this.isShowingIncludeOverviewTooltip=!1},onClick:e=>{e.stopPropagation()}}),(0,l.h)("calcite-tooltip",{open:i,referenceElement:this.isIncludeOverviewsHelpIconActionEl},e.includeOverviewsHelpMessage),(0,l.h)("div",{style:{marginInlineStart:"auto"}},(0,l.h)("calcite-switch",{checked:t,scale:"m",onCalciteSwitchChange:e=>{const t=e.target.checked;this.isOverviewsIncluded=t}})))}renderApplyButton(){const{strings:e,isQueryingFieldValues:t,isQueryingImageItems:i}=this;return(0,l.h)("calcite-button",{label:e.apply,onClick:this.handleImageItemQueryApplied,appearance:"solid",width:"full",disabled:t||i},e.apply)}get hostElement(){return(0,l.d)(this)}};o.style=".aoi-select-button{border:1px solid var(--calcite-color-border-input)}.dropdown-container{display:flex;justify-content:space-between;gap:1rem}.slider-value-container{display:flex;gap:1rem}.filter-wrapper{padding:1rem;min-width:320px;background-color:var(--calcite-color-foreground-1)}"}}]);
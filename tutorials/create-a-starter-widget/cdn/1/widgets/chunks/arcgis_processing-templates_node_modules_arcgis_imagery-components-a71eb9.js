/*! For license information please see arcgis_processing-templates_node_modules_arcgis_imagery-components-a71eb9.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_processing-templates_node_modules_arcgis_imagery-components-a71eb9"],{80886:(t,e,i)=>{i.r(e),i.d(e,{arcgis_imagery_processing_template:()=>u});var n,r=i(41126),s=i(14886),a=i(12839),o=i(20353);!function(t){t[t.IDLE=0]="IDLE",t[t.PENDING=1]="PENDING",t[t.RESOLVED=2]="RESOLVED",t[t.REJECTED=3]="REJECTED"}(n||(n={}));const c={status:n.IDLE,data:null,error:null},l=/^\s*data:([a-z]+\/[a-z]+(;[a-z\-]+\=[a-z\-]+)?)?(;base64)?,[a-z0-9\!\$\&\'\,\(\)\*\+\,\;\=\-\.\_\~\:\@\/\?\%\s]*\s*$/i;const u=class{constructor(t){(0,r.r)(this,t),this.arcgisClose=(0,r.c)(this,"arcgisClose",7),this.manager=(0,s.u)(this),this.IdentityManager=(0,s.l)(a.d),this.PortalItem=(0,s.l)(a.n),this.RasterFunction=(0,s.l)(a.o),this.geoprocessor=(0,s.l)(a.p),this.esriRequest=(0,s.l)(a.q),this.rasterFunctionInfos=[],this.strings=(0,o.u)({blocking:!0}),this.handleImportTemplate=()=>{this.updateShowItemBrowser(!0)},this.handleCustomRFTAdd=t=>{this.fetchRFTItem(t)},this.handleDone=()=>{this.saveOriginalValues(),this.arcgisClose.emit("save")},this.handleCancel=()=>{const{layer:t,strings:{custom:e}}=this;t.rasterFunction=this.originalRasterFunction,t.renderer=this.originalRenderer,t.activePresetRendererName=this.originalActivePresetRendererName,"imagery"===t.type&&t?.mosaicRule?.multidimensionalDefinition&&(t.mosaicRule.multidimensionalDefinition=this.originalMultidimensionalDefinition),t.bandIds=this.originalBandIds,t.multidimensionalSubset=this.originalMultidimensionalSubset;const i=this.rasterFunctionInfos.find((({name:t})=>"none"===t?.toLocaleLowerCase()));let n=this.originalRasterFunction?.functionName??i?.name;this.originalRasterFunction?.functionName&&!this.rasterFunctionInfos.some((({name:t})=>t===n))&&(n=`${e}- ${n}`),this.activeRasterFunctionName=n,this.arcgisClose.emit("cancel")},this.updateActiveRasterFunctionName=t=>{this.activeRasterFunctionName=t},this.updateLayerRasterFunction=t=>{const{layer:e,customRasterFunction:i}=this;let n={functionName:t};if(t===i?.name&&(n=i?.function),"imagery-tile"===e.type)e.rasterFunction="none"===t?.toLowerCase()?null:n;else if(e.rasterFunction=n,e?.mosaicRule?.multidimensionalDefinition&&e.mosaicRule.multidimensionalDefinition[0]?.variableName!==t){const t=e.mosaicRule.multidimensionalDefinition.map((t=>(t.variableName="",t)));e.mosaicRule.multidimensionalDefinition=t}this.activeRasterFunctionName=t;const r=e.presetRenderers?.find((e=>"raster-function-template"===e.method&&e.value===t));r?e.activePresetRendererName=r.name:(e.activePresetRendererName="",e.renderer=null),e.bandIds=r?.bandIds,e.multidimensionalSubset=null},this.updateShowItemBrowser=t=>{this.showRFTItemBrowser=t},this.fetchRFTItem=async t=>{if(this.updateRFTItemApiData({status:n.PENDING,data:null,error:null}),t?.id){try{const e=new this.PortalItem({id:t.id,portal:this.portal});let i;const r=t?.name,s=r?.slice(-8);i=".rft.xml"===s?.toLowerCase()?await this.convertRFTFormat(t.id,"json"):await e.fetchData("json");const a=this.RasterFunction.fromJSON({rasterFunction:t?.title,rasterFunctionDefinition:i});await this.validateRFT(a),this.updateRFTItemApiData({status:n.RESOLVED,data:a,error:null}),this.updateCustomRasterFunction(a)}catch(t){this.updateRFTItemApiData({status:n.REJECTED,data:null,error:t instanceof Error?t.message:this.strings.errorRetrievingRFTItem})}this.updateShowItemBrowser(!1)}else this.updateRFTItemApiData({status:n.REJECTED,data:null,error:this.strings.errorRetrievingRFTItem})},this.validateRFT=async t=>{try{const{layer:e,esriRequest:i,strings:n}=this,r=t.toJSON();if(!("imagery"===e.type?await i(e.url,{query:{f:"json",renderingRule:JSON.stringify(r?.rasterFunctionDefinition??r)}}):await e.generateRasterInfo(t)))throw new Error(n.rftValidationFailed)}catch(t){const{strings:{rftValidationFailed:e,unsupportedFunction:i}}=this;let n=e;if(t instanceof Error){const r=t.message?.toLowerCase().indexOf("unsupported raster function:");r>-1&&(n=`${e} ${i.replace("${rasterFunction}",t.message.slice(r+28).trim())}`)}throw new Error(n)}},this.convertRFTFormat=async(t,e)=>{const i=this.portal.helperServices.rasterUtilities;if(!i)throw new Error(this.strings.rasterutilitySeverMissing);try{const n=`${i.url}/ConvertRasterFunctionTemplate`,r={inputRasterFunction:JSON.stringify({itemId:t}),format:e},s=await this.geoprocessor.submitJob(n,r),a={interval:1500};await s.waitForJobCompletion(a);const o=await s.fetchResultData("outputRasterFunction"),c=o?.value;if(!c)throw new Error(this.strings.unsupportedFunction);return(await this.esriRequest(c.url)).data}catch{throw new Error(this.strings.errorRetrievingRFTItem)}},this.createCustomRasterFunction=t=>{const{strings:{custom:e},layer:i,portal:n}=this,r=t?.rasterFunctionDefinition??t,{functionName:s}=t,{description:a,thumbnailEx:o,help:c}=r,u={name:`${e}- ${s}`,function:t,description:a,thumbnail:o,help:c,functionType:0};if(!o&&!l.test(o)){if("imagery-tile"===i.type)u.thumbnail=`${n.sourceJSON?.staticImagesUrl}/rasterfunctiontemplate.png`;else{const t=this.getExportImageBaseURL(),e=`renderingRule=${encodeURIComponent(JSON.stringify(r))}`;u.thumbnail=`${t}&${e}`}}return u},this.getRasterFunctionInfos=()=>{const{type:t}=this.layer;if("imagery-tile"===t)return[{name:"None",description:this.strings.noneRasterFunctionDescription,help:"",functionType:0,thumbnail:`${this.portal.sourceJSON?.staticImagesUrl}/rasterfunctiontemplate.png`}];return this.fixImageryRasterFunctionsThumbnail(this.layer.rasterFunctionInfos??[])},this.fixImageryRasterFunctionsThumbnail=t=>{const{layer:e,strings:i}=this;if("imagery"!==e.type)return t;const n=this.getExportImageBaseURL();return t.map((t=>{const r="none"===t.name.toLowerCase(),s=(a=n,o=t.name,`${a}&renderingRule=${encodeURIComponent(`{"rasterFunction":"${o}" }`)}`);var a,o;if(r){const n=i.noneRasterFunctionDescription;let r=s;const a=e.bandIds;null!=a&&a?.length>=3&&(r=`${s}+&bandIds=${a[0]},${a[1]},${a[2]}`);const o=r;return{...t,description:n,thumbnail:o}}const c=t.description??"";let u=t.thumbnail;return t.thumbnail&&l.test(t.thumbnail)||(u=s),{...t,description:c,thumbnail:u}}))},this.getExportImageBaseURL=()=>{const{layer:t,IdentityManager:e}=this;if(null==t?.fullExtent)return"";const i=t.fullExtent.clone(),n=t.fullExtent.width,r=t.fullExtent.height;if(n/r>=2||r/n>=2){const e=Math.min(n,r)/2,s=t.fullExtent.center;i.xmin=s.x-e,i.ymin=s.y-e,i.xmax=s.x+e,i.ymax=s.y+e}const s=`${i.xmin},${i.ymin},${i.xmax},${i.ymax}`,a=e.findCredential(t.url),o=a?.token,c=new URLSearchParams({bbox:s,token:o,imageSize:"400,400",...t.customParameters,f:"image"});o||c.delete("token");const l=t.sourceJSON;return 2===l.bandCount&&l.serviceDataType?.includes("Vector")&&c.append("renderingRule",JSON.stringify({rasterFunction:"VectorFieldRenderer",rasterFunctionArguments:{MagnitudeBandID:0,DirectionBandID:1,IsUVComponents:"esriImageServiceDataTypeVector-UV"===l.serviceDataType,ReferenceSystem:1,MassFlowAngleRepresentation:0,SymbolTileSize:30,SymbolTileSizeUnits:100,CalculationMethod:"Vector Average",SymbologyName:"Single Arrow",MinimumMagnitude:1,MaximumMagnitude:-1,MinimumSymbolSize:40,MaximumSymbolSize:80},outputPixelType:"U8",variableName:"Raster"})),`${t.url}/exportImage?${c.toString()}`},this.saveOriginalValues=()=>{const{layer:t}=this;this.originalRasterFunction=t.rasterFunction,this.originalRenderer=t.renderer,this.originalActivePresetRendererName=t.activePresetRendererName,"imagery"===t.type&&t?.mosaicRule?.multidimensionalDefinition&&(this.originalMultidimensionalDefinition=t.mosaicRule.multidimensionalDefinition),this.originalBandIds=t.bandIds,this.originalMultidimensionalSubset=t.multidimensionalSubset},this.layer=void 0,this.portal=void 0,this.panelHeading=void 0,this.closable=!1,this.showRendererWarning=!1,this.showItemBrowser=!1,this.hideButtons=!1,this.activeRasterFunctionName=void 0,this.customRasterFunction=void 0,this.showRFTItemBrowser=!1,this.items=void 0,this.pagination=void 0,this.rftItemData=c}watchLayerProp(){this.init()}async componentWillLoad(){this.init()}render(){return(0,r.h)(r.H,{key:"7ee7ed45d0ccd122b319ef5a67596bbf5a735161",class:"calcite-match-height"},(0,r.h)("calcite-flow",{key:"ff6fcc186354cf2d21a77e645dbe45d66522047b"},this.showRFTItemBrowser?this.renderRFTBrowsePanel():this.renderTemplatePanel()))}renderRFTBrowsePanel(){const{layer:t,rftItemData:e,strings:i}=this,s=e.status===n.PENDING;return(0,r.h)("calcite-flow-item",{heading:i.chooseRasterFunctionTemplate,loading:!t},this.renderBack(),s&&this.renderRFTItemLoader(),this.renderRFTItemBrowser())}renderRFTItemBrowser(){const{portal:t,strings:e,pagination:i}=this,n=`${function(t){const{customBaseUrl:e,portalHostname:i,urlKey:n}=t,{protocol:r}=window.location;return`${r}//${n?`${n}.${e}`:i}`}(t)}/home/`;return(0,r.h)("arcgis-item-browser",{api:4,portal:t,config:{baseUrl:n},q:'type:"Raster function template"',user:t.user,view:"list",onArcgisItemBrowserUpdate:t=>{const{results:e,num:i,start:n,total:r}=t.detail;this.items=e,this.pagination={start:n,num:i,total:r}},onArcgisItemBrowserLoading:()=>this.items=[]},(0,r.h)("arcgis-item-browser-top-bar",{slot:"top-bar"},(0,r.h)("arcgis-item-browser-bucket-select",{slot:"bucket"}),(0,r.h)("arcgis-item-browser-search",{slot:"search",placeholder:e.itemBrowserPlaceholder,term:""})),(0,r.h)("arcgis-item-browser-sort",{slot:"sort"}),(0,r.h)("arcgis-item-browser-filters",{slot:"filters"},(0,r.h)("arcgis-item-browser-filter-extent",null),(0,r.h)("arcgis-item-browser-filter-folder",null),(0,r.h)("arcgis-item-browser-filter-categories",null),(0,r.h)("arcgis-item-browser-filter-date",{property:"modified"}),(0,r.h)("arcgis-item-browser-filter-date",{property:"created"}),(0,r.h)("arcgis-item-browser-filter-tags",null),(0,r.h)("arcgis-item-browser-filter-sharing",null),(0,r.h)("arcgis-item-browser-filter-content-status",null)),(0,r.h)("arcgis-item-browser-content",{slot:"content"},this.items?.map((e=>(0,r.h)("arcgis-item-browser-card",{key:e.id,baseUrl:n,item:e,portal:t,preview:"top",showDateUpdated:!0,showItemType:!1,showOwner:!0,showThumbnail:!0,user:t.user},(0,r.h)("calcite-button",{slot:"actions-end",appearance:"transparent",iconStart:"plus-circle",kind:"neutral",scale:"s",onClick:()=>this.handleCustomRFTAdd(e)}))))),(0,r.h)("arcgis-item-browser-pagination",{slot:"pagination",total:i?.total,start:i?.start,num:i?.num}))}renderRFTItemLoader(){return(0,r.h)("div",{class:"rft-item-loader"},(0,r.h)("calcite-loader",{inline:!0,label:"rftItemLoader",type:"indeterminate"}),(0,r.h)("div",{class:"loader-text"},this.strings.rftItemLoaderText))}renderTemplatePanel(){const{layer:t,rftItemData:e,strings:i,showRendererWarning:s,showItemBrowser:a,hideButtons:o,panelHeading:c,closable:l}=this,u="imagery-tile"===t.type,m=e.status===n.REJECTED;return t.loaded?(0,r.h)("calcite-flow-item",{heading:c??i.processingTemplates},l&&this.renderClose(),u&&this.renderBetaNotice(),s&&this.renderWarningNotice(),a&&this.renderImportTemplateButton(),m&&this.renderValidationError(e.error??i.errorRetrievingRFTItem),this.renderServerRasterFunctionsInfo(),!o&&this.renderFooterActions()):(0,r.h)("calcite-flow-item",{loading:!0,heading:c??i.processingTemplates})}renderBetaNotice(){return(0,r.h)("div",{class:"beta-notice"},(0,r.h)("calcite-notice",{closable:!0,icon:!0,open:!0,scale:"s"},(0,r.h)("div",{slot:"message"},this.strings.betaNotice)))}renderWarningNotice(){return(0,r.h)("div",{class:"warning-notice"},(0,r.h)("calcite-notice",{closable:!0,icon:!0,kind:"warning",open:!0,scale:"s"},(0,r.h)("div",{slot:"message"},this.strings.warningNotice)))}renderImportTemplateButton(){return(0,r.h)("calcite-button",{appearance:"transparent","icon-start":"plus",onClick:this.handleImportTemplate},this.strings.importUserTemplate)}renderValidationError(t){return(0,r.h)("calcite-alert",{kind:"danger",label:t,open:!0},(0,r.h)("div",{slot:"title"},this.strings.validationErrorTitle),(0,r.h)("div",{slot:"message"},t))}renderServerRasterFunctionsInfo(){const{customRasterFunction:t,rasterFunctionInfos:e,strings:i}=this;return 0===e?.length?(0,r.h)("calcite-list",{label:i.processingTemplates},(0,r.h)("calcite-list-item",{description:i.noRasterFunctions})):(0,r.h)("calcite-list",{label:i.processingTemplates,selectionMode:"single-persist"},t?this.renderRasterFunctionInfo(t,e.length):null,e.map(((t,e)=>this.renderRasterFunctionInfo(t,e))))}renderRasterFunctionInfo(t,e){const{name:i,description:n,thumbnail:s}=t,a=n?.length>100,o=a,c=a?`${n.slice(0,100)}...`:n,l=`${i}_raster_function_info_${e}`;return(0,r.h)("div",{key:e},o&&(0,r.h)("calcite-tooltip",{"reference-element":l},n),(0,r.h)("calcite-list-item",{id:l,description:c,label:i,value:i,key:i,selected:i===(this.activeRasterFunctionName??this.rasterFunctionInfos[0]?.name),onCalciteListItemSelect:()=>this.updateLayerRasterFunction(i)},(0,r.h)("calcite-action",{slot:"actions-start",compact:!0,scale:"s",text:i,onClick:()=>this.updateLayerRasterFunction(i)},(0,r.h)("img",{src:s,class:"raster-function-thumbnail"}))))}renderBack(){const t="raster-processing-template-back-action";return(0,r.h)("calcite-action",{id:t,text:this.strings.back,scale:"s",slot:"header-actions-start",onClick:()=>this.updateShowItemBrowser(!1)},(0,r.h)("calcite-icon",{scale:"s",icon:"chevron-left"}),(0,r.h)("calcite-tooltip",{"reference-element":t,slot:"tooltip"},this.strings.back))}renderClose(){return(0,r.h)("calcite-action",{text:this.strings.close,scale:"s",slot:"header-actions-end",onClick:this.handleCancel},(0,r.h)("calcite-icon",{scale:"m",icon:"x"}))}renderFooterActions(){return(0,r.h)(r.F,null,this.renderDoneButton(),this.renderCancelButton())}renderDoneButton(){return(0,r.h)("calcite-button",{slot:"footer",color:"blue",width:"half",onClick:this.handleDone},this.strings.done)}renderCancelButton(){return(0,r.h)("calcite-button",{slot:"footer",appearance:"outline-fill",width:"half",onClick:this.handleCancel},this.strings.cancel)}async init(){const{layer:t}=this;await t.load(),this.saveOriginalValues();let e=this.originalRasterFunction?.functionName??null;this.rasterFunctionInfos=this.getRasterFunctionInfos();e&&!this.rasterFunctionInfos.some((({name:t})=>t===e))?(this.customRasterFunction=this.createCustomRasterFunction(this.originalRasterFunction),e=this.customRasterFunction.name):this.customRasterFunction=void 0,this.updateActiveRasterFunctionName(e)}updateCustomRasterFunction(t){const e=this.createCustomRasterFunction(t);this.customRasterFunction?.name!==e.name&&(this.customRasterFunction=e,this.updateActiveRasterFunctionName(e.name),this.updateLayerRasterFunction(e.name))}updateRFTItemApiData(t){this.rftItemData=t}static get assetsDirs(){return["assets"]}get el(){return(0,r.g)(this)}static get watchers(){return{layer:["watchLayerProp"]}}};u.style=":host{display:flex;height:100%}.beta-notice,.warning-notice{max-width:100%;text-align:center;padding:0.5rem 0.5rem}.raster-function-thumbnail{height:100px;width:100px;padding:0 8px}.rft-item-loader{display:inline-flex;align-items:center;justify-content:center;width:100%}.loader-text{margin:0 1rem}"},12839:(t,e,i)=>{i.d(e,{a:()=>d,b:()=>c,c:()=>$,d:()=>s,e:()=>l,f:()=>h,g:()=>I,h:()=>u,i:()=>a,j:()=>y,k:()=>o,l:()=>T,m:()=>m,n:()=>w,o:()=>p,p:()=>P,q:()=>D,r:()=>b,s:()=>F,t:()=>g,u:()=>f,v:()=>R,w:()=>v});var n="undefined"!=typeof window&&"$arcgis"in window&&"object"==typeof window.$arcgis&&"import"in window.$arcgis&&!("forceESM"in window.$arcgis);function r(t){return void 0!==t.default}async function s(){if(n)return await window.$arcgis.import("esri/identity/IdentityManager");const t=await Promise.resolve().then(i.bind(i,588));return r(t)?t.default:t}async function a(){if(n)return await window.$arcgis.import("esri/geometry/Extent");const t=await Promise.resolve().then(i.bind(i,13661));return r(t)?t.default:t}async function o(){if(n)return await window.$arcgis.import("esri/geometry/Point");const t=await Promise.resolve().then(i.bind(i,18423));return r(t)?t.default:t}async function c(){if(n)return await window.$arcgis.import("esri/Graphic");const t=await Promise.resolve().then(i.bind(i,63438));return r(t)?t.default:t}async function l(){if(n)return await window.$arcgis.import("esri/layers/ImageryLayer");const t=await Promise.resolve().then(i.bind(i,11840));return r(t)?t.default:t}async function u(){if(n)return await window.$arcgis.import("esri/layers/support/CodedValueDomain");const t=await Promise.resolve().then(i.bind(i,39327));return r(t)?t.default:t}async function m(){if(n)return await window.$arcgis.import("esri/layers/support/DimensionalDefinition");const t=await Promise.resolve().then(i.bind(i,49047));return r(t)?t.default:t}async function d(){if(n)return await window.$arcgis.import("esri/layers/support/Field");const t=await Promise.resolve().then(i.bind(i,28927));return r(t)?t.default:t}async function h(){if(n)return await window.$arcgis.import("esri/layers/support/MosaicRule");const t=await Promise.resolve().then(i.bind(i,52373));return r(t)?t.default:t}async function g(){if(n)return await window.$arcgis.import("esri/layers/support/MultidimensionalSubset");const t=await Promise.resolve().then(i.bind(i,44951));return r(t)?t.default:t}async function p(){if(n)return await window.$arcgis.import("esri/layers/support/RasterFunction");const t=await Promise.resolve().then(i.bind(i,66744));return r(t)?t.default:t}async function f(){if(n)return await window.$arcgis.import("esri/Map");const t=await Promise.resolve().then(i.bind(i,24824));return r(t)?t.default:t}async function w(){if(n)return await window.$arcgis.import("esri/portal/PortalItem");const t=await Promise.resolve().then(i.bind(i,33752));return r(t)?t.default:t}async function y(){if(n)return await window.$arcgis.import("esri/rest/support/ImageIdentifyParameters");const t=await Promise.resolve().then(i.bind(i,91552));return r(t)?t.default:t}async function R(){if(n)return await window.$arcgis.import("esri/views/MapView");const t=await Promise.resolve().then(i.bind(i,1508));return r(t)?t.default:t}async function b(){if(n)return await window.$arcgis.import("esri/widgets/ValuePicker");const t=await Promise.resolve().then(i.bind(i,63789));return r(t)?t.default:t}async function F(){if(n)return await window.$arcgis.import("esri/widgets/ValuePicker/ValuePickerSlider");const t=await Promise.resolve().then(i.bind(i,23722));return r(t)?t.default:t}async function v(){if(n)return await window.$arcgis.import("esri/config");const t=await Promise.resolve().then(i.bind(i,12762));return r(t)?t.default:t}async function I(){if(n)return await window.$arcgis.import("esri/core/reactiveUtils");const t=await Promise.resolve().then(i.bind(i,54312));return r(t)?t.default:t}async function $(){if(n)return await window.$arcgis.import("esri/geometry/geometryEngine");const t=await Promise.resolve().then(i.bind(i,35431));return r(t)?t.default:t}async function T(){if(n)return await window.$arcgis.import("esri/intl");const t=await Promise.resolve().then(i.bind(i,52797));return r(t)?t.default:t}async function D(){if(n)return await window.$arcgis.import("esri/request");const t=await Promise.resolve().then(i.bind(i,44345));return r(t)?t.default:t}async function P(){if(n)return await window.$arcgis.import("esri/rest/geoprocessor");const t=await Promise.resolve().then(i.bind(i,71802));return r(t)?t.default:t}},20353:(t,e,i)=>{i.d(e,{u:()=>s});var n=i(14886),r=i(41126);const s=(0,n.m)(r.a)}}]);
/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-restore-dca62d.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-restore-dca62d"],{95970:(e,t,s)=>{s.r(t),s.d(t,{arcgis_restore_items:()=>l});var r=s(35110),i=s(79233),n=s(1984),o=s(91659),a=s(66913);s(46710),s(23505),s(70392),s(63280),s(86587),s(21104),s(73838),s(56086);const l=class{constructor(e){(0,r.r)(this,e),this.arcgisRestoreItemsRestore=(0,r.c)(this,"arcgisRestoreItemsRestore",7),this.arcgisRestoreItemsError=(0,r.c)(this,"arcgisRestoreItemsError",7),this.arcgisRestoreItemsClose=(0,r.c)(this,"arcgisRestoreItemsClose",7),this.headerTitle="",this.renderContent=()=>this.tooManyItems?(0,r.h)("span",null,this.i18n.cannotBulkRestoreXItems.replace("${number}","20")):this.allSameOwner?(0,r.h)(r.F,null,(0,r.h)("slot",{name:"message"}),this.restoreItemsBuckets.unrestorableItems.length>=1&&this.renderUnrestorableItems(),this.allRestorableItems.length>=1&&this.renderRestorableItems()):(0,r.h)("span",null,this.i18n.cannotBulkRestoreMultipleOwners),this.renderUnrestorableItems=()=>{const{i18n:e,restoreItemsBuckets:t}=this,{unrestorableItems:s}=t;return(0,r.h)(r.F,null,(0,r.h)("arcgis-items-summary",null,(0,r.h)("div",{slot:"title"},(0,r.h)("span",null,e.cannotRestore),(0,r.h)("arcgis-items-summary-bucket",{disableLinks:!0,popoverId:"restore-bucket",summaryGroups:[{items:s}]})),(0,r.h)("div",{slot:"description",innerHTML:e.dependentItems[1===s.length?"single":"multiple"].replace("${parent}",`${s[0].item.title}`)})),this.allRestorableItems.length>0&&(0,r.h)("hr",{class:"divider"}))},this.renderRestorableItems=()=>{const{i18n:e}=this;return(0,r.h)(r.F,null,(0,r.h)("arcgis-items-summary",null,(0,r.h)("div",{slot:"title"},(0,r.h)("span",null,e.toRestore[1===this.allRestorableItems.length?"single":"multiple"]),(0,r.h)("arcgis-items-summary-bucket",{disableLinks:!0,popoverId:"restore-bucket",summaryGroups:[{items:this.allRestorableItems}]}))),(0,r.h)("arcgis-folder-picker",{class:"folder-picker",label:this.i18n.restoreTo,user:this.contentUser,onArcgisFolderPickerChange:e=>this.folder=e.detail}),(0,r.h)("calcite-notice",{open:!0,class:"leader-1"},(0,r.h)("div",{slot:"message"},this.i18n.noticeMessage)))},this.handleRestore=async()=>{this.isLoading=!0;const{restorableItems:e,sourceItems:t}=this.restoreItemsBuckets,{folder:s}=this;try{const r=await this.restoreItems(t.map((e=>e.item)),s),i=await this.restoreItems(e.map((e=>e.item)),s);this.arcgisRestoreItemsRestore.emit({restoredItems:[...r,...i],folder:s}),this.active=!1}catch(e){this.arcgisRestoreItemsError.emit({messageCode:e.details.messageCode}),this.isLoading=!1}},this.restoreItems=async(e,t=null)=>Promise.all(e.map((e=>((e,t,s)=>{const r=`${(0,o.A)(e.owner,t)}/items/${e.id}/restore`;return(0,a.r)(r,s&&s!==e.owner?{folder:s}:{},{},"post")})(e,this.portal,t.id)))),this.user=void 0,this.portal=void 0,this.items=[],this.active=!1,this.showSelectedItemsCount=!0,this.restoreItemsBuckets={restorableItems:[],sourceItems:[],unrestorableItems:[]},this.isLoading=!1,this.contentUser=void 0}async componentWillLoad(){var e;const t=await(0,n.g)(this.el);this.i18n=t[0],this.contentUser=await(0,i.f)(null===(e=this.items)||void 0===e?void 0:e[0].owner,this.portal),this.folder=(0,i.e)(this.contentUser.username),this.determineRestoreState()}async determineRestoreState(e={fetch:!0}){const{fetch:t}=e;t&&(this.isLoading=!0,this.restoreItemsBuckets=Object.assign({},await(async(e,t)=>{const s=[],r=[],i=[];return await Promise.all(e.map((async n=>{var l;try{await((e,t)=>{const s=`${(0,o.A)(e.owner,t)}/items/${e.id}/canRestore`;return(0,a.r)(s)})(n,t),r.push({item:n})}catch(t){const r=Object.assign({},t.details.raw);if("CONT_00486"===r.messageCode){const{offendingItems:t}=r,o=null!==(l=null==t?void 0:t.map((e=>e.itemId)))&&void 0!==l?l:[];o.every((t=>e.map((e=>e.id)).includes(t)))?s.push({item:n}):i.push({item:n,error:r})}else i.push({item:n,error:r})}}))),{restorableItems:s,sourceItems:r,unrestorableItems:i}})(this.items,this.portal)),this.isLoading=!1);const{restorableItems:s,sourceItems:r}=this.restoreItemsBuckets;this.allRestorableItems=[...s,...r],this.tooManyItems=this.items.length>20,this.allSameOwner=this.items.every((e=>e.owner===this.contentUser.username)),this.canRestore=!this.tooManyItems&&this.allSameOwner&&this.allRestorableItems.length>0,this.headerTitle=this.i18n[this.items.length>1?"restoreItems":"restoreItem"]}render(){const{i18n:e,active:t,isLoading:s,headerTitle:i,renderContent:n}=this;return(0,r.h)("calcite-modal",{open:t,widthScale:"s",kind:"brand",outsideCloseDisabled:!0,onCalciteModalClose:()=>{this.arcgisRestoreItemsClose.emit(),this.active=!1}},(0,r.h)("span",{slot:"header",class:"header"},(0,r.h)("slot",{name:"header"},i)),(0,r.h)("div",{slot:"content",class:"content"},s?(0,r.h)("calcite-scrim",{loading:!0}):n()),!s&&(0,r.h)(r.F,null,(0,r.h)("calcite-button",{slot:"secondary",appearance:"outline-fill","data-id":"cancelButton",onClick:()=>{this.arcgisRestoreItemsClose.emit(),this.active=!1},width:"full"},e.cancel),this.canRestore&&(0,r.h)("calcite-button",{slot:"primary",appearance:"solid",kind:"brand","data-id":"nextButton",onClick:()=>this.handleRestore(),width:"full",disabled:s},e.restore)))}get el(){return(0,r.d)(this)}static get watchers(){return{items:["determineRestoreState"]}}};l.style=".content{display:flex;min-height:72px;flex-direction:column;justify-content:center}::slotted([slot=message]){margin-bottom:1rem}:host{display:flex;flex-direction:column;font-size:var(--calcite-font-size--1)}.folder-picker{margin-top:1rem}.divider{margin-left:0px;margin-right:0px;margin-top:1rem;margin-bottom:0px;border-style:none;border-top:1px solid #ccc}arcgis-items-summary:not(:first-of-type){margin-top:2rem}"},79233:(e,t,s)=>{s.d(t,{a:()=>l,b:()=>c,c:()=>p,d:()=>h,e:()=>d,f:()=>o,g:()=>u,u:()=>g});var r=s(66913),i=s(46710),n=s(70392);async function o(e,t){return(0,r.r)(`${(0,n.g)(t)}/community/users/${e}`)}async function a(){return(0,r.r)(`${(0,n.g)()}/community/self`)}async function l(e,t){var s;if(null!=e||(e=null===i.c||void 0===i.c?void 0:i.c.user),!e)return[];const n=await(0,r.f)((()=>a()),"communitySelf",e.username);return(null!==(s=null==n?void 0:n.groups)&&void 0!==s?s:[]).sort(((e,s)=>{var r;return null===(r=e.title)||void 0===r?void 0:r.localeCompare(s.title,t||"en",{sensitivity:"base"})}))}async function c(){const e=null===i.c||void 0===i.c?void 0:i.c.user;return e?(await(0,r.f)((()=>a()),"communitySelf",e.username)).favGroupId:null}function m(e,t){var s;return null!==(s=null==e?void 0:e.userContentUrl)&&void 0!==s?s:`${null==t?void 0:t.restUrl}/content/users/${e.username}`}async function u(e){var t;const s=null!==(t=null!=e?e:i.c.user)&&void 0!==t?t:i.c.portal.user,{folders:n}=await async function(e){var t;const s=m(null!==(t=null!=e?e:i.c.user)&&void 0!==t?t:i.c.portal.user,i.c.portal),n=await(0,r.r)(s,{num:1});return Promise.resolve(n)}(s),{username:o}=s;return[{username:o,id:o,title:o,created:"now"},...n.sort(((e,t)=>e.title.localeCompare(t.title)))]}async function h(e,t){var s;const r=null!==(s=null!=t?t:i.c.user)&&void 0!==s?s:i.c.portal.user;return(await u(r)).find((t=>t.id===e))}function d(e){return{username:e,id:e,title:e,created:"now"}}async function p(e,t){var s,n;try{const n=`${m(null!==(s=null!=t?t:i.c.user)&&void 0!==s?s:i.c.portal.user,i.c.portal)}/createFolder`;return{result:await(0,r.r)(n,{title:e},{},"post")}}catch(e){return console.error(e),(null===(n=e.details)||void 0===n?void 0:n.messages).some((e=>e.includes("not available")))?{error:{code:"folderNameExists"}}:{error:{code:"unhandledError"}}}}async function g(e,t,s){var n;const o=`${m(null!==(n=null!=s?s:i.c.user)&&void 0!==n?n:i.c.portal.user,i.c.portal)}/${e}/updateFolder`;try{return{result:await(0,r.r)(o,{newTitle:t},{},"post")}}catch(e){return{error:{code:"unhandledError"}}}}}}]);
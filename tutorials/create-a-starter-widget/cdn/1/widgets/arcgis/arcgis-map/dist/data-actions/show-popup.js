System.register(["jimu-core","jimu-arcgis"],(function(e,t){var r={},i={};return{setters:[function(e){r.AbstractDataAction=e.AbstractDataAction,r.DataLevel=e.DataLevel,r.ExBAddedJSAPIProperties=e.ExBAddedJSAPIProperties},function(e){i.MapViewManager=e.MapViewManager,i.featureUtils=e.featureUtils}],execute:function(){e((()=>{var e={62686:e=>{"use strict";e.exports=i},79244:e=>{"use strict";e.exports=r}},t={};function o(r){var i=t[r];if(void 0!==i)return i.exports;var n=t[r]={exports:{}};return e[r](n,n.exports,o),n.exports}o.d=(e,t)=>{for(var r in t)o.o(t,r)&&!o.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.p="";var n={};return o.p=window.jimuConfig.baseUrl,(()=>{"use strict";o.r(n),o.d(n,{default:()=>i});var e=o(79244),t=o(62686);var r=function(e,t,r,i){return new(r||(r=Promise))((function(o,n){function u(e){try{s(i.next(e))}catch(e){n(e)}}function a(e){try{s(i.throw(e))}catch(e){n(e)}}function s(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(u,a)}s((i=i.apply(e,t||[])).next())}))};class i extends e.AbstractDataAction{isSupported(t,i,o){return r(this,void 0,void 0,(function*(){var r,o;if(1!==t.length||i!==e.DataLevel.Records)return!1;const n=t[0],u=null===(r=null==n?void 0:n.dataSource)||void 0===r?void 0:r.id,a=null==n?void 0:n.records;if(!n||!u||!a||0===a.length)return!1;const s=this._getActiveJimuMapView();if(!s||s.isDestroyed()||s.isCached())return!1;if(!s.view||!s.view.popupEnabled)return!1;const c=s.getJimuLayerViewByDataSourceId(u);return!(!c||!c.isLayerVisible()||!1===(null===(o=c.layer)||void 0===o?void 0:o.popupEnabled))}))}onExecute(i,o,n){return r(this,void 0,void 0,(function*(){const r=i[0],o=null==r?void 0:r.dataSource,n=null==o?void 0:o.id,u=this._getActiveJimuMapView(),a=null==u?void 0:u.view;if(a){const i=yield t.featureUtils.convertDataRecordSetToFeatureSet(r);let s=(null==i?void 0:i.features)||[];s=s.filter((e=>!!e)),yield this.queryGeometries(o,s),s=s.filter((e=>!!e.geometry)),s.length>0&&(s.forEach((t=>{t[e.ExBAddedJSAPIProperties.EXB_DATA_SOURCE_ID]=n})),yield this._panTo(a,s,o),u.openPopup(s))}return!0}))}_getActiveJimuMapView(){return function(e,r){let i=null;const o=t.MapViewManager.getInstance();if(e){const t=o.getJimuMapViewGroup(e);if(t&&t.jimuMapViews){const e=Object.values(t.jimuMapViews).filter((e=>!!e));e.length>0&&(i=e.find((e=>e.isActive))),!i&&r&&(i=e[0])}}return i}(this.widgetId,!0)}queryGeometries(e,i){return r(this,void 0,void 0,(function*(){const r=i.filter((e=>!e.geometry));if(e&&r.length>0){const i={},o=[];if(r.forEach((e=>{const t=e.getObjectId();if("number"==typeof t){const r=t.toString();o.push(r),i[t]=e}})),o.length>0){const r={outFields:[],objectIds:o,returnGeometry:!0},n=yield e.queryAll(r),u=null==n?void 0:n.records;if((null==u?void 0:u.length)>0){const r=yield t.featureUtils.convertDataRecordSetToFeatureSet({name:"",dataSource:e,records:u}),o=null==r?void 0:r.features;(null==o?void 0:o.length)>0&&o.forEach((e=>{if(e){const t=e.getObjectId(),r=e.geometry;if("number"==typeof t&&r){const e=i[t];e&&(e.geometry=r)}}}))}}}}))}_panTo(e,t,i){return r(this,void 0,void 0,(function*(){let r=null;const i=t.find((e=>e.geometry)),o=null==i?void 0:i.geometry;o&&(o.extent?r=o.extent.center:"esri.geometry.Point"===o.declaredClass&&(r=o)),r&&(yield e.goTo(r))}))}}})(),n})())}}}));
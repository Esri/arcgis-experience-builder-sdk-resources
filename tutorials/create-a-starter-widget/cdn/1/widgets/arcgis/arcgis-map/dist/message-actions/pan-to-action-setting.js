System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-theme"],(function(e,t){var a={},o={},s={},r={},n={};return{setters:[function(e){a.AllDataSourceTypes=e.AllDataSourceTypes,a.CONSTANTS=e.CONSTANTS,a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.MessageCarryData=e.MessageCarryData,a.MessageType=e.MessageType,a.React=e.React,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.jsx=e.jsx,a.polished=e.polished},function(e){o.Checkbox=e.Checkbox,o.Label=e.Label,o.Radio=e.Radio},function(e){s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection},function(e){r.DEFAULT_DATA_VIEW_ID=e.DEFAULT_DATA_VIEW_ID,r.DataSourceSelector=e.DataSourceSelector},function(e){n.withTheme=e.withTheme}],execute:function(){e((()=>{var e={79244:e=>{"use strict";e.exports=a},1888:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=o},13089:e=>{"use strict";e.exports=r},79298:e=>{"use strict";e.exports=s}},t={};function i(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,i),s.exports}i.d=(e,t)=>{for(var a in t)i.o(t,a)&&!i.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.p="";var u={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(u),i.d(u,{default:()=>b});var e=i(79244),t=i(14321),a=i(79298),o=i(13089);const s="Trigger data",r="All data",n="Customized data",c="Return to the initial map extent when selection is cleared";var l=i(1888);function d(t,a){var o,s;const r=D(),n=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[t],i=null===(s=null==n?void 0:n.manifest)||void 0===s?void 0:s.publishMessages;let u=e.MessageCarryData.UseDataSource;return null==i||i.forEach((e=>{const t=e;(null==t?void 0:t.messageCarryData)&&(null==t?void 0:t.messageType)===a&&(u=null==t?void 0:t.messageCarryData)})),u}function p(t,a){if(a===e.MessageType.DataSourceFilterChange){const a=e.DataSourceManager.getInstance().getDataSource(t);if(a&&a.type===e.DataSourceTypes.ImageryLayer)return!1}return!0}function g(t,a,o,s){var r,n;let i=null;const u=S(t,o);if(!(u&&u.length>0))return null;let c=!1;if(a){const t=null===(n=null===(r=e.DataSourceManager.getInstance().getDataSource(a.dataSourceId))||void 0===r?void 0:r.getDataSourceJson())||void 0===n?void 0:n.isOutputFromWidget;c=u.some((e=>!!e&&(y(e.dataSourceId)?e.dataSourceId===a.rootDataSourceId:t||s?a.mainDataSourceId===e.mainDataSourceId:a.dataSourceId===e.dataSourceId)))}if(c)i=a;else if(i=null,u&&1===u.length){const t=u[0];t&&t.dataSourceId&&!y(t.dataSourceId)&&(i=(0,e.Immutable)({dataSourceId:t.dataSourceId,mainDataSourceId:t.mainDataSourceId,dataViewId:t.dataViewId,rootDataSourceId:t.rootDataSourceId}))}return i}function S(t,a){var o;const s=d(t,a),r=D(),n=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[t],i=(null==n?void 0:n.useDataSources)||(0,e.Immutable)([]),u=function(t){var a;const o=null!==(a=null==t?void 0:t.map((e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}))))&&void 0!==a?a:[];return(0,e.Immutable)(o)}(null==n?void 0:n.outputDataSources)||(0,e.Immutable)([]),c=function(t){const a=[],o=h(t),s=null==o?void 0:o.useMapWidgetIds,r={};(null==s?void 0:s.length)>0&&s.forEach((e=>{if(e){const t=h(e),o=null==t?void 0:t.useDataSources;o&&o.forEach((e=>{var t;const o=null===(t=null==e?void 0:e.asMutable)||void 0===t?void 0:t.call(e,{deep:!0});o&&o.dataSourceId&&!r[o.dataSourceId]&&(r[o.dataSourceId]=!0,a.push(o))}))}}));return(0,e.Immutable)(a)}(t),l=u,p=(null==n?void 0:n.useDataSources)?i:c,g=(0,e.Immutable)(p.asMutable({deep:!0}).concat(l.asMutable({deep:!0})));switch(s){case e.MessageCarryData.OutputDataSource:return l;case e.MessageCarryData.UseDataSource:return p;case e.MessageCarryData.BothDataSource:return g}}function h(e){var t;if(!e)return null;const a=D();return null===(t=null==a?void 0:a.widgets)||void 0===t?void 0:t[e]}function m(t,a,o){const s=d(null==t?void 0:t.id,a),r=(null==t?void 0:t.outputDataSources)||[],n=(null==t?void 0:t.useDataSources)||[];if(o)return!1;switch(s){case e.MessageCarryData.OutputDataSource:return 1===(null==r?void 0:r.length);case e.MessageCarryData.UseDataSource:return 1===(null==n?void 0:n.length);case e.MessageCarryData.BothDataSource:return 1===r.length+n.length}}function D(){var t,a,o;return window.jimuConfig.isBuilder?null===(a=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(o=(0,e.getAppStore)().getState())||void 0===o?void 0:o.appConfig}function f(t,a){let o=[];const s=S(t,a);return s&&s.forEach((e=>{const t=null==e?void 0:e.dataSourceId;t&&y(t)&&o.push(t)})),o=Array.from(new Set(o)),o.length>0?(0,e.Immutable)(o):void 0}function I(t,a){const o=S(t,a),s=[];return o&&o.forEach((e=>{const t=null==e?void 0:e.mainDataSourceId;t&&!y(t)&&s.push(t)})),(0,e.Immutable)(s)}function y(t){const a=D();if(t&&a.dataSources){const o=a.dataSources[t];if(o&&(o.type===e.DataSourceTypes.WebMap||o.type===e.DataSourceTypes.WebScene))return!0}return!1}const v=(0,e.Immutable)([e.AllDataSourceTypes.FeatureLayer,e.AllDataSourceTypes.SceneLayer,e.AllDataSourceTypes.BuildingComponentSubLayer,e.AllDataSourceTypes.ImageryLayer,e.AllDataSourceTypes.OrientedImageryLayer,e.AllDataSourceTypes.SubtypeGroupLayer,e.AllDataSourceTypes.SubtypeSublayer]);class T extends e.React.PureComponent{constructor(t){super(t),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.onAllDataRadioChecked=()=>{const e=this.props.config.set("useAnyTriggerData",!0);this.updateMessageActionConfigAndUseDataSources(e)},this.onCustomizeDataRadioChecked=()=>{const e=this.props.config.set("useAnyTriggerData",!1);this.updateMessageActionConfigAndUseDataSources(e)},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e):this.handleRemoveLayerForTriggerLayer()},this.handleTriggerLayerSelected=t=>{let a=null;if(this.fromRootDsIds)a=t;else{a=S(this.props.messageWidgetId,this.props.messageType).filter((a=>!!t.find((t=>{var o;return t.dataViewId&&t.dataViewId!==e.CONSTANTS.OUTPUT_DATA_VIEW_ID||(null===(o=this.props.config.useDataSources)||void 0===o?void 0:o.find((e=>t.mainDataSourceId===e.mainDataSourceId)))?t.dataSourceId===a.dataSourceId:t.mainDataSourceId===a.mainDataSourceId}))))}let o=this.props.config.set("useDataSource",a[0]);o=o.set("useDataSources",a),this.updateMessageActionConfigAndUseDataSources(o)},this.handleRemoveLayerForTriggerLayer=()=>{let e=this.props.config.set("useDataSource",null);e=e.set("useDataSources",[]),this.updateMessageActionConfigAndUseDataSources(e)},this.onGoToInitialMapExtentWhenSelectionClearedCheckboxChanged=(e,t)=>{t=!!t;const a=this.props.config.set("goToInitialMapExtentWhenSelectionCleared",t);this.updateMessageActionConfigAndUseDataSources(a)},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1}}componentDidMount(){const t=function(t,a,o){let s=null;const r=[];if(t.useDataSource){const e=!1;s=g(a,t.useDataSource,o,e),t.useDataSources&&t.useDataSources.forEach((t=>{const s=g(a,t,o,e);s&&r.push(s)}))}else{let t=S(a,o);t=t.filter((e=>p(e.dataSourceId,o))),t.length>0&&t.forEach(((t,a)=>{let o;y(t.dataSourceId)?o=null:(o=(0,e.Immutable)({dataSourceId:t.dataSourceId,mainDataSourceId:t.mainDataSourceId,rootDataSourceId:t.rootDataSourceId,dataViewId:t.dataViewId}),s||(s=o),r.push(o))}))}return{useDataSource:s,useDataSources:r}}(this.props.config,this.props.messageWidgetId,this.props.messageType);let a=this.props.config.set("useDataSource",t.useDataSource);a=a.set("useDataSources",t.useDataSources),this.updateMessageActionConfigAndUseDataSources(a)}getStyle(t){return e.css`
      .setting-header {
        padding: ${e.polished.rem(10)} ${e.polished.rem(16)} ${e.polished.rem(0)} ${e.polished.rem(16)}
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }
    `}updateMessageActionConfigAndUseDataSources(t){const a=function(t){const a=[];return t&&t.useDataSources&&t.useDataSources.forEach((t=>{if(t){const o=(0,e.Immutable)(t).asMutable({deep:!0});a.push(o)}})),a}(t);this.props.onSettingChange({actionId:this.props.actionId,config:t,useDataSources:a})}render(){const i=this.props.messageType===e.MessageType.DataRecordsSelectionChange,u=function(t,a,o,s){var r;const n=D(),i=null===(r=null==n?void 0:n.widgets)||void 0===r?void 0:r[t],u=f(t,s);let c,l=!1;l=!(u&&u.length>0)&&m(i,s,u),c=u&&u.length>0?void 0:I(t,s).filter((e=>p(e,s)));return{isReadOnly:l,useDataSource:a,useDataSources:o||(0,e.Immutable)([]),fromRootDsIds:u,fromDsIds:c}}(this.props.messageWidgetId,this.props.config.useDataSource,this.props.config.useDataSources,this.props.messageType);let l;l=u.useDataSources?(0,e.Immutable)(u.useDataSources):u.useDataSource?(0,e.Immutable)([u.useDataSource]):(0,e.Immutable)([]);const d=this.props.config.goToInitialMapExtentWhenSelectionCleared||!1,g=!u.isReadOnly;let h,y,T=null;i?(T=!0,h=!1,y=!0):(T=(e,t)=>!S(this.props.messageWidgetId,this.props.messageType).filter((e=>e.mainDataSourceId===t)).find((t=>{let a;return a=t.dataViewId?t.dataViewId:o.DEFAULT_DATA_VIEW_ID,a===e.id})),h=!0,y=!1),this.fromRootDsIds=u.fromRootDsIds;const b=!!this.props.config.useAnyTriggerData,C=this.props.intl.formatMessage({id:"mapAction_AllData",defaultMessage:r}),A=this.props.intl.formatMessage({id:"mapAction_CustomizeData",defaultMessage:n});return(0,e.jsx)("div",{css:this.getStyle(this.props.theme)},(0,e.jsx)(a.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:s})},(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.Label,{className:"d-flex align-items-center"},(0,e.jsx)(t.Radio,{className:"mr-2",checked:b,onChange:()=>{this.onAllDataRadioChecked()}}),C)),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.Label,{className:"d-flex align-items-center"},(0,e.jsx)(t.Radio,{className:"mr-2",checked:!b,onChange:()=>{this.onCustomizeDataRadioChecked()}}),A)),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(o.DataSourceSelector,{className:(0,e.classNames)([{"d-none":b}]),types:v,useDataSources:l,fromRootDsIds:u.fromRootDsIds,fromDsIds:u.fromDsIds,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,disableRemove:()=>u.isReadOnly,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,isMultiple:g,hideDataView:T,isMultipleDataView:h,disableDataView:y,hideCreateViewButton:!0,enableToSelectOutputDsFromSelf:!0}))),i&&(0,e.jsx)(a.SettingSection,null,(0,e.jsx)(t.Label,{className:"d-flex align-items-center"},(0,e.jsx)(t.Checkbox,{checked:d,className:"mr-2",onChange:this.onGoToInitialMapExtentWhenSelectionClearedCheckboxChanged}),this.props.intl.formatMessage({id:"mapAction_ReturnToInitialMapExtent",defaultMessage:c}))))}}T.defaultProps={config:(0,e.Immutable)({useDataSource:null})};const b=(0,l.withTheme)(T)})(),u})())}}}));
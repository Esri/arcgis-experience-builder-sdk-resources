System.register(["jimu-core","jimu-arcgis"],(function(t,e){var a={},n={};return{setters:[function(t){a.AbstractDataAction=t.AbstractDataAction,a.DataLevel=t.DataLevel,a.DataSourceStatus=t.DataSourceStatus,a.MutableStoreManager=t.MutableStoreManager,a.getAppStore=t.getAppStore,a.i18n=t.i18n,a.utils=t.utils},function(t){n.ActionType=t.ActionType,n.MapViewManager=t.MapViewManager,n.SHOW_ON_MAP_DATA_ID_PREFIX=t.SHOW_ON_MAP_DATA_ID_PREFIX}],execute:function(){t((()=>{var t={62686:t=>{"use strict";t.exports=n},79244:t=>{"use strict";t.exports=a}},e={};function i(a){var n=e[a];if(void 0!==n)return n.exports;var o=e[a]={exports:{}};return t[a](o,o.exports,i),o.exports}i.d=(t,e)=>{for(var a in e)i.o(e,a)&&!i.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.p="";var o={};return i.p=window.jimuConfig.baseUrl,(()=>{"use strict";i.r(o),i.d(o,{default:()=>r});var t=i(79244),e=i(62686);const a="Show on map data";var n=function(t,e,a,n){return new(a||(a=Promise))((function(i,o){function r(t){try{u(n.next(t))}catch(t){o(t)}}function s(t){try{u(n.throw(t))}catch(t){o(t)}}function u(t){var e;t.done?i(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(r,s)}u((n=n.apply(t,e||[])).next())}))};class r extends t.AbstractDataAction{constructor(){super(...arguments),this._viewManager=e.MapViewManager.getInstance()}isSupported(e,a){return n(this,void 0,void 0,(function*(){if(e.length>1)return!1;const n=e[0],{records:i,dataSource:o}=n;return!(!o||o.getStatus()===t.DataSourceStatus.NotReady)&&(a===t.DataLevel.Records&&(null==i?void 0:i.length)>0&&i.some((t=>{var e;return null===(e=t.feature)||void 0===e?void 0:e.geometry})))}))}onExecute(i,o,r,s){return n(this,void 0,void 0,(function*(){var n;const o=this._getActiveViewId(this.widgetId,(0,t.getAppStore)().getState().jimuMapViewsInfo),r=(null===(n=t.MutableStoreManager.getInstance().getStateValue([this.widgetId]))||void 0===n?void 0:n.showOnMapDatas)||{},u=i[0],c=function(e,n,i){const o=t.i18n.getIntl(),r=e.label||e.name||o.formatMessage({id:"showOnMapData",defaultMessage:a}),s=[];Object.values(i).forEach((t=>{const e=t.titleCountInfo;t.jimuMapViewId===n&&e&&e.rawTitle===r&&e.count>=0&&s.push(e.count)}));let u=null;if(s.length>0){const t=Math.max(...s);u={rawTitle:r,finalTitle:`${r} ${t+1}`,count:t+1}}else u={rawTitle:r,finalTitle:r,count:1};return u}(u,o,r),l=`${e.SHOW_ON_MAP_DATA_ID_PREFIX}dataAction_${t.utils.getUUID()}`;let d;d=s?s.isUseCustomSymbol?s.symbolOption:!1===s.isUseCustomSymbol?null:void 0:void 0;const p=null==s?void 0:s.isOperationalLayer,g={mapWidgetId:this.widgetId,messageWidgetId:void 0,jimuMapViewId:o,dataSet:u,title:c.finalTitle,type:e.ActionType.DataAction,symbolOption:d,isOperationalLayer:p,titleCountInfo:c};return r[l]=g,t.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"showOnMapDatas",r),yield Promise.resolve(!0)}))}_getActiveViewId(t,e){let a=Object.keys(e||{}).find((a=>e[a].mapWidgetId===t&&e[a].isActive));return a||(a=Object.keys(e||{}).find((a=>e[a].mapWidgetId===t))),a}}})(),o})())}}}));
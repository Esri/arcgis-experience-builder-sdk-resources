System.register(["jimu-core","jimu-arcgis"],(function(e,t){var a={},o={};return{setters:[function(e){a.AbstractMessageAction=e.AbstractMessageAction,a.AppMode=e.AppMode,a.DataSourceManager=e.DataSourceManager,a.DataSourcesChangeType=e.DataSourcesChangeType,a.Immutable=e.Immutable,a.MessageCarryData=e.MessageCarryData,a.MessageType=e.MessageType,a.MutableStoreManager=e.MutableStoreManager,a.RecordSetChangeType=e.RecordSetChangeType,a.getAppStore=e.getAppStore},function(e){o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules}],execute:function(){e((()=>{var e={62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=a}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,n),r.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var r={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(r),n.d(r,{default:()=>g});var e=n(79244),t=n(62686);function a(e,t){let a=null;return e.clone?a=e.clone():(a=t.fromJSON(Object.assign({},e)),a.attributes=Object.assign({},e.attributes)),a}function o(t,a){var o,n;const r=i(),s=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[t],u=null===(n=null==s?void 0:s.manifest)||void 0===n?void 0:n.publishMessages;let l=e.MessageCarryData.UseDataSource;return null==u||u.forEach((e=>{const t=e;(null==t?void 0:t.messageCarryData)&&(null==t?void 0:t.messageType)===a&&(l=null==t?void 0:t.messageCarryData)})),l}function s(t,a){var n;const r=o(t,a),s=i(),l=null===(n=null==s?void 0:s.widgets)||void 0===n?void 0:n[t],c=(null==l?void 0:l.useDataSources)||(0,e.Immutable)([]),d=function(t){var a;const o=null!==(a=null==t?void 0:t.map((e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}))))&&void 0!==a?a:[];return(0,e.Immutable)(o)}(null==l?void 0:l.outputDataSources)||(0,e.Immutable)([]),g=function(t){const a=[],o=u(t),n=null==o?void 0:o.useMapWidgetIds,r={};(null==n?void 0:n.length)>0&&n.forEach((e=>{if(e){const t=u(e),o=null==t?void 0:t.useDataSources;o&&o.forEach((e=>{var t;const o=null===(t=null==e?void 0:e.asMutable)||void 0===t?void 0:t.call(e,{deep:!0});o&&o.dataSourceId&&!r[o.dataSourceId]&&(r[o.dataSourceId]=!0,a.push(o))}))}}));return(0,e.Immutable)(a)}(t),p=d,S=(null==l?void 0:l.useDataSources)?c:g,v=(0,e.Immutable)(S.asMutable({deep:!0}).concat(p.asMutable({deep:!0})));switch(r){case e.MessageCarryData.OutputDataSource:return p;case e.MessageCarryData.UseDataSource:return S;case e.MessageCarryData.BothDataSource:return v}}function u(e){var t;if(!e)return null;const a=i();return null===(t=null==a?void 0:a.widgets)||void 0===t?void 0:t[e]}function i(){var t,a,o;return window.jimuConfig.isBuilder?null===(a=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(o=(0,e.getAppStore)().getState())||void 0===o?void 0:o.appConfig}function l(){var t;const a=function(){var t;return(null===(t=window.jimuConfig)||void 0===t?void 0:t.isBuilder)?(0,e.getAppStore)().getState().appStateInBuilder:(0,e.getAppStore)().getState()}();return(null===(t=null==a?void 0:a.appRuntimeInfo)||void 0===t?void 0:t.appMode)===e.AppMode.Express}function c(t){const a=(0,e.getAppStore)().getState().appRuntimeInfo.appMode;if(t.messageType===e.MessageType.ExtentChange)return a!==e.AppMode.Express;if(t.messageType===e.MessageType.DataSourcesChange)return!0;if(t.messageType!==e.MessageType.DataRecordSetChange&&t.messageType!==e.MessageType.DataRecordsSelectionChange&&t.messageType!==e.MessageType.DataSourceFilterChange)return!1;{const a=e.DataSourceManager.getInstance(),o=s(t.widgetId,t.messageType);return!(0!==o.length||!function(t){var a;const o=t.widgetId;if((t.messageType===e.MessageType.DataRecordSetChange||t.messageType===e.MessageType.DataRecordsSelectionChange)&&o){const e=u(o);if(e&&"widgets/common/search/"===e.uri&&(null===(a=e.useMapWidgetIds)||void 0===a?void 0:a.length)>0)return!0}return!1}(t))||o.some((e=>{const t=a.getDataSource(e.dataSourceId);return!!t&&("WEB_MAP"===t.type||"WEB_SCENE"===t.type||!!t.getGeometryType())}))}}function d(e){const t=l(),a=null==e?void 0:e.useAnyTriggerData;return t||a}class g extends e.AbstractMessageAction{constructor(){super(...arguments),this.NoLockTriggerLayerWidgets=["Map"]}filterMessageDescription(e){return c(e)}filterMessage(e){return!0}getDefaultMessageActionConfig(t){const a={useDataSource:null,useDataSources:[],goToInitialMapExtentWhenSelectionCleared:!1};return t.type!==e.MessageType.DataRecordsSelectionChange&&t.type!==e.MessageType.DataSourceFilterChange||(a.useAnyTriggerData=!0),a}getSettingComponentUri(t,a){const o=(0,e.getAppStore)().getState().appRuntimeInfo.appMode;return t===e.MessageType.DataRecordsSelectionChange||t===e.MessageType.DataRecordSetChange||t===e.MessageType.DataSourceFilterChange?o===e.AppMode.Express?null:"message-actions/zoom-to-feature-action-setting":null}onExecute(o,n){return(0,t.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let r=null;[r]=t;let s=null;const u={left:50,right:50,top:50,bottom:50};switch(o.type){case e.MessageType.DataRecordSetChange:const t=o;if(t.changeType===e.RecordSetChangeType.CreateUpdate)if(s=p(n,u),t.extent){const a={type:"zoom-to-features-extent",extent:t.extent,zoomToOption:s};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue.value",a)}else{const o=[];t.dataRecordSets.forEach((e=>{if(e&&e.records){const t=[];for(let o=0;o<e.records.length;o++)if(e.records[o].feature){const n=a(e.records[o].feature,r);t.push(n)}t.length>0&&o.push(t)}}));const n={type:"zoom-to-array-graphics",arrayFeatures:o,zoomToOption:s};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue.value",n)}break;case e.MessageType.DataRecordsSelectionChange:const i=o,l=i.records,c=[];let g=null;if(l){const e=l[0];if(e){e.dataSource&&(g=e.dataSource.id);const t=function(e,t){var a,o;if(d(t))return!0;if(0===e.length)return!!(null==t?void 0:t.goToInitialMapExtentWhenSelectionCleared);const n=[],r=e[0],s=null===(a=null==r?void 0:r.dataSource)||void 0===a?void 0:a.getMainDataSource();if(s){n.push(s.id);const e=s.getAssociatedDataSource&&s.getAssociatedDataSource();e&&n.push(e.id)}return 0!==n.length&&(null===(o=null==t?void 0:t.useDataSources)||void 0===o?void 0:o.some((e=>(null==e?void 0:e.mainDataSourceId)&&n.includes(null==e?void 0:e.mainDataSourceId))))}(l,n);if(!t)break}for(let e=0;e<l.length;e++)if(l[e].feature){const t=a(l[e].feature,r);c.push(t)}}const S=c&&c.length>0;if(s=p(n,u),i.extent){const t={type:"zoom-to-features-extent",extent:i.extent,zoomToOption:s};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue.value",t)}else if(S){if(g){const t={type:"zoom-to-graphics",features:c,dataSourceId:g,zoomToOption:s};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue.value",t)}}else if(null==n?void 0:n.goToInitialMapExtentWhenSelectionCleared){const t={type:"zoom-to-map-initial-extent",zoomToOption:void 0};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue.value",t)}break;case e.MessageType.ExtentChange:const v=o,f=v.getRelatedWidgetIds();if(f.includes(this.widgetId))break;const m={value:{type:"zoom-to-extent",extent:v.extent,viewpoint:v.viewpoint,stationary:v.stationary,interactive:v.interactive,zoomToOption:void 0,publishTime:v.publishTime,publishWidgetId:v.widgetId},relatedWidgets:f};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue",m);break;case e.MessageType.DataSourceFilterChange:const h=o,{validChangedDataSourceIds:y,useDataSourceIds:M}=function(e,t){var a,o;let n=[],r=[];const s=e.dataSourceIds||[];return d(t)?(n=s.slice(),r=s.slice()):((null===(a=null==t?void 0:t.useDataSources)||void 0===a?void 0:a.length)>0&&(null===(o=null==t?void 0:t.useDataSources)||void 0===o||o.forEach((e=>{const t=null==e?void 0:e.dataSourceId;t&&r.push(t)}))),n=s.filter((e=>r.includes(e)))),{validChangedDataSourceIds:n,useDataSourceIds:r}}(h,n);if(0===y.length)break;s=p(n,u);const T={type:"zoom-to-query-params",filterChangedDataSourceIds:y,useDataSourceIds:M,zoomToOption:s};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue.value",T);break;case e.MessageType.DataSourcesChange:const I=o;if(I.changeType===e.DataSourcesChangeType.Create){const t=[];if(I.dataSources.forEach((e=>{t.push(e.id)})),0===t.length)break;s=p(n,u);const a={type:"zoom-to-layers",dataSourceIds:t,zoomToOption:s};e.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"zoomToFeatureActionValue.value",a)}}return!0}))}}function p(e,t){let a={};return e&&e.isUseCustomZoomToOption&&"number"==typeof e.zoomToOption.scale&&(a.scale=e.zoomToOption.scale),t&&(a.padding=t),0===Object.keys(a).length&&(a=null),a}})(),r})())}}}));
System.register(["jimu-theme","jimu-core","jimu-arcgis","calcite-components","jimu-ui","widgets/shared-code/lrs","jimu-core/react","jimu-ui/advanced/map"],(function(e,t){var n={},r={},o={},i={},a={},s={},l={},u={};return{setters:[function(e){n.registerStyles=e.registerStyles,n.useTheme=e.useTheme,n.withStyles=e.withStyles,n.withTheme=e.withTheme},function(e){r.DataSourceManager=e.DataSourceManager,r.DataSourceTypes=e.DataSourceTypes,r.JimuFieldType=e.JimuFieldType,r.React=e.React,r.ReactRedux=e.ReactRedux,r.SessionManager=e.SessionManager,r.WidgetState=e.WidgetState,r.classNames=e.classNames,r.css=e.css,r.dataSourceUtils=e.dataSourceUtils,r.esri=e.esri,r.focusElementInKeyboardMode=e.focusElementInKeyboardMode,r.getAppStore=e.getAppStore,r.hooks=e.hooks,r.jsx=e.jsx,r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,r.polished=e.polished,r.utils=e.utils},function(e){o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.CalciteButton=e.CalciteButton,i.CalciteInputDatePicker=e.CalciteInputDatePicker,i.CalciteTable=e.CalciteTable,i.CalciteTableCell=e.CalciteTableCell,i.CalciteTableHeader=e.CalciteTableHeader,i.CalciteTableRow=e.CalciteTableRow},function(e){a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.FloatingPanel=e.FloatingPanel,a.Icon=e.Icon,a.Label=e.Label,a.Popper=e.Popper,a.Select=e.Select,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.defaultMessages=e.defaultMessages},function(e){s.fetchEnterpriseContingentValues=e.fetchEnterpriseContingentValues,s.fetchEnterpriseFieldGroup=e.fetchEnterpriseFieldGroup,s.fieldsWithContingentValues=e.fieldsWithContingentValues,s.getContingentOptions=e.getContingentOptions,s.normalizeFieldName=e.normalizeFieldName,s.setContingentValues=e.setContingentValues,s.validateContingencyConstraints=e.validateContingencyConstraints},function(e){l.default=e.default},function(e){u.DrawingElevationMode3D=e.DrawingElevationMode3D}],execute:function(){e((()=>{var e={8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},99037:e=>{"use strict";e.exports=i},62686:e=>{"use strict";e.exports=o},79244:e=>{"use strict";e.exports=r},68972:e=>{"use strict";e.exports=l},1888:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=a},48993:e=>{"use strict";e.exports=u},47626:e=>{"use strict";e.exports=s}},t={};function c(n){var r=t[n];if(void 0!==r)return r.exports;var o=t[n]={exports:{}};return e[n](o,o.exports,c),o.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{AttributeTable:()=>So,ConvertUnits:()=>X,CopyAttributeTool:()=>ui,GetEsriUnits:()=>ne,GetSRUnits:()=>ee,GetUnits:()=>te,InlineEditableDropdown:()=>wo,Intellisense:()=>Lo,IntellisenseTextInput:()=>Po,LockAcquireStatus:()=>Co,LockAction:()=>Go,LockManagerComponent:()=>si,LockReleaseStatus:()=>Vo,LocksEndpointType:()=>Uo,LrsApplyEdits:()=>Je,LrsLayerType:()=>Vi,QueryLock:()=>zo,QueryMapPointWithMeasureOnRoute:()=>Ke,QueryMeasureOnRoute:()=>Qe,QueryPolylineOnRoute:()=>Ze,QueryRouteMeasures:()=>We,QueryRouteMeasuresAndDistances:()=>He,ReleasableStatus:()=>_o,RoutePicker:()=>nt,RoutePickerPopup:()=>ot,SearchMethod:()=>_i,VMSEndpoints:()=>$o,acquireLock:()=>Wo,atOrBetween:()=>be,colorBlack:()=>Le,colorCyan:()=>Me,convertStationToNumber:()=>de,createFeatureLayer:()=>fi,createField:()=>bi,createLabelLayer:()=>Oi,errorMessageDelay:()=>De,fetchEnterpriseContingentValues:()=>wi,fetchEnterpriseFieldGroup:()=>Si,fieldsWithContingentValues:()=>Mi,findFieldByName:()=>hi,findFieldByType:()=>pi,flash:()=>Ie,formatMessage:()=>Z,getAttributeSets:()=>Qi,getBaseURL:()=>ri,getCalciteBasicTheme:()=>ke,getCalciteButtonWithIconTheme:()=>xe,getCalciteNoticeTheme:()=>Te,getContingentOptions:()=>Li,getDateToUTC:()=>ce,getDateWithTZOffset:()=>Re,getDateWithoutTZOffset:()=>we,getEventInfoFromResults:()=>Hi,getExistingFieldNames:()=>gi,getFeatureLayer:()=>Ye,getGDBVersion:()=>ve,getGeometryGraphic:()=>Ae,getHoverGraphic:()=>Oe,getInitialEventInfoState:()=>me,getInitialRouteInfoState:()=>fe,getInitialRouteMeasurePickerInfoState:()=>pe,getIntialLocksInfo:()=>Zo,getLayer:()=>mi,getLocalTimeOffset:()=>Ne,getLrsRequestUrl:()=>Bi,getMapAllLayers:()=>qi,getNetworkFields:()=>yi,getNetworkInfoFromResults:()=>Wi,getNetworkOutFields:()=>ie,getPolylineMidPoint:()=>Pi,getRouteFromEndMeasures:()=>oe,getSimpleLineGraphic:()=>_e,getSimplePointGraphic:()=>Ve,getSuggestions:()=>ue,getUUID:()=>mt,getUniqueUrls:()=>zi,getUserSession:()=>he,getVersionGuid:()=>Yo,highlightColor:()=>Ee,isCodedDomain:()=>ct,isConflictPreventionEnabled:()=>oi,isDate:()=>lt,isDefaultVersion:()=>ye,isDefined:()=>re,isInWidgetController:()=>Fe,isNumber:()=>ut,isParentNetworkAvailable:()=>Ki,isRangeDomain:()=>dt,isWithinTolerance:()=>ge,messages:()=>Y,normalizeFieldName:()=>Di,queryAllRoutesByLineId:()=>se,queryEventsByEventObjectIds:()=>qe,queryEventsByRouteIdOrEventObjectId:()=>Ge,queryLineId:()=>ze,queryRouteId:()=>Xe,queryRouteIdOrName:()=>le,queryRouteIds:()=>et,queryRoutes:()=>Be,queryRoutesByLineId:()=>ae,releaseLock:()=>Ko,removeLabelLayer:()=>Ai,requestService:()=>$e,resolveFieldName:()=>vi,setContingentValues:()=>Ti,setRouteInfoByRouteIdOrName:()=>$i,shouldQueryRouteLock:()=>Xo,shouldTryAcquireLock:()=>ei,tryAutoReconcile:()=>Jo,tryReleaseLock:()=>Qo,tryReleaseLockOnDefault:()=>Ho,validateContingencyConstraints:()=>Ri,validateField:()=>at,validateRangeDomain:()=>st});var e={};c.r(e),c.d(e,{AttributeTable:()=>r});var t=c(1888),n=c(79244);const r=()=>n.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .calcite-attribute-table {
      width: 100%;
      flex: 1 1 auto;
      max-height: 87vh;
      overflow: auto;
      height: 100%
    }
    .table-container {
      overflow-x: hidden;
    }
    .calcite-table {
      width: 100%;
    }
    .cell-error {
      border-left: 6px solid red;
    }

  `;var o=c(62686);const i="object"==typeof global&&global&&global.Object===Object&&global;var a="object"==typeof self&&self&&self.Object===Object&&self;const s=i||a||Function("return this")();var l=/\s/;const u=function(e){for(var t=e.length;t--&&l.test(e.charAt(t)););return t};var f=/^\s+/;const m=function(e){return e?e.slice(0,u(e)+1).replace(f,""):e};const p=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const h=s.Symbol;var v=Object.prototype,y=v.hasOwnProperty,g=v.toString,b=h?h.toStringTag:void 0;const I=function(e){var t=y.call(e,b),n=e[b];try{e[b]=void 0;var r=!0}catch(e){}var o=g.call(e);return r&&(t?e[b]=n:delete e[b]),o};var N=Object.prototype.toString;const S=function(e){return N.call(e)};var w=h?h.toStringTag:void 0;const R=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":w&&w in Object(e)?I(e):S(e)};const F=function(e){return null!=e&&"object"==typeof e};const k=function(e){return"symbol"==typeof e||F(e)&&"[object Symbol]"==R(e)};var x=/^[-+]0x[0-9a-f]+$/i,T=/^0b[01]+$/i,D=/^0o[0-7]+$/i,E=parseInt;const L=function(e){if("number"==typeof e)return e;if(k(e))return NaN;if(p(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=p(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=m(e);var n=T.test(e);return n||D.test(e)?E(e.slice(2),n?2:8):x.test(e)?NaN:+e};var M=1/0;const j=function(e){return e?(e=L(e))===M||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const A=function(e){var t=j(e),n=t%1;return t==t?n?t-n:t:0};const O=function(e,t){for(var n=-1,r=null==e?0:e.length,o=Array(r);++n<r;)o[n]=t(e[n],n,e);return o};const P=Array.isArray;var C=h?h.prototype:void 0,V=C?C.toString:void 0;const _=function e(t){if("string"==typeof t)return t;if(P(t))return O(t,e)+"";if(k(t))return V?V.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const U=function(e){return null==e?"":_(e)};var $=s.isFinite,G=Math.min;const q=function(e){var t=Math[e];return function(e,n){if(e=L(e),(n=null==n?0:G(A(n),292))&&$(e)){var r=(U(e)+"e").split("e"),o=t(r[0]+"e"+(+r[1]+n));return+((r=(U(o)+"e").split("e"))[0]+"e"+(+r[1]-n))}return t(e)}}("round");var B=c(99037),z=c(14321),W=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};var H;function Q(e,t,r){return W(this,void 0,void 0,(function*(){const o={jimuName:e,type:n.JimuFieldType.String,esriType:H.String,name:e,alias:e,format:null};return function(e,t,r){return W(this,void 0,void 0,(function*(){const o={searchText:e,searchFields:r.map((e=>e.name)),dataSource:t,maxSuggestions:1e3};return n.dataSourceUtils.querySuggestions(o).then((e=>{const t={suggestionItem:null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{isFromSuggestion:!0}))),layer:null,icon:null};return Promise.resolve(t)})).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,r,[o])}))}!function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(H||(H={}));const K={eventRequiredLabel:"Event *",networkRequiredLabel:"Network *",routeIdRequiredLabel:"Route ID *",routeNameRequiredLabel:"Route Name *",startDateRequiredLabel:"Start Date *",nullLabel:"null",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",fieldInfoWithError:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}\nError: {error}",fieldTypeWithLength:"{fieldType} ({length})",attributeError:"{fieldValue}: {message}",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Value exceeds maximum length of field",invalidDate:"Invalid date.",invalidRange:"Value exceeds min or max values of range.",contingentValueError:"Invalid contingent value in the field",selectRouteLabel:"Select Route",routePicker:"Route Picker",routeNameLabel:"Route Name",routeIdLabel:"Route ID",fromRouteNameLabel:"From Route Name",fromRouteIdLabel:"From Route ID",toRouteNameLabel:"To Route Name",toRouteIdLabel:"To Route ID",fromDateLabel:"From Date",toDateLabel:"To Date",measureLabel:"Measure",fromMeasureLabel:"From Measure",toMeasureLabel:"To Measure",noResult:"No Results",copyAttributes:"Copy Attributes",noLrsLayersTips:"No LRS layers are present in the selected map. Select a map with LRS Network and Event layers present in the webmap.",multipleServicesTips:"Map contains layers from more than one feature service. Select a map with LRS Network and Event layers coming from a single feature service.",noNetworkLayersTips:"No LRS Network layers are present in the selected map. Select a map with at least one LRS network layer present in the web map.",noMapSelectedTips:"Select a map.",displaySettings:"Display Settings",hideNetwork:"Hide Network",hideEvent:"Hide Event",hideMethod:"Hide Method",hideRoute:"Hide Route in Search by Line",hideType:"Hide Type",hideAttributeSet:"Hide Attribute Set",hideMeasures:"Hide Measures",hideDates:"Hide Dates",useRoutesStartEndDates:"Use Routes Start and End Dates",useRoutesStartEndDatesTooltip:"Routes start/end dates will be used for new events. If disabled, the current date will be used.",selectMap:"Select Map",loadLayers:"Load layers",clearLayers:"Clear layers",removeLayer:"Remove",missingParentNetwork:"Parent network is missing",inches:"Inches (US Survey)",feet:"Feet (US Survey)",yards:"Yards (US Survey)",miles:"Miles (US Survey)",nauticalMiles:"Nautical miles (US Survey)",points:"Points",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal degrees",decimeters:"Decimeters",intFeet:"Feet (International)",intMiles:"Statute miles",esriUnknownUnits:"esriUnknownUnits",invalidRouteField:"Route could not be found with provided value",CannotAcquireLockUserAndVersion:"Cannot acquire lock because {user} has the lock in version {version}.",UnavailableLockOnLine:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnRoute:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnLineWithoutVersion:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",UnavailableLockOnRouteWithoutVersion:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",YouAcquiredLockOnLine:"You have acquired a lock on line {nameOrId} ({networkName}) in version {version}.",YouAcquiredLockOnRoute:"You have acquired a lock on route {nameOrId} ({networkName}) in version {version}.",ReconcileRequired:"The default version has changed. Reconcile this version with the default version in order to acquire locks."};var J=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const Y=Object.assign({},K,z.defaultMessages);function Z(e,t,n){return e.formatMessage({id:t,defaultMessage:Y[t]},n)}const X=(e,t,n)=>{if(isNaN(e)||!t||!n||t===n)return e;const r={esriMeters:1,esriDecimalDegrees:899928005759e-17,esriNauticalMiles:.00053995680345572,esriIntNauticalMiles:.00053959318990227,esriMiles:.00062136994949496,esriIntMiles:.00062137119223733,esriKilometers:.001,esriYards:1.093611111115486,esriIntYards:1.093613298337708,esriFeet:3.280833333346457,esriIntFeet:3.280839895013123,esriDecimeters:10,esriInches:39.370078740157,esriIntInches:39.37007874015748,esriCentimeters:100,esriMillimeters:1e3,esriPoints:2834.645669291964};return t in r&&n in r?r[n]/r[t]*e:e};function ee(e){switch(e){case"esriFeet":case"esriIntFeet":return"esriSRUnit_Foot";case"esriMiles":case"esriIntMiles":return"esriSRUnit_StatuteMile";case"esriNauticalMiles":return"esriSRUnit_USNauticalMile";case"esriIntNauticalMiles":return"esriSRUnit_NauticalMile";case"esriMeters":return"esriSRUnit_Meter";case"esriKilometers":return"esriSRUnit_Kilometer"}}function te(e,t){switch(e){case"esriInches":return Z(t,"inches");case"esriPoints":return Z(t,"points");case"esriFeet":return Z(t,"feet");case"esriYards":return Z(t,"yards");case"esriMiles":return Z(t,"miles");case"esriNauticalMiles":return Z(t,"nauticalMiles");case"esriMillimeters":return Z(t,"millimeters");case"esriCentimeters":return Z(t,"centimeters");case"esriMeters":return Z(t,"meters");case"esriKilometers":return Z(t,"kilometers");case"esriDecimalDegrees":return Z(t,"decimalDegrees");case"esriDecimeters":return Z(t,"decimeters");case"esriIntFeet":return Z(t,"intFeet");case"esriIntMiles":return Z(t,"intMiles");default:return Z(t,"esriUnknownUnits")}}function ne(e,t){switch(e){case Z(t,"inches"):return"esriInches";case Z(t,"points"):return"esriPoints";case Z(t,"feet"):return"esriFeet";case Z(t,"yards"):return"esriYards";case Z(t,"miles"):return"esriMiles";case Z(t,"nauticalMiles"):return"esriNauticalMiles";case Z(t,"millimeters"):return"esriMillimeters";case Z(t,"centimeters"):return"esriCentimeters";case Z(t,"meters"):return"esriMeters";case Z(t,"kilometers"):return"esriKilometers";case Z(t,"decimalDegrees"):return"esriDecimalDegrees";case Z(t,"decimeters"):return"esriDecimeters";case Z(t,"intFeet"):return"esriIntFeet";case Z(t,"intMiles"):return"esriIntMiles";default:return"unknownUnits"}}function re(e){return null!=e}const oe=e=>{var t;if(re(e)){const n=e;if((null===(t=n.paths)||void 0===t?void 0:t.length)>0){const e=n.getPoint(0,0),t=n.paths[n.paths.length-1].length-1;return[e,n.getPoint(n.paths.length-1,t)]}}return[null,null]},ie=e=>{const t={routeIdFieldName:"",routeNameFieldName:"",fromDateFieldName:"",toDateFieldName:"",lineIdFieldName:"",lineNameFieldName:"",lineOrderFieldName:""};return re(e)&&(t.routeIdFieldName=e.routeIdFieldSchema.name,t.routeNameFieldName=e.useRouteName?e.routeNameFieldSchema.name:"",t.fromDateFieldName=e.fromDateFieldSchema.name,t.toDateFieldName=e.toDateFieldSchema.name,t.lineIdFieldName=re(e.lineIdFieldSchema)?e.lineIdFieldSchema.name:"",t.lineNameFieldName=re(e.lineNameFieldSchema)?e.lineNameFieldSchema.name:"",t.lineOrderFieldName=re(e.lineOrderFieldSchema)?e.lineOrderFieldSchema.name:""),t},ae=(e,t,n,r)=>{if(!(re(n)&&re(r)&&e.length&&t.length))return Promise.reject(new Error(null));const o=r.layer,i=o.createQuery();let a;a=(n.useRouteName,e.map((e=>`${n.routeNameFieldSchema.name} = '${e}'`)));const s=a.join(" OR "),l=`${n.lineIdFieldSchema.name} = '${t}' AND (${s})`,u=ie(n);return i.returnM=!0,i.outFields=[u.routeIdFieldName,u.fromDateFieldName,u.toDateFieldName],n.useRouteName&&i.outFields.push(u.routeNameFieldName),i.where=l,o.queryFeatures(i).then((e=>e)).catch((e=>Promise.reject(new Error(null))))},se=(e,t,n)=>{if(!re(t)||!re(n))return Promise.reject(new Error(null));const r=n.layer,o=r.createQuery(),i=`${t.lineIdFieldSchema.name} = '${e}'`,a=ie(t);return o.returnM=!0,o.outFields=[a.routeIdFieldName,a.fromDateFieldName,a.toDateFieldName,a.lineOrderFieldName],t.useRouteName&&o.outFields.push(a.routeNameFieldName),o.where=i,r.queryFeatures(o).then((e=>e)).catch((e=>Promise.reject(new Error(null))))},le=(e,t,n,...r)=>J(void 0,[e,t,n,...r],void 0,(function*(e,t,n,r=!1,o=!0,i="",a=null,s=!1){if(!re(t)||!re(n)||!e.length)return Promise.reject(new Error(null));const l=n,u=(null==l?void 0:l.layer)||(yield l.createJSAPILayerByDataSource());let c;if(c=!t.useRouteName||s?`${t.routeIdFieldSchema.name} = '${e}'`:`${t.routeNameFieldSchema.name} = '${e}'`,re(a)){const e=`TIMESTAMP '${a.toISOString().slice(0,10)}'`;c=`${c} AND ${t.fromDateFieldSchema.name} <= ${e} AND (${t.toDateFieldSchema.name} >= ${e} OR ${t.toDateFieldSchema.name} IS NULL)`}let d=c;r&&!o&&re(i)&&(d=`${t.lineIdFieldSchema.name} = '${i}' AND (${c})`);const f=u.createQuery();f.where=d;const m=ie(t);return f.returnGeometry=!0,f.returnM=!0,f.outFields=[m.routeIdFieldName,m.fromDateFieldName,m.toDateFieldName],t.useRouteName&&f.outFields.push(m.routeNameFieldName),t.supportsLines&&(f.outFields.push(m.lineIdFieldName),f.outFields.push(m.lineNameFieldName),f.outFields.push(m.lineOrderFieldName)),u.queryFeatures(f).then((t=>0===t.features.length&&e.length>0?Promise.reject(new Error(null)):t)).catch((e=>Promise.reject(new Error(null))))})),ue=(e,t,n)=>{const r=[],o=Q(e,t,n);return r.push(o),Promise.all(r)},ce=e=>{const t=new Date(e);return re(t)?Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0,0,0):null};function de(e){if(null!=e&&/^-?\d+\+\d{2}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),n=e.split("+");let r=100*parseInt(n[0],10);return isNaN(r)?r=NaN:2===n.length&&(t?r-=parseFloat(n[1]):r+=parseFloat(n[1])),r}if(null!=e&&/^-?\d+\+\d{3}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),n=e.split("+");let r=1e3*parseInt(n[0],10);return isNaN(r)?r=NaN:2===n.length&&(t?r-=parseFloat(n[1]):r+=parseFloat(n[1])),r}return NaN}function fe(){return{routeId:"",toRouteId:"",lineId:"",toLineId:"",lineName:"",toLineName:"",routeLineOrder:NaN,toRouteLineOrder:NaN,routeName:"",toRouteName:"",fromMeasure:NaN,toMeasure:NaN,toRouteFromMeasure:NaN,toRouteToMeasure:NaN,fromDate:new Date(Date.now()),toRouteFromDate:new Date(Date.now()),toDate:null,toRouteToDate:null,selectedMeasure:NaN,selectedToMeasure:NaN,selectedFromDate:new Date(Date.now()),selectedToDate:null,selectedPoint:null,selectedToPoint:null,selectedPolyline:null,selectedToPolyline:null,validRoute:!1,validToRoute:!1}}function me(){return{eventUrl:"",fromDateFieldName:"",toDateFieldName:"",derivedFromMeasureFieldName:"",derivedRouteIdFieldName:"",derivedRouteNameFieldName:"",derivedToMeasureFieldName:"",fromReferentLocationFieldName:"",fromReferentMethodFieldName:"",fromReferentOffsetFieldName:"",toReferentLocationFieldName:"",toReferentMethodFieldName:"",toReferentOffsetFieldName:"",locErrorFieldName:"",eventIdFieldName:"",routeIdFieldName:"",routeNameFieldName:"",fromMeasureFieldName:"",toRouteIdFieldName:"",toRouteNameFieldName:"",toMeasureFieldName:"",lrsFields:null,attributeFields:null,parentNetworkId:NaN,useRouteName:!1,isPointEvent:!1,canSpanRoutes:!1,mergeCoincident:!1,retireOverlapping:!1,datasetName:""}}function pe(){return{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1}}function he(e){return n.SessionManager.getInstance().getSessionByUrl(e)}function ve(e){return e.getGDBVersion()||"sde.DEFAULT"}function ye(e){return"sde.default"===e.toLocaleLowerCase()||""===e}function ge(e,t,n){return!isNaN(e)&&!isNaN(t)&&!isNaN(n)&&Math.abs(e-t)<=n}function be(e,t,n){return function(e,t,n){return function(e,t,n,r){return n=Math.abs(n),r?e>t+n:e>=t-n}(e,t,n,!1)}(t,e[0],n)&&function(e,t,n){return function(e,t,n,r){return n=Math.abs(n),r?e<t-n:e<=t+n}(e,t,n,!1)}(t,e[1],n)}const Ie=(e,t)=>{re(t)&&(e.add(t),setTimeout((()=>{e.removeAll(),setTimeout((()=>{e.add(t),setTimeout((()=>{e.removeAll(),setTimeout((()=>{e.add(t),setTimeout((()=>{e.removeAll()}),800)}),800)}),800)}),800)}),800))};function Ne(e){const t=(new Date).getTimezoneOffset();return(t<0?1:-1)*(t<0?Math.abs(t)/60:t/60)*60*60*1e3+function(e){const t=Se(new Date(Date.now())),n=Se(e);return t&&!n?-36e5:!t&&n?36e5:0}(e)}function Se(e){const t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1),r=Math.max(t.getTimezoneOffset(),n.getTimezoneOffset());return e.getTimezoneOffset()<r}function we(e,t){if(!re(e)||!re(new Date(e)))return null;const r=t.getTimezone();if(r.includes("/")||"device"===r)return new Date(n.dataSourceUtils.getDateFieldValueWithoutTzOffset(e,t));{const t=Ne(new Date(e));return new Date(e+t)}}function Re(e,t){if(!re(e)||!re(new Date(e)))return null;const r=t.getTimezone();if(r.includes("/")||"device"===r)return new Date(n.dataSourceUtils.getDateFieldValue(e,t));{const t=Ne(new Date(e));return new Date(e-t)}}function Fe(e){let t=document.getElementById(e);for(;t&&!t.classList.contains("floating-panel");)if(t=t.parentElement,t&&t.classList.contains("floating-panel"))return!0;for(t=document.getElementById(e);t&&!t.classList.contains("panel-content");)if(t=t.parentElement,t&&t.classList.contains("panel-content"))return!0;return!1}function ke(){return n.css`
    --calcite-color-brand: var(--sys-color-primary-main);
    --calcite-color-brand-press: var(--sys-color-primary-dark);
    --calcite-color-brand-hover: var(--sys-color-primary-light);
    --calcite-color-text-inverse: var(--sys-color-primary-text)};
  `}function xe(){return n.css`
    --calcite-ui-icon-color: var(--ref-palette-neutral-1200);
    --calcite-color-brand: var(--sys-color-primary-main);
    --calcite-color-brand-press: var(--sys-color-primary-dark);
    --calcite-color-brand-hover: var(--sys-color-primary-light);
    --calcite-color-text-inverse: var(--sys-color-primary-text)};
  `}function Te(e){return n.css`
      --calcite-color-foreground-1: ${e.sys.color.surface.paper};
      --calcite-color-brand: ${e.sys.color.primary.main};
      --calcite-color-status-warning: ${e.sys.color.error.main};
      --calcite-color-text-3: ${e.sys.color.primary.text};
      --calcite-color-transparent-hover: ${e.sys.color.primary.light};
      --calcite-color-transparent-pressed: ${e.sys.color.primary.dark};
      --calcite-color-status-success: ${e.sys.color.success.main};
    `}const De=1e4,Ee="#00FFFF",Le="#000000",Me="#00FFFF";var je=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const Ae=(e,t,n,r)=>je(void 0,void 0,void 0,(function*(){var o;switch(t||(t=Ee),null===(o=null==e?void 0:e.geometry)||void 0===o?void 0:o.type){case"point":return yield Pe(e,t,n).then((e=>e));case"polyline":return yield Ce(e,t,n,r).then((e=>e));default:return null}})),Oe=e=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;const r={type:"simple-marker",style:"circle",size:6,color:Le};return new n({geometry:e.geometry,symbol:r,attributes:e.attributes})})),Pe=(e,t,n=3)=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((r=>{let o=null;[o]=r;const i={type:"simple-marker",style:"circle",width:n,color:t||Ee,outline:{color:Le,width:1}};return new o({geometry:e.geometry,symbol:i,attributes:e.attributes})})),Ce=(e,t,n=9,r=!1)=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((o=>{let i=null;[i]=o;let a={};a=r?{type:"simple-line",color:t||Ee,width:n,style:"solid",marker:{color:t||Ee,style:"arrow",placement:"end"},outline:{color:Le,width:1}}:{type:"simple-line",color:t||Ee,width:n,style:"solid",outline:{color:Le,width:1}};return new i({geometry:e.geometry,symbol:a,attributes:e.attributes})})),Ve=e=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;return new n({geometry:e,symbol:null,attributes:[]})})),_e=e=>(0,o.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;return new n({geometry:e,symbol:null,attributes:[]})}));var Ue=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function $e(e){return Ue(this,void 0,void 0,(function*(){return new Promise((function(t,r){const o={params:e.params,httpMethod:e.method};n.esri.restRequest.request(e.url,o).then((e=>{t(e)})).catch((e=>{t(e)}))}))}))}function Ge(e,t,r,o,i,a){return Ue(this,void 0,void 0,(function*(){var s,l,u,c,d,f;const m=o.routeId,p=[];if(!re(o.selectedPoint)&&!re(a))return p;const h=null!==(l=null===(s=t.getTimeInfo())||void 0===s?void 0:s.timeExtent)&&void 0!==l?l:0,v=r.eventInfo.eventUrl.replace("/exts/LRServer/eventLayers",""),y=`${v}/query`,g=yield n.SessionManager.getInstance().getSessionByUrl(v).getToken(v);let b,I,N,S,w=t.getGDBVersion();if(w||(w=""),re(o.selectedPoint)){N=o.selectedPoint.toJSON?o.selectedPoint.toJSON():o.selectedPoint,S=o.distance>e?o.distance:"";let t="";if(r.eventInfo.canSpanRoutes)i.length>0&&(t=`${null===(u=r.eventInfo)||void 0===u?void 0:u.routeIdFieldName} IN ('${i.join("','")}')`);else{if(!(m&&m.length>0))return p;t=`${null===(c=r.eventInfo)||void 0===c?void 0:c.routeIdFieldName} = '${m}'`}if(re(o.fromDate)){if(o.fromDate){const e=`TIMESTAMP '${o.fromDate.toISOString().slice(0,10)}'`;t.length>0&&(t+=" AND "),t+=`${e} <= ${r.eventInfo.fromDateFieldName}`}if(o.toDate){const e=`TIMESTAMP '${o.toDate.toISOString().slice(0,10)}'`;t.length>0&&(t+=" AND "),t+=`${e} > ${r.eventInfo.fromDateFieldName}`}}I=t}else b=[a];let R=null===(f=null===(d=t.layerDefinition)||void 0===d?void 0:d.geometryProperties)||void 0===f?void 0:f.units;R&&(R=ee(R));const F={f:"json",token:g,returnGeometry:!1,time:h,gdbVersion:w,outSR:102100,objectIds:b,where:I,outFields:"*",spatialRel:"esriSpatialRelIntersects",geometryType:"esriGeometryPoint",geometry:N,distance:S,units:R};return $e({method:"GET",url:y,params:F}).then((e=>Ue(this,void 0,void 0,(function*(){var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features:(F.distance=.2,F.units="esriSRUnit_Meter",$e({method:"GET",url:y,params:F}).then((e=>{var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features:p})).catch((e=>p)))})))).catch((e=>p))}))}function qe(e,t){return Ue(this,void 0,void 0,(function*(){const n=[],r=null==e?void 0:e.layer,o=r.createQuery();return t.length>0?(o.objectIds=t,r.queryFeatures(o).then((e=>e&&e.features.length>0?e.features:n)).catch((e=>n))):n}))}function Be(e,t,n){return Ue(this,void 0,void 0,(function*(){var r,o;const i=[];let a="";n.routeId.length>0?a=`${t.routeIdFieldSchema.jimuName} = '${n.routeId}'`:n.routeName.length>0&&(a=`${t.routeNameFieldSchema.jimuName} = '${n.routeName}'`);const s={returnGeometry:!0,returnM:!0,returnZ:!0,where:a,orderByFields:[],time:null!==(o=null===(r=e.getTimeInfo())||void 0===r?void 0:r.timeExtent)&&void 0!==o?o:0};return e.query(s).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i})).catch((e=>i))}))}function ze(e,t,n){return Ue(this,void 0,void 0,(function*(){var r,o;const i=[];let a="";if(!(n.length>0))return i;a=`${t.lineIdFieldSchema.jimuName} = '${n}'`;const s={where:a,time:null!==(o=null===(r=e.getTimeInfo())||void 0===r?void 0:r.timeExtent)&&void 0!==o?o:0,outFields:[t.routeIdFieldSchema.name],notAddFieldsToClient:!0};return e.query(s).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i})).catch((e=>i))}))}function We(e,t,r,o,i){return Ue(this,void 0,void 0,(function*(){const a=[];if(!re(r)&&r.length)return a;const s=t.networkUrl,l=`${s}/geometryToMeasure`,u=yield n.SessionManager.getInstance().getSessionByUrl(s).getToken(s),c=[];r.forEach((e=>{c.push({routeId:i,geometry:{x:e.x,y:e.y}})}));let d=e.getGDBVersion();d||(d="");return $e({method:"GET",url:l,params:{f:"json",token:u,locations:c,tolerance:10,temporalViewDate:re(o)&&0!==o.valueOf()?o:"",inSR:r[0].spatialReference.wkid,gdbVersion:d}}).then((e=>Ue(this,void 0,void 0,(function*(){return e&&e.locations?(e.locations.forEach((e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.length)>0&&e.results.forEach((e=>{a.push(e.measure)}))})),a):a}))))}))}function He(e,t,r,o,i){return Ue(this,void 0,void 0,(function*(){const a=[];if(!re(r)&&r.length)return a;const s=t.networkUrl,l=`${s}/geometryToMeasure`,u=yield n.SessionManager.getInstance().getSessionByUrl(s).getToken(s),c=[];r.forEach((e=>{c.push({routeId:i,geometry:{x:e.x,y:e.y}})}));let d=e.getGDBVersion();d||(d="");return $e({method:"GET",url:l,params:{f:"json",token:u,locations:c,tolerance:10,temporalViewDate:re(o)&&0!==o.valueOf()?o:"",inSR:r[0].spatialReference.wkid,gdbVersion:d}}).then((e=>Ue(this,void 0,void 0,(function*(){return e&&e.locations?(e.locations.forEach((e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.length)>0&&e.results.forEach((e=>{a.push({measure:e.measure,distance:e.distance})}))})),a):a}))))}))}function Qe(e,t,r,o,i){return Ue(this,void 0,void 0,(function*(){if(!r.length)return null;const a=t.networkUrl,s=`${a}/measureToGeometry`,l=yield n.SessionManager.getInstance().getSessionByUrl(a).getToken(a),u=[];u.push({routeId:r,measure:i});let c=e.getGDBVersion();c||(c="");return $e({method:"GET",url:s,params:{f:"json",token:l,locations:u,temporalViewDate:re(o)&&0!==o.valueOf()?o:"",gdbVersion:c}}).then((e=>Ue(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[t,r]=e})).then((()=>{let n=null;return e.locations.forEach((o=>{if("esriGeometryPoint"===o.geometryType&&null!=o.geometry){const i=new r({wkid:e.spatialReference.wkid,wkt:e.spatialReference.wkt});n=new t(o.geometry),n.spatialReference=i}})),n}))}))))}))}function Ke(e,t,r,o,i){return Ue(this,void 0,void 0,(function*(){if(!r.length)return null;const a=t.networkUrl,s=`${a}/measureToGeometry`,l=yield n.SessionManager.getInstance().getSessionByUrl(a).getToken(a),u=[];u.push({routeId:r,measure:i});let c=e.getGDBVersion();c||(c="");return $e({method:"GET",url:s,params:{f:"json",token:l,locations:u,temporalViewDate:re(o)&&0!==o.valueOf()?o:"",gdbVersion:c,outSR:102100}}).then((e=>Ue(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[t,r]=e})).then((()=>{let n=null;return e.locations.forEach((o=>{if("esriGeometryPoint"===o.geometryType&&null!=o.geometry){const i=new r({wkid:e.spatialReference.wkid,wkt:e.spatialReference.wkt});n=new t(o.geometry),n.spatialReference=i}})),n}))}))))}))}function Je(e,t,r){return Ue(this,void 0,void 0,(function*(){const o=`${e}/applyEdits`,i=yield n.SessionManager.getInstance().getSessionByUrl(e).getToken(e),a=[];t.edits.forEach((e=>{a.push(e)}));return $e({method:"POST",url:o,params:{f:"json",token:i,gdbVersion:r,edits:a}}).then((e=>Ue(this,void 0,void 0,(function*(){const t={success:!1,editResults:[],code:0,message:"",details:""};return e.hasOwnProperty("success")?(t.success=!0,t.editResults=e.editResults):(t.success=!1,t.code=e.code,t.message=e.message,t.details=e.response.error.details[0]),t}))))}))}function Ye(e){return Ue(this,void 0,void 0,(function*(){return yield(0,n.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]).then((t=>{const[n]=t;let r;if(e.url.includes("MapServer")){let t="";t=e.url.substring(0,e.url.indexOf("MapServer")),t+="FeatureServer/"+e.layerId,r=new n({url:t})}else e.layer?r=e.layer:e.itemId&&(r=new n({portalItem:{id:e.itemId,portal:{url:e.portalUrl}}}));return r.load().then((()=>Ue(this,void 0,void 0,(function*(){return yield Promise.resolve(r)}))))})).catch((e=>(console.warn(e),null)))}))}function Ze(e,t,r,o,i,a,s){return Ue(this,void 0,void 0,(function*(){if(!r.length||!o.length)return null;const l=t.networkUrl,u=`${l}/measureToGeometry`,c=yield n.SessionManager.getInstance().getSessionByUrl(l).getToken(l),d=[];d.push({routeId:r,toRouteId:o,fromMeasure:a,toMeasure:s});let f=e.getGDBVersion();f||(f="");return $e({method:"GET",url:u,params:{f:"json",token:c,locations:d,temporalViewDate:re(i)&&0!==i.valueOf()?i:"",gdbVersion:f}}).then((e=>Ue(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,r=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/geometry/SpatialReference"]).then((e=>{[t,r]=e})).then((()=>{let n=null;return e.locations.forEach((o=>{if("esriGeometryPolyline"===o.geometryType){const i=new r({wkid:e.spatialReference.wkid,wkt:e.spatialReference.wkt});n=new t(o.geometry),n.spatialReference=i}})),n}))}))))}))}const Xe=(e,t,n)=>{if(!re(t)||!re(n)||!e.length)return Promise.reject(new Error(null));const r=ie(t),o=n.layer,i=o.createQuery();return i.where=`${r.routeIdFieldName} = '${e}'`,i.orderByFields=[t.fromDateFieldSchema.name],i.returnM=!0,i.outFields=[r.routeIdFieldName,r.fromDateFieldName,r.toDateFieldName],t.useRouteName&&i.outFields.push(r.routeNameFieldName),t.supportsLines&&(i.outFields.push(r.lineIdFieldName),i.outFields.push(r.lineNameFieldName),i.outFields.push(r.lineOrderFieldName)),o.queryFeatures(i).then((t=>0===t.features.length&&e.length>0?Promise.reject(new Error(null)):t)).catch((e=>Promise.reject(new Error(null))))},et=(e,t,n)=>{if(!re(t)||!re(n)||!e.length||0===e.length)return Promise.reject(new Error(null));const r=ie(t),o=n.layer,i=o.createQuery();return i.where=`${r.routeIdFieldName} IN ('${e.join("','")}')`,i.outFields=[r.routeIdFieldName,r.lineIdFieldName,r.lineOrderFieldName],o.queryFeatures(i).then((t=>0===t.features.length&&e.length>0?Promise.reject(new Error(null)):t)).catch((e=>Promise.reject(new Error(null))))};var tt=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function nt(e){const{type:t,active:r,networkDs:i,network:a,routeInfo:s,disabled:l,jimuMapView:u,hoverGraphic:c,isFrom:d=!1,canSpanRoutes:f=!1,useRouteStartMeasure:m=!1,useRouteEndMeasure:p=!1,onActiveChange:h,onRouteInfoUpdated:v,onMultiRouteSelect:y}=e,g=n.React.useRef(null),b=n.React.useRef(null),[I,N]=n.React.useState(null),S=n.React.useRef(!1),w=n.React.useRef(!1);n.React.useEffect((()=>{if(re(i)&&re(u)){const e=i;re(null==e?void 0:e.layer)&&N(null==e?void 0:e.layer)}}),[u,i]),n.React.useEffect((()=>{r?R():F()}),[r]);const R=()=>{g.current=null==u?void 0:u.view.on("pointer-move",D),b.current=null==u?void 0:u.view.on("pointer-down",E)},F=()=>{re(g.current)&&(g.current.remove(),g.current=null),re(b.current)&&(b.current.remove(),b.current=null),w.current&&(w.current=!1),S.current&&(S.current=!1)},k=()=>{re(c)&&c.removeAll()},x=e=>{k(),re(e)&&c.add(e)},T=e=>{const t=I.spatialReference,n=I.createQuery(),r="degrees"===t.unit?4:Math.max(3*t.metersPerUnit,3);return n.geometry=e,n.units="meters",n.returnGeometry=!0,n.returnM=!0,n.returnZ=!0,n.distance=(null==u?void 0:u.view.resolution)*r,n.spatialRelationship="intersects",n},D=e=>{re(I)&&!S.current&&(0,o.loadArcGISJSAPIModules)(["esri/geometry/operators/proximityOperator","esri/TimeExtent"]).then((n=>{let r=null,o=null;[r,o]=n,S.current=!0;const l=i.getCurrentQueryParams(),c=null==u?void 0:u.view.toMap(e),m=T(c),p=a.lineIdFieldSchema?a.lineIdFieldSchema.name:"",h=f?s.lineId:"";if(m.outFields=f?[p]:[],(null==l?void 0:l.time)&&(m.timeExtent=new o({start:l.time[0],end:l.time[1]})),m.gdbVersion=l.gdbVersion,"route-measure"===t)I.queryFeatures(m).then((e=>{e.features.forEach((e=>tt(this,void 0,void 0,(function*(){const t=e.geometry;if(!f||f&&d){const e=r.getNearestCoordinate(t,c),n=r.getNearestVertex(t,c);return n.distance<3*m.distance&&(e.coordinate=n.coordinate),x(yield Oe(yield Ve(e.coordinate))),S.current=!1,!0}if(f&&!d){if(e.attributes[p]===h){const e=r.getNearestCoordinate(t,c),n=r.getNearestVertex(t,c);return n.distance<3*m.distance&&(e.coordinate=n.coordinate),x(yield Oe(yield Ve(e.coordinate))),S.current=!1,!0}}})))),S.current&&(x(null),S.current=!1)}));else{const e=a.routeIdFieldSchema?a.routeIdFieldSchema.name:"",t=a.fromDateFieldSchema?a.fromDateFieldSchema.name:"",n=a.lineIdFieldSchema?a.lineIdFieldSchema.name:"";m.outFields=f?[e,n,t]:[e,t];const o=d?s.routeId:s.toRouteId;I.queryFeatures(m).then((n=>{n.features.forEach((a=>tt(this,void 0,void 0,(function*(){const l=a.attributes[e],u=Re(a.attributes[t],i).toLocaleDateString(),f=d?s.fromDate.toLocaleDateString():s.toRouteFromDate.toLocaleDateString();if(l===o&&u===f){const e=n.features[0].geometry,t=r.getNearestCoordinate(e,c),o=r.getNearestVertex(e,c);o.distance<3*m.distance&&(t.coordinate=o.coordinate),x(yield Oe(yield Ve(t.coordinate))),S.current=!1}})))),S.current&&(x(null),S.current=!1)}))}}))},E=e=>tt(this,void 0,void 0,(function*(){re(I)&&!w.current&&(e.stopPropagation(),(0,o.loadArcGISJSAPIModules)(["esri/geometry/operators/proximityOperator","esri/TimeExtent"]).then((n=>{let r=null,o=null;[r,o]=n;const l=I.popupEnabled;I.popupEnabled=!1,w.current=!0;const c=null==u?void 0:u.view.toMap(e),g=T(c),b=a.routeNameFieldSchema?a.routeNameFieldSchema.name:"",N=a.routeIdFieldSchema?a.routeIdFieldSchema.name:"",S=a.fromDateFieldSchema.name,R=a.toDateFieldSchema.name,x=a.lineIdFieldSchema?a.lineIdFieldSchema.name:"",D=a.lineNameFieldSchema?a.lineNameFieldSchema.name:"",E=a.lineOrderFieldSchema?a.lineOrderFieldSchema.name:"";g.outFields=[N,S,R],(f||""!==x)&&(g.outFields.push(x),g.outFields.push(D),g.outFields.push(E)),a.useRouteName&&g.outFields.push(b);const L=i.getCurrentQueryParams();(null==L?void 0:L.time)&&(g.timeExtent=new o({start:L.time[0],end:L.time[1]})),g.gdbVersion=L.gdbVersion,!d&&f&&("esriFieldTypeGUID"===a.lineIdFieldSchema.esriType?g.where=`${x} = '${s.lineId}'`:g.where=`${x} LIKE '%${s.lineId}'`);const M=[];I.queryFeatures(g).then((e=>tt(this,void 0,void 0,(function*(){"route-measure"===t?yield Promise.all(e.features.map((e=>tt(this,void 0,void 0,(function*(){const t=e.attributes[N],n=a.useRouteName?e.attributes[b]:"",o=(null==e?void 0:e.attributes[x])||"",l=(null==e?void 0:e.attributes[D])||"",u=(null==e?void 0:e.attributes[E])||"",h=e.attributes[S],v=e.attributes[R],y=oe(e.geometry),I=e.geometry,w=r.getNearestCoordinate(I,c),F=r.getNearestVertex(I,c);F.distance<3*g.distance&&(w.coordinate=F.coordinate),yield We(i,a,y,h,t).then((c=>tt(this,void 0,void 0,(function*(){const g=Math.min(...c),b=Math.max(...c);yield He(i,a,[w.coordinate],h,t).then((c=>{c.forEach((c=>{const N=c.measure;let S=new Date(Date.now());const R=h?Re(h,i):null,F=v?Re(v,i):null;re(F)&&S>F||re(h)&&S<R?S=R:S.setHours(0,0,0,0);let k=new Date(Date.now());re(F)&&k>F?k=F:k.setHours(0,0,0,0),(!re(v)||F>k)&&(k=null);let x=!1;!d||f||s.routeId===t&&s.routeName===n&&s.toRouteId===t&&s.toRouteName===n?d&&f&&!s.validToRoute&&(x=!0):x=!0,d&&o&&s.lineId!==o&&(x=!0);let T=!1;(d&&f&&!s.validToRoute||d&&o&&s.toLineId!==o||d&&!f&&s.routeId===s.toRouteId)&&(T=!0);let D=re(h)?Re(h,i):null,E=re(v)?Re(v,i):null;d&&f&&""!==s.toRouteId&&t!==s.toRouteId&&(D=s.toRouteFromDate,E=s.toRouteToDate);w.coordinate.hasZ=!0;const L={routeId:d?t:s.routeId,toRouteId:d?T?t:s.toRouteId:t,routeName:d?n:s.routeName,toRouteName:d?T?n:s.toRouteName:n,routeLineOrder:d?u:s.routeLineOrder,toRouteLineOrder:d?s.toRouteLineOrder:u,lineId:o,toLineId:o,lineName:l,toLineName:l,fromMeasure:d?q(g,a.measurePrecision):s.fromMeasure,toMeasure:d?q(b,a.measurePrecision):s.toMeasure,toRouteFromMeasure:d?T?q(g,a.measurePrecision):s.toRouteFromMeasure:q(g,a.measurePrecision),toRouteToMeasure:d?T?q(b,a.measurePrecision):s.toRouteToMeasure:q(b,a.measurePrecision),selectedMeasure:d?q(N,a.measurePrecision):s.selectedMeasure,distance:c.distance,selectedToMeasure:d?x?NaN:s.selectedToMeasure:q(N,a.measurePrecision),fromDate:d?re(h)?Re(h,i):null:s.fromDate,toDate:d?re(v)?Re(v,i):null:s.toDate,toRouteFromDate:D,toRouteToDate:E,selectedPoint:d?w.coordinate:s.selectedPoint,isNearestCoordinate:d,selectedToPoint:d?x?null:s.selectedToPoint:w.coordinate,selectedPolyline:e.geometry,selectedToPolyline:d?s.selectedToPolyline:e.geometry,selectedFromDate:d?S:s.selectedFromDate,selectedToDate:d?k:s.selectedToDate,validRoute:!!d||s.validRoute,validToRoute:!d||s.validToRoute};if(d){if(m){L.selectedMeasure=L.fromMeasure;const e=r.getNearestCoordinate(I,y[0]);L.selectedPoint=e.coordinate}if(p&&(!f||L.routeId===L.toRouteId)){const e=r.getNearestCoordinate(I,y[1]);L.selectedToMeasure=L.toRouteToMeasure,L.selectedToPoint=e.coordinate,L.selectedToPolyline=L.selectedPolyline}}else if(p&&f){const e=r.getNearestCoordinate(I,y[1]);L.selectedToMeasure=L.toRouteToMeasure,L.selectedToPoint=e.coordinate}if(d)M.push(L);else{M.find((e=>e.routeId===L.routeId&&e.fromDate===L.fromDate))||M.push(L)}}))}))}))))}))))):yield Promise.all(e.features.map((e=>tt(this,void 0,void 0,(function*(){const t=e.attributes[N],n=e.attributes[S]?Re(e.attributes[S],i):null,o=d?s.routeId:s.toRouteId,l=d?s.fromDate:s.toRouteFromDate;if(t===o&&n.toLocaleDateString()===l.toLocaleDateString()){const t=e.attributes[N],n=a.useRouteName?e.attributes[b]:"",o=e.attributes[S],l=e.attributes[R],u=f?e.attributes[E]:"",m=oe(e.geometry),p=e.geometry,h=r.getNearestCoordinate(p,c),v=r.getNearestCoordinate(p,c);v.distance<3*g.distance&&(h.coordinate=v.coordinate),m.push(h.coordinate),yield We(i,a,m,o,t).then((r=>tt(this,void 0,void 0,(function*(){const c=Math.min(...r),m=Math.max(...r);yield We(i,a,[h.coordinate],o,t).then((r=>{r.forEach((r=>{let p=new Date(Date.now());re(l)&&p>l?p=Re(o,i):p.setHours(0,0,0,0);let v=new Date(Date.now());re(l)&&v>l?v=Re(l,i):v.setHours(0,0,0,0),re(l)||(v=null);let y=re(o)?Re(o,i):null,g=re(l)?Re(l,i):null;d&&f&&""!==s.toRouteId&&t!==s.toRouteId&&(y=s.toRouteFromDate,g=s.toRouteToDate);h.coordinate.hasZ=!0;const b={routeId:d?t:s.routeId,toRouteId:d?s.toRouteId:t,routeName:d?n:s.routeName,toRouteName:d?s.toRouteName:n,lineId:s.lineId,toLineId:s.toLineId,lineName:s.lineName,routeLineOrder:d?u:s.routeLineOrder,toRouteLineOrder:d?s.toRouteLineOrder:u,fromMeasure:d?q(c,a.measurePrecision):s.fromMeasure,toMeasure:d?q(m,a.measurePrecision):s.toMeasure,toRouteFromMeasure:d?s.toRouteFromMeasure:q(c,a.measurePrecision),toRouteToMeasure:d?s.toRouteToMeasure:q(m,a.measurePrecision),selectedMeasure:d?q(r,a.measurePrecision):s.selectedMeasure,selectedToMeasure:d?s.selectedToMeasure:q(r,a.measurePrecision),fromDate:d?re(o)?Re(o,i):null:s.fromDate,toDate:d?re(l)?Re(l,i):null:s.toDate,toRouteFromDate:y,toRouteToDate:g,selectedFromDate:s.selectedFromDate,selectedToDate:s.selectedToDate,selectedPoint:d?h.coordinate:s.selectedPoint,selectedToPoint:d?s.selectedToPoint:h.coordinate,selectedPolyline:e.geometry,selectedToPolyline:d?s.selectedToPolyline:e.geometry,validRoute:!!d||s.validRoute,validToRoute:!d||s.validToRoute};M.push(b)}))}))}))))}})))))})))).then((()=>{M.length>1?y(M):1===M.length&&((e,t=!1)=>{v(e,t),k()})(M[0],!0)})).finally((()=>{l&&(I.popupEnabled=!1),F(),h(),w.current=!1})).catch((()=>{F(),h(),w.current=!1}))})))}));return(0,n.jsx)(B.CalciteButton,{scale:"s",iconStart:"select",css:xe(),disabled:!!l||void 0,appearance:r?"solid":"transparent",kind:r?"brand":"neutral",onClick:()=>{h()}})}var rt=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function ot(e){const t=n.hooks.useTranslation(K),{isOpen:r,routeInfos:o,useRouteName:i,measurePrecision:a,isFrom:s,jimuMapView:l,graphicLayer:u,onRouteSelect:c,onRouteSelectCancel:d}=e,f=16,m=n.React.useRef(null),[p,h]=n.React.useState({x:0,y:0}),[v,y]=n.React.useState({width:500,height:250});n.React.useEffect((()=>{if(o.length){m.current=o[0];const e=w(),t=R();if(y({width:t,height:e}),b(s,0),re(l)&&re(l.view)){const e=s?o[0].selectedPoint:o[0].selectedToPoint;if(re(e)){const t=null==l?void 0:l.view.toScreen(e);if(t){const e=p;e.x=t.x+f,e.y=t.y+f;const n=S(t.x,t.y,null==l?void 0:l.view);n&&(e.x=n.x+f,e.y=n.y+f),h(e)}}}}}),[o]);const g=e=>rt(this,void 0,void 0,(function*(){b(s,e),m.current=o[e]})),b=(e,t)=>rt(this,void 0,void 0,(function*(){if(re(u)){if(u.removeAll(),e&&re(o[t].selectedPolyline)){const e=yield Ae(yield _e(o[t].selectedPolyline),Me,6);u.add(e)}if(!e&&re(o[t].selectedToPolyline)){const e=yield Ae(yield _e(o[t].selectedToPolyline),Me,6);u.add(e)}}})),I=()=>{re(u)&&u.removeAll()},N=()=>{I(),d()},S=(e,t,n)=>{if(!n)return;const r=R(),o=w(),i=e>=0&&t>=0&&e+r<=window.innerWidth&&t+o<=window.innerHeight,a=n.width-e+32,s=n.height-t+32;return i?null:(e+r>window.innerWidth&&(e=window.innerWidth-r-a),t+o>window.innerHeight&&(t=window.innerHeight-o-s),e<0&&(e=0),t<0&&(t=0),{x:e,y:t})},w=n.React.useCallback((()=>{const e=250;return 2===o.length?e:3===o.length?290:4===o.length?330:o.length>=5?370:e}),[o]),R=n.React.useCallback((()=>i?700:500),[i]),F=n.React.useCallback((e=>{h(e)}),[]),k=n.React.useCallback(((e,t)=>{const n=w(),r=R();e.height<=n&&(e.height=n),e.width<=r&&(e.width=r),e.height>370&&(e.height=370),e.width>700&&(e.width=700),y(e),h(t)}),[w,R]);return(0,n.jsx)("div",null,r&&(0,n.jsx)(z.FloatingPanel,{headerTitle:t("selectRouteLabel"),size:v,defaultPosition:p,position:p,disableActivateOverlay:!1,dragBounds:"body",onDrag:F,onResize:k,onLeave:N,onHeaderClose:N},(0,n.jsx)("div",{css:ke()},(null==o?void 0:o.length)&&(0,n.jsx)(B.CalciteTable,{pageSize:5,caption:t("routePicker"),striped:!0,bordered:!0,"selection-mode":"single",scale:"s"},(0,n.jsx)("calcite-table-row",{slot:"table-header"},i&&(0,n.jsx)("calcite-table-header",{heading:t("routeNameLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("routeIdLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("fromDateLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("toDateLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("measureLabel")})),o.map(((e,t)=>(0,n.jsx)(B.CalciteTableRow,{key:t,selected:0===t,onCalciteTableRowSelect:()=>{g(t)}},i&&(0,n.jsx)("calcite-table-cell",{minWidth:200,itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},s?e.routeName:e.toRouteName)),(0,n.jsx)("calcite-table-cell",{minWidth:200,itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},s?e.routeId:e.toRouteId)),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},re(e.fromDate)?e.fromDate.toLocaleDateString():"")),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},re(e.toDate)?e.toDate.toLocaleDateString():"")),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},q(s?e.selectedMeasure:e.selectedToMeasure,a))))))),(0,n.jsx)("div",{className:"pt-1 d-flex justify-content-center"},(0,n.jsx)(z.Button,{className:"mr-2",style:{width:"100px"},type:"secondary",onClick:N},t("cancel")),(0,n.jsx)(z.Button,{className:"ml-2",style:{width:"100px"},type:"primary",onClick:()=>{I(),re(m.current)&&c(m.current)}},t("ok"))))))}const it=function(e){return null===e};function at(e,t,n,r){const o={hasError:!1,message:""};let i=[];if(re(n)){const e=n;i=null==e?void 0:e.layer.fields}else re(r)&&i.push(r);const a=i.find((e=>e.name===t));if(a){if(!re(e)&&a.nullable)return o;if(re(e)||a.nullable||(o.hasError=!0,o.message="nonNullable"),"string"==typeof e&&0===e.length&&a.nullable)return o;"string"!=typeof e||0!==e.length||a.nullable||(o.hasError=!0,o.message="nonNullable"),"small-integer"===a.type?function(e){const t=Number(e);if(!Number.isInteger(t))return!1;if(t<-32768||t>32767)return!1;return!0}(e)||(o.hasError=!0,o.message="invalidShort"):"integer"===a.type?function(e){const t=Number(e);if(!Number.isInteger(t))return!1;if(t<-2147483648||t>2147483647)return!1;return!0}(e)||(o.hasError=!0,o.message="invalidInteger"):"single"===a.type?function(e){const t=Number(e);if(isNaN(t))return!1;return!0}(e)||(o.hasError=!0,o.message="invalidSingle"):"double"===a.type?function(e){const t=Number(e);if(isNaN(t))return!1;return!0}(e)||(o.hasError=!0,o.message="invalidDouble"):"string"===a.type?function(e,t){if(re(e)&&e.length>t)return!1;return!0}(e,a.length)||(o.hasError=!0,o.message="invalidString"):"date"===a.type&&(function(e){return!isNaN(Date.parse(e))}(e)||(o.hasError=!0,o.message="invalidDate"))}return o}function st(e,t,n,r){const o={hasError:!1,message:""};let i=[];if(re(n)){const e=n;i=null==e?void 0:e.layer.fields}else re(r)&&i.push(r);const a=i.find((e=>e.name===t)),s=a.domain;if(re(a)&&re(s)&&"range"===a.domain.type){const t=s;if(a.nullable&&(it(e)||!re(e)||""===e))return o;if("number"==typeof t.minValue&&"number"==typeof t.maxValue){const n=Number(e);isNaN(n)&&(o.hasError=!0,o.message="invalidRange"),(n<t.minValue||n>t.maxValue)&&(o.hasError=!0,o.message="invalidRange")}else if("string"==typeof t.minValue&&"string"==typeof t.maxValue&&"string"==typeof e){const n=new Date(e),r=new Date(t.minValue),i=new Date(t.minValue);(n<r||n>i)&&(o.hasError=!0,o.message="invalidRange")}}return o}function lt(e){return"date"===e}function ut(e){return"small-integer"===e||"big-integer"===e||"integer"===e||"single"===e||"double"===e||"long"===e}function ct(e){return"coded-value"===e}function dt(e){return"range"===e}function ft(){return(65536*(1+Math.random())|0).toString(16).substring(1)}function mt(){return ft()+ft()+"-"+ft()+"-"+ft()+"-"+ft()+"-"+ft()+ft()+ft()}var pt=c(28996),ht=c.n(pt);const vt=n.React.memo((e=>{var t,r;const o=n.hooks.useTranslation(K),{validValues:i,fieldInfo:a,isSubtype:s,eventDS:l,selected:u,onSelectionChange:c,onUpdateItem:d}=e,[f,m]=n.React.useState(a.value),[p,h]=n.React.useState(""),[v,y]=n.React.useState(a.error);n.React.useEffect((()=>{if(re(a)){if(m(a.value),y(a.error),"contingentValueError"===a.error&&y(o("contingentValueError")),re(g.domain)&&ct(g.domain.type))if(re(a.value)){const e=b.codedValues.find((e=>"string"==typeof e.code?e.code.toLowerCase()===a.value.toLowerCase():e.code===a.value));re(e)?(h(R(e.code,e.name)),y("")):(h(a.value),y("Invalid value."))}else h("");if(s){const e=I.find((e=>"string"==typeof e.value?e.value.toLowerCase()===a.value.toLowerCase():e.value===a.value));h(e?R(e.value,e.label):"")}}}),[l,a]);const g=n.React.useMemo((()=>{const e=l,t=(null==e?void 0:e.layer.fields).find((e=>e.name===a.name));return t||(m(t.defaultValue),null)}),[l,a]),b=n.React.useMemo((()=>{if(re(g)&&re(g.domain)&&"coded-value"===g.domain.type){const e=g.domain.codedValues.some((e=>null===e.code&&e.name===o("nullLabel")));return g.nullable&&!e&&g.domain.codedValues.unshift({code:null,name:o("nullLabel")}),g.domain}return null}),[g]),I=n.React.useMemo((()=>{if(s){const e=null==l?void 0:l.layer;if(re(e)&&re(e.subtypes)){const t=e.subtypes.map((e=>({value:e.code,label:e.name})));if(t)return t}const t=null==l?void 0:l.getFieldCodedValueList(g.name);if(t)return t}return[]}),[l,g.name,s]),N=e=>{if(e.target.value!==f){if(m(e.target.value),re(a.value)&&re(g.domain)&&ct(g.domain.type)){const e=b.codedValues.find((e=>"string"==typeof e.code?e.code.toLowerCase()===a.value.toLowerCase():e.code===a.value));e&&h(R(e.code,e.name))}if(s){const t=I.find((e=>"string"==typeof e.value?e.value.toLowerCase()===a.value.toLowerCase():e.value===a.value));t&&h(R(t.value,t.label)),w(e.target.value,v)}else w(e.target.value,"")}},S=e=>{m(e)},w=(e,t)=>{d(e,t,a.index),c(-1)},R=(e,t)=>re(e)?`${e} - ${t}`:t;let F=[];return u&&re(g.domain)&&!s&&ct(g.domain.type)&&(F=(null===(t=null==e?void 0:e.contingentValues)||void 0===t?void 0:t.length)>0?e.contingentValues.map(((e,t)=>{var r;const o=(r=e.code,!(!i||!i.includes(r)))?{}:{color:"#a0a0a0",background:"#d5d5d5"};return(0,n.jsx)("option",{key:t,value:e.code,style:o},R(e.code,e.name))})):null===(r=null==b?void 0:b.codedValues)||void 0===r?void 0:r.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e.code},R(e.code,e.name))))),(0,n.jsx)("div",{className:"attribute-table-field",style:{border:v.length?"1.2px solid red":"none"}},!u&&(0,n.jsx)("div",{onClick:()=>{a.editable&&c(a.index)},style:{borderRight:v.length?"6px solid red":"none",display:"flex",alignItems:"center"}},(0,n.jsx)(z.Label,{size:"sm",className:"w-100",style:{textOverflow:"ellipsis",width:100,marginBottom:0,alignItems:"center",textAlign:"left"}},s||re(g.domain)&&ct(g.domain.type)?re(f)?p:o("nullLabel"):"string"==typeof f&&f.length?f:"number"!=typeof f||isNaN(f)?re(f)&&"date"===g.type?new Date(f).toLocaleDateString():o("nullLabel"):f.toString()),(0,n.jsx)("span",{style:{margin:"0.1rem"}},v.length>0&&(0,n.jsx)(z.Icon,{icon:ht(),size:16,title:v,color:"red"}))),u&&!re(g.domain)&&!s&&!lt(g.type)&&(0,n.jsx)(z.TextInput,{size:"sm",className:"w-100",autoFocus:!0,required:!g.nullable,value:f,type:"text",onChange:e=>{S(e.currentTarget.value)},checkValidityOnAccept:e=>{if(!re(e)||a.value===e||!re(a.value)&&!e.length||a.contingentValError)return a.error.length?{valid:!1,msg:o(a.error)}:{valid:!0};const t=at(e,a.name,l);return t.hasError?(y(o(t.message)),"contingentValueError"===a.error&&y(o("contingentValueError")),w(e,t.message),{valid:!1,msg:o(t.message)}):(y(""),w(e,""),{valid:!0})}}),u&&!re(g.domain)&&!s&&lt(g.type)&&(0,n.jsx)(B.CalciteInputDatePicker,{scale:"s",valueAsDate:re(f)?new Date(f):null,onCalciteInputDatePickerChange:e=>{var t,n;const r=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(a.value===r)return a.error.length?{valid:!1,msg:o(a.error)}:{valid:!0};const i=at(null===(n=e.target)||void 0===n?void 0:n.valueAsDate,a.name,l);return i.hasError?(y(o(i.message)),"contingentValueError"===a.error&&y(o("contingentValueError")),w(r,i.message),{valid:!1,msg:o(i.message)}):(y(""),w(r,""),{valid:!0})},placement:"top",overlayPositioning:"fixed"}),u&&re(g.domain)&&!s&&ct(g.domain.type)&&(0,n.jsx)(z.Select,{size:"sm",className:"w-100",value:f,onChange:e=>{N(e)}},F),u&&s&&(0,n.jsx)(z.Select,{size:"sm",className:"w-100",value:f,onChange:e=>{N(e)}},I.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e.value},R(e.value,e.label))))),u&&re(g.domain)&&dt(g.domain.type)&&(0,n.jsx)(z.TextInput,{size:"sm",className:"w-100",autoFocus:!0,required:!g.nullable,value:f,onChange:e=>{S(e.currentTarget.value)},checkValidityOnAccept:e=>{if(a.value===e)return a.error.length?{valid:!1,msg:o(a.error)}:{valid:!0};const t=st(e,a.name,l);return t.hasError?(y(o(t.message)),"contingentValueError"===a.error&&y(o("contingentValueError")),w(e,t.message),{valid:!1,msg:o(t.message)}):(y(""),w(e,""),{valid:!0})}}))}));const yt=function(){this.__data__=[],this.size=0};const gt=function(e,t){return e===t||e!=e&&t!=t};const bt=function(e,t){for(var n=e.length;n--;)if(gt(e[n][0],t))return n;return-1};var It=Array.prototype.splice;const Nt=function(e){var t=this.__data__,n=bt(t,e);return!(n<0)&&(n==t.length-1?t.pop():It.call(t,n,1),--this.size,!0)};const St=function(e){var t=this.__data__,n=bt(t,e);return n<0?void 0:t[n][1]};const wt=function(e){return bt(this.__data__,e)>-1};const Rt=function(e,t){var n=this.__data__,r=bt(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this};function Ft(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}Ft.prototype.clear=yt,Ft.prototype.delete=Nt,Ft.prototype.get=St,Ft.prototype.has=wt,Ft.prototype.set=Rt;const kt=Ft;const xt=function(){this.__data__=new kt,this.size=0};const Tt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const Dt=function(e){return this.__data__.get(e)};const Et=function(e){return this.__data__.has(e)};const Lt=function(e){if(!p(e))return!1;var t=R(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const Mt=s["__core-js_shared__"];var jt,At=(jt=/[^.]+$/.exec(Mt&&Mt.keys&&Mt.keys.IE_PROTO||""))?"Symbol(src)_1."+jt:"";const Ot=function(e){return!!At&&At in e};var Pt=Function.prototype.toString;const Ct=function(e){if(null!=e){try{return Pt.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Vt=/^\[object .+?Constructor\]$/,_t=Function.prototype,Ut=Object.prototype,$t=_t.toString,Gt=Ut.hasOwnProperty,qt=RegExp("^"+$t.call(Gt).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const Bt=function(e){return!(!p(e)||Ot(e))&&(Lt(e)?qt:Vt).test(Ct(e))};const zt=function(e,t){return null==e?void 0:e[t]};const Wt=function(e,t){var n=zt(e,t);return Bt(n)?n:void 0};const Ht=Wt(s,"Map");const Qt=Wt(Object,"create");const Kt=function(){this.__data__=Qt?Qt(null):{},this.size=0};const Jt=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var Yt=Object.prototype.hasOwnProperty;const Zt=function(e){var t=this.__data__;if(Qt){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Yt.call(t,e)?t[e]:void 0};var Xt=Object.prototype.hasOwnProperty;const en=function(e){var t=this.__data__;return Qt?void 0!==t[e]:Xt.call(t,e)};const tn=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Qt&&void 0===t?"__lodash_hash_undefined__":t,this};function nn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}nn.prototype.clear=Kt,nn.prototype.delete=Jt,nn.prototype.get=Zt,nn.prototype.has=en,nn.prototype.set=tn;const rn=nn;const on=function(){this.size=0,this.__data__={hash:new rn,map:new(Ht||kt),string:new rn}};const an=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const sn=function(e,t){var n=e.__data__;return an(t)?n["string"==typeof t?"string":"hash"]:n.map};const ln=function(e){var t=sn(this,e).delete(e);return this.size-=t?1:0,t};const un=function(e){return sn(this,e).get(e)};const cn=function(e){return sn(this,e).has(e)};const dn=function(e,t){var n=sn(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this};function fn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}fn.prototype.clear=on,fn.prototype.delete=ln,fn.prototype.get=un,fn.prototype.has=cn,fn.prototype.set=dn;const mn=fn;const pn=function(e,t){var n=this.__data__;if(n instanceof kt){var r=n.__data__;if(!Ht||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new mn(r)}return n.set(e,t),this.size=n.size,this};function hn(e){var t=this.__data__=new kt(e);this.size=t.size}hn.prototype.clear=xt,hn.prototype.delete=Tt,hn.prototype.get=Dt,hn.prototype.has=Et,hn.prototype.set=pn;const vn=hn;const yn=function(e,t){for(var n=-1,r=null==e?0:e.length;++n<r&&!1!==t(e[n],n,e););return e};const gn=function(){try{var e=Wt(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const bn=function(e,t,n){"__proto__"==t&&gn?gn(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var In=Object.prototype.hasOwnProperty;const Nn=function(e,t,n){var r=e[t];In.call(e,t)&&gt(r,n)&&(void 0!==n||t in e)||bn(e,t,n)};const Sn=function(e,t,n,r){var o=!n;n||(n={});for(var i=-1,a=t.length;++i<a;){var s=t[i],l=r?r(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),o?bn(n,s,l):Nn(n,s,l)}return n};const wn=function(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r};const Rn=function(e){return F(e)&&"[object Arguments]"==R(e)};var Fn=Object.prototype,kn=Fn.hasOwnProperty,xn=Fn.propertyIsEnumerable,Tn=Rn(function(){return arguments}())?Rn:function(e){return F(e)&&kn.call(e,"callee")&&!xn.call(e,"callee")};const Dn=Tn;const En=function(){return!1};var Ln="object"==typeof exports&&exports&&!exports.nodeType&&exports,Mn=Ln&&"object"==typeof module&&module&&!module.nodeType&&module,jn=Mn&&Mn.exports===Ln?s.Buffer:void 0;const An=(jn?jn.isBuffer:void 0)||En;var On=/^(?:0|[1-9]\d*)$/;const Pn=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&On.test(e))&&e>-1&&e%1==0&&e<t};const Cn=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Vn={};Vn["[object Float32Array]"]=Vn["[object Float64Array]"]=Vn["[object Int8Array]"]=Vn["[object Int16Array]"]=Vn["[object Int32Array]"]=Vn["[object Uint8Array]"]=Vn["[object Uint8ClampedArray]"]=Vn["[object Uint16Array]"]=Vn["[object Uint32Array]"]=!0,Vn["[object Arguments]"]=Vn["[object Array]"]=Vn["[object ArrayBuffer]"]=Vn["[object Boolean]"]=Vn["[object DataView]"]=Vn["[object Date]"]=Vn["[object Error]"]=Vn["[object Function]"]=Vn["[object Map]"]=Vn["[object Number]"]=Vn["[object Object]"]=Vn["[object RegExp]"]=Vn["[object Set]"]=Vn["[object String]"]=Vn["[object WeakMap]"]=!1;const _n=function(e){return F(e)&&Cn(e.length)&&!!Vn[R(e)]};const Un=function(e){return function(t){return e(t)}};var $n="object"==typeof exports&&exports&&!exports.nodeType&&exports,Gn=$n&&"object"==typeof module&&module&&!module.nodeType&&module,qn=Gn&&Gn.exports===$n&&i.process;const Bn=function(){try{var e=Gn&&Gn.require&&Gn.require("util").types;return e||qn&&qn.binding&&qn.binding("util")}catch(e){}}();var zn=Bn&&Bn.isTypedArray;const Wn=zn?Un(zn):_n;var Hn=Object.prototype.hasOwnProperty;const Qn=function(e,t){var n=P(e),r=!n&&Dn(e),o=!n&&!r&&An(e),i=!n&&!r&&!o&&Wn(e),a=n||r||o||i,s=a?wn(e.length,String):[],l=s.length;for(var u in e)!t&&!Hn.call(e,u)||a&&("length"==u||o&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||Pn(u,l))||s.push(u);return s};var Kn=Object.prototype;const Jn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Kn)};const Yn=function(e,t){return function(n){return e(t(n))}};const Zn=Yn(Object.keys,Object);var Xn=Object.prototype.hasOwnProperty;const er=function(e){if(!Jn(e))return Zn(e);var t=[];for(var n in Object(e))Xn.call(e,n)&&"constructor"!=n&&t.push(n);return t};const tr=function(e){return null!=e&&Cn(e.length)&&!Lt(e)};const nr=function(e){return tr(e)?Qn(e):er(e)};const rr=function(e,t){return e&&Sn(t,nr(t),e)};const or=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var ir=Object.prototype.hasOwnProperty;const ar=function(e){if(!p(e))return or(e);var t=Jn(e),n=[];for(var r in e)("constructor"!=r||!t&&ir.call(e,r))&&n.push(r);return n};const sr=function(e){return tr(e)?Qn(e,!0):ar(e)};const lr=function(e,t){return e&&Sn(t,sr(t),e)};var ur="object"==typeof exports&&exports&&!exports.nodeType&&exports,cr=ur&&"object"==typeof module&&module&&!module.nodeType&&module,dr=cr&&cr.exports===ur?s.Buffer:void 0,fr=dr?dr.allocUnsafe:void 0;const mr=function(e,t){if(t)return e.slice();var n=e.length,r=fr?fr(n):new e.constructor(n);return e.copy(r),r};const pr=function(e,t){var n=-1,r=e.length;for(t||(t=Array(r));++n<r;)t[n]=e[n];return t};const hr=function(e,t){for(var n=-1,r=null==e?0:e.length,o=0,i=[];++n<r;){var a=e[n];t(a,n,e)&&(i[o++]=a)}return i};const vr=function(){return[]};var yr=Object.prototype.propertyIsEnumerable,gr=Object.getOwnPropertySymbols;const br=gr?function(e){return null==e?[]:(e=Object(e),hr(gr(e),(function(t){return yr.call(e,t)})))}:vr;const Ir=function(e,t){return Sn(e,br(e),t)};const Nr=function(e,t){for(var n=-1,r=t.length,o=e.length;++n<r;)e[o+n]=t[n];return e};const Sr=Yn(Object.getPrototypeOf,Object);const wr=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)Nr(t,br(e)),e=Sr(e);return t}:vr;const Rr=function(e,t){return Sn(e,wr(e),t)};const Fr=function(e,t,n){var r=t(e);return P(e)?r:Nr(r,n(e))};const kr=function(e){return Fr(e,nr,br)};const xr=function(e){return Fr(e,sr,wr)};const Tr=Wt(s,"DataView");const Dr=Wt(s,"Promise");const Er=Wt(s,"Set");const Lr=Wt(s,"WeakMap");var Mr="[object Map]",jr="[object Promise]",Ar="[object Set]",Or="[object WeakMap]",Pr="[object DataView]",Cr=Ct(Tr),Vr=Ct(Ht),_r=Ct(Dr),Ur=Ct(Er),$r=Ct(Lr),Gr=R;(Tr&&Gr(new Tr(new ArrayBuffer(1)))!=Pr||Ht&&Gr(new Ht)!=Mr||Dr&&Gr(Dr.resolve())!=jr||Er&&Gr(new Er)!=Ar||Lr&&Gr(new Lr)!=Or)&&(Gr=function(e){var t=R(e),n="[object Object]"==t?e.constructor:void 0,r=n?Ct(n):"";if(r)switch(r){case Cr:return Pr;case Vr:return Mr;case _r:return jr;case Ur:return Ar;case $r:return Or}return t});const qr=Gr;var Br=Object.prototype.hasOwnProperty;const zr=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Br.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const Wr=s.Uint8Array;const Hr=function(e){var t=new e.constructor(e.byteLength);return new Wr(t).set(new Wr(e)),t};const Qr=function(e,t){var n=t?Hr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var Kr=/\w*$/;const Jr=function(e){var t=new e.constructor(e.source,Kr.exec(e));return t.lastIndex=e.lastIndex,t};var Yr=h?h.prototype:void 0,Zr=Yr?Yr.valueOf:void 0;const Xr=function(e){return Zr?Object(Zr.call(e)):{}};const eo=function(e,t){var n=t?Hr(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const to=function(e,t,n){var r=e.constructor;switch(t){case"[object ArrayBuffer]":return Hr(e);case"[object Boolean]":case"[object Date]":return new r(+e);case"[object DataView]":return Qr(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return eo(e,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(e);case"[object RegExp]":return Jr(e);case"[object Symbol]":return Xr(e)}};var no=Object.create;const ro=function(){function e(){}return function(t){if(!p(t))return{};if(no)return no(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const oo=function(e){return"function"!=typeof e.constructor||Jn(e)?{}:ro(Sr(e))};const io=function(e){return F(e)&&"[object Map]"==qr(e)};var ao=Bn&&Bn.isMap;const so=ao?Un(ao):io;const lo=function(e){return F(e)&&"[object Set]"==qr(e)};var uo=Bn&&Bn.isSet;const co=uo?Un(uo):lo;var fo="[object Arguments]",mo="[object Function]",po="[object Object]",ho={};ho[fo]=ho["[object Array]"]=ho["[object ArrayBuffer]"]=ho["[object DataView]"]=ho["[object Boolean]"]=ho["[object Date]"]=ho["[object Float32Array]"]=ho["[object Float64Array]"]=ho["[object Int8Array]"]=ho["[object Int16Array]"]=ho["[object Int32Array]"]=ho["[object Map]"]=ho["[object Number]"]=ho[po]=ho["[object RegExp]"]=ho["[object Set]"]=ho["[object String]"]=ho["[object Symbol]"]=ho["[object Uint8Array]"]=ho["[object Uint8ClampedArray]"]=ho["[object Uint16Array]"]=ho["[object Uint32Array]"]=!0,ho["[object Error]"]=ho[mo]=ho["[object WeakMap]"]=!1;const vo=function e(t,n,r,o,i,a){var s,l=1&n,u=2&n,c=4&n;if(r&&(s=i?r(t,o,i,a):r(t)),void 0!==s)return s;if(!p(t))return t;var d=P(t);if(d){if(s=zr(t),!l)return pr(t,s)}else{var f=qr(t),m=f==mo||"[object GeneratorFunction]"==f;if(An(t))return mr(t,l);if(f==po||f==fo||m&&!i){if(s=u||m?{}:oo(t),!l)return u?Rr(t,lr(s,t)):Ir(t,rr(s,t))}else{if(!ho[f])return i?t:{};s=to(t,f,l)}}a||(a=new vn);var h=a.get(t);if(h)return h;a.set(t,s),co(t)?t.forEach((function(o){s.add(e(o,n,r,o,t,a))})):so(t)&&t.forEach((function(o,i){s.set(i,e(o,n,r,i,t,a))}));var v=d?void 0:(c?u?xr:kr:u?sr:nr)(t);return yn(v||t,(function(o,i){v&&(o=t[i=o]),Nn(s,i,e(o,n,r,i,t,a))})),s};const yo=function(e){return vo(e,5)};var go=c(47626),bo=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};const Io=c(8547),No=n.React.memo((e=>{const t=n.hooks.useTranslation(K),{tableIndex:r,eventDS:o,eventLayer:i,fieldInfos:a,useAlias:s,collapable:l,isExpanded:u,onItemChecked:c,onUpdateItem:d,onUpdateAll:f,onFieldGrpUpdated:m,tableLabel:p,isReset:h}=e,[v,y]=n.React.useState(!1),[g,b]=n.React.useState(""),[I,N]=n.React.useState(null),[S,w]=n.React.useState(NaN),[R,F]=n.React.useState(NaN),[k,x]=n.React.useState(u),[T,D]=n.React.useState(-1),E=n.React.useRef([]),L=n.React.useMemo((()=>{if(re(o)){const e=null==o?void 0:o.layer;if(re(e)&&re(e.subtypes)&&(null==e?void 0:e.subtypes.length)>0)return y(!0),b(e.subtypeField),e.subtypes}return[]}),[o]);n.React.useEffect((()=>{D(-1),F(-1),bo(void 0,void 0,void 0,(function*(){let t;const n=null==o?void 0:o.layer,i=yield(0,go.fetchEnterpriseFieldGroup)(n);if((null==i?void 0:i.length)>0){t=yield i.map((e=>({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map((e=>(0,go.normalizeFieldName)(null==e?void 0:e.toLocaleUpperCase())))})));const o=yield(0,go.fetchEnterpriseContingentValues)(n),s=(0,go.setContingentValues)(o,t,n,S),l=(0,go.validateContingencyConstraints)(-1,"",-1,a,s);if((null==l?void 0:l.length)>0){const t=[];for(let e=0;e<(null==l?void 0:l.length);e++){const n=l[e];t.push(null==n?void 0:n.fieldGroup)}e.onFieldGrpUpdated(t,r)}else e.onFieldGrpUpdated([],r);N(s)}else N([])}))}),[o]),n.React.useEffect((()=>{h&&(F(-1),D(-1))}),[h]),n.React.useEffect((()=>{if(re(a)&&v){const e=a.find((e=>e.name.toLowerCase()===g.toLowerCase()));e&&e.value!==S&&w(e.value)}T>-1&&re(E.current)&&(E.current[T].setFocus(),D(-1))}),[a]),n.React.useEffect((()=>{x(u)}),[u]),n.React.useEffect((()=>{if(!isNaN(S)&&re(L)){const e=L.findIndex((e=>e.code===S));if(e>-1){const t=L[e].defaultValues,n=yo(a);let r;for(r in t){const e=n.findIndex((e=>e.name===r));e>-1&&(lt(n[e].type)?n[e].value=re(t[r])?new Date(t[r]):null:r.toLowerCase()===g.toLowerCase()?n[e].value=S:n[e].value=t[r],n[e].error="")}A(n)}}}),[S]);const M=(e,t,n)=>{const o=yo(a);o[e].value=t,o[e].error=n,I.forEach((e=>{const t=null==e?void 0:e.fields;null==o||o.forEach((e=>{const n=null==e?void 0:e.name;t.includes(n)&&(e.error="",e.contingentValError=!1)}))}));const i=(0,go.validateContingencyConstraints)(t,n,e,a,I);if((null==i?void 0:i.length)>0){const e=[];for(let t=0;t<(null==i?void 0:i.length);t++){const n=i[t];e.push(null==n?void 0:n.fieldGroup)}null==e||e.forEach((e=>{const t=null==e?void 0:e.fields;null==o||o.forEach((e=>{const n=null==e?void 0:e.name;t.includes(n)&&(e.error="contingentValueError",e.contingentValError=!0)}))})),m(e,r)}else m([],r);f(o,r)},j=(e,t,n)=>{if(v){a[n].name.toLowerCase()===g.toLowerCase()?w(e):(null==I?void 0:I.length)>0?M(n,e,t):d(e,t,n,r)}else(null==I?void 0:I.length)>0?M(n,e,t):d(e,t,n,r);D(n)},A=e=>{f(e,r)},O=e=>{const n=re(e.error)&&e.error.length,r=re(e.default)&&e.default.length>0,o=re(e.length)&&!isNaN(e.length);let i=e.type;return o&&(i=t("fieldTypeWithLength",{fieldType:e.type,length:e.length})),n?t("fieldInfoWithError",{name:e.name,alias:e.alias,type:i,nullable:e.nullable?t("trueKey"):t("falseKey"),default:r?e.default.toString():t("nullLabel"),editable:e.editable?t("trueKey"):t("falseKey"),error:"contingentValueError"===e.error?"Invalid contingent value in the field":t(e.error)}):t("fieldInfo",{name:e.name,alias:e.alias,type:i,nullable:e.nullable?t("trueKey"):t("falseKey"),editable:e.editable?t("trueKey"):t("falseKey"),default:r?e.default.toString():t("nullLabel")})},P=e=>{F(e),re(E.current)&&T>-1&&E.current[T].setFocus()},C=e=>{const t=[];if(!(0,go.fieldsWithContingentValues)(I).has(e.name))return[];if(!I||0===I.length||!a||0===a.length)return[];const n=[];if((null==I?void 0:I.length)>0)for(const r of I){const o=null==r?void 0:r.contingencies,i=null==r?void 0:r.fields;if(o&&(null==i?void 0:i.includes(e.name)))for(const r of o){let o=null,i=!1;const s=Object.keys(r.values);null==s||s.forEach((t=>{const n=r.values[t];if(t===e.name)"code"===n.objectType&&(o=n.codedValue.code);else if("code"===n.objectType){const e=n.codedValue.code;a.some((n=>{if(n.name===t){const t=n.value;return(t===e||null===t)&&(i=!0),!0}return!1}))}})),null!==o&&(i?t.push(o):n.push(o))}}return t};return(0,n.jsx)("div",{className:"attributes-table w-100 pt-3 px-3",css:n.css`
  --calcite-color-brand: var(--sys-color-primary-main);
  --calcite-color-brand-press: var(--sys-color-primary-main);
  --calcite-color-brand-hover: var(--sys-color-action-hover);

    .event-layer-label {
      pointer-events: none;
      text: truncate;
      width: 100%;
      padding-top: 2px;
    }
    .event-layer-checkbox {
      pointer-events: auto;
    }
  `},l&&(0,n.jsx)(z.Label,{size:"sm",className:"event-layer-label",centric:!0,check:!0,style:{textOverflow:"ellipsis",fontWeight:500}},(0,n.jsx)(z.Checkbox,{checked:k,className:"event-layer-checkbox mr-2",onChange:(e,t)=>{c(t,r),x(t)}}),null==i?void 0:i.name),!l&&(0,n.jsx)(z.Label,{size:"sm",className:"text-truncate w-100 mb-0",centric:!0,style:{textOverflow:"ellipsis",fontWeight:500}},re(p)?p:null==i?void 0:i.name),(0,n.jsx)(B.CalciteTable,{caption:"Attribute Table",bordered:!0,className:"table-container",scale:"s",layout:"fixed",hidden:l&&!k},(0,n.jsx)(B.CalciteTableRow,{slot:"table-header"},(0,n.jsx)(B.CalciteTableHeader,{heading:t("attribute")}),(0,n.jsx)(B.CalciteTableHeader,{heading:t("value")})),re(a)&&a.map((e=>(0,n.jsx)(B.CalciteTableRow,{key:e.index},(0,n.jsx)(B.CalciteTableCell,{alignment:"center"},(0,n.jsx)("div",{className:"w-100 d-flex"},(0,n.jsx)(z.Label,{title:O(e),size:"sm",className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},s?e.alias:e.name),!e.editable&&(0,n.jsx)(z.Icon,{className:"ml-auto my-auto",icon:Io,size:16,style:{alignItems:"center"}}))),(0,n.jsx)(B.CalciteTableCell,{alignment:"center",ref:t=>{E.current[e.index]=t},onKeyDown:t=>{((e,t)=>{"Enter"===e.key&&F(t)})(t,e.index)},style:{border:"2px solid red"}},(0,n.jsx)(vt,{validValues:C(e),contingentValues:(0,go.getContingentOptions)(e.name,I),fieldGroups:I,eventDS:o,isSubtype:e.name.toLowerCase()===g.toLowerCase(),fieldInfo:e,useAlias:s,selected:R===e.index,onSelectionChange:P,onUpdateItem:j})))))))})),So=(0,t.withTheme)((0,t.withStyles)(No,"AttributeTable")),wo=n.React.memo((e=>{const{label:t,isDisabled:r,defaultItem:o,listItems:i,altItemDescriptions:a,onSelectionChanged:s}=e,[l,u]=n.React.useState(!1),c=n.React.useRef(null),d=n.React.useRef(null),[f,m]=n.React.useState(!1);n.React.useEffect((()=>{f&&(d.current&&(0,n.focusElementInKeyboardMode)(d.current,!0),c.current&&c.current.setFocus(),m(!1))}),[f]);return(0,n.jsx)("div",{className:"inline-editing-dropdown",css:xe()},t.length>0&&(0,n.jsx)(z.Label,{size:"sm",centric:!0,className:"text-truncate pb-0 mb-0 pt-3 px-3 w-100",style:{textOverflow:"ellipsis",fontWeight:500}},t),(!l||r)&&(0,n.jsx)("div",{className:"d-flex w-100 px-3"},(0,n.jsx)(z.Label,{size:"sm",centric:!0,className:"text-truncate d-flex pb-0 mb-0 w-100",style:{textOverflow:"ellipsis"}},(()=>{if(a){const e=i.findIndex((e=>e===o));return e>-1?a[e]:o}return o})()),(0,n.jsx)(B.CalciteButton,{ref:c,className:(0,n.classNames)("inline-editing-edit__action",{"d-none":1===i.length||r}),scale:"s",disabled:r||i.length<=1,iconStart:"pencil",appearance:"transparent",kind:"neutral",onClick:()=>{m(!0),u(!0)}})),l&&(0,n.jsx)("div",{className:"d-flex w-100 px-3"},(0,n.jsx)(z.Select,{ref:d,className:"w-100",size:"sm",value:o,onChange:e=>{var t;t=e.target.value,m(!0),u(!1),s(t)}},i.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e}," ",((e,t)=>a&&(null==a?void 0:a.length)>0?a[e]:t)(t,e))))),(0,n.jsx)(B.CalciteButton,{scale:"s",iconStart:"x",appearance:"transparent",kind:"neutral",onClick:()=>{m(!0),u(!1)}})))})),Ro=(e,t)=>{var r,o,i,a,s,l,u,c,d,f,m,p,h,v,y;return n.css`
    & {
      width: ${n.polished.rem(null===(r=null==t?void 0:t.current)||void 0===r?void 0:r.clientWidth)};
      padding-top: 0;
      padding-bottom: 0;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${n.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${n.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--ref-palette-neutral-200);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(i=null===(o=null==e?void 0:e.sys.color)||void 0===o?void 0:o.secondary)||void 0===i?void 0:i.dark};
      background-color: ${null===(s=null===(a=null==e?void 0:e.ref.palette)||void 0===a?void 0:a.neutral)||void 0===s?void 0:s[300]};
    }
    &.result-list-con button:hover {
      color: ${null===(l=null==e?void 0:e.ref.palette)||void 0===l?void 0:l.black};
      background-color: ${null===(c=null===(u=null==e?void 0:e.ref.palette)||void 0===u?void 0:u.neutral)||void 0===c?void 0:c[200]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(d=null==e?void 0:e.ref.palette)||void 0===d?void 0:d.black};
      background-color: ${null===(m=null===(f=null==e?void 0:e.ref.palette)||void 0===f?void 0:f.neutral)||void 0===m?void 0:m[200]};
    }
    &.result-list-con .jimu-dropdown-item-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(p=null==e?void 0:e.sys.color)||void 0===p?void 0:p.primary.main};
      color: ${null===(h=null==e?void 0:e.ref.palette)||void 0===h?void 0:h.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(v=null==e?void 0:e.ref.palette)||void 0===v?void 0:v.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(y=null==e?void 0:e.ref.palette)||void 0===y?void 0:y.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${n.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--sys-color-primary-main) !important;
      height: ${n.polished.rem(40)};
      margin-top: ${n.polished.rem(-4)};
    }
    .jimu-dropdown-item-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${n.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--ref-palette-black) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${n.polished.rem(11)};
        min-height: ${n.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${n.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${n.polished.rem(8)};
          min-height: ${n.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${n.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--ref-palette-white);
      }
    }
  `},Fo=[0,3],{useEffect:ko,useRef:xo}=n.React,To=e=>{const r=xo(null),o=xo(null),{children:i,isOpen:a,reference:s,searchInputRef:l,autoFocus:u,className:c,isFocusWidtSearchInput:d,id:f,offset:m,version:p,toggle:h}=e,v=(0,t.useTheme)(),y=n.ReactRedux.useSelector((e=>{var t;const n=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==n?void 0:n[f])||void 0===t?void 0:t.state}));ko((()=>{var e;return(null==l?void 0:l.current)&&d&&(null===(e=l.current)||void 0===e||e.addEventListener("keydown",g,!0)),()=>{var e;d&&(null===(e=l.current)||void 0===e||e.removeEventListener("keydown",g,!0))}}),[]);const g=n.hooks.useEventCallback((e=>{if(!a)return!1;const t=N()||[],r=(null==t?void 0:t.length)-1;"ArrowUp"===e.key?o.current=setTimeout((()=>{(0,n.focusElementInKeyboardMode)(t[r],!0)})):"ArrowDown"===e.key&&(o.current=setTimeout((()=>{(0,n.focusElementInKeyboardMode)(t[0],!0)})))})),b=n.hooks.useEventCallback((e=>{if(!a)return;const t="button"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),a&&t))if(clearTimeout(o.current),"Escape"===e.key)I(e);else if(["ArrowUp","ArrowDown"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const t=N();let i=t.indexOf(e.target),a=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey?(i=0!==i?i-1:t.length-1,a=!0):("ArrowDown"===e.key||"n"===e.key&&e.ctrlKey)&&(a=!1,i=i===t.length-1?0:i+1);const s=0===i&&!a,u=i===t.length-1&&a;o.current=d&&(s||u)?setTimeout((()=>{(0,n.focusElementInKeyboardMode)(l.current,!0)})):setTimeout((()=>{(0,n.focusElementInKeyboardMode)(Array.prototype.slice.call(r.current.querySelectorAll(".popper-box"))[0],!0),(0,n.focusElementInKeyboardMode)(t[i],!0)}))}else if("End"===e.key){const e=N();o.current=setTimeout((()=>{(0,n.focusElementInKeyboardMode)(e[e.length-1],!0)}))}else if("Home"===e.key){const e=N();o.current=setTimeout((()=>{(0,n.focusElementInKeyboardMode)(e[0],!0)}))}else if(e.which>=48&&e.which<=90){const t=N(),r=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<t.length;e+=1){if((t[e].textContent&&t[e].textContent[0].toLowerCase())===r){o.current=setTimeout((()=>{(0,n.focusElementInKeyboardMode)(t[e],!0)}));break}}}})),I=e=>{e.preventDefault(),S(e),(0,n.focusElementInKeyboardMode)(null==l?void 0:l.current)},N=()=>r?Array.prototype.slice.call(r.current.querySelectorAll('[role="button"]')).filter((e=>!e.disabled)):[],S=e=>{h(e)};return(0,n.jsx)("div",null,(0,n.jsx)(z.Popper,{autoFocus:u,placement:"bottom-start",open:a,toggle:S,css:Ro(v,s),reference:s,version:p,className:(0,n.classNames)("result-list-popper",c,{"hide-popper":y===n.WidgetState.Closed}),offsetOptions:m||Fo,ref:r},(0,n.jsx)("div",{onKeyDown:b},i)))},{useRef:Do}=n.React,Eo=new(0,n.esri.Sanitizer),Lo=n.React.memo((e=>{const r=n.hooks.useTranslation(K),{className:o,reference:i,searchSuggestion:a,isOpen:s,searchText:l,id:u,searchInputRef:c,toggel:d,onRecordItemClick:f}=e,m=(0,t.useTheme)(),p=Do(!1),h=()=>{if((null==a?void 0:a.length)<2)return!1;let e=0,t=0;return null==a||a.forEach((n=>{var r;const o=null==n?void 0:n.icon;o&&(e+=1),(null===(r=n.suggestionItem)||void 0===r?void 0:r.length)>0&&o&&(t+=1)})),t>0&&e>0},v=(e,t=!1)=>{const r=null==e?void 0:e.suggestionItem;return null==r?void 0:r.map(((r,o)=>{const i=Eo.sanitize(r.suggestionHtml);return(0,n.jsx)(z.Button,{className:(0,n.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":t}),key:`${null==e?void 0:e.layer}${o}`,title:r.suggestion,role:"button",onClick:()=>{(e=>{f(e)})(r.suggestion)}},(0,n.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:i}}))}))};return(0,n.jsx)("div",null,(0,n.jsx)(To,{isOpen:s,autoFocus:!1,reference:i,searchInputRef:c,isFocusWidtSearchInput:!0,toggle:d,id:u,className:(0,n.classNames)("result-list-con suggestion-list-con",o)},(()=>{let e=[];a.forEach((t=>{const n=(null==t?void 0:t.suggestionItem)||[];e=e.concat(n)}));return l&&0===e.length})()&&(0,n.jsx)(z.Button,{role:"button",className:"text-center py-2",disabled:!0,title:r("noResult",{searchText:l})},r("noResult",{searchText:l})),(p.current=null,null==a?void 0:a.map(((e,t)=>{var r,o,i;const s=(null==a?void 0:a.length)>1&&(null===(r=null==e?void 0:e.suggestionItem)||void 0===r?void 0:r.length)>0;return(0,n.jsx)("div",{key:`${null==e?void 0:e.layer}-${t}`,role:"group","aria-label":null==e?void 0:e.layer},s&&(0,n.jsx)(z.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==e?void 0:e.layer},(null==e?void 0:e.icon)&&(0,n.jsx)(z.Icon,{className:"mr-2",color:null===(o=null==m?void 0:m.sys.color)||void 0===o?void 0:o.primary.main,size:16,icon:null===(i=null==e?void 0:e.icon)||void 0===i?void 0:i.svg}),null==e?void 0:e.layer),v(e,h()))})))))}));const Mo=function(){return s.Date.now()};var jo=Math.max,Ao=Math.min;const Oo=function(e,t,n){var r,o,i,a,s,l,u=0,c=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=r,i=o;return r=o=void 0,u=t,a=e.apply(i,n)}function h(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-u>=i}function v(){var e=Mo();if(h(e))return y(e);s=setTimeout(v,function(e){var n=t-(e-l);return d?Ao(n,i-(e-u)):n}(e))}function y(e){return s=void 0,f&&r?m(e):(r=o=void 0,a)}function g(){var e=Mo(),n=h(e);if(r=arguments,o=this,l=e,n){if(void 0===s)return function(e){return u=e,s=setTimeout(v,t),c?m(e):a}(l);if(d)return clearTimeout(s),s=setTimeout(v,t),m(l)}return void 0===s&&(s=setTimeout(v,t)),a}return t=L(t)||0,p(n)&&(c=!!n.leading,i=(d="maxWait"in n)?jo(L(n.maxWait)||0,t):i,f="trailing"in n?!!n.trailing:f),g.cancel=function(){void 0!==s&&clearTimeout(s),u=0,r=l=o=s=void 0},g.flush=function(){return void 0===s?a:y(Mo())},g},Po=n.React.memo((e=>{const{reset:t,widgetId:r,fieldName:o,fieldType:i,dataSource:a,isDataSourceReady:s,onChange:l,onAccept:u}=e,c=n.hooks.useTranslation(K),d=n.React.useRef(null),f=n.React.useRef((e=>{})),m=n.React.useRef(null),p=n.React.useRef(null),h=n.React.useRef(null),v=n.React.useRef(null),y=n.React.useRef(!1),g=n.React.useRef(!1),[b,I]=n.React.useState(null),[N,S]=n.React.useState(!1),[w,R]=n.React.useState([]);n.React.useEffect((()=>{I(null),x(null),setTimeout((()=>{m.current=null,v.current=null,p.current.select(),(0,n.focusElementInKeyboardMode)(p.current,!0),p.current.blur()}),200)}),[t]),n.React.useEffect((()=>{f.current=Oo(k,400)}),[]);const F=n.React.useMemo((()=>a),[a]),k=n.hooks.useEventCallback((e=>{const t=ue(o,e,a);Promise.all([t]).then((e=>{const t=null==e?void 0:e[0];t&&R(t),m.current&&S(!0)})).catch((e=>null))})),x=e=>{re(m)&&""!==m.current&&""===e&&setTimeout((()=>{p.current.select(),(0,n.focusElementInKeyboardMode)(p.current,!0),p.current.blur()}),200)},T=e=>{m.current=e,I(e)},D=()=>{(0,n.focusElementInKeyboardMode)(p.current),E(!0,!1)},E=(e=!1,t=!0)=>{e||(g.current=!1)};return(0,n.jsx)("div",{className:"route-input"},(0,n.jsx)("div",{ref:d,className:"d-flex w-100"},(0,n.jsx)(z.TextInput,{"aria-label":c("routeIdLabel"),type:"text",className:"w-100",size:"sm",allowClear:!!b,disabled:!s,onBlur:()=>{h.current=setTimeout((()=>{y.current||S(!1),g.current||E(!1)}),200)},value:b||"",ref:p,onChange:e=>{var t;v.current=null;const n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,r=(null==n?void 0:n.length)>2;if(x(n),T(n),l(n),!r)return S(!1),!1;f.current(n)},checkValidityOnAccept:e=>new Promise((t=>{setTimeout((()=>{v.current&&(e=v.current);const r=F,a={};i===n.JimuFieldType.Number?a.where=`${o} LIKE ${e}`:a.where=`LOWER(${o}) LIKE LOWER('${e}')`;const s=r.queryCount(a).then((t=>0===t.count&&e.length>0?(u(e,!1),{valid:!1,msg:c("invalidRouteField")}):(u(e,!0),{valid:!0}))).catch((t=>(u(e,!1),{valid:!1})));t(s)}),200)}))}),b&&(0,n.jsx)(Lo,{isOpen:(N||(y.current=!1),N),reference:d,searchText:b,searchSuggestion:w,onRecordItemClick:(e,t)=>{if(t)return D(),!1;v.current=e,T(e)},id:r,searchInputRef:p})))}));var Co,Vo,_o,Uo,$o,Go,qo=c(68972);!function(e){e.EsriSuccess="esriSuccess",e.EsriReconcileRequired="esriReconcileRequired",e.EsriWrongReconcileVersion="esriWrongReconcileVersion",e.EsriConflictsDuringReconcile="esriConflictsDuringReconcile",e.EsriCouldNotAcquireAllLocks="esriCouldNotAcquireAllLocks",e.EsriActiveEditSessionOnVersion="esriActiveEditSessionOnVersion"}(Co||(Co={})),function(e){e.EsriSuccess="esriSuccess",e.EsriPostRequired="esriPostRequired",e.EsriWrongPostVersion="esriWrongPostVersion",e.EsriCouldNotReleaseAllLocks="esriCouldNotReleaseAllLocks",e.EsriCouldNotReleaseAllLocksPostRequired="esriCouldNotReleaseAllLocksPostRequired",e.EsriCouldNotReleaseAllLocksOwnedByOtherUsers="esriCouldNotReleaseAllLocksOwnedByOtherUsers",e.EsriCouldNotReleaseAllLocksActiveEditSession="esriCouldNotReleaseAllLocksActiveEditSession",e.EsriCouldNotReleaseAllLocksNeedToRunAebGpToolOnDefault="esriCouldNotReleaseAllLocksNeedToRunAebGpToolOnDefault"}(Vo||(Vo={})),function(e){e.No="no",e.Yes="yes",e.OnPost="onPost",e.Undefined="undefined"}(_o||(_o={})),function(e){e[e.Acquire=0]="Acquire",e[e.Release=1]="Release",e[e.Query=2]="Query",e[e.Locks=3]="Locks"}(Uo||(Uo={})),function(e){e[e.Reconcile=0]="Reconcile",e[e.Versions=1]="Versions",e[e.StartRead=2]="StartRead",e[e.StopRead=3]="StopRead",e[e.StartEdit=4]="StartEdit",e[e.StopEdit=5]="StopEdit"}($o||($o={})),function(e){e[e.Query=0]="Query",e[e.QueryAndAcquire=1]="QueryAndAcquire",e[e.QueryAndRelease=2]="QueryAndRelease",e[e.Acquire=3]="Acquire",e[e.Release=4]="Release",e[e.Clear=5]="Clear",e[e.None=6]="None"}(Go||(Go={}));var Bo=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function zo(e,t,r){return Bo(this,void 0,void 0,(function*(){if(!ii(t,e,!1))return t;const o=he(e.url);return function(e){return Bo(this,void 0,void 0,(function*(){var t;const r=ti(e,Uo.Locks),o={f:"json",token:null===(t=n.SessionManager.getInstance().getMainSession())||void 0===t?void 0:t.token};return yield $e({method:"GET",url:r,params:o}).then((e=>{var t;return(null===(t=null==e?void 0:e.lrs[0])||void 0===t?void 0:t.lockTableFields)||null}))}))}(e.url).then((n=>function(e,t,n,r,o){return Bo(this,void 0,void 0,(function*(){const i=ti(e.url,Uo.Query);let a=`${n.routeIdFieldName} IN ('${t.routeOrLineId.join("','")}')`;a+=` AND ${n.networkIdFieldName} IN (${t.networkId.toString()})`;return $e({method:"GET",url:i,params:{f:"json",token:r.token,where:a,returnReleasableStatus:o}}).then((e=>e))}))}(e,t,n,o,r).then((e=>re(e)?(t.details=e.locks,t):(t.details=[],t)))))}))}function Wo(e,t){return Bo(this,void 0,void 0,(function*(){const n={acquireStatus:Co.EsriCouldNotAcquireAllLocks,acquiredLocks:[],unavailableLocks:[]};if(!ii(t,e,!0))return n;const r=he(e.url),o=ve(e),i=ti(e.url,Uo.Acquire),a=[];t.eventServiceLayerIds.forEach(((e,n)=>{t.isLine[n]?a.push({lineId:t.routeOrLineId[n],layerId:e}):a.push({routeId:t.routeOrLineId[n],layerId:e})}));return $e({method:"GET",url:i,params:{f:"json",token:r.token,editVersion:o,acquireLocks:a}}).then((e=>e))}))}function Ho(e,t){return Bo(this,void 0,void 0,(function*(){if(!ii(t,e,!0))return!1;if(ye(ve(e))){return(yield Ko(e,t)).releaseStatus===Vo.EsriSuccess}}))}function Qo(e,t,n){return Bo(this,void 0,void 0,(function*(){if(!re(t)||!re(n))return!1;const r=he(e.url),o=ve(e);if(t.user===r.username&&t.versionName===o&&n.eventServiceLayerIds.includes(t.layerId))return!0;if(t.releasableStatus===_o.Yes){const r={routeOrLineId:[t.routeId],eventServiceLayerIds:[t.layerId],isLine:[n.isLine[0]],networkId:[t.lrsNetworkId],status:n.status,details:[],routeInfo:n.routeInfo,lockAction:n.lockAction};return(yield Ko(e,r)).releaseStatus===Vo.EsriSuccess}}))}function Ko(e,t){return Bo(this,void 0,void 0,(function*(){if(!ii(t,e,!0))return null;const n=ti(e.url,Uo.Release),r=he(e.url),o=[];t.eventServiceLayerIds.forEach(((e,n)=>{t.isLine[n]?o.push({lineId:t.routeOrLineId[n],layerId:e}):o.push({routeId:t.routeOrLineId[n],layerId:e})}));return $e({method:"GET",url:n,params:{f:"json",token:r.token,releaseLocks:o}}).then((e=>e))}))}function Jo(e){return Bo(this,void 0,void 0,(function*(){const t=he(e.url),r=yield Yo(e.url,ve(e));if(!re(r)||""===r)return!1;const o=r.replace("{","").replace("}",""),i=ni(e.url,$o.Reconcile,o);let a="{"+n.utils.getUUID()+"}";a=a.replace(/[_]/g,"-");const s={token:t.token,sessionId:a,abortIfConflicts:!0,conflictDetection:"byAttribute",withPost:!0,saveEdits:!0},l=ni(e.url,$o.StartRead,o),u=ni(e.url,$o.StartEdit,o),c=ni(e.url,$o.StopRead,o),d=ni(e.url,$o.StopEdit,o);let f=!1;return yield $e({method:"POST",url:l,params:s}).then((e=>Bo(this,void 0,void 0,(function*(){e.success&&(yield $e({method:"POST",url:u,params:s}).then((e=>Bo(this,void 0,void 0,(function*(){e.success&&(yield $e({method:"POST",url:i,params:s}).then((e=>Bo(this,void 0,void 0,(function*(){e.success&&(f=!0,yield $e({method:"POST",url:d,params:s}).then((e=>Bo(this,void 0,void 0,(function*(){e.success&&(yield $e({method:"POST",url:c,params:s}).then((e=>null)))})))))})))))})))))})))),f}))}function Yo(e,t){return Bo(this,void 0,void 0,(function*(){if(ye(t))return"";const n=ni(e,$o.Versions),r={f:"json",token:he(e).token};return yield $e({method:"GET",url:n,params:r}).then((e=>{let n="";return e.versions.forEach((e=>{e.versionName===t&&(n=e.versionGuid)})),n}))}))}function Zo(){return{routeInfo:null,networkId:[],routeOrLineId:[],eventServiceLayerIds:[],isLine:[],status:Co.EsriSuccess,details:[],lockAction:Go.None}}function Xo(e){return""!==e.routeId||""!==e.lineId}function ei(e,t){if(0===t.details.length)return!0;const n=he(e.url),r=t.details.filter((e=>e.user===n.username));if(0===r.length)return!0;const o=ve(e),i=r.filter((e=>e.versionName===o));if(0===i.length)return!0;const a=Object.assign([],t.eventServiceLayerIds);for(let e=0;e<i.length;e++){if(""===i[e].eventFeatureClassName)return!1;re(a)&&a.includes(i[e].layerId)&&a.splice(a.indexOf(i[e].layerId),1)}return!re(a)||0!==a.length}function ti(e,t){let n=ri(e);switch(n+="MapServer/exts/LRServer/",t){case Uo.Acquire:n+="Locks/acquire";break;case Uo.Release:n+="Locks/release";break;case Uo.Query:n+="Locks/query";break;case Uo.Locks:n+="locks"}return n}function ni(e,t,n){let r=ri(e);switch(r+="VersionManagementServer/",t){case $o.Reconcile:r+=`versions/${n}/reconcile`;break;case $o.Versions:r+="versions";break;case $o.StartRead:r+=`versions/${n}/startReading`;break;case $o.StopRead:r+=`versions/${n}/stopReading`;break;case $o.StartEdit:r+=`versions/${n}/startEditing`;break;case $o.StopEdit:r+=`versions/${n}/stopEditing`}return r}function ri(e){return e.includes("MapServer")?e.substring(0,e.lastIndexOf("MapServer")):e.includes("FeatureServer")?e.substring(0,e.lastIndexOf("FeatureServer")):""}function oi(e){return Bo(this,void 0,void 0,(function*(){var t;const r=ti(e,Uo.Locks),o={f:"json",token:null===(t=n.SessionManager.getInstance().getMainSession())||void 0===t?void 0:t.token};return yield $e({method:"GET",url:r,params:o}).then((e=>{var t;return(null===(t=null==e?void 0:e.lrs)||void 0===t?void 0:t[0].conflictPreventionEnabled)||!1}))}))}function ii(e,t,n){return!(!re(e)||!re(t))&&!(n&&!function(e){return e.eventServiceLayerIds.length===e.routeOrLineId.length&&e.eventServiceLayerIds.length===e.isLine.length}(e))}var ai=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};class si extends qo.default.PureComponent{constructor(e){super(e),this.state={lockInfo:null,toastMsg:"",toastMsgType:"warning",toastOpen:!1}}componentDidUpdate(e){return ai(this,void 0,void 0,(function*(){if(this.props.conflictPreventionEnabled){if(this.hasNullProps())return void this.clearMessage();if(!this.didChange(e))return void this.clearMessage();if(this.doAction())switch(this.props.lockInfo.lockAction){case Go.Acquire:yield this.doAcquireLock();break;case Go.QueryAndAcquire:yield this.doQueryAndAcquireLock();break;case Go.QueryAndRelease:yield this.doQueryAndReleaseLock();break;case Go.Query:yield this.doQueryLock();break;case Go.Release:yield this.doReleaseLock();break;case Go.Clear:this.clearMessage();case Go.None:}else this.clearMessage()}}))}clearMessage(){re(this.props.lockInfo)&&this.props.lockInfo.lockAction===Go.Clear&&(this.setState({toastMsg:"",toastMsgType:"info",toastOpen:!1}),this.props.onMessageClear&&this.props.onMessageClear())}shouldClearMessageState(){return""===this.state.toastMsg||!(!re(this.props.lockInfo)||!re(this.state.lockInfo)||this.props.lockInfo.routeOrLineId===this.state.lockInfo.routeOrLineId||this.props.lockInfo.networkId===this.state.lockInfo.networkId||this.props.lockInfo.eventServiceLayerIds===this.state.lockInfo.eventServiceLayerIds)}hasNullProps(){var e;return!re(this.props.lockInfo)||(!re(null===(e=this.props.lockInfo)||void 0===e?void 0:e.routeInfo)||!re(this.props.featureDS))}didChange(e){return!(re(e.lockInfo)||!re(this.props.lockInfo))||(e.lockInfo.networkId.toString()!==this.props.lockInfo.networkId.toString()||(e.lockInfo.eventServiceLayerIds.toString()!==this.props.lockInfo.eventServiceLayerIds.toString()||(!(re(e.featureDS)||!re(this.props.featureDS))||(!(!re(e.featureDS)||!re(this.props.featureDS)||e.featureDS.id===this.props.featureDS.id)||(!(re(e.lockInfo.routeInfo)||!re(this.props.lockInfo.routeInfo))||(e.lockInfo.routeInfo.routeId!==this.props.lockInfo.routeInfo.routeId||(e.lockInfo.routeInfo.lineId!==this.props.lockInfo.routeInfo.lineId||e.lockInfo.lockAction!==this.props.lockInfo.lockAction)))))))}doAction(){return!!re(this.props.lockInfo.routeInfo)&&(!(!re(this.props.lockInfo.routeInfo.routeId)||""===this.props.lockInfo.routeInfo.routeId)&&(!(!re(this.props.lockInfo.networkId)||0===this.props.lockInfo.networkId.length)&&(!(!re(this.props.lockInfo.eventServiceLayerIds)||0===this.props.lockInfo.eventServiceLayerIds.length)&&!!re(this.props.featureDS))))}doQueryLock(){return ai(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield zo(this.props.featureDS,e,!0);this.setState({lockInfo:e}),this.props.onQueryComplete&&this.props.onQueryComplete(t,!0)}))}doQueryAndAcquireLock(){return ai(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield zo(this.props.featureDS,e,!1);if(ei(this.props.featureDS,t)){let n=yield Wo(this.props.featureDS,t);if(n.acquireStatus===Co.EsriReconcileRequired){(yield Jo(this.props.featureDS))&&(n=yield Wo(this.props.featureDS,t))}this.props.showAlert&&this.setAlert(n,t,!0),this.setState({lockInfo:e}),this.props.onQueryAndAcquireComplete&&(n.acquireStatus===Co.EsriSuccess?this.props.onQueryAndAcquireComplete(t,n,!0):this.props.onQueryAndAcquireComplete(t,n,!1))}else this.shouldClearMessageState()&&this.setState({toastMsg:"",toastMsgType:"info",toastOpen:!1}),this.setState({lockInfo:e}),this.props.onQueryAndAcquireComplete&&this.props.onQueryAndAcquireComplete(t,null,!0)}))}doQueryAndReleaseLock(){return ai(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield zo(this.props.featureDS,e,!0);for(let n=0;n<t.details.length;n++)yield Qo(this.props.featureDS,t.details[n],e);this.setState({lockInfo:e}),this.props.onQueryAndReleaseComplete&&this.props.onQueryAndReleaseComplete(t,!0)}))}doAcquireLock(){return ai(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams();let t=yield Wo(this.props.featureDS,e);if(t.acquireStatus===Co.EsriReconcileRequired){(yield Jo(this.props.featureDS))&&(t=yield Wo(this.props.featureDS,e))}this.props.showAlert&&this.setAlert(t,e,!0),this.setState({lockInfo:e}),this.props.onAcquireComplete&&(t.acquireStatus===Co.EsriSuccess?this.props.onAcquireComplete(t,!0):this.props.onAcquireComplete(t,!1))}))}doReleaseLock(){return ai(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Ko(this.props.featureDS,e);this.setState({lockInfo:e}),this.props.onReleaseComplete&&(t.releaseStatus===Vo.EsriSuccess?this.props.onReleaseComplete(t,!0):this.props.onReleaseComplete(t,!1))}))}createLockInfoFromParams(){const e=[],t=[];this.props.lockInfo.eventServiceLayerIds.forEach(((n,r)=>{const o=""!==this.props.lockInfo.routeInfo.lineId&&re(this.props.lockInfo.routeInfo.lineId);e.push(o?this.props.lockInfo.routeInfo.lineId:this.props.lockInfo.routeInfo.routeId),t.push(o)}));return{networkId:this.props.lockInfo.networkId,routeOrLineId:e,eventServiceLayerIds:this.props.lockInfo.eventServiceLayerIds,isLine:t,status:Co.EsriSuccess,details:[],routeInfo:this.props.lockInfo.routeInfo,lockAction:Go.None}}getNameOrId(e){return""!==e.lineId&&""===e.lineName?e.lineId:""!==e.lineId&&""!==e.lineName?e.lineName:""!==e.routeName?e.routeName:e.routeId}getNameOrIdFromUnavailableLock(e){return re(e.routeName)&&""!==e.routeName?e.routeName:re(e.lineName)&&""!==e.lineName?e.lineName:re(e.routeId)&&""!==e.routeId?e.routeId:re(e.lineId)&&""!==e.lineId?e.lineId:void 0}setAlert(e,t,n){var r;let o="",i="info",a="";const s=(null===(r=null==t?void 0:t.details[0])||void 0===r?void 0:r.lrsNetworkName)||this.props.networkName,l=ve(this.props.featureDS);switch(e.acquireStatus){case Co.EsriSuccess:a=this.getNameOrId(this.props.lockInfo.routeInfo),o=""!==this.props.lockInfo.routeInfo.lineId?Z(this.props.intl,"YouAcquiredLockOnLine",{nameOrId:a,networkName:s,version:l}):Z(this.props.intl,"YouAcquiredLockOnRoute",{nameOrId:a,networkName:s,version:l}),i="info";break;case Co.EsriReconcileRequired:o=Z(this.props.intl,"ReconcileRequired"),i="error";break;case Co.EsriCouldNotAcquireAllLocks:const t=e.unavailableLocks[0].versionName,r=e.unavailableLocks[0].user;a=this.getNameOrIdFromUnavailableLock(e.unavailableLocks[0]),o=""===t?""!==this.props.lockInfo.routeInfo.lineId?Z(this.props.intl,"UnavailableLockOnLineWithoutVersion",{nameOrId:a,networkName:s,lockUser:r}):Z(this.props.intl,"UnavailableLockOnRouteWithoutVersion",{nameOrId:a,networkName:s,lockUser:r}):""!==this.props.lockInfo.routeInfo.lineId?Z(this.props.intl,"UnavailableLockOnLine",{nameOrId:a,networkName:s,lockUser:r,version:t}):Z(this.props.intl,"UnavailableLockOnRoute",{nameOrId:a,networkName:s,lockUser:r,version:t}),i="error";break;default:o="",i="info",n=!1}this.setState({toastMsg:o,toastMsgType:i,toastOpen:n})}render(){const{conflictPreventionEnabled:e}=this.props;return e&&re(this.props.lockInfo)&&re(this.props.lockInfo.routeInfo)&&re(this.props.featureDS)&&this.props.showAlert&&""!==this.state.toastMsg?qo.default.createElement(z.Alert,{className:"lock-manager-alert w-100",size:"small",type:this.state.toastMsgType,text:this.state.toastMsg,closable:!0,withIcon:!0,open:this.state.toastOpen,onClose:()=>{this.setState({toastOpen:!1})}}):null}}var li=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function ui(e){const{disabled:t,networkDs:r,eventDataSources:i,jimuMapView:a,hoverGraphic:s,onAttributesCopied:l}=e,u=n.hooks.useTranslation(K),c=n.React.useRef(null),d=n.React.useRef(null),[f,m]=n.React.useState(null),p=n.React.useRef(!1),h=n.React.useRef(!1),[v,y]=n.React.useState(!1),[g,b]=n.React.useState();n.React.useEffect((()=>{if(re(r)){const e=r;re(null==e?void 0:e.layer)&&m(null==e?void 0:e.layer)}re(null==a?void 0:a.view)&&b(null==a?void 0:a.view.popupEnabled)}),[null==a?void 0:a.view,r]),n.React.useEffect((()=>{v?I():N()}),[v]);const I=()=>{c.current=null==a?void 0:a.view.on("pointer-move",F),d.current=null==a?void 0:a.view.on("pointer-down",k)},N=()=>{re(c.current)&&(c.current.remove(),c.current=null),re(d.current)&&(d.current.remove(),d.current=null),h.current&&(h.current=!1),p.current&&(p.current=!1)},S=()=>{re(s)&&s.removeAll()},w=e=>{S(),re(e)&&s.add(e)},R=(e,t)=>{const n=t.spatialReference,r=t.createQuery(),o="degrees"===n.unit?4:Math.max(3*n.metersPerUnit,3);return r.geometry=e,r.units="meters",r.returnGeometry=!0,r.returnM=!0,r.returnZ=!0,r.distance=(null==a?void 0:a.view.resolution)*o,r.spatialRelationship="intersects",r},F=e=>{re(f)&&!p.current&&(0,o.loadArcGISJSAPIModules)(["esri/geometry/operators/proximityOperator","esri/TimeExtent"]).then((t=>{let n=null,o=null;[n,o]=t,p.current=!0;const i=r.getCurrentQueryParams(),s=null==a?void 0:a.view.toMap(e),l=R(s,f);l.outFields=[],(null==i?void 0:i.time)&&(l.timeExtent=new o({start:i.time[0],end:i.time[1]})),l.gdbVersion=i.gdbVersion,f.queryFeatures(l).then((e=>li(this,void 0,void 0,(function*(){if(e.features.length>0){const t=e.features[0].geometry,r=n.getNearestCoordinate(t,s),o=n.getNearestVertex(t,s);o.distance<3*l.distance&&(r.coordinate=o.coordinate),w(yield Oe(yield Ve(r.coordinate))),p.current=!1}p.current&&(w(null),p.current=!1)}))))}))},k=e=>li(this,void 0,void 0,(function*(){re(f)&&!h.current&&(e.stopPropagation(),(0,o.loadArcGISJSAPIModules)(["esri/TimeExtent"]).then((t=>li(this,void 0,void 0,(function*(){let n=null;[n]=t,a.view.popupEnabled=!1,h.current=!0;const r=null==a?void 0:a.view.toMap(e),o=[];yield Promise.all(i.map((e=>li(this,void 0,void 0,(function*(){const t=e,i=R(r,null==t?void 0:t.layer);i.outFields=["*"];const a=t.getCurrentQueryParams();(null==a?void 0:a.time)&&(i.timeExtent=new n({start:a.time[0],end:a.time[1]})),i.gdbVersion=a.gdbVersion;const s=yield null==t?void 0:t.layer.queryFeatures(i).then((e=>li(this,void 0,void 0,(function*(){const t=[];if(e.features.length>0){const n=e.features[0].attributes;for(const e in n){const r={name:e,value:n[e]};t.push(r)}}return t})))),l={layerId:t.layerId,fieldValuePair:s};o.push(l)}))))).then((()=>{o.length>0&&l(o)})).finally((()=>{x()})).catch((()=>{x()}))})))))})),x=()=>{y(!1),N(),h.current=!1,setTimeout((()=>{a.view.popupEnabled=g,a.clearSelectedFeatures()}),800),S()};return(0,n.jsx)(z.Tooltip,{title:u("copyAttributes")},(0,n.jsx)(B.CalciteButton,{scale:"s",css:xe(),iconStart:"eyedropper",appearance:v?"solid":"outline",kind:"brand",disabled:!!t||void 0,tabIndex:-1,onClick:()=>{y(!v)}}))}var ci=c(48993),di=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function fi(e,t,n,r,i){return di(this,void 0,void 0,(function*(){const a=(yield(0,o.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]))[0],s=i+r.id,l=r.view.map.findLayerById(s);re(l)&&r.view.map.remove(l);const u=new a({id:s,listMode:n,legendEnabled:!1,title:s,geometryType:t,source:[],objectIdField:"OBJECTID",elevationInfo:{mode:ci.DrawingElevationMode3D.RelativeToGround},hasZ:!0,hasM:!0,popupEnabled:!1,popupTemplate:null,outFields:["*"],labelsVisible:!1,spatialReference:r.view.spatialReference,screenSizePerspectiveEnabled:!1,fields:e});return r.view.map.add(u),u}))}function mi(e){return di(this,void 0,void 0,(function*(){const t=n.DataSourceManager.getInstance().getDataSource(e.dataSourceId);if(re(t)){const e=t;return(null==e?void 0:e.layer)||(yield e.createJSAPILayerByDataSource())}return null}))}function pi(e,t){const n=e.find((e=>e.type===t));return re(n)?n.clone():null}function hi(e,t){const n=e.find((e=>e.name===t));return re(n)?n.clone():null}function vi(e,t){let n=t.replace(/[^a-zA-Z0-9_]+/g,""),r=0,o=!0;for(;o;){const i=n.toUpperCase();o=e.includes(i),o&&(r++,n=t.replace(/[^a-zA-Z0-9_]+/g,"")+"_"+r.toString())}return n}function yi(e,t){return e.filter((e=>t.includes(e.name)))}function gi(){return["SHAPE_LENGTH","SHAPE_LEN","SHAPELENGTH","SHAPELEN","SHAPE__LENGTH","SHAPE__LENGTH__","SE_LENGTH","ST_LENGTH","STLENGTH","DB2GSEST_LENGTH","DB2GSESDELENGTH","SDELENGTH","SHAPESTLENGTH","SDO_GEOMSDO_LENGTH"]}function bi(e,t,n,r){return di(this,void 0,void 0,(function*(){const i=new(0,(yield(0,o.loadArcGISJSAPIModules)(["esri/layers/support/Field"]))[0]);return i.name=e,i.alias=t,i.type=n,i.editable=r,i.defaultValue=null,i}))}var Ii=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function Ni(e){return Ii(this,void 0,void 0,(function*(){return new Promise((function(t,r){const o={params:e.params,httpMethod:e.method};n.esri.restRequest.request(e.url,o).then((e=>{t(e)})).catch((e=>{t(e)}))}))}))}function Si(e){return Ii(this,void 0,void 0,(function*(){if(!e)return[];const t=e.url,r=e.layerId,o=n.SessionManager.getInstance().getSessionByUrl(t),i=o&&o.token?o.token:"";return Ni({method:"POST",url:`${t}/queryDataElements`,params:{f:"json",layers:JSON.stringify([r]),token:i}}).then((e=>{var t,n;return null!==(n=null===(t=e.layerDataElements)||void 0===t?void 0:t[0].dataElement.fieldGroups)&&void 0!==n?n:[]}))}))}function wi(e){return Ii(this,void 0,void 0,(function*(){if(!e)return[];const t=e.url,r=e.layerId,o=n.SessionManager.getInstance().getSessionByUrl(t),i=o&&o.token?o.token:"";return Ni({method:"POST",url:t+"/queryContingentValues",params:{f:"json",layers:JSON.stringify([r]),token:i}}).then((e=>e))}))}function Ri(e,t,n,r,o,i,a){const s={};if(re(r))if(-1===e&&-1===n)r.forEach((e=>{s[e.name]=e.value}));else{const t=r[n];r.forEach((n=>{s[n.name]=n.value,n.name===t.name&&(s[n.name]=e)}))}else a.forEach((e=>{const t=i.attributes[e.name],n=e.alias.split(".")[1];s[n]=t}));const l=[];for(const e of o){const t=e.isEditingRestrictive?"error":"warning";let n=!1;const r=e.contingencies.filter((e=>!e.isRetired));if(!r||0===r.length)return[];for(const e of r){let t=!0;for(const n in e.values){const r=e.values[n];if("any"!==r.objectType)if("null"===r.objectType){if(null!=s[n]){t=!1;break}}else if("code"===r.objectType){if(null!=r.codedValue&&s[n]!==r.codedValue.code){t=!1;break}}else if("range"===r.objectType){const e=s[n];if(null!=r.minValue&&null!=r.maxValue&&(e<r.minValue||e>r.maxValue)){t=!1;break}}}if(t){n=!0;break}}n||l.push({fieldGroup:e,type:t})}return l}function Fi(e,t,n){const r=e&&!Number.isNaN(e)?function(e,t){const n=e.domains;if(n)return n[t]||null;return null}(e,t):n.getFieldDomain(t);return"inherited"===(null==r?void 0:r.type)?n.getFieldDomain(t):r}function ki(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function xi(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}function Ti(e,t,n,r){const o=null==e?void 0:e.contingentValueSets;if(!o)return[];const i=null==o?void 0:o[0].fieldGroups;if(!i||0===(null==i?void 0:i.length))return[];return t.map((e=>{const t=i.find((t=>t.name===e.name));if(t){const i=t.contingencies.map((t=>{var i;const a=t.id,s=t.isRetired||!1,l=function(e,t){const n=null==t?void 0:t.sourceJSON;let r;n.subtypes&&(r=n.subtypes.find((t=>t.code===e)));return r||null}(t.subtypeCode,n);if(Number.isNaN(r)||(null==l?void 0:l.code)===r){const r={};for(let a=0;a<e.fields.length;a++){const s=e.fields[a];let u=t.values[a];if("number"==typeof u||"string"==typeof u){const e=Fi(l,s,n),t=n.getField(s);if(ki(t))u=o[0].stringDictionary[u];else if(xi(t)){const e=new Date(`${u}+00:00`);u=e.getTime()}const a={codedValue:null===(i=null==e?void 0:e.codedValues)||void 0===i?void 0:i.find((e=>e.code===u)),objectType:"code"};r[s]=a}else if("object"==typeof u){const e={minValue:u.minValue,maxValue:u.maxValue,objectType:"range"};r[s]=e}else if(u){const e={objectType:"any"};r[s]=e}else{const e={objectType:"null"};r[s]=e}}return{id:a,isRetired:s,subtype:l,values:r}}return null})),a=[];return null==i||i.forEach((e=>{null!==e&&a.push(e)})),{name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:a}}return[]}))}function Di(e){if(null==e)return null;const t=e.trim();let n="";for(let e=0;e<t.length;e++){const r=t.charCodeAt(e);n+=r>=48&&r<=57||r>=65&&r<=90||r>=97&&r<=122||95===r||r>=128&&r<=65535?t[e]:"_"}return(n[0]>="0"&&n[0]<="9"||"_"===n[0])&&(n="F"+n),n||null}const Ei=e=>{const t=[];if(null==e||0===(null==e?void 0:e.length))return[];for(const n of e){const e=[],{contingencies:r,fields:o,name:i}=n;for(const t of r)t.isRetired||e.push({values:t.values});e.length>0&&t.push({name:i,fields:o,contingencies:e})}return t};function Li(e,t){const n=new Map;if(!re(t))return[...n.values()];const r=Ei(t).slice();if(r)for(const t of r){const r=null==t?void 0:t.contingencies;for(const t of r){const r=null==t?void 0:t.values[e];if("code"===(null==r?void 0:r.objectType)||"null"===(null==r?void 0:r.objectType)){const{code:e,name:t}=r.codedValue&&"null"!==r.objectType?r.codedValue:{code:"",name:"No value"};n.has(e)||n.set(e,{name:t,code:e})}}}return[...n.values()]}function Mi(e){if(!e)return new Set;const t=e.flatMap((e=>e.fields));return new Set(t)}var ji=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function Ai(e,t){const n=t+e.id,r=e.view.map.findLayerById(n);re(r)&&e.view.map.remove(r)}function Oi(e,t,r,o,i,a){return ji(this,void 0,void 0,(function*(){const s=(yield(0,n.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]))[0],l=o+t.id,u=t.view.map.findLayerById(l);re(u)&&t.view.map.remove(u);const c={type:"text",color:i||[0,0,0],haloColor:[255,255,255,.8],haloSize:1,font:{size:a||12}},d=new s({id:l,listMode:"hide",legendEnabled:!1,title:l,geometryType:"point",source:[],objectIdField:"OBJECTID",elevationInfo:{mode:ci.DrawingElevationMode3D.RelativeToGround},hasZ:!0,hasM:!0,popupEnabled:!1,popupTemplate:null,outFields:["*"],labelsVisible:!0,screenSizePerspectiveEnabled:!1,fields:e,labelingInfo:[{labelExpressionInfo:{expression:r},symbol:c}]});return t.view.map.add(d),d}))}function Pi(e){return ji(this,void 0,void 0,(function*(){const t=yield(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/operators/lengthOperator"]),r=t[0],o=t[1].execute(e)/2;if(0<e.paths.length){const t=e.paths[0];let n,i,a,s,l,u,c,d,f,m=0;if(0===o)return e.getPoint(0,0);if(o>0)for(let p=1;p<t.length;p++){if(n=t[p-1][0],s=t[p-1][1],i=t[p][0],l=t[p][1],c=Ci(n,s,i,l),m+=c,m===o)return e.getPoint(0,p);if(m>o)return d=c-(m-o),f=Math.atan2(l-s,i-n),a=d*Math.cos(f),u=d*Math.sin(f),new r({x:n+a,y:s+u,spatialReference:{wkid:e.spatialReference.wkid}})}}return null}))}function Ci(e,t,n,r){return Math.sqrt(Math.pow(n-e,2)+Math.pow(r-t,2))}var Vi,_i,Ui=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function $i(e,t,n,r){return Ui(this,void 0,void 0,(function*(){const o=ie(t),i=t.useRouteName?r.attributes[o.routeNameFieldName]:"",a=r.attributes[o.routeIdFieldName],s=r.attributes[o.fromDateFieldName],l=r.attributes[o.toDateFieldName],u=r.geometry,c=oe(u),d=r.attributes[o.lineIdFieldName],f=r.attributes[o.lineNameFieldName];let m=new Date(Date.now());re(l)&&m>l?m=Re(s,n):m.setHours(0,0,0,0);let p=new Date(Date.now());return re(l)&&p>l?p=Re(l,n):p.setHours(0,0,0,0),re(l)||(p=null),yield We(n,t,c,s,a).then((r=>Ui(this,void 0,void 0,(function*(){const o=Math.min(...r),c=Math.max(...r);return Object.assign(Object.assign({},e),{routeName:i,routeId:a,fromDate:re(s)?Re(s,n):null,toDate:re(l)?Re(l,n):null,selectedPolyline:u,fromMeasure:q(o,t.measurePrecision),toMeasure:q(c,t.measurePrecision),validRoute:!0,selectedFromDate:m,selectedToDate:p,lineName:f,lineId:d})}))))}))}!function(e){e.network="NETWORK",e.event="EVENT",e.intersection="INTERSECTION",e.nonLrs="NONLRS"}(Vi||(Vi={})),function(e){e.Measure="ROUTEANDMEASURE",e.Coordinate="COORDINATE",e.LocationOffset="LOCATIONOFFSET",e.Referent="REFERENT",e.LineAndMeasure="LINEANDMEASURE"}(_i||(_i={}));var Gi=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((r=r.apply(e,t||[])).next())}))};function qi(e){var t,r,o,i,a;let s=[];if(!e)return s;const l=(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(o=null===(r=(0,n.getAppStore)().getState())||void 0===r?void 0:r.appStateInBuilder)||void 0===o?void 0:o.appConfig:null===(i=(0,n.getAppStore)().getState())||void 0===i?void 0:i.appConfig;if(!l)return s;const u=null===(a=l.widgets[e])||void 0===a?void 0:a.useDataSources;if(void 0!==u){u.map((e=>e.dataSourceId)).forEach((e=>{const t=n.DataSourceManager.getInstance().getDataSource(e),r=null==t?void 0:t.getDataSourcesByType(n.DataSourceTypes.FeatureLayer);r&&(s=s.concat(r))}))}return s}function Bi(e){let t=e;return t.includes("FeatureServer")&&(t=t.substring(0,t.indexOf("FeatureServer"))),t.includes("MapServer")&&(t=t.substring(0,t.indexOf("MapServer"))),t+"MapServer/exts/LRServer"}function zi(e){const t=qi(e),n=[];return t.forEach((e=>{var t;const r=Bi(null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url);n.includes(r)||n.push(r)})),n}function Wi(e,t,n){const r={},o=(null==n?void 0:n.fields)?Object.values(null==n?void 0:n.fields):[];r.networkUrl=t,r.datasetName=e.datasetName;const i=e.routeIdFieldName;r.routeIdFieldSchema=o.find((e=>i===e.name));const a=e.routeNameFieldName;r.routeNameFieldSchema=o.find((e=>a===e.name));const s=e.fromDateFieldName;r.fromDateFieldSchema=o.find((e=>s===e.name));const l=e.toDateFieldName;if(r.toDateFieldSchema=o.find((e=>l===e.name)),r.supportsLines=e.supportsLines,r.supportsLines){const t=null==e?void 0:e.lineIdFieldName;r.lineIdFieldSchema=o.find((e=>t===e.name));const n=null==e?void 0:e.lineNameFieldName;r.lineNameFieldSchema=o.find((e=>n===e.name));const i=null==e?void 0:e.lineOrderFieldName;r.lineOrderFieldSchema=o.find((e=>i===e.name))}r.useRouteName=e.supportsLines,re(a)&&i.length&&(r.useRouteName=!0),r.measurePrecision=e.measurePrecision,r.unitsOfMeasure=e.unitsOfMeasure,r.mTolerance=e.spatialReferenceInfo.mTolerance,r.xyTolerance=e.spatialReferenceInfo.xyTolerance,r.lrsNetworkId=e.lrsNetworkId;const u=[],c=e.eventLayers;c&&c.length>0&&c.forEach((e=>{u.push(e.name)})),r.eventLayers=u;const d=[],f=e.intersectionLayers;return f&&f.length>0&&f.forEach((e=>{d.push(e.name)})),r.intersectionLayers=d,r}function Hi(e,t,n,r){const o={},i=(null==n?void 0:n.fields)?Object.values(null==n?void 0:n.fields):[];o.datasetName=e.datasetName,o.eventUrl=t,o.fromDateFieldName=e.fromDateFieldName,o.toDateFieldName=e.toDateFieldName,o.derivedFromMeasureFieldName=e.derivedFromMeasureFieldName,o.derivedRouteIdFieldName=e.derivedRouteIdFieldName,o.derivedRouteNameFieldName=e.derivedRouteNameFieldName,o.derivedToMeasureFieldName=e.derivedToMeasureFieldName,o.fromReferentLocationFieldName=e.fromReferentLocationFieldName,o.fromReferentMethodFieldName=e.fromReferentMethodFieldName,o.fromReferentOffsetFieldName=e.fromReferentOffsetFieldName,o.toReferentLocationFieldName=e.toReferentLocationFieldName,o.toReferentMethodFieldName=e.toReferentMethodFieldName,o.toReferentOffsetFieldName=e.toReferentOffsetFieldName,o.locErrorFieldName=e.locErrorFieldName,o.eventIdFieldName=e.eventIdFieldName,o.routeIdFieldName=e.routeIdFieldName,o.routeNameFieldName=e.routeNameFieldName,o.fromMeasureFieldName=e.fromMeasureFieldName,o.toRouteIdFieldName=e.toRouteIdFieldName,o.toRouteNameFieldName=e.toRouteNameFieldName,o.toMeasureFieldName=e.toMeasureFieldName;const a=e.type;o.isPointEvent="esriLRSPointEventLayer"===a;const s=[o.fromDateFieldName,o.toDateFieldName,o.derivedFromMeasureFieldName,o.derivedRouteIdFieldName,o.derivedRouteNameFieldName,o.derivedToMeasureFieldName,o.fromReferentLocationFieldName,o.fromReferentMethodFieldName,o.fromReferentOffsetFieldName,o.toReferentLocationFieldName,o.toReferentMethodFieldName,o.toReferentOffsetFieldName,o.locErrorFieldName,o.eventIdFieldName,o.routeIdFieldName,o.routeNameFieldName,o.fromMeasureFieldName,o.toRouteIdFieldName,o.toRouteNameFieldName,o.toMeasureFieldName],l=null==r?void 0:r.objectIdField,u=null==r?void 0:r.globalIdField,c=null==r?void 0:r.editFieldsInfo,d=[l,u];c&&(d.push(c.creationDateField),d.push(c.creatorField),d.push(c.editDateField),d.push(c.editorField));const f=s.map((e=>re(e)?e.toLowerCase():e)),m=d.map((e=>re(e)?e.toLowerCase():e));o.lrsFields=i.filter((e=>f.includes(e.name.toLowerCase())));const p=i.filter((e=>!f.includes(e.name.toLowerCase())&&!m.includes(e.name.toLowerCase()))),h=[];return p.forEach((e=>{const t={field:e,enabled:!0,editable:!0,description:""};h.push(t)})),o.attributeFields=h,o.parentNetworkId=e.lrsNetworkId,o}function Qi(e,t){return Gi(this,void 0,void 0,(function*(){const r=e+"/attributeSets";let o=null;const i=n.SessionManager.getInstance().getSessionByUrl(t),a=i&&i.token?i.token:"";o=a?{f:"json",token:a}:{f:"json"};const s={attributeSet:[]};return yield $e({method:"GET",url:r,params:o}).then((e=>{const t=e.attributeSets;return re(t)&&t.forEach((e=>{const t={title:e.title,isDefault:e.isDefault,isPoint:e.isPoint,defaultSettings:e.defaultSettings,layers:e.layers};s.attributeSet.push(t)})),s})).catch((e=>null))}))}function Ki(e,t){if(!re(t))return!1;const n=t.at(e);return!re(n)||!re(n.eventInfo)||n.layerType!==Vi.event||t.findIndex((e=>re(e.networkInfo)&&e.networkInfo.lrsNetworkId===n.eventInfo.parentNetworkId))>-1}(0,t.registerStyles)("widgets/shared-code/lrs/ui",e)})(),d})())}}}));
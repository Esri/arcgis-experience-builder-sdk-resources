System.register(["jimu-core","jimu-ui/basic/guide","jimu-layouts/layout-runtime","jimu-ui","jimu-core/react","jimu-theme","jimu-for-builder","jimu-ui/basic/sql-expression-runtime","jimu-for-builder/templates"],(function(e,t){var i={},o={},n={},a={},s={},r={},l={},d={},u={};return{setters:[function(e){i.AllDataSourceTypes=e.AllDataSourceTypes,i.AppMode=e.AppMode,i.AppType=e.AppType,i.BrowserSizeMode=e.BrowserSizeMode,i.ContainerType=e.ContainerType,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceTypes=e.DataSourceTypes,i.ExtensionManager=e.ExtensionManager,i.Immutable=e.Immutable,i.IntlProvider=e.IntlProvider,i.Keyboard=e.Keyboard,i.LayoutItemType=e.LayoutItemType,i.LayoutParentType=e.LayoutParentType,i.LayoutType=e.LayoutType,i.MessageActionConnectionType=e.MessageActionConnectionType,i.MessageCarryData=e.MessageCarryData,i.MessageType=e.MessageType,i.PageType=e.PageType,i.React=e.React,i.ReactRedux=e.ReactRedux,i.ScreenTransitionType=e.ScreenTransitionType,i.SessionManager=e.SessionManager,i.SqlExpressionMode=e.SqlExpressionMode,i.WidgetManager=e.WidgetManager,i.WidgetType=e.WidgetType,i.appActions=e.appActions,i.appConfigUtils=e.appConfigUtils,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.defaultMessages=e.defaultMessages,i.esri=e.esri,i.extensionSpec=e.extensionSpec,i.getAppStore=e.getAppStore,i.hooks=e.hooks,i.i18n=e.i18n,i.injectIntl=e.injectIntl,i.jsx=e.jsx,i.loadDependencies=e.loadDependencies,i.lodash=e.lodash,i.moduleLoader=e.moduleLoader,i.observeStore=e.observeStore,i.polished=e.polished,i.urlUtils=e.urlUtils,i.utils=e.utils},function(e){o.EVENTS=e.EVENTS,o.GuideComponent=e.GuideComponent,o.STATUS=e.STATUS,o.findLayoutItem=e.findLayoutItem,o.getTargetSelector=e.getTargetSelector},function(e){n.searchUtils=e.searchUtils,n.utils=e.utils},function(e){a.Label=e.Label,a.Radio=e.Radio},function(e){s.PureComponent=e.PureComponent,s.createElement=e.createElement},function(e){r.withTheme=e.withTheme},function(){},function(e){d.getJimuFieldNamesBySqlExpression=e.getJimuFieldNamesBySqlExpression},function(e){u.getTemplateConfig=e.getTemplateConfig}],execute:function(){e((()=>{var e={1617:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M.007.883A1 1 0 0 1 1 0h10l.117.007A1 1 0 0 1 12 1v7l-.007.117A1 1 0 0 1 11 9H4l-4 3V1zM11 1H1v9l2.667-2H11zM3 3.5a.5.5 0 0 1 .5-.5h5a.5.5 0 0 1 0 1h-5a.5.5 0 0 1-.5-.5M3.5 5a.5.5 0 0 0 0 1h5a.5.5 0 0 0 0-1z" clip-rule="evenodd"></path></svg>'},3153:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M1.333 0h4c.737 0 1.334.597 1.334 1.333v1.334h8C15.403 2.667 16 3.264 16 4v10.667c0 .736-.597 1.333-1.333 1.333H1.333A1.333 1.333 0 0 1 0 14.667V1.333C0 .597.597 0 1.333 0m0 7.333v7.334h13.334V7.333zm0-1.333h13.334V4H5.334V1.335h-4z" clip-rule="evenodd"></path></svg>'},7528:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 2h12v4H2zM1 7V1h14v6zm1 3h12v4H2zm-1 5V9h14v6z" clip-rule="evenodd"></path></svg>'},9218:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2 2h12v12H2zM1 15V1h14v14zm4-9h6v4H5zm-1 5V5h8v6z" clip-rule="evenodd"></path></svg>'},8201:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M17 2a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM5 1h10a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1m2 2h6v6H7zm0 8h1v2H7zm2 0h1v1H9zm4 2h-1v1h1zm-6 1h1v1H7zm4 2h-1v1h1zm1-1h1v2h-1zm-3 2v-1H7v1zm2-6h2v1h-2z" clip-rule="evenodd"></path></svg>'},8850:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M3 3h7v7H3zM11 11h1v2h-1zM13 11h1v1h-1zM17 13h-1v1h1zM11 14h1v1h-1zM15 16h-1v1h1zM16 15h1v2h-1zM13 17v-1h-2v1zM15 11h2v1h-2z"></path><path fill="#000" fill-rule="evenodd" d="M20 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2zM2 1h16a1 1 0 0 1 1 1v16a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},9859:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M4 4h2v1H4zM8 4h2v1H8zM14 4h-2v1h2zM15 4h1v2h-1zM16 8h-1v2h1zM4 14h1v2H4zM5 6H4v2h1zM4 10h1v2H4zM16 12h-1v2h1zM16 15v1h-2v-1zM12 15h-2v1h2zM6 15h2v1H6z"></path><path fill="#000" fill-rule="evenodd" d="M18 0a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2zm0 1H2a1 1 0 0 0-1 1v16a1 1 0 0 0 1 1h16a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1" clip-rule="evenodd"></path></svg>'},1341:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" d="M3 7h6v6H3zM11 7h1v2h-1zM13 7h1v1h-1zM17 9h-1v1h1zM11 10h1v1h-1zM15 12h-1v1h1zM16 11h1v2h-1zM13 13v-1h-2v1zM15 7h2v1h-2z"></path><path fill="#000" fill-rule="evenodd" d="M20 5a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2zM2 4h16a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V5a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},2606:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M1.25 2.5h17.5v11.25H1.25zM0 2.5c0-.69.56-1.25 1.25-1.25h17.5c.69 0 1.25.56 1.25 1.25v11.25c0 .69-.56 1.25-1.25 1.25H1.25C.56 15 0 14.44 0 13.75zm3.75 16.25h2.5V17.5h-2.5zm7.5 0h-2.5V17.5h2.5zm2.5 0h2.5V17.5h-2.5z" clip-rule="evenodd"></path></svg>'},8736:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 20 20"><path fill="#000" fill-rule="evenodd" d="M14 2a2 2 0 0 0-2-2H2a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM2 1h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1" clip-rule="evenodd"></path><path fill="#000" fill-rule="evenodd" d="M20 8a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2zM8 7h10a1 1 0 0 1 1 1v10a1 1 0 0 1-1 1H8a1 1 0 0 1-1-1V8a1 1 0 0 1 1-1" clip-rule="evenodd"></path></svg>'},5037:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 40"><path fill="#A8A8A8" fill-rule="evenodd" d="M6 30v10H0v-1h5v-9zM3.162 18.582a.5.5 0 0 1 0 .71l-1.416 1.421a2.497 2.497 0 0 0-.003 3.545c.983.983 2.56.98 3.544-.003l1.42-1.42a.504.504 0 0 1 .712.713L6 24.968a3.5 3.5 0 0 1-4.967 0 3.5 3.5 0 0 1 0-4.967l1.416-1.422a.504.504 0 0 1 .713.003m4.967-.71a.5.5 0 0 1 0 .71L4.58 22.129a.504.504 0 0 1-.713-.712l3.548-3.548a.504.504 0 0 1 .713.003m2.838-2.838a3.5 3.5 0 0 1 0 4.967l-1.42 1.419a.504.504 0 0 1-.713-.712l1.423-1.417a2.5 2.5 0 0 0 0-3.547 2.5 2.5 0 0 0-3.547 0l-1.42 1.419a.504.504 0 0 1-.713-.712l1.42-1.42a3.506 3.506 0 0 1 4.97.003M6 0v10H5V1H0V0z"></path></svg>'},6490:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="m1.373 8 2.07-2.071.83.828L2.2 8.828a3.515 3.515 0 0 0 4.97 4.971l2.072-2.071.828.828L8 14.627A4.686 4.686 0 1 1 1.373 8M13.799 7.172l-2.071 2.07.828.83L14.627 8A4.686 4.686 0 1 0 8 1.373l-2.071 2.07.828.83L8.828 2.2a3.515 3.515 0 0 1 4.971 4.97"></path><path fill="#000" d="M5.515 9.657a.586.586 0 0 0 .828.828l4.142-4.142a.586.586 0 0 0-.828-.828z"></path></svg>'},5886:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 12 12"><path fill="#000" fill-rule="evenodd" d="M10.167 0H1.833A.845.845 0 0 0 1 .857v10.286c0 .473.373.857.833.857h8.334c.46 0 .833-.384.833-.857V.857A.845.845 0 0 0 10.167 0M2 11V1h8v10zm1.6-8h4.8c.331 0 .6.224.6.5s-.269.5-.6.5H3.6c-.331 0-.6-.224-.6-.5s.269-.5.6-.5m4.8 3H3.6c-.331 0-.6.224-.6.5s.269.5.6.5h4.8c.331 0 .6-.224.6-.5S8.731 6 8.4 6" clip-rule="evenodd"></path></svg>'},6976:(e,t,i)=>{"use strict";i.d(t,{AppMessageManager:()=>h});var o=i(9244);o.React.PureComponent;var n=i(8972),a=i(1888),s=i(876),r=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};const{getLocaleToLoad:l,loadLocaleMessages:d}=o.i18n;class u{static getInstance(){return u.instance||(u.instance=new u,window._widgetSettingManager=u.instance),u.instance}constructor(){this.settings={},(0,o.observeStore)(this.onStoreChange.bind(this),["appStateInBuilder","appConfig","widgets"])}getWidgetUri(e){var t,i,n;const a=null===(t=(0,o.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig;return null===(n=null===(i=null==a?void 0:a.widgets)||void 0===i?void 0:i[e])||void 0===n?void 0:n.uri}getWidgetManifestByUri(e){var t,i,n;const a=null===(i=null===(t=(0,o.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets,s=Object.keys(a||{}).find((t=>a[t].uri===e));return null===(n=a[s])||void 0===n?void 0:n.manifest}updateWidgetCache(e,t){if("__proto__"!==e&&"constructor"!==e&&"prototype"!==e){this.settings[e]||(this.settings[e]={});for(const i in t){if("__proto__"===i||"constructor"===i||"prototype"===i)return;this.settings[e][i]=t[i]}}}getWidgetSettingClass(e){var t;return null===(t=this.settings[this.getWidgetUri(e)])||void 0===t?void 0:t.settingClazz}destroyWidgetSettingClass(e){const t=this.getWidgetUri(e);t&&delete this.settings[t]}destroyWidgetSettingClassByUri(e){this.checkWidgetUriInConfig(e)||delete this.settings[e]}getItemSettingClass(e){var t;return null===(t=this.settings[this.getWidgetUri(e)])||void 0===t?void 0:t.itemSettingClazz}getSettingI18nMessagesByUri(e){var t;return null===(t=this.settings[e])||void 0===t?void 0:t.settingI18nMessage}destroyAllWidgetSettingClasses(){this.settings={}}loadWidgetSettingClass(e){return r(this,void 0,void 0,(function*(){var t,i,n;const a=null===(n=null===(i=null===(t=(0,o.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||void 0===n?void 0:n[e];if(!a)return yield Promise.resolve(null);if(!a.manifest)return yield Promise.resolve(null);const s=this.getWidgetUri(e);return this.loadWidgetSettingClassByUri(s)}))}checkWidgetUriInConfig(e){var t,i;const n=(null===(i=null===(t=(0,o.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||{};return!!Object.keys(n).find((t=>n[t].uri===e))}loadWidgetSettingClassByUri(e){return this.settings[e]||(this.settings[e]={}),this.settings[e].settingClazzPromise||(this.settings[e].settingClazzPromise=this.loadRawSettingClass(e).then((()=>r(this,void 0,void 0,(function*(){return yield this.loadI18nMessagesForSetting(e)})))).then((()=>{const t=this.injectWidgetSettingProps(e);return t?(this.settings[e].settingClazz=t,(0,o.getAppStore)().dispatch(s.Zv.widgetSettingClassLoaded(e)),t):(delete this.settings[e],null)}))),this.settings[e].settingClazzPromise}loadRawSettingClass(e){return r(this,void 0,void 0,(function*(){const t=this.getWidgetManifestByUri(e);let i=`${e}dist/setting/setting`;return t.properties.hasSettingPage||(i="jimu-for-builder/json-editor-setting"),yield this.loadWidgetSettingDependency(e).then((()=>r(this,void 0,void 0,(function*(){return yield o.moduleLoader.loadModule(i)})))).then((t=>{const i=t.default?t.default:t;return this.settings[e].rawSettingClazz=i,i}))}))}loadI18nMessagesForSetting(e){return r(this,void 0,void 0,(function*(){if(this.settings[e]||(this.settings[e]={}),this.settings[e].settingI18nMessagePromise)return yield this.settings[e].settingI18nMessagePromise;const t=this.getWidgetManifestByUri(e);if(!t)return yield Promise.resolve({});if(t.translatedLocales){let i=(0,o.getAppStore)().getState().appContext.locale;i=l(i,t.translatedLocales),this.settings[e].settingI18nMessagePromise=i?d(`${e}dist/setting/translations`,i):Promise.resolve({})}else this.settings[e].settingI18nMessagePromise=Promise.resolve({});return yield this.settings[e].settingI18nMessagePromise.then(((i={})=>((0,o.getAppStore)().dispatch(s.Zv.widgetSettingI18nMessageLoaded(t.name,i)),this.settings[e].settingI18nMessage=i,i)))}))}loadWidgetSettingDependency(e){return r(this,void 0,void 0,(function*(){const t=this.getWidgetManifestByUri(e);if(!t.settingDependency)return void(yield Promise.resolve());const i="string"==typeof t.settingDependency?[t.settingDependency]:t.settingDependency;yield(0,o.loadDependencies)(i)}))}loadItemSettingClass(e){return r(this,void 0,void 0,(function*(){var t,i,n;const a=null===(n=null===(i=null===(t=(0,o.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig)||void 0===i?void 0:i.widgets)||void 0===n?void 0:n[e];return a&&a.manifest?yield this.loadItemSettingClassByUri(this.getWidgetUri(e)):yield Promise.resolve(null)}))}loadItemSettingClassByUri(e){return r(this,void 0,void 0,(function*(){return this.settings[e]||(this.settings[e]={}),this.settings[e].itemSettingClazzPromise||(this.settings[e].itemSettingClazzPromise=this.loadRawItemSettingClass(e).then((t=>(this.settings[e].itemSettingClazz=t,t)))),this.settings[e].itemSettingClazzPromise}))}loadRawItemSettingClass(e){return r(this,void 0,void 0,(function*(){const t=`${e}dist/setting/item-setting`;return yield o.moduleLoader.loadModule(t).then((e=>e.default?e.default:e))}))}injectWidgetSettingProps(e){if(!this.checkWidgetUriInConfig(e))return null;const t=this.settings[e].rawSettingClazz,i=(0,o.injectIntl)(t),s=(0,a.withTheme)(i,!0),r=this.getWidgetManifestByUri(e),l=r.name,d=this.settings[e].settingI18nMessage;class u extends n.PureComponent{constructor(e){super(e),this.state={fullConfig:null}}componentDidMount(){t.getFullConfig&&this.setState({fullConfig:t.getFullConfig(this.props.config)})}componentDidUpdate(e){t.getFullConfig&&e.config!==this.props.config&&this.setState({fullConfig:t.getFullConfig(this.props.config)})}getFullConfig(e){return t.getFullConfig?t.getFullConfig(e):e}render(){if(r.version!==this.props.version)return null;const e={messages:d,savedConfig:this.props.config};this.state.fullConfig?e.config=this.state.fullConfig:e.config=this.getFullConfig(this.props.config);const t=Object.assign({},d,this.props.appI18nMessages);return n.createElement(o.IntlProvider,{locale:this.props.locale,defaultLocale:this.props.locale,messages:t},n.createElement(s,Object.assign({},this.props,e)))}}u.displayName=`WidgetSettingWrapper(${l})`;return o.ReactRedux.connect(((e,i)=>{const o={queryObject:e.queryObject,user:e.user,portalUrl:e.portalUrl,portalSelf:e.portalSelf,locale:e.appContext.locale,appI18nMessages:e.appI18nMessages},n=i.widgetId,a=e.appStateInBuilder.appConfig.widgets[n],s=e.appStateInBuilder.widgetsRuntimeInfo[n];if(!a)return{};const r=Object.assign(o,a,i,s);return Object.assign(r,t.mapExtraStateProps?t.mapExtraStateProps(e,r):{})}))(u)}onStoreChange(e,t){e&&t&&Object.keys(e).forEach((e=>{t[e]}))}}const c=u;var p=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};const{getTranslatedLocale:g}=o.i18n;class h{constructor(){this.actionSettings={}}static getInstance(){return h.instance||(h.instance=new h),h.instance}getAllActions(){const e=this.getAppMessageManager();return e?e.getActions():[]}getAction(e,t){const i=this.getAppMessageManager();return i?i.getAction(e,t):null}getAppMessageManager(){if(window.jimuConfig.isBuilder){if(window._appWindow._messageManager)return window._appWindow._messageManager}else if(window._messageManager)return window._messageManager;return null}getActionSettingComponentUri(e,t,i){if(e.getSettingComponentUri)return e.getSettingComponentUri(t,i);if(e.widgetId){const t=(0,o.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e.widgetId].manifest.messageActions.find((t=>t.name===e.name));return t?t.settingUri:null}return null}getFilteredActions(e,t){if(window._appWindow._messageManager){const i=window._appWindow._messageManager.getActions(),n=[],a={messageType:e,widgetId:t},s=(window.jimuConfig.isBuilder?(0,o.getAppStore)().getState().appStateInBuilder:(0,o.getAppStore)().getState()).appConfig.widgets[t].manifest.publishMessages.find((t=>"string"==typeof t?t===e:t.messageType===e));s&&"string"!=typeof s&&(a.messageCarryData=s.messageCarryData);for(let e=0;e<i.length;e++)i[e].filterMessageDescription(a)&&n.push(i[e]);return n}return[]}getConvertedSettingUri(e,t){const i=this.getAllActions();let n=null;for(let a=0;a<i.length;a++)if(e.includes(i[a].id)){const e=i[a].widgetId;if(e){const s=(0,o.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e],r=s.manifest.messageActions;let l=null;if(r)for(let e=0;e<r.length;e++)r[e].name===i[a].name&&(l=r[e]);return l&&t?(n=s.uri+"dist/"+t,n):null}return t}return n}loadActionSettingClass(e,t){return p(this,void 0,void 0,(function*(){var i;const n=t?this.getConvertedSettingUri(e.actionId,t):null;if(n||Promise.resolve(null),this.actionSettings[n]||(this.actionSettings[n]={}),null===(i=this.actionSettings[n])||void 0===i?void 0:i.clazzPromise)return yield this.actionSettings[n].clazzPromise;const a=e.widgetId,s=(0,o.getAppStore)().getState().appStateInBuilder.appConfig.widgets[a];return a&&(yield this.loadDependency(a)),this.actionSettings[n].clazzPromise=this.loadRawSettingClass(n).then((e=>p(this,void 0,void 0,(function*(){return c.getInstance().loadI18nMessagesForSetting(s&&s.uri).then((t=>this.injectActionSettingProps(e,t,s&&s.id)))})))).then((e=>(this.actionSettings[n].clazz=e,e))),this.actionSettings[n].clazzPromise}))}loadRawSettingClass(e){return p(this,void 0,void 0,(function*(){return this.actionSettings[e].rawClazzPromise?yield this.actionSettings[e].rawClazzPromise:(this.actionSettings[e].rawClazzPromise=o.moduleLoader.loadModule(e).then((t=>(t=t.default?t.default:t,this.actionSettings[e].rawClazz=t,this.actionSettings[e].rawClazz))),this.actionSettings[e].rawClazzPromise)}))}loadDependency(e){return p(this,void 0,void 0,(function*(){var t;const i=null===(t=(0,o.getAppStore)().getState().appStateInBuilder.appConfig.widgets[e])||void 0===t?void 0:t.manifest;if(!(null==i?void 0:i.settingDependency))return Promise.resolve();const n="string"==typeof i.dependency?[i.dependency]:i.dependency.asMutable();return(0,o.loadDependencies)(n)}))}injectActionSettingProps(e,t,i){const n=(0,o.injectIntl)(e),a=(0,o.getAppStore)().getState().appStateInBuilder.appConfig.widgets[i];let s=null;s=i&&a?(0,o.getAppStore)().getState().appStateInBuilder.appConfig.widgets[i].manifest.name:"Framework";class r extends o.React.PureComponent{render(){const e={messages:t},s=(0,o.getAppStore)().getState().appI18nMessages;let r=null;i&&a?(r=g((0,o.getAppStore)().getState().appContext.locale,a.manifest.translatedLocales.asMutable()),r||(r=a.manifest.translatedLocales&&a.manifest.translatedLocales[0]),r||(r=(0,o.getAppStore)().getState().appContext.locale)):r=(0,o.getAppStore)().getState().appContext.locale;const l=Object.assign({},t,s);return o.React.createElement(o.IntlProvider,{locale:r,messages:l},o.React.createElement(n,Object.assign({},this.props,e)))}}r.displayName=`ActionSettingWrapper(${s})`;for(const t in e)r[t]||(r[t]=e[t]);return r}registerActionRawSettingClass(e,t){this.actionSettings[e]||(this.actionSettings[e]={}),this.actionSettings[e].rawClazz=t,this.actionSettings[e].rawClazzPromise=Promise.resolve(t),this.actionSettings[e].settingI18nMessages={},this.actionSettings[e].settingI18nMessagesPromise=Promise.resolve({})}getActionRawSettingClass(e){return this.actionSettings[e].rawClazz}}i(4617);const{getTranslatedLocale:f}=o.i18n;i(4601),i(1575);var y=i(2241);i(3209),i(4108),i(1496);var m=i(3596);i(1169);let v;try{const e=o.utils.getParentWindow();v=null==e?void 0:e._builderPubsub}catch(e){console.error("Can access parent.")}var S=i(4981),I=i(4321);i(5886),i(6490),i(3153),i(1617),i(8736),i(9859);i(6546);i(8249),i(7659);class C extends o.React.PureComponent{constructor(){super(...arguments),this.isSupportKeyboard=()=>{let e=!1;return window.jimuConfig.isBuilder&&"home"!==this.props.currentPageId&&"template"!==this.props.currentPageId?(e=!0,e):e},this.switchAppMode=()=>{var e,t;(null===(t=null===(e=(0,o.getAppStore)().getState().appStateInBuilder)||void 0===e?void 0:e.appRuntimeInfo)||void 0===t?void 0:t.appMode)===o.AppMode.Run?m.publishAppModeChangeToApp(o.AppMode.Design):m.publishAppModeChangeToApp(o.AppMode.Run)},this.undo=()=>{this.props.stateHistory.past.length<=1||(0,o.getAppStore)().dispatch(y.yx.InBuilderAppConfigUndo())},this.redo=()=>{this.props.stateHistory.future.length<=0||(0,o.getAppStore)().dispatch(y.yx.InBuilderAppConfigRedo())},this.onKeyboardTrigger=e=>{e.key.includes("-manual")||m.publishKeyboardToApp(e)},this.isMac=()=>{var e,t;return"macOS"===(null===(t=null===(e=window.jimuUA)||void 0===e?void 0:e.os)||void 0===t?void 0:t.name)}}render(){return this.isMac()?this.isSupportKeyboard()?o.React.createElement(o.Keyboard,{onKeyboardTrigger:this.onKeyboardTrigger,bindings:{"shift+alt+keyx":()=>{this.switchAppMode()},"command+keyz":()=>{this.undo()},"command+shift+keyz":()=>{this.redo()}}}):null:this.isSupportKeyboard()?o.React.createElement(o.Keyboard,{onKeyboardTrigger:this.onKeyboardTrigger,bindings:{"shift+alt+keyx":()=>{this.switchAppMode()},"ctrl+keyz":()=>{this.undo()},"ctrl+shift+keyz":()=>{this.redo()}}}):null}}o.ReactRedux.connect((e=>({currentPageId:e.appRuntimeInfo.currentPageId,stateHistory:e.appStateHistory})))(C);const w=e=>{const{messageDataSource:t,actionDataSource:i,connectionType:n,onUseLayersRelationship:a,onSetCustomFields:s}=e,[r,l]=o.React.useState(!1),d=o.hooks.useLatest(n);o.React.useEffect((()=>{if(!t||!i)return;const e=o.dataSourceUtils.getMainOriginDataSource(t),n=o.dataSourceUtils.getMainOriginDataSource(i),a=()=>{d.current===o.MessageActionConnectionType.UseLayersRelationship&&s()};(null==e?void 0:e.createRelatedDataSources)?e.createRelatedDataSources().then(((e=[])=>{e.includes(n)?l(!0):(l(!1),a())})):(l(!1),a())}),[t,i,d,s]),o.React.useEffect((()=>{d.current||(r?a():s())}),[r,d,s,a]);const u=o.hooks.useTranslation(S.A);return r?(0,o.jsx)(o.React.Fragment,null,(0,o.jsx)(I.Label,{className:"justify-content-start",onClick:a},(0,o.jsx)(I.Radio,{className:"mr-2",role:"radio",checked:n===o.MessageActionConnectionType.UseLayersRelationship}),u("frameworkAction_UseRelationship")),(0,o.jsx)(I.Label,{className:"mt-3 justify-content-start",onClick:s},(0,o.jsx)(I.Radio,{className:"mr-2",role:"radio",checked:!n||n===o.MessageActionConnectionType.SetCustomFields}),u("frameworkAction_CustomFields"))):null};function b(e,t){var i,n,a;const s=M(e),r=D(e,t),l=null===(n=null===(i=(0,o.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===n?void 0:n.appConfig,d=null===(a=null==l?void 0:l.widgets)||void 0===a?void 0:a[e];let u=(null==d?void 0:d.useDataSources)?null==d?void 0:d.useDataSources:s;u=u||(0,o.Immutable)([]);const c=function(e){var t;const i=null!==(t=null==e?void 0:e.map((e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}))))&&void 0!==t?t:[];return(0,o.Immutable)(i)}(null==d?void 0:d.outputDataSources)||(0,o.Immutable)([]),p=null==u?void 0:u.asMutable({deep:!0}).concat(null==c?void 0:c.asMutable({deep:!0}));switch(r){case o.MessageCarryData.OutputDataSource:return c;case o.MessageCarryData.UseDataSource:return u;case o.MessageCarryData.BothDataSource:return(0,o.Immutable)(p)}}function D(e,t){const i=function(e,t){var i,n,a,s;const r=null===(n=null===(i=(0,o.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===n?void 0:n.appConfig,l=null===(a=null==r?void 0:r.widgets)||void 0===a?void 0:a[e],d=null===(s=null==l?void 0:l.manifest)||void 0===s?void 0:s.publishMessages;let u=null;return d.forEach((e=>{const i=e;(null==i?void 0:i.messageCarryData)&&(null==i?void 0:i.messageType)===t&&(u=null==i?void 0:i.messageCarryData)})),u}(e,t);return i||o.MessageCarryData.UseDataSource}function M(e){const t=[],i=x(e),n=null==i?void 0:i.useMapWidgetIds,a={};return(null==n?void 0:n.length)>0&&n.forEach((e=>{if(e){const i=x(e),o=null==i?void 0:i.useDataSources;o&&o.forEach((e=>{var i;const o=null===(i=null==e?void 0:e.asMutable)||void 0===i?void 0:i.call(e,{deep:!0});o&&o.dataSourceId&&!a[o.dataSourceId]&&(a[o.dataSourceId]=!0,t.push(o))}))}})),(0,o.Immutable)(t)}function x(e){var t;if(!e)return null;const i=function(){var e,t,i;return window.jimuConfig.isBuilder?null===(t=null===(e=(0,o.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig:null===(i=(0,o.getAppStore)().getState())||void 0===i?void 0:i.appConfig}();return null===(t=null==i?void 0:i.widgets)||void 0===t?void 0:t[e]}i(3557);var A=i(6117);function T(e){var t,i,n;const{widgetId:a,useDataSource:s,messageType:r,arcGISDataSourceTypes:l}=e,d=null===(i=null===(t=(0,o.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===i?void 0:i.appConfig,u=null===(n=null==d?void 0:d.widgets)||void 0===n?void 0:n[a],c=function(e,t){var i,n,a;const s=null===(n=null===(i=(0,o.getAppStore)().getState())||void 0===i?void 0:i.appStateInBuilder)||void 0===n?void 0:n.appConfig,r=null===(a=null==s?void 0:s.widgets)||void 0===a?void 0:a[e],l=[],d=o.DataSourceManager.getInstance(),u=M(e),c=(null==r?void 0:r.useDataSources)?null==r?void 0:r.useDataSources:u;return null==c||c.forEach((e=>{const i=d.getDataSource(e.dataSourceId);(null==i?void 0:i.type)!==t.WebMap&&(null==i?void 0:i.type)!==t.WebScene||l.push(e.dataSourceId)})),l.length>0?(0,o.Immutable)(l):null}(a,l),p=function(e,t,i){const n=(null==e?void 0:e.outputDataSources)||[],a=(null==e?void 0:e.useDataSources)||[];if(i)return!1;switch(t){case o.MessageCarryData.OutputDataSource:return 1===(null==n?void 0:n.length);case o.MessageCarryData.UseDataSource:return 1===(null==a?void 0:a.length);case o.MessageCarryData.BothDataSource:return 1===n.length+a.length}}(u,D(a,r),c),g=s&&s.dataSourceId?(0,o.Immutable)([s.asMutable({deep:!0})]):null,h=c?null:function(e,t){var i;const n=b(e,t);return(0,o.Immutable)(null!==(i=null==n?void 0:n.map((e=>null==e?void 0:e.mainDataSourceId)))&&void 0!==i?i:[])}(a,r);return{isReadOnly:p,useDataSources:g,fromRootDsIds:c,fromDsIds:h}}function L(e){var t,i,n,a,s,r,l,d,u,c,p,g,h,f,y,m,v,S;const{widgetId:I,oldUseDataSource:C,messageType:w,arcGISDataSourceTypes:D}=e,x=(0,o.getAppStore)().getState().appStateInBuilder.appConfig,A=o.DataSourceManager.getInstance(),T=x.widgets[I],L=M(I),P=(null==T?void 0:T.useDataSources)?null==T?void 0:T.useDataSources:L;let E=null,k=!1;const j=null===(i=null===(t=A.getDataSource(C.dataSourceId))||void 0===t?void 0:t.getDataSourceJson())||void 0===i?void 0:i.isOutputFromWidget,U=b(I,w),_=(null==U?void 0:U[0])&&(null===(n=null==U?void 0:U[0])||void 0===n?void 0:n.dataSourceId);if(!_)return null;const O=null===(a=A.getDataSource(_))||void 0===a?void 0:a.getDataSourceJson();if(!O||O.type!==D.WebMap&&O.type!==D.WebScene||(k=!0),k){let e=!1;if(T&&P)for(let t=0;t<P.length;t++)if(P[t].dataSourceId===C.rootDataSourceId){e=!0;break}E=e?C:null}else{let e=!1;if(U)for(let t=0;t<(null==U?void 0:U.length);t++){const i=j?null===(r=null===(s=A.getDataSource(C.dataSourceId))||void 0===s?void 0:s.getMainDataSource())||void 0===r?void 0:r.id:C.dataSourceId,n=j?null===(u=null===(d=A.getDataSource(null===(l=null==U?void 0:U[t])||void 0===l?void 0:l.dataSourceId))||void 0===d?void 0:d.getMainDataSource())||void 0===u?void 0:u.id:null===(c=null==U?void 0:U[t])||void 0===c?void 0:c.mainDataSourceId;let a=(j?null===(h=null===(g=A.getDataSource(null===(p=null==U?void 0:U[t])||void 0===p?void 0:p.dataSourceId))||void 0===g?void 0:g.getMainDataSource())||void 0===h?void 0:h.id:null===(f=null==U?void 0:U[t])||void 0===f?void 0:f.dataSourceId)===i;if(w===o.MessageType.DataRecordsSelectionChange&&(a=i===n),a){e=!0;break}}E=e?C:1===(null==U?void 0:U.length)?(0,o.Immutable)({dataSourceId:null===(y=null==U?void 0:U[0])||void 0===y?void 0:y.dataSourceId,mainDataSourceId:null===(m=null==U?void 0:U[0])||void 0===m?void 0:m.mainDataSourceId,dataViewId:null===(v=null==U?void 0:U[0])||void 0===v?void 0:v.dataViewId,rootDataSourceId:null===(S=null==U?void 0:U[0])||void 0===S?void 0:S.rootDataSourceId}):null}return E}function P(e){return!(!e.messageUseDataSource||!e.actionUseDataSource)&&!(e.messageUseDataSource.mainDataSourceId!==e.actionUseDataSource.mainDataSourceId||!function(e){return!e.messageUseDataSource.rootDataSourceId&&!e.actionUseDataSource.rootDataSourceId||e.messageUseDataSource.rootDataSourceId===e.actionUseDataSource.rootDataSourceId}(e))}function E(e){let t;return t=Array.isArray(e)?_(e):U(e),t}function k(e,t){var i,n,a;const s=o.DataSourceManager.getInstance();if(t){const o=null==t?void 0:t.dataSourceId,r=null==t?void 0:t.rootDataSourceId,l=(null===(i=s.getDataSource(o))||void 0===i?void 0:i.getDataSourceJson())||(null===(n=s.getDataSource(r))||void 0===n?void 0:n.getDataSourceJson()),d=(null===(a=null==e?void 0:e.filter((e=>e.dataSourceId===o)))||void 0===a?void 0:a.length)>0;return l&&d?t:null}return null}function j(e,t){let i=!1,o=e,n=null==e?void 0:e.actionUseDataSource;return n&&(n=k(t,n),n||(i=!0,o=o.set("actionUseDataSource",null))),{isConfigChange:i,newActionConfig:o}}const U=e=>{var t;const i=null==e?void 0:e.asMutable({deep:!0});let n=[];const a=null==i?void 0:i.actionUseDataSource,s=null==i?void 0:i.messageUseDataSource;if(s&&n.push(s),a){const e=(null==i?void 0:i.sqlExprObj)||null,r=(0,A.getJimuFieldNamesBySqlExpression)((0,o.Immutable)(e))||[],l=(null==a?void 0:a.fields)||[];let d=(0,o.Immutable)(a).set("fields",Array.from(new Set(l.concat(r))));(null==s?void 0:s.dataSourceId)===a.dataSourceId&&(n=[],(null===(t=null==s?void 0:s.fields)||void 0===t?void 0:t.length)>0&&(d=d.set("fields",Array.from(new Set(d.fields.concat(s.fields)))))),n.push(null==d?void 0:d.asMutable({deep:!0}))}return n},_=e=>{const t=null==e?void 0:e.asMutable({deep:!0}),i={};return t.forEach((e=>{U((0,o.Immutable)(e)).forEach((e=>{if(null==i?void 0:i[e.dataSourceId]){let t=i[e.dataSourceId].fields||[];t=t.concat((null==e?void 0:e.fields)||[]),t=Array.from(new Set(t)),i[e.dataSourceId].fields=t}else i[e.dataSourceId]=e}))})),Object.keys(i).map((e=>i[e]))};var O=i(5037),z=i.n(O),B=function(e,t){var i={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(i[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(o=Object.getOwnPropertySymbols(e);n<o.length;n++)t.indexOf(o[n])<0&&Object.prototype.propertyIsEnumerable.call(e,o[n])&&(i[o[n]]=e[o[n]])}return i};const W=e=>{const t=window.SVG,{className:i}=e,n=B(e,["className"]),a=(0,o.classNames)("jimu-icon jimu-icon-component",i);return t?o.React.createElement(t,Object.assign({className:a,src:z()},n)):o.React.createElement("svg",Object.assign({className:a},n))};class R extends o.React.PureComponent{constructor(e){super(e),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.getInitConfig=()=>{var e,t,i,n,a;const{messageWidgetId:s,messageType:r,config:l}=this.props,d=o.DataSourceManager.getInstance();let u=null,c=!0;const p=this.getMessageUseDataSource();if(p)u=L({widgetId:s,oldUseDataSource:p,messageType:r,arcGISDataSourceTypes:o.DataSourceTypes});else{const l=b(s,r);if((null==l?void 0:l[0])&&1===(null==l?void 0:l.length)){const s=null===(e=d.getDataSource(null==l?void 0:l[0].dataSourceId))||void 0===e?void 0:e.getDataSourceJson();u=!s||s.type!==o.DataSourceTypes.WebMap&&s.type!==o.DataSourceTypes.WebScene?(0,o.Immutable)({dataSourceId:null===(t=null==l?void 0:l[0])||void 0===t?void 0:t.dataSourceId,mainDataSourceId:null===(i=null==l?void 0:l[0])||void 0===i?void 0:i.mainDataSourceId,dataViewId:null===(n=null==l?void 0:l[0])||void 0===n?void 0:n.dataViewId,rootDataSourceId:null===(a=null==l?void 0:l[0])||void 0===a?void 0:a.rootDataSourceId}):null}}const g=Array.isArray(l)?null==l?void 0:l[0]:l;if(void 0!==(null==g?void 0:g.enableQueryWithCurrentExtent)&&(c=g.enableQueryWithCurrentExtent),r===o.MessageType.ExtentChange){if(Array.isArray(l))return null==l?void 0:l.map((e=>this.getInitActionConfigItem(u,c,e)));return[l?this.getInitActionConfigItem(u,c,l):this.getInitActionConfigItem(u,c,null)]}return this.getInitActionConfigItem(u,c,l)},this.getInitActionConfigItem=(e,t,i)=>{const{useDataSources:o}=this.props,n=k(o,null==i?void 0:i.actionUseDataSource);return{messageUseDataSource:e,actionUseDataSource:n,sqlExprObj:(null==n?void 0:n.dataSourceId)?i.sqlExprObj:null,enableQueryWithCurrentExtent:t}},this.onSettingChange=e=>{const t=E(e);this.props.onSettingChange({actionId:this.props.actionId,config:e,useDataSources:t})},this.handleTriggerLayerChange=e=>{let t=this.props.config;Array.isArray(t)?t=null==t?void 0:t.map((t=>t=t.set("messageUseDataSource",(null==e?void 0:e[0])||null))):(t=t.set("messageUseDataSource",(null==e?void 0:e[0])||null),0===e.length&&(t=t.set("connectionType",null))),this.onSettingChange(t)},this.handleActionLayerChange=e=>{let t=this.props.config;if(Array.isArray(t)){const i={messageUseDataSource:this.getMessageUseDataSource(),actionUseDataSource:null,sqlExprObj:null,enableQueryWithCurrentExtent:!0,enabledDataRelationShip:!0};if(0===(null==e?void 0:e.length))t=(0,o.Immutable)([i]);else{const n=null==e?void 0:e.map((e=>Object.assign(Object.assign({},i),{actionUseDataSource:e})));t=(0,o.Immutable)(n)}}else t=t.set("actionUseDataSource",(null==e?void 0:e[0])||null).set("sqlExprObj",null),0===e.length&&(t=t.set("connectionType",null));this.onSettingChange(t)},this.showSqlExprPopup=()=>{this.setState({isSqlExprShow:!0})},this.toggleSqlExprPopup=()=>{this.setState({isSqlExprShow:!this.state.isSqlExprShow})},this.onSqlExprBuilderChange=e=>{this.handleActionConditionsChange("sqlExprObj",e)},this.handleActionConditionsChange=(e,t)=>{const{config:i}=this.props;let n=i;if(Array.isArray(i)&&1===(null==i?void 0:i.length)){const i=n[0].set(e,t);n=(0,o.Immutable)([i])}else n=i.set(e,t);this.onSettingChange(n)},this.onMessageFieldSelected=(e,t)=>{const{config:i}=this.props,o=i.set("messageUseDataSource",{dataSourceId:i.messageUseDataSource.dataSourceId,mainDataSourceId:i.messageUseDataSource.mainDataSourceId,dataViewId:i.messageUseDataSource.dataViewId,rootDataSourceId:i.messageUseDataSource.rootDataSourceId,fields:e.map((e=>e.jimuName))});this.onSettingChange(o)},this.onActionFieldSelected=(e,t)=>{const{config:i}=this.props,o=i.set("actionUseDataSource",{dataSourceId:i.actionUseDataSource.dataSourceId,mainDataSourceId:i.actionUseDataSource.mainDataSourceId,dataViewId:i.actionUseDataSource.dataViewId,rootDataSourceId:i.actionUseDataSource.rootDataSourceId,fields:e.map((e=>e.jimuName))});this.onSettingChange(o)},this.switchEnabledDataRelationShip=e=>{this.onSettingChange(this.props.config.set("enabledDataRelationShip",e))},this.switchEnabledQueryWithCurrentExtent=e=>{this.handleActionConditionsChange("enableQueryWithCurrentExtent",e)},this.checkIsDisableDataView=e=>{var t,i,n,a;if(this.props.messageType===o.MessageType.DataRecordsSelectionChange)return!0;const s=null===(i=null===(t=(0,o.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===i?void 0:i.appConfig,r=null===(n=null==s?void 0:s.widgets)||void 0===n?void 0:n[e];if(r){return"Map"===(null===(a=null==r?void 0:r.manifest)||void 0===a?void 0:a.label)}return!1},this.onUseLayersRelationship=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",o.MessageActionConnectionType.UseLayersRelationship);this.onSettingChange(e)},this.onSetCustomFields=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",o.MessageActionConnectionType.SetCustomFields);this.onSettingChange(e)},this.checkIsShowFrameworkActionConditions=()=>{var e;return!(window.isExpressBuilder||!(null===(e=this.props.config)||void 0===e?void 0:e.actionUseDataSource)||!this.props.config.messageUseDataSource||Array.isArray(this.props.config))},this.getMessageUseDataSource=()=>{var e;const{config:t}=this.props;return Array.isArray(t)?null===(e=t[0])||void 0===e?void 0:e.messageUseDataSource:null==t?void 0:t.messageUseDataSource},this.checkIsNotRenderActionSetting=()=>{const{Button:e,Icon:t,Switch:i,Collapse:o,SettingSection:n,SettingRow:a,FieldSelector:s,DataSourceSelector:r,SqlExpressionBuilderPopup:l}=this.state;return!(e&&t&&i&&o&&n&&a&&s&&r&&l)},this.renderFrameworkActionConditions=()=>{var e,t;const{Button:i,Switch:n,Collapse:a,SettingSection:s,SettingRow:r,FieldSelector:l,SqlExpressionBuilderPopup:d}=this.state,{config:u,theme:c}=this.props,p=u.messageUseDataSource&&o.DataSourceManager.getInstance().getDataSource(this.props.config.messageUseDataSource.dataSourceId),g=u.actionUseDataSource&&o.DataSourceManager.getInstance().getDataSource(u.actionUseDataSource.dataSourceId),h=P(u),f=!u.connectionType||u.connectionType===o.MessageActionConnectionType.SetCustomFields;return(0,o.jsx)(s,{title:this.props.intl.formatMessage({id:"frameworkAction_Conditions",defaultMessage:S.A.frameworkAction_Conditions})},(0,o.jsx)(r,{tag:"label",label:this.props.intl.formatMessage({id:"frameworkAction_RelateMessage",defaultMessage:S.A.frameworkAction_RelateMessage})},(0,o.jsx)(n,{checked:this.props.config.enabledDataRelationShip,onChange:e=>{this.switchEnabledDataRelationShip(e.target.checked)}})),(0,o.jsx)(r,null,(0,o.jsx)(a,{isOpen:this.props.config.enabledDataRelationShip,className:"w-100"},(0,o.jsx)(w,{messageDataSource:p,actionDataSource:g,connectionType:u.connectionType,onUseLayersRelationship:this.onUseLayersRelationship,onSetCustomFields:this.onSetCustomFields}),h&&(0,o.jsx)("div",{className:"w-100 border p-1 mr-2"},this.props.intl.formatMessage({id:"frameworkAction_AutoBind",defaultMessage:S.A.frameworkAction_AutoBind})),!h&&f&&(0,o.jsx)("div",{className:"w-100 d-flex align-items-center mt-3"},(0,o.jsx)("div",{className:"d-flex flex-column relate-panel-left"},(0,o.jsx)(l,{className:"w-100",useDataSources:(0,o.Immutable)([null===(e=this.props.config.messageUseDataSource)||void 0===e?void 0:e.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,placeholder:this.props.intl.formatMessage({id:"frameworkAction_TriggerLayerField",defaultMessage:S.A.frameworkAction_TriggerLayerField}),onChange:this.onMessageFieldSelected,useDropdown:!0,selectedFields:this.props.config.messageUseDataSource&&this.props.config.messageUseDataSource.fields?this.props.config.messageUseDataSource.fields:(0,o.Immutable)([])}),(0,o.jsx)(l,{className:"w-100 action-select-chooser",placeholder:this.props.intl.formatMessage({id:"frameworkAction_ActionLayerField",defaultMessage:S.A.frameworkAction_ActionLayerField}),useDataSources:(0,o.Immutable)([null===(t=this.props.config.actionUseDataSource)||void 0===t?void 0:t.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,onChange:this.onActionFieldSelected,useDropdown:!0,selectedFields:this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.fields?this.props.config.actionUseDataSource.fields:(0,o.Immutable)([])})),(0,o.jsx)(W,{autoFlip:!0,className:"flex-none",width:12,height:40,color:c.ref.palette.neutral[900]})))),(0,o.jsx)(r,null,(0,o.jsx)(i,{type:"link",disabled:!this.props.config.actionUseDataSource,className:"w-100 d-flex justify-content-start",onClick:this.showSqlExprPopup},(0,o.jsx)("div",{className:"w-100 text-truncate",style:{textAlign:"start"}},this.props.intl.formatMessage({id:"frameworkAction_MoreConditions",defaultMessage:S.A.frameworkAction_MoreConditions}))),this.props.config.actionUseDataSource&&(0,o.jsx)(o.DataSourceComponent,{useDataSource:this.props.config.actionUseDataSource},(e=>(0,o.jsx)(d,{dataSource:e,mode:o.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:this.props.config.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)},id:"filter-widget-sql-expression-builder-popup"})))),(0,o.jsx)(r,null,(0,o.jsx)("div",{className:"sql-expr-display"},this.props.config.sqlExprObj&&g?o.dataSourceUtils.getArcGISSQL(this.props.config.sqlExprObj,g).displaySQL:this.props.intl.formatMessage({id:"frameworkAction_SetExpression",defaultMessage:S.A.frameworkAction_SetExpression}))))},this.renderFrameworkConditionsWhenQueryByExtent=()=>{const{Button:e,Switch:t,SettingSection:i,SettingRow:n,SqlExpressionBuilderPopup:a}=this.state,s=this.props.config;let r,l;Array.isArray(s)?(r=null==s?void 0:s[0],l=s.length>1||r.enableQueryWithCurrentExtent):(r=s,l=r.enableQueryWithCurrentExtent);const d=r.actionUseDataSource&&o.DataSourceManager.getInstance().getDataSource(r.actionUseDataSource.dataSourceId);return(0,o.jsx)(i,{title:this.props.intl.formatMessage({id:"frameworkAction_Conditions",defaultMessage:S.A.frameworkAction_Conditions})},(0,o.jsx)(n,{tag:"label",label:this.props.intl.formatMessage({id:"frameworkAction_QueryByExtent",defaultMessage:S.A.frameworkAction_QueryByExtent})},(0,o.jsx)(t,{checked:l,onChange:e=>{this.switchEnabledQueryWithCurrentExtent(e.target.checked)}})),(0,o.jsx)(n,null,(0,o.jsx)(e,{className:"p-0 text-left",type:"link",disabled:!r.actionUseDataSource,onClick:this.showSqlExprPopup,title:this.props.intl.formatMessage({id:"frameworkAction_MoreConditions",defaultMessage:S.A.frameworkAction_MoreConditions})},this.props.intl.formatMessage({id:"frameworkAction_MoreConditions",defaultMessage:S.A.frameworkAction_MoreConditions}))),(0,o.jsx)(n,null,r.actionUseDataSource&&(0,o.jsx)(o.DataSourceComponent,{useDataSource:r.actionUseDataSource},(e=>(0,o.jsx)(a,{dataSource:e,mode:o.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:r.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)},id:"filter-widget-sql-expression-builder-popup"}))),(0,o.jsx)("div",{className:"sql-expr-display body-1"},r.sqlExprObj&&d?o.dataSourceUtils.getArcGISSQL(r.sqlExprObj,d).displaySQL:this.props.intl.formatMessage({id:"frameworkAction_SetExpression",defaultMessage:S.A.frameworkAction_SetExpression}))))},this.getActionbactionUseDataSource=()=>{const{config:e}=this.props,t=[];return Array.isArray(e)?e.forEach((e=>{(null==e?void 0:e.actionUseDataSource)&&t.push(null==e?void 0:e.actionUseDataSource)})):(null==e?void 0:e.actionUseDataSource)&&t.push(null==e?void 0:e.actionUseDataSource),t},this.checkIsShowConditions=()=>{let e;return e=!Array.isArray(this.props.config)||1===this.props.config.length,!window.isExpressBuilder&&e},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1,currentLayerType:null,isSqlExprShow:!1}}componentDidMount(){o.moduleLoader.loadModules(["jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/sql-expression-builder"]).then((e=>{this.setState({Button:e[0].Button,Icon:e[0].Icon,Switch:e[0].Switch,Collapse:e[0].Collapse,SettingSection:e[1].SettingSection,SettingRow:e[1].SettingRow,FieldSelector:e[2].FieldSelector,DataSourceSelector:e[2].DataSourceSelector,SqlExpressionBuilderPopup:e[3].SqlExpressionBuilderPopup,DSSelectorTypes:(0,o.Immutable)([o.DataSourceTypes.FeatureLayer,o.DataSourceTypes.SceneLayer,o.DataSourceTypes.OrientedImageryLayer,o.DataSourceTypes.ImageryLayer,o.DataSourceTypes.BuildingComponentSubLayer,o.DataSourceTypes.SubtypeGroupLayer,o.DataSourceTypes.SubtypeSublayer])},(()=>{let e=this.getInitConfig(),t=this.props.config;t=this.props.messageType===o.MessageType.ExtentChange?(0,o.Immutable)(e):t.set("messageUseDataSource",e.messageUseDataSource).set("actionUseDataSource",e.actionUseDataSource).set("sqlExprObj",e.sqlExprObj),this.onSettingChange(t)}))}))}componentDidUpdate(e,t){const{useDataSources:i,config:o}=this.props;if(e.config&&o){const e=function(e,t){let i=!1,o=e;if(Array.isArray(e))o=e.map((e=>{const o=j(e,t);return o.isConfigChange?(i=!0,o.newActionConfig):e}));else{const n=j(e,t);n.isConfigChange&&(i=!0,o=n.newActionConfig)}return{isConfigChange:i,newActionConfig:o}}(o,i);(null==e?void 0:e.isConfigChange)&&this.onSettingChange(e.newActionConfig)}}getStyle(e){return o.css`
      .setting-header {
        padding: ${o.polished.rem(10)} ${o.polished.rem(16)} ${o.polished.rem(0)} ${o.polished.rem(16)}
      }
      .jimu-collapse {
        flex: 1;
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }

      .sql-expr-display {
        width: 100%;
        height: auto;
        min-height: 60px;
        line-height: 25px;
        padding: 3px 5px;
        color: ${e.ref.palette.neutral[900]};
        border: 1px solid ${e.ref.palette.neutral[500]};
      }

      .relate-panel-left {
        flex: auto;
        overflow: hidden;
        .action-select-chooser {
          margin-top: ${o.polished.rem(12)};
        }
      }
    `}render(){const{SettingSection:e,DataSourceSelector:t}=this.state,{messageWidgetId:i,messageType:n}=this.props;if(this.checkIsNotRenderActionSetting())return null;const a=T({widgetId:i,useDataSource:this.getMessageUseDataSource(),messageType:n,arcGISDataSourceTypes:o.DataSourceTypes}),s=this.getActionbactionUseDataSource();return this.props.messageType===o.MessageType.ExtentChange?(0,o.jsx)("div",{css:this.getStyle(this.props.theme)},(0,o.jsx)(e,{title:this.props.intl.formatMessage({id:"frameworkAction_ActionLayer",defaultMessage:S.A.frameworkAction_ActionLayer})},(0,o.jsx)(t,{isMultiple:!0,types:this.state.DSSelectorTypes,useDataSources:(0,o.Immutable)(s),hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,enableToSelectOutputDsFromSelf:!0})),this.checkIsShowConditions()&&this.renderFrameworkConditionsWhenQueryByExtent()):(0,o.jsx)("div",{css:this.getStyle(this.props.theme)},(0,o.jsx)(e,{title:this.props.intl.formatMessage({id:"messageAction_TriggerData",defaultMessage:o.defaultMessages.messageAction_TriggerData})},(0,o.jsx)(t,{types:this.state.DSSelectorTypes,useDataSources:a.useDataSources,fromRootDsIds:a.fromRootDsIds,fromDsIds:a.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:()=>a.isReadOnly,disableDataSourceList:a.isReadOnly,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,disableDataView:!0,hideDataView:this.checkIsDisableDataView(this.props.messageWidgetId),enableToSelectOutputDsFromSelf:!0})),(0,o.jsx)(e,{title:this.props.intl.formatMessage({id:"frameworkAction_ActionLayer",defaultMessage:S.A.frameworkAction_ActionLayer})},(0,o.jsx)(t,{isMultiple:Array.isArray(this.props.config),types:this.state.DSSelectorTypes,useDataSources:(0,o.Immutable)(s),closeDataSourceListOnChange:!0,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,enableToSelectOutputDsFromSelf:!0})),this.checkIsShowFrameworkActionConditions()&&this.renderFrameworkActionConditions())}}R.defaultProps={config:(0,o.Immutable)({messageUseDataSource:null,actionUseDataSource:null,sqlExprObj:null,enabledDataRelationShip:!0,enableQueryWithCurrentExtent:!0})};o.ReactRedux.connect((e=>({dataSources:e.appStateInBuilder&&e.appStateInBuilder.appConfig&&e.appStateInBuilder.appConfig.dataSources,dataSourcesInfo:e.appStateInBuilder&&e.appStateInBuilder.dataSourcesInfo})))((0,a.withTheme)(R));class F extends o.React.PureComponent{constructor(e){super(e),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.getInitConfig=()=>{var e,t,i,n,a;const{messageWidgetId:s,messageType:r,config:l,useDataSources:d}=this.props,u=o.DataSourceManager.getInstance();let c=null;const p=k(d,null==l?void 0:l.actionUseDataSource);if(this.props.config.messageUseDataSource)c=L({widgetId:s,oldUseDataSource:this.props.config.messageUseDataSource,messageType:r,arcGISDataSourceTypes:o.DataSourceTypes});else{const l=b(s,r);if((null==l?void 0:l[0])&&1===(null==l?void 0:l.length)){const s=null===(e=u.getDataSource(null==l?void 0:l[0].dataSourceId))||void 0===e?void 0:e.getDataSourceJson();c=!s||s.type!==o.DataSourceTypes.WebMap&&s.type!==o.DataSourceTypes.WebScene?(0,o.Immutable)({dataSourceId:null===(t=null==l?void 0:l[0])||void 0===t?void 0:t.dataSourceId,mainDataSourceId:null===(i=null==l?void 0:l[0])||void 0===i?void 0:i.mainDataSourceId,dataViewId:null===(n=null==l?void 0:l[0])||void 0===n?void 0:n.dataViewId,rootDataSourceId:null===(a=null==l?void 0:l[0])||void 0===a?void 0:a.rootDataSourceId}):null}}return p&&p.dataSourceId?{messageUseDataSource:c,actionUseDataSource:p,sqlExprObj:this.props.config.sqlExprObj}:{messageUseDataSource:c,actionUseDataSource:p,sqlExprObj:null}},this.onSettingChange=e=>{const t=E(e);this.props.onSettingChange({actionId:this.props.actionId,config:e,useDataSources:t})},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e[0]):this.handleRemoveLayerForTriggerLayer()},this.handleActionLayerChange=e=>{e&&e.length>0?this.handleActionLayerSelected(e[0]):this.handleRemoveLayerForActionLayer()},this.handleTriggerLayerSelected=e=>{const t=this.props.config.set("messageUseDataSource",e);this.onSettingChange(t)},this.handleActionLayerSelected=e=>{const t=this.props.config.set("actionUseDataSource",e).set("sqlExprObj",null);this.onSettingChange(t)},this.handleRemoveLayerForTriggerLayer=()=>{const e=this.props.config.set("messageUseDataSource",null).set("connectionType",null);this.onSettingChange(e)},this.handleRemoveLayerForActionLayer=()=>{const e=this.props.config.set("actionUseDataSource",null).set("sqlExprObj",null).set("connectionType",null);this.onSettingChange(e)},this.showSqlExprPopup=()=>{this.setState({isSqlExprShow:!0})},this.toggleSqlExprPopup=()=>{this.setState({isSqlExprShow:!this.state.isSqlExprShow})},this.onSqlExprBuilderChange=e=>{const t=this.props.config.set("sqlExprObj",e);this.onSettingChange(t)},this.onMessageFieldSelected=(e,t)=>{const{config:i}=this.props,o=i.set("messageUseDataSource",{dataSourceId:i.messageUseDataSource.dataSourceId,mainDataSourceId:i.messageUseDataSource.mainDataSourceId,dataViewId:i.messageUseDataSource.dataViewId,rootDataSourceId:i.messageUseDataSource.rootDataSourceId,fields:e.map((e=>e.jimuName))});this.onSettingChange(o)},this.onActionFieldSelected=(e,t)=>{const{config:i}=this.props,o=i.set("actionUseDataSource",{dataSourceId:i.actionUseDataSource.dataSourceId,mainDataSourceId:i.actionUseDataSource.mainDataSourceId,dataViewId:i.actionUseDataSource.dataViewId,rootDataSourceId:i.actionUseDataSource.rootDataSourceId,fields:e.map((e=>e.jimuName))});this.onSettingChange(o)},this.switchEnabledDataRelationShip=e=>{const t=this.props.config.set("enabledDataRelationShip",e);this.onSettingChange(t)},this.onUseLayersRelationship=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",o.MessageActionConnectionType.UseLayersRelationship);this.onSettingChange(e)},this.onSetCustomFields=()=>{const e=this.props.config.setIn(["messageUseDataSource","fields"],[]).setIn(["actionUseDataSource","fields"],[]).set("connectionType",o.MessageActionConnectionType.SetCustomFields);this.onSettingChange(e)},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1,currentLayerType:null,isSqlExprShow:!1}}componentDidMount(){o.moduleLoader.loadModules(["jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-ui/advanced/sql-expression-builder"]).then((e=>{this.setState({Button:e[0].Button,Icon:e[0].Icon,Switch:e[0].Switch,Collapse:e[0].Collapse,SettingSection:e[1].SettingSection,SettingRow:e[1].SettingRow,FieldSelector:e[2].FieldSelector,DataSourceSelector:e[2].DataSourceSelector,SqlExpressionBuilderPopup:e[3].SqlExpressionBuilderPopup,DSSelectorTypes:(0,o.Immutable)([o.AllDataSourceTypes.FeatureLayer,o.AllDataSourceTypes.SceneLayer,o.AllDataSourceTypes.OrientedImageryLayer,o.AllDataSourceTypes.ImageryLayer,o.AllDataSourceTypes.BuildingComponentSubLayer,o.AllDataSourceTypes.SubtypeGroupLayer,o.AllDataSourceTypes.SubtypeSublayer])},(()=>{const e=this.getInitConfig(),t=this.props.config.set("messageUseDataSource",e.messageUseDataSource).set("actionUseDataSource",e.actionUseDataSource).set("sqlExprObj",e.sqlExprObj);this.onSettingChange(t)}))}))}getStyle(e){return o.css`
      .setting-header {
        padding: ${o.polished.rem(10)} ${o.polished.rem(16)} ${o.polished.rem(0)} ${o.polished.rem(16)}
      }
      .jimu-collapse {
        flex: 1;
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }

      .sql-expr-display {
        width: 100%;
        height: auto;
        min-height: 60px;
        line-height: 25px;
        padding: 3px 5px;
        color: ${e.ref.palette.neutral[900]};
        border: 1px solid ${e.ref.palette.neutral[500]};
      }

      .relate-panel-left {
        flex: auto;
        overflow: hidden;
        .action-select-chooser {
          margin-top: ${o.polished.rem(12)};
        }
      }
    `}render(){var e,t;const{Button:i,Icon:n,Switch:a,Collapse:s,SettingSection:r,SettingRow:l,FieldSelector:d,DataSourceSelector:u,SqlExpressionBuilderPopup:c}=this.state,{messageWidgetId:p,messageType:g,config:h,theme:f}=this.props;if(!(i&&n&&a&&s&&r&&l&&d&&u&&c))return null;const y=T({widgetId:p,useDataSource:h.messageUseDataSource,messageType:g,arcGISDataSourceTypes:o.DataSourceTypes}),m=this.props.config.messageUseDataSource&&o.DataSourceManager.getInstance().getDataSource(this.props.config.messageUseDataSource.dataSourceId),v=this.props.config.actionUseDataSource&&o.DataSourceManager.getInstance().getDataSource(this.props.config.actionUseDataSource.dataSourceId),I=P(h),C=!h.connectionType||h.connectionType===o.MessageActionConnectionType.SetCustomFields;return(0,o.jsx)("div",{css:this.getStyle(this.props.theme)},(0,o.jsx)(r,{title:this.props.intl.formatMessage({id:"messageAction_TriggerData",defaultMessage:o.defaultMessages.messageAction_TriggerData})},(0,o.jsx)(u,{types:this.state.DSSelectorTypes,useDataSources:y.useDataSources,fromRootDsIds:y.fromRootDsIds,fromDsIds:y.fromDsIds,closeDataSourceListOnChange:!0,disableRemove:()=>y.isReadOnly,disableDataSourceList:y.isReadOnly,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,hideDataView:!0,enableToSelectOutputDsFromSelf:!0})),(0,o.jsx)(r,{title:this.props.intl.formatMessage({id:"frameworkAction_ActionLayer",defaultMessage:S.A.frameworkAction_ActionLayer})},(0,o.jsx)(u,{types:this.state.DSSelectorTypes,useDataSources:this.props.config.actionUseDataSource?(0,o.Immutable)([this.props.config.actionUseDataSource]):(0,o.Immutable)([]),closeDataSourceListOnChange:!0,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,onChange:this.handleActionLayerChange,widgetId:this.props.widgetId,hideDataView:!0,enableToSelectOutputDsFromSelf:!0})),this.props.config&&this.props.config.actionUseDataSource&&this.props.config.messageUseDataSource&&(0,o.jsx)(r,{title:this.props.intl.formatMessage({id:"frameworkAction_Conditions",defaultMessage:S.A.frameworkAction_Conditions})},(0,o.jsx)(l,{tag:"label",label:this.props.intl.formatMessage({id:"frameworkAction_RelateMessage",defaultMessage:S.A.frameworkAction_RelateMessage})},(0,o.jsx)(a,{checked:this.props.config.enabledDataRelationShip,onChange:e=>{this.switchEnabledDataRelationShip(e.target.checked)}})),(0,o.jsx)(l,null,(0,o.jsx)(s,{isOpen:this.props.config.enabledDataRelationShip,className:"w-100"},(0,o.jsx)(w,{messageDataSource:m,actionDataSource:v,connectionType:h.connectionType,onUseLayersRelationship:this.onUseLayersRelationship,onSetCustomFields:this.onSetCustomFields}),I&&(0,o.jsx)("div",{className:"w-100 border p-1 mr-2"},this.props.intl.formatMessage({id:"frameworkAction_AutoBind",defaultMessage:S.A.frameworkAction_AutoBind})),!I&&C&&(0,o.jsx)("div",{className:"w-100 d-flex align-items-center mt-3"},(0,o.jsx)("div",{className:"d-flex flex-column relate-panel-left"},(0,o.jsx)(d,{className:"w-100",useDataSources:(0,o.Immutable)([null===(e=this.props.config.messageUseDataSource)||void 0===e?void 0:e.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,placeholder:this.props.intl.formatMessage({id:"frameworkAction_TriggerLayerField",defaultMessage:S.A.frameworkAction_TriggerLayerField}),onChange:this.onMessageFieldSelected,useDropdown:!0,selectedFields:this.props.config.messageUseDataSource&&this.props.config.messageUseDataSource.fields?this.props.config.messageUseDataSource.fields:(0,o.Immutable)([])}),(0,o.jsx)(d,{className:"w-100 action-select-chooser",placeholder:this.props.intl.formatMessage({id:"frameworkAction_ActionLayerField",defaultMessage:S.A.frameworkAction_ActionLayerField}),useDataSources:(0,o.Immutable)([null===(t=this.props.config.actionUseDataSource)||void 0===t?void 0:t.asMutable({deep:!0})]),isDataSourceDropDownHidden:!0,onChange:this.onActionFieldSelected,useDropdown:!0,selectedFields:this.props.config.actionUseDataSource&&this.props.config.actionUseDataSource.fields?this.props.config.actionUseDataSource.fields:(0,o.Immutable)([])})),(0,o.jsx)(W,{autoFlip:!0,className:"flex-none",width:12,height:40,color:f.ref.palette.neutral[900]})))),(0,o.jsx)(l,null,(0,o.jsx)(i,{type:"link",disabled:!this.props.config.actionUseDataSource,className:"w-100 d-flex justify-content-start",onClick:this.showSqlExprPopup},(0,o.jsx)("div",{className:"w-100 text-truncate",style:{textAlign:"start"}},this.props.intl.formatMessage({id:"frameworkAction_MoreConditions",defaultMessage:S.A.frameworkAction_MoreConditions}))),this.props.config.actionUseDataSource&&(0,o.jsx)(o.DataSourceComponent,{useDataSource:this.props.config.actionUseDataSource},(e=>(0,o.jsx)(c,{dataSource:e,mode:o.SqlExpressionMode.Simple,isOpen:this.state.isSqlExprShow,toggle:this.toggleSqlExprPopup,expression:this.props.config.sqlExprObj,onChange:e=>{this.onSqlExprBuilderChange(e)},id:"filter-widget-sql-expression-builder-popup"})))),(0,o.jsx)(l,null,(0,o.jsx)("div",{className:"sql-expr-display"},this.props.config.sqlExprObj&&v?o.dataSourceUtils.getArcGISSQL(this.props.config.sqlExprObj,v).displaySQL:this.props.intl.formatMessage({id:"frameworkAction_SetExpression",defaultMessage:S.A.frameworkAction_SetExpression})))))}}F.defaultProps={config:(0,o.Immutable)({messageUseDataSource:null,actionUseDataSource:null,sqlExprObj:null,enabledDataRelationShip:!0})};o.ReactRedux.connect((e=>({dataSources:e.appStateInBuilder&&e.appStateInBuilder.appConfig&&e.appStateInBuilder.appConfig.dataSources,dataSourcesInfo:e.appStateInBuilder&&e.appStateInBuilder.dataSourcesInfo})))((0,a.withTheme)(F));i(2883);i(6764)},4617:(e,t,i)=>{"use strict";i.d(t,{y:()=>f});var o=i(9244),n=i(1496),a=i(8249),s=i(3596),r=i(2241),l=i(1575),d=i(876),u=i(6976),c=i(4601),p=i(6764),g=i(320),h=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};function f(e=void 0){return window.jimuConfig.isInBuilder?window.parent._getAppConfigAction(e):(e||(e=function(){const e=(0,o.getAppStore)().getState();return window.jimuConfig.isBuilder?e&&e.appStateInBuilder&&e.appStateInBuilder.appConfig:e&&e.appConfig}()),new y(e))}window._getAppConfigAction=f;class y{constructor(e){this.clearDeletedWidgetMessageAction=(e,t)=>{this.getDeletedWidgetsMessageConfigs(e,t).forEach((e=>{this.removeMessageAction(e)}))},this.getDeletedWidgetsMessageConfigs=(e,t)=>{const i=e.messageConfigs,o=t.messageConfigs,n=[];if(!i)return n;const a=Object.keys(i),s=Object.keys(o);for(let e=0;e<a.length;e++)s.includes(a[e])||n.push(i[a[e]]);return n},this.removeMessageAction=e=>{var t;null===(t=null==e?void 0:e.actions)||void 0===t||t.forEach((t=>{const i=u.AppMessageManager.getInstance().getAction(t.widgetId,t.actionName);i&&i.onRemoveListen(e.messageType,e.widgetId)}))},this.appConfig=e}setAppConfig(e){return this.appConfig=e,this}exec(e=!1){if(!window.jimuConfig.isBuilder&&!window.jimuConfig.isInBuilder)return void(0,o.getAppStore)().dispatch(o.appActions.appConfigChanged(this.appConfig));o.ExtensionManager.getInstance().getExtensions(o.extensionSpec.ExtensionPoints.AppConfigOperations).sort(((e,t)=>e.index-t.index)).forEach((e=>{if(e.appConfigWillChange)try{this.appConfig=e.appConfigWillChange(this.appConfig)}catch(e){console.error("Error in appConfigWillChange.",e)}})),(0,o.getAppStore)().dispatch({type:"IN_BUILDER_APPCONFIG_REDOCLEAR"}),e&&(0,o.getAppStore)().dispatch(r.yx.InBuilderRemoveLastAppConfigFromHistory()),s.publishAppConfigChangeToApp(this.appConfig);const t=(0,o.getAppStore)().getState().appStateInBuilder.appConfig,i=this.appConfig,n=Object.keys(t.widgets).filter((e=>!i.widgets[e]));(0,o.getAppStore)().dispatch(d.Zv.widgetsRemoved(n)),this.clearDeletedWidgetMessageAction(t,i);const a=Object.keys(i.widgets).filter((e=>!t.widgets[e])).map((e=>({widgetId:e,widgetUri:i.widgets[e].uri})));(0,o.getAppStore)().dispatch(d.Zv.widgetsAdded(a));const u=(0,o.getAppStore)().getState().appStateInBuilder.appInfo;return(0,o.getAppStore)().dispatch(l.Aj.inBuilderAppConfigChanged(this.appConfig)),(0,o.getAppStore)().dispatch(r.yx.InBuilderPutAppConfigIntoHistory({appConfig:this.appConfig,appInfo:u})),this}editWidgetConfig(e,t){return this.appConfig.widgets[e]?(this.appConfig=this.appConfig.setIn(["widgets",e,"config"],t),this):this}editWidget(e,t){if(!this.appConfig.widgets[e.id])return this;this.handleWidgetUseDataSourceChange(this.appConfig.widgets[e.id],e);const i=this.appConfig.widgets[e.id];let n=i;return t&&(t.forEach((e=>{e.isOutputFromWidget||(e.isOutputFromWidget=!0)})),n=n.set("outputDataSources",t.map((e=>e.id)))),Object.keys(e).forEach((t=>{null===e[t]&&("outputDataSourcesJson"===t&&e.outputDataSources&&e.outputDataSources.forEach((e=>this.removeDataSource(e))),n=n.without(t),delete e[t])})),i.outputDataSources&&i.outputDataSources.forEach((e=>{n.outputDataSources&&n.outputDataSources.includes(e)||this.removeDataSource(e)})),n.outputDataSources&&n.outputDataSources.forEach((e=>{const n=t&&t.find((t=>t.id===e));if(n)if(i.outputDataSources&&i.outputDataSources.includes(e)){let t=this.appConfig.dataSources[e];if(!t)return void console.error("Unknown error. Widget output data source is not in data source json.",e);Object.keys(n).forEach((e=>{null===n[e]&&(t=t.without(e),delete n[e])})),this.editDataSource(t.merge(n))}else this.addDataSource((0,o.Immutable)(n))})),n=n.merge(e),e.useDataSources&&n.layouts&&n.manifest.properties.passDataSourceToChildren&&this.copyUseDataSourceToAllChildWidgets(i,n),this.appConfig=this.appConfig.setIn(["widgets",e.id],n),this}editWidgetProperty(e,t,i){if(!this.appConfig.widgets||!this.appConfig.widgets[e])return this;if("outputDataSources"===t)return console.error("Please use editWidget to update outputDataSources."),this;const o=this.appConfig.widgets[e],n=this.editJsonProperty(o,t,i);return o===n?this:(this.appConfig=this.appConfig.setIn(["widgets",e],n),t.includes(".")?this:this.editWidget({id:e,[t]:i}))}createWidget(e){return h(this,arguments,void 0,(function*(e,t=!0){try{const i=yield c.A.getInstance().handleNewWidgetJson(e),o=p.Q7.createWidget(this.appConfig,i,[n.utils.getCurrentSizeMode()],t);this.appConfig=o[0];const a=o[1];return this.appConfig.widgets[a]}catch(e){console.error(e)}return null}))}removeWidget(e){return this.appConfig=p.Q7.remove(this.appConfig,e),this}editControllerPanel(e,t){return this.appConfig=this.appConfig.setIn(["controllerPanels",e],t),this}removeControllerPanel(e){var t;return(null===(t=this.appConfig.controllerPanels)||void 0===t?void 0:t[e])&&(this.appConfig=this.appConfig.set("controllerPanels",this.appConfig.controllerPanels.without(e))),this}removeLayoutFromWidget(e,t){var i,o,n;return(null===(i=this.appConfig.widgets[e])||void 0===i?void 0:i.layouts)&&(null===(o=this.appConfig.widgets[e])||void 0===o?void 0:o.layouts[t])?(Object.keys(null===(n=this.appConfig.widgets[e])||void 0===n?void 0:n.layouts[t]).forEach((i=>{var o;const n=null===(o=this.appConfig.widgets[e])||void 0===o?void 0:o.layouts[t][i];this.removeLayout(n)})),this.appConfig=this.appConfig.setIn(["widgets",e,"layouts"],this.appConfig.widgets[e].layouts.without(t)),this):this}createSection(){const e=p.HA.createSection(this.appConfig,[n.utils.getCurrentSizeMode()]);this.appConfig=e[0];const t=e[1];return this.appConfig.sections[t]}editSectionProperty(e,t,i){let o=this.appConfig.sections[e];return o?(o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["sections",e],o),this):this}editViewProperty(e,t,i){let o=this.appConfig.views[e];return o?(o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["views",e],o),this):this}addView(e){var t;let i;const a=this.appConfig.sections[e];if((null===(t=a.views)||void 0===t?void 0:t.length)>0){const e=a.views[0],t=this.appConfig.views[e];i=Object.keys(t.layout)}else{const{type:t,id:a}=n.searchUtils.getContentRootContainerInfo(this.appConfig,e,o.LayoutItemType.Section,n.utils.getCurrentSizeMode());t===o.ContainerType.Header||t===o.ContainerType.Footer?i=Object.keys(this.appConfig[a].layout):t===o.ContainerType.Page?i=Object.keys(this.appConfig.pages[a].layout):t===o.ContainerType.Dialog&&(i=Object.keys(this.appConfig.dialogs[a].layout))}const s=p.HA.addView(this.appConfig,e,i);return this.appConfig=s[0],s[1]}duplicateView(e,t,i){const o={},n=this.appConfig.sections[t],a=this.appConfig.views[n.views[0]],s=Object.keys(a.layout),r=p.HA.duplicateView(this.appConfig,t,e,s,i,o);this.appConfig=r[0];const l=r[1];return this.appConfig=p.Q7.afterBatchCopied(this.appConfig,this.appConfig,o),this.appConfig.views[l]}removeView(e,t){return this.appConfig=p.HA.removeView(this.appConfig,t,e),this}moveViewInSection(e,t,i,o){if(!(this.appConfig.sections&&this.appConfig.sections[e]&&this.appConfig.views&&this.appConfig.views[t]&&this.appConfig.views[i]))return this;if(i===t)return console.error("viewId is same to targetViewId."),this;let n=this.appConfig.sections[e].views.asMutable();n=n.filter((e=>e!==t));let a=n.indexOf(i);return"below"===o&&a++,n=n.slice(0,a).concat(t).concat(n.slice(a)),this.appConfig=this.appConfig.setIn(["sections",e,"views"],n),this}createScreenGroup(){const e=a.getUniqueId("screenGroup"),t=a.getUniqueLabel(this.appConfig,"screenGroup",o.i18n.getIntl().formatMessage({id:"screenGroup"})),i=(0,o.Immutable)({id:e,label:t,screens:[],transitionType:o.ScreenTransitionType.Fade});return this.appConfig=this.appConfig.setIn(["screenGroups",i.id],i),i}editScreenGroupProperty(e,t,i){let o=this.appConfig.screenGroups[e];return o?(o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["screenGroups",e],o),this):this}editScreenProperty(e,t,i){let o=this.appConfig.screens[e];return o?(o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["screens",e],o),this):this}moveScreenInGroup(e,t,i,o){var n;if(!(null===(n=this.appConfig.screenGroups)||void 0===n?void 0:n[e])||t===i)return this;const a=this.appConfig.screenGroups[e].screens.asMutable(),s=a[t],r=a[i];a.splice(t,1);const l=a.indexOf(r);return"below"===o?a.splice(l,1,r,s):a.splice(l,1,s,r),this.appConfig=this.appConfig.setIn(["screenGroups",e,"screens"],a),this}removeScreenByIndex(e,t){var i,o;const n=null===(o=null===(i=this.appConfig.screenGroups)||void 0===i?void 0:i[t])||void 0===o?void 0:o.screens,a=null==n?void 0:n[e];return this.removeScreen(a,t)}removeScreen(e,t,i=!1){return this.appConfig=p.rW.removeScreen(this.appConfig,t,e),this}duplicateScreenByIndex(e,t,i=!0){var o,n;const a=null===(n=null===(o=this.appConfig.screenGroups)||void 0===o?void 0:o[t])||void 0===n?void 0:n.screens,s=null==a?void 0:a[e];return this.duplicateScreen(s,t,i)}duplicateScreen(e,t,i=!0){const o={},n=this.appConfig.screenGroups[t],a=this.appConfig.screens[n.screens[0]],s=Object.keys(a.main.layout),r=p.rW.duplicateScreen(this.appConfig,t,e,s,i,o);this.appConfig=r[0];const l=r[1];return this.appConfig=p.Q7.afterBatchCopied(this.appConfig,this.appConfig,o),this.appConfig.screens[l]}editPageProperty(e,t,i){if(!this.appConfig.pages||!this.appConfig.pages[e])return this;let o=this.appConfig.pages[e];return o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["pages",e],o),this}addPage(e){return this.appConfig.pages&&this.appConfig.pages[e.id]||(this.appConfig=this.appConfig.setIn(["pages",e.id],e),this.appConfig=this.appConfig.set("pageStructure",this.appConfig.pageStructure.concat([{[e.id]:[]}]))),this}duplicatePage(e,t=!1){if(!this.appConfig.pages||!this.appConfig.pages[e])return null;let i=this.appConfig.pages[e].set("id",a.getUniqueId("page"));if(i=i.set("label",this.getDuplicateLabel("page",i.label)),this.appConfig=this.appConfig.setIn(["pages",i.id],i),i.isDefault&&(i=i.set("isDefault",!1)),i.type!==o.PageType.Link&&i.type!==o.PageType.Folder){const t={},n=p.zM.getServiceFromSizeModeLayout(this.appConfig,i.layout).duplicateSizeModeLayouts(this.appConfig,i.layout,o.LayoutParentType.Page,i.id,t);this.appConfig=n[0],i=i.set("layout",n[1]),t[e]=i.id,this.appConfig=p.Q7.afterBatchCopied(this.appConfig,this.appConfig,t)}const n=this.appConfig.pageStructure.find((t=>!!t[e])),s=[];if(n&&n[e].forEach((e=>{const t=this.duplicatePage(e,!0);s.push(t.id)})),!t)if(n){if(this.appConfig=this.appConfig.set("pageStructure",this.appConfig.pageStructure.concat([{[i.id]:[]}])),s.length>0){const e=i.id;let t=this.appConfig.pageStructure.length-1;t<0&&(t=0),this.appConfig=this.appConfig.setIn(["pageStructure",t+"",e],s)}}else this.appConfig.pageStructure.some(((t,o)=>{const n=Object.keys(t).find((i=>t[i].includes(e)));if(n)return this.appConfig=this.appConfig.setIn(["pageStructure",o+"",n],this.appConfig.pageStructure[o][n].concat(i.id)),!0}));return this.appConfig=this.appConfig.setIn(["pages",i.id],i),i}movePageIntoPage(e,t){return this.appConfig.pages&&this.appConfig.pages[e]&&this.appConfig.pages[t]?e===t?(console.error("SubPage is same to ParentPage."),this):a.isFirstLevelPage(this.appConfig,t)?a.isPageHasSubPage(this.appConfig,e)?(console.error("SubPage has sub page(s)."),this):(this.removePageFromPageStructure(e),this.movePageIntoPageForPageStructure(e,t),this):(console.error("ParentPage is not on the first aspect."),this):this}orderPageToPage(e,t,i){if(!this.appConfig.pages||!this.appConfig.pages[t]||!this.appConfig.pages[e])return this;if(t===e)return console.error("pageId is same to targetPageId."),this;const n=!a.isFirstLevelPage(this.appConfig,t);if((a.isPageHasSubPage(this.appConfig,e)||this.appConfig.pages[e].type===o.PageType.Folder)&&n)return console.error("page structure allow two aspects only"),this;const s=this.appConfig.pageStructure.find((t=>!!t[e]));return this.removePageFromPageStructure(e),n?this.appConfig.pageStructure.some(((o,n)=>{const a=Object.keys(o)[0];let s=o[a].indexOf(t);if(s>-1){let t=this.appConfig.pageStructure[n][a];return"bottom"===i&&(s+=1),t=t.slice(0,s).concat([e]).concat(t.slice(s)),this.appConfig=this.appConfig.setIn(["pageStructure",n+"",a],t),!0}})):this.appConfig.pageStructure.some(((o,n)=>{if(Object.keys(o)[0]===t){"bottom"===i&&(n+=1);const t=this.appConfig.pageStructure.slice(0,n).concat([s||{[e]:[]}]).concat(this.appConfig.pageStructure.slice(n));return this.appConfig=this.appConfig.set("pageStructure",t),!0}})),this}removePage(e,t){if(!this.appConfig.pages||!this.appConfig.pages[e])return this;const i=this.appConfig.pages[e];if(i.type!==o.PageType.Folder&&i.type!==o.PageType.Link){const e=p.zM.getServiceFromSizeModeLayout(this.appConfig,i.layout);this.appConfig=e.removeSizeModeLayouts(this.appConfig,i.layout)}const{pageStructure:n}=this.appConfig,a=n&&n.find((t=>!!t[e]));return a&&a[e].length>0&&a[e].forEach((e=>{this.removePage(e)})),this.removePageFromPageStructure(e),this.appConfig=this.appConfig.set("pages",this.appConfig.pages.without(e)),t&&this.setHomePage(t),this}setHomePage(e){return this.editPageProperty(e,"isDefault",!0)}setUseAutoSortInFixedLayout(e){return this.appConfig=this.appConfig.set("useAutoSortInFixedLayout",e),this}replaceHomePage(e){return Object.keys(this.appConfig.pages).some(((e,t)=>{const i=this.appConfig.pages[e];if(i.isDefault)return this.editPageProperty(i.id,"isDefault",!1),!0})),this.editPageProperty(e,"isDefault",!0)}editDialog(e){const t=this.appConfig.dialogs[e.id].mode;if(t!==e.mode){const i=this.appConfig.dialogs.asMutable({deep:!0});Object.keys(i).forEach((o=>{const n=i[o];n.id===e.id?i[o]=Object.assign({},e.asMutable({deep:!0}),{index:Object.keys(i).filter((e=>i[e].mode!==t)).length}):n.mode===t&&n.index>e.index&&(n.index=n.index-1)})),this.appConfig=this.appConfig.set("dialogs",(0,o.Immutable)(i))}else this.appConfig=this.appConfig.setIn(["dialogs",e.id],e);return this}editDialogProperty(e,t,i){if(!this.appConfig.dialogs||!this.appConfig.dialogs[e])return this;let o=this.appConfig.dialogs[e];return o=this.editJsonProperty(o,t,i),this.editDialog(o)}removeDialog(e){var t;const i=null===(t=this.appConfig.dialogs)||void 0===t?void 0:t[e];if(!i)return this;const n=p.zM.getServiceFromSizeModeLayout(this.appConfig,i.layout);this.appConfig=n.removeSizeModeLayouts(this.appConfig,i.layout);const a=i.mode,s=i.index,r=this.appConfig.dialogs.without(e).asMutable({deep:!0});return Object.keys(r).forEach((e=>{const t=r[e];t.mode===a&&t.index>s&&(t.index=t.index-1)})),this.appConfig=this.appConfig.set("dialogs",(0,o.Immutable)(r)),this}duplicateDialog(e){const t=this.appConfig.dialogs;let i=t[e];if(!t||!i)return null;const n=a.getUniqueId("dialog"),s={},r=p.zM.getServiceFromSizeModeLayout(this.appConfig,i.layout).duplicateSizeModeLayouts(this.appConfig,i.layout,o.LayoutParentType.Dialog,n,s);this.appConfig=r[0];const l=r[1];s[e]=n,this.appConfig=p.Q7.afterBatchCopied(this.appConfig,this.appConfig,s);const d=Object.keys(Object.keys(t).filter((e=>t[e].mode===i.mode))).length;return i=i.set("id",n).set("index",d).set("isSplash",!1).set("label",this.getDuplicateLabel("dialog",i.label)).set("layout",l),this.appConfig=this.appConfig.setIn(["dialogs",i.id],i),i}orderDialogToDialog(e,t,i){const n=this.appConfig.dialogs.asMutable({deep:!0}),a=n[e],s=n[t];if(!n||!a||!s)return this;if(t===e)return console.error("dialogId is same to targetDialogId."),this;let r;return s.index>a.index?(r="top"===i?s.index-1:s.index,Object.keys(n).forEach((t=>{const i=n[t];i.mode===s.mode&&i.id!==e&&i.index>a.index&&i.index<=r&&(i.index=i.index-1)}))):(r="top"===i?s.index:s.index+1,Object.keys(n).forEach((t=>{const i=n[t];i.mode===s.mode&&i.id!==e&&i.index>=r&&i.index<a.index&&(i.index=i.index+1)}))),n[e]=Object.assign({},a,{index:r,mode:s.mode}),this.appConfig=this.appConfig.set("dialogs",(0,o.Immutable)(n)),this}replaceSplashDialog(e,t){return t&&this.editDialogProperty(t,"isSplash",!1),e!==t?this.editDialogProperty(e,"isSplash",!0):this}createLayoutForSizeMode(e,t,i,n,a,s){var r;if(!i||!i[t]||i[e])return null;const l=i[t],d=p.zM.getService(this.appConfig,l).duplicateLayout(this.appConfig,i[t],t,e,{},!1);if(d[1]){this.appConfig=d[0];const t=d[1];this.appConfig=this.appConfig.setIn(["layouts",t,"parent"],{id:a,type:n});const l=i.set(e,t);switch(n){case o.LayoutParentType.Dialog:this.appConfig=this.appConfig.setIn(["dialogs",a,"layout"],l);break;case o.LayoutParentType.Page:this.appConfig=this.appConfig.setIn(["pages",a,"layout"],l);break;case o.LayoutParentType.Header:this.appConfig=this.appConfig.setIn(["header","layout"],l);break;case o.LayoutParentType.Footer:this.appConfig=this.appConfig.setIn(["footer","layout"],l);break;case o.LayoutParentType.Screen:this.appConfig=this.appConfig.setIn(["screens",a,"layout"],l);break;case o.LayoutParentType.View:this.appConfig=this.appConfig.setIn(["views",a,"layout"],l);break;case o.LayoutParentType.Widget:{const e=this.appConfig.widgets[a];(null===(r=null==e?void 0:e.layouts)||void 0===r?void 0:r[s])&&(this.appConfig=this.appConfig.setIn(["widgets",a,"layouts",s],l));break}}return l}return null}removeSizeModeLayout(e,t){const i=p.zM.getService(this.appConfig,e);return this.appConfig=i.removeLayout(this.appConfig,e,t),this}addNewSectionToLayout(e){const t=this.createSection(),i=p.zM.getService(this.appConfig,e).createBlankItem(this.appConfig,e);this.appConfig=i[0];const a=i[1],s={layoutId:e,layoutItemId:a};return this.editLayoutItemProperty(s,"type",o.LayoutItemType.Section).editLayoutItemProperty(s,"sectionId",t.id),this.appConfig=p.HA.addParent(this.appConfig,t.id,s,n.utils.getCurrentSizeMode()),a}addPlaceholderToLayout(e){const t=p.zM.getService(this.appConfig,e).createBlankItem(this.appConfig,e);this.appConfig=t[0];const i=t[1],n={layoutId:e,layoutItemId:i};return this.editLayoutItemProperty(n,"type",o.LayoutItemType.Widget),this.appConfig=p.X7.addAsSyncablePlaceholder(this.appConfig,n),i}addNewWidgetToLayout(e,t){return h(this,arguments,void 0,(function*(e,t,i=!1){if(!i&&o.utils.isExpressMode())return;const a=yield this.createWidget(t,!0);if(a){const t=p.zM.getService(this.appConfig,e).createBlankItem(this.appConfig,e);this.appConfig=t[0];const i=t[1],s={layoutId:e,layoutItemId:i};this.editLayoutItemProperty(s,"type",o.LayoutItemType.Widget,!0).editLayoutItemProperty(s,"widgetId",a.id,!0);const r=n.utils.getCurrentSizeMode();return this.appConfig=p.Q7.addParent(this.appConfig,a.id,s,r),this.appConfig=p.Q7.afterAdded(this.appConfig,a.id,e,r,r),i}return null}))}addTemplateContentToLayout(e,t,i){const o=p.zM.getService(this.appConfig,e).addContent(this.appConfig,e,i,t,n.utils.getCurrentSizeMode());return this.appConfig=o[0],{layoutId:e,layoutItemId:o[1]}}addContentToPlaceholder(e,t,i){var o;let a=[{layoutInfo:e,sizeMode:n.utils.getCurrentSizeMode()}];const s=p.X7.getPlaceholderInfo(this.appConfig,e);return s&&(a=[{layoutInfo:s.layoutInfo,sizeMode:this.appConfig.mainSizeMode}],Object.keys(null!==(o=s.syncs)&&void 0!==o?o:{}).forEach((e=>{a.push({layoutInfo:s.syncs[e],sizeMode:e})}))),a.forEach((o=>{var a;const{layoutInfo:s,sizeMode:r}=o,{layoutId:l}=s;this.editLayoutItemProperty(s,"type",t),this.appConfig=p.YU.setContentId(this.appConfig,s,i,r);const d=n.searchUtils.findLayoutItem(this.appConfig,s),u=new p.yC(this.appConfig,d);this.appConfig=u.afterAdded(l,r,r),(null===(a=d.setting)||void 0===a?void 0:a.placeholderStyle)&&this.editLayoutItemProperty(e,"setting",d.setting.without("placeholderStyle"))})),this}removeParentsOfOtherSizeModes(e,t,i){const a=n.searchUtils.findLayoutItem(this.appConfig,e);let s=[];const r=[];if(a.type===o.LayoutItemType.Widget){const e=a.widgetId,t=this.appConfig.widgets[e];(null==t?void 0:t.layouts)&&Object.keys(t.layouts).forEach((e=>{const o=t.layouts[e][i];r.push(o)}))}else if(a.type===o.LayoutItemType.Section){const e=a.sectionId;this.appConfig.sections[e].views.forEach((e=>{const t=this.appConfig.views[e];r.push(t.layout[i])}))}else if(a.type===o.LayoutItemType.ScreenGroup){const e=a.screenGroupId;this.appConfig.screenGroups[e].screens.forEach((e=>{const t=this.appConfig.screens[e];r.push(t.main.layout[i]),t.panel&&r.push(t.panel.layout[i])}))}r.length>0&&r.forEach((e=>{const t=n.searchUtils.getContentsInLayoutRecursive(this.appConfig,e,o.LayoutItemType.Widget,i);s=s.concat(t)})),s.length>0&&s.forEach((e=>{t.forEach((t=>{t!==i&&(this.appConfig=p.Q7.removeSizeModeParent(this.appConfig,e,t))}))}))}duplicateLayoutItemInSameLayout(e){const{layoutId:t}=e,i=p.zM.getService(this.appConfig,t),a={},s=n.utils.getCurrentSizeMode(),r=i.duplicateItemInSameLayout(this.appConfig,e,s,a);this.appConfig=r[0];const l=r[1];this.appConfig=p.Q7.afterBatchCopied(this.appConfig,this.appConfig,a);const d=n.searchUtils.findLayoutItem(this.appConfig,{layoutId:t,layoutItemId:l}),u=new p.yC(this.appConfig,d),c=[o.BrowserSizeMode.Large,o.BrowserSizeMode.Medium,o.BrowserSizeMode.Small];return c.forEach((e=>{e!==s&&u.removeSizeModeParent(e)})),this.appConfig=u.getConfig(),this.removeParentsOfOtherSizeModes({layoutId:t,layoutItemId:l},c,s),r[1]}duplicateLayoutItemToOtherLayout(e,t){const i=n.searchUtils.findLayoutItem(this.appConfig,e),s=new p.yC(this.appConfig,i),r={},l=n.utils.getCurrentSizeMode(),d=s.duplicate(l,r);this.appConfig=d[0];const u=d[1];this.appConfig=p.Q7.afterBatchCopied(this.appConfig,this.appConfig,r),this.appConfig=p.Q7.removeParent(this.appConfig,u,e);const c=p.zM.getService(this.appConfig,t).createBlankItem(this.appConfig,t);this.appConfig=c[0];const g=c[1],h={layoutId:t,layoutItemId:g};switch(this.editLayoutItemProperty(h,"type",i.type),i.type){case o.LayoutItemType.Widget:this.editLayoutItemProperty(h,"widgetId",u);break;case o.LayoutItemType.Section:this.editLayoutItemProperty(h,"sectionId",u);break;case o.LayoutItemType.ScreenGroup:this.editLayoutItemProperty(h,"screenGroupId",u)}const f=n.searchUtils.findLayoutItem(this.appConfig,h),y=new p.yC(this.appConfig,f);y.addParent(h,l);const m=[o.BrowserSizeMode.Large,o.BrowserSizeMode.Medium,o.BrowserSizeMode.Small];m.forEach((e=>{e!==l&&y.removeSizeModeParent(e)})),this.appConfig=y.getConfig(),this.removeParentsOfOtherSizeModes(h,m,l);return a.getSizeModeOfALayout(this.appConfig,e.layoutId)===l&&l===this.appConfig.mainSizeMode&&(this.appConfig=p.X7.afterLayoutItemCopied(this.appConfig,e,h)),g}syncPlaceholder(e,t,i){var o,n;const a=p.X7.getPlaceholderInfo(this.appConfig,e);if(null===(o=null==a?void 0:a.syncs)||void 0===o?void 0:o[i]){const{layoutId:t,layoutItemId:o}=a.syncs[i];t===e.layoutId&&o===e.layoutItemId&&(this.appConfig=this.appConfig.setIn(["placeholderInfos",a.id,"syncs"],a.syncs.without(i)))}return t>0&&(null===(n=this.appConfig.placeholderInfos)||void 0===n?void 0:n[t])&&(this.appConfig=this.appConfig.setIn(["placeholderInfos",t,"syncs",i],e)),this}moveLayoutItem(e,t,i,o){const n=p.zM.getService(this.appConfig,t).moveLayoutItem(this.appConfig,e,t,i,o);return this.appConfig=n[0],n[1]}setLayoutItemToPending(e,t){if(!n.searchUtils.findLayoutItem(this.appConfig,e))return this;if(t){const t=p.zM.getService(this.appConfig,e.layoutId);this.appConfig=t.pendItem(this.appConfig,e)}else this.appConfig=this.appConfig.setIn(["layouts",e.layoutId,"content",e.layoutItemId,"isPending"],t);return this}removeLayoutItem(e,t,i){const o=p.zM.getService(this.appConfig,e.layoutId);return this.appConfig=o.removeItem(this.appConfig,e,n.utils.getCurrentSizeMode(),t,i),this}removeLayout(e){return this.removeSizeModeLayout(e,n.utils.getCurrentSizeMode())}clearLayoutContent(e){var t;const i=this.appConfig.layouts[e];return i?(Object.keys(null!==(t=i.content)&&void 0!==t?t:{}).forEach((t=>{this.removeLayoutItem({layoutId:e,layoutItemId:t},!0,!1)})),this):this}duplicateLayout(e,t){if(!this.appConfig.layouts[e])return null;const i=p.zM.getService(this.appConfig,e),o=n.utils.getCurrentSizeMode(),a={},s=i.duplicateLayout(this.appConfig,e,o,o,a,t);this.appConfig=s[0];const r=s[1];return t&&(this.appConfig=p.Q7.afterBatchCopied(this.appConfig,this.appConfig,a)),this.appConfig.layouts[r]}editLayoutProperty(e,t,i){let o=this.appConfig.layouts[e];return o?(o=this.editJsonProperty(o,t,i),this.appConfig=this.appConfig.setIn(["layouts",e],o),this):this}editLayoutItemProperty(e,t,i,a=!1){if(!a&&o.utils.isExpressMode())return this;const{layoutId:s,layoutItemId:r}=e;let l=n.searchUtils.findLayoutItem(this.appConfig,e);return l?(l=this.editJsonProperty(l,t,i),this.appConfig=this.appConfig.setIn(["layouts",s,"content",r],l),this):this}editLabelOfTocNode(e,t){switch(e.type){case"view":return this.editViewProperty(e.id,"label",t);case"screen":return this.editScreenProperty(e.id,"label",t);case"widget":return this.editWidgetProperty(e.id,"label",t);case"section":return this.editSectionProperty(e.id,"label",t);case"screenGroup":return this.editScreenGroupProperty(e.id,"label",t);case"layoutItem":return this.editLayoutItemProperty({layoutId:e.layoutId,layoutItemId:e.layoutItemId},"label",t);default:return this}}editLayoutItemSize(e,t,i,n=!1){var a;if(0===t||0===i||!n&&o.utils.isExpressMode())return this;const{layoutId:s,layoutItemId:r}=e,l=this.appConfig.layouts[s],d=null===(a=null==l?void 0:l.content)||void 0===a?void 0:a[r];if(!l||!d)return this;let u=d.setting||(0,o.Immutable)({});if(l.type===o.LayoutType.FixedLayout){const o=d.bbox.set("width",`${t}px`).set("height",`${i}px`);return u=u.setIn(["autoProps","width"],!1).setIn(["autoProps","height"],!1),this.editLayoutItemProperty(e,"bbox",o).editLayoutItemProperty(e,"setting",u)}return u=u.setIn(["autoProps","width"],!1).setIn(["autoProps","height"],!1).set("heightMode","ratio").set("aspectRatio",Number((i/t).toFixed(2))),this.editLayoutItemProperty(e,"setting",u)}exchangeWidthAndHeight(e=!1){var t,i,a,s,r;if(!e&&o.utils.isExpressMode())return this;let l;const d=(0,o.getAppStore)().getState();if(l=window.jimuConfig.isBuilder?null===(i=null===(t=null==d?void 0:d.appStateInBuilder)||void 0===t?void 0:t.appRuntimeInfo)||void 0===i?void 0:i.selection:null===(a=null==d?void 0:d.appRuntimeInfo)||void 0===a?void 0:a.selection,!l)return this;const{layoutId:u}=l,c=this.appConfig.layouts[u];if((null==c?void 0:c.type)===o.LayoutType.FixedLayout){const e=n.searchUtils.findLayoutItem(this.appConfig,l);if(e){let t=e.bbox,i=!1,n=null!==(s=e.setting)&&void 0!==s?s:(0,o.Immutable)({});const a=null!==(r=n.autoProps)&&void 0!==r?r:{right:!0,bottom:!0};t=t.set("width",t.height).set("height",t.width),["left","right","top","bottom"].forEach((e=>{a[e]&&(t=t.without(e))})),this.editLayoutItemProperty(l,"bbox",t),null==a.width&&null==a.height||(n=n.setIn(["autoProps","width"],a.height).setIn(["autoProps","height"],a.width),i=!0),"ratio"===n.heightMode&&(n=n.set("heightMode","fixed"),i=!0),i&&this.editLayoutItemProperty(l,"setting",n)}}return this}adjustOrderOfItem(e,t,i=!1){if(!i&&o.utils.isExpressMode())return this;const{layoutId:n,layoutItemId:a}=e,s=this.appConfig.layouts[n];let r=[].concat(s.order||[]);if(null!=t&&t>=0&&t<=r.length){const e=r.indexOf(a);e>=0&&r.splice(e,1),r.splice(t,0,a)}else r.includes(a)&&(r=r.filter((e=>e!==a))),r.push(a);return this.appConfig=this.appConfig.setIn(["layouts",n,"order"],r),this}createLayout(e){const t=p.zM.getInstance().getServiceByType(e).createBlankLayout(this.appConfig,e);return this.appConfig=t[0],t[1]}createPageFromTemplate(e){return h(this,void 0,void 0,(function*(){const t={},i=yield p.Qi.createPageFromTemplate(this.appConfig,e,t);this.appConfig=i[0];const n=i[1];return this.appConfig=p.Q7.afterBatchCopied(this.appConfig,(0,o.Immutable)(e.config),t),n}))}createDialogFromTemplate(e){return h(this,void 0,void 0,(function*(){const t={},i=yield p.Qi.createDialogFromTemplate(this.appConfig,e,t);this.appConfig=i[0];const n=i[1];return this.appConfig=p.Q7.afterBatchCopied(this.appConfig,(0,o.Immutable)(e.config),t),n}))}applyHeaderTemplate(e){return h(this,void 0,void 0,(function*(){const t={};this.appConfig=yield p.Qi.applyTemplateToHeader(this.appConfig,e,n.utils.getCurrentSizeMode(),t),this.appConfig=p.Q7.afterBatchCopied(this.appConfig,(0,o.Immutable)(e.config),t)}))}applyFooterTemplate(e){return h(this,void 0,void 0,(function*(){const t={};this.appConfig=yield p.Qi.applyTemplateToFooter(this.appConfig,e,n.utils.getCurrentSizeMode(),t),this.appConfig=p.Q7.afterBatchCopied(this.appConfig,(0,o.Immutable)(e.config),t)}))}applyPageBodyTemplate(e,t){return h(this,void 0,void 0,(function*(){const i={};this.appConfig=yield p.Qi.applyTemplateToBody(this.appConfig,e,t,n.utils.getCurrentSizeMode(),i),this.appConfig=p.Q7.afterBatchCopied(this.appConfig,(0,o.Immutable)(t.config),i)}))}applyDialogTemplate(e,t){return h(this,arguments,void 0,(function*(e,t,i=n.utils.getCurrentSizeMode()){const a={};this.appConfig=yield p.Qi.applyTemplateToDialog(this.appConfig,e,t,i,a),this.appConfig=p.Q7.afterBatchCopied(this.appConfig,(0,o.Immutable)(t.config),a)}))}applyGridTemplate(e,t){return h(this,void 0,void 0,(function*(){const i={};this.appConfig=yield p.Qi.applyGridTemplate(this.appConfig,e,t,n.utils.getCurrentSizeMode(),i),this.appConfig=p.Q7.afterBatchCopied(this.appConfig,(0,o.Immutable)(t.config),i)}))}createScreenFromTemplate(e,t){return h(this,void 0,void 0,(function*(){const i={},a=yield p.rW.createScreenFromTemplate(this.appConfig,t,e,[n.utils.getCurrentSizeMode()],i);return this.appConfig=a[0],this.appConfig=p.Q7.afterBatchCopied(this.appConfig,(0,o.Immutable)(t.config),i),a[1]}))}copyUseDataSourceToAllChildWidgets(e,t){const i=n.searchUtils.getChildrenContents(this.appConfig,t.id,o.LayoutItemType.Widget,!0),a=t.useDataSources&&t.useDataSources.map((e=>e.set("fields",[])))[0],s=e.useDataSources&&e.useDataSources.map((e=>e.set("fields",[])))[0];return a&&s&&a.dataSourceId===s.dataSourceId||i.forEach((e=>{let t=this.appConfig.widgets[e];const i=s&&t.useDataSources?t.useDataSources.find((e=>e.dataSourceId===s.dataSourceId)):null,o=(0,g.nj)(t.id);if((null==o?void 0:o.useDataSourceWillChange)&&(this.appConfig=o.useDataSourceWillChange(this.appConfig,null==s?void 0:s.dataSourceId,null==a?void 0:a.dataSourceId)),i&&(t=this.appConfig.widgets[e],t=t.set("useDataSources",t.useDataSources.filter((e=>e.dataSourceId!==s.dataSourceId)))),a){let e=a;i&&(null==s?void 0:s.mainDataSourceId)===a.mainDataSourceId&&Object.keys(i).forEach((t=>{"dataViewId"===t||(Array.isArray(e[t])?0!==e[t].length:e[t])||(e=e.set(t,i[t]))})),t=t.set("useDataSources",t.useDataSources?t.useDataSources.concat(e):[e]).set("useDataSourcesEnabled",!0)}this.appConfig=this.appConfig.setIn(["widgets",e],t)})),this}addDataSource(e){return this.appConfig=p.no.addDataSource(this.appConfig,e),this}addDataSources(e){return e.forEach((e=>{this.appConfig.dataSources&&this.appConfig.dataSources[e.id]||(this.appConfig=this.appConfig.setIn(["dataSources",e.id],e))})),this}addUtility(e){var t;let i=null!==(t=this.appConfig.utilities)&&void 0!==t?t:(0,o.Immutable)({});return i=i.set(e.id,e),this.appConfig=this.appConfig.set("utilities",i),this}removeUtility(e){var t;let i=null!==(t=this.appConfig.utilities)&&void 0!==t?t:(0,o.Immutable)({});const n=(0,g.Cp)();try{n.forEach((t=>{if(!t.utilityWillRemove)return;const i=this.appConfig.widgets[t.widgetId];i&&i.useUtilities&&i.useUtilities.find((t=>t.utilityId===e))&&(this.appConfig=t.utilityWillRemove(this.appConfig,e))}))}catch(e){console.error("Error when calling utilityWillRemove",e)}return i=i.without(e),this.appConfig=this.appConfig.set("utilities",i),this}updateUtilities(e){return this.appConfig=this.appConfig.set("utilities",e),this}removeDataSource(e){return this.appConfig=p.no.removeDataSource(this.appConfig,e),this}removeUseDataSource(e){return this.appConfig=p.no.removeUseDataSource(this.appConfig,e),this}editDataSource(e){return this.appConfig=this.appConfig.setIn(["dataSources",e.id],e),this}addAppProxy(e){return this.appConfig.appProxies&&this.appConfig.appProxies[e.id]||(this.appConfig=this.appConfig.setIn(["appProxies",e.id],e)),this}editAppProxy(e){return this.appConfig=this.appConfig.setIn(["appProxies",e.id],e),this}removeAppProxy(e){return this.appConfig.appProxies&&this.appConfig.appProxies[e]?(this.appConfig=this.appConfig.set("appProxies",this.appConfig.appProxies.without(e)),this):this}addMessage(e){return this.appConfig=this.appConfig.setIn(["messageConfigs",e.id],e),this}editMessage(e){return this.appConfig=this.appConfig.setIn(["messageConfigs",e.id],e),this}removeMessage(e){return this.appConfig.messageConfigs&&this.appConfig.messageConfigs[e.id]?(this.appConfig=this.appConfig.set("messageConfigs",this.appConfig.messageConfigs.without(e.id)),this):this}editTheme(e){return this.appConfig=this.appConfig.set("theme",e),this}editCustomTheme(e){return this.appConfig=this.appConfig.set("customTheme",e),this}editCustomThemeOption(e){return this.appConfig=this.appConfig.set("customThemeOptions",e),this}initHeaderLayout(){const e=this.createLayout(o.LayoutType.FixedLayout);return this.editLayoutProperty(e,"setting.lockDescendants",!0),this.appConfig=this.appConfig.setIn(["layouts",e,"parent"],{id:"",type:o.LayoutParentType.Header}).setIn(["header","layout",this.appConfig.mainSizeMode],e),this}editHeaderProperty(e,t){let i=this.appConfig.header;return i?(i=this.editJsonProperty(i,e,t),this.appConfig=this.appConfig.set("header",i),this):this}initFooterLayout(){const e=this.createLayout(o.LayoutType.FixedLayout);return this.editLayoutProperty(e,"setting.lockDescendants",!0),this.appConfig=this.appConfig.setIn(["layouts",e,"parent"],{id:"",type:o.LayoutParentType.Footer}).setIn(["footer","layout",this.appConfig.mainSizeMode],e),this}editFooterProperty(e,t){let i=this.appConfig.footer;return i?(i=this.editJsonProperty(i,e,t),this.appConfig=this.appConfig.set("footer",i),this):this}setViewportSize(e,t){return this.appConfig=this.appConfig.setIn(["forBuilderAttributes","viewPortSize",e],t),this}setLockLayout(e){return this.appConfig=this.appConfig.setIn(["forBuilderAttributes","lockLayout"],e),this}editAttributes(e){return this.appConfig=this.appConfig.setIn(["attributes"],e),this}updateAnalyticsConfig(e){return this.appConfig=this.appConfig.setIn(["analytics"],e),this}updateCookieBannerConfig(e){return this.appConfig=this.appConfig.setIn(["cookieBanner"],e),this}editCookieBannerConfig(e,t){return this.appConfig="string"==typeof e?this.appConfig.setIn(["cookieBanner",e],t):this.appConfig.setIn(["cookieBanner",...e],t),this}removeCookieBannerConfig(){return this.appConfig=this.appConfig.without("cookieBanner"),this}updateUrlParamsConfig(e){this.appConfig.urlParams||(this.appConfig=this.appConfig.set("urlParams",{}));const t=this.appConfig.urlParams.merge(e);return this.appConfig=this.appConfig.set("urlParams",t),this}getDuplicateLabel(e,t){const[i]=a.parseUniqueLabel(t);let o=a.getUniqueLabel(this.appConfig,e,i);return o===i&&(o=`${i} 1`),o}removePageFromPageStructure(e){if(!this.appConfig.pageStructure)return this;return this.appConfig.pageStructure.find((t=>!!t[e]))?this.appConfig=this.appConfig.set("pageStructure",this.appConfig.pageStructure.flatMap((t=>t[e]?[]:[t]))):this.appConfig.pageStructure.forEach(((t,i)=>{const o=Object.keys(t).find((i=>t[i].includes(e)));if(o)return this.appConfig=this.appConfig.setIn(["pageStructure",i+"",o],t[o].flatMap((t=>t===e?[]:[t]))),!0})),this}movePageIntoPageForPageStructure(e,t){return this.appConfig.pageStructure?(this.appConfig.pageStructure.some(((i,o)=>{const n=Object.keys(i).find((e=>e===t));if(n)return this.appConfig=this.appConfig.setIn(["pageStructure",o+"",n],this.appConfig.pageStructure[o][n].concat([e])),!0})),this):this}editJsonProperty(e,t,i){if(!e)return e;const o=t.split(".").filter((e=>""!==e));if(o.length>0){if(e.getIn(o)===i)return e;if(null==i){if(1===o.length)return e.without(o[0]);const t=o.pop(),i=e.getIn(o);return e.setIn(o,i.without(t))}return e.setIn(o,i)}return e}handleWidgetUseDataSourceChange(e,t){var i,n,a,s;if(void 0===t.useDataSources||o.lodash.isDeepEqual(e.useDataSources,t.useDataSources))return;const r=[];r[0]=null===(n=null===(i=e.useDataSources)||void 0===i?void 0:i.find((e=>{var i;return!(null===(i=t.useDataSources)||void 0===i?void 0:i.find((t=>(null==t?void 0:t.dataSourceId)===(null==e?void 0:e.dataSourceId))))})))||void 0===n?void 0:n.dataSourceId,r[1]=null===(s=null===(a=t.useDataSources)||void 0===a?void 0:a.find((t=>{var i;return!(null===(i=e.useDataSources)||void 0===i?void 0:i.find((e=>(null==e?void 0:e.dataSourceId)===(null==t?void 0:t.dataSourceId))))})))||void 0===s?void 0:s.dataSourceId;const l=(0,g.nj)(t.id);(null==l?void 0:l.useDataSourceWillChange)&&(this.appConfig=l.useDataSourceWillChange(this.appConfig,r[0],r[1]))}}},6764:(e,t,i)=>{"use strict";i.d(t,{yC:()=>$,zM:()=>r,no:()=>u,YU:()=>F,X7:()=>f,rW:()=>R,HA:()=>U,Qi:()=>H,Q7:()=>T});var o=i(9244);class n{addParentToList(e,t,i){if(!t||0===t.length)return[i];if(!t.some((e=>e.layoutId===i.layoutId&&e.layoutItemId===i.layoutItemId))){const o=t[0].layoutId,n=e.layouts[o],a=e.layouts[i.layoutId];if(o===i.layoutId||a.parent.id!==n.parent.id||a.parent.type!==n.parent.type)return[i];return[].concat(t,i)}return t}removeParentFromList(e,t){return e&&0!==e.length?e.filter((e=>e.layoutId!==t.layoutId||e.layoutItemId!==t.layoutItemId)):[]}}var a=i(8249);const s=o.LayoutType.FixedLayout;class r{static getInstance(){return r.instance||(r.instance=new r),r.instance}static getService(e,t){var i;const o=e.layouts[t],n=r.getInstance().getServiceByType(null!==(i=null==o?void 0:o.type)&&void 0!==i?i:s);return n||r.getInstance().getServiceByType(s)}static getServiceFromSizeModeLayout(e,t){var i;const o=Object.values(t)[0],n=t[e.mainSizeMode];return null!==(i=r.getService(e,o))&&void 0!==i?i:r.getService(e,n)}constructor(){this.serviceMap=new Map}registerService(e,t){this.serviceMap.set(e,t)}getServiceByType(e){return this.serviceMap.get(null!=e?e:s)}}var l=i(320),d=i(1496);const u=new class{removeDataSource(e,t){if(!e.dataSources||!e.dataSources[t])return e;console.debug("removeDataSource",t);let i=e;const o=(0,l.Cp)();try{o.forEach((e=>{if(e.dataSourceWillRemove){if(e.widgetId){const o=i.widgets[e.widgetId];if(!o||!o.useDataSources||!o.useDataSources.find((e=>e.dataSourceId===t||e.mainDataSourceId===t)))return}i=e.dataSourceWillRemove(i,t)}}))}catch(e){console.error("Error when calling dataSourceWillRemove",e)}return i=i.set("dataSources",i.dataSources.without(t)),i=this.removeUseDataSource(i,t),i}removeUseDataSource(e,t){var i,o;if(!t)return e;console.debug("removeUseDataSource",t);let n=e;return Object.entries(null!==(i=n.widgets)&&void 0!==i?i:{}).forEach((([e,i])=>{if(i.useDataSources&&i.useDataSources.find((e=>this.shouldBeRemoved(e,t)))){const o=(0,l.nj)(e);(null==o?void 0:o.useDataSourceWillChange)&&(n=o.useDataSourceWillChange(n,t,null)),n=n.setIn(["widgets",e,"useDataSources"],i.useDataSources.filter((e=>!this.shouldBeRemoved(e,t))))}i.outputDataSources&&i.outputDataSources.find((e=>e===t))&&(n=n.setIn(["widgets",e,"outputDataSources"],i.outputDataSources.filter((e=>e!==t))))})),Object.keys(null!==(o=n.messageConfigs)&&void 0!==o?o:{}).forEach((e=>{var i;const o=null===(i=n.messageConfigs[e].actions)||void 0===i?void 0:i.asMutable({deep:!0});null==o||o.forEach(((i,a)=>{var s;if(null===(s=null==i?void 0:i.useDataSources)||void 0===s?void 0:s.find((e=>this.shouldBeRemoved(e,t)))){if(!i.widgetId){(0,l.Cp)().filter((e=>!e.widgetId)).forEach((e=>{(null==e?void 0:e.useDataSourceWillChange)&&(n=e.useDataSourceWillChange(n,t,null))}))}o[a].useDataSources=i.useDataSources.filter((e=>!this.shouldBeRemoved(e,t))),n=n.setIn(["messageConfigs",e,"actions"],o)}}))})),Object.entries(n.dataSources).forEach((([e,i])=>{i.originDataSources&&i.originDataSources.find((e=>this.shouldBeRemoved(e,t)))&&(n=this.removeDataSource(n,e))})),n}duplicateDataSource(e,t,i,o,n){if(!e.dataSources||!e.dataSources[o])return null;console.debug("duplicate data source",o);const s=e.dataSources[o];let r=a.getUniqueId("dataSource");s.isOutputFromWidget&&(r=o.startsWith(`${t}_output`)?o.replace(`${t}_output`,`${i}_output`):`${i}_output_${r}`);const d=s.set("id",r).set("label",(0,l.mz)(e,"dataSource",s.label)),u=this.addDataSource(e,d);return n&&(n[o]=d.id),[u,d]}addDataSource(e,t){return e.dataSources&&e.dataSources[t.id]?e:e.setIn(["dataSources",t.id],t)}updateAfterChangingLayout(e,t,i){if(!e.widgets[t])return e;console.debug(t,"update data source after move to",i);let o=e.widgets[t],n=e;const a=d.searchUtils.getWidgetIdThatUseTheLayoutId(n,i);if(a){const e=n.widgets[a];e.manifest.properties.passDataSourceToChildren&&(o=this.mergeUseDataSource(e,o),n=n.setIn(["widgets",o.id],o))}return n}mergeUseDataSource(e,t){if(!e.useDataSources)return t;const i=e.useDataSources.map((e=>e.without("fields")));return t.useDataSources?(i.forEach((e=>{e.dataViewId?t.useDataSources.find((t=>t.dataSourceId===e.dataSourceId&&t.dataViewId===e.dataViewId))||(t=t.set("useDataSources",t.useDataSources.concat([e]))):t.useDataSources.find((t=>t.dataSourceId===e.dataSourceId))||(t=t.set("useDataSources",t.useDataSources.concat([e])))})),t.set("useDataSourcesEnabled",!0)):t.set("useDataSources",i).set("useDataSourcesEnabled",!0)}shouldBeRemoved(e,t){return!e||e.dataSourceId===t||e.mainDataSourceId===t||e.rootDataSourceId===t}};const c=new class{duplicate(e,t,i,o){const n=e.messageConfigs;if(!n)return[e,null];console.debug("duplicate message configs from",t,"to",i);let s=e,r=null;return Object.keys(n).forEach((e=>{if(n[e].widgetId===t){const t=n[e].set("id",a.getUniqueId("messageConfig")).set("widgetId",i);r=t.id,s=s.setIn(["messageConfigs",t.id],t),o[e]=t.id}if(n[e].actions){const o=[];n[e].actions.forEach((e=>{if(e.widgetId===t){const t=e.set("widgetId",i);o.push(t)}})),o.length>0&&(s=s.setIn(["messageConfigs",n[e].id,"actions"],n[e].actions.concat(o)))}})),[s,r]}removeFromWidget(e,t){const i=e.messageConfigs;if(!i)return e;console.debug("remove message and action in",t);const n=Object.keys(i);let a=(0,o.Immutable)({});for(let e=0;e<n.length;e++)i[n[e]].widgetId!==t&&(a=a.setIn([i[n[e]].id],i[n[e]]));const s=Object.keys(a);for(let e=0;e<s.length;e++){const o=a[s[e]].actions;if(0===o.length)continue;const n=o.filter((e=>e.widgetId!==t)),r=Object.assign([],n);a=a.setIn([i[s[e]].id,"actions"],r)}return e.set("messageConfigs",a)}};const p=new class{removeFromWidget(e,t){var i;const o=e.widgets[t];if(!(null===(i=o.manifest)||void 0===i?void 0:i.dataActions)||0===o.manifest.dataActions.length)return e;console.debug("remove data action in",t);const n=o.manifest.dataActions.map((e=>e.name));let a=e;return Object.keys(e.widgets).forEach((i=>{let o=e.widgets[i];o.dataActions&&n.forEach((e=>{var n,s;const r=null===(n=o.dataActions)||void 0===n?void 0:n[e];if(r){const n=null===(s=r.actions)||void 0===s?void 0:s.without(t);0===Object.keys(n||{}).length?(o=o.set("dataActions",o.dataActions.without(e)),0===Object.keys(o.dataActions).length&&(o=o.without("dataActions"))):o=o.setIn(["dataActions",e,"actions"],n),a=a.setIn(["widgets",i],o)}}))})),a}};const g=new class{remove(e,t){let i=e;return console.debug("remove used map widgets",t),Object.keys(i.widgets).forEach((e=>{var o;const n=i.widgets[e];if(null===(o=n.useMapWidgetIds)||void 0===o?void 0:o.includes(t)){const o=n.useMapWidgetIds.filter((e=>e!==t));i=i.setIn(["widgets",e,"useMapWidgetIds"],o)}})),i}};function h(e,t){return e.layoutId===t.layoutId&&e.layoutItemId===t.layoutItemId}const f=new class{isSupported(){var e,t,i;let n;window.jimuConfig.isInBuilder?n=(0,o.getAppStore)().getState():window.jimuConfig.isBuilder&&(n=(0,o.getAppStore)().getState().appStateInBuilder);const a=(null===(e=null==n?void 0:n.appInfo)||void 0===e?void 0:e.type)===o.AppType.Template,s=(null===(t=null==n?void 0:n.appRuntimeInfo)||void 0===t?void 0:t.appMode)===o.AppMode.Design,r=(null===(i=null==n?void 0:n.appRuntimeInfo)||void 0===i?void 0:i.appMode)===o.AppMode.Express;return a&&s||r}getNextPlaceholderId(e){var t;const i=Object.keys(null!==(t=e.placeholderInfos)&&void 0!==t?t:{}).map((e=>+e)).sort(((e,t)=>e-t));let o=1;for(let e=0;e<i.length&&o===i[e];e++)o++;return o}addAsSyncablePlaceholder(e,t){if(!this.isSupported())return e;const i=(0,o.getAppStore)().getState().browserSizeMode;if(i!==e.mainSizeMode)return e;const n=d.searchUtils.getRootContainerInfoOfLayout(e,t.layoutId,i),a=this.getNextPlaceholderId(e);return e.setIn(["placeholderInfos",`${a}`,"id"],a).setIn(["placeholderInfos",`${a}`,"rootContainer"],n).setIn(["placeholderInfos",`${a}`,"layoutInfo"],t)}getPlaceholderInfo(e,t){var i;if(!this.isSupported())return null;let o=null;return Object.keys(null!==(i=e.placeholderInfos)&&void 0!==i?i:{}).some((i=>{var n;const a=e.placeholderInfos[i];return h(a.layoutInfo,t)?(o=a,!0):Object.keys(null!==(n=a.syncs)&&void 0!==n?n:{}).some((e=>!!h(a.syncs[e],t)&&(o=a,!0)))})),o}afterLayoutItemMoved(e,t,i){var o;if(!this.isSupported())return e;let n=e;const a=this.getPlaceholderInfo(e,t);if(a){if(h(a.layoutInfo,t))return n=n.setIn(["placeholderInfos",a.id,"layoutInfo"],i),n;const e=Object.keys(null!==(o=a.syncs)&&void 0!==o?o:{});for(let o=0;o<e.length;o++){const s=e[o];if(h(a.syncs[s],t))return n=n.setIn(["placeholderInfos",a.id,"syncs",s],i),n}}return n}afterLayoutItemCopied(e,t,i){if(!this.isSupported())return e;const o=d.searchUtils.findLayoutItem(e,t);if(o.widgetId||o.sectionId)return e;const n=this.getPlaceholderInfo(e,t);return n&&h(n.layoutInfo,t)?this.addAsSyncablePlaceholder(e,i):e}afterLayoutItemRemoved(e,t){var i;if(!this.isSupported())return e;const o=this.getPlaceholderInfo(e,t);if(o){const n=e.placeholderInfos;if(h(o.layoutInfo,t))return e.set("placeholderInfos",n.without(o.id));const a=Object.keys(null!==(i=o.syncs)&&void 0!==i?i:{});for(let i=0;i<a.length;i++){const n=a[i];if(h(o.syncs[n],t))return 1===a.length?e.setIn(["placeholderInfos",o.id],o.without("syncs")):e.setIn(["placeholderInfos",o.id,"syncs"],o.syncs.without(n))}}return e}};var y=i(4601),m=i(9859),v=i.n(m),S=i(8850),I=i.n(S),C=i(1341),w=i.n(C),b=i(8201),D=i.n(b),M=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};function x(e){var t,i;return(null==e?void 0:e.widgetType)===o.WidgetType.Layout||null!==(i=null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.hasEmbeddedLayout)&&void 0!==i&&i}function A(e){switch(e){case o.LayoutType.FixedLayout:return I();case o.LayoutType.RowLayout:return w();case o.LayoutType.ColumnLayout:return D();default:return null}}const T=new class extends n{constructor(){super(),this.dsService=u,this.messageActionService=c,this.dataActionService=p,this.useMapService=g}createFromTemplate(e,t,i,n,s,d){return M(this,void 0,void 0,(function*(){var u,c;if(s[i]){const a=e.widgets[s[i]];if(!a.layouts)return[e,s[i]];let l=e;const d=t.config.widgets[i];for(let e=0;e<n.length;e++){const u=n[e],c=Object.keys(d.layouts).filter((e=>{var t;return Object.keys(null!==(t=d.layouts[e])&&void 0!==t?t:{}).length>0}));for(let e=0;e<c.length;e++){const n=c[e];if(a.layouts[n][u])continue;const p=d.layouts[n][u],g=r.getService(t.config,p),h=yield g.createLayoutFromTemplate(l,t,p,u,o.LayoutParentType.Widget,s[i],s);l=h[0];const f=h[1];null!=f&&(l=l.setIn(["widgets",s[i],"layouts",n,u],f))}}return[l,s[i]]}const p=null!==(u=null==d?void 0:d.isBlock)&&void 0!==u&&u;yield(0,l.IE)(t);const g=t.config,h=Object.keys(g.widgets).find((e=>"widgets/layout/row/"===g.widgets[e].uri));i=null!=i?i:h;const f=g.widgets[i],m=yield y.A.getInstance().handleNewWidgetJson({uri:f.uri});m.label=a.getUniqueLabel(e,"widget",m.manifest?m.manifest.i18nMessages._widgetLabel||m.manifest.label||m.manifest.name:"");const v=this.createWidget(e,m,n,!1);let S=v[0];const I=v[1];if(yield y.A.getInstance().registerManifestProps(S.widgets[I]),p){const e=o.i18n.getIntl().formatMessage({id:"block"}),t=a.getUniqueLabel(S,"widget",e);S=S.setIn(["widgets",I,"label"],t)}return s[i]=I,(null===(c=f.useMapWidgetIds)||void 0===c?void 0:c.length)>0&&(S=S.setIn(["widgets",I,"useMapWidgetIds"],f.useMapWidgetIds)),S=yield this.updateWidgetByTemplate(S,t,I,i,n,s),[S,I]}))}updateWidgetByTemplate(e,t,i,n,a,s){return M(this,void 0,void 0,(function*(){var d,u,c;const p=null===(d=null==e?void 0:e.widgets)||void 0===d?void 0:d[i];if(!p)return e;yield(0,l.IE)(t);let g=e;p.layouts&&Object.keys(p.layouts).forEach((e=>{const t=p.layouts[e];Object.keys(t).forEach((e=>{const i=t[e],o=r.getService(g,i);g=o.removeLayout(g,i,e)}))})),g=g.setIn(["widgets",i],p.without("layouts"));const h=null==t?void 0:t.config,f=null===(u=null==h?void 0:h.widgets)||void 0===u?void 0:u[n],y=[];if(f&&(f.config&&(g=g.setIn(["widgets",i,"config"],f.config)),f.style&&(g=g.setIn(["widgets",i,"style"],f.style)),f.layouts)){const i=f.layouts,n=[];Object.keys(i).forEach((t=>{var o,s;const r=i[t]||{},l=(null!==(s=null===(o=p.manifest)||void 0===o?void 0:o.layouts)&&void 0!==s?s:[]).find((e=>e.name===t));a.forEach((i=>{var o;const a=null!==(o=r[i])&&void 0!==o?o:r[e.mainSizeMode];a&&n.push({layoutName:t,sizeMode:i,layoutId:a,layoutLabel:null==l?void 0:l.label})}))}));for(let e=0;e<n.length;e+=1){const{layoutName:i,sizeMode:a,layoutId:l,layoutLabel:d}=n[e],u=r.getService(h,l),f=yield u.createLayoutFromTemplate(g,t,l,a,o.LayoutParentType.Widget,p.id,s);g=f[0];const m=f[1];y.push(m),g=g.setIn(["widgets",p.id,"layouts",i,a],m).setIn(["layouts",m,"label"],(null===(c=null==p?void 0:p.manifest)||void 0===c?void 0:c.i18nMessages[`_layout_${i}_label`])||d||i)}}return g}))}createWidget(e,t,i,n=!0){let s=e;const l=a.getUniqueId("widget");if(console.debug("createWidget",t),s=s.setIn(["widgets",l],t).setIn(["widgets",l,"id"],l),n&&x(t.manifest)){(t.manifest.layouts||[]).forEach((e=>{i.forEach((i=>{const n=r.getInstance().getServiceByType(e.type).createBlankLayout(s,e.type);s=n[0];const a=n[1];console.debug("embed layout",e.name,a,e.type,"created in",i),s=s.setIn(["layouts",a,"label"],t.manifest.i18nMessages[`_layout_${e.name}_label`]||e.label).setIn(["layouts",a,"parent"],{id:l,type:o.LayoutParentType.Widget}).setIn(["widgets",l,"layouts",e.name,i],a)}))}))}return[s,l]}duplicateEmbedLayout(e,t,i,n,s){var l;const d=e.widgets[t];if(!d||!d.layouts)return[e,null];let u=e;if(console.debug("duplicate layout of widget",t),(null===(l=d.manifest)||void 0===l?void 0:l.widgetType)===o.WidgetType.Layout&&i!==n){console.debug("deuplicate layout widget and its layout from",i,"to",n);const e=d.set("id",a.getUniqueId("widget")).without("layouts").without("parent");return u=u.setIn(["widgets",e.id],e),Object.keys(d.layouts).forEach((t=>{const a=d.layouts[t];if(a[i]){const l=r.getService(u,a[i]).duplicateLayout(u,a[i],i,n,s,!1);u=l[0];const d=l[1];null!=d&&(s[a[i]]=d,u=u.setIn(["layouts",d,"parent"],{type:o.LayoutParentType.Widget,id:e.id}).setIn(["widgets",e.id,"layouts",t,n],d))}})),[u,e.id]}return console.debug("duplicate widget layout only from",i,"to",n),Object.keys(d.layouts).forEach((e=>{const a=d.layouts[e];if(a[i]&&i!==n){const l=r.getService(u,a[i]);a[n]&&(u=l.removeLayout(u,a[n],n));const d=l.duplicateLayout(u,a[i],i,n,s,!1);u=d[0];const c=d[1];null!=c&&(s[a[i]]=c,u=u.setIn(["layouts",c,"parent"],{type:o.LayoutParentType.Widget,id:t}).setIn(["widgets",t,"layouts",e,n],c))}})),[u,null]}duplicate(e,t,i,n){console.debug("duplicate a widget",t);const s=e.widgets[t];if(!s)return[e,null];if(null==n?void 0:n[t]){const a=e.widgets[n[t]];if(!a.layouts)return[e,n[t]];const s=Object.keys(a.layouts)[0];if(a.layouts[s][i])return[e,n[t]];const l=e.widgets[t];let d=e;return Object.keys(l.layouts).forEach((e=>{const a=l.layouts[e][i],s=r.getService(d,a).duplicateLayout(d,a,i,i,n,!0);d=s[0];const u=s[1];null!=u&&(d=d.setIn(["widgets",n[t],"layouts",e,i],u).setIn(["layouts",u,"parent"],{type:o.LayoutParentType.Widget,id:n[t]}))})),[d,n[t]]}const d=s.set("id",a.getUniqueId("widget")).set("label",(0,l.mz)(e,"widget",s.label)),u=this.beforeDuplicated(e,t,d,i,n);return n&&(n[t]=d.id),[u,d.id]}tryRemove(e,t,i,n){var a,s,l;const d=null===(a=e.widgets)||void 0===a?void 0:a[t];if(!d)return e;const u=[o.BrowserSizeMode.Large,o.BrowserSizeMode.Medium,o.BrowserSizeMode.Small].filter((e=>e!==n)).some((e=>{var t,i;return(null===(i=null===(t=d.parent)||void 0===t?void 0:t[e])||void 0===i?void 0:i.length)>0})),c=(null===(l=null===(s=d.parent)||void 0===s?void 0:s[n])||void 0===l?void 0:l.length)>1;if(u||c){let o=this.removeParent(e,t,i,n);return d.layouts&&Object.keys(d.layouts).forEach((e=>{const i=d.layouts[e];if(i[n]){const a=r.getServiceFromSizeModeLayout(o,i);o=a.removeSizeModeLayouts(o,{[n]:i[n]}),o=o.setIn(["widgets",t,"layouts",e],i.without(n))}})),o}return this.remove(e,t)}remove(e,t){var i;if(!(null===(i=e.widgets)||void 0===i?void 0:i[t]))return e;console.debug("remove a widget",t);const o=this.beforeRemoved(e,t);return o.set("widgets",o.widgets.without(t))}toTocNode(e,t,i,n){var a,s,l,d;const{layoutId:u,layoutItemId:c}=i,p={label:"",layoutId:u,layoutItemId:c,type:"widget",id:t},g=null===(a=e.widgets)||void 0===a?void 0:a[t];if(!g)return null==t&&(p.label=o.i18n.getIntl().formatMessage({id:"placeholder"}),p.icon=v(),p.flipIcon=!1,p.isLabelReadOnly=!0),p;if(p.label=g.label,p.icon=g.icon,p.flipIcon=null!==(d=null===(l=null===(s=g.manifest)||void 0===s?void 0:s.properties)||void 0===l?void 0:l.flipIcon)&&void 0!==d&&d,!(null==g?void 0:g.layouts))return p;const h=[],f=1===Object.keys(g.layouts).length;return Object.keys(g.layouts).forEach((t=>{var i,o,a,s;const l=null!==(i=g.layouts[t][n])&&void 0!==i?i:g.layouts[t][e.mainSizeMode],d=r.getService(e,l).getTocStructure(e,l);if(d.length>0){const i=e.layouts[l].type,n=null===(a=null===(o=g.manifest)||void 0===o?void 0:o.layouts)||void 0===a?void 0:a.find((e=>e.name===t));h.push({label:f?"":null!=n?null!==(s=g.manifest.i18nMessages[`_layout_${t}_label`])&&void 0!==s?s:n.label:t,icon:A(i),type:"layout",id:l,isLabelReadOnly:!0,children:d})}})),1===h.length?p.children=h[0].children:h.length>1&&(p.children=h),p}afterMoved(e,t,i,o){return e.widgets[t]?(console.debug("update widget",t,"ds after moved to a new layout",o),this.dsService.updateAfterChangingLayout(e,t,o)):e}afterAdded(e,t,i,n,a){var s;const l=e.widgets[t];if(!l)return e;console.debug("after added, update widget",t,"added to a new layout",i,"from",n,"to",a);let d=this.dsService.updateAfterChangingLayout(e,t,i);return Object.keys(null!==(s=l.layouts)&&void 0!==s?s:{}).forEach((e=>{const i=l.layouts[e];if(i[n]&&!i[a]){const s=d.layouts[i[n]],l=r.getService(d,i[n]).duplicateLayout(d,s.id,n,a,null);d=l[0];const u=l[1];null!=u&&(d=d.setIn(["layouts",u,"parent"],{type:o.LayoutParentType.Widget,id:t}).setIn(["widgets",t,"layouts",e,a],u))}})),d}beforeRemoved(e,t){var i,n,a,s;const d=e.widgets[t];let u=e;console.debug("clear widget resource before removing",t);(0,l.Cp)().forEach((e=>{if(e.anyWidgetWillRemove)try{u=e.anyWidgetWillRemove(u,t)}catch(e){console.error("Error when calling anyWidgetWillRemove",e)}}));const c=o.utils.isExpressMode(),p=Object.keys(null!==(i=d.parent)&&void 0!==i?i:{}).length;if(c&&p>1){const t=d.parent[e.mainSizeMode][0];if(u.layouts[t.layoutId].type!==o.LayoutType.FlexRowLayout){u=f.addAsSyncablePlaceholder(u,t);const i=f.getPlaceholderInfo(u,t);[o.BrowserSizeMode.Large,o.BrowserSizeMode.Medium,o.BrowserSizeMode.Small].filter((t=>t!==e.mainSizeMode)).forEach((e=>{var t;if((null===(t=d.parent[e])||void 0===t?void 0:t.length)>0){const t=d.parent[e][0];u=u.setIn(["placeholderInfos",i.id,"syncs",e],t)}}))}else{const e=f.getPlaceholderInfo(u,t);e&&u.placeholderInfos[e.id]&&(u=u.set("placeholderInfos",u.placeholderInfos.without(e.id)))}}if(Object.keys(null!==(n=d.parent)&&void 0!==n?n:{}).forEach((e=>{d.parent[e].length>0&&d.parent[e].forEach((t=>{if(u.layouts[t.layoutId]){const i=r.getService(u,t.layoutId);u=i.removeItem(u,t,e,!1)}}))})),d.outputDataSources&&d.outputDataSources.forEach((e=>{u=this.dsService.removeDataSource(u,e)})),u=this.messageActionService.removeFromWidget(u,t),u=this.dataActionService.removeFromWidget(u,t),d.layouts&&Object.keys(d.layouts).forEach((e=>{const t=d.layouts[e],i=r.getServiceFromSizeModeLayout(u,t);u=i.removeSizeModeLayouts(u,t)})),null===(s=null===(a=d.manifest)||void 0===a?void 0:a.properties)||void 0===s?void 0:s.canCreateMapView){const e=(0,l.Cp)();try{e.forEach((e=>{if(!e.mapWidgetWillRemove)return;if(e.widgetId===t)return;const i=u.widgets[e.widgetId];i&&i.useMapWidgetIds&&i.useMapWidgetIds.find((e=>e===t))&&(u=e.mapWidgetWillRemove(u,t))}))}catch(e){console.error("Error when calling mapWidgetWillRemove",e)}u=this.useMapService.remove(u,d.id)}const g=(0,l.nj)(t);if(g&&g.widgetWillRemove)try{u=g.widgetWillRemove(u)}catch(e){console.error("Error when calling widgetWillRemove",e)}return u}beforeDuplicated(e,t,i,n,a){var s,l;let d=e;if(console.debug("process before duplicate widget",t),x(i.manifest)&&(d=d.setIn(["widgets",i.id],i),Object.keys(null!==(s=i.layouts)&&void 0!==s?s:{}).forEach((t=>{var s;const l=i.layouts[t],u=null!=a?a:{},c=r.getServiceFromSizeModeLayout(d,l).duplicateSizeModeLayouts(d,{[n]:null!==(s=l[n])&&void 0!==s?s:l[e.mainSizeMode]},o.LayoutParentType.Widget,i.id,u);d=c[0],i=i.setIn(["layouts",t],c[1])}))),(null===(l=i.outputDataSources)||void 0===l?void 0:l.length)>0){const e=i.outputDataSources.map((e=>{const o=this.dsService.duplicateDataSource(d,t,i.id,e,a);d=o[0];return o[1].id}));i=i.set("outputDataSources",e)}return d=d.setIn(["widgets",i.id],i),d}replaceUseDataSource(e,t){const{mainDataSourceId:i,dataSourceId:o}=e;if(t[i]){const n=o.replace(i,t[i]);return e.set("mainDataSourceId",t[i]).set("dataSourceId",n)}return e}afterBatchCopied(e,t,i){let o=e;return t.messageConfigs&&Object.keys(t.messageConfigs).forEach((e=>{var n;const s=t.messageConfigs[e];if(i[s.widgetId]){let e=s.set("id",a.getUniqueId("messageConfig")).set("widgetId",i[s.widgetId]);if((null===(n=s.actions)||void 0===n?void 0:n.length)>0){const t=s.actions.map((e=>{var t;let o=e.set("messageWidgetId",i[e.messageWidgetId]);if(i[e.widgetId]&&(o=o.set("widgetId",i[e.widgetId]).set("actionId",e.actionId.replace(e.widgetId,i[e.widgetId]))),(null===(t=e.useDataSources)||void 0===t?void 0:t.length)>0){const t=e.useDataSources.map((e=>this.replaceUseDataSource(e,i)));o=o.set("useDataSources",t)}return o}));e=e.set("actions",t),o=o.setIn(["messageConfigs",e.id],e)}}})),Object.keys(null!=i?i:{}).forEach((n=>{var a,s;const r=i[n];if(t.widgets[n]&&o.widgets[r]){const d=o.widgets[r];if((null===(a=d.useMapWidgetIds)||void 0===a?void 0:a.length)>0){const e=d.useMapWidgetIds.map((e=>{var t;return null!==(t=i[e])&&void 0!==t?t:e}));o=o.setIn(["widgets",r,"useMapWidgetIds"],e)}if((null===(s=d.useDataSources)||void 0===s?void 0:s.length)>0){const e=d.useDataSources.map((e=>this.replaceUseDataSource(e,i)));o=o.setIn(["widgets",r,"useDataSources"],e)}let u;d.dataActions&&Object.keys(d.dataActions).forEach((e=>{const t=d.dataActions[e];if(t.actions){const n={};Object.keys(t.actions).forEach((e=>{const o=t.actions[e];if(i[e]){let t=o;o.widgetId&&i[o.widgetId]&&(t=t.set("widgetId",i[o.widgetId])),n[i[e]]=t}else n[e]=o})),o=o.setIn(["widgets",r,"dataActions",e,"actions"],n)}})),u=e===t?n:r;const c=(0,l.nj)(u);if(c&&c.afterWidgetCopied)try{o=c.afterWidgetCopied(n,t,r,o,i)}catch(e){console.error("Error when calling afterWidgetCopied",e)}}})),o}addParent(e,t,i,o){var n;const a=e.widgets[t];if(!a)return e;console.debug("add parent",i.layoutId,i.layoutItemId,"to widget",t,"in",o);const s=this.addParentToList(e,null===(n=a.parent)||void 0===n?void 0:n[o],i);return e.setIn(["widgets",t,"parent",o],s)}removeParent(e,t,i,o){const n=e.widgets[t];if(!n||null==n.parent)return e;if(console.debug("remove parent",i.layoutId,i.layoutItemId,"from widget",t,"in",o),o){const a=n.parent[o],s=this.removeParentFromList(a,i);return 0===s.length?e.setIn(["widgets",t,"parent"],n.parent.without(o)):e.setIn(["widgets",t,"parent",o],s)}let a=e;return Object.keys(n.parent).forEach((e=>{const o=n.parent[e],s=this.removeParentFromList(o,i);a=0===s.length?a.setIn(["widgets",t,"parent"],n.parent.without(e)):a.setIn(["widgets",t,"parent",e],s)})),a}clearParent(e,t){const i=e.widgets[t];return i&&null!=i.parent?e.setIn(["widgets",t],i.without("parent")):e}removeSizeModeParent(e,t,i){var o;const n=e.widgets[t];return n&&null!=(null===(o=n.parent)||void 0===o?void 0:o[i])?e.setIn(["widgets",t,"parent"],n.parent.without(i)):e}findParent(e,t,i){var o,n;const a=e.widgets[t];if(!a||!a.parent)return null;const s=null!==(o=a.parent[i])&&void 0!==o?o:a.parent[e.mainSizeMode];if(!s)return null;if(1===s.length)return s[0];const r=s[0].layoutId,l=e.layouts[r];return this.findParent(e,null===(n=l.parent)||void 0===n?void 0:n.id,i)}hasParent(e,t,i){var o,n;const a=e.widgets[t];return!(!a||!a.parent)&&(null===(n=null===(o=a.parent)||void 0===o?void 0:o[i])||void 0===n?void 0:n.length)>0}hasMultipleParents(e,t,i){var o,n;const a=e.widgets[t];return!(!a||!a.parent)&&(null===(n=null===(o=a.parent)||void 0===o?void 0:o[i])||void 0===n?void 0:n.length)>1}};var L=i(8736),P=i.n(L),E=i(2606),k=i.n(E),j=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};const U=new class extends n{createFromTemplate(e,t,i,n,s){return j(this,void 0,void 0,(function*(){if(s[i]){const a=e.sections[s[i]],l=e.views[a.views[0]],d=t.config.sections[i];let u=e;for(let e=0;e<n.length;e++){const i=n[e];if(!l.layout[i])for(let e=0;e<d.views.length;e++){const n=d.views[e],a=t.config.views[n].layout[i],l=r.getService(t.config,a),c=yield l.createLayoutFromTemplate(u,t,a,i,o.LayoutParentType.View,s[n],s);u=c[0];const p=c[1];null!=p&&(u=u.setIn(["views",s[n],"layout",i],p))}}return[u,s[i]]}yield(0,l.IE)(t);let d=e;const u=t.config.sections[i],c=a.getUniqueId("section");d=d.setIn(["sections",c],u).setIn(["sections",c,"id"],c).setIn(["sections",c,"label"],a.getUniqueLabel(e,"section",o.i18n.getIntl().formatMessage({id:"section"})));const p=[];for(let e=0;e<u.views.length;e+=1){const i=u.views[e],o=yield this.createViewFromTemplate(d,t,i,n,s);d=o[0],p.push(o[1]),d=d.setIn(["views",o[1],"parent"],c)}return d=d.setIn(["sections",c,"views"],p),s[i]=c,[d,c]}))}createViewFromTemplate(e,t,i,n,s){return j(this,void 0,void 0,(function*(){let n=e;yield(0,l.IE)(t);const d=t.config,u=d.views[i],c=a.getUniqueId("view");n=n.setIn(["views",c],u).setIn(["views",c,"id"],c).setIn(["views",c,"label"],a.getUniqueLabel(e,"view",o.i18n.getIntl().formatMessage({id:"view"})));const p=[];Object.keys(u.layout||{}).forEach((e=>{p.push({sizeMode:e,layoutId:u.layout[e]})}));for(let e=0;e<p.length;e+=1){const{sizeMode:i,layoutId:a}=p[e],l=r.getService(d,a),u=yield l.createLayoutFromTemplate(n,t,a,i,o.LayoutParentType.View,c,s);n=u[0];const g=u[1];n=n.setIn(["views",c,"layout",i],g)}return s&&(s[i]=c),[n,c]}))}duplicateEmbedLayout(e,t,i,n,a){var s;const l=null===(s=e.sections)||void 0===s?void 0:s[t];if(!l)return[e,null];let d=e;return console.debug(`duplicate section ${t} from ${i} to ${n}`),l.views.forEach((e=>{const t=d.views[e].layout;if(t[i]&&!t[n]){const s=r.getService(d,t[i]).duplicateLayout(d,t[i],i,n,a,!1);d=s[0];const l=s[1];null!=l&&(a[t[i]]=l,d=d.setIn(["layouts",l,"parent"],{type:o.LayoutParentType.View,id:e}).setIn(["views",e,"layout",n],l))}})),[d,null]}duplicate(e,t,i,n){var s;console.debug("dplicate section",t,"in",i);const d=null===(s=e.sections)||void 0===s?void 0:s[t];if(!d)return[e,null];if(null==n?void 0:n[t]){const a=e.sections[n[t]];if(e.views[a.views[0]].layout[i])return[e,n[t]];const s=e.sections[t];let l=e;return s.views.forEach((e=>{const t=l.views[e].layout[i],a=r.getService(l,t).duplicateLayout(l,t,i,i,n,!0);l=a[0];const s=a[1];null!=s&&(l=l.setIn(["views",n[e],"layout",i],s).setIn(["layouts",s,"parent"],{type:o.LayoutParentType.View,id:n[e]}))})),[l,n[t]]}let u=d.set("id",a.getUniqueId("section")).set("label",(0,l.mz)(e,"section",d.label)),c=e.setIn(["sections",u.id],u);const p=d.views.map((e=>{const t=this.duplicateView(c,d.id,e,[i],!1,n);c=t[0];const o=t[1];return c=c.setIn(["views",o,"parent"],u.id),o}));return u=u.set("views",p),c=c.setIn(["sections",u.id],u),n&&(n[t]=u.id),[c,u.id]}removeDirectly(e,t){var i;const o=null===(i=e.sections)||void 0===i?void 0:i[t];let n=e;return o.views.forEach((e=>{const t=n.views[e],i=r.getServiceFromSizeModeLayout(n,t.layout);n=i.removeSizeModeLayouts(n,t.layout),n=n.set("views",n.views.without(e))})),n=n.set("sections",n.sections.without(t)),n}tryRemove(e,t,i,n){var a;const s=null===(a=e.sections)||void 0===a?void 0:a[t];if(!s)return e;console.debug(`remove section ${t} from ${i.layoutId} ${i.layoutItemId}`,n);const l=[o.BrowserSizeMode.Large,o.BrowserSizeMode.Medium,o.BrowserSizeMode.Small].filter((e=>e!==n)).some((e=>{var t,i;return(null===(i=null===(t=s.parent)||void 0===t?void 0:t[e])||void 0===i?void 0:i.length)>0}));if(l){let o=this.removeParent(e,t,i,n);return s.views.forEach((e=>{const t=o.views[e];if(t.layout[n]){const i=r.getServiceFromSizeModeLayout(o,t.layout);o=i.removeSizeModeLayouts(o,{[n]:t.layout[n]}),o=o.setIn(["views",e,"layout"],t.layout.without(n))}})),o}return this.remove(e,t)}remove(e,t){var i,o;const n=null===(i=e.sections)||void 0===i?void 0:i[t];if(!n)return e;console.debug("remove section",t);let a=e;return Object.keys(null!==(o=n.parent)&&void 0!==o?o:{}).forEach((e=>{n.parent[e].length>0&&n.parent[e].forEach((t=>{if(a.layouts[t.layoutId]){const i=r.getService(a,t.layoutId);a=i.removeItem(a,t,e,!1)}}))})),this.removeDirectly(a,t)}toTocNode(e,t,i,o){var n,a;const{layoutId:s,layoutItemId:l}=i,d={label:"",layoutId:s,layoutItemId:l,type:"section",id:t,children:[]},u=null===(n=e.sections)||void 0===n?void 0:n[t];return u?(d.label=u.label,d.icon=null!==(a=u.icon)&&void 0!==a?a:P(),d.flipIcon=!0,u.views.forEach((t=>{var i,n;const a=e.views[t],s=null!==(i=a.layout[o])&&void 0!==i?i:a.layout[e.mainSizeMode],l=r.getService(e,s).getTocStructure(e,s);d.children.push({label:a.label,icon:null!==(n=a.icon)&&void 0!==n?n:k(),flipIcon:!1,type:"view",id:t,children:l})})),d):d}afterMoved(e,t,i,o){return e}afterAdded(e,t,i,n,a){var s;const l=null===(s=e.sections)||void 0===s?void 0:s[t];if(!l)return e;let d=e;return l.views.forEach((e=>{const t=d.views[e];if(t.layout[n]&&!t.layout[a]){const i=d.layouts[t.layout[n]],s=r.getService(d,t.layout[n]).duplicateLayout(d,i.id,n,a,null);d=s[0];const l=s[1];null!=l&&(d=d.setIn(["layouts",l,"parent"],{type:o.LayoutParentType.View,id:e}).setIn(["views",e,"layout",a],l))}})),d}addParent(e,t,i,o){var n;const a=e.sections[t];if(!a)return e;console.debug("add parent",i.layoutId,i.layoutItemId,"to section",t,"in",o);const s=this.addParentToList(e,null===(n=a.parent)||void 0===n?void 0:n[o],i);return e.setIn(["sections",t,"parent",o],s)}removeParent(e,t,i,o){const n=e.sections[t];if(!n||null==n.parent)return e;if(console.debug("remove parent",i.layoutId,i.layoutItemId,"from section",t,"in",o),o){const a=n.parent[o],s=this.removeParentFromList(a,i);return 0===s.length?e.setIn(["sections",t,"parent"],n.parent.without(o)):e.setIn(["sections",t,"parent",o],s)}let a=e;return Object.keys(n.parent).forEach((e=>{const o=n.parent[e],s=this.removeParentFromList(o,i);a=0===s.length?a.setIn(["sections",t,"parent"],n.parent.without(e)):a.setIn(["sections",t,"parent",e],s)})),a}clearParent(e,t){const i=e.sections[t];return i&&null!=i.parent?e.setIn(["sections",t],i.without("parent")):e}removeSizeModeParent(e,t,i){var o;const n=e.sections[t];return n&&null!=(null===(o=n.parent)||void 0===o?void 0:o[i])?e.setIn(["sections",t,"parent"],n.parent.without(i)):e}findParent(e,t,i){var o,n;const a=e.sections[t];if(!a.parent)return null;const s=null!==(o=a.parent[i])&&void 0!==o?o:a.parent[e.mainSizeMode];if(!s)return null;if(1===s.length)return s[0];const r=s[0].layoutId,l=e.layouts[r];return T.findParent(e,null===(n=l.parent)||void 0===n?void 0:n.id,i)}hasParent(e,t,i){var o;const n=e.sections[t];return!!n.parent&&(null===(o=n.parent[i])||void 0===o?void 0:o.length)>0}hasMultipleParents(e,t,i){var o;const n=e.sections[t];return!!n.parent&&(null===(o=n.parent[i])||void 0===o?void 0:o.length)>0}createSection(e,t){console.debug("create a blank section",t);const i=a.getUniqueId("section"),n={id:i,label:a.getUniqueLabel(e,"section",o.i18n.getIntl().formatMessage({id:"section"})),views:[]};let s=e.setIn(["sections",n.id],n);return s=this.addView(s,i,t)[0],[s,i]}createBlankView(e,t){return{id:a.getUniqueId("view"),parent:t,label:a.getUniqueLabel(e,"view",o.i18n.getIntl().formatMessage({id:"view"}))}}addView(e,t,i){var n;const s=null===(n=e.sections)||void 0===n?void 0:n[t];if(!s)return[e,null];let r;const l=this.createBlankView(e,t);s.views?(r=s.views.asMutable(),r.push(l.id)):r=[l.id];let d=e.setIn(["views",l.id],l).setIn(["sections",t,"views"],r);return i.forEach((e=>{const t={id:a.getUniqueId("layout"),type:o.LayoutType.FixedLayout,content:{},parent:{id:l.id,type:o.LayoutParentType.View}};d=d.setIn(["layouts",t.id],t).setIn(["views",l.id,"layout",e],t.id)})),[d,l.id]}duplicateView(e,t,i,n,s,d){if(!e.views||!e.views[i])return[e,null];console.debug("duplicate a view",i,"in",n);let u=e.views[i].set("id",a.getUniqueId("view"));u=u.set("label",(0,l.mz)(e,"view",u.label)),s||(u=u.without("parent"));let c=e.setIn(["views",u.id],u);const p={};n.forEach((e=>{p[e]=u.layout[e]}));const g=null!=d?d:{},h=r.getServiceFromSizeModeLayout(c,p).duplicateSizeModeLayouts(c,p,o.LayoutParentType.View,u.id,g);if(c=h[0],u=u.set("layout",h[1]),c=c.setIn(["views",u.id],u),s){const e=c.sections[t].views.asMutable(),o=e.indexOf(i);e.splice(o,1,i,u.id),c=c.setIn(["sections",t,"views"],e)}return d&&(d[i]=u.id),[c,u.id]}removeView(e,t,i){var o,n;const a=null===(o=e.sections)||void 0===o?void 0:o[t],s=null===(n=e.views)||void 0===n?void 0:n[i];if(!s||!a||1===a.views.length||!a.views.includes(i))return e;console.debug("remove a view",i,"from",t);const l=a.views.filter((e=>e!==i));let d=e.setIn(["sections",t,"views"],l);return d=r.getServiceFromSizeModeLayout(d,s.layout).removeSizeModeLayouts(d,s.layout),d=d.set("views",d.views.without(i)),d}};var _=i(9218),O=i.n(_),z=i(7528),B=i.n(z),W=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};const R=new class extends n{createFromTemplate(e,t,i,n,s){return W(this,void 0,void 0,(function*(){if(s[i])return[e,s[i]];let r=e;console.debug("create screen group",i,"from template in",n),yield(0,l.IE)(t);const d=t.config;i=null!=i?i:Object.keys(d.screenGroups)[0];const u=d.screenGroups[i],c=a.getUniqueId("screenGroup");s[i]=c,r=r.setIn(["screenGroups",c],u).setIn(["screenGroups",c,"id"],c).setIn(["screenGroups",c,"label"],a.getUniqueLabel(e,"screenGroup",o.i18n.getIntl().formatMessage({id:"screenGroup"})));const p=[];for(let e=0;e<u.screens.length;e+=1){const i=u.screens[e],o=yield this.createScreenFromTemplate(r,t,i,n,s);r=o[0],p.push(o[1]),r=r.setIn(["screens",o[1],"parent"],c)}return r=r.setIn(["screenGroups",c,"screens"],p),s[i]=c,[r,c]}))}createScreenFromTemplate(e,t,i,n,s){return W(this,void 0,void 0,(function*(){var d,u,c;let p=e;console.debug("create screen",i,"from template in",n),yield(0,l.IE)(t);const g=t.config;i=null!=i?i:Object.keys(g.screens)[0];const h=g.screens[i],f=a.getUniqueId("screen");s[i]=f,p=p.setIn(["screens",f],h).setIn(["screens",f,"id"],f).setIn(["screens",f,"label"],a.getUniqueLabel(e,"screen",o.i18n.getIntl().formatMessage({id:"screen"})));const y=[];Object.keys(null!==(u=null===(d=h.panel)||void 0===d?void 0:d.layout)&&void 0!==u?u:{}).forEach((e=>{y.push({sizeMode:e,isSide:!0,layoutId:h.panel.layout[e]})})),Object.keys(null!==(c=h.main.layout)&&void 0!==c?c:{}).forEach((e=>{y.push({sizeMode:e,isSide:!1,layoutId:h.main.layout[e]})}));for(let e=0;e<y.length;e+=1){const{sizeMode:i,layoutId:n,isSide:a}=y[e],l=r.getService(g,n),d=yield l.createLayoutFromTemplate(p,t,n,i,o.LayoutParentType.Screen,f,s);p=d[0];const u=d[1];p=p.setIn(["layouts",u,"parent"],{type:o.LayoutParentType.Screen,id:f}),p=a?p.setIn(["screens",f,"panel","layout",i],u):p.setIn(["screens",f,"main","layout",i],u)}return[p,f]}))}duplicateEmbedLayout(e,t,i,n,a){var s;const l=null===(s=e.screenGroups)||void 0===s?void 0:s[t];if(!l)return[e,null];let d=e;return l.screens.forEach((e=>{var t;const s=d.screens[e],l=s.main.layout;if(l[i]&&!l[n]){const t=r.getService(d,l[i]).duplicateLayout(d,l[i],i,n,null,!1);d=t[0];const s=t[1];null!=t[1]&&(a[l[i]]=s,d=d.setIn(["layouts",s,"parent"],{type:o.LayoutParentType.Screen,id:e}).setIn(["screens",e,"main","layout",n],s))}const u=null===(t=s.panel)||void 0===t?void 0:t.layout;if(u&&u[i]&&!u[n]){const t=r.getService(d,u[i]).duplicateLayout(d,u[i],i,n,null,!1);d=t[0];const s=t[1];null!=t[1]&&(a[u[i]]=s,d=d.setIn(["layouts",s,"parent"],{type:o.LayoutParentType.Screen,id:e}).setIn(["screens",e,"panel","layout",n],s))}})),[d,null]}duplicate(e,t,i,n){var s;const d=null===(s=e.screenGroups)||void 0===s?void 0:s[t];if(!d)return[e,null];if(null==n?void 0:n[t]){const a=e.screenGroups[n[t]];if(e.screens[a.screens[0]].main.layout[i])return[e,n[t]];{const a=e.screenGroups[t];let s=e;return a.screens.forEach((e=>{var t;const a=s.screens[e],l=a.main.layout[i],d=r.getService(s,l).duplicateLayout(s,l,i,i,n,!0);s=d[0];const u=d[1];if(null!=u&&(s=s.setIn(["screens",n[e],"main","layout",i],u).setIn(["layouts",u,"parent"],{type:o.LayoutParentType.Screen,id:n[e]})),null===(t=a.panel)||void 0===t?void 0:t.layout){const t=a.panel.layout[i],l=r.getService(s,t).duplicateLayout(s,t,i,i,n,!0);s=l[0];const d=l[1];null!=d&&(s=s.setIn(["screens",n[e],"panel","layout",i],d).setIn(["layouts",d,"parent"],{type:o.LayoutParentType.Screen,id:n[e]}))}})),[s,n[t]]}}console.debug("duplicate screen group",t,"to",i);let u=d.set("id",a.getUniqueId("screenGroup")).set("label",(0,l.mz)(e,"screenGroup",d.label)),c=e.setIn(["screenGroups",u.id],u);const p=d.screens.map((e=>{const t=this.duplicateScreen(c,d.id,e,[i],!1,n);c=t[0];const o=t[1];return c=c.setIn(["screens",o,"parent"],u.id),o}));return u=u.set("screens",p),c=c.setIn(["screenGroups",u.id],u),n&&(n[t]=u.id),[c,u.id]}tryRemove(e,t,i,n){var a;const s=null===(a=e.screenGroups)||void 0===a?void 0:a[t];if(!s)return e;console.debug(`try remove screenGroup ${t} from ${i.layoutId} ${i.layoutItemId}`,n);const l=[o.BrowserSizeMode.Large,o.BrowserSizeMode.Medium,o.BrowserSizeMode.Small].filter((e=>e!==n)).some((e=>{var t;return null!=(null===(t=s.parent)||void 0===t?void 0:t[e])}));if(l){let o=this.removeParent(e,t,i,n);return s.screens.forEach((e=>{var t;const i=o.screens[e];if(i.main.layout[n]){const t=r.getServiceFromSizeModeLayout(o,i.main.layout);o=t.removeSizeModeLayouts(o,{[n]:i.main.layout[n]}),o=o.setIn(["screens",e,"main","layout"],i.main.layout.without(n))}if(null===(t=i.panel)||void 0===t?void 0:t.layout[n]){const t=r.getServiceFromSizeModeLayout(o,i.panel.layout);o=t.removeSizeModeLayouts(o,{[n]:i.panel.layout[n]}),o=o.setIn(["screens",e,"panel","layout"],i.panel.layout.without(n))}})),o}return this.remove(e,t)}remove(e,t){var i,o;const n=null===(i=e.screenGroups)||void 0===i?void 0:i[t];if(!n)return e;let a=e;return console.debug("remove screen group",t),Object.keys(null!==(o=n.parent)&&void 0!==o?o:{}).forEach((e=>{const{layoutId:t}=n.parent[e];if(a.layouts[t]){const i=r.getService(a,t);a=i.removeItem(a,n.parent[e],e,!1)}})),n.screens.forEach((e=>{var t;const i=a.screens[e],o=r.getServiceFromSizeModeLayout(a,i.main.layout);if(a=o.removeSizeModeLayouts(a,i.main.layout),null===(t=i.panel)||void 0===t?void 0:t.layout){const e=r.getServiceFromSizeModeLayout(a,i.panel.layout);a=e.removeSizeModeLayouts(a,i.panel.layout)}a=a.set("screens",a.screens.without(e))})),a=a.set("screenGroups",a.screenGroups.without(t)),a}toTocNode(e,t,i,n){var a,s;const{layoutId:l,layoutItemId:d}=i,u={label:"",layoutId:l,layoutItemId:d,type:"screenGroup",id:t,children:[]},c=null===(a=e.screenGroups)||void 0===a?void 0:a[t];return c?(u.label=c.label,u.icon=null!==(s=c.icon)&&void 0!==s?s:B(),u.flipIcon=!1,c.screens.forEach((t=>{var i,a,s;const l=e.screens[t],d={label:l.label,icon:O(),flipIcon:!1,type:"screen",id:t,children:[]},c=null!==(i=l.main.layout[n])&&void 0!==i?i:l.main.layout[e.mainSizeMode],p=r.getService(e,c).getTocStructure(e,c);if(d.children.push({label:o.i18n.getIntl().formatMessage({id:"mainStage"}),isLabelReadOnly:!0,type:"layout",id:c,children:p}),null===(a=l.panel)||void 0===a?void 0:a.layout){const t=null!==(s=l.panel.layout[n])&&void 0!==s?s:l.panel.layout[e.mainSizeMode],i=r.getService(e,t).getTocStructure(e,t);d.children.push({label:o.i18n.getIntl().formatMessage({id:"scrollingPanel"}),isLabelReadOnly:!0,type:"layout",id:t,children:i})}u.children.push(d)})),u):u}afterMoved(e,t,i,o){return e}afterAdded(e,t,i,n,a){var s;const l=null===(s=e.screenGroups)||void 0===s?void 0:s[t];if(!l)return e;let d=e;return l.screens.forEach((e=>{var t,i;const s=d.screens[e];if(s.main.layout[n]&&!s.main.layout[a]){const t=d.layouts[s.main.layout[n]],i=r.getService(d,s.main.layout[n]).duplicateLayout(d,t.id,n,a,null);d=i[0];const l=i[1];null!=l&&(d=d.setIn(["layouts",l,"parent"],{type:o.LayoutParentType.Screen,id:e}).setIn(["screens",e,"main","layout",a],l))}if((null===(i=null===(t=s.panel)||void 0===t?void 0:t.layout)||void 0===i?void 0:i[n])&&!s.panel.layout[a]){const t=d.layouts[s.panel.layout[n]],i=r.getService(d,s.panel.layout[n]).duplicateLayout(d,t.id,n,a,null);d=i[0];const l=i[1];null!=l&&(d=d.setIn(["layouts",l,"parent"],{type:o.LayoutParentType.Screen,id:e}).setIn(["screens",e,"panel","layout",a],l))}})),d}addParent(e,t,i,o){return e.screenGroups[t]?(console.debug("add parent",i.layoutId,i.layoutItemId,"to",t,"in",o),e.setIn(["screenGroups",t,"parent",o],i)):e}removeParent(e,t,i,o){const n=e.screenGroups[t];if(!n||!n.parent)return e;if(console.debug("remove parent",i.layoutId,i.layoutItemId,"from",t),o){const a=n.parent[o];return(null==a?void 0:a.layoutId)===i.layoutId&&(null==a?void 0:a.layoutItemId)===i.layoutItemId?e.setIn(["screenGroups",t,"parent"],n.parent.without(o)):e}let a=e;return Object.keys(n.parent).forEach((o=>{const s=n.parent[o];s.layoutId===i.layoutId&&s.layoutItemId===i.layoutItemId&&(a=e.setIn(["screenGroups",t,"parent"],n.parent.without(o)))})),a}clearParent(e,t){const i=e.screenGroups[t];return i?e.setIn(["screenGroups",t],i.without("parent")):e}removeSizeModeParent(e,t,i){var o;const n=e.screenGroups[t];return n&&(null===(o=n.parent)||void 0===o?void 0:o[i])?e.setIn(["screenGroups",t,"parent"],n.parent.without(i)):e}findParent(e,t,i){var o;const n=e.screenGroups[t];if(!n||!n.parent)return null;return null!==(o=n.parent[i])&&void 0!==o?o:n.parent[e.mainSizeMode]}hasParent(e,t,i){const o=e.screenGroups[t];return!(!o||!o.parent)&&null!=o.parent[i]}hasMultipleParents(){return!1}duplicateScreen(e,t,i,n,s,d){var u,c,p;const g=null===(u=e.screenGroups)||void 0===u?void 0:u[t],h=null===(c=e.screens)||void 0===c?void 0:c[i];if(!h||!g||!g.screens.includes(i))return[e,null];console.debug("duplicate screen",i,"in",n,"to",t);let f=h.set("id",a.getUniqueId("screen")).set("label",(0,l.mz)(e,"screen",h.label));s||(f=f.without("parent"));let y=e.setIn(["screens",f.id],f);const m={};n.forEach((e=>{m[e]=f.main.layout[e]}));const v=null!=d?d:{},S=r.getServiceFromSizeModeLayout(y,m).duplicateSizeModeLayouts(y,m,o.LayoutParentType.Screen,f.id,v);if(y=S[0],f=f.setIn(["main","layout"],S[1]),null===(p=f.panel)||void 0===p?void 0:p.layout){const e={};n.forEach((t=>{e[t]=f.panel.layout[t]}));const t=r.getServiceFromSizeModeLayout(y,e).duplicateSizeModeLayouts(y,e,o.LayoutParentType.Screen,f.id,v);y=t[0],f=f.setIn(["panel","layout"],t[1])}if(y=y.setIn(["screens",f.id],f),s){const e=g.screens.asMutable(),o=e.indexOf(i);e.splice(o,1,i,f.id),y=y.setIn(["screenGroups",t,"screens"],e)}return d&&(d[i]=f.id),[y,f.id]}removeScreen(e,t,i){var o,n;const a=null===(o=e.screenGroups)||void 0===o?void 0:o[t],s=null===(n=e.screens)||void 0===n?void 0:n[i];if(!s||!a||1===a.screens.length||!a.screens.includes(i))return e;console.debug("remove screen",i,"in",t);const l=a.screens.filter((e=>e!==i));let d=e.setIn(["screenGroups",t,"screens"],l);if(d=r.getServiceFromSizeModeLayout(d,s.main.layout).removeSizeModeLayouts(d,s.main.layout),s.panel){d=r.getServiceFromSizeModeLayout(d,s.panel.layout).removeSizeModeLayouts(d,s.panel.layout)}return d=d.set("screens",d.screens.without(i)),d}};const F=new class{setContentId(e,t,i,n){if(!i)return e;const{layoutId:a,layoutItemId:s}=t,r=d.searchUtils.findLayoutItem(e,t);if(r){let l=e;switch(r.type){case o.LayoutItemType.Widget:l=l.setIn(["layouts",a,"content",s,"widgetId"],i),l=T.addParent(l,i,t,n);break;case o.LayoutItemType.Section:l=l.setIn(["layouts",a,"content",s,"sectionId"],i),l=U.addParent(l,i,t,n);break;case o.LayoutItemType.ScreenGroup:l=l.setIn(["layouts",a,"content",s,"screenGroupId"],i),l=R.addParent(l,i,t,n);break;default:return l}return l}return e}};var G=i(6884),q=i(4981),N=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};const H=new class{createPageFromTemplate(e,t,i){return N(this,void 0,void 0,(function*(){var n;let a=e;yield(0,l.IE)(t);const s=t.config,d=Object.keys(s.pages)[0],u=s.pages[d],c=o.appConfigUtils.getUniqueId("page"),p=o.appConfigUtils.getUniqueLabel(e,"page",o.i18n.getIntl().formatMessage({id:"page"})),g=Object.keys(null!==(n=u.layout)&&void 0!==n?n:{});i[d]=c,a=a.setIn(["pages",c],u).setIn(["pages",c,"id"],c).setIn(["pages",c,"isVisible"],!0).setIn(["pages",c,"isDefault"],!1).setIn(["pages",c,"label"],p).setIn(["pages",c,"header"],!1).setIn(["pages",c,"footer"],!1);for(let e=0;e<g.length;e+=1){const n=g[e],l=u.layout[n],d=r.getService(s,l),p=yield d.createLayoutFromTemplate(a,t,l,n,o.LayoutParentType.Page,c,i);a=p[0];const h=p[1];a=a.setIn(["pages",c,"layout",n],h).setIn(["layouts",h,"parent"],{id:c,type:o.LayoutParentType.Page})}return[a,c]}))}createDialogFromTemplate(e,t,i){return N(this,void 0,void 0,(function*(){var n;let a=e;yield(0,l.IE)(t);const s=t.config,d=Object.keys(s.dialogs)[0],u=s.dialogs[d],c=o.appConfigUtils.getUniqueId("dialog"),p=o.appConfigUtils.getUniqueLabel(e,"dialog",o.i18n.getIntl().formatMessage({id:"dialog"})),g=Object.keys(null!==(n=u.layout)&&void 0!==n?n:{});i[d]=c;const h=Object.keys(Object.keys(a.dialogs).filter((e=>a.dialogs[e].mode===u.mode))).length;a=a.setIn(["dialogs",c],u).setIn(["dialogs",c,"id"],c).setIn(["dialogs",c,"label"],p).setIn(["dialogs",c,"index"],h).setIn(["dialogs",c,"isSplash"],!1).setIn(["dialogs",c,"closeWhenClickOverlay"],u.closeWhenClickOverlay).setIn(["dialogs",c,"sizeMode"],u.sizeMode);for(let e=0;e<g.length;e+=1){const n=g[e],l=u.layout[n],d=r.getService(s,l),p=yield d.createLayoutFromTemplate(a,t,l,n,o.LayoutParentType.Dialog,c,i);a=p[0];const h=p[1];a=a.setIn(["dialogs",c,"layout",n],h).setIn(["layouts",h,"parent"],{id:c,type:o.LayoutParentType.Dialog})}return[a,c]}))}applyTemplateToHeader(e,t,i,n){return N(this,void 0,void 0,(function*(){var a,s,d,u;if(yield(0,l.IE)(t),!(null===(a=null==t?void 0:t.config)||void 0===a?void 0:a.header))return e;const c=t.config.header.layout,p=Object.values(c)[0],g=null===(s=null==e?void 0:e.header)||void 0===s?void 0:s.layout;if(g){const a=r.getService(t.config,p),s=yield a.replaceSizeModeLayout(e,g,t,(0,o.Immutable)(null===(u=null===(d=null==t?void 0:t.config)||void 0===d?void 0:d.header)||void 0===u?void 0:u.layout),i,o.LayoutParentType.Header,"header",n);let l=s[0];return Object.keys(s[1]).forEach((e=>{const t=s[1][e];l=l.setIn(["header","layout",e],t).setIn(["layouts",t,"parent"],{id:"header",type:o.LayoutParentType.Header})})),Object.keys(t.config.header).forEach((e=>{"layout"!==e&&null!=t.config.header[e]&&(l=l.setIn(["header",e],t.config.header[e]))})),l}return e}))}applyTemplateToFooter(e,t,i,n){return N(this,void 0,void 0,(function*(){var a,s,d,u;if(yield(0,l.IE)(t),!(null===(a=null==t?void 0:t.config)||void 0===a?void 0:a.footer))return e;const c=t.config.footer.layout,p=Object.values(c)[0],g=null===(s=null==e?void 0:e.footer)||void 0===s?void 0:s.layout;if(g){const a=r.getService(t.config,p),s=yield a.replaceSizeModeLayout(e,g,t,(0,o.Immutable)(null===(u=null===(d=null==t?void 0:t.config)||void 0===d?void 0:d.footer)||void 0===u?void 0:u.layout),i,o.LayoutParentType.Footer,"footer",n);let l=s[0];return Object.keys(s[1]).forEach((e=>{const t=s[1][e];l=l.setIn(["footer","layout",e],t).setIn(["layouts",t,"parent"],{id:"footer",type:o.LayoutParentType.Footer})})),Object.keys(t.config.footer).forEach((e=>{"layout"!==e&&null!=t.config.footer[e]&&(l=l.setIn(["footer",e],t.config.footer[e]))})),l}return e}))}applyTemplateToBody(e,t,i,n,a){return N(this,void 0,void 0,(function*(){var s,d;if(yield(0,l.IE)(i),!i.config){const t=yield(0,G.getTemplateConfig)(i.type,i.name);if(i.config=t,!i.config)return e;o.appConfigUtils.fixLayoutIds(i.config),o.utils.replaceI18nPlaceholdersInObject(i.config,o.i18n.getIntl(),q.A)}const u=Object.keys(i.config.pages)[0],c=i.config.pages[u].layout,p=Object.values(c)[0],g=null===(d=null===(s=null==e?void 0:e.pages)||void 0===s?void 0:s[t])||void 0===d?void 0:d.layout;if(g){const s=r.getService(i.config,p),l=yield s.replaceSizeModeLayout(e,g,i,(0,o.Immutable)(c),n,o.LayoutParentType.Page,t,a);let d=l[0];Object.keys(l[1]).forEach((e=>{const i=l[1][e];d=d.setIn(["pages",t,"layout",e],i).setIn(["layouts",i,"parent"],{id:t,type:o.LayoutParentType.Page})}));return["mode","maxWidth","bodyBackgroundColor","bodyBackgroundIMage","bodyBackgroundPosition"].forEach((e=>{const o=i.config.pages[u][e];"layout"!==e&&null!=o&&(d=d.setIn(["pages",t,e],o))})),d}return e}))}applyTemplateToDialog(e,t,i,n,a){return N(this,void 0,void 0,(function*(){var s,d,u;yield(0,l.IE)(i);const c=Object.keys(i.config.dialogs)[0],p=null===(s=null==e?void 0:e.dialogs)||void 0===s?void 0:s[t],g=null==p?void 0:p.layout,h=null===(u=null===(d=null==i?void 0:i.config)||void 0===d?void 0:d.dialogs)||void 0===u?void 0:u[c];if(g&&(null==h?void 0:h.layout)){const s=h.layout,l=Object.values(s)[0],d=r.getService(i.config,l),u=yield d.replaceSizeModeLayout(e,g,i,(0,o.Immutable)(s),n,o.LayoutParentType.Dialog,t,a);let c=u[0];const f=p.mode===h.mode,y=f?p.index:Object.keys(Object.keys(c.dialogs).filter((e=>c.dialogs[e].mode===h.mode))).length;c=c.setIn(["dialogs",t,"index"],y),Object.keys(u[1]).forEach((e=>{const i=u[1][e];c=c.setIn(["dialogs",t,"layout",e],i).setIn(["dialogs",t,"sizeMode",n],h.sizeMode[n]||h.sizeMode[o.BrowserSizeMode.Large]).setIn(["layouts",i,"parent"],{id:t,type:o.LayoutParentType.Dialog})}));return["mode","overlayColor","dialogBackground","border","blockPage","interactionType","interactionStyles","confirmBeforeClose","alwaysShowConfirmation","closeWhenClickOverlay"].forEach((e=>{c=c.setIn(["dialogs",t,e],h[e])})),f||Object.keys(c.dialogs).forEach((e=>{const t=c.dialogs[e];t.mode===p.mode&&t.index>p.index&&(c=c.setIn(["dialogs",t.id,"index"],t.index-1))})),c}return e}))}applyGridTemplate(e,t,i,n,a){return N(this,void 0,void 0,(function*(){var s,d;yield(0,l.IE)(i);const u=null===(d=null===(s=null==e?void 0:e.widgets)||void 0===s?void 0:s[t])||void 0===d?void 0:d.layouts,c=Object.values(i.config.widgets).find((e=>"widgets/layout/grid/"===e.uri)),p="DEFAULT",g=u[p],h=r.getInstance().getServiceByType(o.LayoutType.GridLayout),f=yield h.replaceSizeModeLayout(e,g,i,(0,o.Immutable)(c.layouts[p]),n,o.LayoutParentType.Widget,t,a);let y=f[0];return Object.keys(f[1]).forEach((e=>{const i=f[1][e];y=y.setIn(["widgets",t,"layouts",p,e],i).setIn(["layouts",i,"parent"],{id:t,type:o.LayoutParentType.Widget})})),y}))}};var V=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};class ${constructor(e,t){switch(this.appConfig=e,this.layoutItem=t,t.type){case o.LayoutItemType.Widget:this.service=T,this.contentId=t.widgetId;break;case o.LayoutItemType.Section:this.service=U,this.contentId=t.sectionId;break;case o.LayoutItemType.ScreenGroup:this.service=R,this.contentId=t.screenGroupId}}getConfig(){return this.appConfig}getContentId(){return this.contentId}createFromTemplate(e,t,i,o){return V(this,void 0,void 0,(function*(){if(this.contentId&&this.service){const n=yield this.service.createFromTemplate(this.appConfig,e,this.contentId,t,i,o);return this.appConfig=n[0],n}return[this.appConfig,null]}))}duplicateEmbedLayout(e,t,i){if(this.service){const o=this.service.duplicateEmbedLayout(this.appConfig,this.contentId,e,t,i);return this.appConfig=o[0],o}return[this.appConfig,null]}duplicate(e,t){if(this.service){const i=this.service.duplicate(this.appConfig,this.contentId,e,t);return this.appConfig=i[0],i}return[this.appConfig,null]}tryRemove(e,t){return this.service&&(this.appConfig=this.service.tryRemove(this.appConfig,this.contentId,e,t)),this.appConfig}remove(){return this.service&&(this.appConfig=this.service.remove(this.appConfig,this.contentId)),this.appConfig}toTocNode(e,t){return this.service?this.service.toTocNode(this.appConfig,this.contentId,e,t):null}afterMoved(e,t){return this.service&&(this.appConfig=this.service.afterMoved(this.appConfig,this.contentId,e,t)),this.appConfig}afterAdded(e,t,i){return this.service&&(this.appConfig=this.service.afterAdded(this.appConfig,this.contentId,e,t,i)),this.appConfig}addParent(e,t){return this.service&&(this.appConfig=this.service.addParent(this.appConfig,this.contentId,e,t)),this.appConfig}removeParent(e,t){return this.service&&(this.appConfig=this.service.removeParent(this.appConfig,this.contentId,e,t)),this.appConfig}clearParent(){return this.service&&(this.appConfig=this.service.clearParent(this.appConfig,this.contentId)),this.appConfig}removeSizeModeParent(e){return this.service&&(this.appConfig=this.service.removeSizeModeParent(this.appConfig,this.contentId,e)),this.appConfig}findParent(e){var t;return null===(t=this.service)||void 0===t?void 0:t.findParent(this.appConfig,this.contentId,e)}hasParent(e){var t,i;return null!==(i=null===(t=this.service)||void 0===t?void 0:t.hasParent(this.appConfig,this.contentId,e))&&void 0!==i&&i}hasMultipleParents(e){var t,i;return null!==(i=null===(t=this.service)||void 0===t?void 0:t.hasMultipleParents(this.appConfig,this.contentId,e))&&void 0!==i&&i}}},320:(e,t,i)=>{"use strict";i.d(t,{Cp:()=>u,IE:()=>l,mz:()=>r,nj:()=>d});var o=i(9244),n=i(6884),a=i(4981),s=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};function r(e,t,i){const[n]=o.appConfigUtils.parseUniqueLabel(i);let a=o.appConfigUtils.getUniqueLabel(e,t,n);return a===n&&(a=`${n} 1`),a}function l(e){return s(this,void 0,void 0,(function*(){if(!e.config){const t=yield(0,n.getTemplateConfig)(e.type,e.name);o.appConfigUtils.fixLayoutIds(t),o.utils.replaceI18nPlaceholdersInObject(t,o.i18n.getIntl(),a.A),e.config=t}}))}function d(e){return u().find((t=>t.widgetId===e))}function u(){let e;e=window.jimuConfig.isBuilder?window._appWindow._extensionManager:window._extensionManager;return(null==e?void 0:e.getExtensions(o.extensionSpec.ExtensionPoints.AppConfigOperations))||[]}},3557:(e,t,i)=>{"use strict";var o={};i.r(o),i.d(o,{checkItemVersion:()=>h,importItem:()=>g});var n,a,s,r=i(9244);i(3209);!function(e){e.AGOL="AGOL",e.Portal="Portal",e.Other="Other"}(n||(n={})),function(e){e.TemplateType="Web Experience Template",e.ExperienceType="Web Experience"}(a||(a={})),function(e){e.Published="Published",e.Draft="Draft",e.Changed="Changed"}(s||(s={}));var l=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};function d(e){return l(this,arguments,void 0,(function*(e,t={params:{f:"json"}},i="POST"){if("GET"===i){const i=e+function(e){if(!e)return"";const t=Object.keys(e);return t.length?"?"+t.map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&"):""}(t.params);return yield fetch(i,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>l(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>l(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}return"POST"===i?t.params&&"FormData"===t.params.constructor.name?yield fetch(e,{method:"POST",body:t.params}).then((e=>l(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>l(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.params)}).then((e=>l(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>l(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield Promise.reject(new Error(null))}))}function u(e=!1){var t;if(e)return r.urlUtils.getArcgisOnlineUrl();{const e=(null===(t=window.jimuConfig.mountPath)||void 0===t?void 0:t.slice(0,-1))||"";return`${window.location.origin}${e}`}}r.esri.restRequest.request;function c(e=!1){return e?"/sharing/rest/content/":"/sharing/rest/content/users/"}var p=function(e,t,i,o){return new(i||(i=Promise))((function(n,a){function s(e){try{l(o.next(e))}catch(e){a(e)}}function r(e){try{l(o.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?n(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(s,r)}l((o=o.apply(e,t||[])).next())}))};function g(e,t){return p(this,void 0,void 0,(function*(){const i=`${u()}${c()}importItem`;if(!(null==e?void 0:e.appZip))return Promise.reject(new Error("No app files"));t.params=Object.assign(Object.assign({},t.params),e);const o=Object.keys(t.params),n=new FormData;for(let e=0;e<o.length;e++)n.append(o[e],t.params[o[e]]);return t.params=n,yield d(i,t)}))}function h(e,t){return p(this,void 0,void 0,(function*(){const i=`${u()}${c()}checkItemVersion`;if(!(null==e?void 0:e.appZip))return Promise.reject(new Error("No app files"));t.params=Object.assign(Object.assign({},t.params),e);const o=Object.keys(t.params),n=new FormData;for(let e=0;e<o.length;e++)n.append(o[e],t.params[o[e]]);return t.params=n,yield d(i,t)}))}r.SessionManager.getInstance().isTrustedServer((0,r.getAppStore)().getState().portalUrl);const{importItem:f,checkItemVersion:y}=o;var m;i(8249),i(4321);!function(e){e.Config="config/config.json",e.Image="images/image-resources-list.json",e.Icon="images/icon-resources-list.json"}(m||(m={}))},2241:(e,t,i)=>{"use strict";i.d(t,{yx:()=>n});var o;i(9244),i(3596);!function(e){e.InBuilderPutAppConfigIntoHistory="IN_BUILDER_PUT_APPCONFIG_INTO_HISTORY",e.InBuilderRemoveLastAppConfigFromHistory="IN_BUILDER_REMOVE_LAST_APPCONFIG_FROM_HISTORY",e.InBuilderReplaceLastAppConfigInHistory="IN_BUILDER_REPLACE_LAST_APPCONFIG_IN_HISTORY",e.InBuilderAppConfigUndo="IN_BUILDER_APPCONFIG_UNDO",e.InBuilderAppConfigRedo="IN_BUILDER_APPCONFIG_REDO",e.InBuilderAppConfigRedoClear="IN_BUILDER_APPCONFIG_REDOCLEAR",e.InBuilderAppConfigClear="IN_BUILDER_APPCONFIG_CLEAR"}(o||(o={}));const n={InBuilderAppConfigUndo:()=>({type:o.InBuilderAppConfigUndo}),InBuilderAppConfigRedo:()=>({type:o.InBuilderAppConfigRedo}),InBuilderPutAppConfigIntoHistory:e=>({type:o.InBuilderPutAppConfigIntoHistory,appState:e}),InBuilderRemoveLastAppConfigFromHistory:()=>({type:o.InBuilderRemoveLastAppConfigFromHistory}),InBuilderReplaceLastAppConfigInHistory:e=>({type:o.InBuilderReplaceLastAppConfigInHistory,appState:e}),InBuilderAppConfigRedoClear:()=>({type:o.InBuilderAppConfigRedoClear}),InBuilderAppConfigClear:()=>({type:o.InBuilderAppConfigClear})}},1575:(e,t,i)=>{"use strict";i.d(t,{Aj:()=>n});var o;i(9244);!function(e){e.InAppAppStateChanged="IN_APP_APP_STATE_CHANGED",e.InBuilderAppConfigChanged="IN_BUILDER_APP_CONFIG_CHANGED"}(o||(o={}));const n={inAppAppStateChanged:e=>({type:o.InAppAppStateChanged,appState:e}),inBuilderAppConfigChanged:e=>({type:o.InBuilderAppConfigChanged,appConfig:e})}},4601:(e,t,i)=>{"use strict";i.d(t,{A:()=>n});var o=i(9244);class n extends o.WidgetManager{static getInstance(){return window.jimuConfig.isBuilder?window._appWindow&&window._appWindow._widgetManager:o.WidgetManager.getInstance()}}},3596:(e,t,i)=>{"use strict";i.d(t,{publishAppConfigChangeToApp:()=>n,publishAppModeChangeToApp:()=>a,publishChangeSelectionToApp:()=>s,publishKeyboardToApp:()=>r});i(9244),i(1575),i(2241),i(876);var o=i(1169);i(3557),i(7659);function n(e){l(`to_app.${o.w.AppConfigChanged}`,e)}function a(e){l(`to_app.${o.w.ChangeAppMode}`,e)}function s(e){l(`to_app.${o.w.ChangeSelection}`,e)}function r(e){l(`to_app.${o.w.BuilderTriggerKeyboard}`,e)}function l(e,t){window._builderPubsub.publishSync(e,t)}},3209:(e,t,i)=>{"use strict";var o;i(9244);!function(e){e.AddResource="ADD_RESOURCE",e.UpdateResource="UPDATE_RESOURCE",e.ClearResources="CLEAR_RESOURCES"}(o||(o={}))},876:(e,t,i)=>{"use strict";i.d(t,{Zv:()=>n});var o;i(9244);!function(e){e.SelectTemplate="SELECT_TEMPLATE",e.WidgetSettingClassLoaded="WIDGET_SETTING_CLASS_LOADED",e.WidgetsRemoved="WIDGETS_REMOVED",e.WidgetsAdded="WIDGETS_ADDED",e.ChangeCurrentApp="CHANGE_CURRENT_APP",e.RefreshAppList="REFRSH_APPLIST",e.SetLayoutTools="SET_LAYOUT_TOOLS",e.WidgetSettingI18nMessageLoaded="WIDGET_SETTING_I18N_MESSAGE_LOADED",e.ConfirmDeleteContentChanged="CONFIRM_DELETE_CONTENT_CHANGED",e.MessageActionSettingOpenStateChange="MESSAGE_ACTION_OPEN_STATE_CHANGE"}(o||(o={}));const n={selectTemplate:e=>({type:o.SelectTemplate,templateName:e}),refreshAppListAction:e=>({type:o.RefreshAppList,isRefresh:e}),widgetSettingClassLoaded:e=>({type:o.WidgetSettingClassLoaded,wigetUri:e}),changeMessageActionSettingOpenState:(e,t)=>({type:o.MessageActionSettingOpenStateChange,widgetId:e,open:t}),widgetsAdded:e=>({type:o.WidgetsAdded,widgets:e}),widgetsRemoved:e=>({type:o.WidgetsRemoved,widgetIds:e}),changeCurrentApp:e=>({type:o.ChangeCurrentApp,appId:e}),setLayoutTools:e=>({type:o.SetLayoutTools,tools:e}),widgetSettingI18nMessageLoaded:(e,t)=>({type:o.WidgetSettingI18nMessageLoaded,widgetName:e,i18nMessages:t}),confirmDeleteContentChanged:e=>({type:o.ConfirmDeleteContentChanged,itemToDelete:e})}},2883:(e,t,i)=>{"use strict";i.d(t,{_b:()=>l,OE:()=>v,F$:()=>m});var o=i(9244),n=i(8151),a=i(4981);const{useState:s,useEffect:r}=o.React;const l=o.ReactRedux.connect(((e,t)=>{var i,a,s;const r=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appConfig,l=null===(a=e.appStateInBuilder)||void 0===a?void 0:a.appRuntimeInfo.selection;let d;if(l){const e=(0,n.findLayoutItem)(r,l);e&&e.type===o.LayoutItemType.Widget&&e.widgetId&&(d=r.widgets[e.widgetId])}return{dataSourcesInfo:null===(s=e.appStateInBuilder)||void 0===s?void 0:s.dataSourcesInfo,widgetDs:null==d?void 0:d.useDataSources,widgetJson:d}}))((e=>{const t=o.utils.replaceI18nPlaceholdersInObject(i(5132),o.i18n.getIntl(),a.A),{dataSourcesInfo:l,widgetDs:d,widgetJson:u}=e,[c,p]=s(!1),[g,h]=s(0),[f,y]=s(!1),[m,v]=s({0:0,2:0}),S=function(e,t){if(!e||!t)return!1;const i=Object.keys(null!=e?e:{}).length;return Object.keys(null!=t?t:{}).length>i}(function(e){const t=o.React.useRef();return r((()=>{t.current=e})),t.current}(l),l);return r((()=>{var t;0===e.stepIndex&&"arcgis-map"===(null===(t=null==u?void 0:u.manifest)||void 0===t?void 0:t.name)&&v({0:1,2:1})}),[u,e.stepIndex]),r((()=>{p(e.run)}),[e.run]),r((()=>{h(e.stepIndex)}),[e.stepIndex]),r((()=>{c&&d&&y(!d.length),!c&&S&&(h(g+1),p(!0))}),[d,S,c]),o.React.createElement(n.GuideComponent,Object.assign({},e,{run:c,stepIndex:g,steps:t.steps,conditionalStepIndexes:m,onActionTriggered:(t,i,o)=>{var n;0===o?h(1):1===o&&p(!1),null===(n=null==e?void 0:e.onActionTriggered)||void 0===n||n.call(e,t,i,o)},onStepChange:t=>{const{index:i,event:o}=t;2===i&&o===n.EVENTS.TOOLTIP&&y(!0),null==e||e.onStepChange(Object.assign(Object.assign({},t),{run:c}))},disabled:f,isInjected:!0}))}));var d=i(3596),u=i(4617),c=i(1496);const{useState:p,useEffect:g,useMemo:h,useRef:f}=o.React;function y(e,t=""){return o.i18n.getIntl().formatMessage({id:e,defaultMessage:a.A[e]},{widgetName:t})}const m=e=>{const{params:t,appConfig:i,widgetSelection:a}=e,s=null==t?void 0:t.widgetName,[r,l]=p(!1),[m,v]=p(0),[S,I]=p(!1),C=f(null),w=f(null),b=h((()=>[{title:y("insertWidgetStep1Title"),content:{image:{src:"jimu-for-builder/guide-assets/insert-widget-guide.gif",alt:y("insertWidgetStep1Title"),border:!0,width:400,height:220,autoFlip:!0},text:y("insertWidgetStep1Content")},placement:"auto",target:`[data-sectionid='opts-section'] .widget-card-item[data-widget-name='${s}']`,spotlightClicks:!0,requiredAction:{type:"custom"},disableNextButton:!0}]),[s]),D=()=>{document.body.removeEventListener("dragstart",C.current),document.body.removeEventListener("dragend",w.current)};return g((()=>{D(),l(e.run)}),[e.run]),g((()=>{v(e.stepIndex)}),[e.stepIndex]),g((()=>{if(!r){const e=c.searchUtils.findLayoutItem(i,a);let t;e&&e.type===o.LayoutItemType.Widget&&e.widgetId&&(t=null==i?void 0:i.widgets[e.widgetId]),S&&(null==t?void 0:t.manifest.name)===s&&(v(1),l(!0))}}),[s,r,S,i,a]),o.React.createElement(n.GuideComponent,Object.assign({},e,{run:r,stepIndex:m,steps:b,onStepChange:t=>{const{index:i,event:o,step:a,status:s}=t,r=(0,n.getTargetSelector)(a),c=document.querySelector(r);if(c){(e=>{if(!e)return!1;const t=e.getBoundingClientRect(),i=window.innerHeight||document.documentElement.clientHeight,o=window.innerWidth||document.documentElement.clientWidth;if(!(t.top>=0&&t.left>=0&&t.bottom<=i&&t.right<=o))return!1;const n=t.left+t.width/2,a=t.top+t.height/2,s=document.elementFromPoint(n,a);return s===e||e.contains(s)})(c)||c.scrollIntoView({behavior:"smooth",block:"center"}),0===i&&o===n.EVENTS.TOOLTIP&&((0,d.publishChangeSelectionToApp)(null),(0,u.y)().setLockLayout(!1).exec(),((t,i)=>{C.current=e=>{var o,n;(null===(n=null===(o=e.target)||void 0===o?void 0:o.parentElement)||void 0===n?void 0:n.querySelector(i))===e.target?(l(!1),t.addEventListener("dragend",w.current)):D()},w.current=i=>{var o;"none"===(null===(o=null==i?void 0:i.dataTransfer)||void 0===o?void 0:o.dropEffect)?(v(0),l(!0)):(I(!0),e.onStepChange({isInjected:!0,status:n.STATUS.FINISHED})),t.removeEventListener("dragend",w.current),D()},t&&document.body.addEventListener("dragstart",C.current)})(c,r)),null==e||e.onStepChange(t)}else console.warn("insert widget target not found:",r);s!==n.STATUS.FINISHED&&s!==n.STATUS.SKIPPED||D()},isInjected:!0}))},v=o.ReactRedux.connect((e=>{var t,i,o;return{appConfig:null===(t=e.appStateInBuilder)||void 0===t?void 0:t.appConfig,widgetSelection:null===(o=null===(i=e.appStateInBuilder)||void 0===i?void 0:i.appRuntimeInfo)||void 0===o?void 0:o.selection}}))(m)},1169:(e,t,i)=>{"use strict";var o,n;i.d(t,{w:()=>o}),function(e){e.AppConfigChanged="app_config_changed",e.AppInfoChanged="app_info_changed",e.PortalSelfChanged="portal_self_changed",e.DialogInfosChanged="dialog_infos_changed",e.UserSignIn="user_sign_in",e.SetMainPortal="set_main_portal",e.ChangeAppMode="change_app_mode",e.ChangePage="change_page",e.ChangeDialog="change_dialog",e.ChangeSelection="change_selection",e.ChangeWidgetStateProp="change_widget_state_prop",e.ChangeWidgetMutableStateProp="change_widget_mutable_state_prop",e.ChangeZoomScale="change_zoom_scale",e.BuilderTriggerKeyboard="builder_trigger_keyboard",e.ChangeBrowserSizeMode="change_browser_size_mode",e.BuilderSessionChanged="builder_session_changed",e.BuilderNoPermissionResourceInfoListChanged="builder_no_permission_resource_info_list_changed",e.ActivePagePartChanged="active_page_part_changed",e.AnimationPreview="animation_preview",e.HoverPreview="hover_preview",e.SectionNavInfoChanged="section_navinfo_changed",e.ScreenGroupNavInfoChanged="screengroup_navinfo_changed",e.TocHoverInfoChanged="toc_hover_info_changed",e.SetClientIdAlertIsCancelled="set_client_id_alert_is_cancelled",e.UtilityStateChanged="utility_state_changed",e.OpenCookieBanner="open_cookie_banner",e.OpenCookieBannerByPrivacyPanel="open_cookie_banner_by_privacy_panel",e.OpenCookieSettingsWindow="open_cookie_settings_window",e.WidgetToolbarStateChange="widget_toolbar_state_change",e.SetWidgetIsInlineEditingState="set__widget_is_inline_editing_state",e.WidgetStateChange="widget_state_change",e.WidgetRuntimeInfoChange="widget_runtime_info_change"}(o||(o={})),function(e){e.AppStateChanged="app_state_changed",e.AppSessionChanged="app_session_changed",e.AppNoPermissionResourceInfoListChanged="app_no_permission_resource_info_list_changed",e.NeedToCheck498Error="need_to_check_498_error",e.AppAddResource="app_add_resource",e.AppClearResources="app_clear_resources",e.AppTriggerKeyboard="app_trigger_keyboard",e.SetLayoutTools="app_set_layout_tools",e.ClearLastAppConfigFromHistory="clear_last_app_config_from_history",e.SetIsBusy="app_set_isbusy",e.AppIsLoaded="app_is_loaded",e.ConfirmDelete="confirm_delete",e.NeedToRegisterClinetId="need_to_register_client_id",e.SetSidePanel="app_side_panel",e.CloseBannerInLiveView="close_banner_in_live_view"}(n||(n={}))},4981:(e,t,i)=>{"use strict";i.d(t,{A:()=>o});const o={frameworkAction_SetData:"Select data",frameworkAction_ActionLayer:"Action data",frameworkAction_Conditions:"Conditions",frameworkAction_RelateMessage:"Trigger / action connection",frameworkAction_UseRelationship:"Use layer's relationship",frameworkAction_CustomFields:"Set custom connection fields",frameworkAction_TriggerLayerField:"Select a trigger field",frameworkAction_None:"none",frameworkAction_Equals:"equals",frameworkAction_ActionLayerField:"Select an action field",frameworkAction_MoreConditions:"More conditions",frameworkAction_SetExpression:"Please set your expression first.",frameworkAction_ChooseLayer:"Select data",frameworkAction_AutoBind:"Auto bound.",frameworkAction_NoLayer:"No data.",frameworkAction_QueryByExtent:"Query by current extent",defaultTextPlaceholder:"Double click to edit text",titlePlaceholder:"Here is the title",subTitlePlaceholder:"Here is the subtitle",shortTitlePlaceholder:"Title",shortSubTitlePlaceholder:"Subtitle",copyrightPlaceholder:"Copyright info",cardTitle:"Card title",bookmark:"Bookmark",number:"Number",templateSearchResult:"Search result",logo:"Logo",appItemCopy:"Copy",openingGuideStep1Title:"Getting started",openingGuideStep1Content:"This tour will show you how to navigate in Experience Builder",openingGuideStep2Title:"Canvas",openingGuideStep2Content:"You can interact with widgets in your experience visually on the canvas.",openingGuideStep3Title:"Sidebar",openingGuideStep3Content:"Allows you to open the widget, page, data, and theme panels.",openingGuideStep4Title:"Insert widget",openingGuideStep4Content:"Click on the Map widget and drag it onto the canvas.",openingGuideStep5Title:"Resize widget",openingGuideStep5Content:"You can change the size of widget on the canvas.",openingGuideStep7Title:"Style",openingGuideStep7Content:"Click the Style tab to switch to the style setting panel.",openingGuideStep8Title:"Size and position",openingGuideStep8Content:"Click the Full size button located at the top right hand corner.",openingGuideStep8Title2:"Style",openingGuideStep8Content2:"Allows you to customize properties such as size, position, background, animation, border, and transform.",openingGuideStep9Title:"Action",openingGuideStep9Content:"Click the Action tab to switch to the action setting panel.",openingGuideStep10Title:"Action",openingGuideStep10Content:"Interactions between widgets can be configured using triggers and actions. Widget actions are in response to linked trigger actions in other widgets.",openingGuideStep11Title:"Header",openingGuideStep11Content:"Click Live view to make your experience interactive inside the builder.",openingGuideStep12Title:"Page",openingGuideStep12Content:"Shows the structure of your experience. You can create and organize pages and folders and change page settings.",openingGuideStep13Title:"Data",openingGuideStep13Content:"Displays all the data listed in your experience and the widgets connected to the data.",openingGuideStep14Title:"Theme",openingGuideStep14Content:"Defines the color scheme for the appearance of your experience.",openingGuideStep15Title:"End of tour",openingGuideStep15Content:"You can always return if you need a refresher.",DSSelectionStep1Title:"Widget content",DSSelectionStep1Content:"Click on Select map to add a new data source.",DSSelectionStep2Title:"Add new data",DSSelectionStep2Content:"Click add new data and select a web map for a data source.",DSSelectionStep3Title:"Select data",DSSelectionStep3Content:"Click the web map in the select data panel.",DSSelectionStep4Title:"Widget content",DSSelectionStep4Content:"Click on Select data to add a new data source.",DSSelectionStep5Title:"Select data",DSSelectionStep5Content:"Click the feature layer in the select data panel.",insertWidgetStep1Title:"Insert widget",insertWidgetStep1Content:"Click on the widget and drag it onto the canvas.",expressModeStep1Title:"Express mode",expressModeStep1Content:"Use express mode to focus on essential functions and content when designing an experience. You can move an experience from express mode to full mode if you need more advanced features and layout settings.",expressModeLearnMore:"Learn more",welcomeStep1Content:"This tour will show you how to navigate in Experience Builder express mode.",mapWidgetTitle:"Configure Widget",mapWidgetContent:"<p>Activate a widget by clicking on it. Widget configuration will open on the right side panel. For example, please <b>click on the map</b>.</p>",expressSelectDataTitle:"Configure map",expressSelectDataContent:"Select map source, enable map tools and configure other settings.",expressMessageActionTitle:"Message action",expressMessageActionContent:"Configure message actions to communicate with other widgets.",widgetControllerTitle:"Widget controller",widgetControllerContent:"<p><b>Click at the Widget controller area,</b> managing buttons will show on the top bar. Configure Widget controller behaviors on the right side.</p>",expressWidgetControllerAddWidgetTitle:"Add or manage widgets in Widget controller",expressWidgetControllerAddWidgetContent:"Click the Add button on the top bar to add widgets to the Widget controller. Use the Manage widget button to reorder or group widgets. To remove a widget, click on it and a Delete button will show on the top bar.",expressTextTitle:"Configure title",expressTextContent:"Double click to change the title for your app.",expressSectionTitle:"Add or manage views",expressSectionContent:"<p><b>Click on the View navigation area</b>, managing buttons will show on the top bar. You can add new views, reorder or remove views. You can add a widget to each view.</p>",expressSidebarTitle:"Configure widget in Sidebar",expressSidebarContent:"<p><b>Click the expand button</b> to open the sidebar. Click the widget inside to configure.</p>",expressSidebarTitle1:"Configure Sidebar",expressSidebarContent1:"You can decide whether to show the sidebar by enabling or disabling the sidebar Collapse button.",expressGridTitle:"Managing grids",expressGridContent:"Click on a grid and managing buttons will show on the top bar. You can remove a grid or split it in a preferred way.",expressPlaceholderTitle:"Add or manage widget",expressPlaceholderContent:"<p>Click the Add button on Placeholder to add a widget and configure it on the right side. <br> To remove the widget, click on the widget and a delete button will show on the top bar.</p>",expressThemeTitle:"Theme & General settings",expressThemeContent:"Select a preferred theme from Theme tab. Configure app general settings from General tab.",expressWindowTitle:"Page or Window switch",expressWindowContent:"<p><b>Click the outline menu</b> to switch between page and window.</p>",expressWindowTitle1:"Configure window",expressWindowContent1:"Configure Window behaviors on the right side. Double click text to edit. For other widgets, click to activate configuration on the right side.",expressWindowTitle2:"Configure window",expressWindowContent2:"<p><b>Click Window option</b> to switch Window settings. Hover on the Window option and click the Set as splash icon beside it to set a splash window. You can choose window design from templates.</p>",expressTopBarTitle:"Top bar options",expressTopBarContent:"<ul><li>Review different screen sizes </li><li>Undo or Redo operations </li><li>Save, publish and preview the experience.</li><li>More</li></ul>",expressFullEditModeTitle:"Full mode",expressFullEditModeContent:"You can switch to full mode which allows advanced experience design.",expressEndGuideTitle:"Congratulations! You have completed the tour!",expressEndGuideContent:"Now start to build your experience. You can always return to the guide by clicking the Help button on the bottom left corner of the builder if you need a refresher.",goToExpressMode:"Go to express mode",goToFullMode:"Go to full mode",switchedToExpressMode:"Switched to express mode",switchedToFullMode:"Switched to full mode"}},8249:(e,t,i)=>{"use strict";i.d(t,{getSizeModeOfALayout:()=>l,getUniqueId:()=>a,getUniqueLabel:()=>s,isFirstLevelPage:()=>d,isPageHasSubPage:()=>u,parseUniqueLabel:()=>r});var o=i(9244);i(1496);function n(e,t){return Object.values(null!=t?t:{}).forEach((t=>{e=function(e,t){var i;const a=e.layouts[t];return a?(delete a.parent,Object.keys(null!==(i=a.content)&&void 0!==i?i:{}).forEach((t=>{const i=a.content[t];switch(i.type){case o.LayoutItemType.Widget:{const t=e.widgets[i.widgetId];t&&(delete t.parent,t.layouts&&Object.values(t.layouts).forEach((t=>{e=n(e,t)})));break}case o.LayoutItemType.Section:{const t=e.sections[i.sectionId];delete t.parent,t.views.forEach((t=>{const i=e.views[t];delete i.parent,e=n(e,i.layout)}));break}case o.LayoutItemType.ScreenGroup:{const t=e.screenGroups[i.screenGroupId];delete t.parent,t.screens.forEach((t=>{var i;const o=e.screens[t];delete o.parent,e=n(e,o.main.layout),(null===(i=o.panel)||void 0===i?void 0:i.layout)&&(e=n(e,o.panel.layout))}));break}}})),e):e}(e,t)})),e}const{getUniqueId:a,getUniqueLabel:s,parseUniqueLabel:r,getSizeModeOfALayout:l}=o.appConfigUtils;function d(e,t){return!!e.pageStructure.find((e=>!!e[t]))}function u(e,t){const i=e.pageStructure.find((e=>!!e[t]));return i&&i[t].length>0}window._getCleanAppConfig=function(e){let t=e.asMutable({deep:!0});var i;return Object.keys(t.widgets).forEach((e=>{var i,o,n;const a=t.widgets[e];a.label===(null===(i=a.manifest)||void 0===i?void 0:i.name)&&delete a.label,a.icon===a.context.folderUrl+"icon.svg"&&delete a.icon,"object"==typeof a.icon&&(a.icon.svg!==a.context.folderUrl+"icon.svg"||"#fff"!==(null===(o=a.icon.properties)||void 0===o?void 0:o.color)&&(null===(n=a.icon.properties)||void 0===n?void 0:n.color)||delete a.icon),delete a.context,delete a.manifest,delete a._originManifest})),t.layouts=(i=t.layouts,Object.keys(i).forEach((e=>{const t=i[e];delete t.id,t.content&&Object.keys(t.content).forEach((e=>{delete t.content[e].id}))})),i),t=o.appConfigUtils.cleanPortalInfoFromResource(t),t=function(e){var t,i,o,a;return Object.values(null!==(t=e.pages)&&void 0!==t?t:{}).forEach((t=>{e=n(e,t.layout)})),Object.values(null!==(i=e.dialogs)&&void 0!==i?i:{}).forEach((t=>{e=n(e,t.layout)})),(null===(o=e.header)||void 0===o?void 0:o.layout)&&(e=n(e,e.header.layout)),(null===(a=e.footer)||void 0===a?void 0:a.layout)&&(e=n(e,e.footer.layout)),e}(t),t}},7659:(e,t,i)=>{"use strict";i(9244)},9244:e=>{"use strict";e.exports=i},8972:e=>{"use strict";e.exports=s},4108:e=>{"use strict";e.exports=l},6884:e=>{"use strict";e.exports=u},1496:e=>{"use strict";e.exports=n},1888:e=>{"use strict";e.exports=r},4321:e=>{"use strict";e.exports=a},8151:e=>{"use strict";e.exports=o},6117:e=>{"use strict";e.exports=d},6546:e=>{"use strict";e.exports=JSON.parse('{"online":{"home":"#","get-started":{"prefix":"get-started/","what-is-arcgis-experience-builder":"what-is-arcgis-experience-builder.htm","whats-new":"whats-new.htm"},"build-apps":{"prefix":"build-apps/","add-a-page":"add-a-page.htm","add-a-dialog":"add-windows.htm","add-utility-services":"add-utility-services.htm","add-custom-widgets":"getting-started-widget.htm","add-screen-groups":"add-screen-groups.htm","express-mode":"express-mode.htm","select-data":"select-data.htm","change-app-theme":"change-app-theme.htm","general-settings":"general-settings.htm"},"widgets":{"prefix":"configure-widgets/","overview":"widgets-overview.htm","3d-toolbox":"3d-toolbox-widget.htm","accordion":"accordion-widget.htm","add-data":"add-data-widget.htm","analysis":"analysis-widget.htm","arcgis-map":"map-widget.htm","basemap-gallery":"basemap-gallery-widget.htm","ba-infographic":"business-analyst-infographic-widget.htm","bookmark":"bookmark-widget.htm","branch-version-management":"branch-version-management-widget.htm","button":"button-widget.htm","building-explorer":"building-explorer-widget.htm","card":"card-widget.htm","chart":"chart-widget.htm","column":"column-widget.htm","controller":"widget-controller-widget.htm","coordinates":"coordinates-widget.htm","coordinate-conversion":"coordinate-conversion-widget.htm","divider":"divider-widget.htm","draw":"draw-widget.htm","directions":"directions-widget.htm","edit":"edit-widget.htm","elevation-profile":"elevation-profile-widget.htm","embed":"embed-widget.htm","feature-info":"feature-info-widget.htm","feature-report":"feature-report-widget.htm","filter":"filter-widget.htm","fixed":"fixed-panel-widget.htm","floor-filter":"floor-filter-widget.htm","flowrow":"flow-row-widget.htm","fly-controller":"fly-controller-widget.htm","grid":"grid-widget.htm","image":"image-widget.htm","legend":"legend-widget.htm","list":"list-widget.htm","map-layers":"map-layers-widget.htm","measurement":"measurement-widget.htm","menu":"menu-widget.htm","navigator":"view-navigation-widget.htm","near-me":"near-me-widget.htm","classic-oriented-imagery":"classic-oriented-imagery-widget.htm","oriented-imagery-viewer":"oriented-imagery-viewer-widget.htm","placeholder":"placeholder-widget.htm","print":"print-widget.htm","processing-templates":"processing-templates-widget.htm","query":"query-widget.htm","row":"row-widget.htm","search":"search-widget.htm","section":"section-widget.htm","select":"select-widget.htm","share":"share-widget.htm","sidebar":"sidebar-widget.htm","suitability-modeler":"suitability-modeler-widget.htm","survey123":"survey-widget.htm","swipe":"swipe-widget.htm","table":"table-widget.htm","text":"text-widget.htm","timeline":"timeline-widget.htm","my-location":"my-location-widget.htm","utility-network-trace":"utility-network-trace-widget.htm"}},"portal":{"home":"120001864","get-started":{"what-is-arcgis-experience-builder":"120001877","whats-new":"120002535"},"build-apps":{"add-a-page":"120001863","add-a-dialog":"120002539","add-utility-services":"120003733","add-custom-widgets":"120003728","add-screen-groups":"120002592","express-mode":"120005009","select-data":"120002590","change-app-theme":"120004139","general-settings":"120004779"},"widgets":{"overview":"#","3d-toolbox":"120003734","accordion":"120004999","add-data":"120004128","analysis":"120004647","arcgis-map":"120001851","basemap-gallery":"120004168","bookmark":"120002536","button":"120001841","building-explorer":"120004868","branch-version-management":"120002654","ba-infographic":"120003631","card":"120002537","chart":"120002727","column":"120001842","controller":"120001862","coordinates":"120003879","coordinate-conversion":"120002728","divider":"120002538","draw":"120003632","directions":"120003635","edit":"120002844","elevation-profile":"120002905","embed":"120001843","feature-info":"120001844","feature-report":"120004895","filter":"120001845","fixed":"120001846","floor-filter":"120003634","flowrow":"120005055","fly-controller":"120001847","grid":"120003880","image":"120001848","legend":"120001849","list":"120001850","map-layers":"120001852","measurement":"120004869","menu":"120001853","navigator":"120001861","near-me":"120004170","classic-oriented-imagery":"120002843","oriented-imagery-viewer":"120005053","placeholder":"120001854","print":"120003716","processing-templates":"120005054","query":"120002729","row":"120001855","search":"120002845","section":"120001856","select":"120004732","share":"120001857","sidebar":"120001858","suitability-modeler":"120002906","survey123":"120001859","swipe":"120004169","table":"120002591","text":"120001860","timeline":"120003717","my-location":"120004870","utility-network-trace":"120003633","add-line-event":"120004827","add-point-event":"120004828","dynamic-segmentation":"120004989","identify":"120004829","merge-events":"120004830","search-by-route":"120004831","split-event":"120004832"}},"dev":{"home":"#","get-started":{"prefix":"guide/","what-is-arcgis-experience-builder":"getting-started-widget","whats-new":"whats-new"},"build-apps":{"prefix":"guide/","add-a-page":"add-a-page","add-a-dialog":"add-windows","add-utility-services":"add-utility-services","add-custom-widgets":"getting-started-widget","add-screen-groups":"add-screen-groups","express-mode":"express-mode","select-data":"select-data","change-app-theme":"change-app-theme","general-settings":"general-settings"},"widgets":{"prefix":"guide/","overview":"widgets-overview","3d-toolbox":"3d-toolbox-widget","accordion":"accordion-widget","add-data":"add-data-widget","analysis":"analysis-widget","arcgis-map":"map-widget","basemap-gallery":"basemap-gallery-widget","ba-infographic":"business-analyst-infographic-widget","bookmark":"bookmark-widget","branch-version-management":"branch-version-management-widget","button":"button-widget","building-explorer":"building-explorer-widget","card":"card-widget","chart":"chart-widget","column":"column-widget","controller":"widget-controller-widget","coordinates":"coordinates-widget","coordinate-conversion":"coordinate-conversion-widget","divider":"divider-widget","draw":"draw-widget","directions":"directions-widget","edit":"edit-widget","elevation-profile":"elevation-profile-widget","embed":"embed-widget","feature-info":"feature-info-widget","feature-report":"feature-report-widget","filter":"filter-widget","fixed":"fixed-panel-widget","floor-filter":"floor-filter-widget","flowrow":"flow-row-widget","fly-controller":"fly-controller-widget","grid":"grid-widget","image":"image-widget","legend":"legend-widget","list":"list-widget","map-layers":"map-layers-widget","measurement":"measurement-widget","menu":"menu-widget","navigator":"view-navigation-widget","near-me":"near-me-widget","classic-oriented-imagery":"classic-oriented-imagery-widget","oriented-imagery-viewer":"oriented-imagery-viewer-widget","placeholder":"placeholder-widget","print":"print-widget","processing-templates":"processing-templates-widget","query":"query-widget","row":"row-widget","search":"search-widget","section":"section-widget","select":"select-widget","share":"share-widget","sidebar":"sidebar-widget","suitability-modeler":"suitability-modeler-widget","survey123":"survey-widget","swipe":"swipe-widget","table":"table-widget","text":"text-widget","timeline":"timeline-widget","my-location":"my-location-widget","utility-network-trace":"utility-network-trace-widget","add-line-event":"add-line-event-widget","add-point-event":"add-point-event-widget","dynamic-segmentation":"dynamic-segmentation-widget","identify":"identify-widget","merge-events":"merge-events-widget","search-by-route":"search-by-route-widget","split-event":"split-event-widget"}}}')},5132:e=>{"use strict";e.exports=JSON.parse('{"steps":[{"steps":[{"title":"${DSSelectionStep4Title}","content":"${DSSelectionStep4Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\']) .component-data-source-selector .jimu-btn","requiredAction":{"type":"click"},"disableNextButton":true},{"title":"${DSSelectionStep1Title}","content":"${DSSelectionStep1Content}","placement":"left","target":"[data-widgetid=\'dynamic-setting\'] .widget-setting-tab:not([data-is-parent=\'true\']) .component-data-source-selector .jimu-btn","requiredAction":{"type":"click"},"disableNextButton":true}]},{"title":"${DSSelectionStep2Title}","content":{"image":{"src":"jimu-for-builder/guide-assets/add-data.gif","alt":"${DSSelectionStep2Title}","width":400,"height":220},"text":"${DSSelectionStep2Content}"},"placement":"left-end","target":".component-data-source-list .ds-add-data","requiredAction":{"type":"click"},"disableNextButton":true},{"steps":[{"title":"${DSSelectionStep5Title}","content":"${DSSelectionStep5Content}","placement":"left","target":".component-data-source-list .ds-list","spotlightClicks":true},{"title":"${DSSelectionStep3Title}","content":"${DSSelectionStep3Content}","placement":"left","target":".component-data-source-list .ds-list","spotlightClicks":true}]}]}')}},t={};function c(i){var o=t[i];if(void 0!==o)return o.exports;var n=t[i]={exports:{}};return e[i](n,n.exports,c),n.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var i in t)c.o(t,i)&&!c.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var p={};return(()=>{"use strict";c.r(p),c.d(p,{DataSourceSelectionGuide:()=>e._b,InsertWidgetGuide:()=>e.OE,InsertWidgetGuideComponent:()=>e.F$});var e=c(2883)})(),p})())}}}));
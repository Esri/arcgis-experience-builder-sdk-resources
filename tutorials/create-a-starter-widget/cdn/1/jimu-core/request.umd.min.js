/*! For license information please see request.umd.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports):"function"==typeof define&&define.amd?define(["exports"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).arcgisRest=e.arcgisRest||{})}(this,(function(e){"use strict";var t=function(e,r){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])})(e,r)},r=function(){return(r=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function n(e){return Object.keys(e).some((function(t){if(!(t=e[t]))return!1;switch(t&&t.toParam&&(t=t.toParam()),t.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}}))}function o(e){var t={};return Object.keys(e).forEach((function(r){var n=e[r];if(n&&n.toParam&&(n=n.toParam()),n||0===n||"boolean"==typeof n||"string"==typeof n){switch(n.constructor.name){case"Array":var o=null===(o=null===(o=n[0])||void 0===o?void 0:o.constructor)||void 0===o?void 0:o.name,a="Array"===o?n:"Object"===o?JSON.stringify(n):n.join(",");break;case"Object":a=JSON.stringify(n);break;case"Date":a=n.valueOf();break;case"Function":a=null;break;case"Boolean":a=n+"";break;default:a=n}(a||0===a||"string"==typeof a||Array.isArray(a))&&(t[r]=a)}})),t}function a(e,t){return Array.isArray(t)&&t[0]&&Array.isArray(t[0])?t.map((function(t){return a(e,t)})).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t)}function s(e){var t=o(e);return Object.keys(t).map((function(e){return a(e,t[e])})).join("&")}function i(e,t){t=n(e)||t;var r=o(e);if(t){var a=new FormData;return Object.keys(r).forEach((function(e){var t;"undefined"!=typeof Blob&&r[e]instanceof Blob?(t=r.fileName||r[e].name||e,a.append(e,r[e],t)):r[e].constructor&&"ReadStream"===r[e].constructor.name&&Number.isInteger(r.dataSize)?a.append(e,r[e],{knownLength:r.dataSize}):a.append(e,r[e])})),a}return s(e)}var c=function(e,t,r,n,o){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=r,this.url=n,this.options=o};function u(e){console&&console.warn&&console.warn.apply(console,[e])}c.prototype=Object.create(Error.prototype),c.prototype.constructor=c;var f,d,h,p,l="@esri/arcgis-rest-js",m={httpMethod:"POST",params:{f:"json"}},y=(t(d=O,h=f=c),d.prototype=null===h?Object.create(h):(g.prototype=h.prototype,new g),O.prototype.retry=function(e,t){var n=this;void 0===t&&(t=3);var o=0,a=function(s,i){e(n.url,n.options).then((function(e){return e=r(r({},n.options),{authentication:e}),o+=1,E(n.url,e)})).then((function(e){s(e)})).catch((function(e){"ArcGISAuthError"===e.name&&o<t?a(s,i):"ArcGISAuthError"===e.name&&t<=o?i(n):i(e)}))};return new Promise((function(e,t){a(e,t)}))},O);function g(){this.constructor=d}function O(e,t,r,n,o){return void 0===e&&(e="AUTHENTICATION_ERROR"),void 0===t&&(t="AUTHENTICATION_ERROR_CODE"),(o=f.call(this,e,t,r,n,o)||this).name="ArcGISAuthError",o.message="AUTHENTICATION_ERROR_CODE"===t?e:t+": "+e,o}function v(e,t,r,n,o){if(400<=e.code){var a=e.message,s=e.code;throw new c(a,s,e,t,n)}if(e.error){a=(u=e.error).message,s=u.code;var i=u.messageCode,u=i||s||"UNKNOWN_ERROR_CODE";if(498===s||499===s||"GWM_0003"===i||400===s&&"Unable to generate token."===a)throw o||new y(a,u,e,t,n);throw new c(a,u,e,t,n)}if("failed"!==e.status&&"failure"!==e.status)return e;a=void 0,s="UNKNOWN_ERROR_CODE";try{a=JSON.parse(e.statusMessage).message,s=JSON.parse(e.statusMessage).code}catch(t){a=e.statusMessage||e.message}throw new c(a,s,e,t,n)}function E(e,t){void 0===t&&(t={params:{f:"json"}});var o=r(r(r({httpMethod:"POST"},m),t),{params:r(r({},m.params),t.params),headers:r(r({},m.headers),t.headers)}),a=[];if(t=[],o.fetch||"undefined"==typeof fetch?(a.push("`fetch`"),t.push("`node-fetch`")):o.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(a.push("`Promise`"),t.push("`es6-promise`")),"undefined"==typeof FormData&&(a.push("`FormData`"),t.push("`isomorphic-form-data`")),!o.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+a.join(", ")+". We recommend installing the "+t.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");t=o.httpMethod;var u=o.authentication,f=o.rawResponse,d=r({f:"json"},o.params),h=null,p={method:t,credentials:o.credentials||"same-origin"};return o.headers&&o.headers["X-Esri-Auth-Client-Id"]&&-1<e.indexOf("/oauth2/platformSelf")&&(p.credentials="include"),(u?u.getToken(e,{fetch:o.fetch}).catch((function(t){return t.url=e,t.options=o,h=t,Promise.resolve("")})):Promise.resolve("")).then((function(t){t.length&&(d.token=t),u&&u.getDomainCredentials&&(p.credentials=u.getDomainCredentials(e));var a={};"GET"===p.method&&(d.token&&o.hideToken&&"undefined"==typeof window&&(a["X-Esri-Authorization"]="Bearer "+d.token,delete d.token),c=""===s(d)?e:e+"?"+s(d),o.maxUrlLength&&c.length>o.maxUrlLength||d.token&&o.hideToken?(p.method="POST",t.length&&o.hideToken&&(d.token=t,delete a["X-Esri-Authorization"])):e=c);var c=new RegExp("/items/.+/updateResources").test(e);return"POST"===p.method&&(p.body=i(d,c)),p.headers=r(r({},a),o.headers),"undefined"!=typeof window||p.headers.referer||(p.headers.referer=l),n(d)||c||(p.headers["Content-Type"]="application/x-www-form-urlencoded"),o.fetch(e,p)})).then((function(t){if(!t.ok){var r=t.status,n=t.statusText;throw new c(n,"HTTP "+r,t,e,o)}if(f)return t;switch(d.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}})).then((function(t){if("json"!==d.f&&"geojson"!==d.f||f)return t;var r=v(t,e,0,o,h);return h&&(t=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0],o.authentication.federatedServers[t]={token:[],expires:new Date(Date.now()+864e5)},h=null),r}))}function R(e){e=(t=e.split("="))[0];var t=t[1];return{key:decodeURIComponent(e),value:decodeURIComponent(t)}}(p=e.ErrorTypes||(e.ErrorTypes={})).ArcGISRequestError="ArcGISRequestError",p.ArcGISAuthError="ArcGISAuthError",e.ArcGISAuthError=y,e.ArcGISRequestError=c,e.NODEJS_DEFAULT_REFERER_HEADER=l,e.appendCustomParams=function(e,t,n){var o=r(r({params:{}},n),e);return o.params=t.reduce((function(t,r){return!e[r]&&"boolean"!=typeof e[r]||(t[r]=e[r]),t}),o.params),["params","httpMethod","rawResponse","authentication","portal","fetch","maxUrlLength","headers"].reduce((function(e,t){return o[t]&&(e[t]=o[t]),e}),{})},e.checkForErrors=v,e.cleanUrl=function(e){return"string"!=typeof e||"/"===(e=e.trim())[e.length-1]&&(e=e.slice(0,-1)),e},e.decodeParam=R,e.decodeQueryString=function(e){return e.replace(/^#/,"").split("&").reduce((function(e,t){t=(r=R(t)).key;var r=r.value;return e[t]=r,e}),{})},e.encodeFormData=i,e.encodeParam=a,e.encodeQueryString=s,e.processParams=o,e.request=E,e.requiresFormData=n,e.setDefaultRequestOptions=function(e,t){e.authentication&&!t&&u("You should not set `authentication` as a default in a shared environment such as a web server which will process multiple users requests. You can call `setDefaultRequestOptions` with `true` as a second argument to disable this warning."),m=e},e.warn=u,Object.defineProperty(e,"__esModule",{value:!0})}));
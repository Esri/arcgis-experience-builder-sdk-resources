System.register(["jimu-core","jimu-for-builder/templates"],(function(e,t){var n={},i={};return{setters:[function(e){n.Immutable=e.Immutable,n.SessionManager=e.SessionManager,n.USER_SETTING_FILE_KEY=e.USER_SETTING_FILE_KEY,n.appActions=e.appActions,n.appConfigUtils=e.appConfigUtils,n.esri=e.esri,n.getAppStore=e.getAppStore,n.i18n=e.i18n,n.moduleLoader=e.moduleLoader,n.portalUrlUtils=e.portalUrlUtils,n.semver=e.semver,n.sharedThemeUtils=e.sharedThemeUtils,n.urlUtils=e.urlUtils,n.utils=e.utils,n.version=e.version},function(e){i.TemplateType=e.TemplateType,i.getTemplateConfig=e.getTemplateConfig}],execute:function(){e((()=>{"use strict";var e={891:e=>{e.exports=n},262:e=>{e.exports=i}},t={};function o(n){var i=t[n];if(void 0!==i)return i.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,o),r.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};return(()=>{o.r(r),o.d(r,{AppType:()=>h,PublishStatus:()=>p,SearchType:()=>v,appServices:()=>t,createAppCallBack:()=>ke,getResourceOrigin:()=>$e,initAppConfigOfNewApp:()=>qe,toCreateAppByDefaultTemplate:()=>ye,userServices:()=>n});var e={};o.r(e),o.d(e,{addItemResource:()=>Q,checkItemVersion:()=>D,createItem:()=>R,getItem:()=>N,getItemData:()=>L,getItemResource:()=>q,getItemResources:()=>G,getOriginUrl:()=>I,getRequestMethod:()=>E,getUserContentUrl:()=>x,getUserName:()=>k,importItem:()=>C,removeItem:()=>W,removeItemResource:()=>K,request:()=>U,searchItems:()=>P,searchItemsByPortalUrl:()=>w,updateItem:()=>V,updateItemResource:()=>H});var t={};o.r(t),o.d(t,{addToFavorites:()=>bt,changeAppFolder:()=>wt,checkImportAppVersion:()=>nt,createAppByDefaultTemplate:()=>Ze,createAppByItemTemplate:()=>ze,createAppByTemplateId:()=>Ye,createTemplateByApp:()=>et,deleteApp:()=>mt,duplicateApp:()=>ot,getAppConfig:()=>st,getAppGroups:()=>jt,getAppInfo:()=>ct,getDefaultTemplateConfig:()=>Ut,getFolders:()=>St,getGroupCategorySchema:()=>dt,getGroupContent:()=>ft,getOrgCategorySchema:()=>lt,getUserTags:()=>Ot,importAppFromPortal:()=>it,importItem:()=>tt,publishApp:()=>yt,removeFromFavorites:()=>Pt,saveApp:()=>gt,saveAsApp:()=>rt,searchApp:()=>ut,searchAppByPortalUrl:()=>at,searchGroups:()=>At,updateAppInfo:()=>vt,updateAppInfoWhenSaveApp:()=>ht,updateAppThumbnail:()=>pt});var n={};o.r(n),o.d(n,{addUserResource:()=>$t,getUserResource:()=>Rt,getUserResources:()=>Ct,initUserResource:()=>Lt,removeUserResource:()=>Dt,updateUserResource:()=>_t});var i=o(891),s=function(e,t){return s=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])},s(e,t)},u=function(){return u=Object.assign||function(e){for(var t,n=1,i=arguments.length;n<i;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},u.apply(this,arguments)};function a(e){return Object.keys(e).some((function(t){var n=e[t];if(!n)return!1;switch(n&&n.toParam&&(n=n.toParam()),n.constructor.name){case"Array":case"Object":case"Date":case"Function":case"Boolean":case"String":case"Number":return!1;default:return!0}}))}function c(e){var t={};return Object.keys(e).forEach((function(n){var i,o,r=e[n];if(r&&r.toParam&&(r=r.toParam()),r||0===r||"boolean"==typeof r||"string"==typeof r){var s;switch(r.constructor.name){case"Array":var u=null===(o=null===(i=r[0])||void 0===i?void 0:i.constructor)||void 0===o?void 0:o.name;s="Array"===u?r:"Object"===u?JSON.stringify(r):r.join(",");break;case"Object":s=JSON.stringify(r);break;case"Date":s=r.valueOf();break;case"Function":s=null;break;case"Boolean":s=r+"";break;default:s=r}(s||0===s||"string"==typeof s||Array.isArray(s))&&(t[n]=s)}})),t}function d(e,t){return Array.isArray(t)&&t[0]&&Array.isArray(t[0])?t.map((function(t){return d(e,t)})).join("&"):encodeURIComponent(e)+"="+encodeURIComponent(t)}function l(e){var t=c(e);return Object.keys(t).map((function(e){return d(e,t[e])})).join("&")}var f=function(e,t,n,i,o){e=e||"UNKNOWN_ERROR",t=t||"UNKNOWN_ERROR_CODE",this.name="ArcGISRequestError",this.message="UNKNOWN_ERROR_CODE"===t?e:t+": "+e,this.originalMessage=e,this.code=t,this.response=n,this.url=i,this.options=o};f.prototype=Object.create(Error.prototype),f.prototype.constructor=f;var v,h,p,m="@esri/arcgis-rest-js",g={httpMethod:"POST",params:{f:"json"}},y=function(e){function t(t,n,i,o,r){void 0===t&&(t="AUTHENTICATION_ERROR"),void 0===n&&(n="AUTHENTICATION_ERROR_CODE");var s=e.call(this,t,n,i,o,r)||this;return s.name="ArcGISAuthError",s.message="AUTHENTICATION_ERROR_CODE"===n?t:n+": "+t,s}return function(e,t){function n(){this.constructor=e}s(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),t.prototype.retry=function(e,t){var n=this;void 0===t&&(t=3);var i=0,o=function(r,s){e(n.url,n.options).then((function(e){var t=u(u({},n.options),{authentication:e});return i+=1,S(n.url,t)})).then((function(e){r(e)})).catch((function(e){"ArcGISAuthError"===e.name&&i<t?o(r,s):"ArcGISAuthError"===e.name&&i>=t?s(n):s(e)}))};return new Promise((function(e,t){o(e,t)}))},t}(f);function S(e,t){void 0===t&&(t={params:{f:"json"}});var n=u(u(u({httpMethod:"POST"},g),t),{params:u(u({},g.params),t.params),headers:u(u({},g.headers),t.headers)}),i=[],o=[];if(n.fetch||"undefined"==typeof fetch?(i.push("`fetch`"),o.push("`node-fetch`")):n.fetch=fetch.bind(Function("return this")()),"undefined"==typeof Promise&&(i.push("`Promise`"),o.push("`es6-promise`")),"undefined"==typeof FormData&&(i.push("`FormData`"),o.push("`isomorphic-form-data`")),!n.fetch||"undefined"==typeof Promise||"undefined"==typeof FormData)throw new Error("`arcgis-rest-request` requires a `fetch` implementation and global variables for `Promise` and `FormData` to be present in the global scope. You are missing "+i.join(", ")+". We recommend installing the "+o.join(", ")+" modules at the root of your application to add these to the global scope. See https://bit.ly/2KNwWaJ for more info.");var r=n.httpMethod,s=n.authentication,d=n.rawResponse,v=u({f:"json"},n.params),h=null,p={method:r,credentials:n.credentials||"same-origin"};return n.headers&&n.headers["X-Esri-Auth-Client-Id"]&&e.indexOf("/oauth2/platformSelf")>-1&&(p.credentials="include"),(s?s.getToken(e,{fetch:n.fetch}).catch((function(t){return t.url=e,t.options=n,h=t,Promise.resolve("")})):Promise.resolve("")).then((function(t){t.length&&(v.token=t),s&&s.getDomainCredentials&&(p.credentials=s.getDomainCredentials(e));var i={};if("GET"===p.method){v.token&&n.hideToken&&"undefined"==typeof window&&(i["X-Esri-Authorization"]="Bearer "+v.token,delete v.token);var o=""===l(v)?e:e+"?"+l(v);n.maxUrlLength&&o.length>n.maxUrlLength||v.token&&n.hideToken?(p.method="POST",t.length&&n.hideToken&&(v.token=t,delete i["X-Esri-Authorization"])):e=o}var r=new RegExp("/items/.+/updateResources").test(e);return"POST"===p.method&&(p.body=function(e,t){var n=a(e)||t,i=c(e);if(n){var o=new FormData;return Object.keys(i).forEach((function(e){if("undefined"!=typeof Blob&&i[e]instanceof Blob){var t=i.fileName||i[e].name||e;o.append(e,i[e],t)}else i[e].constructor&&"ReadStream"===i[e].constructor.name&&Number.isInteger(i.dataSize)?o.append(e,i[e],{knownLength:i.dataSize}):o.append(e,i[e])})),o}return l(e)}(v,r)),p.headers=u(u({},i),n.headers),"undefined"!=typeof window||p.headers.referer||(p.headers.referer=m),a(v)||r||(p.headers["Content-Type"]="application/x-www-form-urlencoded"),n.fetch(e,p)})).then((function(t){if(!t.ok){var i=t.status,o=t.statusText;throw new f(o,"HTTP "+i,t,e,n)}if(d)return t;switch(v.f){case"json":case"geojson":return t.json();case"html":case"text":return t.text();default:return t.blob()}})).then((function(t){if("json"!==v.f&&"geojson"!==v.f||d)return t;var i=function(e,t,n,i,o){if(e.code>=400){var r=e.message,s=e.code;throw new f(r,s,e,t,i)}if(e.error){var u=e.error,a=(r=u.message,s=u.code,u.messageCode),c=a||s||"UNKNOWN_ERROR_CODE";if(498===s||499===s||"GWM_0003"===a||400===s&&"Unable to generate token."===r)throw o||new y(r,c,e,t,i);throw new f(r,c,e,t,i)}if("failed"===e.status||"failure"===e.status){r=void 0,s="UNKNOWN_ERROR_CODE";try{r=JSON.parse(e.statusMessage).message,s=JSON.parse(e.statusMessage).code}catch(t){r=e.statusMessage||e.message}throw new f(r,s,e,t,i)}return e}(t,e,0,n,h);if(h){var o=e.toLowerCase().split(/\/rest(\/admin)?\/services\//)[0];n.authentication.federatedServers[o]={token:[],expires:new Date(Date.now()+864e5)},h=null}return i}))}!function(e){e.AGOL="AGOL",e.Portal="Portal",e.Other="Other"}(v||(v={})),function(e){e.TemplateType="Web Experience Template",e.ExperienceType="Web Experience"}(h||(h={})),function(e){e.Published="Published",e.Draft="Draft",e.Changed="Changed"}(p||(p={}));var b=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};function P(e,t=v.Other){return b(this,void 0,void 0,(function*(){return yield j(e,"item",t)}))}function j(e,t,n=v.Other){return b(this,void 0,void 0,(function*(){let o,r;return o=`${n===v.AGOL?"https://www.arcgis.com":window.location.origin}/sharing/rest/search`,r="string"==typeof e||e instanceof i.esri.restPortal.SearchQueryBuilder?{params:{q:e}}:i.esri.restRequest.appendCustomParams(Object.assign(Object.assign({},e),{f:"json"}),["q","num","start","sortField","sortOrder","portalUrl","f"]),U(o,r,"GET").then((n=>(n.nextStart&&-1!==n.nextStart&&(n.nextPage=function(){return b(this,void 0,void 0,(function*(){let o;return"string"==typeof e||e instanceof i.esri.restPortal.SearchQueryBuilder?o={q:e,start:n.nextStart}:(o=e,o.start=n.nextStart),yield j(o,t)}))}),n)))}))}function w(e,t){return b(this,void 0,void 0,(function*(){return yield O(e,t)}))}function O(e,t){return b(this,void 0,void 0,(function*(){let n,o;n||Promise.resolve(null),n=`${t}/sharing/rest/search`,o="string"==typeof e||e instanceof i.esri.restPortal.SearchQueryBuilder?{params:{q:e}}:i.esri.restRequest.appendCustomParams(Object.assign(Object.assign({},e),{f:"json"}),["q","num","start","sortField","sortOrder","portalUrl","f"]);const r=null==o?void 0:o.authentication,s={params:null==o?void 0:o.params,httpMethod:"GET"};return r&&(s.authentication=r),S(n,s).then((t=>(t.nextStart&&-1!==t.nextStart&&(t.nextPage=function(){return b(this,void 0,void 0,(function*(){let n;return"string"==typeof e||e instanceof i.esri.restPortal.SearchQueryBuilder?n={q:e,start:t.nextStart}:(n=e,n.start=t.nextStart),yield O(n,"item")}))}),t)))}))}var A=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};function U(e,t={params:{f:"json"}},n="POST"){return A(this,void 0,void 0,(function*(){if("GET"===n){const n=e+function(e){if(!e)return"";const t=Object.keys(e);return t.length?"?"+t.map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&"):""}(t.params);return yield fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>A(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>A(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}return"POST"===n?t.params&&"FormData"===t.params.constructor.name?yield fetch(e,{method:"POST",body:t.params}).then((e=>A(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>A(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t.params)}).then((e=>A(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>A(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield Promise.reject(null)}))}const T=i.esri.restRequest.request;function I(e=!1){return e?i.urlUtils.getArcgisOnlineUrl():window.location.origin}function x(e=!1){return e?"/sharing/rest/content/":"/sharing/rest/content/users/"}function k(){var e;return null===(e=(0,i.getAppStore)().getState().user)||void 0===e?void 0:e.username}function E(e=!1){return e?T:U}function M(e){const t=JSON.parse(JSON.stringify(e));return t.data&&("undefined"!=typeof Blob&&e.data instanceof Blob||"ReadStream"===e.data.constructor.name?t.file=e.data:t.text=e.data,delete t.data),t}var $=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};function R(e){return $(this,void 0,void 0,(function*(){const t=Object.assign({folderId:null},e);return yield function(e){var t,n;return $(this,void 0,void 0,(function*(){if(e.file&&!e.multipart)return yield Promise.reject(new Error("The request must be a multipart request for file uploading."));if(e.multipart&&!e.filename)return yield Promise.reject(new Error("The file name is required for a multipart request."));const o=k(),r=`${I()}${x()}addItem`;e.params=Object.assign(Object.assign(Object.assign({},e.params),M(e.item)),{portalUrl:null===(n=null===(t=(0,i.getAppStore)())||void 0===t?void 0:t.getState())||void 0===n?void 0:n.portalUrl});const s=i.esri.restRequest.appendCustomParams(e,["owner","folderId","file","dataUrl","text","async","multipart","filename","overwrite"],{params:Object.assign({},e.params)});return s.params.username=o,yield U(r,s)}))}(t)}))}function C(e,t){return $(this,void 0,void 0,(function*(){const n=`${I()}${x()}importItem`;if(!(null==e?void 0:e.appZip))return Promise.reject("No app files");t.params=Object.assign(Object.assign({},t.params),e);const i=Object.keys(t.params),o=new FormData;for(let e=0;e<i.length;e++)o.append(i[e],t.params[i[e]]);return t.params=o,yield U(n,t)}))}function D(e,t){return $(this,void 0,void 0,(function*(){const n=`${I()}${x()}checkItemVersion`;if(!(null==e?void 0:e.appZip))return Promise.reject("No app files");t.params=Object.assign(Object.assign({},t.params),e);const i=Object.keys(t.params),o=new FormData;for(let e=0;e<i.length;e++)o.append(i[e],t.params[i[e]]);return t.params=o,yield U(n,t)}))}var _=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};function L(e,t,n=!1){return _(this,void 0,void 0,(function*(){const i=`${I(n)}${x(n)}items/${e}/data`,o=Object.assign({params:{}},t);o.file&&(o.params.f=null),n&&!F()&&delete o.authentication;const r=E(n);return yield r(i,o).catch((e=>{if(!/Unexpected end of (JSON input|data at line 1 column 1)/i.test(e.message))throw e}))}))}function N(e,t,n=!1){return _(this,void 0,void 0,(function*(){const i=`${I(n)}${x(n)}items/${e}`,o=Object.assign({},t);n&&!F()&&delete o.authentication;const r=E(n);return yield r(i,o)}))}function G(e,t,n=!1){return _(this,void 0,void 0,(function*(){const i=`${I(n)}${x(n)}items/${e}/resources`;t.params=Object.assign(Object.assign({},t.params),{num:1e3}),n&&!F()&&delete t.authentication;const o=E(n);return yield o(i,t,"GET")}))}function q(e,t,n=!1){return _(this,void 0,void 0,(function*(){const i=t.fileName,o=`${I(n)}${x(n)}items/${e}/resources/${i}`;n&&!F()&&delete t.authentication;const r=E(n);return yield r(o,t,"GET")}))}function F(){const e=(0,i.getAppStore)().getState().portalUrl;return i.portalUrlUtils.isAGOLDomain(e)}var B=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};function W(e){return B(this,void 0,void 0,(function*(){const t=k(),n=I();e.userName=t;const i=`${n}${x()}items/${e.id}/delete`;return yield U(i,e)}))}function K(e){return B(this,void 0,void 0,(function*(){const t=`${I()}${x()}items/${e.id}/removeResources`;return e.params=Object.assign(Object.assign({},e.params),{resource:e.resource}),yield U(t,e)}))}var J=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};function V(e){return J(this,void 0,void 0,(function*(){const t=k(),n=I();e.userName=t;const i=`${n}${x()}items/${e.item.id}/update`;if(e.params=Object.assign(Object.assign({},e.params),M(e.item)),e.item.thumbnail&&"string"!=typeof e.item.thumbnail){e.params=Object.assign(Object.assign({},e.params),e.item);const t=Object.keys(e.params),n=new FormData;for(let i=0;i<t.length;i++)n.append(t[i],e.params[t[i]]);e.params=n}return yield U(i,e)}))}function H(e){return J(this,void 0,void 0,(function*(){const t=`${I()}${x()}items/${e.id}/updateResources`;e.params=Object.assign(Object.assign({fileName:e.name,text:e.content},e.params),{file:e.resource}),delete e.params.file,e.params.file=e.resource,void 0!==e.private&&(e.params.access=e.private?"private":"inherit");const n=Object.keys(e.params),i=new FormData;for(let t=0;t<n.length;t++)i.append(n[t],e.params[n[t]]);return e.params=i,yield U(t,e)}))}var X=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};function Q(e){return X(this,void 0,void 0,(function*(){const t=`${I()}${x()}items/${e.id}/addResources`;e.params=Object.assign(Object.assign({fileName:e.name,text:e.content,access:e.private?"private":"inherit"},e.params),{file:e.resource}),delete e.params.file,e.params.file=e.resource;const n=Object.keys(e.params),i=new FormData;for(let t=0;t<n.length;t++)i.append(n[t],e.params[n[t]]);return e.params=i,yield U(t,e)}))}var z=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};const Y=i.SessionManager.getInstance().isTrustedServer((0,i.getAppStore)().getState().portalUrl);function Z(e,t={f:"json"},n="POST"){return z(this,void 0,void 0,(function*(){if("GET"===n){const n=e+function(e){if(!e)return"";const t=Object.keys(e);return t.length?"?"+t.map((t=>encodeURIComponent(t)+"="+encodeURIComponent(e[t]))).join("&"):""}(t);return yield fetch(n,{credentials:Y?"include":"same-origin",method:"GET",headers:{"Content-Type":"application/json"}}).then((e=>z(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>z(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}return"POST"===n?t&&"FormData"===t.constructor.name?yield fetch(e,{credentials:Y?"include":"same-origin",method:"POST",body:t}).then((e=>z(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>z(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield fetch(e,{credentials:Y?"include":"same-origin",method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}).then((e=>z(this,void 0,void 0,(function*(){return yield e.json()})))).then((e=>z(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))):yield Promise.reject(null)}))}var ee=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};function te(e=!1){return e?i.urlUtils.getArcgisOnlineUrl():window.location.origin}var ne=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};var ie=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))},oe=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))},re=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))},se=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};function ue(){const e=(0,i.getAppStore)().getState().portalUrl;return i.portalUrlUtils.isAGOLDomain(e)}const ae={frameworkAction_TriggerLayer:"Trigger data",frameworkAction_SetData:"Select data",frameworkAction_ActionLayer:"Action data",frameworkAction_Conditions:"Conditions",frameworkAction_RelateMessage:"Trigger / action connection",frameworkAction_TriggerLayerField:"Select a trigger field",frameworkAction_None:"none",frameworkAction_Equals:"equals",frameworkAction_ActionLayerField:"Select an action field",frameworkAction_MoreConditions:"More conditions",frameworkAction_SetExpression:"Please set your expression first.",frameworkAction_ChooseLayer:"Select data",frameworkAction_AutoBind:"Auto bound.",frameworkAction_NoLayer:"No data.",frameworkAction_QueryByExtent:"Query by current extent",defaultTextPlaceholder:"Double click to edit text",titlePlaceholder:"Here is the title",subTitlePlaceholder:"Here is the subtitle",shortTitlePlaceholder:"Title",shortSubTitlePlaceholder:"Subtitle",copyrightPlaceholder:"Copyright info",cardTitle:"Card title",bookmark:"Bookmark",number:"Number",templateSearchResult:"Search result",logo:"Logo",appItemCopy:"Copy"};var ce=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};const de=i.esri.restRequest.request;function le(e){var t,n;if(!(null==e?void 0:e.portalUrl))return!window.jimuConfig.isDevEdition;const o=(null==e?void 0:e.portalUrl)||"",r=(null===(n=null===(t=(0,i.getAppStore)())||void 0===t?void 0:t.getState())||void 0===n?void 0:n.portalUrl)||"",s=(null==r?void 0:r.includes(o))||(null==o?void 0:o.includes(r));return(i.portalUrlUtils.isAGOLDomain(o)&&i.portalUrlUtils.isAGOLDomain(r)||s)&&!ve(e)}function fe(e){if(!(null==e?void 0:e.portalUrl))return!1;const t=(null==e?void 0:e.portalUrl)||"",n=i.portalUrlUtils.isAGOLDomain(t),o=!le(e),r=!ve(e);return o&&r&&n}function ve(e){return!!((null==e?void 0:e.portalUrl)||"").endsWith("localhost:")||e.isLocalApp}function he(e){if(ve(e))return{};const t=i.SessionManager.getInstance().getMainSession();return le(e)?t:{}}function pe(e){let t;const n=(0,i.getAppStore)().getState().portalUrl,o=i.SessionManager.getInstance().getMainSession(),r=i.portalUrlUtils.isAGOLDomain(n);switch(e){case v.Portal:t=o;break;case v.AGOL:t=r?o:{};break;case v.Other:t=window.jimuConfig.isDevEdition?{}:o}return t}function me(e,t=!1,n=""){return ce(this,void 0,void 0,(function*(){const o=i.SessionManager.getInstance().getMainSession();let r=null;const s=(null==n?void 0:n.includes("Template"))?h.TemplateType:h.ExperienceType;return yield ut({q:`type: "${s}" AND owner:${null==o?void 0:o.username} AND  title:"${e}"`,sortField:"modified",sortOrder:"desc"},v.Other).then((n=>ce(this,void 0,void 0,(function*(){const i=n.results;if(i&&i.length>0){const n=function(e,t){const n=[],i=/^[\d]+$/;return e.forEach((e=>{var o,r;const s=null===(r=null===(o=e.title)||void 0===o?void 0:o.split(`${t} `)[1])||void 0===r?void 0:r.split(" ")[0];i.test(s)&&n.push(Number(s))})),n.sort((function(e,t){return e<t?1:-1})),n[0]||1}(i,e);return r=xe(e,i,n,t),yield Promise.resolve(r)}return r=t?e:`${e} 1`,yield Promise.resolve(r)})))).catch((e=>ce(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}))}function ge(e,t,n=!1,o=!1){return ce(this,void 0,void 0,(function*(){return yield Se(e).then((r=>ce(this,void 0,void 0,(function*(){return r?n?yield function(e,t){return ce(this,void 0,void 0,(function*(){return yield function(e,t){return ce(this,void 0,void 0,(function*(){return yield st(t).then((n=>ce(this,void 0,void 0,(function*(){const o=Oe(n,t);o.template=null==t?void 0:t.id,delete o.appProxies,delete o.historyLabels,o.attributes.favicon&&delete o.attributes.favicon;const r=he({portalUrl:window.jimuConfig.isDevEdition?"localhost:":(0,i.getAppStore)().getState().portalUrl});if(null==n?void 0:n.__not_publish)return yield Promise.reject("This item is not published");const s=new Blob([JSON.stringify(o)],{type:"application/json"});return yield He({id:e,resource:s,name:"config.json",params:{resourcesPrefix:"config"},authentication:r}).then((()=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)}))),(e=>ce(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}))),(e=>ce(this,void 0,void 0,(function*(){return yield Promise.reject("Resource does not exist or is inaccessible")}))))}))}(e,t).then((n=>ce(this,void 0,void 0,(function*(){return yield be(e,t,!0).then((e=>ce(this,void 0,void 0,(function*(){return e?yield Promise.resolve(!0):yield Promise.reject("Resource does not exist or is inaccessible")}))),(e=>ce(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}))))}))}(e,t):yield Pe(e,t,!1,o):yield Promise.reject(null)}))),(e=>ce(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}))}function ye(e,t){return ce(this,void 0,void 0,(function*(){const n={title:null==e?void 0:e.name,type:(null==e?void 0:e.type)||"Web Experience",typeKeywords:["EXB Experience","Ready To Use","JavaScript","status: Draft",`version:${i.version}`],snippet:(null==e?void 0:e.snippet)||"",description:(null==e?void 0:e.description)||"",tags:(null==e?void 0:e.tags)||[],data:{__not_publish:!0}};return yield(()=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(!1)})))().then((function(e){return ce(this,void 0,void 0,(function*(){return e?yield Promise.reject("app existed."):yield Re(n,t)}))}))}))}function Se(e){return ce(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession();return yield Je({item:{id:e,owner:null==t?void 0:t.username,text:"",data:{__not_publish:!0}},authentication:i.SessionManager.getInstance().getMainSession()}).then((()=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)}))),(e=>ce(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}))}function be(e,t,n=!1,i=!1,o=!1){return ce(this,void 0,void 0,(function*(){const r=he(t);return yield function(e,t){return Fe(this,void 0,void 0,(function*(){return Ke("getItemResources",e)(e.id,t,fe(e))}))}(t,{authentication:r}).then((r=>ce(this,void 0,void 0,(function*(){const s=[],u=r&&r.resources;let a=!1;if(u)for(let r=0;r<u.length;r++){const c="config/config.json"===u[r].resource;n&&c||(c&&(a=!0),s.push(we(e,t,u[r],i,o)))}return a||n?yield Promise.all(s):yield Promise.resolve(null)}))),(e=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(null)}))))}))}function Pe(e,t,n=!1,i=!1){return ce(this,void 0,void 0,(function*(){return yield be(e,t,!1,n,i).then((e=>ce(this,void 0,void 0,(function*(){return e?yield Promise.resolve(!0):yield Promise.reject("Resource does not exist or is inaccessible")}))),(e=>ce(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}))}function je(e,t,n){return ce(this,void 0,void 0,(function*(){const o=he({portalUrl:window.jimuConfig.isDevEdition?"localhost:":(0,i.getAppStore)().getState().portalUrl}),r=he(t);if(n){const i=`${$e(t)}${t.id}/info/${n}?token=${null==r?void 0:r.token}`,s=`${$e(t)}${t.id}/${n}`;let u;return u=(null==n?void 0:n.startsWith("blob:"))?n:(null==n?void 0:n.includes("http"))?`${n}?token=${null==r?void 0:r.token}`:le(t)?i:s,yield new Promise((function(t,n){const i=new XMLHttpRequest;i.open("GET",u,!0),i.responseType="blob",i.onload=function(i){if(200===this.status){const i=this.response;return pt({id:e,thumbnail:i,f:"json",token:null==o?void 0:o.token}).then((()=>{t(!0)}),(()=>{n(!1)}))}n(!1)},i.onerror=function(e){n()},i.send()}))}return Promise.resolve(!0)}))}function we(e,t,n,o=!1,r=!1){return ce(this,void 0,void 0,(function*(){const s=he(t),u=le(t)?`?token=${null==s?void 0:s.token}`:"",a=`${$e(t)}${t.id}/resources/`,c=he({portalUrl:window.jimuConfig.isDevEdition?"localhost:":(0,i.getAppStore)().getState().portalUrl});if("config/config.json"===n.resource||"images/image-resources-list.json"===n.resource){const s=a+n.resource+u;return yield fetch(s,{cache:"no-cache"}).then((e=>ce(this,void 0,void 0,(function*(){return yield e.json()})))).then((s=>ce(this,void 0,void 0,(function*(){const u="config/config.json"===n.resource,a=u?Oe(s,t):s;return yield function(e,t,n){return ce(this,void 0,void 0,(function*(){const o=$e(t)+t+"/resources/",r=new RegExp("^"+o);const s={matcher:function(e){return r.test(e)},handler:function(n){return n.replace("/"+t+"/","/"+e+"/")}};return Promise.resolve(i.utils.replaceStringInObject(n,s))}))}(e,t.id,a).then((t=>ce(this,void 0,void 0,(function*(){var s,a;if(delete t.appProxies,delete t.historyLabels,u){o&&(t=null===(s=Ge((0,i.Immutable)(t)))||void 0===s?void 0:s.asMutable({deep:!0})),r&&(null===(a=null==t?void 0:t.attributes)||void 0===a?void 0:a.favicon)&&delete t.attributes.favicon;const e=(new Date).getTime();t.timestamp=`${e}`}const d=new Blob([JSON.stringify(t)],{type:"application/json"});return yield He({id:e,resource:d,name:n.resource.split("/")[n.resource.split("/").length-1],params:{resourcesPrefix:n.resource.split("/").slice(0,n.resource.split("/").length-1).join("/")},authentication:c}).then((()=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(!0)}))),(e=>ce(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}))))})))).catch((e=>ce(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}{const t=a+n.resource+u;return yield new Promise((function(i,o){const r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="blob",r.onload=function(t){if(200===this.status){const t=this.response;return He({id:e,resource:t,name:n.resource.split("/")[n.resource.split("/").length-1],params:{resourcesPrefix:n.resource.split("/").slice(0,n.resource.split("/").length-1).join("/")},authentication:c}).then((()=>{i(!0)}),(()=>{i(!1)}))}i(!1)},r.onerror=function(e){i(!1)},r.send()}))}}))}function Oe(e,t){var n;const o=(0,i.getAppStore)().getState().portalUrl;e.attributes&&(e.attributes.portalUrl=o);const r=null==e?void 0:e.dataSources;if(r&&fe(t))for(const e in r)Ae(null===(n=r[e])||void 0===n?void 0:n.portalUrl)&&(r[e].portalUrl=o);return e}function Ae(e){let t=!1;const n=(0,i.getAppStore)().getState().portalUrl;return(Ue(n,e,"mapsdevext.arcgis.com")||Ue(n,e,"mapsqa.arcgis.com")||Ue(n,e,"maps.arcgis.com"))&&(t=!0),t}function Ue(e,t,n){return((null==e?void 0:e.endsWith(n))||(null==e?void 0:e.endsWith(`${n}/`)))&&((null==t?void 0:t.endsWith(n))||(null==t?void 0:t.endsWith(`${n}/`)))}function Te(e,t,n){return ce(this,void 0,void 0,(function*(){return yield ct(e).then((i=>ce(this,void 0,void 0,(function*(){if(i){const o=t?h.TemplateType:h.ExperienceType;return yield me(i.title).then((r=>ce(this,void 0,void 0,(function*(){if(r){const s={name:r,tags:i.tags,thumbnail:i.thumbnail,type:o,typeKeywords:null==e?void 0:e.typeKeywords};return yield Ee(s,n).then((n=>ce(this,void 0,void 0,(function*(){return n?yield ge(n.id,e,!t,!0).then((()=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(n.id)}))),(e=>ce(this,void 0,void 0,(function*(){return console.error(e),mt(n.id),yield Promise.reject(e)})))):yield Promise.reject(null)}))))}return yield Promise.reject(null)}))))}return yield Promise.reject(null)}))))}))}function Ie(e){const t=`version:${i.version}`;if(!e||0===e.length)return["EXB Experience","Ready To Use","JavaScript","status: Draft",t];let n=!1,o=!1;const r=e.map((e=>(e.includes("version:")&&(o=!0),e.includes("status:")?(n=!0,"status: Draft"):e)));return!n&&r.push("status: Draft"),!o&&r.push(t),r}function xe(e,t,n=1,i=!1){const o=1===n&&i?e:`${e} ${n}`;return function(e,t){let n=!1;return t.forEach((t=>{e===t.title&&(n=!0)})),n}(o,t)?xe(e,t,n+1):o}function ke(e,t,n,o){return ce(this,void 0,void 0,(function*(){const r=i.moduleLoader.getModuleSync("jimu-for-builder").AppResourceManager.getInstance(),s=t.id;let u=i.utils.replaceI18nPlaceholdersInObject(e,i.i18n.getIntl(),ae);return(a=u).attributes||(a.attributes={}),a.widgets||(a.widgets={}),a.widgetsManifest||(a.widgetsManifest={}),a.views||(a.views={}),a.sections||(a.sections={}),a.dialogs||(a.dialogs={}),a.pages||(a.pages={}),a.layouts||(a.layouts={}),a.dataSources||(a.dataSources={}),a.messageConfigs||(a.messageConfigs={}),u=a,i.appConfigUtils.addWebmapOrWebsceneToAppConfig(u,n,o),r.upLoadAppConfig(s.toString(),u).then((()=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(t)}))));var a}))}function Ee(e,t){return ce(this,void 0,void 0,(function*(){const n={title:e.name,type:e.type||"Web Experience",typeKeywords:Ie(null==e?void 0:e.typeKeywords),snippet:(null==e?void 0:e.snippet)||"",description:(null==e?void 0:e.description)||"",tags:e.tags,thumbnail:e.thumbnail};return yield Re(n,t)}))}function Me(e){return ce(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance(),n=(new Date).getTime();return window.jimuConfig.isDevEdition?yield window.fetch(`/apps/${e}/resources/config/config.json`).then((e=>ce(this,void 0,void 0,(function*(){return yield e.json()})))):yield de(`${i.portalUrlUtils.getPortalRestUrl((0,i.getAppStore)().getState().portalUrl)}/content/items/${e}/resources/config/config.json`,{authentication:t.getSessionByUrl((0,i.getAppStore)().getState().portalUrl),httpMethod:"GET",params:{timestamp:n}}).catch((e=>ce(this,void 0,void 0,(function*(){return Promise.reject(e)}))))}))}function $e(e){const t=fe(e)?i.urlUtils.getArcgisOnlineUrl():(0,i.getAppStore)().getState().portalUrl;return(null==e?void 0:e.isLocalApp)?I()+"/apps/":i.portalUrlUtils.getPlatformUrlByOrgUrl(t)+"/sharing/rest/content/items/"}function Re(e,t){return ce(this,void 0,void 0,(function*(){return t?yield(n={item:e,folderId:t,authentication:i.SessionManager.getInstance().getMainSession()},i.esri.restPortal.createItemInFolder(n)):yield function(e){return Fe(this,void 0,void 0,(function*(){return Ke("createItem")(e)}))}({item:e,authentication:i.SessionManager.getInstance().getMainSession()});var n}))}function Ce(e){const t={};return Object.keys(e).forEach((n=>{t[n]=Object.assign({},e[n])})),t}function De(e,t){const n=e.historyLabels;Object.keys(n[t]||{}).forEach((i=>{var o;(null===(o=e[t])||void 0===o?void 0:o[i])||delete n[t][i]}))}function _e(e,t,n){const i=e[n],o=t[n];i&&o&&Object.keys(i).forEach((r=>{var s,u;const a=(null===(u=null===(s=t.historyLabels)||void 0===s?void 0:s[n])||void 0===u?void 0:u[r])||[];o[r]&&i[r].label!==o[r].label&&(a.includes(o[r].label)||a.push(o[r].label)),a.length>0&&(e.historyLabels?e.historyLabels[n]?e.historyLabels[n][r]=a:e.historyLabels[n]={[r]:a}:e.historyLabels={[n]:{[r]:a}})}))}const Le=/<[^>]*>/gm,Ne=e=>{if(!e)return!0;if("<p></p>"===e||"<p><br></p>"===e)return!0;let t="";return t=e.includes("<")?e.replace(Le,""):e,t=null==t?void 0:t.trim(),!t};function Ge(e){var t;if(!e)return null;i.semver.lt(i.version,null==e?void 0:e.exbVersion)&&(e=e.set("exbVersion",i.version));const n=(null===(t=(0,i.getAppStore)().getState().appStateInBuilder)||void 0===t?void 0:t.appConfig).widgets||{};return Object.keys(n).forEach((t=>{var o,r,s,u,a;i.semver.lt(null===(r=null===(o=n[t])||void 0===o?void 0:o.manifest)||void 0===r?void 0:r.version,null===(s=n[t])||void 0===s?void 0:s.version)&&(e=e.setIn(["widgets",t,"version"],null===(a=null===(u=n[t])||void 0===u?void 0:u.manifest)||void 0===a?void 0:a.version))})),e}function qe(e){var t,n;e.attributes?e.attributes.portalUrl=(0,i.getAppStore)().getState().portalUrl:e.attributes={portalUrl:(0,i.getAppStore)().getState().portalUrl};const o=null===(n=null===(t=(0,i.getAppStore)().getState().portalSelf)||void 0===t?void 0:t.portalProperties)||void 0===n?void 0:n.sharedTheme;return e.sharedThemeVariables=i.sharedThemeUtils.createSharedThemeVariables(o),e}var Fe=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};const{importItem:Be,checkItemVersion:We}=e;function Ke(t,n,o){const r=o?e[o]:e[t],s=i.esri.restPortal[t];return n?le(n)?s:r:window.jimuConfig.isDevEdition?r:s}function Je(e){return Fe(this,void 0,void 0,(function*(){return Ke("updateItem")(e)}))}function Ve(e,t){return Fe(this,void 0,void 0,(function*(){return Ke("getItem",e)(e.id,t,fe(e))}))}function He(e){return Fe(this,void 0,void 0,(function*(){return Ke("addItemResource")(e)}))}var Xe=o(262),Qe=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};function ze(e,t){return Qe(this,void 0,void 0,(function*(){return yield Te(e,!1,t)}))}function Ye(e){return Qe(this,void 0,void 0,(function*(){return yield function(e){return ce(this,void 0,void 0,(function*(){return yield function(e){return ce(this,void 0,void 0,(function*(){const t=(0,i.getAppStore)().getState().portalUrl,n={id:e,portalUrl:t,isLocalApp:!1};return yield ct(n).then((e=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(n)})))).catch((e=>ce(this,void 0,void 0,(function*(){return yield Promise.reject("Item does not exist or is inaccessible.")}))))}))}(e).then((e=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))).catch((t=>ce(this,void 0,void 0,(function*(){return yield function(e){return ce(this,void 0,void 0,(function*(){const t=(0,i.getAppStore)().getState().portalUrl;if(i.portalUrlUtils.isAGOLDomain(t))return yield Promise.reject(!1);const n={id:e,portalUrl:"https://maps.arcgis.com",isLocalApp:!1};return yield ct(n).then((e=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(n)})))).catch((e=>ce(this,void 0,void 0,(function*(){return yield Promise.reject("Item does not exist or is inaccessible.")}))))}))}(e).then((e=>ce(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))).catch((t=>ce(this,void 0,void 0,(function*(){return yield function(e){return ce(this,void 0,void 0,(function*(){if(window.jimuConfig.isDevEdition){const t=(0,i.getAppStore)().getState().portalUrl,n={id:e,portalUrl:t,isLocalApp:!0};return yield ct(n).then((e=>ce(this,void 0,void 0,(function*(){return(null==e?void 0:e.success)?yield Promise.resolve(n):yield Promise.reject("Item does not exist or is inaccessible.")})))).catch((e=>ce(this,void 0,void 0,(function*(){return yield Promise.reject("Item does not exist or is inaccessible.")}))))}return yield Promise.reject("Item does not exist or is inaccessible.")}))}(e)}))))}))))}))}(e).then((e=>Qe(this,void 0,void 0,(function*(){return yield ze(e)}))))}))}function Ze(e,t,n,i,o){return Qe(this,void 0,void 0,(function*(){return yield me(e).then((e=>Qe(this,void 0,void 0,(function*(){if(e){const r={template:t,name:e,description:"",type:h.ExperienceType};return yield Promise.all([Ut(r)]).then((function(e){return Qe(this,void 0,void 0,(function*(){let t=e[0];return t.template=r.template,t=qe(t),yield ye(r,n).then((e=>Qe(this,void 0,void 0,(function*(){return yield ke(t,e,i,o)}))))}))})).catch((e=>Qe(this,void 0,void 0,(function*(){return console.error(e),yield Promise.reject(e)}))))}return yield Promise.reject(null)}))))}))}function et(e,t){return Qe(this,void 0,void 0,(function*(){return yield Te(e,!0,t)}))}function tt(e){return Qe(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession();return yield function(e,t){return Fe(this,void 0,void 0,(function*(){return Be(e,t)}))}(e,{authentication:t})}))}function nt(e){return Qe(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession();return yield function(e,t){return Fe(this,void 0,void 0,(function*(){return We(e,t)}))}(e,{authentication:t})}))}function it(e){return Qe(this,void 0,void 0,(function*(){return ot(e,null,!0)}))}function ot(e,t,n){return Qe(this,void 0,void 0,(function*(){return yield ct(e).then((o=>Qe(this,void 0,void 0,(function*(){if(o){const r=i.i18n.getIntl().formatMessage({id:"copy"})||"copy",s=n?o.title:`${o.title} ${r}`;return yield me(s,!0,e.type).then((n=>Qe(this,void 0,void 0,(function*(){if(n){const i={name:n,description:(null==o?void 0:o.description)||"",snippet:(null==o?void 0:o.snippet)||"",typeKeywords:(null==o?void 0:o.typeKeywords)||[],tags:o.tags,thumbnail:o.thumbnail,type:e.type||o.type};return yield Ee(i,t).then((t=>Qe(this,void 0,void 0,(function*(){return t?yield je(t.id,e,o.thumbnail).then((()=>Qe(this,void 0,void 0,(function*(){return yield ge(t.id,e,!1).then((()=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(t.id)}))),(e=>Qe(this,void 0,void 0,(function*(){return console.error(e),mt(t.id),yield Promise.reject(e)}))))})))):yield Promise.reject(null)}))))}return yield Promise.reject(null)}))))}return yield Promise.reject(null)}))))}))}function rt(e,t,n,o){return Qe(this,void 0,void 0,(function*(){return yield me(`${t.title}`,!0,t.type).then((r=>Qe(this,void 0,void 0,(function*(){if(r){const r={name:t.title,description:(null==t?void 0:t.description)||"",snippet:(null==t?void 0:t.snippet)||"",typeKeywords:(null==t?void 0:t.typeKeywords)||[],tags:t.tags,thumbnail:t.thumbnail,type:e.type||e.type};return yield Ee(r,n).then((n=>Qe(this,void 0,void 0,(function*(){return n?(t.id=n.id,yield function(e,t,n){return ce(this,void 0,void 0,(function*(){if(!n)return yield je(t.id,e,(null==e?void 0:e.thumbnailurl)||e.thumbnail);{const e=i.SessionManager.getInstance().getMainSession(),o={id:t.id,f:"json",token:null==e?void 0:e.token,thumbnail:n};yield pt(o,t.owner)}}))}(e,t,o).then((()=>Qe(this,void 0,void 0,(function*(){return yield Se(n.id).then((o=>Qe(this,void 0,void 0,(function*(){return o?yield Pe(n.id,e,!0).then((()=>Qe(this,void 0,void 0,(function*(){let e=(0,i.getAppStore)().getState().appStateInBuilder.appConfig;e=Ge(e);const o=null==e?void 0:e.asMutable({deep:!0});return delete o.appProxies,delete o.historyLabels,gt(t,(0,i.Immutable)(o),n.id).then((()=>Qe(this,void 0,void 0,(function*(){return Me(n.id).then((e=>Qe(this,void 0,void 0,(function*(){return Promise.resolve({id:n.id,appConfig:e})}))))}))))}))),(e=>Qe(this,void 0,void 0,(function*(){return console.error(e),mt(n.id),yield Promise.reject(e)})))):yield Promise.reject(null)}))),(e=>Qe(this,void 0,void 0,(function*(){return console.error(e),mt(n.id),yield Promise.reject(e)}))))}))))):yield Promise.reject(null)}))))}return yield Promise.reject(null)}))),(e=>Promise.reject(e)))}))}function st(e){return Qe(this,void 0,void 0,(function*(){const t=he(e);return yield function(e,t){return Fe(this,void 0,void 0,(function*(){return Ke("getItemData",e)(e.id,t,fe(e))}))}(e,{authentication:t}).then((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))),(e=>Qe(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}))}function ut(e,t){return Qe(this,void 0,void 0,(function*(){const n=pe(t);return yield function(e,t){return Fe(this,void 0,void 0,(function*(){return function(e){let t;const n=(0,i.getAppStore)().getState().portalUrl,o=i.portalUrlUtils.isAGOLDomain(n);switch(e){case v.Portal:t=i.esri.restPortal.searchItems;break;case v.AGOL:t=o?i.esri.restPortal.searchItems:P;break;case v.Other:t=window.jimuConfig.isDevEdition?P:i.esri.restPortal.searchItems}return t}(t)(e,t)}))}(Object.assign(Object.assign({},e),{authentication:n}),t).then((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function at(e,t){return Qe(this,void 0,void 0,(function*(){const n=(0,i.getAppStore)().getState().portalUrl;if(t===n){const t=pe(v.Portal);e.authentication=t}return yield function(e,t){return Fe(this,void 0,void 0,(function*(){return w(e,t)}))}(e,t).then((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function ct(e){return Qe(this,void 0,void 0,(function*(){const t=he(e);return yield Ve(e,{authentication:t}).then((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function dt(e,t){return Qe(this,void 0,void 0,(function*(){const n=i.SessionManager.getInstance().getMainSession();return yield function(e,t,n){return Fe(this,void 0,void 0,(function*(){return yield function(e,t,n=!1){return se(this,void 0,void 0,(function*(){const o=`${te(n)}/sharing/rest/community/groups/${e}/categorySchema`;n&&!ue()&&delete t.authentication;const r=Object.assign(Object.assign({},t),{params:{id:e},httpMethod:"GET"}),s=i.esri.restRequest.request;return yield s(o,r)}))}(e,t,n)}))}(e,{authentication:n},t).then((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function lt(e){return Qe(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession();return yield function(e,t){return Fe(this,void 0,void 0,(function*(){return yield function(e,t=!1){return se(this,void 0,void 0,(function*(){const n=function(e=!1){var t;return e?i.urlUtils.getArcgisOnlineOrgId():null===(t=(0,i.getAppStore)().getState().user)||void 0===t?void 0:t.orgId}(t),o=`${te(t)}/sharing/rest/portals/${n}/categorySchema`;t&&!ue()&&delete e.authentication;const r=Object.assign(Object.assign({},e),{httpMethod:"GET"}),s=i.esri.restRequest.request;return yield s(o,r)}))}(e,t)}))}({authentication:t},e).then((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function ft(e,t,n){return Qe(this,void 0,void 0,(function*(){const o=i.SessionManager.getInstance().getMainSession();return yield function(e,t,n){return Fe(this,void 0,void 0,(function*(){return yield function(e,t,n=!1){return ne(this,void 0,void 0,(function*(){const o=`${te(n)}/sharing/rest/content/groups/${e}/search`;n&&!function(){const e=(0,i.getAppStore)().getState().portalUrl;return i.portalUrlUtils.isAGOLDomain(e)}()&&delete t.authentication;const r=Object.assign(Object.assign({},t),{httpMethod:"GET"}),s=i.esri.restRequest.request;return yield s(o,r)}))}(e,t,n)}))}(e,{params:t,authentication:o},n).then((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function vt(e){return Qe(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession(),n=window.jimuConfig.isDevEdition?"localhost:":(0,i.getAppStore)().getState().portalUrl,o={id:e.id,portalUrl:n};return yield Ve(o,{authentication:t}).then((n=>Qe(this,void 0,void 0,(function*(){return yield Je({item:e,owner:n.owner,authentication:t}).then((()=>null))}))))}))}function ht(e){return Qe(this,void 0,void 0,(function*(){return vt(Object.assign(Object.assign({},e),{thumbnailurl:void 0})).then((t=>{var n;const o=null==e?void 0:e.thumbnailurl,r=null===(n=(0,i.getAppStore)().getState().appRuntimeInfo)||void 0===n?void 0:n.saveThumbnailUrl;return o&&o!==r?((0,i.getAppStore)().dispatch(i.appActions.saveThumbnailUrl(o)),je(e.id,e,o)):Promise.resolve(!0)})).catch((e=>Promise.reject("Update appInfo error")))}))}function pt(e,t=""){return Qe(this,void 0,void 0,(function*(){const n=i.SessionManager.getInstance().getMainSession();return yield function(e){return Fe(this,void 0,void 0,(function*(){return window.jimuConfig.isDevEdition?yield V(e):yield function(e){return ee(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession(),n=e.owner?e.owner:null==t?void 0:t.username,o=`${(0,i.getAppStore)().getState().portalUrl}/sharing/rest/content/users/${n}/items/${e.item.id}/update`;e.params=Object.assign(Object.assign({},e.params),e.item);const r=Object.keys(e.params),s=new FormData;for(let t=0;t<r.length;t++)s.append(r[t],e.params[r[t]]);return e.params=s,yield Z(o,s)}))}(e)}))}({item:e,authentication:n,owner:t}).then((()=>null))}))}function mt(e){return Qe(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession();return yield Ve({id:e},{authentication:t}).then((t=>Qe(this,void 0,void 0,(function*(){return yield function(e){return Fe(this,void 0,void 0,(function*(){return Ke("removeItem")(e)}))}({id:e,owner:t.owner,authentication:i.SessionManager.getInstance().getMainSession()})}))))}))}function gt(e,t,n){return Qe(this,void 0,void 0,(function*(){const o=i.SessionManager.getInstance().getMainSession(),r=i.moduleLoader.getModuleSync("jimu-for-builder").AppResourceManager,s=i.moduleLoader.getModuleSync("jimu-for-builder").appConfigUtils,u=(null==e?void 0:e.owner)||o.username,a=Object.assign({},s.getCleanAppConfig(t)),c=r.getInstance();if(a)try{yield c.upLoadAppConfig(e.id,a,u);const t=[],{imageResources:i,iconResources:o}=c.getResourcesInDraft();i&&t.push(c.upLoadImageResourceList(Ce(i),n)),o&&t.push(c.upLoadIconResourceList(Ce(o),n)),t.push(ht(e)),yield Promise.all(t)}catch(e){yield Promise.reject(e)}else yield Promise.reject()}))}function yt(e){return Qe(this,void 0,void 0,(function*(){const t=yield Me(e.id),n=yield st(e),o=i.SessionManager.getInstance().getMainSession();if(t&&n){const r=function(e,t){let n=!1,i=!1;const o=e.map((e=>e.includes("status:")?(n=!0,`status: ${p.Published}`):e.includes("publishVersion:")&&t?(i=!0,`publishVersion:${t}`):e));if(!n){const e=`status: ${p.Published}`;o.push(e)}return!i&&t&&o.push(`publishVersion:${t}`),o}(null==e?void 0:e.typeKeywords,null==n?void 0:n.exbVersion);return i.moduleLoader.getModuleSync("jimu-for-builder").AppResourceManager.getInstance().upLoadLocalResource(t).then((t=>Qe(this,void 0,void 0,(function*(){if(!t)return yield Promise.reject();t=function(e,t){return t.__not_publish||(e.historyLabels&&(De(e,"pages"),De(e,"views"),De(e,"dialogs")),_e(e,t,"pages"),_e(e,t,"views"),_e(e,t,"dialogs")),e}(t=function(e,t){return Object.values(e.widgets).forEach((e=>{"widgets/common/text/"===e.uri&&function(e,t){if(t.type===h.TemplateType)return e;Ne(null==e?void 0:e.text)||delete e.placeholder}(e.config,t)})),e}(t,e),n);const s=function(e){const{type:t,id:n}=e,{isDevEdition:o,isInPortal:r,hostEnv:s}=window.jimuConfig,u=t===h.TemplateType,a=!o&&!r;if(o)return null;let c=i.urlUtils.getAppUrl({appId:n,isTemplate:u});if(a)switch(s){case"prod":c=`https://experience.arcgis.com${c}`;break;case"dev":c=`https://experiencedev.arcgis.com${c}`;break;case"qa":c=`https://experienceqa.arcgis.com${c}`}return r&&(c=`${window.location.origin}${c}`),c}(e);yield Je({item:{id:e.id,owner:e.owner||(null==o?void 0:o.username),data:t,typeKeywords:r,url:s},authentication:i.SessionManager.getInstance().getMainSession()}).then((()=>Qe(this,void 0,void 0,(function*(){yield Promise.resolve()}))),(()=>Qe(this,void 0,void 0,(function*(){return yield Promise.reject()}))))}))),(()=>Qe(this,void 0,void 0,(function*(){return yield Promise.reject()})))).catch((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))))}yield Promise.reject()}))}function St(e){return Qe(this,void 0,void 0,(function*(){return(t=e,function(e){return ne(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession(),n=`${(0,i.getAppStore)().getState().portalUrl}/sharing/rest/content/users/${null==t?void 0:t.username}`,o=Object.assign(Object.assign({},e.params),{f:"json",token:null==t?void 0:t.token});return yield Z(n,o,"GET")}))}(t)).then((e=>Qe(this,void 0,void 0,(function*(){const t=(null==e?void 0:e.folders)||[];return yield Promise.resolve(t)}))),(e=>Qe(this,void 0,void 0,(function*(){return yield Promise.reject(e)}))));var t}))}function bt(e){return Qe(this,void 0,void 0,(function*(){return yield function(e){return Fe(this,void 0,void 0,(function*(){return yield function(e){return ie(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession(),n=`${(0,i.getAppStore)().getState().portalUrl}/sharing/rest/content/items/${e.items}/share`;e=Object.assign(Object.assign({},e),{f:"json",token:null==t?void 0:t.token});const o=Object.keys(e),r=new FormData;for(let t=0;t<o.length;t++)r.append(o[t],e[o[t]]);return e=r,yield Z(n,e)}))}(e)}))}(e).then((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function Pt(e){return Qe(this,void 0,void 0,(function*(){return yield function(e){return Fe(this,void 0,void 0,(function*(){return yield function(e){return oe(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession(),n=`${(0,i.getAppStore)().getState().portalUrl}/sharing/rest/content/items/${e.items}/unshare`;e=Object.assign(Object.assign({},e),{f:"json",token:null==t?void 0:t.token});const o=Object.keys(e),r=new FormData;for(let t=0;t<o.length;t++)r.append(o[t],e[o[t]]);return e=r,yield Z(n,e)}))}(e)}))}(e).then((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function jt(e){return Qe(this,void 0,void 0,(function*(){return yield function(e){return Fe(this,void 0,void 0,(function*(){return yield function(e){return re(this,void 0,void 0,(function*(){const t=i.SessionManager.getInstance().getMainSession(),n=`${(0,i.getAppStore)().getState().portalUrl}/sharing/rest/content/itemsgroups`,o={params:e,httpMethod:"GET",authentication:t};return yield i.esri.restRequest.request(n,o)}))}(e)}))}(e).then((e=>Qe(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))}))}function wt(e){return Qe(this,void 0,void 0,(function*(){return yield function(e){return Fe(this,void 0,void 0,(function*(){return yield i.esri.restPortal.moveItem(e)}))}(Object.assign(Object.assign({},e),{authentication:i.SessionManager.getInstance().getMainSession()}))}))}function Ot(e){return Qe(this,void 0,void 0,(function*(){return yield function(e){return Fe(this,void 0,void 0,(function*(){return yield i.esri.restPortal.getUserTags(e)}))}({username:e,authentication:i.SessionManager.getInstance().getMainSession()})}))}function At(e){return Qe(this,void 0,void 0,(function*(){return yield function(e){return Fe(this,void 0,void 0,(function*(){return yield i.esri.restPortal.searchGroups(e)}))}(e)}))}function Ut(e){return Qe(this,void 0,void 0,(function*(){return(0,Xe.getTemplateConfig)(Xe.TemplateType.App,e.template)}))}var Tt=function(e,t,n,i){return new(n||(n=Promise))((function(o,r){function s(e){try{a(i.next(e))}catch(e){r(e)}}function u(e){try{a(i.throw(e))}catch(e){r(e)}}function a(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,u)}a((i=i.apply(e,t||[])).next())}))};const It=i.esri.restRequest.request;var xt;let kt,Et;function Mt(e,t){return Tt(this,void 0,void 0,(function*(){const n=i.SessionManager.getInstance().getMainSession(),{username:o}=n,r=(0,i.getAppStore)().getState().portalUrl,s=i.portalUrlUtils.getBaseUserUrl(r),u=yield Gt.getInstance().getToken();let a;switch(t=null!=t?t:Nt(),e){case xt.Add:a=s+"/"+o+"/addResource/?token="+u;break;case xt.Remove:a=s+"/"+o+"/removeResource/?token="+u;break;case xt.Get:a=s+"/"+o+"/resources/"+t+"?token="+u;break;case xt.GetAll:a=s+"/"+o+"/resources/?token="+u}return yield Promise.resolve(a)}))}function $t(e,t){return Tt(this,void 0,void 0,(function*(){t=null!=t?t:Nt();const n={httpMethod:"POST",params:Object.assign(Object.assign({},e),{key:t,access:"UserPrivateAllApps"})};return yield Mt(xt.Add).then((e=>Tt(this,void 0,void 0,(function*(){return yield It(e,n).then((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))})))).catch((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed adding user resource:"+e.message))}))))}))}function Rt(e){return Tt(this,void 0,void 0,(function*(){return e=null!=e?e:Nt(),yield Mt(xt.Get,e).then((e=>Tt(this,void 0,void 0,(function*(){return yield It(e,{params:{f:"json"}}).then((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))})))).catch((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed retrieving user resource:"+e.message))}))))}))}function Ct(){return Tt(this,void 0,void 0,(function*(){return yield Mt(xt.GetAll).then((e=>Tt(this,void 0,void 0,(function*(){return yield It(e,{params:{f:"json"}}).then((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))})))).catch((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed retrieving user resource list:"+e.message))}))))}))}function Dt(e){return Tt(this,void 0,void 0,(function*(){return e=null!=e?e:Nt(),yield Mt(xt.Remove).then((t=>Tt(this,void 0,void 0,(function*(){const n={params:{key:e}};return yield It(t,n).then((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.resolve(e)}))))})))).catch((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed removing user resource:"+e.message))}))))}))}function _t(e){return Tt(this,void 0,void 0,(function*(){return yield Rt().then((t=>Tt(this,void 0,void 0,(function*(){const n=(0,i.Immutable)(null!=t?t:{}).merge(e,{deep:!0});return yield $t({text:JSON.stringify(Object.assign({},n))})})))).then((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.resolve(e)})))).catch((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed updating user resource:"+e.message))}))))}))}function Lt(){return Tt(this,void 0,void 0,(function*(){return kt||(kt=Ct().then((e=>Tt(this,void 0,void 0,(function*(){if(0===e.total)return yield $t({text:"{}"});{const t=e.userResources[0],n=Nt();return t.key===n?yield Promise.resolve({success:!0}):yield Rt(t.key).catch((e=>null)).then((e=>Tt(this,void 0,void 0,(function*(){return e&&(e.showGuides||0===Object.keys(e).length)?yield Dt(t.key).then((()=>Tt(this,void 0,void 0,(function*(){return yield $t({text:JSON.stringify(Object.assign({},e))})})))):yield $t({text:"{}"})}))))}})))).catch((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.reject(new Error("Failed initializing user resource:"+e.message))}))))),kt}))}function Nt(){if(!Et){const e=i.SessionManager.getInstance().getMainSession();Et=`${i.USER_SETTING_FILE_KEY}${(null==e?void 0:e.clientId)?`_${e.clientId}`:""}.json`}return Et}!function(e){e.Add="ADD",e.Remove="REMOVE",e.Get="GET",e.GetAll="GETALL"}(xt||(xt={}));class Gt{static getInstance(){return Gt.instance||(Gt.instance=new Gt),Gt.instance}constructor(){this.session=i.SessionManager.getInstance().getMainSession()}_shouldExchangeToken(){return Tt(this,void 0,void 0,(function*(){if(!this.exchangedToken||this.session.tokenExpires<new Date){if(!this.portalSelfPromise){const e=(0,i.getAppStore)().getState().portalUrl;this.portalSelfPromise=It(`${e}/sharing/rest/community/self?token=${this.session.token}`).then((({appInfo:e})=>Tt(this,void 0,void 0,(function*(){return yield Promise.resolve("experienceBuilder"!==(null==e?void 0:e.appId))})))).catch((e=>Tt(this,void 0,void 0,(function*(){return yield Promise.reject(new Error(e.message))}))))}return yield this.portalSelfPromise}return yield Promise.resolve(!1)}))}_exchangeToken(){return Tt(this,void 0,void 0,(function*(){const e=(0,i.getAppStore)().getState().portalUrl+"/sharing/rest/oauth2/exchangeToken",t={params:{client_id:this.session.clientId,token:this.session.token}};return yield It(e,t)}))}getToken(){var e;return Tt(this,void 0,void 0,(function*(){return(yield this._shouldExchangeToken())?yield this._exchangeToken().catch((e=>(console.warn("Failed exchanging token. Using default token from user sesion."),{token:this.session.token}))).then((e=>Tt(this,void 0,void 0,(function*(){return this.exchangedToken=null==e?void 0:e.token,yield Promise.resolve(this.exchangedToken)})))):yield Promise.resolve(null!==(e=this.exchangedToken)&&void 0!==e?e:this.session.token)}))}}})(),r})())}}}));
/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d5954a.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-d5954a"],{30473:(e,t,l)=>{l.r(t),l.d(t,{arcgis_smart_mapping_panels_chart:()=>u});var i=l(35110),a=l(59503),r=l(37192),o=l(61886),s=(l(21104),l(2137),l(34448)),n=l(51627),d=l(88703),c=l(86587);l(1984),l(63280),l(23505),l(89393),l(73838),l(50478);const u=class{constructor(e){(0,i.r)(this,e),this.smartMappingCompleteClose=(0,i.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsChartBackClick=(0,i.c)(this,"arcgisSmartMappingPanelsChartBackClick",7),this.arcgisSmartMappingPanelsChartClose=(0,i.c)(this,"arcgisSmartMappingPanelsChartClose",7),this.arcgisSmartMappingPanelsChartError=(0,i.c)(this,"arcgisSmartMappingPanelsChartError",7),this.inputNodes={},this.labelNodes={},this.popoverSettings={index:null,popoverNode:null},this.valueSymbolNodes={},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}componentDidLoad(){const{config:e}=a.s;this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${e.jsapiUrl}/themes/light/main.css" />`),requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,r.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}componentWillLoad(){var e,t,l;const{layer:i,modules:r,strings:o}=a.s,s=(0,a.j)(i);this.originalRendererJSON=s.toJSON(),this.originalFeatureReduction="featureReduction"in i&&i.featureReduction?r.esriLang.clone(i.featureReduction):void 0,s.defaultLabel||(s.defaultLabel=o.panels.chart.noData),a.s.lastDefault={otherColor:null===(e=s.othersCategory)||void 0===e?void 0:e.color,otherLabel:(null===(t=s.othersCategory)||void 0===t?void 0:t.label)||o.panels.chart.other,threshold:null===(l=s.othersCategory)||void 0===l?void 0:l.threshold,defaultColor:s.defaultColor,defaultLabel:s.defaultLabel},this.percentLabelFlip=(0,a.at)(this.hostElement)}disconnectedCallback(){var e,t;null===(e=this.sizeSliderWatchHandle)||void 0===e||e.remove(),a.s.lastDefault=void 0,a.s.selectedAttribute=void 0,a.s.selectedValue=void 0,(0,a.ae)(),null===(t=this.scaleHandle)||void 0===t||t.remove()}render(){var e;const{hideLayerTitle:t,isRTL:l,layer:r,mapImageSublayer:o,strings:s}=a.s,n=t?void 0:null!==(e=null==o?void 0:o.title)&&void 0!==e?e:r.title;return(0,i.h)(i.H,{class:"calcite-match-height"},(0,i.h)("calcite-flow-item",{class:{"flow-item":!0,[c.C.rtl]:l},closable:(0,a.H)(this.hostElement),heading:s.panels.styleOptions,description:n,menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemBack:()=>this.arcgisSmartMappingPanelsChartBackClick.emit(),ref:e=>this.flowItemNode=e},this.renderVisualization(),this.renderDoneButton(),this.renderCancelButton()))}renderVisualization(){const{strings:e}=a.s,t="chart-size"===(0,a.g)();return(0,i.h)("calcite-block",{class:"chart-block",heading:t?e.panels.chart.chartStyleColor:e.panels.chart.chartStyle,open:!0,collapsible:!1},this.renderChartSymbol(),this.renderValues(),this.renderChartSize(),this.renderShape(),this.renderMinSlice(),this.renderBackgroundStyle())}renderChartSymbol(){const{layer:e,mapView:t,modules:l}=a.s,r=(0,a.j)(e).attributes,o=l.pieChartSchemes.getSchemes({basemap:t.map.basemap,geometryType:(0,a.G)(e),numColors:r.length}),s=(0,a.aa)(o,Math.min(r.length,10))[0].colors;let n=(null==r?void 0:r.length)?r.slice(0,10).map(((e,t)=>e.color?new l.esriColor(e.color):new l.esriColor(s[t%s.length]))):[];return(0,i.h)("arcgis-smart-mapping-symbol-button",{type:"chart-ramp",colors:n,rampType:"discrete",onArcgisSmartMappingSymbolButtonSymbolChange:()=>(0,i.f)(this.hostElement)})}renderValues(){const{layer:e,strings:t}=a.s,l=(0,a.j)(e);return(0,i.h)("calcite-label",{class:"top-padding"},t.panels.chart.fieldName,(0,i.h)("calcite-list",{class:"top-grey-border"},(0,i.h)("calcite-list",{"drag-enabled":!0,onCalciteListOrderChange:e=>{let t=Array.from(e.target.children);this.handleSortLegend(t)}},l.attributes.map(((e,t)=>this.renderValue(e,t)))),this.renderOtherValue(),this.renderNullValue()))}renderValue(e,t){return(0,i.h)("calcite-list-item",{key:e.field,value:e.field},this.renderSymbolNode(e,t),this.renderTextNode(e,t))}renderSymbolNode(e,t){const{layer:l,mapView:r,modules:o,selectedAttribute:s,strings:n}=a.s,d=(0,a.T)(l,r);d.color=new o.esriColor(e.color),d.outline=void 0;const c={"value-symbol":!0,"symbol-is-white":(0,a.aq)(d)},u={"symbol-icon":!0,selected:s===t};return(0,i.h)("div",{class:c,slot:"content-start",role:"button","aria-label":n.panels.chart.accessibility.editSymbolFor.replace("${value}",e.label),"aria-haspopup":"true","aria-expanded":s===t,onClick:()=>this.handleValueSymbolClick(t),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(t)}},(0,i.h)("div",{class:u,tabIndex:0,"aria-hidden":"true",ref:e=>{var l,i,r,o;e&&(this.valueSymbolNodes[t]=e,(0,a.aF)(d)?(e.style.backgroundColor=null,e.style.opacity=null):(e.style.backgroundColor=null!==(i=null===(l=d.color)||void 0===l?void 0:l.toHex())&&void 0!==i?i:"#ffffff",e.style.opacity=null!==(o=null===(r=d.color)||void 0===r?void 0:r.a)&&void 0!==o?o:0))}}))}renderOtherValue(){var e,t;const{lastDefault:l,layer:r,mapView:o,modules:s,selectedAttribute:n,strings:d}=a.s,c=(0,a.j)(r),u=(null===(e=c.othersCategory)||void 0===e?void 0:e.color)||l.otherColor,h=(0,a.T)(r,o);h.color=new s.esriColor(u),h.outline=void 0;const p=(null===(t=c.othersCategory)||void 0===t?void 0:t.label)||l.otherLabel,m={"other-symbol":!0,"symbol-is-white":(0,a.aq)(h)},b={"symbol-icon":!0,selected:-1===n};return(0,i.h)("calcite-list-item",{class:"top-grey-border other-null-list-item"},(0,i.h)("div",{class:m,slot:"content-start",role:"button",tabIndex:0,"aria-haspopup":"true","aria-expanded":-1===n,"aria-label":d.panels.chart.accessibility.editSymbolFor.replace("${fieldName}",p),onClick:()=>this.handleValueSymbolClick(-1),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(-1)}},(0,i.h)("div",{class:b,tabIndex:0,"aria-hidden":"true",ref:e=>{var t,l,i,r;e&&(this.valueSymbolNodes[-1]=e,(0,a.aF)(h)?(e.style.backgroundColor=null,e.style.opacity=null):(e.style.backgroundColor=null!==(l=null===(t=h.color)||void 0===t?void 0:t.toHex())&&void 0!==l?l:"#ffffff",e.style.opacity=null!==(r=null===(i=h.color)||void 0===i?void 0:i.a)&&void 0!==r?r:0))}})),this.renderTextNode({symbol:h,label:p},-1))}renderTextNode(e,t){const{strings:l}=a.s;return(0,i.h)(i.F,null,(0,i.h)("div",{"aria-label":l.panels.chart.accessibility.editLabelFor.replace("${fieldName}",e.label),class:"label text-wrap",slot:"content",tabIndex:0,onClick:e=>{(0,a.l)(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus(),a.s.selectedValue=t},onKeyDown:e=>{(0,a.l)()," "!==e.key&&"Enter"!==e.key||(e.preventDefault(),e.stopPropagation(),e.target.classList.add("hidden"),this.inputNodes[t].classList.remove("hidden"),this.inputNodes[t].setFocus(),a.s.selectedValue=t)},ref:e=>{this.labelNodes[t]=e}},e.label),(0,i.h)("calcite-input",{class:"hidden",slot:"content",tabIndex:0,value:e.label,onFocusout:e=>{const l=e.target;this.handleValueTextChange(t,l.value)},onKeyDown:e=>{if(e.stopPropagation(),"Escape"===e.key||"Enter"===e.key){e.preventDefault();const l=e.currentTarget;this.handleValueTextChange(t,l.value)}},ref:e=>{this.inputNodes[t]=e}}))}renderNullValue(){const{lastDefault:e,layer:t,mapView:l,modules:r,selectedAttribute:o,strings:s}=a.s,n=(0,a.j)(t),d=n.defaultColor||e.defaultColor,c=(0,a.T)(t,l);c.color=new r.esriColor(d),c.outline=void 0;const u=n.defaultLabel||e.defaultLabel,h=(0,a.aF)(c),p={symbol:!0,"symbol-is-white":(0,a.aq)(c)},m={"symbol-icon":!0,selected:-2===o};return(0,i.h)("calcite-list-item",{class:"other-null-list-item"},(0,i.h)("calcite-checkbox",{disabled:h,slot:"actions-start",class:"checkbox",tabIndex:0,checked:!!n.defaultColor&&!h,onClick:()=>this.handleNullValueCheckChange()}),(0,i.h)("div",{class:p,slot:"content-start",role:"button",tabIndex:0,"aria-haspopup":"true","aria-expanded":-2===o,"aria-label":s.panels.chart.accessibility.editSymbolFor.replace("${fieldName}",u),onClick:()=>this.handleValueSymbolClick(-2),onKeyDown:e=>{" "!==e.key&&"Enter"!==e.key||this.handleValueSymbolClick(2)}},(0,i.h)("div",{class:m,tabIndex:0,"aria-hidden":"true",ref:e=>{var t,l,i,a;e&&(this.valueSymbolNodes[-2]=e,h?(e.style.backgroundColor=null,e.style.opacity=null):(e.style.backgroundColor=null!==(l=null===(t=c.color)||void 0===t?void 0:t.toHex())&&void 0!==l?l:"#ffffff",e.style.opacity=null!==(a=null===(i=c.color)||void 0===i?void 0:i.a)&&void 0!==a?a:0))}})),this.renderTextNode({symbol:c,label:u},-2))}renderChartSize(){const{layer:e,mapView:t,strings:l}=a.s,r=(0,a.j)(e);if((0,a.a)(r,"size"))return null;const o=(0,a.a)(r,"size","auto"),s=this.getSizeValue(),n=Math.round(s/.75);return(0,i.h)(i.F,null,(0,i.h)("calcite-label",null,l.panels.chart.chartSize),(0,i.h)("arcgis-smart-mapping-slider-input",{min:10,max:120,values:[n],precision:0,suffixText:l.panels.chart.px,onArcgisSmartMappingSliderInputChange:e=>this.handleChartSizeChange(.75*e.detail)}),(0,i.h)("calcite-label",{scale:"s",layout:"inline"},(0,i.h)("calcite-checkbox",{scale:"s",checked:!!o,onCalciteCheckboxChange:e=>{this.handleAutoSizeChange(e.target.checked?"automatic":"fixed")},ref:e=>{this.adjustSizeNode=e,this.sizeSliderWatchHandle=t.watch("scale",(0,d.d)((()=>(0,i.f)(this.hostElement)),100))}}),l.panels.chart.adjustChartSizeAutomatically))}renderShape(){var e,t;const{layer:l,modules:r,strings:o}=a.s,s=(0,a.j)(l);if(this.shapeSlider){let e={values:[null!==(t=s.holePercentage)&&void 0!==t?t:.5]};this.shapeSlider.set(e)}else{const t={min:0,max:Math.max(.9,s.holePercentage),values:[null!==(e=s.holePercentage)&&void 0!==e?e:.5],precision:1};this.shapeSlider=new r.Slider(t),this.shapeSlider.on("thumb-drag",(e=>{(0,a.j)(l).holePercentage=e.value,(0,a.ab)()})),this.shapeSlider.on("thumb-change",(e=>{(0,a.j)(l).holePercentage=e.value,(0,a.ab)()}))}return(0,i.h)("div",{class:"top-padding"},(0,i.h)("calcite-label",null,o.panels.chart.shape),(0,i.h)("div",{class:"shape-slider slider-bottom-label",ref:e=>{e.style.width="100%",this.shapeSlider&&(this.shapeSlider.container=e)}}),(0,i.h)("div",{class:"slider-labels space-between","aria-hidden":"true"},(0,i.h)("calcite-label",null,o.panels.chart.pie),(0,i.h)("calcite-label",null,o.panels.chart.donut)))}renderMinSlice(){const{layer:e,strings:t}=a.s,l=(0,a.j)(e),{threshold:r=.04}=l.othersCategory;return(0,i.h)("div",{class:"top-padding"},(0,i.h)("div",{class:"space-between"},(0,i.h)("calcite-label",{layout:"inline"},t.panels.chart.grouping),(0,i.h)("calcite-icon",{scale:"s",icon:"information",role:"button",ref:e=>{var i;(0,a.af)(e,`<div>${t.panels.chart.groupingInfo.replace("${other}",(null===(i=l.othersCategory)||void 0===i?void 0:i.label)||t.panels.chart.other)}</div>`,!1)}})),(0,i.h)("arcgis-smart-mapping-slider-input",{disabled:!l.othersCategory,min:0,max:50,values:[Math.round(100*r)],precision:0,prefixText:this.percentLabelFlip?"%":void 0,suffixText:this.percentLabelFlip?void 0:"%",onArcgisSmartMappingSliderInputChange:t=>{(0,a.j)(e).othersCategory.threshold=t.detail/100,(0,a.ab)()}}))}renderBackgroundStyle(){return(0,i.h)("arcgis-smart-mapping-background-symbol",null)}renderDoneButton(){const{strings:e}=a.s;return(0,i.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.arcgisSmartMappingPanelsChartClose.emit("save"),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,i.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>{const{originalRendererJSON:e,originalFeatureReduction:t}=this;(0,a.l)(),(0,a.k)(e,t),this.arcgisSmartMappingPanelsChartClose.emit("cancel")},appearance:"outline-fill",width:"half"},e.cancel)}getSizeByScale(e,t){const l=e.stops,i=l.length-1,a=l[0].value,r=l[i].value;if(t<=a)return l[0].size;if(t>=r)return l[i].size;for(let e=0;e<=i;e++){const i=l[e],a=l[e+1];if(t>=i.value&&t<a.value){const e=a.value-i.value,l=i.size-a.size,r=(t-i.value)/e,o=i.size-l*r;return Math.round(100*o)/100}}return 1}getSizeValue(){const{mapView:e,layer:t}=a.s,l=(0,a.j)(t),i=(0,a.a)(l,"size","auto");if(i){const t=e.scale,l=i.stops;let a=0,r=!1;for(let e=0;e<l.length;e++){const i=l[e];if(t<=i.value){if(r=!0,e>0){let r=l[e-1];const o=(t-r.value)/(i.value-r.value);a=r.size+(i.size-r.size)*o}else a=l[0].size;break}}return r||(a=l[l.length-1].size),a}return l.size}handleAutoSizeChange(e){const{layer:t}=a.s,l=(0,a.j)(t);if("fixed"===e){const e=(0,a.q)(l,"size","auto");(null==e?void 0:e.length)?l.visualVariables=e:l.visualVariables=void 0,(0,a.ab)(),(0,i.f)(this.hostElement)}else(0,o.r)((0,n.a)({sizeOptimizationEnabled:!0}),this.flowItemNode).then((e=>{(0,a.e)(e.renderer,t),(0,a.ab)(),(0,i.f)(this.hostElement)}),(e=>{this.adjustSizeNode.checked=!1,this.arcgisSmartMappingPanelsChartError.emit(e)}))}handleChartSizeChange(e){const{layer:t,mapView:l}=a.s,i=(0,a.j)(t);let r=Math.max(e,.1);const o=(0,a.a)(i,"size","auto");if(o){const e=r/this.getSizeByScale(o,l.scale);this.updateAutoSizeStops(o,e)}else i.size=r;(0,a.ab)()}handleNullValueCheckChange(){const{layer:e,lastDefault:t}=a.s,l=(0,a.j)(e);l.defaultColor?(t.defaultColor=l.defaultColor,l.defaultColor=void 0):l.defaultColor=t.defaultColor,(0,a.ab)(),(0,i.f)(this.hostElement)}handleSortLegend(e){const{layer:t}=a.s,l=(0,a.j)(t),r=l.attributes.map((e=>e.clone())),o=e.map((e=>e.value));r.sort(((e,t)=>o.indexOf(e.field)-o.indexOf(t.field))),l.attributes=r,(0,a.ab)(),(0,i.f)(this.hostElement)}handleValueSymbolClick(e){var t;(null===(t=this.popoverSettings)||void 0===t?void 0:t.popoverNode)?(this.valueSymbolNodes[e].classList.remove("selected"),this.popoverSettings.index===e?((0,a.l)(),this.popoverSettings.popoverNode=null,this.popoverSettings.index=null,this.valueSymbolNodes[e].focus()):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))):(this.popoverSettings.index=e,this.openSymbolStylerForValue(e))}handleValueTextChange(e,t){var l,r;const{lastDefault:o,layer:s,modules:n,strings:d}=a.s,c=(0,a.j)(s),u=n.rendererJsonUtils.fromJSON(this.originalRendererJSON);if(this.inputNodes[e].classList.add("hidden"),!t.length)if(-1===e)t=(null===(l=u.othersCategory)||void 0===l?void 0:l.label)||d.panels.chart.other;else if(-2===e)t=d.panels.chart.noData;else{let l=u.attributes.find((t=>t.field===c.attributes[e].field));t=l.label}-1===e?(c.othersCategory=c.othersCategory||{color:null==o?void 0:o.otherColor,threshold:null!==(r=null==o?void 0:o.threshold)&&void 0!==r?r:0},c.othersCategory.label=t,o.otherLabel=t):-2===e?(c.defaultLabel=t,o.defaultLabel=t):c.attributes=c.attributes.map(((l,i)=>(i===e&&(l.label=t),l))),(0,a.ab)(),(0,i.f)(this.hostElement),this.labelNodes[e].classList.remove("hidden"),this.labelNodes[e].innerHTML=t,this.inputNodes[e].value=t,setTimeout((()=>{a.s.selectedValue===e&&(this.labelNodes[e].focus(),a.s.selectedValue=void 0)}),300)}openSymbolStylerForValue(e){(0,a.l)(),this.popoverSettings.popoverNode=(0,s.c)({referenceElement:this.flowItemNode,heading:a.s.strings.styler.symbolStyle}),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverClose",(()=>{(0,s.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=null,this.valueSymbolNodes[e].classList.remove("selected"),setTimeout((()=>{this.valueSymbolNodes[e].focus()}),100)})),this.popoverSettings.popoverNode.addEventListener("arcgisSmartMappingStylerPopoverDisconnected",(()=>{(0,s.r)(this.popoverSettings.popoverNode),this.popoverSettings.popoverNode=null,this.valueSymbolNodes[e].classList.remove("selected")})),a.s.selectedAttribute=e,(0,s.a)({popoverNode:this.popoverSettings.popoverNode,onChange:()=>{(0,a.ab)(),(0,i.f)(this.hostElement)}}),this.valueSymbolNodes[e].classList.add("selected")}updateAutoSizeStops(e,t){e.stops.forEach((e=>{e.size*=t}))}get hostElement(){return(0,i.d)(this)}};u.style=":host{width:100%}.flow-item{height:100%}.chart-block{overflow-x:hidden}.checkbox{margin:6px}.hidden{display:none}.top-grey-border{border-top:1.5px solid #e0e0e0}.top-padding{margin-top:12px}.label{font-size:var(--calcite-font-size--1);padding-top:5px;padding-bottom:5px}.label:focus,.symbol-icon:focus{outline:2px solid var(--calcite-color-brand)}.selected{outline:1px solid var(--calcite-color-brand)}.other-null-list-item{min-height:45px}.other-symbol{margin-left:27px}.null-value-actions{display:contents}.shape-slider{background-color:transparent;position:relative;width:100%;padding:0 4px}.slider-labels{margin-top:10px}.space-between{display:flex;justify-content:space-between}.symbol-icon{width:19px;height:19px;margin:2px}.symbol-is-white{background-color:#f3f3f3}.text-wrap{overflow-wrap:anywhere}"},37192:(e,t,l)=>{l.d(t,{w:()=>a});var i=l(59503);function a(e,t){const{layer:l,mapView:a,useFeatureReduction:o}=i.s;if(!o||!("featureReduction"in l)||"binning"!==l.featureReduction.type)return;const s=i.s.modules.reactiveUtils.watch((()=>a.scale),(()=>{const o=l.featureReduction;a.scale<=o.maxScale&&!e.disabled?((0,i.l)(),function(e,t){const l=document.createElement("arcgis-smart-mapping-scale-alert-popover");l.refElement=e,l.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",(()=>{r(),t()})),document.body.append(l)}(e,t),(0,i.m)(e,!0)):a.scale>o.maxScale&&e.disabled&&(r(),(0,i.m)(e,!1),e.setFocus())}));return s}function r(){document.querySelectorAll("arcgis-smart-mapping-scale-alert-popover").forEach((e=>{var t;null===(t=e.parentElement)||void 0===t||t.removeChild(e),e=null}))}l(21104),l(2137)},51627:(e,t,l)=>{l.d(t,{a:()=>o,c:()=>r});var i=l(59503),a=(l(21104),l(89393));function r(e){var t;const{layer:l,useFeatureReduction:r,mapView:o,selectedFields:n,modules:d}=i.s,c=l;e=e||{};const u=(0,i.p)((0,i.j)(c)),h=!!(0,a.i)(e.includeSizeVariable)&&e.includeSizeVariable;return d.PieChartCreator.createRenderer({layer:c,view:o,attributes:s(e.fieldInfos),pieChartScheme:e.pieChartScheme||(0,i._)(),includeSizeVariable:h,outlineOptimizationEnabled:(0,a.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!(!(0,i.u)(c)||!h),sizeOptimizationEnabled:!(0,a.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled,legendOptions:e.legendOptions,forBinning:"binning"===(null===(t=c.featureReduction)||void 0===t?void 0:t.type)&&r}).then((e=>{(0,i.o)(u,e.renderer,{notOpacity:!0});const t=(0,i.g)();if(["chart","chart-size"].indexOf(t)>-1){const t=(0,i.h)(c),l=n.map((e=>e.field)),a=t.map((e=>e.field)),r=l.toString()===a.toString(),o=d.esriLang.clone(l),s=d.esriLang.clone(a);o.sort(),s.sort(),o.toString()===s.toString()&&(e.renderer.attributes=(0,i.j)(c).attributes,r||e.renderer.attributes.sort(((e,t)=>l.indexOf(e.field)-l.indexOf(t.field))),e.renderer.othersCategory=(0,i.j)(c).othersCategory,e.renderer.holePercentage=(0,i.j)(c).holePercentage)}return Promise.resolve(e)}),(e=>Promise.reject(e)))}function o(e){var t,l;const{layer:r,useFeatureReduction:o,mapView:n,modules:d}=i.s,c=r;e=e||{};const u=(0,i.j)(c),h=(0,i.a)(u,"size"),p=(0,i.t)(u,"size"),m=(0,i.p)(u);let b,g=e.fieldInfos?e.fieldInfos:u.attributes.map((e=>({field:e.field,simpleFieldType:i.z.NUMBER}))),f=!0;if(e.fieldInfos&&(u.attributes.forEach(((t,l)=>{t.field!==e.fieldInfos[l].field&&(f=!1)})),f&&(delete e.fieldInfos,(0,i.S)(e)))){const e=u.clone();return Promise.resolve({renderer:e})}f&&(b=u.attributes.map((e=>e.field)));const v=(0,i.j)(c),y=(null===(t=v.attributes)||void 0===t?void 0:t.length)?v.attributes[0].color:null,S=u.backgroundFillSymbol;let C=!1;h&&(C=h.minSize.stops?h.minSize.stops[0].size>h.maxSize.stops[0].size:h.minSize>h.maxSize);const z=g[0];return g[0]=g[1],g[1]=z,d.PieChartCreator.createRenderer({layer:c,view:n,attributes:s(g),pieChartScheme:e.pieChartScheme||(0,i._)(),includeSizeVariable:(0,a.i)(e.includeSizeVariable)?e.includeSizeVariable:!!h,outlineOptimizationEnabled:(0,a.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!m.sizeOutlineVisVar,sizeOptimizationEnabled:(0,a.i)(e.sizeOptimizationEnabled)?e.sizeOptimizationEnabled:!!m.sizeAutoVisVar,legendOptions:void 0,forBinning:"binning"===(null===(l=c.featureReduction)||void 0===l?void 0:l.type)&&o}).then((t=>{var l;if(!e.fieldInfos&&h){const e=(0,i.a)(t.renderer,"size");if(e.minDataValue=h.minDataValue,e.maxDataValue=h.maxDataValue,p){const e=(0,i.t)(t.renderer,"size");e.minSliderValue=p.minSliderValue,e.maxSliderValue=p.maxSliderValue}}if(f&&m.opacityVisVar&&m.authOpacityVisVar&&(t.renderer.visualVariables=(0,i.q)(t.renderer,"opacity"),t.renderer.authoringInfo.visualVariables=(0,i.r)(t.renderer,"opacity"),t.renderer.visualVariables.push(m.opacityVisVar),t.renderer.authoringInfo.visualVariables=t.renderer.authoringInfo.visualVariables||[],t.renderer.authoringInfo.visualVariables.push(m.authOpacityVisVar)),(0,i.o)(m,t.renderer,{notOpacity:!0}),b&&t.renderer.attributes.sort(((e,t)=>{const l=b.indexOf(e.field),i=b.indexOf(t.field);return l>-1&&i>-1&&l<i?-1:l>-1&&i>-1&&l>i?1:l>-1?-1:i>-1?1:0})),f&&t.renderer.attributes.forEach(((e,t)=>{e.label=u.attributes[t].label})),t.renderer.size=u.size,t.renderer.holePercentage=u.holePercentage,t.renderer.othersCategory=u.othersCategory,y&&(null===(l=t.renderer.attributes)||void 0===l?void 0:l.length)&&t.renderer.attributes.map(((e,t)=>{f&&(e.color=u.attributes[t].color)})),S&&(t.renderer.backgroundFillSymbol=S),C){const e=(0,i.a)(t.renderer,"size"),l=e.minSize;e.minSize=e.maxSize,e.maxSize=l}return Promise.resolve(t)}),(e=>Promise.reject(e)))}function s(e){return e.map((e=>({field:e.field,label:n(e.field)})))}function n(e){const t=i.s.fields.filter((t=>t.layerField.name===e));return t.length?t[0].label:""}},88703:(e,t,l)=>{l.d(t,{a:()=>d,b:()=>h,c:()=>a,d:()=>i,e:()=>r,f:()=>c,g:()=>p,i:()=>o,m:()=>s,t:()=>n,u:()=>u});const i=(e,t)=>{let l,i="idle";const a=(...a)=>new Promise((r=>{switch(i){case"flushed":i="idle",l?(clearTimeout(l),r(e(...a))):r(null);break;case"invoked":clearTimeout(l),i="idle",r(e(...a));break;case"cancelled":clearTimeout(l),i="idle",r(null);break;default:l&&clearTimeout(l),i="pending",l=setTimeout((()=>(i="idle",r(e(...a)))),t)}}));return a.flush=function(...e){return i="flushed",a(...e)},a.invoke=function(...e){return i="invoked",a(...e)},a.cancel=function(...e){return i="cancelled",a(...e)},a.getStatus=function(){return i},a},a=(e,t)=>{let l;return(...i)=>new Promise((a=>{l||(l=setTimeout((()=>{clearTimeout(l),l=void 0,a(e(...i))}),t))}))};function r(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function o(e){return null!=e}async function s(e,t){return await Promise.all([e,n(t)]),e}function n(e){return new Promise((t=>setTimeout(t,e)))}const d=(e,t)=>Object.fromEntries((e||[]).map((e=>{const{key:l,data:i}=t(e);return[l,i]}))),c=(e,t)=>e.length===t.length&&e.reduce(((e,l)=>e&&t.indexOf(l)>-1),!0);function u(e,t){const l=[],i={};return e.forEach((e=>{const a=t(e);null==i[a]&&(i[a]=e,l.push(e))})),l}function h(e){const t={boolean:{},number:{},string:{}},l=[];return e.filter((e=>{let i=typeof e;return i in t?!t[i].hasOwnProperty(e)&&(t[i][e]=!0):!(l.indexOf(e)>=0)&&l.push(e)}))}const p=(e,t)=>[...Array(Math.ceil(e.length/t))].map(((l,i)=>e.slice(t*i,t+t*i)))},61886:(e,t,l)=>{let i,a;function r(e){e.loading=!1}function o(e,t){return function(e){e.loading=!0,a=!1,i&&clearTimeout(i),i=setTimeout((()=>{r(e),a=!0}),6e4)}(t),e.then((e=>(r(t),a?Promise.reject(new Error("timeout")):Promise.resolve(e)))).catch((e=>(r(t),Promise.reject(e))))}l.d(t,{r:()=>o})}}]);
/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-031b0f.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-031b0f"],{30694:(e,a,r)=>{r.d(a,{a:()=>g,i:()=>p});var t=r(70392),i=r(79233),n=r(46710),l=r(91306),s=r(82669),o=r(17752),c=r(38477),d=r(52299),u=r(70566);const p=async(e,a)=>{var r;const{existingItemType:p,portal:g,existingItemPublishType:m}=a;n.c.initialFolder=null!==(r=await(0,i.d)(e.folderId||e.ownerFolder,e.itemOwner))&&void 0!==r?r:(0,i.e)(e.itemOwner);let y=e.type;"GeoJSON"===y&&(y="GeoJson"),l.i.title=e.title,l.i.categories=e.categories;const f=e.tags;switch(Array.isArray(f)?l.i.tags=f||[]:l.i.tags=(null!=f?f:"").split(","),s.a.id=e.id,s.a.type=y,s.a.fileName=e.name,s.a.existingItem=e,s.a.enablePublishing="tileLayer"!==p,s.a.newItemMode=p,p){case"file":s.a.extension=o.a[y].fileExt[0];break;case"tileLayer":const{id:a,url:r,title:i}=e,[{layers:n,tables:l,serviceInfo:p}]=await Promise.all([(0,d.n)(r,(0,t.g)(g),!0)]),{result:f}=await(0,u.f)({itemId:a,itemUrl:r,publishType:"vectorTiles"===m?"vector":"raster",portal:g,fullLayers:n});if(s.a.sourceTitle=i,s.a.tileLayerPublishType=m,"3dTiles"===s.a.tileLayerPublishType){s.a.tilesLayer3dTilesLayerType=c.D;break}s.a.tileLayerData=f,s.a.tileAutoCreation=!0,s.a.tileLayerBasemapType="standard",s.a.tileLayerBasemapUrl="",s.a.tileLayerFromFeatureLayer=!0,s.a.tileLayerLayers=n,s.a.tileLayerTables=l,s.a.tileLayerServiceInfo=p}},g=e=>{s.a.newItemMode="dataStore",s.a.type="Data Store",(null==e?void 0:e.portal.isPortal)||(s.a.typeKeywords=["Data Store connection"])}},70566:(e,a,r)=>{r.d(a,{a:()=>p,b:()=>f,c:()=>m,d:()=>y,e:()=>b,f:()=>h,g:()=>S,h:()=>u,l:()=>g,p:()=>v});var t=r(46710),i=r(21104),n=r(70392),l=r(38477),s=r(52299),o=r(64209),c=r(12856),d=r(66913);const u=(e,a)=>{let r=!1;return a&&(null==e?void 0:e.length)>0&&(r=!e.some((e=>{return!("Feature Layer"===(a=e).type&&a.drawingInfo&&p(a,!1));var a}))),r};function p(e,a){var r,t;if("esriGeometryMultiPatch"===e.geometryType)return!1;const i=null===(r=e.drawingInfo)||void 0===r?void 0:r.renderer,n=null===(t=e.drawingInfo)||void 0===t?void 0:t.labelingInfo,l=e.fields;return!(g(e)||i&&e.geometryType&&(null==l?void 0:l.length)>0&&!m(i,e.geometryType,l)||!a&&(null==n?void 0:n.length))}const g=e=>{var a,r;const t=null!==(a=e.featureReduction)&&void 0!==a?a:null===(r=e.layerDefinition)||void 0===r?void 0:r.featureReduction;return!!t&&Object.keys(t).length>0},m=(e,a,r)=>{var t;if("heatmap"===e.type)return!1;if("esriGeometryPolygon"===a&&e.uniqueValueInfos&&e.visualVariables&&e.visualVariables.some((e=>{if("sizeInfo"===e.type&&!e.target)return!0})))return!1;const i=r.filter((e=>"esriFieldTypeDate"===e.type)).map((e=>e.name));if(i.length){if(i.indexOf(e.field)>-1||i.indexOf(e.field1)>-1)return!1;if(null===(t=e.visualVariables)||void 0===t?void 0:t.some((e=>i.indexOf(e.field)>-1)))return!1}return!0},y=(e,a,r)=>{const{publishType:t,cacheOnDemand:i,tileInfo:n,cacheOnDemandMinScale:s,scale:c,layers:d}=a,{maxScale:u,minScale:p}=c,g={storageFormat:r||"vectorTiles"===a.publishType?"esriMapCacheStorageModeCompactV2":"esriMapCacheStorageModeExploded",packetSize:128},m=Object.assign(Object.assign({},"vectorTiles"===t?l.p:l.a),n);m.dpi&&!m.preciseDpi&&(m.preciseDpi=m.dpi),m.lods=m.lods.map((e=>function(e,a){var r={};for(var t in e)Object.prototype.hasOwnProperty.call(e,t)&&a.indexOf(t)<0&&(r[t]=e[t]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(t=Object.getOwnPropertySymbols(e);i<t.length;i++)a.indexOf(t[i])<0&&Object.prototype.propertyIsEnumerable.call(e,t[i])&&(r[t[i]]=e[t[i]])}return r}(e,["label"])));const y="vectorTiles"===t?Object.assign({},l.b):Object.assign({},l.c);let f={name:(0,o.a)(e.title),tilingSchema:{tileCacheInfo:m,tileImageInfo:y,cacheStorageInfo:g},minScale:p,maxScale:u};return d&&(f.layers=d.map((({layerDefinition:e,id:a,drawingInfo:r})=>(null==e?void 0:e.drawingInfo)?{id:a,drawingInfo:Object.assign(Object.assign({},r),e.drawingInfo)}:{id:a,drawingInfo:r}))),"vectorTiles"!==t&&(f.cacheOnDemand=i,i&&(f=Object.assign(Object.assign({},f),{capabilities:"Map,ChangeTracking",cacheOnDemandMinScale:s}))),{publishContent:{itemId:e.id,filetype:"featureService",outputType:t,publishParameters:JSON.stringify(f),buildInitialCache:!1},publishParameters:f}},f=async(e,a)=>{if(!e.includes(a?"/VectorTileServer":"/MapServer"))return{error:{code:"invalidUrl"}};try{const t=await(0,d.r)(e,{},{addTokenManually:!1});return t&&t.singleFusedMapCache&&t.tileInfo?{result:(r=t.tileInfo,Object.assign(Object.assign({},r),{lods:(r.lods||[]).map((e=>Object.assign(Object.assign({},e),{label:`1:${Math.round(e.scale).toLocaleString("en-EN",{maximumFractionDigits:0})}`})))}))}:t&&a&&t.tileInfo?{result:t.tileInfo}:{error:{code:"noTilingSchemeFound"}}}catch(e){return console.error(e),{error:{code:"mapServiceError",message:JSON.stringify(e)}}}var r},b=async(e,a,r,t)=>{let n=null,s=l.T;const o={constraints:e,minScale:e.minScale,maxScale:e.maxScale||18055.954822};if(!t)return{maxSupportedMinScale:n,cacheOnDemandMinScale:s,calculatedScale:o};try{const c=await Promise.allSettled(r.map((({id:e})=>(async e=>{try{const[a]=await(0,i.l)(["esri/layers/FeatureLayer"]),r=new a(e),t=await r.addPlugin("esri/plugins/FeatureLayerStatistics");return{result:await t.target.statisticsPlugin.getSuggestedScaleRange({sampleSize:100,forPublishingTiles:!0})}}catch(e){return"string"==typeof e&&e.toLowerCase().includes("sampling returned 0 features")?{result:null,error:null}:(console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}})}})(`${t}/${e}`))));let d=0,u=1/0;c.forEach((e=>{if("rejected"===e.status)return;const a=e.value.result;if(!a)return;const{maxScale:r,minScale:t}=a;d=null==t||t<=d?d:t,u=null==r||r>=u?u:r,s=null==t||t>=s?s:t})),n=e.minScale||l.T,s||(s=d),o.minScale=s||e.minScale,o.maxScale=u||o.maxScale,o.minScale>e.minScale&&e.minScale>0&&(o.minScale=e.minScale),o.maxScale>=o.minScale&&o.minScale>0&&(o.maxScale=((e,a,r)=>{var t,i;if(e<=a&&(null==r?void 0:r.length)>0){let n=-1;for(let a=r.length-1;a>=0;a--)if(e<r[a].scale){n=a+2;break}return n=n>r.length-1?r.length-1:n,null!==(i=null===(t=r[n])||void 0===t?void 0:t.scale)&&void 0!==i?i:a}return a})(o.minScale,o.maxScale,a))}catch(a){console.error(a),o.minScale=e.minScale}return{maxSupportedMinScale:n,cacheOnDemandMinScale:s,calculatedScale:o}},v=async(e,a,r)=>{var i;const{publishType:n,user:l,folder:u,title:p,tags:g,snippet:m,categories:y}=a;let f=Object.assign({},e);if(p){const e=JSON.parse(f.publishParameters);e.name=(0,o.a)(p),f.publishParameters=JSON.stringify(e)}const b=`${l.userContentUrl}/publish`,{services:v}=await(0,d.r)(b,f,{},"post"),{jobId:S,serviceItemId:h,serviceurl:O,error:I,type:w}=v[0]||{};if(I)throw console.error(I),I;return await(0,s.v)(h,{jobId:S,success:!0}),"scenes"!==n&&await(0,c.u)(h,{title:p,tags:g,snippet:m,categories:y}),r&&await(0,c.u)(h,{text:JSON.stringify(r)}),u.id!==(null===(i=t.c.initialFolder)||void 0===i?void 0:i.id)&&await(0,c.m)(h,(0,s.o)(u)?"/":u.id),{id:h,jobId:S,serviceType:w,serviceUrl:O}},S=async e=>{const a=t.c.portal,r=`${(0,n.g)(a)}portals/${a.id}/datastores/getServers`,i={datastoreId:e,f:"json"};try{return{result:(await(0,d.r)(r,i,{},"post")).servers}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}},h=async({itemId:e,itemUrl:a,portal:r,publishType:t,fullLayers:i})=>{try{const n=await(0,c.n)(e,r),l=((null==n?void 0:n.layers)||[]).map(((r,n)=>{var l,s,o,c;if(!r)return null;const d=null!==(l=r.id)&&void 0!==l?l:n;let u=Object.assign(Object.assign({},r),{id:d,layerUrl:`${a}/${d}`,layerItemId:e,layerDefinition:r.layerDefinition});"vector"===t&&delete u.popupInfo,r.popupInfo&&(u=Object.assign(Object.assign({},u),{popupInfo:r.popupInfo})),null!=r.showLegend&&(u=Object.assign(Object.assign({},u),{showLegend:r.showLegend}));const p=i.find((e=>e.id===d));return u=Object.assign(Object.assign({},u),{drawingInfo:Object.assign(Object.assign(Object.assign({},null==p?void 0:p.drawingInfo),r.drawingInfo),{renderer:null!==(o=null===(s=r.drawingInfo)||void 0===s?void 0:s.renderer)&&void 0!==o?o:null===(c=null==p?void 0:p.drawingInfo)||void 0===c?void 0:c.renderer})}),u})).filter((e=>null!=e));return{result:Object.assign(Object.assign({},n),{layers:l})}}catch(e){return console.error(e),{error:{code:"unhandledError",message:JSON.stringify(e)}}}}}}]);
/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-7257bb.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-7257bb"],{47481:(e,i,t)=>{t.r(i),t.d(i,{arcgis_smart_mapping_panels_gallery:()=>M});var s=t(35110),a=t(90527),l=t(59503),n=t(61886),r=(t(21104),t(2137)),o=t(86587),c=t(89393),d=t(50478),p=t(28642),m=t(6216),u=t(75076),g=t(38277),h=t(51627),f=t(51298),y=t(47362),z=t(41565),b=t(70467),v=t(96686);function S(e){var i;const{layer:t,useFeatureReduction:s,mapView:a,modules:n}=l.s,r=t;return e=e||{},n.DotDensityCreator.createRenderer({layer:r,view:a,attributes:(0,c.i)(e.attributes)?e.attributes:(o=e.fieldInfos,o.map((e=>({field:e.field,label:E(e.field)})))),dotBlendingEnabled:!(0,c.i)(e.dotBlendingEnabled)||e.dotBlendingEnabled,dotValueOptimizationEnabled:!(0,c.i)(e.dotValueOptimizationEnabled)||e.dotValueOptimizationEnabled,outlineOptimizationEnabled:!(0,c.i)(e.outlineOptimizationEnabled)||e.outlineOptimizationEnabled,legendOptions:e.legendOptions,forBinning:"binning"===(null===(i=r.featureReduction)||void 0===i?void 0:i.type)&&s});var o}function E(e){const i=l.s.fields.filter((i=>i.layerField.name===e));return i.length?i[0].label:""}function I(e){const{layer:i}=l.s;e=e||{};const t=[],s=[];return t.push(e.fieldInfos[0]),t.push(e.fieldInfos[1]),s.push(e.fieldInfos[2]),function(e){const{layer:i}=l.s;if("relationship"===(0,l.g)()&&void 0===e.normalizationField1&&void 0===e.normalizationField2){const t=(0,l.j)(i).authoringInfo;if(e.fieldInfos&&e.fieldInfos.length>1&&e.fieldInfos[0].field==t.field1.field&&e.fieldInfos[1].field==t.field2.field)return!0}return!1}(e)?F((0,l.j)(i),s,e).then((e=>Promise.resolve({renderer:e})),(e=>Promise.reject(e))):(0,z.c)(Object.assign(Object.assign({},e),{fieldInfos:t})).then((i=>F(i.renderer,s,e).then((e=>(i.renderer=e,Promise.resolve(i))),(e=>Promise.reject(e)))),(e=>Promise.reject(e)))}function F(e,i,t){const{layer:s,modules:a}=l.s;return(0,m.c)(Object.assign(Object.assign({},t),{fieldInfos:i})).then((i=>{const t=i.renderer;e.visualVariables=(0,l.q)(e,"size")||[],e.visualVariables=(0,l.q)(e,"size","auto")||[];const n=(0,l.a)(t,"size");e.visualVariables.push(n),e.authoringInfo.visualVariables=(0,l.r)(e,"size")||[];const r=(0,l.t)(t,"size");if(e.authoringInfo.visualVariables.push(r),(0,l.u)(s)){let i=t.classBreakInfos[0].symbol;const s=[];e.uniqueValueInfos.forEach((e=>{s.push(a.esriLang.clone(e))})),s.forEach((i=>{e.removeUniqueValueInfo(i.value)})),s.forEach((t=>{const s=i.clone();(0,l.v)(s,(0,l.w)(t.symbol)),e.addUniqueValueInfo({value:t.value,symbol:s,label:t.label})})),e.backgroundFillSymbol=t.backgroundFillSymbol;const n=(0,l.a)(t,"size","outline");n&&e.visualVariables.push(n)}return Promise.resolve(e)}),(e=>Promise.reject(e)))}let T;function k(e){T&&clearTimeout(T),T=setTimeout((()=>{T=null,function(e){var i,t;const{selectedFields:s,layer:a,mapImageSublayer:n}=l.s,r="ogc-feature"===a.type,o="wfs"===a.type,b=null===(t=null===(i=a.capabilities)||void 0===i?void 0:i.query)||void 0===t?void 0:t.supportsSqlExpression,E=r||o||b,F=s.map((e=>(0,l.x)(e.field))),T=(0,l.h)(a),k=(0,l.g)();if(!(0,l.y)(s,T))if(0===s.length)e("heatmap"===k?(0,u.c)():(0,d.c)());else if(1===s.length){const i=F[0];if("heatmap"===k&&E&&!s[0].expression&&s[0].simpleFieldType===l.z.NUMBER)e((0,u.c)({fieldInfos:s}));else if("color-size"===k&&(0,l.A)(s[0],T[0]))e((0,p.c)({fieldInfos:s}));else if("type-size"===k&&(0,l.A)(s[0],T[0]))e((0,y.c)({fieldInfos:s}));else if(["color-size","type-size"].indexOf(k)>-1&&(0,l.A)(s[0],T[T.length>1?1:0]))e((0,m.c)({fieldInfos:s}));else if(s[0].expression)s[0].simpleFieldType===l.z.NUMBER?e((0,m.c)({fieldInfos:s})):s[0].simpleFieldType===l.z.DATE?e((0,p.c)({fieldInfos:s})):e((0,y.c)({fieldInfos:s}));else if(i.simpleFieldType===l.z.STRING||"string"===(0,l.B)(i)||"domain"in i.layerField&&i.layerField.domain)e((0,y.c)({fieldInfos:s}));else if(["integer","double","single","small-integer","big-integer"].indexOf((0,l.C)(i.layerField))>-1&&"objectIdField"in a&&a.objectIdField!==i.layerField.name)if((0,l.D)(a))"featureReduction"in a&&a.featureReduction?e((0,p.c)({fieldInfos:s})):e((0,m.c)({fieldInfos:s}));else if((0,l.E)(a))e((0,m.c)({fieldInfos:s}));else{const t=(0,l.B)(i);["integer","small-integer","big-integer"].indexOf((0,l.C)(i.layerField))>-1||(0,c.i)(t)&&"integer"===t?e((0,m.c)({fieldInfos:s})):e((0,p.c)({fieldInfos:s}))}else"date"===(0,l.C)(i.layerField)&&("color-age-size"===k&&(0,l.A)(s[0],T[0])?e((0,p.a)({fieldInfos:s})):["color-size-age","type-size-age"].indexOf(k)>-1&&(0,l.A)(s[0],T[1])?e((0,m.a)({fieldInfos:s})):e(n?(0,p.a)({fieldInfos:s}):(0,p.c)({fieldInfos:s})))}else if(2===s.length){const i=F[0];"type"!==k&&"type-size"!==k||!(0,l.A)(s[0],T[0])?s[0].expression?s[0].simpleFieldType===l.z.NUMBER&&s[1].simpleFieldType===l.z.NUMBER?e((0,m.b)({fieldInfos:s})):e((0,v.c)({fieldInfos:s})):s[0].simpleFieldType===l.z.STRING||"string"===(0,l.B)(i)||"domain"in i.layerField&&i.layerField.domain?s[1].simpleFieldType===l.z.DATE&&(["color-size-age","type-size-age"].indexOf(k)>-1||n)?e((0,v.a)({fieldInfos:s})):e((0,v.c)({fieldInfos:s})):s[0].simpleFieldType===l.z.DATE||s[1].simpleFieldType===l.z.DATE?s[0].simpleFieldType===l.z.DATE&&(["color-age","color-age-size"].indexOf(k)>-1||n)?e((0,m.d)({fieldInfos:s})):s[1].simpleFieldType===l.z.DATE&&(["color-size-age","type-size-age"].indexOf(k)>-1||n)?e((0,m.e)({fieldInfos:s})):e((0,m.b)({fieldInfos:s})):s[0].expression||s[1].expression?e((0,m.b)({fieldInfos:s})):"dot-density"===k?e(S({fieldInfos:s})):"predominance"===k?e((0,g.c)({fieldInfos:s})):"predominance-size"===k?e((0,g.c)({fieldInfos:s,includeSizeVariable:!0})):"chart"===k?e((0,h.c)({fieldInfos:s})):"chart-size"===k?e((0,h.c)({fieldInfos:s,includeSizeVariable:!0})):"compare"===k?e((0,f.c)({fieldInfos:s})):["relationship","relationship-size"].indexOf(k)>-1?e((0,z.c)({fieldInfos:s})):e((0,m.b)({fieldInfos:s})):e((0,v.c)({fieldInfos:s}))}else 3===s.length&&(["relationship","relationship-size"].indexOf(k)>-1||s[2].expression||!E)?e(I({fieldInfos:s})):"dot-density"===k&&s.length<=8?e(S({fieldInfos:s})):"predominance-size"===k?e((0,g.c)({fieldInfos:s,includeSizeVariable:!0})):"chart"===k?e((0,h.c)({fieldInfos:s,includeSizeVariable:!1})):"chart-size"===k?e((0,h.c)({fieldInfos:s,includeSizeVariable:!0})):n&&!E||s[2].simpleFieldType===l.z.DATE?e(I({fieldInfos:s})):e((0,g.c)({fieldInfos:s}))}(e)}),1e3)}t(1984),t(63280),t(23505),t(73838);const M=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingPanelsGalleryClose=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryClose",7),this.arcgisSmartMappingPanelsGalleryError=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryError",7),this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate=(0,s.c)(this,"arcgisSmartMappingPanelsGalleryClusterRequiresUpdate",7),this.tileNodes=[],this.lastSortBy=r.L.default,this.addExpression=async()=>{(0,l.l)();try{const e=await(0,a.u)();e.simpleFieldType===l.z.UNKNOWN&&(e.simpleFieldType=l.z.NUMBER);const{selectedFields:i,modules:t,strings:s}=l.s;if(2===i.length&&(null==e?void 0:e.simpleFieldType)===l.z.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:s.panels.gallery.errors.expressionMustBeNumber,type:"warning"});if(1===i.length&&i[0].simpleFieldType===l.z.STRING&&(null==e?void 0:e.simpleFieldType)===l.z.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:s.panels.gallery.errors.expressionMustBeNumber,type:"warning"});const n=t.esriLang.clone(i);if(n.push(e),3===n.length)for(let e=0;e<3;e++){const i=n[e];if(i.simpleFieldType===l.z.DATE&&2!==e){n.splice(e,1),n.splice(2,0,i);break}}n.length>1&&n[1].simpleFieldType===l.z.STRING&&n.reverse(),l.s.selectedFields=n,k(this.galleryRequestWrapper)}catch(e){this.addExpressionButtonNode.setFocus()}},this.handleArcadeEdit=async e=>{(0,l.l)();try{const{selectedFields:i,strings:t}=l.s,n=await(0,a.u)(i[e]);if(n.simpleFieldType===l.z.UNKNOWN&&(n.simpleFieldType=l.z.NUMBER),0!==e&&(null==n?void 0:n.simpleFieldType)===l.z.STRING&&i[0].simpleFieldType===l.z.STRING)return void this.arcgisSmartMappingPanelsGalleryError.emit({message:t.panels.gallery.errors.expressionMustBeNumber,type:"warning"});"string"===n.simpleFieldType?(i.splice(e,1),i.unshift(n),(0,s.f)(this.hostElement)):i[e]=n,l.s.selectedFields=i,k(this.galleryRequestWrapper)}catch(e){this.addExpressionButtonNode.setFocus()}},this.handleListOrderChange=e=>{const{selectedFields:i,modules:t}=l.s,s=[];e.target.querySelectorAll("calcite-list-item").forEach((e=>{s.push(t.esriLang.clone(i[parseInt(e.value)]))})),l.s.selectedFields=s,k(this.galleryRequestWrapper)},this.handleListChange=e=>{const{selectedFields:i}=l.s;i[e].expression?this.handleArcadeEdit(e):this.openFieldPickList(!0,e)},this.handleRemoveAttribute=e=>{this.modifyFieldPickList=!0;const{selectedFields:i}=l.s;l.s.selectedFields=null==i?void 0:i.filter(((i,t)=>t!==e)),k(this.galleryRequestWrapper)},this.handleSelectClick=e=>{!function(e,i){const{selectedFields:t}=l.s;switch(e){case"simple":l.s.selectedFields=[],i((0,d.c)());break;case"type":i((0,y.c)({fieldInfos:t}));break;case"color":i((0,p.c)({fieldInfos:t}));break;case"size":i((0,m.c)({fieldInfos:t}));break;case"color-age":i((0,p.a)({fieldInfos:t}));break;case"size-age":i((0,m.a)({fieldInfos:t}));break;case"dot-density":i(S({fieldInfos:t}));break;case"heatmap":i((0,u.c)({fieldInfos:t}));break;case"compare":i((0,f.c)({fieldInfos:t}));break;case"relationship":i((0,z.c)({fieldInfos:t}));break;case"relationship-size":i(I({fieldInfos:t}));break;case"predominance":i((0,g.c)({fieldInfos:t}));break;case"predominance-size":i((0,g.c)({fieldInfos:t,includeSizeVariable:!0}));break;case"chart":i((0,h.c)({fieldInfos:t}));break;case"chart-size":i((0,h.c)({fieldInfos:t,includeSizeVariable:!0}));break;case"type-size":i((0,v.c)({fieldInfos:t}));break;case"type-size-age":i((0,v.a)({fieldInfos:t}));break;case"color-size":1===t.length?i((0,b.c)({fieldInfos:t})):i((0,m.b)({fieldInfos:t}));break;case"color-age-size":i((0,m.d)({fieldInfos:t}));break;case"color-size-age":i((0,m.e)({fieldInfos:t}))}}(e,this.galleryRequestWrapper)},this.handleOptionsClick=e=>{const{selectedFields:i}=l.s;switch(e){case"simple":{const e=document.createElement("arcgis-smart-mapping-panels-simple");e.addEventListener("arcgisSmartMappingPanelsSimpleClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSimpleBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsSimpleError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"color":case"color-age":{const e=document.createElement("arcgis-smart-mapping-panels-color");e.addEventListener("arcgisSmartMappingPanelsColorClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"size":case"size-age":{const e=document.createElement("arcgis-smart-mapping-panels-size");e.addEventListener("arcgisSmartMappingPanelsSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSizeBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"type":{const e=document.createElement("arcgis-smart-mapping-panels-type");e.addEventListener("arcgisSmartMappingPanelsTypeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsTypeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsTypeClusterRequiresUpdate",(()=>{this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()})),e.addEventListener("onArcgisSmartMappingPanelsTypeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"compare":{const e=document.createElement("arcgis-smart-mapping-panels-compare");e.addEventListener("arcgisSmartMappingPanelsCompareClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsCompareBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsCompareError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"heatmap":{const e=document.createElement("arcgis-smart-mapping-panels-heatmap");e.addEventListener("arcgisSmartMappingPanelsHeatmapClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsHeatmapBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsHeatmapError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"predominance":{const e=document.createElement("arcgis-smart-mapping-panels-predominance");e.addEventListener("arcgisSmartMappingPanelsPredominanceClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsPredominanceBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsPredominanceError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"chart":{const e=document.createElement("arcgis-smart-mapping-panels-chart");e.addEventListener("arcgisSmartMappingPanelsChartClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsChartBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsChartError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"relationship":{const e=document.createElement("arcgis-smart-mapping-panels-relationship");e.addEventListener("arcgisSmartMappingPanelsRelationshipClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsRelationshipBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsRelationshipError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"dot-density":{const e=document.createElement("arcgis-smart-mapping-panels-dot-density");e.addEventListener("arcgisSmartMappingPanelsDotDensityClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsDotDensityBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsDotDensityError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"color-size":case"color-age-size":case"color-size-age":if(i.length>1){const e=document.createElement("arcgis-smart-mapping-panels-color-size");e.addEventListener("arcgisSmartMappingPanelsColorSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsColorSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e)}else{const e=document.createElement("arcgis-smart-mapping-panels-color-size-univariate");e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateBackClick",(()=>{(0,s.f)(this.hostElement),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsColorSizeUnivariateError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e)}break;case"type-size":case"type-size-age":{const e=document.createElement("arcgis-smart-mapping-panels-type-size");e.addEventListener("arcgisSmartMappingPanelsTypeSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsTypeSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsTypeSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"predominance-size":{const e=document.createElement("arcgis-smart-mapping-panels-predominance-size");e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsPredominanceSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"chart-size":{const e=document.createElement("arcgis-smart-mapping-panels-chart-size");e.addEventListener("arcgisSmartMappingPanelsChartSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsChartSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsChartSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}case"relationship-size":{const e=document.createElement("arcgis-smart-mapping-panels-relationship-size");e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeClose",(()=>{this.removeFlowItem(e),this.focusSelectedTile()})),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeBackClick",(()=>this.focusSelectedTile())),e.addEventListener("arcgisSmartMappingPanelsRelationshipSizeError",(({detail:e})=>this.arcgisSmartMappingPanelsGalleryError.emit(e))),this.appendFlowItem(e);break}}},this.handleDone=()=>{this.arcgisSmartMappingPanelsGalleryClose.emit("save")},this.handleCancel=()=>{const{originalRendererJSON:e,originalFeatureReduction:i}=this;(0,l.k)(e,i),this.arcgisSmartMappingPanelsGalleryClose.emit("cancel")},this.galleryRequestWrapper=e=>{const{strings:i}=l.s;(0,n.r)(e,this.flowItemNode).then((e=>{var i;const{layer:t,mapImageSublayer:a}=l.s;(0,l.e)(e.renderer.clone(),t),a&&(a.renderer=e.renderer),(0,s.f)(this.hostElement),"featureReduction"in t&&"cluster"===(null===(i=t.featureReduction)||void 0===i?void 0:i.type)&&(this.checkCluster(),this.checkClusterRenderer()),this.focusSelectedTile()}),(()=>{this.arcgisSmartMappingPanelsGalleryError.emit({message:i.panels.gallery.errors.changeRendererErrorMsg,type:"warning"})}))},this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){const{layer:e,modules:i}=l.s,t=(0,l.j)(e);this.originalRendererJSON=t.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?i.esriLang.clone(e.featureReduction):void 0,this.flowNode=(0,l.f)(this.hostElement,"calcite-flow")}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()}))}render(){var e,i,t,a;const{layer:n,useFeatureReduction:r,hideLayerTitle:c,isRTL:d,strings:p}=l.s,m=r?p.panels.gallery.binStyles:"featureReduction"in n&&"cluster"===(null===(e=n.featureReduction)||void 0===e?void 0:e.type)?p.panels.gallery.clusterStyles:p.panels.gallery.styles;let u=!1;if("featureReduction"in n&&"cluster"===(null===(i=n.featureReduction)||void 0===i?void 0:i.type)){const e=n.featureReduction;"pie-chart"!==(null===(t=e.renderer)||void 0===t?void 0:t.type)||(null===(a=e.renderer.authoringInfo)||void 0===a?void 0:a.isAutoGenerated)||(u=!0)}return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{heading:m,description:c?void 0:n.title,class:{"flow-item":!0,[o.C.rtl]:d},closable:(0,l.H)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:this.handleDone,onCalciteFlowItemBack:this.handleDone,ref:e=>this.flowItemNode=e},u?this.renderClusteringWarning():this.renderGalleryContent()))}renderGalleryContent(){return(0,s.h)(s.F,null,this.renderDoneButton(),this.renderCancelButton(),this.renderStepOne(),this.renderStepTwo())}renderClusteringWarning(){const{strings:e}=l.s;return(0,s.h)(s.F,null,(0,s.h)("div",null,(0,s.h)("calcite-tip",{closeDisabled:!0},(0,s.h)("div",null,e.panels.gallery.chartClusterMsg))),(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:this.handleCancel,appearance:"outline-fill",width:"full"},e.done))}renderDoneButton(){const{layer:e,strings:i}=l.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:i.done,onClick:this.handleDone,appearance:"solid",width:"half"},i.done):null}renderCancelButton(){const{layer:e,strings:i}=l.s;return e?(0,s.h)("calcite-button",{slot:"footer",label:i.cancel,onClick:this.handleCancel,appearance:"outline-fill",width:"half"},i.cancel):null}renderStepOne(){const{layer:e,selectedFields:i,strings:t}=l.s,a=i.length,n=(0,l.F)().string>0,r=3===a&&i[2].expression,o=3===a&&i[2].simpleFieldType===l.z.DATE;let c=i.map(((e,i)=>this.renderAttribute(i)));const d=a>1&&!n&&!r&&!o;return(0,s.h)("div",{class:"attributes gallery-block"},(0,s.h)("div",null,(0,s.h)("div",{class:"center"},(0,s.h)("calcite-icon",{class:"number-icon",scale:"m",icon:"number-circle-1"})),(0,s.h)("div",{class:"attributes-header-text center"},t.panels.gallery.chooseAttributes)),!a&&(0,s.h)("div",{class:"attributes-msg center"},t.panels.gallery.chooseAttributesMsg),(0,s.h)("calcite-list",{class:c.length>0?"attribute-list":"",key:`gallery-attributes-selects-${i}`,dragEnabled:d,onCalciteListOrderChange:this.handleListOrderChange},c),e&&this.renderAddButtons(),e&&this.renderTip())}renderAttribute(e){const{selectedFields:i,strings:t}=l.s,a=i[e].field||i[e].expressionTitle,n=!!i[e].expression,r=(0,l.x)(i[e].field),o=r?r.label:i[e].expressionTitle,c=i[e].simpleFieldType,d=!n&&(c===l.z.NUMBER?"number":c===l.z.STRING?"date-only"===(0,l.C)(null==r?void 0:r.layerField)?"calendar":"string":c===l.z.DATE?"date-time":null);return(0,s.h)("calcite-list-item",{key:`gallery-attribute-${e}-${a}`,label:o,value:e,onClick:i=>i.target&&this.handleListChange(e),onKeyDown:i=>{" "===i.key&&(i.preventDefault(),this.handleListChange(e))}},d&&(0,s.h)("div",{slot:"actions-end"},(0,s.h)("calcite-icon",{scale:"s",icon:d,class:"field-type"})),(0,s.h)("calcite-action",{key:`gallery-attribute-${e}-${a}-remove`,slot:"actions-end",text:n?t.panels.gallery.removeExpression:t.panels.gallery.removeField,label:n?t.panels.gallery.removeExpression:t.panels.gallery.removeField,onClick:i=>{i.stopPropagation(),this.handleRemoveAttribute(e)},onKeyDown:i=>{"Enter"!==i.key&&" "!==i.key||(i.stopPropagation(),this.handleRemoveAttribute(e))}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))}renderTip(){var e;const{selectedFields:i,portal:t,strings:a}=l.s;if(i.length>1)return;if(!i.length&&(0,l.I)(l.O.ARCGIS_COMPONENT_NOTIFICATIONS,l.N.SMART_MAPPING_TIP1_DISMISSED)||1===i.length&&(0,l.I)(l.O.ARCGIS_COMPONENT_NOTIFICATIONS,l.N.SMART_MAPPING_TIP2_DISMISSED))return null;const n=a.panels.gallery.tip1.indexOf("${smartMappingLink}"),r=(null===(e=t.helpMap)||void 0===e?void 0:e.m)||t.helpMap;return(0,s.h)("div",{key:"gallery-tip",class:"tip"},(0,s.h)("calcite-input-message",{key:"gallery-tip-message",icon:"lightbulb",class:"tip-message"},0===i.length&&t.helpBase&&r?(0,s.h)("div",{key:"gallery-tip-text"},(0,s.h)("span",{class:"tip-text"},a.panels.gallery.tip1.substring(0,n)),(0,s.h)("calcite-link",{target:"_blank",href:`${t.helpBase}${r[120003249]}`},a.panels.gallery.tip1Link),(0,s.h)("span",{class:"tip-text"},a.panels.gallery.tip1.substring(n+19))):0===i.length?(0,s.h)("span",{key:"gallery-tip-text",class:"tip-text"},a.panels.gallery.tip1.replace("${smartMappingLink}",a.panels.gallery.tip1Link)," "):(0,s.h)("span",{key:"gallery-tip-text",class:"tip-text"},a.panels.gallery.tip2)),(0,s.h)("calcite-action",{scale:"s",label:a.close,text:a.close,onClick:()=>{const{selectedFields:e}=l.s;e.length?(0,l.J)(l.O.ARCGIS_COMPONENT_NOTIFICATIONS,{key:l.N.SMART_MAPPING_TIP2_DISMISSED,value:"true"}):(0,l.J)(l.O.ARCGIS_COMPONENT_NOTIFICATIONS,{key:l.N.SMART_MAPPING_TIP1_DISMISSED,value:"true"}),(0,s.f)(this.hostElement)}},(0,s.h)("calcite-icon",{scale:"s",icon:"x"})))}renderAddButtons(){var e,i;const{layer:t,useFeatureReduction:a,mapImageSublayer:n,selectedFields:r,strings:o,supportsArcade:c}=l.s,d=r.length,p=(0,l.K)(),m=(0,l.F)(),u=m.string>0,g=m.date>0,h=m.expression>0,f=null===(i=null===(e=t.capabilities)||void 0===e?void 0:e.query)||void 0===i?void 0:i.supportsSqlExpression;let y=!(n&&!c&&1===d||!(d<10)||2===d&&(u||h)||n&&2===d&&g||3===d&&(g||r[2].expression||!f));y=y&&(1===m.string&&m.number+m.date===0&&p.number+p.date>0||0===m.string&&m.date<2&&m.number+m.date<3&&m.string+m.number+m.date<p.string+p.number+p.date||m.number>=2&&m.number<p.number);const z=(!n||c)&&(d<2||2===d&&!h&&r[0].simpleFieldType===l.z.NUMBER&&r[1].simpleFieldType===l.z.NUMBER);return(0,s.h)("div",{class:"add-button-div"},(0,s.h)("div",{class:"add-buttons"},(0,s.h)("calcite-button",{disabled:!y,onClick:()=>this.openFieldPickList(),appearance:"outline-fill",kind:"neutral",width:"full",label:o.panels.gallery.addField,iconStart:"plus",class:"attributes-add-new",ref:e=>this.addFieldButtonNode=e},o.panels.gallery.field),a||"oriented-imagery"===t.type?null:(0,s.h)(s.F,null,(0,s.h)("span",null,"  "),(0,s.h)("calcite-button",{disabled:!z,onClick:this.addExpression,appearance:"outline-fill",kind:"neutral",width:"full",label:o.panels.gallery.addExpression,iconStart:"plus",class:"attributes-add-new",ref:e=>this.addExpressionButtonNode=e},o.expression))))}renderStepTwo(){const{selectedFields:e,strings:i}=l.s,t=function(){var e,i;const{layer:t,useFeatureReduction:s,mapImageSublayer:a,selectedFields:n,supportsArcade:r}=l.s,o="ogc-feature"===t.type,c="wfs"===t.type,d="stream"===t.type,p="featureReduction"in t&&t.featureReduction,m=n.length,u=(0,l.F)(),g=u.string>0,h=u.date>0,f=u.expression>0,y=null===(i=null===(e=t.capabilities)||void 0===e?void 0:e.query)||void 0===i?void 0:i.supportsSqlExpression,z=o||c||d||y,b=[];return b.push("simple"),1!==m||g||a&&h||b.push("color"),1!==m||g||a&&h||b.push("size"),a&&!r||1!==m||!h||f||!z||b.push("color-age"),a&&!r||1!==m||!h||f||!z||b.push("size-age"),a&&!r||1!==m&&2!==m||g||a&&h||b.push("color-size"),a&&!r||2!==m||g||!h||n[0].simpleFieldType!==l.z.DATE||n[0].expression||!z||a&&u.date>1||b.push("color-age-size"),a&&!r||2!==m||g||!h||n[1].simpleFieldType!==l.z.DATE||n[1].expression||!z||a&&u.date>1||b.push("color-size-age"),(!a||r)&&m>0&&m<=8&&!f&&(0,l.u)(t)&&!g&&!h&&z&&b.push("dot-density"),(!a||r)&&m>1&&m<=10&&!f&&!g&&!h&&z&&b.push("predominance"),a&&!r||!(m>1)||f||g||h||!z||b.push("predominance-size"),!a&&(!p||"binning"===(null==p?void 0:p.type)&&!s)&&m>1&&m<=10&&!f&&["polygon","point","multipoint"].indexOf((0,l.G)(t))>-1&&!g&&!h&&z&&b.push("chart"),!a&&(!p||"binning"===(null==p?void 0:p.type)&&!s)&&m>1&&!f&&["polygon","point","multipoint"].indexOf((0,l.G)(t))>-1&&!g&&!h&&z&&b.push("chart-size"),a&&!r||2!==m||f||g||h||b.push("relationship"),a&&!r||3!==m||f&&(1!==u.expression||!n[2].expression)||a&&h||b.push("relationship-size"),a&&!r||2!==m||f||g||h||b.push("compare"),1!==m||a&&h||b.push("type"),a&&!r||2!==m||!(u.date<2)||a&&h||b.push("type-size"),(!a||r)&&2===m&&h&&u.date<2&&n[1].simpleFieldType===l.z.DATE&&n[1].field&&z&&b.push("type-size-age"),a&&!r||!(["point","multipoint"].indexOf((0,l.G)(t))>-1)||p&&("binning"!==(null==p?void 0:p.type)||s)||!(z&&m<=1||!z&&0===m)||g||h||0!==u.expression||b.push("heatmap"),b}(),a=function(){const{layer:e}=l.s,i=(0,l.g)(),t=(0,l.h)(e),s=t.length>0?t[0].simpleFieldType:null;let a=[];switch(i){case"simple":a=["simple","color","size","color-age","size-age","color-size","type","heatmap","dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"];break;case"type":a=["type","color","size","color-age","size-age","color-size","dot-density","heatmap","simple","type-size","type-size-age","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","compare","relationship","relationship-size"];break;case"color":a=["color","size","color-age","size-age","color-size","dot-density"],a="string"===s||"date"===s?a.concat(["type","heatmap","simple"]):a.concat(["heatmap","simple","type"]),a=a.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"color-age":a=["color-age","color","size","size-age","color-size","dot-density"],a="string"===s||"date"===s?a.concat(["type","heatmap","simple"]):a.concat(["heatmap","simple","type"]),a=a.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size":a=["size","size-age","color","color-age","color-size","dot-density"],a="string"===s||"date"===s?a.concat(["type","heatmap","simple"]):a.concat(["heatmap","simple","type"]),a=a.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"size-age":a=["size-age","size","color-age","color","color-size","dot-density"],a="string"===s||"date"===s?a.concat(["type","heatmap","simple"]):a.concat(["heatmap","simple","type"]),a=a.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"heatmap":a=["heatmap","color","size","color-age","size-age","color-size","dot-density"],a="string"===s?a.concat(["type","simple"]):a.concat(["simple","type"]),a=a.concat(["predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"]);break;case"predominance":a=["predominance","predominance-size","chart","chart-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],a="string"===s?a.concat(["type","simple"]):a.concat(["simple","type"]);break;case"chart":a=["chart","chart-size","predominance","predominance-size","color-size","color-age-size","color-size-age","dot-density","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],a="string"===s?a.concat(["type","simple"]):a.concat(["simple","type"]);break;case"dot-density":a=["dot-density","color-size","color-age-size","color-size-age","predominance","predominance-size","chart","chart-size","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],a="string"===s?a.concat(["type","simple"]):a.concat(["simple","type"]);break;case"compare":a=["compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===s&&(a=a.concat(["type"])),a=a.concat(["simple"]),s&&"string"===s||(a=a.concat(["type"]));break;case"relationship":a=["relationship","relationship-size","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===s&&(a=a.concat(["type"])),a=a.concat(["simple"]),s&&"string"===s||(a=a.concat(["type"]));break;case"color-size":a=["color-size","color-age-size","color-size-age","color","size","color-age","size-age","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","type","heatmap","simple"];break;case"color-age-size":a=["color-age-size","color-size-age","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"color-size-age":a=["color-size-age","color-age-size","color-size","compare","dot-density","predominance","predominance-size","chart","chart-size","relationship","relationship-size","type-size","type-size-age","color","color-age","size","size-age","simple","type","heatmap"];break;case"type-size":a=["type-size","type-size-age","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type","size","simple","color","color-age","size-age","heatmap","compare","relationship","relationship-size"];break;case"type-size-age":a=["type-size-age","type-size","color-age-size","color-size-age","color-size","dot-density","predominance","predominance-size","chart","chart-size","type","size","size-age","simple","color","color-age","heatmap","compare","relationship","relationship-size"];break;case"predominance-size":a=["predominance-size","predominance","chart-size","chart","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],a="string"===s?a.concat(["type","simple"]):a.concat(["simple","type"]);break;case"chart-size":a=["chart-size","chart","predominance-size","predominance","dot-density","color-size","color-age-size","color-size-age","compare","relationship","relationship-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],a="string"===s?a.concat(["type","simple"]):a.concat(["simple","type"]);break;case"relationship-size":a=["relationship-size","relationship","compare","color-size","color-age-size","color-size-age","dot-density","predominance","predominance-size","chart","chart-size","type-size","type-size-age","heatmap","color","size","color-age","size-age"],"string"===s&&(a=a.concat(["type"])),a=a.concat(["simple"]),"string"!==s&&(a=a.concat(["type"]));break;default:a=["color","size","color-age","size-age","color-size"],"string"===s&&(a=a.concat(["type"])),a=a.concat(["heatmap","simple"]),"string"!==s&&(a=a.concat(["type"])),a=a.concat(["dot-density","predominance","predominance-size","chart","chart-size","color-age-size","color-size-age","type-size","type-size-age","compare","relationship","relationship-size"])}return a}(),n=(null==e?void 0:e.length)?1===e.length&&e[0].field&&e[0].simpleFieldType===l.z.NUMBER?i.panels.gallery.styleMsg.oneNumber:2===e.length&&e[0].field&&e[1].field&&e[0].simpleFieldType===l.z.NUMBER&&e[1].simpleFieldType===l.z.NUMBER?i.panels.gallery.styleMsg.multipleNumber:i.panels.gallery.styleMsg.any:i.panels.gallery.styleMsg.empty;t.sort(((e,i)=>a.indexOf(e)-a.indexOf(i)));const r=t.map(((e,i)=>this.renderStyleTile(e,i)));return(0,s.h)("div",{class:"gallery-block"},(0,s.h)("div",{class:"attributes-header"},(0,s.h)("div",{class:"center"},(0,s.h)("calcite-icon",{class:"number-icon",scale:"m",icon:"number-circle-2"})),(0,s.h)("div",{class:"styles-msg-title center"},i.panels.gallery.pickStyle),(0,s.h)("div",{class:"styles-msg center"},n)),r)}renderStyleTile(e,i){var t,a;const{selectedFields:n}=l.s,r=(0,l.g)(),o=(0,l.L)(),c=`${(null===(t=null==n?void 0:n[0])||void 0===t?void 0:t.simpleFieldType)===l.z.DATE}\n        ${(null===(a=null==n?void 0:n[1])||void 0===a?void 0:a.simpleFieldType)===l.z.DATE}`;return(0,s.h)("arcgis-smart-mapping-tile",{key:`tile-${e}-${o}-${c}`,tileType:"gallery",type:e,selected:e===r,ref:e=>{e&&(this.tileNodes[i]=e)},onArcgisSmartMappingTileSelect:()=>this.handleSelectClick(e),onArcgisSmartMappingTileOptions:()=>this.handleOptionsClick(e),onArcgisSmartMappingTileError:e=>this.arcgisSmartMappingPanelsGalleryError.emit(e.detail)})}addField(e){const{selectedFields:i,modules:t}=l.s;(0,l.M)(e);const s=t.esriLang.clone(i);if(e.forEach((e=>{const i=(0,l.x)(e);i.simpleFieldType===l.z.STRING?s.unshift({field:e,simpleFieldType:l.z.STRING}):s.push({field:e,simpleFieldType:i.simpleFieldType})})),3===s.length)for(let e=0;e<3;e++){const i=s[e];if(i.simpleFieldType===l.z.DATE&&2!==e){s.splice(e,1),s.splice(2,0,i);break}}(0,l.y)(i,s)||(l.s.selectedFields=s,k(this.galleryRequestWrapper))}editAttribute(e,i){const{selectedFields:t,modules:s}=l.s;(0,l.M)(e);const a=s.esriLang.clone(t);e.forEach((e=>{const s=(0,l.x)(e);"string"===s.simpleFieldType?(t.splice(i,1),t.unshift({field:e,simpleFieldType:l.z.STRING})):t[i]={field:e,simpleFieldType:s.simpleFieldType}})),(0,l.y)(t,a)||(l.s.selectedFields=t,k(this.galleryRequestWrapper))}appendFlowItem(e){const{flowNode:i}=this,t=(0,l.f)(this.hostElement,"arcgis-smart-mapping");(0,l.H)(this.hostElement)?i.appendChild(e):t.appendChild(e)}removeFlowItem(e){const{flowNode:i}=this,t=(0,l.f)(this.hostElement,"arcgis-smart-mapping");(0,l.H)(this.hostElement)?i.removeChild(e):t.removeChild(e)}checkCluster(){const{layer:e}=l.s;"featureReduction"in e&&e.featureReduction&&this.arcgisSmartMappingPanelsGalleryClusterRequiresUpdate.emit()}checkClusterRenderer(){var e;const{layer:i}=l.s;if("featureReduction"in i&&"cluster"===(null===(e=i.featureReduction)||void 0===e?void 0:e.type)){const e=i.featureReduction;e.renderer=null,i.featureReduction=e.clone()}}openFieldPickList(e=!1,i=null){(0,l.l)();const{fields:t,selectedFields:s}=l.s;let a,n=s.map((e=>e.field));a=t.filter((t=>{let s=!n.includes(t.layerField.name);return e&&(s=s||t.layerField.name===n[i]),s}));const r=document.createElement("arcgis-smart-mapping-field-pick-list");r.fields=a,r.popoverProps={refElement:this.flowItemNode,placement:"leading",offsetDistance:0,popoverWidth:1.05*this.flowItemNode.getBoundingClientRect().width,overlayPositioning:"absolute",flipDisabled:!1,triggerDisabled:!0},r.singleEditMode=e,r.fieldToReplace=e?s[i]:null,r.lastSortBy=this.lastSortBy,document.body.appendChild(r),(0,l.m)(this.flowItemNode,!0),r.addEventListener("arcgisSmartMappingFieldPickListClose",(t=>{var s;this.modifyFieldPickList=!0,document.body.removeChild(r),(0,l.m)(this.flowItemNode,!1),(null===(s=t.detail)||void 0===s?void 0:s.selectedFields)&&(e?this.editAttribute(t.detail.selectedFields,i):this.addField(t.detail.selectedFields)),this.addFieldButtonNode.setFocus()})),r.addEventListener("arcgisSmartMappingFieldPickListSortByChange",(e=>{this.lastSortBy=e.detail}))}focusSelectedTile(){setTimeout((()=>requestAnimationFrame((()=>{var e;return null===(e=this.tileNodes[0])||void 0===e?void 0:e.setFocus()}))),300)}get hostElement(){return(0,s.d)(this)}};M.style=":host{width:100%}.flow-item{height:100%}.add-button-div{margin:0 3px}.add-buttons{display:flex;flex-direction:row;justify-content:space-between;background-color:#ffffff}.attributes{padding:6px 6px 0 6px;background-color:#ffffff}.attributes-header-text{font-weight:bold;font-size:16px;padding:10px 0}.attributes-msg{font-size:var(--calcite-font-size--2)}.attributes-add-new{margin-top:10px}.tip{margin-top:15px;display:flex;justify-content:space-between}.tip-message{justify-content:center}.tip-text{color:#3d5f1d}.tip-close{margin-top:4px}.field-type{display:flex;align-items:center;height:100%;color:var(--calcite-color-text-1)}.attribute-list{border-bottom:1px solid #e0e0e0}.gallery-block{padding:12px 3px;margin-bottom:12px;background-color:#ffffff;box-shadow:0 1px 10px 2px rgba(0, 0, 0, 0.05), 0 0 0 1px #e0e0e0}.center{display:flex;align-items:center;justify-content:center;text-align:center}.number-icon{color:var(--calcite-color-brand)}.styles-msg-title{padding:6px;font-weight:bold;font-size:16px;display:flex;justify-content:center}.styles-msg{font-size:var(--calcite-font-size--2)}"},51298:(e,i,t)=>{t.d(i,{a:()=>n,c:()=>l,g:()=>r});var s=t(59503),a=(t(21104),t(89393));function l(e){var i;const{layer:t,useFeatureReduction:l,mapImageSublayer:n,mapView:r,modules:o}=s.s,c=t;e=e||{};const d=(0,s.p)((0,s.j)(c));return o.ColorCreator.createContinuousRenderer({layer:c,view:r,field:e.fieldInfos[0].field,theme:"above-and-below",colorScheme:(0,s.Q)("above-and-below"),normalizationField:e.fieldInfos[1].field,outlineOptimizationEnabled:!n&&((0,a.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:(0,s.u)(c)),sizeOptimizationEnabled:!n&&(!(0,a.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled),legendOptions:e.legendOptions,defaultSymbolEnabled:!1,forBinning:"binning"===(null===(i=c.featureReduction)||void 0===i?void 0:i.type)&&l}).then((e=>(((0,s.t)(e.renderer,"color")||{}).style="ratio",(0,s.o)(d,e.renderer),Promise.resolve(e))),(e=>Promise.reject(e)))}function n(e){var i,t,l,n;const{layer:o,useFeatureReduction:c,mapImageSublayer:d,mapView:p,modules:m}=s.s,u=o;e=e||{};const g=(0,s.j)(u),h=(0,s.a)(g,"color");if(h&&e.fieldInfo&&e.fieldInfo.field==h.field&&e.normalizationField===h.normalizationField&&(delete e.fieldInfos,(0,s.S)(e)))return Promise.resolve({renderer:g.clone()});const f=(0,s.t)(g,"color"),y=(0,s.p)(g);let z=e.fieldInfos?e.fieldInfos[0]:h?{field:h.field,expression:h.valueExpression,expressionTitle:h.valueExpressionTitle,simpleFieldType:s.z.NUMBER}:{field:g.field,expression:g.valueExpression,expressionTitle:g.valueExpressionTitle,simpleFieldType:s.z.NUMBER};const b=e.normalizationField?e.normalizationField:h?h.normalizationField:g.normalizationField,v=g.classBreakInfos&&g.classBreakInfos.length?g.classBreakInfos[0].symbol:null,S=g.defaultSymbol,E=g.defaultLabel;let I=!1;(null===e.normalizationField||e.normalizationField||e.fieldInfo)&&(I=!0);const F=e.discardMinMax?void 0:(0,a.i)(e.min)?e.min:I?void 0:f?f.minSliderValue:g.classBreakInfos[0].minValue,T=e.discardMinMax?void 0:(0,a.i)(e.max)?e.max:I?void 0:f?f.maxSliderValue:g.classBreakInfos[g.classBreakInfos.length-1].maxValue;return m.ColorCreator.createContinuousRenderer({layer:u,view:p,field:z?z.field:g.field,theme:"above-and-below",colorScheme:(0,s.Q)("above-and-below"),normalizationField:b,minValue:F,maxValue:T,outlineOptimizationEnabled:!d&&((0,a.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!y.sizeOutlineVisVar),sizeOptimizationEnabled:!d&&((0,a.i)(e.sizeOptimizationEnabled)?e.sizeOptimizationEnabled:!!y.sizeAutoVisVar),legendOptions:(null===(i=e.legendOptions)||void 0===i?void 0:i.toJSON())||(null===(t=null==h?void 0:h.legendOptions)||void 0===t?void 0:t.toJSON())||(null===(l=g.legendOptions)||void 0===l?void 0:l.toJSON()),defaultSymbolEnabled:(0,a.i)(e.defaultSymbolEnabled)?e.defaultSymbolEnabled:!!g.defaultSymbol,forBinning:"binning"===(null===(n=u.featureReduction)||void 0===n?void 0:n.type)&&c}).then((i=>{if(e.discardMinMax){const e=(0,s.a)(g,"color"),t=(0,s.a)(i.renderer,"color");e.stops.forEach(((e,i)=>e.value=t.stops[i].value));const a=!!f&&"percent"===f.style,l=!!f&&"percent-of-total"===f.style;e.stops[0].label=`< ${r(e.stops[0].value,a,l)}`,e.stops[2].label=`${r(e.stops[2].value,a,l)}`,e.stops[4].label=`> ${r(e.stops[4].value,a,l)}`}return((0,s.t)(i.renderer,"color")||{}).style="ratio",(0,s.o)(y,i.renderer),v&&i.renderer.classBreakInfos&&i.renderer.classBreakInfos.length&&(i.renderer.classBreakInfos[0].symbol=v),S&&(i.renderer.defaultSymbol=S,i.renderer.defaultLabel=E),Promise.resolve(i)}),(e=>Promise.reject(e)))}function r(e,i,t){return t?Math.round(e/(1+e)*1e4)/100+"%":i?Math.round(1e4*e)/100+"%":`${e}`}},90527:(e,i,t)=>{t.d(i,{u:()=>a});var s=t(59503);async function a(e){const{layer:i,strings:t,modules:a}=s.s,n=i,r="// "+t.arcade.defaultExpressionScript_line1+"\r\n// "+t.arcade.defaultExpressionScript_line2+"\r\n// Round(($feature.oak_count / $feature.all_trees_count) * 100, 2)\r\n\r\n",o=document.createElement("arcgis-modal-arcade");return o.arcadeScript=(null==e?void 0:e.expression)||r,o.arcadeProfile=function(){const{layer:e}=s.s;return{id:"visualization",definitions:{$feature:e}}}(),o.testData=await async function(){const{mapView:e}=s.s;return{profileVariableInstances:{$feature:await l(),$view:{scale:e.scale}},spatialReference:e.spatialReference}}(),o.addExistingExpressions=!0,o.layer=n,o.arcadeTitle=(null==e?void 0:e.expressionTitle)||t.arcade.newExpression,o.arcadeTitleEditable=!0,o.arcadeTitleEditingEnabled=!(null==e?void 0:e.expressionTitle),document.body.appendChild(o),new Promise(((e,i)=>{o.addEventListener("arcgisModalArcadeClose",(t=>{if(document.body.removeChild(o),!t.detail)return void i();const{script:l,title:c,predictOutputType:d}=t.detail;if(l&&l!==r)return a.fieldUtils.getExpressionFields(n,[l]).then((i=>{(0,s.P)(i),e({expression:l,expressionTitle:c,simpleFieldType:"number"===d?s.z.NUMBER:"string"===d?s.z.STRING:"date"===d?s.z.NUMBER:s.z.UNKNOWN})}));i()}))}))}async function l(){var e;const{layer:i,mapView:t,modules:a}=s.s;let l;if(!("fields"in i))return null;{await async function(){const{oneFeatureResponse:e,oneFeatureResponseStatus:i}=s.s;if(e&&i!==s.b.MISSING)return s.s.oneFeatureResponse;{const e=await function(){const{mapView:e,layer:i,mapImageSublayer:t}=s.s;return"fields"in i?t?n():e.whenLayerView(i).then((e=>{if("feature"===i.type&&!i.url||"wfs"===i.type){const e=i.createQuery();return e.start=0,e.num=5,e.outFields=["*"],i.queryFeatures(e).then((e=>e.features&&e.features.length?Promise.resolve(e):Promise.resolve(r())))}{const t="hasM"in i&&i.hasM,s="hasZ"in i&&i.hasZ,a=e.availableFields.length===i.fields.length&&!t&&!s;if("createQuery"in i&&a){const t=i.createQuery();return t.start=0,t.num=5,t.outFields=["*"],e.queryFeatures(t).then((e=>e.features&&e.features.length?Promise.resolve(e):n()))}return n()}})):Promise.reject("getOneFeature: wrong layer type")}();return s.s.oneFeatureResponse=(null==e?void 0:e.features.length)&&e,s.s.oneFeatureResponseStatus=(null==e?void 0:e.features.length)?s.b.SUCCESS:s.b.FAILED,e}}();const{oneFeatureResponse:o}=s.s;if(null===(e=null==o?void 0:o.features)||void 0===e?void 0:e.length)l=a.esriLang.clone(o.features[0]);else{const e={};i.fields.forEach((i=>{["small-integer","big-integer","integer","single","double","string","date","date-only","oid","guid"].indexOf(i.type)>-1&&!1===i.nullable?i.defaultValue?e[i.name]=i.defaultValue:"string"===i.type?e[i.name]="":e[i.name]=0:e[i.name]=null}));const n=t.extent;let r,o;(0,s.u)(i)?(r=new a.Polygon({spatialReference:new a.SpatialReference(t.spatialReference.toJSON())}),r.addRing([[n.xmin,n.ymin],[n.xmax,n.ymin],[n.xmax,n.ymax],[n.xmin,n.ymax],[n.xmin,n.ymin]]),o=new a.SimpleLineSymbol):(0,s.D)(i)?(r=new a.Point(n.center.toJSON()),o=new a.SimpleMarkerSymbol):(0,s.E)(i)&&(r=new a.Polyline({spatialReference:new a.SpatialReference(t.spatialReference.toJSON())}),r.addPath([[n.xmin,n.ymin],[n.xmax,n.ymax]]),o=new a.SimpleFillSymbol),l=new a.Graphic({geometry:r,symbol:o,attributes:e})}}return l}function n(){var e,i;const{layer:t,mapView:a,modules:l}=s.s;if(!("queryFeatures"in t))return Promise.resolve(r());const n=new l.Query({outFields:["*"],where:"1=1",outSpatialReference:a.spatialReference,returnGeometry:!0,returnM:"hasM"in t&&t.hasM,returnZ:"hasZ"in t&&t.hasZ});return"sourceJSON"in t&&(null===(i=null===(e=t.sourceJSON)||void 0===e?void 0:e.advancedQueryCapabilities)||void 0===i?void 0:i.supportsPagination)&&(n.num=1),t.queryFeatures(n).then((e=>Promise.resolve(e)),(()=>Promise.resolve(r())))}function r(){const{layer:e,modules:i}=s.s,t={};"fields"in e&&e.fields.forEach((e=>{e.defaultValue?t[e.name]=e.defaultValue:["small-integer","big-integer","integer","single","double","long","date","oid"].indexOf(e.type)>-1?t[e.name]=0:"date-only"===e.type?t[e.name]=null:t[e.name]=""}));const a=new i.Graphic({geometry:void 0,symbol:void 0,attributes:t});return new i.FeatureSet({features:[a],fields:[],geometryType:(0,s.G)(e),spatialReference:"spatialReference"in e&&e.spatialReference.clone()})}t(21104),t(2137)},75076:(e,i,t)=>{t.d(i,{a:()=>n,c:()=>a,u:()=>l});var s=t(59503);function a(e){var i;const{layer:t,mapView:a,modules:l}=s.s,n=t,r=(0,s.j)(n);return e=e||{},"heatmap"===(0,s.g)()&&(e.radius=e.radius||r.radius,e.heatmapScheme=e.heatmapScheme||(0,s.W)()),(null===(i=e.fieldInfos)||void 0===i?void 0:i.length)&&(0,s.P)([e.fieldInfos[0].field]),l.HeatmapCreator.createRenderer({layer:n,view:a,field:e.fieldInfos&&e.fieldInfos.length?e.fieldInfos[0].field:null,radius:e.radius||10,heatmapScheme:e.heatmapScheme||void 0})}function l(e){const{layer:i,modules:t}=s.s,a=(0,s.j)(i);return t.HeatmapCreator.updateRenderer({renderer:a,fadeRatio:e})}function n(e){const{layer:i,mapView:t,modules:a}=s.s,l=i,n=(0,s.j)(l);return e=e||{},a.heatmapStatistics({layer:l,view:t,field:n.field,radius:e.radius||n.radius||10}).then((e=>(n.minDensity=e.min,n.maxDensity=e.max,Promise.resolve(e))),(e=>Promise.reject(e)))}t(21104),t(2137)},50478:(e,i,t)=>{t.d(i,{a:()=>n,b:()=>r,c:()=>l});var s=t(59503),a=(t(21104),t(89393));function l(e){var i;const{layer:t,useFeatureReduction:l,mapImageSublayer:n,mapView:r,modules:o}=s.s,c=t;e=e||{};const d=(0,s.p)((0,s.j)(c));return o.LocationCreator.createRenderer({layer:c,view:r,outlineOptimizationEnabled:!n&&(!(0,a.i)(e.outlineOptimizationEnabled)||e.outlineOptimizationEnabled),sizeOptimizationEnabled:!n&&(!(0,a.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled),forBinning:"binning"===(null===(i=c.featureReduction)||void 0===i?void 0:i.type)&&l}).then((e=>((0,s.o)(d,e.renderer),Promise.resolve(e))),(e=>Promise.reject(e)))}function n(){var e;const{layer:i,useFeatureReduction:t,mapView:a,modules:l}=s.s,n=i;return l.LocationCreator.createRenderer({layer:n,view:a,outlineOptimizationEnabled:!0,forBinning:"binning"===(null===(e=n.featureReduction)||void 0===e?void 0:e.type)&&t}).then((e=>{const i=(0,s.a)(e.renderer,"size","outline");return Promise.resolve(i)}))}function r(){var e;const{layer:i,useFeatureReduction:t,mapView:a,modules:l}=s.s,n=i;return l.LocationCreator.createRenderer({layer:n,view:a,outlineOptimizationEnabled:!1,sizeOptimizationEnabled:!0,forBinning:"binning"===(null===(e=n.featureReduction)||void 0===e?void 0:e.type)&&t}).then((e=>{const i=(0,s.a)(e.renderer,"size","auto");return Promise.resolve(i)}))}}}]);
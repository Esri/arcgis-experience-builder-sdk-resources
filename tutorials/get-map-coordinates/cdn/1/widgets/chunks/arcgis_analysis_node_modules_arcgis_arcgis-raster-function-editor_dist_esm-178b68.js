"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["extensions_widgets_arcgis_analysis_node_modules_arcgis_arcgis-raster-function-editor_dist_esm-178b68"],{75517:(e,i,t)=>{t.r(i),t.d(i,{rfx_preview:()=>w});var r=t(14947),a=t(59498),s=(t(34319),t(92123)),o=t(90949),c=t(30629),n=t(826),l=t(70049),h=(t(99248),t(16888),t(95323),t(43278),t(46574),t(86944),t(83345),t(74656),t(27703));t(25829),t(22760),t(86578),t(95166),t(46717),t(55139),t(57098),t(91123),t(78979),t(46869);const d="action-button",w=class{constructor(e){(0,r.r)(this,e),this.rfxPreviewSelection=(0,r.c)(this,"rfxPreviewSelection",7),this.previewHelpClick=(0,r.c)(this,"previewHelpClick",7),this.openBlockInitially=!0,this.maxPreviewLayers=5,this.previewIndexCounter=1,this.createPreviewLayer=async()=>{await this.addToPreviewLayerList(),this.loadPreviewLayer()},this.handlePreviewSwitchChange=e=>{const i=e.target.checked;this.showPreviewBlock=i,!1===this.showPreviewBlock?this.hidePreviewLayers():0===this.previewLayers.length?this.createPreviewLayer():(this.rfxPreviewSelection.emit(this.getSelectedPreviewListItem().data),this.loadPreviewLayer())},this.updatePreviewLayer=async()=>{const e=await this.getTemplate();this.previewLayers.forEach((i=>{i.index===this.selectedPreviewLayerIndex&&(i.data=e)})),this.loadPreviewLayer()},this.onPreviewSelect=e=>{this.hidePreviewLayers(),this.selectedPreviewLayerIndex=e.target?.value,this.rfxPreviewSelection.emit(this.getSelectedPreviewListItem().data);const i=this.getSelectedPreviewListItem();void 0!==i?.layer&&(i.layer.visible=!0)},this.onPreviewClose=e=>{const i=e.target?.value;this.removePreviewLayerFromMap(this.previewLayers.find((e=>e.index===i)).layer),this.previewLayers=this.previewLayers.filter((e=>e.index!==i)),0===this.previewLayers.length&&(this.showPreviewBlock=!1),this.selectedPreviewLayerIndex===i&&(this.selectedPreviewLayerIndex=this.previewLayers[0].index)},this.renderPreviewError=e=>(0,r.h)("div",{slot:"content-end"},(0,r.h)("calcite-button",{id:`preview-layer-load-error-${e}`,iconStart:"exclamation-mark-triangle",appearance:"transparent",kind:"neutral",scale:o.U.Scale}),(0,r.h)("calcite-tooltip",{label:"preview failed to load","reference-element":`preview-layer-load-error-${e}`},(0,r.h)("span",null,this.strings.previewError))),this.renderPreviewLayers=()=>(0,r.h)("calcite-list",{class:"preview-list",loading:this.previewLayerLoading,selectionAppearance:"border",selectionMode:"single",dir:this.direction},this.previewLayers.map((e=>(0,r.h)("calcite-list-item",{key:`preview-layer-item${e.index}`,id:`preview-layer-item${e.index}`,dir:this.direction,label:e.label,value:e.index,selected:e.index===this.selectedPreviewLayerIndex,closable:!0,onCalciteListItemSelect:this.onPreviewSelect,onCalciteListItemClose:this.onPreviewClose},e.status===n.P.error&&this.renderPreviewError(e.index))))),this.renderPreviewSwitch=()=>(0,r.h)("calcite-label",{dir:this.direction,layout:"inline",scale:o.U.Scale,ref:e=>{this.showPreviewElement=e}},(0,r.h)("calcite-switch",{checked:this.showPreviewBlock,onCalciteSwitchChange:this.handlePreviewSwitchChange,dir:this.direction,scale:o.U.Scale}),this.strings.showPreview,(0,r.h)("calcite-action",{class:"help-action",text:"show help",icon:"information",scale:o.U.Scale,onClick:e=>{e.stopPropagation();const i=(0,c.d)(this.strings.previewPopup);this.previewHelpClick.emit({referenceElement:this.showPreviewElement,helpSrcdoc:i,heading:this.strings.showPreview})}})),this.previewLayers=[],this.showPreviewBlock=!1,this.previewLayerLoading=!1,this.mapView=void 0,this.getTemplate=void 0,this.portal=void 0}async componentWillLoad(){({strings:this.strings,dir:this.direction}=await(0,a.b)(this.hostElement,(0,r.g)(".")))}disconnectedCallback(){this.removePreviewLayerFromMap(this.getSelectedPreviewListItem()?.layer)}async clearPreviewLayers(){return this.previewLayers.forEach((e=>{this.removePreviewLayerFromMap(e.layer)})),this.previewLayers=[],this.showPreviewBlock=!1,this.previewIndexCounter=1,Promise.resolve()}async addToPreviewLayerList(){const e=await this.getTemplate(),{previewIndexCounter:i}=this;this.previewLayers.push({index:i,label:(0,h.f)(this.strings.previewLayer,{number:i.toString()}),data:e,status:n.P.loading}),this.selectedPreviewLayerIndex=i,this.previewIndexCounter++}validateRFT(e){if((0,s.m)(e))return;const i=(0,c.f)(this.portal),t={renderingRule:JSON.stringify(e),f:"json"};return(0,h.r)(i,{query:t}).then((e=>e?.data?.renderingRule?.isValid),(e=>{console.log("validate request failed",e)}))}removePreviewLayerFromMap(e){(0,s.m)(e)||(e.opacity=0,this.mapView.map.remove(e))}addPreviewLayerToMap(e){const i=this.getSelectedPreviewListItem(),t=(0,l.o)((0,c.h)(this.portal),e);t.load().catch((()=>i.status=n.P.error)).then((()=>{i.layer=t,this.mapView.map.add(t),this.mapView.whenLayerView(t).then((e=>{e.watch("updating",(e=>{this.previewLayerLoading=e}))}))}))}hidePreviewLayers(){this.previewLayers.forEach((e=>{(0,s.m)(e.layer)||(e.layer.visible=!1)}))}async loadPreviewLayer(){this.previewLayerLoading=!0,this.hidePreviewLayers();const e=this.getSelectedPreviewListItem(),i=e.data;e.isValid=await this.validateRFT(i),e.isValid?(e.status=n.P.success,this.addPreviewLayerToMap(i)):(e.status=n.P.error,this.previewLayerLoading=!1)}getSelectedPreviewListItem(){return void 0===this.selectedPreviewLayerIndex?this.previewLayers[0]:this.previewLayers.find((e=>e.index===this.selectedPreviewLayerIndex))}renderActions(){const e=this.previewLayers.length===this.maxPreviewLayers||this.previewLayerLoading;return(0,r.h)("div",{class:"action-button-container"},(0,r.h)("calcite-button",{id:"preview-update-button",class:d,kind:"neutral",appearance:"outline-fill",iconStart:"refresh",onClick:this.updatePreviewLayer,dir:this.direction,scale:o.U.Scale,disabled:this.previewLayerLoading},this.strings.update),(0,r.h)("calcite-tooltip",{label:"",placement:"bottom-start","reference-element":"preview-update-button"},(0,r.h)("span",null,this.strings.updatePopover)),(0,r.h)("calcite-button",{id:"preview-create-button",class:d,kind:"neutral",appearance:"outline-fill",iconStart:"plus",dir:this.direction,onClick:()=>{!1===e&&this.createPreviewLayer()},disabled:e,scale:o.U.Scale},this.strings.newPreview),(0,r.h)("calcite-tooltip",{label:"",placement:"bottom-start","reference-element":"preview-create-button"},(0,r.h)("span",null,e?(0,h.f)(this.strings.maxPreview,{maxCount:this.maxPreviewLayers.toString()}):this.strings.createPopover)))}render(){return(0,r.h)("calcite-block",{collapsible:!0,heading:this.strings.header,description:this.strings.description,open:this.openBlockInitially,dir:this.direction},this.renderPreviewSwitch(),this.showPreviewBlock&&this.renderPreviewLayers(),this.showPreviewBlock&&this.renderActions())}static get assetsDirs(){return["t9n"]}get hostElement(){return(0,r.a)(this)}};w.style=":root{--calcite-color-brand:#007ac2;--calcite-color-brand-hover:#00619b;--calcite-color-brand-press:#004874;--calcite-color-status-info:#00619b;--calcite-color-status-success:#35ac46;--calcite-color-status-warning:#edd317;--calcite-color-status-danger:#d83020;--calcite-color-status-danger-hover:#a82b1e;--calcite-color-status-danger-press:#7c1d13;--calcite-color-background:#f8f8f8;--calcite-color-foreground-1:#ffffff;--calcite-color-foreground-2:#f3f3f3;--calcite-color-foreground-3:#eaeaea;--calcite-color-text-1:#151515;--calcite-color-text-2:#4a4a4a;--calcite-color-text-3:#6a6a6a;--calcite-color-text-inverse:#ffffff;--calcite-color-text-link:#00619b;--calcite-color-border-1:#cacaca;--calcite-color-border-2:#d4d4d4;--calcite-color-border-3:#dfdfdf;--calcite-color-border-input:#949494;--rfx-quarter-spacing:0.25rem;--rfx-half-spacing:0.5rem;--rfx-three-quarter-spacing:0.75rem;--rfx-full-spacing:1rem;--rfx-component-default-width:100%;--rfx-ui-border-input:var(--calcite-color-border-2);--rfx-popover-content-min-height:30vh;--rfx-popover-content-max-height:60vh;--rfx-popover-content-height:45vh;--rfx-widget-content-height:30vh;--rfx-modal-width-small:32rem}.action-button-container{display:flex;justify-content:space-between}.action-button{width:48%}.preview-list{padding:var(--rfx-full-spacing) 0 var(--rfx-full-spacing) 0}.help-action{-webkit-margin-start:auto;margin-inline-start:auto}"}}]);
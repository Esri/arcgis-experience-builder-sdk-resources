/*! For license information please see arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-3195c3.js.LICENSE.txt */
"use strict";(self.webpackChunkexb_client=self.webpackChunkexb_client||[]).push([["vendors-extensions_widgets_arcgis_analysis_node_modules_arcgis_app-components_dist_esm_arcgis-3195c3"],{4758:(e,i,t)=>{t.r(i),t.d(i,{arcgis_smart_mapping_panels_relationship:()=>c,arcgis_smart_mapping_relationship_color_slider:()=>u,arcgis_smart_mapping_relationship_legend:()=>p});var s=t(35110),a=t(59503),l=t(37192),r=t(61886),n=(t(21104),t(2137),t(41565)),o=t(86587),d=t(77419),h=t(99258);t(1984),t(63280),t(23505),t(89393),t(73838);const c=class{constructor(e){(0,s.r)(this,e),this.smartMappingCompleteClose=(0,s.c)(this,"smartMappingCompleteClose",7),this.arcgisSmartMappingPanelsRelationshipClose=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipClose",7),this.arcgisSmartMappingPanelsRelationshipBackClick=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipBackClick",7),this.arcgisSmartMappingPanelsRelationshipError=(0,s.c)(this,"arcgisSmartMappingPanelsRelationshipError",7),this.colorSliderNodes=[],this.hideTransparency=!1,this.hideRotation=!1,this.menuOpen=void 0,this.showBackButton=void 0,this.beforeBack=void 0,this.visualizationOpen=!1}async setFocus(){var e;null===(e=this.flowItemNode)||void 0===e||e.setFocus()}async componentWillLoad(){this.visualizationOpen=!0;const{layer:e,modules:i}=a.s,t=(0,a.j)(e);this.originalRendererJSON=t.toJSON(),this.originalFeatureReduction="featureReduction"in e&&e.featureReduction?i.esriLang.clone(e.featureReduction):void 0}componentDidLoad(){requestAnimationFrame((()=>{var e;return null===(e=this.flowItemNode)||void 0===e?void 0:e.setFocus()})),this.scaleHandle=(0,l.w)(this.flowItemNode,(()=>this.smartMappingCompleteClose.emit("cancel")))}disconnectedCallback(){var e;null===(e=this.scaleHandle)||void 0===e||e.remove()}render(){var e;const{layer:i,hideLayerTitle:t,isRTL:l,mapImageSublayer:r,strings:n}=a.s,d=t?void 0:null!==(e=null==r?void 0:r.title)&&void 0!==e?e:i.title;return(0,s.h)(s.H,{class:"calcite-match-height"},(0,s.h)("calcite-flow-item",{heading:n.panels.styleOptions,description:d,class:{"flow-item":!0,[o.C.rtl]:l},closable:(0,a.H)(this.hostElement),menuOpen:this.menuOpen,beforeBack:this.beforeBack,showBackButton:this.showBackButton,onCalciteFlowItemClose:()=>this.handleDone(),onCalciteFlowItemBack:()=>{this.arcgisSmartMappingPanelsRelationshipBackClick.emit()},ref:e=>{e&&(this.flowItemNode=e)}},this.renderDoneButton(),this.renderCancelButton(),this.renderVisualization(),this.renderLegend(),this.renderTransparency(),this.renderRotation()))}renderDoneButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.done,onClick:()=>this.handleDone(),appearance:"solid",width:"half"},e.done)}renderCancelButton(){const{strings:e}=a.s;return(0,s.h)("calcite-button",{slot:"footer",label:e.cancel,onClick:()=>this.handleCancel(),appearance:"outline-fill",width:"half"},e.cancel)}renderVisualization(){const{visualizationOpen:e,hideTransparency:i,hideRotation:t}=this,{strings:l}=a.s;return(0,s.h)("calcite-block",{class:"relationship-block",heading:l.panels.relationship.relationshipStyle,collapsible:!i||!t,open:e,onCalciteBlockOpen:()=>this.visualizationOpen=!0,onCalciteBlockClose:()=>this.visualizationOpen=!1},this.renderSymbol(),this.renderGridSize(),this.renderMethod(),this.renderField1(),this.renderField2(),this.renderBackgroundStyle(),this.renderDefaultSymbol())}renderSymbol(){const{layer:e,mapView:i,modules:t}=a.s,l=(0,a.j)(e).uniqueValueInfos;if(!l.length)return null;const r=t.relationshipSchemes.getSchemes({basemap:i.map.basemap,geometryType:(0,a.G)(e)}),n=(0,a.aa)(r,Math.min(l.length,10))[0].colors;let o=((null==l?void 0:l.length)?l.filter(((e,i)=>i<10)).map(((e,i)=>(0,a.w)(e.symbol)||new t.esriColor(n[i%n.length]))):[]).reverse();return(0,s.h)("arcgis-smart-mapping-symbol-button",{colors:o,type:"relationship-ramp",rampType:"discrete",onArcgisSmartMappingSymbolButtonSymbolChange:()=>{(0,s.f)(this.hostElement),this.colorSliderNodes[0]&&(0,s.f)(this.colorSliderNodes[0]),this.colorSliderNodes[1]&&(0,s.f)(this.colorSliderNodes[1]),(0,s.f)(this.legendNode),this.rotationNode&&(0,s.f)(this.rotationNode)}})}renderGridSize(){const{layer:e,strings:i}=a.s,t=(0,a.j)(e).authoringInfo.numClasses;return(0,s.h)("calcite-label",null,i.panels.relationship.gridSize,(0,s.h)("calcite-select",{label:i.panels.relationship.gridSize,onCalciteSelectChange:e=>{const i=e.target;this.handleGridSizeChange(parseFloat(i.value))}},(0,s.h)("calcite-option",{value:"2",selected:2===t},i.panels.relationship.gridsize2),(0,s.h)("calcite-option",{value:"3",selected:3===t},i.panels.relationship.gridsize3),(0,s.h)("calcite-option",{value:"4",selected:4===t},i.panels.relationship.gridsize4)))}renderMethod(){const{layer:e}=a.s,i=(0,a.g)();return(0,s.h)("arcgis-smart-mapping-method-button",{onArcgisSmartMappingMethodButtonBeforeOpen:()=>(0,a.l)(),onArcgisSmartMappingMethodButtonChange:t=>{const l=t.target,o=(0,a.j)(e);"manual"===t.detail?(o.authoringInfo.classificationMethod="manual",(0,a.ab)(),(0,s.f)(this.hostElement)):(0,r.r)((0,n.a)({classificationMethod:t.detail}),this.flowItemNode).then((t=>{if(["relationship-size"].indexOf(i)>-1){const e=(0,a.a)(o,"size");t.renderer.visualVariables=t.renderer.visualVariables||[],t.renderer.visualVariables.push(e);const i=(0,a.t)(o,"size");t.renderer.authoringInfo=t.renderer.authoringInfo||{},t.renderer.authoringInfo.visualVariables=t.renderer.authoringInfo.visualVariables||[],t.renderer.authoringInfo.visualVariables.push(i)}(0,a.e)(t.renderer,e),(0,a.ab)(),(0,s.f)(this.hostElement),(0,s.f)(l)}),(e=>{(0,s.f)(l),this.arcgisSmartMappingPanelsRelationshipError.emit(e)}))},ref:e=>this.methodButtonNode=e})}renderField1(){const{layer:e}=a.s,i=(0,a.j)(e).authoringInfo.field1,t=(0,a.x)(i.field),l=t.layerField.alias||t.layerField.name;return(0,s.h)("calcite-block-section",{text:l},(0,s.h)("div",{class:"block-section-padding"},this.renderDividedBy(0),this.renderColorSlider(0)))}renderField2(){const{layer:e}=a.s,i=(0,a.j)(e).authoringInfo.field2,t=(0,a.x)(i.field),l=t.layerField.alias||t.layerField.name;return(0,s.h)("calcite-block-section",{text:l},(0,s.h)("div",{class:"block-section-padding"},this.renderDividedBy(1),this.renderColorSlider(1)))}renderDividedBy(e){const{layer:i}=a.s,t=(0,a.j)(i).authoringInfo,l=(0===e?t.field1:t.field2).normalizationField;return(0,s.h)("arcgis-smart-mapping-divided-by",{rendererSubtype:"relationship",fieldPos:e,normalizationField:l,onArcgisSmartMappingDividedByChange:()=>{(0,s.f)(this.hostElement),this.colorSliderNodes[e]&&this.colorSliderNodes[e].updateStatistics()}})}renderColorSlider(e){return(0,s.h)("arcgis-smart-mapping-relationship-color-slider",{fieldPos:e,ref:i=>this.colorSliderNodes[e]=i,onArcgisSmartMappingRelationshipColorSliderChange:()=>this.methodButtonNode&&(0,s.f)(this.methodButtonNode)})}renderBackgroundStyle(){const{layer:e}=a.s;return(0,a.u)(e)&&"relationship-size"===(0,a.g)()?(0,s.h)("arcgis-smart-mapping-background-symbol",null):null}renderDefaultSymbol(){return(0,s.h)("arcgis-smart-mapping-default-symbol",null)}renderLegend(){return(0,s.h)("arcgis-smart-mapping-relationship-legend",{onArcgisSmartMappingRelationshipLegendFocusChange:()=>(0,s.f)(this.hostElement),ref:e=>this.legendNode=e})}renderTransparency(){const{hideTransparency:e}=this;if(e)return;const{layer:i}=a.s,t=(0,a.j)(i),l=(0,a.a)(t,"opacity");return(0,s.h)("arcgis-smart-mapping-transparency",{open:!!l,onArcgisSmartMappingSymbolTransparencyError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}renderRotation(){if(this.hideRotation)return;const{layer:e}=a.s,i=(0,a.j)(e),t=(0,a.a)(i,"opacity"),l=(0,a.a)(i,"rotation");return(0,s.h)("arcgis-smart-mapping-rotation",{open:!t&&!!l,ref:e=>this.rotationNode=e,onArcgisSmartMappingRotationError:({detail:e})=>this.arcgisSmartMappingPanelsRelationshipError.emit(e)})}handleDone(){this.arcgisSmartMappingPanelsRelationshipClose.emit("save")}handleCancel(){const{originalRendererJSON:e,originalFeatureReduction:i}=this;(0,a.k)(e,i),this.arcgisSmartMappingPanelsRelationshipClose.emit("cancel")}handleGridSizeChange(e){const{layer:i}=a.s;(0,a.l)(),(0,r.r)((0,n.a)({numClasses:e}),this.flowItemNode).then((e=>{if("relationship-size"===(0,a.g)()){const t=(0,a.j)(i),s=(0,a.a)(t,"size");e.renderer.visualVariables=e.renderer.visualVariables||[],e.renderer.visualVariables.push(s);const l=(0,a.t)(t,"size");e.renderer.authoringInfo.visualVariables=e.renderer.authoringInfo.visualVariables||[],e.renderer.authoringInfo.visualVariables.push(l)}(0,a.e)(e.renderer,i),(0,a.ab)(),(0,s.f)(this.hostElement),this.colorSliderNodes[0]&&(0,s.f)(this.colorSliderNodes[0]),this.colorSliderNodes[1]&&(0,s.f)(this.colorSliderNodes[1])}))}get hostElement(){return(0,s.d)(this)}};c.style=":host{width:100%}.flow-item{height:100%}.relationship-block{overflow-x:hidden}.attribute-name{word-break:break-all}.block-section-padding{padding-top:6px}";const u=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingRelationshipColorSliderChange=(0,s.c)(this,"arcgisSmartMappingRelationshipColorSliderChange",7),this.arcgisSmartMappingRelationshipColorSliderError=(0,s.c)(this,"arcgisSmartMappingRelationshipColorSliderError",7),this.currentBreakValues=[],this.fieldPos=void 0,this.histogramStatus=a.b.MISSING,this.statisticsStatus=a.b.MISSING}async updateStatistics(){var e;this.statisticsStatus=a.b.MISSING,this.statistics=null,this.histogramStatus=a.b.MISSING,this.histogram=null,null===(e=this.colorSlider)||void 0===e||e.destroy(),this.colorSlider=void 0,this.getStatistics()}componentWillLoad(){this.flowItemNode=(0,a.f)(this.hostElement,"calcite-flow-item"),this.getStatistics()}componentDidLoad(){const{config:e}=a.s;this.hostElement.shadowRoot.firstElementChild.insertAdjacentHTML("beforebegin",`<link rel="stylesheet" href="${e.jsapiUrl}/themes/light/main.css" />`)}render(){var e;const{statisticsStatus:i}=this,{layer:t,strings:l}=a.s,r=(0,a.j)(t).authoringInfo;if(i!==a.b.FAILED&&i!==a.b.MISSING){if(this.statisticsStatus===a.b.IN_PROGRESS||this.histogramStatus===a.b.IN_PROGRESS&&!this.colorSlider)return this.renderColorSliderLoading();{const e=this.prepareColorSlider(),i=0===this.fieldPos?r.field1.classBreakInfos:r.field2.classBreakInfos;return this.currentBreakValues=i.map((e=>({min:e.minValue,max:e.maxValue}))),(e||this.colorSlider)&&this.colorSlider.min!==this.colorSlider.max?(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-label",null,l.panels.relationship.dataRange),(0,s.h)("div",{ref:e=>{e&&this.afterColorSliderCreate(e)}})):this.colorSlider&&this.colorSlider.min===this.colorSlider.max?null:this.renderColorSliderLoading()}}null===(e=this.colorSlider)||void 0===e||e.destroy(),this.colorSlider=void 0}renderColorSliderLoading(){const{strings:e}=a.s;return(0,s.h)("div",{class:"slider-box"},(0,s.h)("calcite-loader",{label:e.loading}))}afterColorSliderCreate(e){if(this.colorSlider.container)e.append(this.colorSlider.container);else{const i=document.createElement("div");i.classList.add("slider-container"),e.append(i),this.colorSlider.container=i}}createColorSliderChangeEvents(){this.colorSlider&&(this.colorSlider.on("min-change",(e=>{e.value>this.currentBreakValues[0].max?this.onMinMaxChange(this.currentBreakValues[0].max,this.colorSlider.slider.max):this.onMinMaxChange(e.value,this.colorSlider.slider.max)})),this.colorSlider.on("max-change",(e=>{e.value<this.currentBreakValues[this.currentBreakValues.length-1].min?this.onMinMaxChange(this.colorSlider.slider.min,this.currentBreakValues[this.currentBreakValues.length-1].min):this.onMinMaxChange(this.colorSlider.slider.min,e.value)})),this.colorSlider.on("thumb-change",(()=>{this.updateRendererBreaks(this.colorSlider.breaks)})),this.colorSlider.on("thumb-drag",(()=>{this.updateRendererBreaks(this.colorSlider.breaks)})))}getClassBreaksColors(){const{layer:e,modules:i}=a.s,t=(0,a.j)(e),s=t.authoringInfo,l=(0===this.fieldPos?s.field1.classBreakInfos:s.field2.classBreakInfos).map((e=>({min:e.minValue,max:e.maxValue})));let r=new i.esriColor([0,0,0,1]),n=new i.esriColor([0,0,0,1]);t.uniqueValueGroups[0].classes.forEach((e=>{"HH"===e.values[0].value?r=(0,a.w)(e.symbol):"LL"===e.values[0].value&&(n=(0,a.w)(e.symbol))}));let o=(r.r+r.g+r.b)/3;const d=(n.r+n.g+n.b)/3;if(2===l.length)l[1].color=new i.esriColor([o,o,o,1]),l[0].color=new i.esriColor([d,d,d,1]);else if(3===l.length)l[2].color=new i.esriColor([o,o,o,1]),o=(o+d)/2,l[1].color=new i.esriColor([o,o,o,1]),l[0].color=new i.esriColor([d,d,d,1]);else{l[3].color=new i.esriColor([o,o,o,1]);let e=o+(d-o)/3;l[2].color=new i.esriColor([e,e,e,1]),e=o+2*(d-o)/3,l[1].color=new i.esriColor([e,e,e,1]),l[0].color=new i.esriColor([d,d,d,1])}return l}getHistogram(e,i,t,s,l){var r;const{layer:n,useFeatureReduction:o,mapView:d,modules:h}=a.s,c=n;(t=t||this.statistics)&&0!==t.count&&(this.histogramStatus=a.b.IN_PROGRESS,h.histogram({layer:c,view:d,field:e.field,numBins:50,minValue:null!=s?s:t.min,maxValue:null!=l?l:t.max,normalizationField:i,forBinning:"featureReduction"in c&&"binning"===(null===(r=c.featureReduction)||void 0===r?void 0:r.type)&&o}).then((e=>{this.histogram=e,this.histogramStatus=a.b.SUCCESS}),(e=>{console.log("error-histogram",e),this.histogramStatus=a.b.FAILED})))}getStatistics(){var e;const{layer:i,useFeatureReduction:t,mapView:s,modules:l}=a.s,r=i,n=(0,a.j)(r).authoringInfo,o=0===this.fieldPos?n.field1:n.field2,d=o.classBreakInfos;if(!d||this.statistics)return;const h={field:o.field,simpleFieldType:a.z.NUMBER},c=o.normalizationField;let u=d[0].minValue,m=d[d.length-1].maxValue;this.statisticsStatus=a.b.IN_PROGRESS,l.summaryStatistics({layer:r,view:s,field:o.field,normalizationField:c,forBinning:"featureReduction"in r&&"binning"===(null===(e=r.featureReduction)||void 0===e?void 0:e.type)&&t}).then((e=>{if(0===e.count)e.min=0,e.max=100,e.avg=(m+u)/2;else if(!(0,a.ac)(e.avg)||!(0,a.ac)(e.min)||!(0,a.ac)(e.max))return void(this.statisticsStatus=a.b.FAILED);e=(0,a.ad)(e),u=null!=u?u:e.min,m=null!=m?m:e.max,this.statistics=e,this.statisticsStatus=a.b.SUCCESS,this.getHistogram(h,c,e,u,m)}),(e=>{console.log("error-summaryStatistics",e),this.statisticsStatus=a.b.FAILED}))}onMinMaxChange(e,i){const{statistics:t}=this,{layer:s}=a.s,l=(0,a.j)(s),o=l.authoringInfo,d=0===this.fieldPos?o.field1:o.field2,c=d.normalizationField,u={field:d.field,simpleFieldType:a.z.NUMBER},m=0===this.fieldPos?o.field1.classBreakInfos:o.field2.classBreakInfos;m[0].minValue=e,m[m.length-1].maxValue=i,(0,r.r)((0,n.u)(),this.flowItemNode).then((l=>{(0,a.e)(l,s),(0,a.ab)(),this.getHistogram(u,c,t,e,i),(0,h.u)(this.colorSlider,this.colorSliderBars,this.getClassBreaksColors(),this.histogram)})),l.authoringInfo.classificationMethod="manual",this.arcgisSmartMappingRelationshipColorSliderChange.emit()}prepareColorSlider(){var e,i;const{statistics:t,histogram:s,histogramStatus:l}=this,{layer:r,modules:n}=a.s,o=(0,a.j)(r).authoringInfo,c=0===this.fieldPos?o.field1.classBreakInfos:o.field2.classBreakInfos;if(!c||l===a.b.IN_PROGRESS)return!1;let u=c[0].minValue,m=c[c.length-1].maxValue;if(({min:u,max:m}=(0,a.ad)({min:u,max:m})),this.colorSlider){const e=this.colorSlider;if("dragging"===(null===(i=e.slider)||void 0===i?void 0:i.state))return!0;const a={histogramConfig:{bins:null==s?void 0:s.bins,average:Math.round(10*t.avg)/10,standardDeviation:t.stddev,standardDeviationCount:1},min:null!=u?u:t.min,max:null!=m?m:t.max};a.breaks=this.getClassBreaksColors(),a.precision=(0,d.g)(a.breaks),a.histogramConfig.barCreatedFunction=s&&h.b.bind(this,a.breaks,s,this.colorSliderBars),(0,h.u)(e,this.colorSliderBars,a.breaks,s),this.colorSlider.set(a)}else{const i=this.getClassBreaksColors(),t={histogramConfig:{bins:null===(e=this.histogram)||void 0===e?void 0:e.bins,average:Math.round(10*this.statistics.avg)/10,standardDeviation:this.statistics.stddev,standardDeviationCount:1},min:null!=u?u:this.statistics.min,max:null!=m?m:this.statistics.max,breaks:i};this.colorSliderBars=[],t.precision=(0,d.g)(t.breaks),t.histogramConfig.barCreatedFunction=this.histogram&&h.b.bind(this,t.breaks,this.histogram,this.colorSliderBars),(0,h.u)(this.colorSlider,this.colorSliderBars,t.breaks,this.histogram),this.colorSlider=new n.ClassedColorSlider(t),this.colorSlider.min===this.colorSlider.max&&this.colorSlider.set(t),this.createColorSliderChangeEvents()}return(0,a.ac)(this.colorSlider)}updateRendererBreaks(e){const{layer:i}=a.s,t=(0,a.j)(i).authoringInfo,s=0===this.fieldPos?t.field1:t.field2;t.classificationMethod="manual",s.classBreakInfos&&(s.classBreakInfos.forEach(((i,t)=>{i.minValue===e[t].min&&i.maxValue===e[t].max||(s.classBreakInfos[t].minValue=e[t].min,s.classBreakInfos[t].maxValue=e[t].max,this.currentBreakValues[t].min=e[t].min,this.currentBreakValues[t].max=e[t].max)})),(0,r.r)((0,n.u)(),this.flowItemNode).then((e=>{(0,a.e)(e,i),(0,a.ab)(),(0,h.u)(this.colorSlider,this.colorSliderBars,this.getClassBreaksColors(),this.histogram)})),this.arcgisSmartMappingRelationshipColorSliderChange.emit())}get hostElement(){return(0,s.d)(this)}};var m;u.style=".slider-box{height:310px;margin-top:6px}.esri-classed-color-slider{min-width:200px}.esri-classed-color-slider__histogram-container{width:70px}.esri-classed-color-slider .esri-slider .esri-slider__content{height:200px}.esri-classed-color-slider .esri-slider .esri-slider__label,.esri-classed-color-slider .esri-slider .esri-slider__min,.esri-classed-color-slider .esri-slider .esri-slider__max{text-decoration:underline}.esri-classed-color-slider .esri-slider .esri-slider__label:hover,.esri-classed-color-slider .esri-slider .esri-slider__min:hover,.esri-classed-color-slider .esri-slider .esri-slider__max:hover{border:1px solid #bbb;background-color:#f3f3f3;text-decoration:none;z-index:1}.slider-container{overflow:hidden}",function(e){e.focusUp16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M1.71,8 L5.93,3.78 L8,5.85 L10.07,3.78 L14.29,8 L8,14.29 L1.71,8 Z",e.focusRight16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M1.71,8 L8,1.71 L12.22,5.93 L10.15,8 L12.22,10.07 L8,14.29 L1.71,8 Z",e.focusLeft16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M3.78,10.07 L5.85,8 L3.78,5.93 L8,1.71 L14.29,8 L8,14.29 L3.78,10.07 Z",e.focusDown16="M8,0.29 L0.29,8 L8,15.71 L15.71,8 L8,0.29 Z M8,1.71 L14.29,8 L10.07,12.22 L8,10.15 L5.93,12.22 L1.71,8 L8,1.71 Z",e.code16="M6.865 13.965l-.957-.29 3.213-10.62.957.29zM15.19 8.45l-3.837-3.805-.704.71 3.131 3.104-3.135 3.19.712.702zm-9.833 3.2L2.221 8.458l3.13-3.104-.703-.71L.811 8.45l3.833 3.9z",e.fields16="M10.578 1A2.425 2.425 0 0 1 13 3.422V6c0 .552.448 1 1 1v1c-.552 0-1 .448-1 1v2.578A2.425 2.425 0 0 1 10.578 14H10v-1h.578c.785 0 1.421-.637 1.422-1.422V9c0-.574.247-1.121.679-1.5A1.995 1.995 0 0 1 12 6V3.422c0-.785-.637-1.421-1.422-1.422H10V1h.578zM6 1v1h-.578C4.637 2 4.001 2.637 4 3.422V6c0 .574-.247 1.121-.679 1.5.432.379.68.926.679 1.5v2.578c0 .785.637 1.421 1.422 1.422H6v1h-.578A2.425 2.425 0 0 1 3 11.578V9c0-.552-.448-1-1-1V7c.552 0 1-.448 1-1V3.422A2.425 2.425 0 0 1 5.422 1H6z"}(m||(m={}));const p=class{constructor(e){(0,s.r)(this,e),this.arcgisSmartMappingRelationshipLegendFocusChange=(0,s.c)(this,"arcgisSmartMappingRelationshipLegendFocusChange",7),this.arcgisSmartMappingRelationshipLegendError=(0,s.c)(this,"arcgisSmartMappingRelationshipLegendError",7),this.valueTextNodes=[]}componentWillLoad(){this.flowItemNode=(0,a.f)(this.hostElement,"calcite-flow-item")}disconnectedCallback(){a.s.selectedValue=void 0}render(){const{strings:e}=a.s;return(0,s.h)("calcite-block",{open:!0,heading:e.relationshipLegend.legend,collapsible:!0},this.renderContent())}renderContent(){return(0,s.h)("div",null,(0,s.h)("div",{class:"attributes"},this.renderAttribute(0),this.renderAttribute(1)),this.renderFocus(),this.renderLabels())}renderAttribute(e){const{layer:i}=a.s,t=(0,a.j)(i).authoringInfo,l=0===e?t.field1:t.field2,r=(0,a.x)(l.field);let n=this.getColorOrder(e);return(0,s.h)("div",{class:"attribute"},(0,s.h)("div",{class:"attribute-color-icon","aria-hidden":"true"},n.map(((e,i)=>this.getSwatch(n[i])))),(0,s.h)("div",{class:"attribute-name"},r.label))}renderFocus(){return(0,s.h)("arcgis-smart-mapping-relationship-focus-button",{flowItemNode:this.flowItemNode,onArcgisSmartMappingRelationshipFocusButtonBeforeOpen:()=>(0,a.l)(),onArcgisSmartMappingRelationshipFocusButtonChange:()=>{this.arcgisSmartMappingRelationshipLegendFocusChange.emit(),(0,s.f)(this.hostElement)},onArcgisSmartMappingRelationshipFocusButtonError:({detail:e})=>this.arcgisSmartMappingRelationshipLegendError.emit(e)})}renderLabels(){const{layer:e,strings:i}=a.s,t=(0,a.j)(e).authoringInfo.numClasses;return(0,s.h)("calcite-label",null,i.relationshipLegend.labels,(0,s.h)("calcite-list",null,this.renderLabel(0),this.renderLabel(t-1),this.renderLabel(t*t-t),this.renderLabel(t*t-1)))}renderLabel(e){const{layer:i}=a.s,t=(0,a.j)(i).authoringInfo,l=t.numClasses,r=t.focus,n=0===e?m.focusUp16:e===("LH"===r||"HL"===r?l*l-l:l-1)?m.focusLeft16:e===("LH"===r||"HL"===r?l-1:l*l-l)?m.focusRight16:m.focusDown16;return(0,s.h)("calcite-list-item",null,this.renderIconNode(n),this.renderTextNode(e))}renderIconNode(e){const{layer:i}=a.s,t=!(0,a.j)(i).authoringInfo.focus;return(0,s.h)("div",{slot:"actions-start",class:"label-icon"},(0,s.h)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 16 16",width:"16",height:"16",class:t?"rotate-45":""},(0,s.h)("path",{d:e})))}renderTextNode(e){const{layer:i,strings:t}=a.s,l=(0,a.j)(i),r=l.authoringInfo,n=r.numClasses,o=r.focus,d=l.uniqueValueInfos[e],h=0===e?t.relationshipLegend.accessibility.editLabelForTop:e===("LH"===o||"HL"===o?n*n-n:n-1)?t.relationshipLegend.accessibility.editLabelForLeft:e===("LH"===o||"HL"===o?n-1:n*n-n)?t.relationshipLegend.accessibility.editLabelForRight:t.relationshipLegend.accessibility.editLabelForBottom;return this.selectedLabelText===e?(0,s.h)("calcite-input",{slot:"content",scale:"s",value:d.label,onFocusout:i=>{const t=i.target;this.handleLabelTextChange(e,t.value)},onKeyDown:i=>{if(i.stopPropagation(),"Escape"===i.key||"Enter"===i.key){const t=i.target;this.handleLabelTextChange(e,t.value)}},ref:e=>null==e?void 0:e.setFocus()}):(0,s.h)("div",{class:"label",slot:"content",tabIndex:0,"aria-label":h,onClick:()=>this.handleLabelTextClick(e),onKeyUp:i=>{" "!==i.key&&"Enter"!==i.key||this.handleLabelTextClick(e)},ref:i=>this.valueTextNodes[e]=i},d.label)}getColorOrder(e){const{layer:i}=a.s,t=(0,a.j)(i).authoringInfo||{};let s=[];if(2===t.numClasses)switch(t.focus){case"HH":default:s=0===e?[3,1]:[3,2];break;case"HL":s=0===e?[2,0]:[2,3];break;case"LH":s=0===e?[1,3]:[1,0];break;case"LL":s=0===e?[0,2]:[0,1]}else if(3===t.numClasses)switch(t.focus){case"HH":default:s=0===e?[8,5,2]:[8,7,6];break;case"HL":s=0===e?[6,3,0]:[6,7,8];break;case"LH":s=0===e?[2,5,8]:[2,1,0];break;case"LL":s=0===e?[0,3,6]:[0,1,2]}else switch(t.focus){case"HH":default:s=0===e?[15,11,7,3]:[15,14,13,12];break;case"HL":s=0===e?[12,8,4,0]:[12,13,14,15];break;case"LH":s=0===e?[3,7,11,15]:[3,2,1,0];break;case"LL":s=0===e?[0,4,8,12]:[0,1,2,3]}return s}getSwatch(e){const{layer:i}=a.s,t=(0,a.j)(i);return(0,s.h)("div",{class:"attribute-color-icon-selection",ref:i=>{if(i){const s=(0,a.w)(t.uniqueValueInfos[e].symbol);i.style.width=100/t.authoringInfo.numClasses+"px",i.style.backgroundColor=(null==s?void 0:s.toHex())||"#ffffff"}}})}handleLabelTextClick(e){a.s.selectedValue=e,this.selectedLabelText=e,(0,s.f)(this.hostElement)}handleLabelTextChange(e,i){const{layer:t}=a.s;(0,a.j)(t).uniqueValueInfos[e].label=i,this.selectedLabelText=void 0,(0,a.ab)(),(0,s.f)(this.hostElement),setTimeout((()=>{var i;a.s.selectedValue===e&&(null===(i=this.valueTextNodes[e])||void 0===i||i.focus(),a.s.selectedValue=void 0)}),300)}get hostElement(){return(0,s.d)(this)}};p.style=".attribute{display:flex;padding-bottom:6px}.attributes{margin:12px 0}.attribute-name{padding:0 10px;width:calc(100% - 45px);word-break:break-all}.attribute-color-icon{width:45px;height:16px;overflow:hidden;border-radius:3px;display:flex;align-self:center}.attribute-color-icon-selection{height:16px;display:inline-block}.label{display:flex;padding:6px 0;align-items:center}.label div{display:flex}.label-icon{color:rgba(50, 50, 50, 0.4);display:flex;flex-direction:column;justify-content:center;cursor:default}.label-icon .rotate-45{transform:rotate(45deg)}"},37192:(e,i,t)=>{t.d(i,{w:()=>a});var s=t(59503);function a(e,i){const{layer:t,mapView:a,useFeatureReduction:r}=s.s;if(!r||!("featureReduction"in t)||"binning"!==t.featureReduction.type)return;const n=s.s.modules.reactiveUtils.watch((()=>a.scale),(()=>{const r=t.featureReduction;a.scale<=r.maxScale&&!e.disabled?((0,s.l)(),function(e,i){const t=document.createElement("arcgis-smart-mapping-scale-alert-popover");t.refElement=e,t.addEventListener("arcgisSmartMappingScaleAlertPopoverBack",(()=>{l(),i()})),document.body.append(t)}(e,i),(0,s.m)(e,!0)):a.scale>r.maxScale&&e.disabled&&(l(),(0,s.m)(e,!1),e.setFocus())}));return n}function l(){document.querySelectorAll("arcgis-smart-mapping-scale-alert-popover").forEach((e=>{var i;null===(i=e.parentElement)||void 0===i||i.removeChild(e),e=null}))}t(21104),t(2137)},61886:(e,i,t)=>{let s,a;function l(e){e.loading=!1}function r(e,i){return function(e){e.loading=!0,a=!1,s&&clearTimeout(s),s=setTimeout((()=>{l(e),a=!0}),6e4)}(i),e.then((e=>(l(i),a?Promise.reject(new Error("timeout")):Promise.resolve(e)))).catch((e=>(l(i),Promise.reject(e))))}t.d(i,{r:()=>r})},77419:(e,i,t)=>{t.d(i,{a:()=>n,b:()=>r,g:()=>c,u:()=>l});var s=t(59503),a=(t(21104),t(89393));function l(e){const{layer:i,modules:t}=s.s,l=(0,s.j)(i),r=t.esriLang.clone(l.classBreakInfos);l.classBreakInfos=[],r.forEach(((i,t)=>{i=function(e,i,t,l){if((0,a.i)(i))if(0===i);else if(i<1){const a=Math.round(1/i);e.minValue="first"===l?Math.floor(e.minValue/i)/a:Math.round(e.minValue/i)/a,e.maxValue="last"===l?Math.ceil(e.maxValue/i)/a:Math.round(e.maxValue/i)/a,e.label=`${t>0?"> ":""}${e.minValue.toLocaleString(s.s.fullLocale,{maximumSignificantDigits:15})} - ${e.maxValue.toLocaleString(s.s.fullLocale,{maximumSignificantDigits:15})}`}else e.minValue="first"===l?Math.floor(e.minValue/i)*i:Math.round(e.minValue/i)*i,e.maxValue="last"===l?Math.ceil(e.maxValue/i)*i:Math.round(e.maxValue/i)*i,e.label=(t>0?"> ":"")+e.minValue.toLocaleString()+" - "+e.maxValue.toLocaleString();return e}(i,e,t,0===t?"first":t===r.length-1?"last":void 0),l.addClassBreakInfo({minValue:i.minValue,maxValue:i.maxValue,symbol:i.symbol,label:i.label})}))}function r(e){const{layer:i}=s.s,t=(0,s.j)(i).classBreakInfos;let a=e,l=1/0;t.forEach((e=>{a||(a=Math.max(o(e.minValue),o(e.maxValue))),l=Math.min(l,e.maxValue-e.minValue)}));const r=[];return l>1e7?(r.push(1e7),r.push(1e6),r.push(1e5),r.push(1e4),r.push(1e3),r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01)):l>1e6?(r.push(1e6),r.push(1e5),r.push(1e4),r.push(1e3),r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01)):l>1e5?(r.push(1e5),r.push(1e4),r.push(1e3),r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01)):l>1e4?(r.push(1e4),r.push(1e3),r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01)):l>1e3?(r.push(1e3),r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01),a>3&&r.push(.001)):l>100?(r.push(100),r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01),a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5)):l>10?(r.push(10),a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01),a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6)):l>1?(a>0&&r.push(1),a>1&&r.push(.1),a>2&&r.push(.01),a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6)):l>.1?(a>1&&r.push(.1),a>2&&r.push(.01),a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6)):l>.01?(a>2&&r.push(.01),a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6)):l>.001?(a>3&&r.push(.001),a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6),a>7&&r.push(1e-7)):l>1e-4?(a>4&&r.push(1e-4),a>5&&r.push(1e-5),a>6&&r.push(1e-6),a>7&&r.push(1e-7),a>8&&r.push(1e-8)):l>1e-5&&(a>5&&r.push(1e-5),a>6&&r.push(1e-6),a>7&&r.push(1e-7),a>8&&r.push(1e-8),a>9&&r.push(1e-9)),r}function n(){const{layer:e}=s.s,i=(0,s.j)(e);let t=1e10;return i.classBreakInfos.forEach((e=>{t=Math.min(t,d(e.minValue)),t=Math.min(t,d(e.maxValue))})),t}function o(e){let i=1;for(;Math.round(e*i)/i!==e;)i*=10;return Math.log(i)/Math.LN10}function d(e){let i=1e-8;for(;h(Math.round(e/i)*i)===e;)i*=10;return i/10}function h(e){return parseFloat(e.toPrecision(12))}function c(e){var i,t,s,l,r,n,d,c;let u=0;e.forEach((e=>{(0,a.i)(e.value)?u=Math.max(o(h(e.value)),u):((0,a.i)(e.minValue)&&(u=Math.max(o(h(e.minValue)),u)),(0,a.i)(e.maxValue)&&(u=Math.max(o(h(e.maxValue)),u)),(0,a.i)(e.min)&&(u=Math.max(o(h(e.min)),u)),(0,a.i)(e.max)&&(u=Math.max(o(h(e.max)),u)))})),u=Math.min(u,3);const m=e[0],p=e[e.length-1],f=Math.min(null!==(t=null!==(i=m.minValue)&&void 0!==i?i:m.min)&&void 0!==t?t:m.value,null!==(l=null!==(s=p.minValue)&&void 0!==s?s:p.min)&&void 0!==l?l:p.value),g=Math.max(null!==(n=null!==(r=m.maxValue)&&void 0!==r?r:m.max)&&void 0!==n?n:m.value,null!==(c=null!==(d=p.maxValue)&&void 0!==d?d:p.max)&&void 0!==c?c:p.value)-f;return g/e.length<2e-7?u=8:g/e.length<2e-6?u=7:g/e.length<2e-5?u=6:g/e.length<2e-4?u=5:g/e.length<.002?u=4:g/e.length<.02?u=3:g/e.length<.2?u=Math.max(u,2):g/e.length<2&&(u=Math.max(u,1)),Math.round(u)}},41565:(e,i,t)=>{t.d(i,{a:()=>r,c:()=>l,u:()=>n});var s=t(59503),a=(t(21104),t(89393));function l(e){var i,t;const{layer:l,useFeatureReduction:r,mapImageSublayer:n,mapView:o,modules:d}=s.s,h=l,c=(0,s.g)();let u=e.relationshipScheme;if(!u&&["relationship","relationship-size"].indexOf(c)>-1&&(u=(0,s.a1)()),e=e||{},"relationship-size"===c){const t=(0,s.j)(h).clone(),a=t.authoringInfo;if(a&&(null===(i=e.fieldInfos)||void 0===i?void 0:i.length)>1&&e.fieldInfos[0].field==a.field1.field&&e.fieldInfos[1].field==a.field2.field){if(t.visualVariables=(0,s.q)(t,"size"),t.authoringInfo.visualVariables=(0,s.r)(t,"size"),(0,s.u)(h)){const e=(0,s.T)(h,o),i=t.uniqueValueInfos.slice();i.map((i=>{const t=(0,s.w)(i.symbol);i.symbol=e.clone(),(0,s.v)(i.symbol,t)})),t.uniqueValueInfos=i}return Promise.resolve({renderer:t})}}const m=(0,s.p)((0,s.j)(h)),p={layer:h,view:o,field1:{field:e.fieldInfos[0].field},field2:{field:e.fieldInfos[1].field},classificationMethod:"quantile",numClasses:3,focus:"HH",relationshipScheme:u,outlineOptimizationEnabled:!n&&(!(0,a.i)(e.outlineOptimizationEnabled)||e.outlineOptimizationEnabled),sizeOptimizationEnabled:!n&&(!(0,a.i)(e.sizeOptimizationEnabled)||e.sizeOptimizationEnabled),legendOptions:e.legendOptions,defaultSymbolEnabled:!1,forBinning:"binning"===(null===(t=h.featureReduction)||void 0===t?void 0:t.type)&&r};return d.RelationshipCreator.createRenderer(p).then((e=>((0,s.o)(m,e.renderer),Promise.resolve(e))),(e=>Promise.reject(e)))}function r(e){var i;const{layer:t,useFeatureReduction:l,mapImageSublayer:r,mapView:n,modules:o}=s.s,d=t;e=e||{};const h=(0,s.j)(d),c=(0,s.g)(),u=h.authoringInfo,m=(0,s.a)(h,"size");if(e.fieldInfos&&e.fieldInfos.length>1&&e.fieldInfos[0].field==u.field1.field&&e.normalizationField1===u.field1.normalizationField&&e.fieldInfos[1].field==u.field2.field&&e.normalizationField2===u.field2.normalizationField&&(delete e.fieldInfos,delete e.normalizationField1,delete e.normalizationField2,(0,s.S)(e)&&!m))return Promise.resolve({renderer:h.clone()});let p=e.relationshipScheme;!p&&["relationship","relationship-size"].indexOf(c)>-1&&(p=(0,s.a1)());const f=(0,s.p)(h);let g=e.fieldInfos?e.fieldInfos[0]:{field:u.field1.field,simpleFieldType:s.z.NUMBER},b=e.fieldInfos?e.fieldInfos[1]:{field:u.field2.field,simpleFieldType:s.z.NUMBER};const S=void 0!==e.normalizationField1?e.normalizationField1:u.field1.normalizationField,v=void 0!==e.normalizationField2?e.normalizationField2:u.field2.normalizationField,C=h.uniqueValueInfos&&h.uniqueValueInfos.length?h.uniqueValueInfos[0].symbol:null,y=h.defaultSymbol,x=h.defaultLabel,L=e.numClasses?e.numClasses:u.numClasses;return o.RelationshipCreator.createRenderer({layer:d,view:n,field1:{field:g?g.field:h.field,normalizationField:S},field2:{field:b?b.field:h.field,normalizationField:v},classificationMethod:e.classificationMethod?e.classificationMethod:"manual"!==u.classificationMethod?u.classificationMethod:"quantile",numClasses:L,focus:e.focus?e.focus:u.focus,relationshipScheme:p,outlineOptimizationEnabled:!r&&((0,a.i)(e.outlineOptimizationEnabled)?e.outlineOptimizationEnabled:!!f.sizeOutlineVisVar),sizeOptimizationEnabled:!r&&((0,a.i)(e.sizeOptimizationEnabled)?e.sizeOptimizationEnabled:!!f.sizeAutoVisVar),legendOptions:e.legendOptions?e.legendOptions:h.legendOptions,defaultSymbolEnabled:(0,a.i)(e.defaultSymbolEnabled)?e.defaultSymbolEnabled:!!h.defaultSymbol,forBinning:"binning"===(null===(i=d.featureReduction)||void 0===i?void 0:i.type)&&l}).then((e=>((0,s.o)(f,e.renderer),C&&e.renderer.uniqueValueInfos.forEach((e=>{const i=C.clone();(0,s.v)(i,(0,s.w)(e.symbol)),e.symbol=i})),(0,s.j)(d).uniqueValueInfos.forEach((i=>{const t=e.renderer.uniqueValueInfos.find((e=>i.value===e.value));t&&(t.label=i.label)})),y&&(e.renderer.defaultSymbol=y,e.renderer.defaultLabel=x),Promise.resolve(e))),(e=>Promise.reject(e)))}function n(e){const{layer:i,modules:t}=s.s;e=e||{};const a=(0,s.j)(i),l=a.authoringInfo;return t.RelationshipCreator.updateRenderer({field1:l.field1,field2:l.field2,numClasses:e.numClasses?e.numClasses:l.numClasses,focus:e.focus?"none"===e.focus?null:e.focus:l.focus,colors:e.colors,renderer:a})}},99258:(e,i,t)=>{t.d(i,{b:()=>a,u:()=>l});var s=t(59503);function a(e,i,t,s,a){const l=(null==e?void 0:e.length)?n(e,i.bins[s]):r(e.stops,i.bins[s]);l&&a.setAttribute("fill",l.toHex()),l&&a.setAttribute("opacity",`${Math.max(l.a,.2)}`),t.push(a)}function l(e,i,t,s){null==i||i.forEach(((i,a)=>{const l=(s||e.histogramConfig).bins[a],o=e.breaks?n(t||e.breaks,l):r((t||e).stops,l);o&&i.setAttribute("fill",o.toHex()),o&&i.setAttribute("opacity",`${Math.max(o.a,.2)}`)}))}function r(e,i){const{modules:t}=s.s;if(!i)return;const a=(i.maxValue-i.minValue)/2+i.minValue;let l=e[0],r=e[e.length-1];const n=l.value,o=r.value;if(a<n)return l.color;if(a>o)return r.color;const d=e.filter((e=>e.value===a));if(d.length>0)return d[0].color;l=null,r=null,e.forEach(((i,t)=>{!l&&!r&&i.value>=a&&(l=e[t-1],r=i)}));const h=(a-l.value)/(r.value-l.value);return t.esriColor.blendColors(l.color,r.color,h)}function n(e,i){if(!i)return;const t=(i.maxValue-i.minValue)/2+i.minValue;let s=e[0],a=e[e.length-1];if(t<s.min||t>a.max)return;const l=e.filter((e=>e.min===t));return l.length>0?l[0].color:(s=e[e.length-1],a=null,e.forEach(((i,l)=>{!a&&i.min>=t&&(s=e[l-1],a=i)})),s.color)}t(21104),t(2137)}}]);
System.register(["jimu-core","jimu-arcgis"],(function(t,e){var a={},n={};return{setters:[function(t){a.AbstractDataAction=t.AbstractDataAction,a.DataLevel=t.DataLevel,a.DataSourceStatus=t.DataSourceStatus,a.MutableStoreManager=t.MutableStoreManager,a.getAppStore=t.getAppStore,a.i18n=t.i18n,a.utils=t.utils},function(t){n.ActionType=t.ActionType,n.MapViewManager=t.MapViewManager,n.SHOW_ON_MAP_DATA_ID_PREFIX=t.SHOW_ON_MAP_DATA_ID_PREFIX}],execute:function(){t((()=>{"use strict";var t={26826:t=>{t.exports=n},48891:t=>{t.exports=a}},e={};function o(a){var n=e[a];if(void 0!==n)return n.exports;var i=e[a]={exports:{}};return t[a](i,i.exports,o),i.exports}o.d=(t,e)=>{for(var a in e)o.o(e,a)&&!o.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:e[a]})},o.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),o.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var i={};return(()=>{o.r(i),o.d(i,{default:()=>n});var t=o(48891),e=o(26826);var a=function(t,e,a,n){return new(a||(a=Promise))((function(o,i){function r(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof a?e:new a((function(t){t(e)}))).then(r,u)}s((n=n.apply(t,e||[])).next())}))};class n extends t.AbstractDataAction{constructor(){super(...arguments),this._viewManager=e.MapViewManager.getInstance()}isSupported(e,n){return a(this,void 0,void 0,(function*(){if(e.length>1)return!1;const a=e[0],{records:o,dataSource:i}=a;return!(!i||i.getStatus()===t.DataSourceStatus.NotReady)&&n===t.DataLevel.Records&&(null==o?void 0:o.length)>0&&o.some((t=>{var e;return null===(e=t.feature)||void 0===e?void 0:e.geometry}))}))}onExecute(n,o,i,r){var u;return a(this,void 0,void 0,(function*(){const a=this._getActiveViewId(this.widgetId,(0,t.getAppStore)().getState().jimuMapViewsInfo),o=(null===(u=t.MutableStoreManager.getInstance().getStateValue([this.widgetId]))||void 0===u?void 0:u.showOnMapDatas)||{},i=n[0],s=this.getUniqueTitleCountInfo(i,a,o),c=`${e.SHOW_ON_MAP_DATA_ID_PREFIX}dataAction_${t.utils.getUUID()}`;let l;l=r?r.isUseCustomSymbol?r.symbolOption:!1===r.isUseCustomSymbol?null:void 0:void 0;const d={mapWidgetId:this.widgetId,messageWidgetId:void 0,jimuMapViewId:a,dataSet:i,type:e.ActionType.DataAction,symbolOption:l,title:s.finalTitle,titleCountInfo:s};return o[c]=d,t.MutableStoreManager.getInstance().updateStateValue(this.widgetId,"showOnMapDatas",o),yield Promise.resolve(!0)}))}getUniqueTitleCountInfo(a,n,o){const i=t.i18n.getIntl(),r=a.name||i.formatMessage({id:"showOnMapData",defaultMessage:"Show on map data"}),u=[];Object.values(o).forEach((t=>{const a=t.titleCountInfo;t.jimuMapViewId===n&&t.type===e.ActionType.DataAction&&a&&a.rawTitle===r&&a.count>=0&&u.push(a.count)}));let s=null;if(u.length>0){const t=Math.max(...u);s={rawTitle:r,finalTitle:`${r} ${t+1}`,count:t+1}}else s={rawTitle:r,finalTitle:r,count:1};return s}_getActiveViewId(t,e){let a=Object.keys(e||{}).find((a=>e[a].mapWidgetId===t&&e[a].isActive));return a||(a=Object.keys(e||{}).find((a=>e[a].mapWidgetId===t))),a}}})(),i})())}}}));
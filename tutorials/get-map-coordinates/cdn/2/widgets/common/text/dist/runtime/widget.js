System.register(["jimu-core","jimu-theme","jimu-ui"],(function(e,t){var a={},o={},r={};return{setters:[function(e){a.AppMode=e.AppMode,a.BaseVersionManager=e.BaseVersionManager,a.ExpressionResolverComponent=e.ExpressionResolverComponent,a.Immutable=e.Immutable,a.MutableStoreManager=e.MutableStoreManager,a.React=e.React,a.ReactRedux=e.ReactRedux,a.appActions=e.appActions,a.classNames=e.classNames,a.expressionUtils=e.expressionUtils,a.getAppStore=e.getAppStore,a.hooks=e.hooks,a.polished=e.polished},function(e){o.styled=e.styled,o.useTheme=e.useTheme},function(e){r.RichTextDisplayer=e.RichTextDisplayer,r.Scrollable=e.Scrollable,r.richTextUtils=e.richTextUtils}],execute:function(){e((()=>{var e={17663:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M2.854 2.153a.485.485 0 0 0-.708 0 .54.54 0 0 0 0 .738l5.5 5.956a.485.485 0 0 0 .708 0l5.5-5.956a.54.54 0 0 0 0-.738.485.485 0 0 0-.708 0L8 7.74zm0 5a.485.485 0 0 0-.708 0 .54.54 0 0 0 0 .738l5.5 5.956a.485.485 0 0 0 .708 0l5.5-5.956a.54.54 0 0 0 0-.738.485.485 0 0 0-.708 0L8 12.74z" clip-rule="evenodd"></path></svg>'},79244:e=>{"use strict";e.exports=a},1888:e=>{"use strict";e.exports=o},14321:e=>{"use strict";e.exports=r}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var r=t[a]={exports:{}};return e[a](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var l={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(l),n.d(l,{__set_webpack_public_path__:()=>S,default:()=>x});var e=n(79244),t=n(17663),a=n.n(t),o=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(a[o[r]]=e[o[r]])}return a};const r=t=>{const r=window.SVG,{className:n}=t,l=o(t,["className"]),s=(0,e.classNames)("jimu-icon jimu-icon-component",n);return r?e.React.createElement(r,Object.assign({className:s,src:a()},l)):e.React.createElement("svg",Object.assign({className:s},l))};var s=n(1888),i=n(14321),c=function(e,t){var a={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(a[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var r=0;for(o=Object.getOwnPropertySymbols(e);r<o.length;r++)t.indexOf(o[r])<0&&Object.prototype.propertyIsEnumerable.call(e,o[r])&&(a[o[r]]=e[o[r]])}return a};const u=(0,s.styled)("div")((({theme:t,styleState:a})=>{var o;return{width:"100%",height:"100%",position:"relative",overflowY:"hidden",".rich-displayer":Object.assign(Object.assign({width:"100%",height:"fit-content",lineHeight:1.42},!a.wrap&&{whiteSpace:"preserve nowrap !important"}),{"a:focus":{outlineOffset:"-3px",outlineWidth:"2px"}}),".text-fade":{position:"absolute",left:"0",height:a.fadeLength,width:"100%",display:"flex",alignItems:"center",justifyContent:"flex-end",pointerEvents:"none","> .arrow":{position:"absolute",width:"16px",height:"16px",background:t.ref.palette.white,overflow:"hidden",display:"flex",alignItems:"center",justifyContent:"center","&.arrow-bottom":{bottom:"4px"}},"&.text-fade-bottom":{bottom:"0",background:`linear-gradient(180deg, rgba(182, 182, 182, 0) 0%, ${e.polished.rgba(null!==(o=t.ref.palette.neutral[500])&&void 0!==o?o:"#444",.5)} 100%)`}},".bounce":{animationName:"bounce",animationDuration:"0.6s",animationIterationCount:"infinite",animationTimingFunction:"linear"},"@keyframes bounce":{"0%":{transform:"translateY(0px)"},"50%":{transform:"translateY(2px)"},"100%":{transform:"translateY(4px)"}}}}));function d(t){var a;const{value:o="",placeholder:n,repeatedDataSource:l,useDataSources:d,widgetId:p,wrap:g,tooltip:f}=t,m=c(t,["value","placeholder","repeatedDataSource","useDataSources","widgetId","wrap","tooltip"]),h=e.React.useMemo((()=>o.replace(/\ufeff/g,"")),[o]),v=(0,s.useTheme)(),b=e.React.useRef(),x=e.expressionUtils.isSingleStringExpression(f),[S,R]=e.React.useState(""),[w,y]=e.React.useState("24px"),[E,M]=e.React.useState(!1),[O,j]=e.React.useState(!1),[I,D]=e.React.useState(0),[N,k]=e.React.useState(!1),C=e.React.useCallback((e=>{if(null==e)return;const{scrollable:t,bottoming:a}=e;M(a),j(t)}),[]);e.React.useEffect((()=>{var t;if(null!=f&&x){const a=null!==(t=e.expressionUtils.getSingleStringExpressionText(f))&&void 0!==t?t:f.name;R(a)}}),[f,x]);const A=e.React.useRef();return e.React.createElement(u,Object.assign({styleState:{wrap:g,fadeLength:w},title:S,onMouseEnter:()=>{var e,t;null!=A.current&&(clearTimeout(A.current),A.current=null);const a=(o=null!==(t=null===(e=b.current)||void 0===e?void 0:e.clientHeight)&&void 0!==t?t:0)<=80?"0px":o<=140?"24px":"15%";var o;k("0px"!==a),D((e=>e+1)),y(a)},onMouseLeave:()=>{A.current=setTimeout((()=>{k(!1),A.current=null}),500)},ref:b},m),e.React.createElement(i.Scrollable,{ref:C,version:I},e.React.createElement(i.RichTextDisplayer,{widgetId:p,repeatedDataSource:l,useDataSources:d,value:h,placeholder:n})),N&&O&&!E&&e.React.createElement("div",{className:"text-fade text-fade-bottom"},e.React.createElement("span",{className:"arrow arrow-bottom rounded-circle mr-1"},e.React.createElement(r,{className:"bounce",color:null===(a=null==v?void 0:v.ref.palette)||void 0===a?void 0:a.black}))),!x&&f&&e.React.createElement(e.ExpressionResolverComponent,{useDataSources:d,expression:f,widgetId:p,onChange:e=>{(null==e?void 0:e.isSuccessful)?R(e.value):R("")}}))}const p={_widgetLabel:"Text",defaultPlaceholder:"Double click to edit text"},g=JSON.parse('{"Qq":"<p></p>","qf":"Double click to edit text","iF":{"wrap":true}}');class f extends e.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.13.0",description:"Remove useless line-height: normal;",upgrader:e=>{var t;let a=null!==(t=e.text)&&void 0!==t?t:"";return a.includes("line-height: normal;")?(a=a.replace(/line-height: normal;/gm,"line-height: 1.2;"),e.set("text",a)):e}},{version:"1.17.0",description:"Complete the default config",upgrader:e=>{let t=e;return t.text||(t=t.set("text",g.Qq)),t.placeholder||(t=t.set("placeholder",g.qf)),t.style||(t=t.set("style",g.iF)),t}}]}}const m=new f;var h;!function(e){e[e.None=0]="None",e[e.Main=1]="Main",e[e.Sub=2]="Sub"}(h||(h={}));const v=(e,t)=>(e===p.defaultPlaceholder&&(e=((e,t)=>null!==t?t.formatMessage({id:e,defaultMessage:p[e]}):"")("defaultPlaceholder",t)),e),b=t=>{var a,o,r,n;const{builderSupportModules:l,id:s,intl:c,useDataSources:u,repeatedDataSource:p,useDataSourcesEnabled:g,isInlineEditing:f,config:m,onInitResizeHandler:b}=t,x=e.ReactRedux.useDispatch(),{current:S}=e.React.useRef((0,e.getAppStore)().getState().appContext.isInBuilder),R=e.hooks.useWidgetSelected(s),w=e.hooks.useLatest(R),y=e.ReactRedux.useSelector((e=>e.appRuntimeInfo.appMode)),E=null==l?void 0:l.jimuForBuilderLib.getAppConfigAction,M=null==l?void 0:l.widgetModules.Editor,O=null==l?void 0:l.widgetModules.builderUtils,j=null===(o=null===(a=m.style)||void 0===a?void 0:a.wrap)||void 0===o||o,I=null===(r=m.style)||void 0===r?void 0:r.color,D=m.text,N=m.tooltip,k=v(m.placeholder,c),C=g?u:void 0,A=null!==(n=null==C?void 0:C.length)&&void 0!==n?n:0,[T,P]=e.React.useState(null),U=e.React.useRef(!1),_=e.React.useMemo((()=>{let e=h.Sub;return e=null==p?h.None:0===p.recordIndex?h.Main:h.Sub,e}),[p]),L=e.hooks.useLatest(_!==h.Sub);e.React.useEffect((()=>{L.current&&w.current&&y===e.AppMode.Run&&x(e.appActions.setWidgetIsInlineEditingState(s,!1))}),[L,w,y,x,s]),e.hooks.useUpdateEffect((()=>{L.current&&S&&(f||x(e.appActions.widgetStatePropChange(s,"showExpression",!1)))}),[L,f,x,s]);const B=(y===e.AppMode.Design||y===e.AppMode.Express)&&_!==h.Sub,F=B&&R,V=B&&f,W=e.React.useRef(!1);e.React.useEffect((()=>()=>{W.current=!0}),[]),e.hooks.useUpdateEffect((()=>{if(!L.current)return;let t=i.richTextUtils.getAllExpressions(D);t=null!=t?t:(0,e.Immutable)({}),t=t.merge(null!=N?{tooltip:N}:{}),(U.current||0!==Object.keys(t).length)&&(U.current=Object.keys(t).length>0,P(t))}),[L,D,N,A]);const H=e.hooks.useEventCallback((()=>{if(W.current)return;if(!S)return;const t=O.getExpressionParts(T),a=e.expressionUtils.generateFieldsForUseDataSourcesByExpressionParts(t,C);((e,t)=>{if(!e||!t)return!1;if(e.length!==t.length)return!1;let a=!0;return e.forEach(((e,o)=>{var r,n,l,s,i;e.dataSourceId===t[o].dataSourceId&&(null===(n=null!==(r=e.fields)&&void 0!==r?r:[])||void 0===n?void 0:n.length)===(null===(s=null!==(l=t[o].fields)&&void 0!==l?l:[])||void 0===s?void 0:s.length)?null===(i=e.fields)||void 0===i||i.forEach(((e,r)=>{e!==t[o].fields[r]&&(a=!1)})):a=!1})),a})(C,a)||E((0,e.getAppStore)().getState().appConfig).editWidget({id:s,useDataSources:null==a?void 0:a.asMutable({deep:!0})}).exec()}));return e.hooks.useUpdateEffect((()=>{H()}),[T,H]),e.React.createElement("div",{"data-testid":"text-widget",style:{minHeight:"12px",color:I},className:(0,e.classNames)("widget-text jimu-widget p-1")},F&&e.React.createElement(M,{className:(0,e.classNames)({"d-none":!V}),widgetId:s,nowrap:!j,onInitResizeHandler:b,useDataSources:C,enabled:!!f,onCreate:t=>{e.MutableStoreManager.getInstance().updateStateValue(s,"editor",t)},onDestroy:()=>{e.MutableStoreManager.getInstance().updateStateValue(s,"editor",null)},onComplete:(e,t)=>{W.current||S&&E().editWidget({id:s,config:m.set("text",e).set("placeholder",t)}).exec()},onEditorFocus:()=>{x(e.appActions.widgetToolbarStateChange(s,["text-inline-editing"]))},placeholder:k,preserveWhitespace:!0,value:D}),e.React.createElement(d,{className:(0,e.classNames)({"d-none":V}),value:D,tooltip:N,wrap:j,placeholder:k,useDataSources:C,widgetId:s,repeatedDataSource:p}))};b.versionManager=m;const x=b;function S(e){n.p=e}})(),l})())}}}));
System.register(["jimu-theme","jimu-core","jimu-arcgis","calcite-components","jimu-ui","widgets/shared-code/lrs","jimu-core/react","jimu-ui/advanced/map"],(function(e,t){var n={},o={},r={},i={},a={},s={},l={},u={};return{setters:[function(e){n.registerStyles=e.registerStyles,n.useTheme=e.useTheme,n.withStyles=e.withStyles,n.withTheme=e.withTheme},function(e){o.DataSourceManager=e.DataSourceManager,o.DataSourceTypes=e.DataSourceTypes,o.JimuFieldType=e.JimuFieldType,o.React=e.React,o.ReactRedux=e.ReactRedux,o.SessionManager=e.SessionManager,o.WidgetState=e.WidgetState,o.classNames=e.classNames,o.css=e.css,o.dataSourceUtils=e.dataSourceUtils,o.esri=e.esri,o.getAppStore=e.getAppStore,o.hooks=e.hooks,o.jsx=e.jsx,o.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,o.polished=e.polished,o.utils=e.utils},function(e){r.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules},function(e){i.CalciteButton=e.CalciteButton,i.CalciteInputDatePicker=e.CalciteInputDatePicker,i.CalciteTable=e.CalciteTable,i.CalciteTableCell=e.CalciteTableCell,i.CalciteTableHeader=e.CalciteTableHeader,i.CalciteTableRow=e.CalciteTableRow},function(e){a.Alert=e.Alert,a.Button=e.Button,a.Checkbox=e.Checkbox,a.FloatingPanel=e.FloatingPanel,a.Icon=e.Icon,a.Label=e.Label,a.Popper=e.Popper,a.Select=e.Select,a.TextInput=e.TextInput,a.Tooltip=e.Tooltip,a.defaultMessages=e.defaultMessages},function(e){s.fetchEnterpriseContingentValues=e.fetchEnterpriseContingentValues,s.fetchEnterpriseFieldGroup=e.fetchEnterpriseFieldGroup,s.fieldsWithContingentValues=e.fieldsWithContingentValues,s.getContingentOptions=e.getContingentOptions,s.normalizeFieldName=e.normalizeFieldName,s.setContingentValues=e.setContingentValues,s.validateContingencyConstraints=e.validateContingencyConstraints},function(e){l.default=e.default},function(e){u.DrawingElevationMode3D=e.DrawingElevationMode3D}],execute:function(){e((()=>{var e={8547:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M7.5 0A3.5 3.5 0 0 1 11 3.5V6h1a1 1 0 0 1 1 1v8a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V7a1 1 0 0 1 1-1h1V3.5A3.5 3.5 0 0 1 7.5 0M5 6h5V3.5a2.5 2.5 0 0 0-2.336-2.495L7.5 1a2.5 2.5 0 0 0-2.495 2.336L5 3.5zm6 1H3v8h9V7zm-3.5 5a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3" clip-rule="evenodd"></path></svg>'},28996:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M8 2.125 14.334 14H1.667zm-.882-.47a1 1 0 0 1 1.765 0l6.333 11.874A1 1 0 0 1 14.334 15H1.667a1 1 0 0 1-.882-1.47zM8 4.874a.905.905 0 0 0-.9.995l.35 3.507a.552.552 0 0 0 1.1 0L8.9 5.87a.905.905 0 0 0-.9-.995m1 7a1 1 0 1 1-2 0 1 1 0 0 1 2 0" clip-rule="evenodd"></path></svg>'},99037:e=>{"use strict";e.exports=i},62686:e=>{"use strict";e.exports=r},79244:e=>{"use strict";e.exports=o},68972:e=>{"use strict";e.exports=l},1888:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=a},48993:e=>{"use strict";e.exports=u},47626:e=>{"use strict";e.exports=s}},t={};function c(n){var o=t[n];if(void 0!==o)return o.exports;var r=t[n]={exports:{}};return e[n](r,r.exports,c),r.exports}c.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return c.d(t,{a:t}),t},c.d=(e,t)=>{for(var n in t)c.o(t,n)&&!c.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},c.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),c.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.p="";var d={};return c.p=window.jimuConfig.baseUrl,(()=>{"use strict";c.r(d),c.d(d,{AttributeTable:()=>Sr,ConvertUnits:()=>ee,CopyAttributeTool:()=>li,GetEsriUnits:()=>oe,GetSRUnits:()=>te,GetUnits:()=>ne,InlineEditableDropdown:()=>Nr,Intellisense:()=>Lr,IntellisenseTextInput:()=>Or,LockAcquireStatus:()=>Pr,LockAction:()=>$r,LockManagerComponent:()=>ai,LockReleaseStatus:()=>Cr,LocksEndpointType:()=>_r,LrsApplyEdits:()=>Ye,LrsLayerType:()=>Ci,QueryLock:()=>Br,QueryMapPointWithMeasureOnRoute:()=>Ke,QueryMeasureOnRoute:()=>Je,QueryPolylineOnRoute:()=>Xe,QueryRouteMeasures:()=>He,QueryRouteMeasuresAndDistances:()=>Qe,ReleasableStatus:()=>Vr,RoutePicker:()=>ot,RoutePickerPopup:()=>it,SearchMethod:()=>Vi,VMSEndpoints:()=>Ur,acquireLock:()=>zr,atOrBetween:()=>Ie,colorBlack:()=>je,colorCyan:()=>Me,convertStationToNumber:()=>fe,createFeatureLayer:()=>di,createField:()=>gi,createLabelLayer:()=>Ai,errorMessageDelay:()=>Le,fetchEnterpriseContingentValues:()=>Ni,fetchEnterpriseFieldGroup:()=>Si,fieldsWithContingentValues:()=>Ei,findFieldByName:()=>pi,findFieldByType:()=>mi,flash:()=>Se,formatMessage:()=>X,getAttributeSets:()=>Hi,getBaseURL:()=>ni,getCalciteBasicTheme:()=>xe,getCalciteButtonWithIconTheme:()=>Te,getCalciteNoticeTheme:()=>De,getContingentOptions:()=>Li,getDateToUTC:()=>de,getDateWithTZOffset:()=>Fe,getDateWithoutTZOffset:()=>Re,getEventInfoFromResults:()=>Wi,getExistingFieldNames:()=>yi,getFeatureLayer:()=>Ze,getGDBVersion:()=>ye,getGeometryGraphic:()=>Oe,getHoverGraphic:()=>Pe,getInitialEventInfoState:()=>pe,getInitialRouteInfoState:()=>me,getInitialRouteMeasurePickerInfoState:()=>he,getIntialLocksInfo:()=>Yr,getLayer:()=>fi,getLocalTimeOffset:()=>Ne,getLrsRequestUrl:()=>qi,getMapAllLayers:()=>Gi,getNetworkFields:()=>vi,getNetworkInfoFromResults:()=>zi,getNetworkOutFields:()=>ae,getPolylineMidPoint:()=>Oi,getRouteFromEndMeasures:()=>ie,getSimpleLineGraphic:()=>Ue,getSimplePointGraphic:()=>_e,getSuggestions:()=>ce,getUniqueUrls:()=>Bi,getUserSession:()=>ve,getVersionGuid:()=>Kr,highlightColor:()=>Ee,isCodedDomain:()=>dt,isConflictPreventionEnabled:()=>oi,isDate:()=>ut,isDefaultVersion:()=>ge,isDefined:()=>re,isInWidgetController:()=>ke,isNumber:()=>ct,isParentNetworkAvailable:()=>Qi,isRangeDomain:()=>ft,isWithinTolerance:()=>be,messages:()=>Z,normalizeFieldName:()=>Ti,queryAllRoutesByLineId:()=>le,queryEventsByEventObjectIds:()=>Be,queryEventsByRouteIdOrEventObjectId:()=>qe,queryLineId:()=>We,queryRouteId:()=>et,queryRouteIdOrName:()=>ue,queryRouteIds:()=>tt,queryRoutes:()=>ze,queryRoutesByLineId:()=>se,releaseLock:()=>Qr,removeLabelLayer:()=>Mi,requestService:()=>Ge,resolveFieldName:()=>hi,setContingentValues:()=>xi,setRouteInfoByRouteIdOrName:()=>Ui,shouldQueryRouteLock:()=>Zr,shouldTryAcquireLock:()=>Xr,tryAutoReconcile:()=>Jr,tryReleaseLock:()=>Hr,tryReleaseLockOnDefault:()=>Wr,validateContingencyConstraints:()=>wi,validateField:()=>st,validateRangeDomain:()=>lt});var e={};c.r(e),c.d(e,{AttributeTable:()=>o});var t=c(1888),n=c(79244);const o=()=>n.css`
    flex: 1 1 auto;
    display: flex;
    flex-direction: column;

    .calcite-attribute-table {
      width: 100%;
      flex: 1 1 auto;
      max-height: 87vh;
      overflow: auto;
      height: 100%
    }
    .table-container {
      overflow-x: hidden;
    }
    .calcite-table {
      width: 100%;
    }
    .cell-error {
      border-left: 6px solid red;
    }

  `;var r=c(62686);const i="object"==typeof global&&global&&global.Object===Object&&global;var a="object"==typeof self&&self&&self.Object===Object&&self;const s=i||a||Function("return this")();var l=/\s/;const u=function(e){for(var t=e.length;t--&&l.test(e.charAt(t)););return t};var f=/^\s+/;const m=function(e){return e?e.slice(0,u(e)+1).replace(f,""):e};const p=function(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)};const h=s.Symbol;var v=Object.prototype,y=v.hasOwnProperty,g=v.toString,b=h?h.toStringTag:void 0;const I=function(e){var t=y.call(e,b),n=e[b];try{e[b]=void 0;var o=!0}catch(e){}var r=g.call(e);return o&&(t?e[b]=n:delete e[b]),r};var S=Object.prototype.toString;const N=function(e){return S.call(e)};var w=h?h.toStringTag:void 0;const R=function(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":w&&w in Object(e)?I(e):N(e)};const F=function(e){return null!=e&&"object"==typeof e};const k=function(e){return"symbol"==typeof e||F(e)&&"[object Symbol]"==R(e)};var x=/^[-+]0x[0-9a-f]+$/i,T=/^0b[01]+$/i,D=/^0o[0-7]+$/i,L=parseInt;const E=function(e){if("number"==typeof e)return e;if(k(e))return NaN;if(p(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=p(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=m(e);var n=T.test(e);return n||D.test(e)?L(e.slice(2),n?2:8):x.test(e)?NaN:+e};var j=1/0;const M=function(e){return e?(e=E(e))===j||e===-1/0?17976931348623157e292*(e<0?-1:1):e==e?e:0:0===e?e:0};const A=function(e){var t=M(e),n=t%1;return t==t?n?t-n:t:0};const O=function(e,t){for(var n=-1,o=null==e?0:e.length,r=Array(o);++n<o;)r[n]=t(e[n],n,e);return r};const P=Array.isArray;var C=h?h.prototype:void 0,V=C?C.toString:void 0;const _=function e(t){if("string"==typeof t)return t;if(P(t))return O(t,e)+"";if(k(t))return V?V.call(t):"";var n=t+"";return"0"==n&&1/t==-1/0?"-0":n};const U=function(e){return null==e?"":_(e)};var $=s.isFinite,G=Math.min;const q=function(e){var t=Math[e];return function(e,n){if(e=E(e),(n=null==n?0:G(A(n),292))&&$(e)){var o=(U(e)+"e").split("e"),r=t(o[0]+"e"+(+o[1]+n));return+((o=(U(r)+"e").split("e"))[0]+"e"+(+o[1]-n))}return t(e)}}("round");var B=c(99037),z=c(14321),W=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};const H=1e3;var Q;function J(e,t,o){return W(this,void 0,void 0,(function*(){const r={jimuName:e,type:n.JimuFieldType.String,esriType:Q.String,name:e,alias:e,format:null};return function(e,t,o){return W(this,void 0,void 0,(function*(){const r={searchText:e,searchFields:o.map((e=>e.name)),dataSource:t,maxSuggestions:H};return n.dataSourceUtils.querySuggestions(r).then((e=>{const t={suggestionItem:null==e?void 0:e.map((e=>Object.assign(Object.assign({},e),{isFromSuggestion:!0}))),layer:null,icon:null};return Promise.resolve(t)})).catch((e=>Promise.resolve({suggestionItem:[],layer:null,icon:null})))}))}(t,o,[r])}))}!function(e){e.Blob="esriFieldTypeBlob",e.Date="esriFieldTypeDate",e.Double="esriFieldTypeDouble",e.Geometry="esriFieldTypeGeometry",e.GlobalID="esriFieldTypeGlobalID",e.GUID="esriFieldTypeGUID",e.Integer="esriFieldTypeInteger",e.OID="esriFieldTypeOID",e.Raster="esriFieldTypeRaster",e.Single="esriFieldTypeSingle",e.SmallInteger="esriFieldTypeSmallInteger",e.String="esriFieldTypeString",e.XML="esriFieldTypeXML"}(Q||(Q={}));const K={eventRequiredLabel:"Event *",networkRequiredLabel:"Network *",routeIdRequiredLabel:"Route ID *",routeNameRequiredLabel:"Route Name *",startDateRequiredLabel:"Start Date *",nullLabel:"null",fieldInfo:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}",fieldInfoWithError:"Name: {name}\nAlias: {alias}\nType: {type}\nNullable: {nullable}\nDefault Value: {default}\nEditable: {editable}\nError: {error}",fieldTypeWithLength:"{fieldType} ({length})",attributeError:"{fieldValue}: {message}",nonNullable:"Value cannot be null.",invalidShort:"Invalid value for short data type.",invalidInteger:"Invalid value for long data type.",invalidSingle:"Invalid value for float data type.",invalidDouble:"Invalid value for double data type.",invalidString:"Value exceeds maximum length of field",invalidDate:"Invalid date.",invalidRange:"Value exceeds min or max values of range.",contingentValueError:"Invalid contingent value in the field",selectRouteLabel:"Select Route",routePicker:"Route Picker",routeNameLabel:"Route Name",routeIdLabel:"Route ID",fromRouteNameLabel:"From Route Name",fromRouteIdLabel:"From Route ID",toRouteNameLabel:"To Route Name",toRouteIdLabel:"To Route ID",fromDateLabel:"From Date",toDateLabel:"To Date",measureLabel:"Measure",fromMeasureLabel:"From Measure",toMeasureLabel:"To Measure",noResult:"No Results",copyAttributes:"Copy Attributes",noLrsLayersTips:"No LRS layers are present in the selected map. Select a map with LRS Network and Event layers present in the webmap.",multipleServicesTips:"Map contains layers from more than one feature service. Select a map with LRS Network and Event layers coming from a single feature service.",noNetworkLayersTips:"No LRS Network layers are present in the selected map. Select a map with at least one LRS network layer present in the web map.",noMapSelectedTips:"Select a map.",displaySettings:"Display Settings",hideNetwork:"Hide Network",hideEvent:"Hide Event",hideMethod:"Hide Method",hideRoute:"Hide Route in Search by Line",hideType:"Hide Type",hideAttributeSet:"Hide Attribute Set",hideMeasures:"Hide Measures",hideDates:"Hide Dates",useRoutesStartEndDates:"Use Routes Start and End Dates",useRoutesStartEndDatesTooltip:"Routes start/end dates will be used for new events. If disabled, the current date will be used.",selectMap:"Select Map",loadLayers:"Load layers",clearLayers:"Clear layers",removeLayer:"Remove",missingParentNetwork:"Parent network is missing",inches:"Inches (US Survey)",feet:"Feet (US Survey)",yards:"Yards (US Survey)",miles:"Miles (US Survey)",nauticalMiles:"Nautical miles (US Survey)",points:"Points",millimeters:"Millimeters",centimeters:"Centimeters",meters:"Meters",kilometers:"Kilometers",decimalDegrees:"Decimal degrees",decimeters:"Decimeters",intFeet:"Feet (International)",esriUnknownUnits:"esriUnknownUnits",invalidRouteField:"Route could not be found with provided value",CannotAcquireLockUserAndVersion:"Cannot acquire lock because {user} has the lock in version {version}.",UnavailableLockOnLine:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnRoute:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in version {version}.",UnavailableLockOnLineWithoutVersion:"Line {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",UnavailableLockOnRouteWithoutVersion:"Route {nameOrId} ({networkName}) is already locked by {lockUser} in a different service.",YouAcquiredLockOnLine:"You have acquired a lock on line {nameOrId} ({networkName}) in version {version}.",YouAcquiredLockOnRoute:"You have acquired a lock on route {nameOrId} ({networkName}) in version {version}.",ReconcileRequired:"The default version has changed. Reconcile this version with the default version in order to acquire locks."};var Y=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};const Z=Object.assign({},K,z.defaultMessages);function X(e,t,n){return e.formatMessage({id:t,defaultMessage:Z[t]},n)}const ee=(e,t,n)=>{if(isNaN(e)||!t||!n||t===n)return e;const o={esriMeters:1,esriDecimalDegrees:899928005759e-17,esriNauticalMiles:.00053995680345572,esriIntNauticalMiles:.00053959318990227,esriMiles:.00062136994949496,esriIntMiles:.00062137119223733,esriKilometers:.001,esriYards:1.093611111115486,esriIntYards:1.093613298337708,esriFeet:3.280833333346457,esriIntFeet:3.280839895013123,esriDecimeters:10,esriInches:39.370078740157,esriIntInches:39.37007874015748,esriCentimeters:100,esriMillimeters:1e3,esriPoints:2834.645669291964};return t in o&&n in o?o[n]/o[t]*e:e};function te(e){switch(e){case"esriFeet":case"esriIntFeet":return"esriSRUnit_Foot";case"esriMiles":return"esriSRUnit_StatuteMile";case"esriNauticalMiles":return"esriSRUnit_USNauticalMile";case"esriIntNauticalMiles":return"esriSRUnit_NauticalMile";case"esriMeters":return"esriSRUnit_Meter";case"esriKilometers":return"esriSRUnit_Kilometer"}}function ne(e,t){switch(e){case"esriInches":return X(t,"inches");case"esriPoints":return X(t,"points");case"esriFeet":return X(t,"feet");case"esriYards":return X(t,"yards");case"esriMiles":return X(t,"miles");case"esriNauticalMiles":return X(t,"nauticalMiles");case"esriMillimeters":return X(t,"millimeters");case"esriCentimeters":return X(t,"centimeters");case"esriMeters":return X(t,"meters");case"esriKilometers":return X(t,"kilometers");case"esriDecimalDegrees":return X(t,"decimalDegrees");case"esriDecimeters":return X(t,"decimeters");case"esriIntFeet":return X(t,"intFeet");default:return X(t,"esriUnknownUnits")}}function oe(e,t){switch(e){case X(t,"inches"):return"esriInches";case X(t,"points"):return"esriPoints";case X(t,"feet"):return"esriFeet";case X(t,"yards"):return"esriYards";case X(t,"miles"):return"esriMiles";case X(t,"nauticalMiles"):return"esriNauticalMiles";case X(t,"millimeters"):return"esriMillimeters";case X(t,"centimeters"):return"esriCentimeters";case X(t,"meters"):return"esriMeters";case X(t,"kilometers"):return"esriKilometers";case X(t,"decimalDegrees"):return"esriDecimalDegrees";case X(t,"decimeters"):return"esriDecimeters";case X(t,"intFeet"):return"esriIntFeet";default:return"unknownUnits"}}function re(e){return null!=e}const ie=e=>{var t;if(re(e)){const n=e;if((null===(t=n.paths)||void 0===t?void 0:t.length)>0){const e=n.getPoint(0,0),t=n.paths[n.paths.length-1].length-1;return[e,n.getPoint(n.paths.length-1,t)]}}return[null,null]},ae=e=>{const t={routeIdFieldName:"",routeNameFieldName:"",fromDateFieldName:"",toDateFieldName:"",lineIdFieldName:"",lineNameFieldName:"",lineOrderFieldName:""};return re(e)&&(t.routeIdFieldName=e.routeIdFieldSchema.name,t.routeNameFieldName=e.useRouteName?e.routeNameFieldSchema.name:"",t.fromDateFieldName=e.fromDateFieldSchema.name,t.toDateFieldName=e.toDateFieldSchema.name,t.lineIdFieldName=re(e.lineIdFieldSchema)?e.lineIdFieldSchema.name:"",t.lineNameFieldName=re(e.lineNameFieldSchema)?e.lineNameFieldSchema.name:"",t.lineOrderFieldName=re(e.lineOrderFieldSchema)?e.lineOrderFieldSchema.name:""),t},se=(e,t,n,o)=>{if(!(re(n)&&re(o)&&e.length&&t.length))return Promise.reject();const r=o.layer,i=r.createQuery();let a;a=(n.useRouteName,e.map((e=>`${n.routeNameFieldSchema.name} = '${e}'`)));const s=a.join(" OR "),l=`${n.lineIdFieldSchema.name} = '${t}' AND (${s})`,u=ae(n);return i.returnM=!0,i.outFields=[u.routeIdFieldName,u.fromDateFieldName,u.toDateFieldName],n.useRouteName&&i.outFields.push(u.routeNameFieldName),i.where=l,r.queryFeatures(i).then((e=>e)).catch((e=>Promise.reject()))},le=(e,t,n)=>{if(!re(t)||!re(n))return Promise.reject();const o=n.layer,r=o.createQuery(),i=`${t.lineIdFieldSchema.name} = '${e}'`,a=ae(t);return r.returnM=!0,r.outFields=[a.routeIdFieldName,a.fromDateFieldName,a.toDateFieldName,a.lineOrderFieldName],t.useRouteName&&r.outFields.push(a.routeNameFieldName),r.where=i,o.queryFeatures(r).then((e=>e)).catch((e=>Promise.reject()))},ue=(e,t,n,...o)=>Y(void 0,[e,t,n,...o],void 0,(function*(e,t,n,o=!1,r=!0,i="",a=null,s=!1){if(!re(t)||!re(n)||!e.length)return Promise.reject();const l=n,u=(null==l?void 0:l.layer)||(yield l.createJSAPILayerByDataSource());let c;if(c=!t.useRouteName||s?`${t.routeIdFieldSchema.name} = '${e}'`:`${t.routeNameFieldSchema.name} = '${e}'`,re(a)){const e=`TIMESTAMP '${a.toISOString().slice(0,10)}'`;c=`${c} AND ${t.fromDateFieldSchema.name} <= ${e} AND (${t.toDateFieldSchema.name} >= ${e} OR ${t.toDateFieldSchema.name} IS NULL)`}let d=c;o&&!r&&re(i)&&(d=`${t.lineIdFieldSchema.name} = '${i}' AND (${c})`);const f=u.createQuery();f.where=d;const m=ae(t);return f.returnGeometry=!0,f.returnM=!0,f.outFields=[m.routeIdFieldName,m.fromDateFieldName,m.toDateFieldName],t.useRouteName&&f.outFields.push(m.routeNameFieldName),t.supportsLines&&(f.outFields.push(m.lineIdFieldName),f.outFields.push(m.lineNameFieldName),f.outFields.push(m.lineOrderFieldName)),u.queryFeatures(f).then((t=>0===t.features.length&&e.length>0?Promise.reject():t)).catch((e=>Promise.reject()))})),ce=(e,t,n)=>{const o=[],r=J(e,t,n);return o.push(r),Promise.all(o)},de=e=>{const t=new Date(e);return re(t)?Date.UTC(t.getUTCFullYear(),t.getUTCMonth(),t.getUTCDate(),0,0,0,0):null};function fe(e){if(null!=e&&/^-?\d+\+\d{2}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),n=e.split("+");let o=100*parseInt(n[0],10);return isNaN(o)?o=NaN:2===n.length&&(t?o-=parseFloat(n[1]):o+=parseFloat(n[1])),o}if(null!=e&&/^-?\d+\+\d{3}(\.\d+)?$/g.test(e)){const t="-"===e.charAt(0),n=e.split("+");let o=1e3*parseInt(n[0],10);return isNaN(o)?o=NaN:2===n.length&&(t?o-=parseFloat(n[1]):o+=parseFloat(n[1])),o}return NaN}function me(){return{routeId:"",toRouteId:"",lineId:"",toLineId:"",lineName:"",toLineName:"",routeLineOrder:NaN,toRouteLineOrder:NaN,routeName:"",toRouteName:"",fromMeasure:NaN,toMeasure:NaN,toRouteFromMeasure:NaN,toRouteToMeasure:NaN,fromDate:new Date(Date.now()),toRouteFromDate:new Date(Date.now()),toDate:null,toRouteToDate:null,selectedMeasure:NaN,selectedToMeasure:NaN,selectedFromDate:new Date(Date.now()),selectedToDate:null,selectedPoint:null,selectedToPoint:null,selectedPolyline:null,selectedToPolyline:null,validRoute:!1,validToRoute:!1}}function pe(){return{eventUrl:"",fromDateFieldName:"",toDateFieldName:"",derivedFromMeasureFieldName:"",derivedRouteIdFieldName:"",derivedRouteNameFieldName:"",derivedToMeasureFieldName:"",fromReferentLocationFieldName:"",fromReferentMethodFieldName:"",fromReferentOffsetFieldName:"",toReferentLocationFieldName:"",toReferentMethodFieldName:"",toReferentOffsetFieldName:"",locErrorFieldName:"",eventIdFieldName:"",routeIdFieldName:"",routeNameFieldName:"",fromMeasureFieldName:"",toRouteIdFieldName:"",toRouteNameFieldName:"",toMeasureFieldName:"",lrsFields:null,attributeFields:null,parentNetworkId:NaN,useRouteName:!1,isPointEvent:!1,canSpanRoutes:!1,mergeCoincident:!1,retireOverlapping:!1,datasetName:""}}function he(){return{fromRoutePickerActive:!1,fromMeasurePickerActive:!1,toRoutePickerActive:!1,toMeasurePickerActive:!1}}function ve(e){return n.SessionManager.getInstance().getSessionByUrl(e)}function ye(e){return e.getGDBVersion()||"sde.DEFAULT"}function ge(e){return"sde.default"===e.toLocaleLowerCase()||""===e}function be(e,t,n){return!isNaN(e)&&!isNaN(t)&&!isNaN(n)&&Math.abs(e-t)<=n}function Ie(e,t,n){return function(e,t,n){return function(e,t,n,o){return n=Math.abs(n),o?e>t+n:e>=t-n}(e,t,n,!1)}(t,e[0],n)&&function(e,t,n){return function(e,t,n,o){return n=Math.abs(n),o?e<t-n:e<=t+n}(e,t,n,!1)}(t,e[1],n)}const Se=(e,t)=>{re(t)&&(e.add(t),setTimeout((()=>{e.removeAll(),setTimeout((()=>{e.add(t),setTimeout((()=>{e.removeAll(),setTimeout((()=>{e.add(t),setTimeout((()=>{e.removeAll()}),800)}),800)}),800)}),800)}),800))};function Ne(e){const t=(new Date).getTimezoneOffset();return(t<0?1:-1)*(t<0?Math.abs(t)/60:t/60)*60*60*1e3+function(e){const t=we(new Date(Date.now())),n=we(e);return t&&!n?-36e5:!t&&n?36e5:0}(e)}function we(e){const t=new Date(e.getFullYear(),0,1),n=new Date(e.getFullYear(),6,1),o=Math.max(t.getTimezoneOffset(),n.getTimezoneOffset());return e.getTimezoneOffset()<o}function Re(e,t){if(!re(e)||!re(new Date(e)))return null;const o=t.getTimezone();if(o.includes("/")||"device"===o)return new Date(n.dataSourceUtils.getDateFieldValueWithoutTzOffset(e,t));{const t=Ne(new Date(e));return new Date(e+t)}}function Fe(e,t){if(!re(e)||!re(new Date(e)))return null;const o=t.getTimezone();if(o.includes("/")||"device"===o)return new Date(n.dataSourceUtils.getDateFieldValue(e,t));{const t=Ne(new Date(e));return new Date(e-t)}}function ke(e){let t=document.getElementById(e);for(;t&&!t.classList.contains("floating-panel");)if(t=t.parentElement,t&&t.classList.contains("floating-panel"))return!0;for(t=document.getElementById(e);t&&!t.classList.contains("panel-content");)if(t=t.parentElement,t&&t.classList.contains("panel-content"))return!0;return!1}function xe(){return n.css`
    --calcite-color-brand: var(--sys-color-primary-main);
    --calcite-color-brand-press: var(--sys-color-primary-dark);
    --calcite-color-brand-hover: var(--sys-color-primary-light);
    --calcite-color-text-inverse: var(--sys-color-primary-text)};
  `}function Te(){return n.css`
    --calcite-ui-icon-color: var(--ref-palette-neutral-1200);
    --calcite-color-brand: var(--sys-color-primary-main);
    --calcite-color-brand-press: var(--sys-color-primary-dark);
    --calcite-color-brand-hover: var(--sys-color-primary-light);
    --calcite-color-text-inverse: var(--sys-color-primary-text)};
  `}function De(e){return n.css`
      --calcite-color-foreground-1: ${e.sys.color.surface.paper};
      --calcite-color-brand: ${e.sys.color.primary.main};
      --calcite-color-status-warning: ${e.sys.color.error.main};
      --calcite-color-text-3: ${e.sys.color.primary.text};
      --calcite-color-transparent-hover: ${e.sys.color.primary.light};
      --calcite-color-transparent-pressed: ${e.sys.color.primary.dark};
      --calcite-color-status-success: ${e.sys.color.success.main};
    `}const Le=1e4,Ee="#00FFFF",je="#000000",Me="#00FFFF";var Ae=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};const Oe=(e,t,n,o)=>Ae(void 0,void 0,void 0,(function*(){var r;switch(t||(t=Ee),null===(r=null==e?void 0:e.geometry)||void 0===r?void 0:r.type){case"point":return yield Ce(e,t,n).then((e=>e));case"polyline":return yield Ve(e,t,n,o).then((e=>e));default:return null}})),Pe=e=>(0,r.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;const o={type:"simple-marker",style:"circle",size:6,color:je};return new n({geometry:e.geometry,symbol:o,attributes:e.attributes})})),Ce=(e,t,n=3)=>(0,r.loadArcGISJSAPIModules)(["esri/Graphic"]).then((o=>{let r=null;[r]=o;const i={type:"simple-marker",style:"circle",width:n,color:t||Ee,outline:{color:je,width:1}};return new r({geometry:e.geometry,symbol:i,attributes:e.attributes})})),Ve=(e,t,n=9,o=!1)=>(0,r.loadArcGISJSAPIModules)(["esri/Graphic"]).then((r=>{let i=null;[i]=r;let a={};a=o?{type:"simple-line",color:t||Ee,width:n,style:"solid",marker:{color:t||Ee,style:"arrow",placement:"end"},outline:{color:je,width:1}}:{type:"simple-line",color:t||Ee,width:n,style:"solid",outline:{color:je,width:1}};return new i({geometry:e.geometry,symbol:a,attributes:e.attributes})})),_e=e=>(0,r.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;return new n({geometry:e,symbol:null,attributes:[]})})),Ue=e=>(0,r.loadArcGISJSAPIModules)(["esri/Graphic"]).then((t=>{let n=null;[n]=t;return new n({geometry:e,symbol:null,attributes:[]})}));var $e=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function Ge(e){return $e(this,void 0,void 0,(function*(){return new Promise((function(t,o){const r={params:e.params,httpMethod:e.method};n.esri.restRequest.request(e.url,r).then((e=>{t(e)})).catch((e=>{t(e)}))}))}))}function qe(e,t,o,r,i,a){return $e(this,void 0,void 0,(function*(){var s,l,u,c,d,f;const m=r.routeId,p=[];if(!re(r.selectedPoint)&&!re(a))return p;const h=null!==(l=null===(s=t.getTimeInfo())||void 0===s?void 0:s.timeExtent)&&void 0!==l?l:0,v=o.eventInfo.eventUrl.replace("/exts/LRServer/eventLayers",""),y=`${v}/query`,g=yield n.SessionManager.getInstance().getSessionByUrl(v).getToken(v);let b,I,S,N,w=t.getGDBVersion();if(w||(w=""),re(r.selectedPoint)){S=r.selectedPoint.toJSON?r.selectedPoint.toJSON():r.selectedPoint,N=r.distance>e?r.distance:"";let t="";if(o.eventInfo.canSpanRoutes)i.length>0&&(t=`${null===(u=o.eventInfo)||void 0===u?void 0:u.routeIdFieldName} IN ('${i.join("','")}')`);else{if(!(m&&m.length>0))return p;t=`${null===(c=o.eventInfo)||void 0===c?void 0:c.routeIdFieldName} = '${m}'`}if(re(r.fromDate)){if(r.fromDate){const e=`TIMESTAMP '${r.fromDate.toISOString().slice(0,10)}'`;t.length>0&&(t+=" AND "),t+=`${e} <= ${o.eventInfo.fromDateFieldName}`}if(r.toDate){const e=`TIMESTAMP '${r.toDate.toISOString().slice(0,10)}'`;t.length>0&&(t+=" AND "),t+=`${e} > ${o.eventInfo.fromDateFieldName}`}}I=t}else b=[a];let R=null===(f=null===(d=t.layerDefinition)||void 0===d?void 0:d.geometryProperties)||void 0===f?void 0:f.units;R&&(R=te(R));const F={f:"json",token:g,returnGeometry:!1,time:h,gdbVersion:w,outSR:102100,objectIds:b,where:I,outFields:"*",spatialRel:"esriSpatialRelIntersects",geometryType:"esriGeometryPoint",geometry:S,distance:N,units:R};return Ge({method:"GET",url:y,params:F}).then((e=>$e(this,void 0,void 0,(function*(){var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features:(F.distance=.2,F.units="esriSRUnit_Meter",Ge({method:"GET",url:y,params:F}).then((e=>$e(this,void 0,void 0,(function*(){var t;return(null===(t=e.features)||void 0===t?void 0:t.length)>0?e.features:p})))).catch((e=>p)))})))).catch((e=>p))}))}function Be(e,t){return $e(this,void 0,void 0,(function*(){const n=[],o=null==e?void 0:e.layer,r=o.createQuery();return t.length>0?(r.objectIds=t,o.queryFeatures(r).then((e=>e&&e.features.length>0?e.features:n)).catch((e=>n))):n}))}function ze(e,t,n){return $e(this,void 0,void 0,(function*(){var o,r;const i=[];let a="";n.routeId.length>0?a=`${t.routeIdFieldSchema.jimuName} = '${n.routeId}'`:n.routeName.length>0&&(a=`${t.routeNameFieldSchema.jimuName} = '${n.routeName}'`);const s={returnGeometry:!0,returnM:!0,returnZ:!0,where:a,orderByFields:[],time:null!==(r=null===(o=e.getTimeInfo())||void 0===o?void 0:o.timeExtent)&&void 0!==r?r:0};return e.query(s).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i})).catch((e=>i))}))}function We(e,t,n){return $e(this,void 0,void 0,(function*(){var o,r;const i=[];let a="";if(!(n.length>0))return i;a=`${t.lineIdFieldSchema.jimuName} = '${n}'`;const s={where:a,time:null!==(r=null===(o=e.getTimeInfo())||void 0===o?void 0:o.timeExtent)&&void 0!==r?r:0,outFields:[t.routeIdFieldSchema.name],notAddFieldsToClient:!0};return e.query(s).then((e=>{var t;return(null===(t=e.records)||void 0===t?void 0:t.length)>0?e.records:i})).catch((e=>i))}))}function He(e,t,o,r,i){return $e(this,void 0,void 0,(function*(){const a=[];if(!re(o)&&o.length)return a;const s=t.networkUrl,l=`${s}/geometryToMeasure`,u=yield n.SessionManager.getInstance().getSessionByUrl(s).getToken(s),c=[];o.forEach((e=>{c.push({routeId:i,geometry:{x:e.x,y:e.y}})}));let d=e.getGDBVersion();d||(d="");return Ge({method:"GET",url:l,params:{f:"json",token:u,locations:c,tolerance:10,temporalViewDate:re(r)&&0!==r.valueOf()?r:"",inSR:o[0].spatialReference.wkid,gdbVersion:d}}).then((e=>$e(this,void 0,void 0,(function*(){return e&&e.locations?(e.locations.forEach((e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.length)>0&&e.results.forEach((e=>{a.push(e.measure)}))})),a):a}))))}))}function Qe(e,t,o,r,i){return $e(this,void 0,void 0,(function*(){const a=[];if(!re(o)&&o.length)return a;const s=t.networkUrl,l=`${s}/geometryToMeasure`,u=yield n.SessionManager.getInstance().getSessionByUrl(s).getToken(s),c=[];o.forEach((e=>{c.push({routeId:i,geometry:{x:e.x,y:e.y}})}));let d=e.getGDBVersion();d||(d="");return Ge({method:"GET",url:l,params:{f:"json",token:u,locations:c,tolerance:10,temporalViewDate:re(r)&&0!==r.valueOf()?r:"",inSR:o[0].spatialReference.wkid,gdbVersion:d}}).then((e=>$e(this,void 0,void 0,(function*(){return e&&e.locations?(e.locations.forEach((e=>{var t;(null===(t=e.results)||void 0===t?void 0:t.length)>0&&e.results.forEach((e=>{a.push({measure:e.measure,distance:e.distance})}))})),a):a}))))}))}function Je(e,t,o,r,i){return $e(this,void 0,void 0,(function*(){if(!o.length)return null;const a=t.networkUrl,s=`${a}/measureToGeometry`,l=yield n.SessionManager.getInstance().getSessionByUrl(a).getToken(a),u=[];u.push({routeId:o,measure:i});let c=e.getGDBVersion();c||(c="");return Ge({method:"GET",url:s,params:{f:"json",token:l,locations:u,temporalViewDate:re(r)&&0!==r.valueOf()?r:"",gdbVersion:c}}).then((e=>$e(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,o=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[t,o]=e})).then((()=>{let n=null;return e.locations.forEach((r=>{if("esriGeometryPoint"===r.geometryType&&null!=r.geometry){const i=new o({wkid:e.spatialReference.wkid});n=new t(r.geometry),n.spatialReference=i}})),n}))}))))}))}function Ke(e,t,o,r,i){return $e(this,void 0,void 0,(function*(){if(!o.length)return null;const a=t.networkUrl,s=`${a}/measureToGeometry`,l=yield n.SessionManager.getInstance().getSessionByUrl(a).getToken(a),u=[];u.push({routeId:o,measure:i});let c=e.getGDBVersion();c||(c="");return Ge({method:"GET",url:s,params:{f:"json",token:l,locations:u,temporalViewDate:re(r)&&0!==r.valueOf()?r:"",gdbVersion:c,outSR:102100}}).then((e=>$e(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,o=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/SpatialReference"]).then((e=>{[t,o]=e})).then((()=>{let n=null;return e.locations.forEach((r=>{if("esriGeometryPoint"===r.geometryType&&null!=r.geometry){const i=new o({wkid:e.spatialReference.wkid});n=new t(r.geometry),n.spatialReference=i}})),n}))}))))}))}function Ye(e,t,o){return $e(this,void 0,void 0,(function*(){const r=`${e}/applyEdits`,i=yield n.SessionManager.getInstance().getSessionByUrl(e).getToken(e),a=[];t.edits.forEach((e=>{a.push(e)}));return Ge({method:"POST",url:r,params:{f:"json",token:i,gdbVersion:o,edits:a}}).then((e=>$e(this,void 0,void 0,(function*(){const t={success:!1,editResults:[],code:0,message:"",details:""};return e.hasOwnProperty("success")?(t.success=!0,t.editResults=e.editResults):(t.success=!1,t.code=e.code,t.message=e.message,t.details=e.response.error.details[0]),t}))))}))}function Ze(e){return $e(this,void 0,void 0,(function*(){return yield(0,n.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]).then((t=>{const[n]=t;let o;if(e.url.includes("MapServer")){let t="";t=e.url.substring(0,e.url.indexOf("MapServer")),t+="FeatureServer/"+e.layerId,o=new n({url:t})}else e.layer?o=e.layer:e.itemId&&(o=new n({portalItem:{id:e.itemId,portal:{url:e.portalUrl}}}));return o.load().then((()=>$e(this,void 0,void 0,(function*(){return yield Promise.resolve(o)}))))})).catch((e=>(console.warn(e),null)))}))}function Xe(e,t,o,r,i,a,s){return $e(this,void 0,void 0,(function*(){if(!o.length||!r.length)return null;const l=t.networkUrl,u=`${l}/measureToGeometry`,c=yield n.SessionManager.getInstance().getSessionByUrl(l).getToken(l),d=[];d.push({routeId:o,toRouteId:r,fromMeasure:a,toMeasure:s});let f=e.getGDBVersion();f||(f="");return Ge({method:"GET",url:u,params:{f:"json",token:c,locations:d,temporalViewDate:re(i)&&0!==i.valueOf()?i:"",gdbVersion:f}}).then((e=>$e(this,void 0,void 0,(function*(){if(!e||!e.locations)return null;let t=null,o=null;return(0,n.loadArcGISJSAPIModules)(["esri/geometry/Polyline","esri/geometry/SpatialReference"]).then((e=>{[t,o]=e})).then((()=>{let n=null;return e.locations.forEach((r=>{if("esriGeometryPolyline"===r.geometryType){const i=new o({wkid:e.spatialReference.wkid});n=new t(r.geometry),n.spatialReference=i}})),n}))}))))}))}const et=(e,t,n)=>{if(!re(t)||!re(n)||!e.length)return Promise.reject();const o=ae(t),r=n.layer,i=r.createQuery();return i.where=`${o.routeIdFieldName} = '${e}'`,i.orderByFields=[t.fromDateFieldSchema.name],i.returnM=!0,i.outFields=[o.routeIdFieldName,o.fromDateFieldName,o.toDateFieldName],t.useRouteName&&i.outFields.push(o.routeNameFieldName),t.supportsLines&&(i.outFields.push(o.lineIdFieldName),i.outFields.push(o.lineNameFieldName),i.outFields.push(o.lineOrderFieldName)),r.queryFeatures(i).then((t=>0===t.features.length&&e.length>0?Promise.reject():t)).catch((e=>Promise.reject()))},tt=(e,t,n)=>{if(!re(t)||!re(n)||!e.length||0===e.length)return Promise.reject();const o=ae(t),r=n.layer,i=r.createQuery();return i.where=`${o.routeIdFieldName} IN ('${e.join("','")}')`,i.outFields=[o.routeIdFieldName,o.lineIdFieldName,o.lineOrderFieldName],r.queryFeatures(i).then((t=>0===t.features.length&&e.length>0?Promise.reject():t)).catch((e=>Promise.reject()))};var nt=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function ot(e){const{type:t,active:o,networkDs:i,network:a,routeInfo:s,disabled:l,jimuMapView:u,hoverGraphic:c,isFrom:d=!1,canSpanRoutes:f=!1,useRouteStartMeasure:m=!1,useRouteEndMeasure:p=!1,onActiveChange:h,onRouteInfoUpdated:v,onMultiRouteSelect:y}=e,g=n.React.useRef(null),b=n.React.useRef(null),[I,S]=n.React.useState(null),N=n.React.useRef(!1),w=n.React.useRef(!1);n.React.useEffect((()=>{if(re(i)&&re(u)){const e=i;re(null==e?void 0:e.layer)&&S(null==e?void 0:e.layer)}}),[u,i]),n.React.useEffect((()=>{o?R():F()}),[o]);const R=()=>{g.current=null==u?void 0:u.view.on("pointer-move",D),b.current=null==u?void 0:u.view.on("pointer-down",L)},F=()=>{re(g.current)&&(g.current.remove(),g.current=null),re(b.current)&&(b.current.remove(),b.current=null),w.current&&(w.current=!1),N.current&&(N.current=!1)},k=()=>{re(c)&&c.removeAll()},x=e=>{k(),re(e)&&c.add(e)},T=e=>{const t=I.spatialReference,n=I.createQuery(),o="degrees"===t.unit?4:Math.max(3*t.metersPerUnit,3);return n.geometry=e,n.units="meters",n.returnGeometry=!0,n.returnM=!0,n.returnZ=!0,n.distance=(null==u?void 0:u.view.resolution)*o,n.spatialRelationship="intersects",n},D=e=>{re(I)&&!N.current&&(0,r.loadArcGISJSAPIModules)(["esri/geometry/geometryEngine","esri/TimeExtent"]).then((n=>{let o=null,r=null;[o,r]=n,N.current=!0;const l=i.getCurrentQueryParams(),c=null==u?void 0:u.view.toMap(e),m=T(c),p=a.lineIdFieldSchema?a.lineIdFieldSchema.name:"",h=f?s.lineId:"";if(m.outFields=f?[p]:[],(null==l?void 0:l.time)&&(m.timeExtent=new r({start:l.time[0],end:l.time[1]})),m.gdbVersion=l.gdbVersion,"route-measure"===t)I.queryFeatures(m).then((e=>{e.features.forEach((e=>nt(this,void 0,void 0,(function*(){const t=e.geometry;if(!f||f&&d){const e=o.nearestCoordinate(t,c),n=o.nearestVertex(t,c);return n.distance<3*m.distance&&(e.coordinate=n.coordinate),x(yield Pe(yield _e(e.coordinate))),N.current=!1,!0}if(f&&!d){if(e.attributes[p]===h){const e=o.nearestCoordinate(t,c),n=o.nearestVertex(t,c);return n.distance<3*m.distance&&(e.coordinate=n.coordinate),x(yield Pe(yield _e(e.coordinate))),N.current=!1,!0}}})))),N.current&&(x(null),N.current=!1)}));else{const e=a.routeIdFieldSchema?a.routeIdFieldSchema.name:"",t=a.fromDateFieldSchema?a.fromDateFieldSchema.name:"",n=a.lineIdFieldSchema?a.lineIdFieldSchema.name:"";m.outFields=f?[e,n,t]:[e,t];const r=d?s.routeId:s.toRouteId;I.queryFeatures(m).then((n=>{n.features.forEach((a=>nt(this,void 0,void 0,(function*(){const l=a.attributes[e],u=Fe(a.attributes[t],i).toLocaleDateString(),f=d?s.fromDate.toLocaleDateString():s.toRouteFromDate.toLocaleDateString();if(l===r&&u===f){const e=n.features[0].geometry,t=o.nearestCoordinate(e,c),r=o.nearestVertex(e,c);r.distance<3*m.distance&&(t.coordinate=r.coordinate),x(yield Pe(yield _e(t.coordinate))),N.current=!1}})))),N.current&&(x(null),N.current=!1)}))}}))},L=e=>nt(this,void 0,void 0,(function*(){re(I)&&!w.current&&(e.stopPropagation(),(0,r.loadArcGISJSAPIModules)(["esri/geometry/geometryEngine","esri/TimeExtent"]).then((n=>{let o=null,r=null;[o,r]=n;const l=I.popupEnabled;I.popupEnabled=!1,w.current=!0;const c=null==u?void 0:u.view.toMap(e),g=T(c),b=a.routeNameFieldSchema?a.routeNameFieldSchema.name:"",S=a.routeIdFieldSchema?a.routeIdFieldSchema.name:"",N=a.fromDateFieldSchema.name,R=a.toDateFieldSchema.name,x=a.lineIdFieldSchema?a.lineIdFieldSchema.name:"",D=a.lineNameFieldSchema?a.lineNameFieldSchema.name:"",L=a.lineOrderFieldSchema?a.lineOrderFieldSchema.name:"";g.outFields=[S,N,R],(f||""!==x)&&(g.outFields.push(x),g.outFields.push(D),g.outFields.push(L)),a.useRouteName&&g.outFields.push(b);const E=i.getCurrentQueryParams();(null==E?void 0:E.time)&&(g.timeExtent=new r({start:E.time[0],end:E.time[1]})),g.gdbVersion=E.gdbVersion,!d&&f&&(g.where=`${x} LIKE '%${s.lineId}'`);const j=[];I.queryFeatures(g).then((e=>nt(this,void 0,void 0,(function*(){"route-measure"===t?yield Promise.all(e.features.map((e=>nt(this,void 0,void 0,(function*(){const t=e.attributes[S],n=a.useRouteName?e.attributes[b]:"",r=(null==e?void 0:e.attributes[x])||"",l=(null==e?void 0:e.attributes[D])||"",u=(null==e?void 0:e.attributes[L])||"",h=e.attributes[N],v=e.attributes[R],y=ie(e.geometry),I=e.geometry,w=o.nearestCoordinate(I,c),F=o.nearestVertex(I,c);F.distance<3*g.distance&&(w.coordinate=F.coordinate),yield He(i,a,y,h,t).then((c=>nt(this,void 0,void 0,(function*(){const g=Math.min(...c),b=Math.max(...c);yield Qe(i,a,[w.coordinate],h,t).then((c=>{c.forEach((c=>{const S=c.measure;let N=new Date(Date.now());const R=h?Fe(h,i):null,F=v?Fe(v,i):null;re(F)&&N>F||re(h)&&N<R?N=R:N.setHours(0,0,0,0);let k=new Date(Date.now());re(F)&&k>F?k=F:k.setHours(0,0,0,0),(!re(v)||F>k)&&(k=null);let x=!1;!d||f||s.routeId===t&&s.routeName===n&&s.toRouteId===t&&s.toRouteName===n?d&&f&&!s.validToRoute&&(x=!0):x=!0,d&&r&&s.lineId!==r&&(x=!0);let T=!1;(d&&f&&!s.validToRoute||d&&r&&s.toLineId!==r||d&&!f&&s.routeId===s.toRouteId)&&(T=!0);let D=re(h)?Fe(h,i):null,L=re(v)?Fe(v,i):null;d&&f&&""!==s.toRouteId&&t!==s.toRouteId&&(D=s.toRouteFromDate,L=s.toRouteToDate);w.coordinate.hasZ=!0;const E={routeId:d?t:s.routeId,toRouteId:d?T?t:s.toRouteId:t,routeName:d?n:s.routeName,toRouteName:d?T?n:s.toRouteName:n,routeLineOrder:d?u:s.routeLineOrder,toRouteLineOrder:d?s.toRouteLineOrder:u,lineId:r,toLineId:r,lineName:l,toLineName:l,fromMeasure:d?q(g,a.measurePrecision):s.fromMeasure,toMeasure:d?q(b,a.measurePrecision):s.toMeasure,toRouteFromMeasure:d?T?q(g,a.measurePrecision):s.toRouteFromMeasure:q(g,a.measurePrecision),toRouteToMeasure:d?T?q(b,a.measurePrecision):s.toRouteToMeasure:q(b,a.measurePrecision),selectedMeasure:d?q(S,a.measurePrecision):s.selectedMeasure,distance:c.distance,selectedToMeasure:d?x?NaN:s.selectedToMeasure:q(S,a.measurePrecision),fromDate:d?re(h)?Fe(h,i):null:s.fromDate,toDate:d?re(v)?Fe(v,i):null:s.toDate,toRouteFromDate:D,toRouteToDate:L,selectedPoint:d?w.coordinate:s.selectedPoint,isNearestCoordinate:d,selectedToPoint:d?x?null:s.selectedToPoint:w.coordinate,selectedPolyline:e.geometry,selectedToPolyline:d?s.selectedToPolyline:e.geometry,selectedFromDate:d?N:s.selectedFromDate,selectedToDate:d?k:s.selectedToDate,validRoute:!!d||s.validRoute,validToRoute:!d||s.validToRoute};if(d){if(m){E.selectedMeasure=E.fromMeasure;const e=o.nearestCoordinate(I,y[0]);E.selectedPoint=e.coordinate}if(p&&(!f||E.routeId===E.toRouteId)){const e=o.nearestCoordinate(I,y[1]);E.selectedToMeasure=E.toRouteToMeasure,E.selectedToPoint=e.coordinate,E.selectedToPolyline=E.selectedPolyline}}else if(p&&f){const e=o.nearestCoordinate(I,y[1]);E.selectedToMeasure=E.toRouteToMeasure,E.selectedToPoint=e.coordinate}if(d)j.push(E);else{j.find((e=>e.routeId===E.routeId&&e.fromDate===E.fromDate))||j.push(E)}}))}))}))))}))))):yield Promise.all(e.features.map((e=>nt(this,void 0,void 0,(function*(){const t=e.attributes[S],n=e.attributes[N]?Fe(e.attributes[N],i):null,r=d?s.routeId:s.toRouteId,l=d?s.fromDate:s.toRouteFromDate;if(t===r&&n.toLocaleDateString()===l.toLocaleDateString()){const t=e.attributes[S],n=a.useRouteName?e.attributes[b]:"",r=e.attributes[N],l=e.attributes[R],u=f?e.attributes[L]:"",m=ie(e.geometry),p=e.geometry,h=o.nearestCoordinate(p,c),v=o.nearestVertex(p,c);v.distance<3*g.distance&&(h.coordinate=v.coordinate),m.push(h.coordinate),yield He(i,a,m,r,t).then((o=>nt(this,void 0,void 0,(function*(){const c=Math.min(...o),m=Math.max(...o);yield He(i,a,[h.coordinate],r,t).then((o=>{o.forEach((o=>{let p=new Date(Date.now());re(l)&&p>l?p=Fe(r,i):p.setHours(0,0,0,0);let v=new Date(Date.now());re(l)&&v>l?v=Fe(l,i):v.setHours(0,0,0,0),re(l)||(v=null);let y=re(r)?Fe(r,i):null,g=re(l)?Fe(l,i):null;d&&f&&""!==s.toRouteId&&t!==s.toRouteId&&(y=s.toRouteFromDate,g=s.toRouteToDate);h.coordinate.hasZ=!0;const b={routeId:d?t:s.routeId,toRouteId:d?s.toRouteId:t,routeName:d?n:s.routeName,toRouteName:d?s.toRouteName:n,lineId:s.lineId,toLineId:s.toLineId,lineName:s.lineName,routeLineOrder:d?u:s.routeLineOrder,toRouteLineOrder:d?s.toRouteLineOrder:u,fromMeasure:d?q(c,a.measurePrecision):s.fromMeasure,toMeasure:d?q(m,a.measurePrecision):s.toMeasure,toRouteFromMeasure:d?s.toRouteFromMeasure:q(c,a.measurePrecision),toRouteToMeasure:d?s.toRouteToMeasure:q(m,a.measurePrecision),selectedMeasure:d?q(o,a.measurePrecision):s.selectedMeasure,selectedToMeasure:d?s.selectedToMeasure:q(o,a.measurePrecision),fromDate:d?re(r)?Fe(r,i):null:s.fromDate,toDate:d?re(l)?Fe(l,i):null:s.toDate,toRouteFromDate:y,toRouteToDate:g,selectedFromDate:s.selectedFromDate,selectedToDate:s.selectedToDate,selectedPoint:d?h.coordinate:s.selectedPoint,selectedToPoint:d?s.selectedToPoint:h.coordinate,selectedPolyline:e.geometry,selectedToPolyline:d?s.selectedToPolyline:e.geometry,validRoute:!!d||s.validRoute,validToRoute:!d||s.validToRoute};j.push(b)}))}))}))))}})))))})))).then((()=>{j.length>1?y(j):1===j.length&&((e,t=!1)=>{v(e,t),k()})(j[0],!0)})).finally((()=>{l&&(I.popupEnabled=!1),F(),h(),w.current=!1})).catch((()=>{F(),h(),w.current=!1}))})))}));return(0,n.jsx)(B.CalciteButton,{scale:"s",iconStart:"select",css:Te(),disabled:!!l||void 0,appearance:o?"solid":"transparent",kind:o?"brand":"neutral",onClick:()=>{h()}})}var rt=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function it(e){const t=n.hooks.useTranslation(K),{isOpen:o,routeInfos:r,useRouteName:i,measurePrecision:a,isFrom:s,jimuMapView:l,graphicLayer:u,onRouteSelect:c,onRouteSelectCancel:d}=e,f=16,m=n.React.useRef(null),[p,h]=n.React.useState({x:0,y:0}),[v,y]=n.React.useState({width:500,height:250});n.React.useEffect((()=>{if(r.length){m.current=r[0];const e=w(),t=R();if(y({width:t,height:e}),b(s,0),re(l)&&re(l.view)){const e=s?r[0].selectedPoint:r[0].selectedToPoint;if(re(e)){const t=null==l?void 0:l.view.toScreen(e);if(t){const e=p;e.x=t.x+f,e.y=t.y+f;const n=N(t.x,t.y,null==l?void 0:l.view);n&&(e.x=n.x+f,e.y=n.y+f),h(e)}}}}}),[r]);const g=e=>rt(this,void 0,void 0,(function*(){b(s,e),m.current=r[e]})),b=(e,t)=>rt(this,void 0,void 0,(function*(){if(re(u)){if(u.removeAll(),e&&re(r[t].selectedPolyline)){const e=yield Oe(yield Ue(r[t].selectedPolyline),Me,6);u.add(e)}if(!e&&re(r[t].selectedToPolyline)){const e=yield Oe(yield Ue(r[t].selectedToPolyline),Me,6);u.add(e)}}})),I=()=>{re(u)&&u.removeAll()},S=()=>{I(),d()},N=(e,t,n)=>{if(!n)return;const o=R(),r=w(),i=e>=0&&t>=0&&e+o<=window.innerWidth&&t+r<=window.innerHeight,a=n.width-e+32,s=n.height-t+32;return i?null:(e+o>window.innerWidth&&(e=window.innerWidth-o-a),t+r>window.innerHeight&&(t=window.innerHeight-r-s),e<0&&(e=0),t<0&&(t=0),{x:e,y:t})},w=n.React.useCallback((()=>{const e=250;return 2===r.length?e:3===r.length?290:4===r.length?330:r.length>=5?370:e}),[r]),R=n.React.useCallback((()=>i?700:500),[i]),F=n.React.useCallback((e=>{h(e)}),[]),k=n.React.useCallback(((e,t)=>{const n=w(),o=R();e.height<=n&&(e.height=n),e.width<=o&&(e.width=o),e.height>370&&(e.height=370),e.width>700&&(e.width=700),y(e),h(t)}),[w,R]);return(0,n.jsx)("div",null,o&&(0,n.jsx)(z.FloatingPanel,{headerTitle:t("selectRouteLabel"),size:v,defaultPosition:p,position:p,disableActivateOverlay:!1,dragBounds:"body",onDrag:F,onResize:k,onLeave:S,onHeaderClose:S},(0,n.jsx)("div",{css:xe()},(null==r?void 0:r.length)&&(0,n.jsx)(B.CalciteTable,{pageSize:5,caption:t("routePicker"),striped:!0,bordered:!0,"selection-mode":"single",scale:"s"},(0,n.jsx)("calcite-table-row",{slot:"table-header"},i&&(0,n.jsx)("calcite-table-header",{heading:t("routeNameLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("routeIdLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("fromDateLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("toDateLabel")}),(0,n.jsx)("calcite-table-header",{heading:t("measureLabel")})),r.map(((e,t)=>(0,n.jsx)(B.CalciteTableRow,{key:t,selected:0===t,onCalciteTableRowSelect:()=>{g(t)}},i&&(0,n.jsx)("calcite-table-cell",{minWidth:200,itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},s?e.routeName:e.toRouteName)),(0,n.jsx)("calcite-table-cell",{minWidth:200,itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},s?e.routeId:e.toRouteId)),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},re(e.fromDate)?e.fromDate.toLocaleDateString():"")),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},re(e.toDate)?e.toDate.toLocaleDateString():"")),(0,n.jsx)("calcite-table-cell",{style:{minWidth:"100px"},itemKey:t},(0,n.jsx)("span",{style:{textWrap:"nowrap",minWidth:"100px"}},q(s?e.selectedMeasure:e.selectedToMeasure,a))))))),(0,n.jsx)("div",{className:"pt-1 d-flex justify-content-center"},(0,n.jsx)(z.Button,{className:"mr-2",style:{width:"100px"},type:"secondary",onClick:S},t("cancel")),(0,n.jsx)(z.Button,{className:"ml-2",style:{width:"100px"},type:"primary",onClick:()=>{I(),re(m.current)&&c(m.current)}},t("ok"))))))}const at=function(e){return null===e};function st(e,t,n,o){const r={hasError:!1,message:""};let i=[];if(re(n)){const e=n;i=null==e?void 0:e.layer.fields}else re(o)&&i.push(o);const a=i.find((e=>e.name===t));if(a){if(!re(e)&&a.nullable)return r;if(re(e)||a.nullable||(r.hasError=!0,r.message="nonNullable"),"string"==typeof e&&0===e.length&&a.nullable)return r;"string"!=typeof e||0!==e.length||a.nullable||(r.hasError=!0,r.message="nonNullable"),"small-integer"===a.type?function(e){const t=Number(e);if(!Number.isInteger(t))return!1;if(t<-32768||t>32767)return!1;return!0}(e)||(r.hasError=!0,r.message="invalidShort"):"integer"===a.type?function(e){const t=Number(e);if(!Number.isInteger(t))return!1;if(t<-2147483648||t>2147483647)return!1;return!0}(e)||(r.hasError=!0,r.message="invalidInteger"):"single"===a.type?function(e){const t=Number(e);if(isNaN(t))return!1;return!0}(e)||(r.hasError=!0,r.message="invalidSingle"):"double"===a.type?function(e){const t=Number(e);if(isNaN(t))return!1;return!0}(e)||(r.hasError=!0,r.message="invalidDouble"):"string"===a.type?function(e,t){if(re(e)&&e.length>t)return!1;return!0}(e,a.length)||(r.hasError=!0,r.message="invalidString"):"date"===a.type&&(function(e){return!isNaN(Date.parse(e))}(e)||(r.hasError=!0,r.message="invalidDate"))}return r}function lt(e,t,n,o){const r={hasError:!1,message:""};let i=[];if(re(n)){const e=n;i=null==e?void 0:e.layer.fields}else re(o)&&i.push(o);const a=i.find((e=>e.name===t)),s=a.domain;if(re(a)&&re(s)&&"range"===a.domain.type){const t=s;if(a.nullable&&(at(e)||!re(e)||""===e))return r;if("number"==typeof t.minValue&&"number"==typeof t.maxValue){const n=Number(e);isNaN(n)&&(r.hasError=!0,r.message="invalidRange"),(n<t.minValue||n>t.maxValue)&&(r.hasError=!0,r.message="invalidRange")}else if("string"==typeof t.minValue&&"string"==typeof t.maxValue&&"string"==typeof e){const n=new Date(e),o=new Date(t.minValue),i=new Date(t.minValue);(n<o||n>i)&&(r.hasError=!0,r.message="invalidRange")}}return r}function ut(e){return"date"===e}function ct(e){return"small-integer"===e||"big-integer"===e||"integer"===e||"single"===e||"double"===e||"long"===e}function dt(e){return"coded-value"===e}function ft(e){return"range"===e}var mt=c(28996),pt=c.n(mt);const ht=n.React.memo((e=>{var t,o;const r=n.hooks.useTranslation(K),{validValues:i,fieldInfo:a,isSubtype:s,eventDS:l,selected:u,onSelectionChange:c,onUpdateItem:d}=e,[f,m]=n.React.useState(a.value),[p,h]=n.React.useState(""),[v,y]=n.React.useState(a.error);n.React.useEffect((()=>{if(re(a)){if(m(a.value),y(a.error),"contingentValueError"===a.error&&y(r("contingentValueError")),re(g.domain)&&dt(g.domain.type))if(re(a.value)){const e=b.codedValues.find((e=>"string"==typeof e.code?e.code.toLowerCase()===a.value.toLowerCase():e.code===a.value));re(e)?h(R(e.code,e.name)):h("")}else h("");if(s){const e=I.find((e=>"string"==typeof e.value?e.value.toLowerCase()===a.value.toLowerCase():e.value===a.value));h(e?R(e.value,e.label):"")}}}),[l,a]);const g=n.React.useMemo((()=>{const e=l,t=(null==e?void 0:e.layer.fields).find((e=>e.name===a.name));return t||(m(t.defaultValue),null)}),[l,a]),b=n.React.useMemo((()=>{if(re(g)&&re(g.domain)&&"coded-value"===g.domain.type){const e=g.domain.codedValues.some((e=>null===e.code&&e.name===r("nullLabel")));return g.nullable&&!e&&g.domain.codedValues.unshift({code:null,name:r("nullLabel")}),g.domain}return null}),[g]),I=n.React.useMemo((()=>{if(s){const e=null==l?void 0:l.layer;if(re(e)&&re(e.subtypes)){const t=e.subtypes.map((e=>({value:e.code,label:e.name})));if(t)return t}const t=null==l?void 0:l.getFieldCodedValueList(g.name);if(t)return t}return[]}),[l,g.name,s]),S=e=>{if(e.target.value!==f){if(m(e.target.value),re(a.value)&&re(g.domain)&&dt(g.domain.type)){const e=b.codedValues.find((e=>"string"==typeof e.code?e.code.toLowerCase()===a.value.toLowerCase():e.code===a.value));e&&h(R(e.code,e.name))}if(s){const e=I.find((e=>"string"==typeof e.value?e.value.toLowerCase()===a.value.toLowerCase():e.value===a.value));e&&h(R(e.value,e.label))}w(e.target.value,v)}},N=e=>{m(e)},w=(e,t)=>{d(e,t,a.index),c(-1)},R=(e,t)=>re(e)?`${e} - ${t}`:t;let F=[];return u&&re(g.domain)&&!s&&dt(g.domain.type)&&(F=(null===(t=null==e?void 0:e.contingentValues)||void 0===t?void 0:t.length)>0?e.contingentValues.map(((e,t)=>{var o;const r=(o=e.code,!(!i||!i.includes(o)))?{}:{color:"#a0a0a0",background:"#d5d5d5"};return(0,n.jsx)("option",{key:t,value:e.code,style:r},R(e.code,e.name))})):null===(o=null==b?void 0:b.codedValues)||void 0===o?void 0:o.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e.code},R(e.code,e.name))))),(0,n.jsx)("div",{className:"attribute-table-field",style:{border:v.length?"1.2px solid red":"none"}},!u&&(0,n.jsx)("div",{onClick:()=>{a.editable&&c(a.index)},style:{borderRight:v.length?"6px solid red":"none",display:"flex",alignItems:"center"}},(0,n.jsx)(z.Label,{size:"sm",className:"w-100",style:{textOverflow:"ellipsis",width:100,marginBottom:0,alignItems:"center",textAlign:"left"}},s||re(g.domain)&&dt(g.domain.type)?re(f)?p:r("nullLabel"):"string"==typeof f&&f.length?f:"number"!=typeof f||isNaN(f)?re(f)&&"date"===g.type?new Date(f).toLocaleDateString():r("nullLabel"):f.toString()),(0,n.jsx)("span",{style:{margin:"0.1rem"}},v.length>0&&(0,n.jsx)(z.Icon,{icon:pt(),size:16,title:v,color:"red"}))),u&&!re(g.domain)&&!s&&!ut(g.type)&&(0,n.jsx)(z.TextInput,{size:"sm",className:"w-100",autoFocus:!0,required:!g.nullable,value:f,type:"text",onChange:e=>{N(e.currentTarget.value)},checkValidityOnAccept:e=>{if(!re(e)||a.value===e||!re(a.value)&&!e.length||a.contingentValError)return a.error.length?{valid:!1,msg:r(a.error)}:{valid:!0};const t=st(e,a.name,l);return t.hasError?(y(r(t.message)),"contingentValueError"===a.error&&y(r("contingentValueError")),w(e,t.message),{valid:!1,msg:r(t.message)}):(y(""),w(e,""),{valid:!0})}}),u&&!re(g.domain)&&!s&&ut(g.type)&&(0,n.jsx)(B.CalciteInputDatePicker,{scale:"s",valueAsDate:re(f)?new Date(f):null,onCalciteInputDatePickerChange:e=>{var t,n;const o=null===(t=e.target)||void 0===t?void 0:t.valueAsDate;if(a.value===o)return a.error.length?{valid:!1,msg:r(a.error)}:{valid:!0};const i=st(null===(n=e.target)||void 0===n?void 0:n.valueAsDate,a.name,l);return i.hasError?(y(r(i.message)),"contingentValueError"===a.error&&y(r("contingentValueError")),w(o,i.message),{valid:!1,msg:r(i.message)}):(y(""),w(o,""),{valid:!0})},placement:"top",overlayPositioning:"fixed"}),u&&re(g.domain)&&!s&&dt(g.domain.type)&&(0,n.jsx)(z.Select,{size:"sm",className:"w-100",value:f,onChange:e=>{S(e)}},F),u&&s&&(0,n.jsx)(z.Select,{size:"sm",className:"w-100",value:f,onChange:e=>{S(e)}},I.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e.value},R(e.value,e.label))))),u&&re(g.domain)&&ft(g.domain.type)&&(0,n.jsx)(z.TextInput,{size:"sm",className:"w-100",autoFocus:!0,required:!g.nullable,value:f,onChange:e=>{N(e.currentTarget.value)},checkValidityOnAccept:e=>{if(a.value===e)return a.error.length?{valid:!1,msg:r(a.error)}:{valid:!0};const t=lt(e,a.name,l);return t.hasError?(y(r(t.message)),"contingentValueError"===a.error&&y(r("contingentValueError")),w(e,t.message),{valid:!1,msg:r(t.message)}):(y(""),w(e,""),{valid:!0})}}))}));const vt=function(){this.__data__=[],this.size=0};const yt=function(e,t){return e===t||e!=e&&t!=t};const gt=function(e,t){for(var n=e.length;n--;)if(yt(e[n][0],t))return n;return-1};var bt=Array.prototype.splice;const It=function(e){var t=this.__data__,n=gt(t,e);return!(n<0)&&(n==t.length-1?t.pop():bt.call(t,n,1),--this.size,!0)};const St=function(e){var t=this.__data__,n=gt(t,e);return n<0?void 0:t[n][1]};const Nt=function(e){return gt(this.__data__,e)>-1};const wt=function(e,t){var n=this.__data__,o=gt(n,e);return o<0?(++this.size,n.push([e,t])):n[o][1]=t,this};function Rt(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}Rt.prototype.clear=vt,Rt.prototype.delete=It,Rt.prototype.get=St,Rt.prototype.has=Nt,Rt.prototype.set=wt;const Ft=Rt;const kt=function(){this.__data__=new Ft,this.size=0};const xt=function(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n};const Tt=function(e){return this.__data__.get(e)};const Dt=function(e){return this.__data__.has(e)};const Lt=function(e){if(!p(e))return!1;var t=R(e);return"[object Function]"==t||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t};const Et=s["__core-js_shared__"];var jt,Mt=(jt=/[^.]+$/.exec(Et&&Et.keys&&Et.keys.IE_PROTO||""))?"Symbol(src)_1."+jt:"";const At=function(e){return!!Mt&&Mt in e};var Ot=Function.prototype.toString;const Pt=function(e){if(null!=e){try{return Ot.call(e)}catch(e){}try{return e+""}catch(e){}}return""};var Ct=/^\[object .+?Constructor\]$/,Vt=Function.prototype,_t=Object.prototype,Ut=Vt.toString,$t=_t.hasOwnProperty,Gt=RegExp("^"+Ut.call($t).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");const qt=function(e){return!(!p(e)||At(e))&&(Lt(e)?Gt:Ct).test(Pt(e))};const Bt=function(e,t){return null==e?void 0:e[t]};const zt=function(e,t){var n=Bt(e,t);return qt(n)?n:void 0};const Wt=zt(s,"Map");const Ht=zt(Object,"create");const Qt=function(){this.__data__=Ht?Ht(null):{},this.size=0};const Jt=function(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t};var Kt=Object.prototype.hasOwnProperty;const Yt=function(e){var t=this.__data__;if(Ht){var n=t[e];return"__lodash_hash_undefined__"===n?void 0:n}return Kt.call(t,e)?t[e]:void 0};var Zt=Object.prototype.hasOwnProperty;const Xt=function(e){var t=this.__data__;return Ht?void 0!==t[e]:Zt.call(t,e)};const en=function(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=Ht&&void 0===t?"__lodash_hash_undefined__":t,this};function tn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}tn.prototype.clear=Qt,tn.prototype.delete=Jt,tn.prototype.get=Yt,tn.prototype.has=Xt,tn.prototype.set=en;const nn=tn;const on=function(){this.size=0,this.__data__={hash:new nn,map:new(Wt||Ft),string:new nn}};const rn=function(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e};const an=function(e,t){var n=e.__data__;return rn(t)?n["string"==typeof t?"string":"hash"]:n.map};const sn=function(e){var t=an(this,e).delete(e);return this.size-=t?1:0,t};const ln=function(e){return an(this,e).get(e)};const un=function(e){return an(this,e).has(e)};const cn=function(e,t){var n=an(this,e),o=n.size;return n.set(e,t),this.size+=n.size==o?0:1,this};function dn(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var o=e[t];this.set(o[0],o[1])}}dn.prototype.clear=on,dn.prototype.delete=sn,dn.prototype.get=ln,dn.prototype.has=un,dn.prototype.set=cn;const fn=dn;const mn=function(e,t){var n=this.__data__;if(n instanceof Ft){var o=n.__data__;if(!Wt||o.length<199)return o.push([e,t]),this.size=++n.size,this;n=this.__data__=new fn(o)}return n.set(e,t),this.size=n.size,this};function pn(e){var t=this.__data__=new Ft(e);this.size=t.size}pn.prototype.clear=kt,pn.prototype.delete=xt,pn.prototype.get=Tt,pn.prototype.has=Dt,pn.prototype.set=mn;const hn=pn;const vn=function(e,t){for(var n=-1,o=null==e?0:e.length;++n<o&&!1!==t(e[n],n,e););return e};const yn=function(){try{var e=zt(Object,"defineProperty");return e({},"",{}),e}catch(e){}}();const gn=function(e,t,n){"__proto__"==t&&yn?yn(e,t,{configurable:!0,enumerable:!0,value:n,writable:!0}):e[t]=n};var bn=Object.prototype.hasOwnProperty;const In=function(e,t,n){var o=e[t];bn.call(e,t)&&yt(o,n)&&(void 0!==n||t in e)||gn(e,t,n)};const Sn=function(e,t,n,o){var r=!n;n||(n={});for(var i=-1,a=t.length;++i<a;){var s=t[i],l=o?o(n[s],e[s],s,n,e):void 0;void 0===l&&(l=e[s]),r?gn(n,s,l):In(n,s,l)}return n};const Nn=function(e,t){for(var n=-1,o=Array(e);++n<e;)o[n]=t(n);return o};const wn=function(e){return F(e)&&"[object Arguments]"==R(e)};var Rn=Object.prototype,Fn=Rn.hasOwnProperty,kn=Rn.propertyIsEnumerable,xn=wn(function(){return arguments}())?wn:function(e){return F(e)&&Fn.call(e,"callee")&&!kn.call(e,"callee")};const Tn=xn;const Dn=function(){return!1};var Ln="object"==typeof exports&&exports&&!exports.nodeType&&exports,En=Ln&&"object"==typeof module&&module&&!module.nodeType&&module,jn=En&&En.exports===Ln?s.Buffer:void 0;const Mn=(jn?jn.isBuffer:void 0)||Dn;var An=/^(?:0|[1-9]\d*)$/;const On=function(e,t){var n=typeof e;return!!(t=null==t?9007199254740991:t)&&("number"==n||"symbol"!=n&&An.test(e))&&e>-1&&e%1==0&&e<t};const Pn=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991};var Cn={};Cn["[object Float32Array]"]=Cn["[object Float64Array]"]=Cn["[object Int8Array]"]=Cn["[object Int16Array]"]=Cn["[object Int32Array]"]=Cn["[object Uint8Array]"]=Cn["[object Uint8ClampedArray]"]=Cn["[object Uint16Array]"]=Cn["[object Uint32Array]"]=!0,Cn["[object Arguments]"]=Cn["[object Array]"]=Cn["[object ArrayBuffer]"]=Cn["[object Boolean]"]=Cn["[object DataView]"]=Cn["[object Date]"]=Cn["[object Error]"]=Cn["[object Function]"]=Cn["[object Map]"]=Cn["[object Number]"]=Cn["[object Object]"]=Cn["[object RegExp]"]=Cn["[object Set]"]=Cn["[object String]"]=Cn["[object WeakMap]"]=!1;const Vn=function(e){return F(e)&&Pn(e.length)&&!!Cn[R(e)]};const _n=function(e){return function(t){return e(t)}};var Un="object"==typeof exports&&exports&&!exports.nodeType&&exports,$n=Un&&"object"==typeof module&&module&&!module.nodeType&&module,Gn=$n&&$n.exports===Un&&i.process;const qn=function(){try{var e=$n&&$n.require&&$n.require("util").types;return e||Gn&&Gn.binding&&Gn.binding("util")}catch(e){}}();var Bn=qn&&qn.isTypedArray;const zn=Bn?_n(Bn):Vn;var Wn=Object.prototype.hasOwnProperty;const Hn=function(e,t){var n=P(e),o=!n&&Tn(e),r=!n&&!o&&Mn(e),i=!n&&!o&&!r&&zn(e),a=n||o||r||i,s=a?Nn(e.length,String):[],l=s.length;for(var u in e)!t&&!Wn.call(e,u)||a&&("length"==u||r&&("offset"==u||"parent"==u)||i&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||On(u,l))||s.push(u);return s};var Qn=Object.prototype;const Jn=function(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||Qn)};const Kn=function(e,t){return function(n){return e(t(n))}};const Yn=Kn(Object.keys,Object);var Zn=Object.prototype.hasOwnProperty;const Xn=function(e){if(!Jn(e))return Yn(e);var t=[];for(var n in Object(e))Zn.call(e,n)&&"constructor"!=n&&t.push(n);return t};const eo=function(e){return null!=e&&Pn(e.length)&&!Lt(e)};const to=function(e){return eo(e)?Hn(e):Xn(e)};const no=function(e,t){return e&&Sn(t,to(t),e)};const oo=function(e){var t=[];if(null!=e)for(var n in Object(e))t.push(n);return t};var ro=Object.prototype.hasOwnProperty;const io=function(e){if(!p(e))return oo(e);var t=Jn(e),n=[];for(var o in e)("constructor"!=o||!t&&ro.call(e,o))&&n.push(o);return n};const ao=function(e){return eo(e)?Hn(e,!0):io(e)};const so=function(e,t){return e&&Sn(t,ao(t),e)};var lo="object"==typeof exports&&exports&&!exports.nodeType&&exports,uo=lo&&"object"==typeof module&&module&&!module.nodeType&&module,co=uo&&uo.exports===lo?s.Buffer:void 0,fo=co?co.allocUnsafe:void 0;const mo=function(e,t){if(t)return e.slice();var n=e.length,o=fo?fo(n):new e.constructor(n);return e.copy(o),o};const po=function(e,t){var n=-1,o=e.length;for(t||(t=Array(o));++n<o;)t[n]=e[n];return t};const ho=function(e,t){for(var n=-1,o=null==e?0:e.length,r=0,i=[];++n<o;){var a=e[n];t(a,n,e)&&(i[r++]=a)}return i};const vo=function(){return[]};var yo=Object.prototype.propertyIsEnumerable,go=Object.getOwnPropertySymbols;const bo=go?function(e){return null==e?[]:(e=Object(e),ho(go(e),(function(t){return yo.call(e,t)})))}:vo;const Io=function(e,t){return Sn(e,bo(e),t)};const So=function(e,t){for(var n=-1,o=t.length,r=e.length;++n<o;)e[r+n]=t[n];return e};const No=Kn(Object.getPrototypeOf,Object);const wo=Object.getOwnPropertySymbols?function(e){for(var t=[];e;)So(t,bo(e)),e=No(e);return t}:vo;const Ro=function(e,t){return Sn(e,wo(e),t)};const Fo=function(e,t,n){var o=t(e);return P(e)?o:So(o,n(e))};const ko=function(e){return Fo(e,to,bo)};const xo=function(e){return Fo(e,ao,wo)};const To=zt(s,"DataView");const Do=zt(s,"Promise");const Lo=zt(s,"Set");const Eo=zt(s,"WeakMap");var jo="[object Map]",Mo="[object Promise]",Ao="[object Set]",Oo="[object WeakMap]",Po="[object DataView]",Co=Pt(To),Vo=Pt(Wt),_o=Pt(Do),Uo=Pt(Lo),$o=Pt(Eo),Go=R;(To&&Go(new To(new ArrayBuffer(1)))!=Po||Wt&&Go(new Wt)!=jo||Do&&Go(Do.resolve())!=Mo||Lo&&Go(new Lo)!=Ao||Eo&&Go(new Eo)!=Oo)&&(Go=function(e){var t=R(e),n="[object Object]"==t?e.constructor:void 0,o=n?Pt(n):"";if(o)switch(o){case Co:return Po;case Vo:return jo;case _o:return Mo;case Uo:return Ao;case $o:return Oo}return t});const qo=Go;var Bo=Object.prototype.hasOwnProperty;const zo=function(e){var t=e.length,n=new e.constructor(t);return t&&"string"==typeof e[0]&&Bo.call(e,"index")&&(n.index=e.index,n.input=e.input),n};const Wo=s.Uint8Array;const Ho=function(e){var t=new e.constructor(e.byteLength);return new Wo(t).set(new Wo(e)),t};const Qo=function(e,t){var n=t?Ho(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.byteLength)};var Jo=/\w*$/;const Ko=function(e){var t=new e.constructor(e.source,Jo.exec(e));return t.lastIndex=e.lastIndex,t};var Yo=h?h.prototype:void 0,Zo=Yo?Yo.valueOf:void 0;const Xo=function(e){return Zo?Object(Zo.call(e)):{}};const er=function(e,t){var n=t?Ho(e.buffer):e.buffer;return new e.constructor(n,e.byteOffset,e.length)};const tr=function(e,t,n){var o=e.constructor;switch(t){case"[object ArrayBuffer]":return Ho(e);case"[object Boolean]":case"[object Date]":return new o(+e);case"[object DataView]":return Qo(e,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return er(e,n);case"[object Map]":case"[object Set]":return new o;case"[object Number]":case"[object String]":return new o(e);case"[object RegExp]":return Ko(e);case"[object Symbol]":return Xo(e)}};var nr=Object.create;const or=function(){function e(){}return function(t){if(!p(t))return{};if(nr)return nr(t);e.prototype=t;var n=new e;return e.prototype=void 0,n}}();const rr=function(e){return"function"!=typeof e.constructor||Jn(e)?{}:or(No(e))};const ir=function(e){return F(e)&&"[object Map]"==qo(e)};var ar=qn&&qn.isMap;const sr=ar?_n(ar):ir;const lr=function(e){return F(e)&&"[object Set]"==qo(e)};var ur=qn&&qn.isSet;const cr=ur?_n(ur):lr;var dr="[object Arguments]",fr="[object Function]",mr="[object Object]",pr={};pr[dr]=pr["[object Array]"]=pr["[object ArrayBuffer]"]=pr["[object DataView]"]=pr["[object Boolean]"]=pr["[object Date]"]=pr["[object Float32Array]"]=pr["[object Float64Array]"]=pr["[object Int8Array]"]=pr["[object Int16Array]"]=pr["[object Int32Array]"]=pr["[object Map]"]=pr["[object Number]"]=pr[mr]=pr["[object RegExp]"]=pr["[object Set]"]=pr["[object String]"]=pr["[object Symbol]"]=pr["[object Uint8Array]"]=pr["[object Uint8ClampedArray]"]=pr["[object Uint16Array]"]=pr["[object Uint32Array]"]=!0,pr["[object Error]"]=pr[fr]=pr["[object WeakMap]"]=!1;const hr=function e(t,n,o,r,i,a){var s,l=1&n,u=2&n,c=4&n;if(o&&(s=i?o(t,r,i,a):o(t)),void 0!==s)return s;if(!p(t))return t;var d=P(t);if(d){if(s=zo(t),!l)return po(t,s)}else{var f=qo(t),m=f==fr||"[object GeneratorFunction]"==f;if(Mn(t))return mo(t,l);if(f==mr||f==dr||m&&!i){if(s=u||m?{}:rr(t),!l)return u?Ro(t,so(s,t)):Io(t,no(s,t))}else{if(!pr[f])return i?t:{};s=tr(t,f,l)}}a||(a=new hn);var h=a.get(t);if(h)return h;a.set(t,s),cr(t)?t.forEach((function(r){s.add(e(r,n,o,r,t,a))})):sr(t)&&t.forEach((function(r,i){s.set(i,e(r,n,o,i,t,a))}));var v=d?void 0:(c?u?xo:ko:u?ao:to)(t);return vn(v||t,(function(r,i){v&&(r=t[i=r]),In(s,i,e(r,n,o,i,t,a))})),s};const vr=function(e){return hr(e,5)};var yr=c(47626),gr=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};const br=c(8547),Ir=n.React.memo((e=>{const t=n.hooks.useTranslation(K),{tableIndex:o,eventDS:r,eventLayer:i,fieldInfos:a,useAlias:s,collapable:l,isExpanded:u,onItemChecked:c,onUpdateItem:d,onUpdateAll:f,onFieldGrpUpdated:m,tableLabel:p,isReset:h}=e,[v,y]=n.React.useState(!1),[g,b]=n.React.useState(""),[I,S]=n.React.useState(null),[N,w]=n.React.useState(NaN),[R,F]=n.React.useState(NaN),[k,x]=n.React.useState(u),[T,D]=n.React.useState(-1),L=n.React.useRef([]),E=n.React.useMemo((()=>{if(re(r)){const e=null==r?void 0:r.layer;if(re(e)&&re(e.subtypes)&&(null==e?void 0:e.subtypes.length)>0)return y(!0),b(e.subtypeField),e.subtypes}return[]}),[r]);n.React.useEffect((()=>{D(-1),F(-1),gr(void 0,void 0,void 0,(function*(){let t;const n=null==r?void 0:r.layer,i=yield(0,yr.fetchEnterpriseFieldGroup)(n);if((null==i?void 0:i.length)>0){t=yield i.map((e=>({name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fieldNames.names.map((e=>(0,yr.normalizeFieldName)(null==e?void 0:e.toLocaleUpperCase())))})));const r=yield(0,yr.fetchEnterpriseContingentValues)(n),s=(0,yr.setContingentValues)(r,t,n,N),l=(0,yr.validateContingencyConstraints)(-1,"",-1,a,s);if((null==l?void 0:l.length)>0){const t=[];for(let e=0;e<(null==l?void 0:l.length);e++){const n=l[e];t.push(null==n?void 0:n.fieldGroup)}e.onFieldGrpUpdated(t,o)}else e.onFieldGrpUpdated([],o);S(s)}else S([])}))}),[r]),n.React.useEffect((()=>{h&&(F(-1),D(-1))}),[h]),n.React.useEffect((()=>{if(re(a)&&v){const e=a.find((e=>e.name.toLowerCase()===g.toLowerCase()));e&&e.value!==N&&w(e.value)}T>-1&&re(L.current)&&(L.current[T].setFocus(),D(-1))}),[a]),n.React.useEffect((()=>{x(u)}),[u]),n.React.useEffect((()=>{if(!isNaN(N)&&re(E)){const e=E.findIndex((e=>e.code===N));if(e>-1){const t=E[e].defaultValues,n=vr(a);let o;for(o in t){const e=n.findIndex((e=>e.name===o));e>-1&&(ut(n[e].type)?n[e].value=re(t[o])?new Date(t[o]):null:o.toLowerCase()===g.toLowerCase()?n[e].value=N:n[e].value=t[o],n[e].error="")}A(n)}}}),[N]);const j=(e,t,n)=>{const r=vr(a);r[e].value=t,r[e].error=n,I.forEach((e=>{const t=null==e?void 0:e.fields;null==r||r.forEach((e=>{const n=null==e?void 0:e.name;t.includes(n)&&(e.error="",e.contingentValError=!1)}))}));const i=(0,yr.validateContingencyConstraints)(t,n,e,a,I);if((null==i?void 0:i.length)>0){const e=[];for(let t=0;t<(null==i?void 0:i.length);t++){const n=i[t];e.push(null==n?void 0:n.fieldGroup)}null==e||e.forEach((e=>{const t=null==e?void 0:e.fields;null==r||r.forEach((e=>{const n=null==e?void 0:e.name;t.includes(n)&&(e.error="contingentValueError",e.contingentValError=!0)}))})),m(e,o)}else m([],o);f(r,o)},M=(e,t,n)=>{if(v){a[n].name.toLowerCase()===g.toLowerCase()?w(e):(null==I?void 0:I.length)>0?j(n,e,t):d(e,t,n,o)}else(null==I?void 0:I.length)>0?j(n,e,t):d(e,t,n,o);D(n)},A=e=>{f(e,o)},O=e=>{const n=re(e.error)&&e.error.length,o=re(e.default)&&e.default.length>0,r=re(e.length)&&!isNaN(e.length);let i=e.type;return r&&(i=t("fieldTypeWithLength",{fieldType:e.type,length:e.length})),n?t("fieldInfoWithError",{name:e.name,alias:e.alias,type:i,nullable:e.nullable?t("trueKey"):t("falseKey"),default:o?e.default.toString():t("nullLabel"),editable:e.editable?t("trueKey"):t("falseKey"),error:"contingentValueError"===e.error?"Invalid contingent value in the field":t(e.error)}):t("fieldInfo",{name:e.name,alias:e.alias,type:i,nullable:e.nullable?t("trueKey"):t("falseKey"),editable:e.editable?t("trueKey"):t("falseKey"),default:o?e.default.toString():t("nullLabel")})},P=e=>{F(e),re(L.current)&&T>-1&&L.current[T].setFocus()},C=e=>{const t=[];if(!(0,yr.fieldsWithContingentValues)(I).has(e.name))return[];if(!I||0===I.length||!a||0===a.length)return[];const n=[];if((null==I?void 0:I.length)>0)for(const o of I){const r=null==o?void 0:o.contingencies,i=null==o?void 0:o.fields;if(r&&(null==i?void 0:i.includes(e.name)))for(const o of r){let r=null,i=!1;const s=Object.keys(o.values);null==s||s.forEach((t=>{const n=o.values[t];if(t===e.name)"code"===n.objectType&&(r=n.codedValue.code);else if("code"===n.objectType){const e=n.codedValue.code;a.some((n=>{if(n.name===t){const t=n.value;return(t===e||null===t)&&(i=!0),!0}return!1}))}})),null!==r&&(i?t.push(r):n.push(r))}}return t};return(0,n.jsx)("div",{className:"attributes-table w-100 pt-3 px-3",css:n.css`
  --calcite-color-brand: var(--sys-color-primary-main);
  --calcite-color-brand-press: var(--sys-color-primary-main);
  --calcite-color-brand-hover: var(--sys-color-action-hover);

    .event-layer-label {
      pointer-events: none;
      text: truncate;
      width: 100%;
      padding-top: 2px;
    }
    .event-layer-checkbox {
      pointer-events: auto;
    }
  `},l&&(0,n.jsx)(z.Label,{size:"sm",className:"event-layer-label",centric:!0,check:!0,style:{textOverflow:"ellipsis",fontWeight:500}},(0,n.jsx)(z.Checkbox,{checked:k,className:"event-layer-checkbox mr-2",onChange:(e,t)=>{c(t,o),x(t)}}),null==i?void 0:i.name),!l&&(0,n.jsx)(z.Label,{size:"sm",className:"text-truncate w-100 mb-0",centric:!0,style:{textOverflow:"ellipsis",fontWeight:500}},re(p)?p:null==i?void 0:i.name),(0,n.jsx)(B.CalciteTable,{caption:"Attribute Table",bordered:!0,className:"table-container",scale:"s",layout:"fixed",hidden:l&&!k},(0,n.jsx)(B.CalciteTableRow,{slot:"table-header"},(0,n.jsx)(B.CalciteTableHeader,{heading:t("attribute")}),(0,n.jsx)(B.CalciteTableHeader,{heading:t("value")})),re(a)&&a.map((e=>(0,n.jsx)(B.CalciteTableRow,{key:e.index},(0,n.jsx)(B.CalciteTableCell,{alignment:"center"},(0,n.jsx)("div",{className:"w-100 d-flex"},(0,n.jsx)(z.Label,{title:O(e),size:"sm",className:"text-truncate",style:{textOverflow:"ellipsis",marginBottom:0,alignItems:"center",textAlign:"left"}},s?e.alias:e.name),!e.editable&&(0,n.jsx)(z.Icon,{className:"ml-auto my-auto",icon:br,size:16,style:{alignItems:"center"}}))),(0,n.jsx)(B.CalciteTableCell,{alignment:"center",ref:t=>{L.current[e.index]=t},onKeyDown:t=>{((e,t)=>{"Enter"===e.key&&F(t)})(t,e.index)},style:{border:"2px solid red"}},(0,n.jsx)(ht,{validValues:C(e),contingentValues:(0,yr.getContingentOptions)(e.name,I),fieldGroups:I,eventDS:r,isSubtype:e.name.toLowerCase()===g.toLowerCase(),fieldInfo:e,useAlias:s,selected:R===e.index,onSelectionChange:P,onUpdateItem:M})))))))})),Sr=(0,t.withTheme)((0,t.withStyles)(Ir,"AttributeTable")),Nr=n.React.memo((e=>{const{label:t,isDisabled:o,defaultItem:r,listItems:i,altItemDescriptions:a,onSelectionChanged:s}=e,[l,u]=n.React.useState(!1),c=n.React.useRef(null),d=n.React.useRef(null),[f,m]=n.React.useState(!1);n.React.useEffect((()=>{f&&(d.current&&d.current.focus(),c.current&&c.current.setFocus(),m(!1))}),[f]);return(0,n.jsx)("div",{className:"inline-editing-dropdown",css:Te()},t.length>0&&(0,n.jsx)(z.Label,{size:"sm",centric:!0,className:"text-truncate pb-0 mb-0 pt-3 px-3 w-100",style:{textOverflow:"ellipsis",fontWeight:500}},t),(!l||o)&&(0,n.jsx)("div",{className:"d-flex w-100 px-3"},(0,n.jsx)(z.Label,{size:"sm",centric:!0,className:"text-truncate d-flex pb-0 mb-0 w-100",style:{textOverflow:"ellipsis"}},(()=>{if(a){const e=i.findIndex((e=>e===r));return e>-1?a[e]:r}return r})()),(0,n.jsx)(B.CalciteButton,{ref:c,className:(0,n.classNames)("inline-editing-edit__action",{"d-none":1===i.length||o}),scale:"s",disabled:o||i.length<=1,iconStart:"pencil",appearance:"transparent",kind:"neutral",onClick:()=>{m(!0),u(!0)}})),l&&(0,n.jsx)("div",{className:"d-flex w-100 px-3"},(0,n.jsx)(z.Select,{ref:d,className:"w-100",size:"sm",value:r,onChange:e=>{var t;t=e.target.value,m(!0),u(!1),s(t)}},i.map(((e,t)=>(0,n.jsx)("option",{key:t,value:e}," ",((e,t)=>a&&(null==a?void 0:a.length)>0?a[e]:t)(t,e))))),(0,n.jsx)(B.CalciteButton,{scale:"s",iconStart:"x",appearance:"transparent",kind:"neutral",onClick:()=>{m(!0),u(!1)}})))})),wr=(e,t)=>{var o,r,i,a,s,l,u,c,d,f,m,p,h,v,y;return n.css`
    & {
      width: ${n.polished.rem(null===(o=null==t?void 0:t.current)||void 0===o?void 0:o.clientWidth)};
      padding-top: 0;
      padding-bottom: 0;
      /* visibility: unset !important; */
    }
    &.hide-popper {
      border: none;
      outline: none;
      box-shadow: none;
      width: 0;
    }
    button {
      width: 100%;
      border: none;
      text-align: left;
      min-height: ${n.polished.rem(32)};
      border-radius: 0;
    }
    .result-list-content {
      position: relative;
      overflow: auto;
    }
    &.suggestion-list-con, .result-list-content {
      max-height: ${n.polished.rem(300)};
    }
    &.suggestion-list-con {
      overflow: auto;
    }
    &.result-list-con button {
      text-overflow: ellipsis;
      white-space: pre-wrap;
      &:focus-visible {
        background: var(--ref-palette-neutral-200);
      }
    }
    &.result-list-con :disabled, &.result-list-con button:disabled:hover {
      color: ${null===(i=null===(r=null==e?void 0:e.sys.color)||void 0===r?void 0:r.secondary)||void 0===i?void 0:i.dark};
      background-color: ${null===(s=null===(a=null==e?void 0:e.ref.palette)||void 0===a?void 0:a.neutral)||void 0===s?void 0:s[300]};
    }
    &.result-list-con button:hover {
      color: ${null===(l=null==e?void 0:e.ref.palette)||void 0===l?void 0:l.black};
      background-color: ${null===(c=null===(u=null==e?void 0:e.ref.palette)||void 0===u?void 0:u.neutral)||void 0===c?void 0:c[200]};
    }
    &.result-list-con button:focus-visible {
      color: ${null===(d=null==e?void 0:e.ref.palette)||void 0===d?void 0:d.black};
      background-color: ${null===(m=null===(f=null==e?void 0:e.ref.palette)||void 0===f?void 0:f.neutral)||void 0===m?void 0:m[200]};
    }
    &.result-list-con .dropdown-divider {
      margin-left: 0;
      margin-right: 0;
    }
    &.result-list-con button.active {
      background: ${null===(p=null==e?void 0:e.sys.color)||void 0===p?void 0:p.primary.main};
      color: ${null===(h=null==e?void 0:e.ref.palette)||void 0===h?void 0:h.white};
    }
    .show-result-button:active, &.result-list-con .show-result-button:hover {
      background-color: ${null===(v=null==e?void 0:e.ref.palette)||void 0===v?void 0:v.white};
    }
    &.result-list-con .show-result-button:focus-visible {
      background-color: ${null===(y=null==e?void 0:e.ref.palette)||void 0===y?void 0:y.white};
    }
    .dropdown-menu--inner {
      max-height: none;
    }
    .jimu-dropdown-item {
      min-height: ${n.polished.rem(32)};
    }
    .clear-recent-search-con {
      color: var(--sys-color-primary-main) !important;
      height: ${n.polished.rem(40)};
      margin-top: ${n.polished.rem(-4)};
    }
    .dropdown-divider {
      min-height: 0;
    }
    .item-p-l {
      padding-left: ${n.polished.rem(42)} !important;
    }
    .source-label-con {
      color: var(--ref-palette-black) !important;
      font-weight: bold !important;
    }
    .show-result-button-style2 {
      & {
        padding: 0;
        height: ${n.polished.rem(11)};
        min-height: ${n.polished.rem(11)};
        justify-content: center;
        align-items: center;
      }
      svg {
        margin-right: 0;
      }
    }
    &.result-list-con-compact-close {
      & {
        width: ${n.polished.rem(32)};
        border-top: 0;
        justify-content: center;
      }
      .show-result-button {
        & {
          border-radius: 0 0 0.25rem 0.25rem;
          padding: 0;
          height: ${n.polished.rem(8)};
          min-height: ${n.polished.rem(8)};
          justify-content: center;
          align-items: center;
        }
        svg {
          margin-right: 0;
          height: ${n.polished.rem(8)};
        }
      }
    }
    &.result-list-con-compact-open {
      .show-result-button-style2-con {
        position: -webkit-sticky;
        position: sticky;
        bottom: 0;
        left: 0;
        right: 0;
        background: var(--ref-palette-white);
      }
    }
  `},Rr=[0,3],{useEffect:Fr,useRef:kr}=n.React,xr=e=>{const o=kr(null),r=kr(null),{children:i,isOpen:a,reference:s,searchInputRef:l,autoFocus:u,className:c,isFocusWidtSearchInput:d,id:f,offset:m,version:p,toggle:h}=e,v=(0,t.useTheme)(),y=n.ReactRedux.useSelector((e=>{var t;const n=null==e?void 0:e.widgetsRuntimeInfo;return null===(t=null==n?void 0:n[f])||void 0===t?void 0:t.state}));Fr((()=>{var e;return(null==l?void 0:l.current)&&d&&(null===(e=l.current)||void 0===e||e.addEventListener("keydown",g,!0)),()=>{var e;d&&(null===(e=l.current)||void 0===e||e.removeEventListener("keydown",g,!0))}}),[]);const g=n.hooks.useEventCallback((e=>{if(!a)return!1;const t=S()||[],n=(null==t?void 0:t.length)-1;"ArrowUp"===e.key?r.current=setTimeout((()=>{t[n].focus()})):"ArrowDown"===e.key&&(r.current=setTimeout((()=>{t[0].focus()})))})),b=n.hooks.useEventCallback((e=>{if(!a)return;const t="button"===e.target.getAttribute("role");if(["Tab","ArrowUp","ArrowDown"].includes(e.key)&&((e.which>=48&&e.which<=90||"Tab"===e.key)&&e.preventDefault(),a&&t))if(clearTimeout(r.current),"Escape"===e.key)I(e);else if(["ArrowUp","ArrowDown"].includes(e.key)||["n","p"].includes(e.key)&&e.ctrlKey){const t=S();let n=t.indexOf(e.target),i=!1;"ArrowUp"===e.key||"p"===e.key&&e.ctrlKey?(n=0!==n?n-1:t.length-1,i=!0):("ArrowDown"===e.key||"n"===e.key&&e.ctrlKey)&&(i=!1,n=n===t.length-1?0:n+1);const a=0===n&&!i,s=n===t.length-1&&i;r.current=d&&(a||s)?setTimeout((()=>{var e;null===(e=l.current)||void 0===e||e.focus()})):setTimeout((()=>{Array.prototype.slice.call(o.current.querySelectorAll(".popper-box"))[0].focus(),t[n].focus()}))}else if("End"===e.key){const e=S();r.current=setTimeout((()=>{e[e.length-1].focus()}))}else if("Home"===e.key){const e=S();r.current=setTimeout((()=>{e[0].focus()}))}else if(e.which>=48&&e.which<=90){const t=S(),n=String.fromCharCode(e.which).toLowerCase();for(let e=0;e<t.length;e+=1){if((t[e].textContent&&t[e].textContent[0].toLowerCase())===n){r.current=setTimeout((()=>{t[e].focus()}));break}}}})),I=e=>{var t;e.preventDefault(),N(e),null===(t=null==l?void 0:l.current)||void 0===t||t.focus()},S=()=>o?Array.prototype.slice.call(o.current.querySelectorAll('[role="button"]')).filter((e=>!e.disabled)):[],N=e=>{h(e)};return(0,n.jsx)("div",null,(0,n.jsx)(z.Popper,{autoFocus:u,placement:"bottom-start",open:a,toggle:N,css:wr(v,s),reference:s,version:p,className:(0,n.classNames)("result-list-popper",c,{"hide-popper":y===n.WidgetState.Closed}),offset:m||Rr,popperNodeRef:o},(0,n.jsx)("div",{onKeyDown:b},i)))},{useRef:Tr}=n.React,Dr=new(0,n.esri.Sanitizer),Lr=n.React.memo((e=>{const o=n.hooks.useTranslation(K),{className:r,reference:i,searchSuggestion:a,isOpen:s,searchText:l,id:u,searchInputRef:c,toggel:d,onRecordItemClick:f}=e,m=(0,t.useTheme)(),p=Tr(!1),h=()=>{if((null==a?void 0:a.length)<2)return!1;let e=0,t=0;return null==a||a.forEach((n=>{var o;const r=null==n?void 0:n.icon;r&&(e+=1),(null===(o=n.suggestionItem)||void 0===o?void 0:o.length)>0&&r&&(t+=1)})),t>0&&e>0},v=(e,t=!1)=>{const o=null==e?void 0:e.suggestionItem;return null==o?void 0:o.map(((o,r)=>{const i=Dr.sanitize(o.suggestionHtml);return(0,n.jsx)(z.Button,{className:(0,n.classNames)("d-flex align-items-center py-2 jimu-outline-inside",{"item-p-l":t}),key:`${null==e?void 0:e.layer}${r}`,title:o.suggestion,role:"button",onClick:()=>{(e=>{f(e)})(o.suggestion)}},(0,n.jsx)("div",{className:"flex-grow-1",dangerouslySetInnerHTML:{__html:i}}))}))};return(0,n.jsx)("div",null,(0,n.jsx)(xr,{isOpen:s,autoFocus:!1,reference:i,searchInputRef:c,isFocusWidtSearchInput:!0,toggle:d,id:u,className:(0,n.classNames)("result-list-con suggestion-list-con",r)},(()=>{let e=[];a.forEach((t=>{const n=(null==t?void 0:t.suggestionItem)||[];e=e.concat(n)}));return l&&0===e.length})()&&(0,n.jsx)(z.Button,{role:"button",className:"text-center py-2",disabled:!0,title:o("noResult",{searchText:l})},o("noResult",{searchText:l})),(p.current=null,null==a?void 0:a.map(((e,t)=>{var o,r,i;const s=(null==a?void 0:a.length)>1&&(null===(o=null==e?void 0:e.suggestionItem)||void 0===o?void 0:o.length)>0;return(0,n.jsx)("div",{key:`${null==e?void 0:e.layer}-${t}`,role:"group","aria-label":null==e?void 0:e.layer},s&&(0,n.jsx)(z.Button,{role:"button",className:"source-label-con jimu-outline-inside",disabled:!0,title:null==e?void 0:e.layer},(null==e?void 0:e.icon)&&(0,n.jsx)(z.Icon,{className:"mr-2",color:null===(r=null==m?void 0:m.sys.color)||void 0===r?void 0:r.primary.main,size:16,icon:null===(i=null==e?void 0:e.icon)||void 0===i?void 0:i.svg}),null==e?void 0:e.layer),v(e,h()))})))))}));const Er=function(){return s.Date.now()};var jr=Math.max,Mr=Math.min;const Ar=function(e,t,n){var o,r,i,a,s,l,u=0,c=!1,d=!1,f=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function m(t){var n=o,i=r;return o=r=void 0,u=t,a=e.apply(i,n)}function h(e){var n=e-l;return void 0===l||n>=t||n<0||d&&e-u>=i}function v(){var e=Er();if(h(e))return y(e);s=setTimeout(v,function(e){var n=t-(e-l);return d?Mr(n,i-(e-u)):n}(e))}function y(e){return s=void 0,f&&o?m(e):(o=r=void 0,a)}function g(){var e=Er(),n=h(e);if(o=arguments,r=this,l=e,n){if(void 0===s)return function(e){return u=e,s=setTimeout(v,t),c?m(e):a}(l);if(d)return clearTimeout(s),s=setTimeout(v,t),m(l)}return void 0===s&&(s=setTimeout(v,t)),a}return t=E(t)||0,p(n)&&(c=!!n.leading,i=(d="maxWait"in n)?jr(E(n.maxWait)||0,t):i,f="trailing"in n?!!n.trailing:f),g.cancel=function(){void 0!==s&&clearTimeout(s),u=0,o=l=r=s=void 0},g.flush=function(){return void 0===s?a:y(Er())},g},Or=n.React.memo((e=>{const{reset:t,widgetId:o,fieldName:r,fieldType:i,dataSource:a,isDataSourceReady:s,onChange:l,onAccept:u}=e,c=n.hooks.useTranslation(K),d=n.React.useRef(null),f=n.React.useRef((e=>{})),m=n.React.useRef(null),p=n.React.useRef(null),h=n.React.useRef(null),v=n.React.useRef(null),y=n.React.useRef(!1),g=n.React.useRef(!1),[b,I]=n.React.useState(null),[S,N]=n.React.useState(!1),[w,R]=n.React.useState([]);n.React.useEffect((()=>{I(null),x(null),setTimeout((()=>{p.current.select(),p.current.focus(),p.current.blur()}),200)}),[t]),n.React.useEffect((()=>{f.current=Ar(k,400)}),[]);const F=n.React.useMemo((()=>a),[a]),k=n.hooks.useEventCallback((e=>{const t=ce(r,e,a);Promise.all([t]).then((e=>{const t=null==e?void 0:e[0];t&&R(t),m.current&&N(!0)})).catch((e=>{}))})),x=e=>{re(m)&&""!==m.current&&""===e&&setTimeout((()=>{p.current.select(),p.current.focus(),p.current.blur()}),200)},T=e=>{m.current=e,I(e)},D=()=>{var e;null===(e=p.current)||void 0===e||e.focus(),L(!0,!1)},L=(e=!1,t=!0)=>{e||(g.current=!1)};return(0,n.jsx)("div",{className:"route-input"},(0,n.jsx)("div",{ref:d,className:"d-flex w-100"},(0,n.jsx)(z.TextInput,{"aria-label":c("routeIdLabel"),type:"text",className:"w-100",size:"sm",allowClear:!!b,disabled:!s,onBlur:()=>{h.current=setTimeout((()=>{y.current||N(!1),g.current||L(!1)}),200)},value:b||"",ref:p,onChange:e=>{var t;v.current=null;const n=null===(t=null==e?void 0:e.target)||void 0===t?void 0:t.value,o=(null==n?void 0:n.length)>2;if(x(n),T(n),l(n),!o)return N(!1),!1;f.current(n)},checkValidityOnAccept:e=>new Promise((t=>{setTimeout((()=>{v.current&&(e=v.current);const o=F,a={};i===n.JimuFieldType.Number?a.where=`${r} LIKE ${e}`:a.where=`LOWER(${r}) LIKE LOWER('${e}')`;const s=o.queryCount(a).then((t=>0===t.count&&e.length>0?(u(e,!1),{valid:!1,msg:c("invalidRouteField")}):(u(e,!0),{valid:!0}))).catch((t=>(u(e,!1),{valid:!1})));t(s)}),200)}))}),b&&(0,n.jsx)(Lr,{isOpen:(S||(y.current=!1),S),reference:d,searchText:b,searchSuggestion:w,onRecordItemClick:(e,t)=>{if(t)return D(),!1;v.current=e,T(e)},id:o,searchInputRef:p})))}));var Pr,Cr,Vr,_r,Ur,$r,Gr=c(68972);!function(e){e.EsriSuccess="esriSuccess",e.EsriReconcileRequired="esriReconcileRequired",e.EsriWrongReconcileVersion="esriWrongReconcileVersion",e.EsriConflictsDuringReconcile="esriConflictsDuringReconcile",e.EsriCouldNotAcquireAllLocks="esriCouldNotAcquireAllLocks",e.EsriActiveEditSessionOnVersion="esriActiveEditSessionOnVersion"}(Pr||(Pr={})),function(e){e.EsriSuccess="esriSuccess",e.EsriPostRequired="esriPostRequired",e.EsriWrongPostVersion="esriWrongPostVersion",e.EsriCouldNotReleaseAllLocks="esriCouldNotReleaseAllLocks",e.EsriCouldNotReleaseAllLocksPostRequired="esriCouldNotReleaseAllLocksPostRequired",e.EsriCouldNotReleaseAllLocksOwnedByOtherUsers="esriCouldNotReleaseAllLocksOwnedByOtherUsers",e.EsriCouldNotReleaseAllLocksActiveEditSession="esriCouldNotReleaseAllLocksActiveEditSession",e.EsriCouldNotReleaseAllLocksNeedToRunAebGpToolOnDefault="esriCouldNotReleaseAllLocksNeedToRunAebGpToolOnDefault"}(Cr||(Cr={})),function(e){e.No="no",e.Yes="yes",e.OnPost="onPost",e.Undefined="undefined"}(Vr||(Vr={})),function(e){e[e.Acquire=0]="Acquire",e[e.Release=1]="Release",e[e.Query=2]="Query",e[e.Locks=3]="Locks"}(_r||(_r={})),function(e){e[e.Reconcile=0]="Reconcile",e[e.Versions=1]="Versions",e[e.StartRead=2]="StartRead",e[e.StopRead=3]="StopRead",e[e.StartEdit=4]="StartEdit",e[e.StopEdit=5]="StopEdit"}(Ur||(Ur={})),function(e){e[e.Query=0]="Query",e[e.QueryAndAcquire=1]="QueryAndAcquire",e[e.QueryAndRelease=2]="QueryAndRelease",e[e.Acquire=3]="Acquire",e[e.Release=4]="Release",e[e.Clear=5]="Clear",e[e.None=6]="None"}($r||($r={}));var qr=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function Br(e,t,o){return qr(this,void 0,void 0,(function*(){if(!ri(t,e,!1))return t;const r=ve(e.url);return function(e){return qr(this,void 0,void 0,(function*(){var t;const o=ei(e,_r.Locks),r={f:"json",token:null===(t=n.SessionManager.getInstance().getMainSession())||void 0===t?void 0:t.token};return yield Ge({method:"GET",url:o,params:r}).then((e=>{var t;return(null===(t=null==e?void 0:e.lrs[0])||void 0===t?void 0:t.lockTableFields)||null}))}))}(e.url).then((n=>function(e,t,n,o,r){return qr(this,void 0,void 0,(function*(){const i=ei(e.url,_r.Query);let a=`${n.routeIdFieldName} IN ('${t.routeOrLineId.join("','")}')`;a+=` AND ${n.networkIdFieldName} IN (${t.networkId.toString()})`;return Ge({method:"GET",url:i,params:{f:"json",token:o.token,where:a,returnReleasableStatus:r}}).then((e=>e))}))}(e,t,n,r,o).then((e=>re(e)?(t.details=e.locks,t):(t.details=[],t)))))}))}function zr(e,t){return qr(this,void 0,void 0,(function*(){const n={acquireStatus:Pr.EsriCouldNotAcquireAllLocks,acquiredLocks:[],unavailableLocks:[]};if(!ri(t,e,!0))return n;const o=ve(e.url),r=ye(e),i=ei(e.url,_r.Acquire),a=[];t.eventServiceLayerIds.forEach(((e,n)=>{t.isLine[n]?a.push({lineId:t.routeOrLineId[n],layerId:e}):a.push({routeId:t.routeOrLineId[n],layerId:e})}));return Ge({method:"GET",url:i,params:{f:"json",token:o.token,editVersion:r,acquireLocks:a}}).then((e=>e))}))}function Wr(e,t){return qr(this,void 0,void 0,(function*(){if(!ri(t,e,!0))return!1;if(ge(ye(e))){return(yield Qr(e,t)).releaseStatus===Cr.EsriSuccess}}))}function Hr(e,t,n){return qr(this,void 0,void 0,(function*(){if(!re(t)||!re(n))return!1;const o=ve(e.url),r=ye(e);if(t.user===o.username&&t.versionName===r&&n.eventServiceLayerIds.includes(t.layerId))return!0;if(t.releasableStatus===Vr.Yes){const o={routeOrLineId:[t.routeId],eventServiceLayerIds:[t.layerId],isLine:[n.isLine[0]],networkId:[t.lrsNetworkId],status:n.status,details:[],routeInfo:n.routeInfo,lockAction:n.lockAction};return(yield Qr(e,o)).releaseStatus===Cr.EsriSuccess}}))}function Qr(e,t){return qr(this,void 0,void 0,(function*(){if(!ri(t,e,!0))return null;const n=ei(e.url,_r.Release),o=ve(e.url),r=[];t.eventServiceLayerIds.forEach(((e,n)=>{t.isLine[n]?r.push({lineId:t.routeOrLineId[n],layerId:e}):r.push({routeId:t.routeOrLineId[n],layerId:e})}));return Ge({method:"GET",url:n,params:{f:"json",token:o.token,releaseLocks:r}}).then((e=>e))}))}function Jr(e){return qr(this,void 0,void 0,(function*(){const t=ve(e.url),o=yield Kr(e.url,ye(e));if(!re(o)||""===o)return!1;const r=o.replace("{","").replace("}",""),i=ti(e.url,Ur.Reconcile,r);let a="{"+n.utils.getUUID()+"}";a=a.replace(/[_]/g,"-");const s={token:t.token,sessionId:a,abortIfConflicts:!0,conflictDetection:"byAttribute",withPost:!0,saveEdits:!0},l=ti(e.url,Ur.StartRead,r),u=ti(e.url,Ur.StartEdit,r),c=ti(e.url,Ur.StopRead,r),d=ti(e.url,Ur.StopEdit,r);let f=!1;return yield Ge({method:"POST",url:l,params:s}).then((e=>qr(this,void 0,void 0,(function*(){e.success&&(yield Ge({method:"POST",url:u,params:s}).then((e=>qr(this,void 0,void 0,(function*(){e.success&&(yield Ge({method:"POST",url:i,params:s}).then((e=>qr(this,void 0,void 0,(function*(){e.success&&(f=!0,yield Ge({method:"POST",url:d,params:s}).then((e=>qr(this,void 0,void 0,(function*(){e.success&&(yield Ge({method:"POST",url:c,params:s}).then((e=>{})))})))))})))))})))))})))),f}))}function Kr(e,t){return qr(this,void 0,void 0,(function*(){if(ge(t))return"";const n=ti(e,Ur.Versions),o={f:"json",token:ve(e).token};return yield Ge({method:"GET",url:n,params:o}).then((e=>{let n="";return e.versions.forEach((e=>{e.versionName===t&&(n=e.versionGuid)})),n}))}))}function Yr(){return{routeInfo:null,networkId:[],routeOrLineId:[],eventServiceLayerIds:[],isLine:[],status:Pr.EsriSuccess,details:[],lockAction:$r.None}}function Zr(e){return""!==e.routeId||""!==e.lineId}function Xr(e,t){if(0===t.details.length)return!0;const n=ve(e.url),o=t.details.filter((e=>e.user===n.username));if(0===o.length)return!0;const r=ye(e),i=o.filter((e=>e.versionName===r));if(0===i.length)return!0;const a=Object.assign([],t.eventServiceLayerIds);for(let e=0;e<i.length;e++){if(""===i[e].eventFeatureClassName)return!1;re(a)&&a.includes(i[e].layerId)&&a.splice(a.indexOf(i[e].layerId),1)}return!re(a)||0!==a.length}function ei(e,t){let n=ni(e);switch(n+="MapServer/exts/LRServer/",t){case _r.Acquire:n+="Locks/acquire";break;case _r.Release:n+="Locks/release";break;case _r.Query:n+="Locks/query";break;case _r.Locks:n+="locks"}return n}function ti(e,t,n){let o=ni(e);switch(o+="VersionManagementServer/",t){case Ur.Reconcile:o+=`versions/${n}/reconcile`;break;case Ur.Versions:o+="versions";break;case Ur.StartRead:o+=`versions/${n}/startReading`;break;case Ur.StopRead:o+=`versions/${n}/stopReading`;break;case Ur.StartEdit:o+=`versions/${n}/startEditing`;break;case Ur.StopEdit:o+=`versions/${n}/stopEditing`}return o}function ni(e){return e.includes("MapServer")?e.substring(0,e.lastIndexOf("MapServer")):e.includes("FeatureServer")?e.substring(0,e.lastIndexOf("FeatureServer")):""}function oi(e){return qr(this,void 0,void 0,(function*(){var t;const o=ei(e,_r.Locks),r={f:"json",token:null===(t=n.SessionManager.getInstance().getMainSession())||void 0===t?void 0:t.token};return yield Ge({method:"GET",url:o,params:r}).then((e=>{var t;return(null===(t=null==e?void 0:e.lrs)||void 0===t?void 0:t[0].conflictPreventionEnabled)||!1}))}))}function ri(e,t,n){return!(!re(e)||!re(t))&&!(n&&!function(e){return e.eventServiceLayerIds.length===e.routeOrLineId.length&&e.eventServiceLayerIds.length===e.isLine.length}(e))}var ii=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};class ai extends Gr.default.PureComponent{constructor(e){super(e),this.state={lockInfo:null,toastMsg:"",toastMsgType:"warning",toastOpen:!1}}componentDidUpdate(e){return ii(this,void 0,void 0,(function*(){if(this.props.conflictPreventionEnabled){if(this.hasNullProps())return void this.clearMessage();if(!this.didChange(e))return void this.clearMessage();if(this.doAction())switch(this.props.lockInfo.lockAction){case $r.Acquire:yield this.doAcquireLock();break;case $r.QueryAndAcquire:yield this.doQueryAndAcquireLock();break;case $r.QueryAndRelease:yield this.doQueryAndReleaseLock();break;case $r.Query:yield this.doQueryLock();break;case $r.Release:yield this.doReleaseLock();break;case $r.Clear:this.clearMessage();case $r.None:}else this.clearMessage()}}))}clearMessage(){re(this.props.lockInfo)&&this.props.lockInfo.lockAction===$r.Clear&&(this.setState({toastMsg:"",toastMsgType:"info",toastOpen:!1}),this.props.onMessageClear&&this.props.onMessageClear())}shouldClearMessageState(){return""===this.state.toastMsg||!(!re(this.props.lockInfo)||!re(this.state.lockInfo)||this.props.lockInfo.routeOrLineId===this.state.lockInfo.routeOrLineId||this.props.lockInfo.networkId===this.state.lockInfo.networkId||this.props.lockInfo.eventServiceLayerIds===this.state.lockInfo.eventServiceLayerIds)}hasNullProps(){var e;return!re(this.props.lockInfo)||(!re(null===(e=this.props.lockInfo)||void 0===e?void 0:e.routeInfo)||!re(this.props.featureDS))}didChange(e){return!(re(e.lockInfo)||!re(this.props.lockInfo))||(e.lockInfo.networkId.toString()!==this.props.lockInfo.networkId.toString()||(e.lockInfo.eventServiceLayerIds.toString()!==this.props.lockInfo.eventServiceLayerIds.toString()||(!(re(e.featureDS)||!re(this.props.featureDS))||(!(!re(e.featureDS)||!re(this.props.featureDS)||e.featureDS.id===this.props.featureDS.id)||(!(re(e.lockInfo.routeInfo)||!re(this.props.lockInfo.routeInfo))||(e.lockInfo.routeInfo.routeId!==this.props.lockInfo.routeInfo.routeId||(e.lockInfo.routeInfo.lineId!==this.props.lockInfo.routeInfo.lineId||e.lockInfo.lockAction!==this.props.lockInfo.lockAction)))))))}doAction(){return!!re(this.props.lockInfo.routeInfo)&&(!(!re(this.props.lockInfo.routeInfo.routeId)||""===this.props.lockInfo.routeInfo.routeId)&&(!(!re(this.props.lockInfo.networkId)||0===this.props.lockInfo.networkId.length)&&(!(!re(this.props.lockInfo.eventServiceLayerIds)||0===this.props.lockInfo.eventServiceLayerIds.length)&&!!re(this.props.featureDS))))}doQueryLock(){return ii(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Br(this.props.featureDS,e,!0);this.setState({lockInfo:e}),this.props.onQueryComplete&&this.props.onQueryComplete(t,!0)}))}doQueryAndAcquireLock(){return ii(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Br(this.props.featureDS,e,!1);if(Xr(this.props.featureDS,t)){let n=yield zr(this.props.featureDS,t);if(n.acquireStatus===Pr.EsriReconcileRequired){(yield Jr(this.props.featureDS))&&(n=yield zr(this.props.featureDS,t))}this.props.showAlert&&this.setAlert(n,t,!0),this.setState({lockInfo:e}),this.props.onQueryAndAcquireComplete&&(n.acquireStatus===Pr.EsriSuccess?this.props.onQueryAndAcquireComplete(t,n,!0):this.props.onQueryAndAcquireComplete(t,n,!1))}else this.shouldClearMessageState()&&this.setState({toastMsg:"",toastMsgType:"info",toastOpen:!1}),this.setState({lockInfo:e}),this.props.onQueryAndAcquireComplete&&this.props.onQueryAndAcquireComplete(t,null,!0)}))}doQueryAndReleaseLock(){return ii(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Br(this.props.featureDS,e,!0);for(let n=0;n<t.details.length;n++)yield Hr(this.props.featureDS,t.details[n],e);this.setState({lockInfo:e}),this.props.onQueryAndReleaseComplete&&this.props.onQueryAndReleaseComplete(t,!0)}))}doAcquireLock(){return ii(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams();let t=yield zr(this.props.featureDS,e);if(t.acquireStatus===Pr.EsriReconcileRequired){(yield Jr(this.props.featureDS))&&(t=yield zr(this.props.featureDS,e))}this.props.showAlert&&this.setAlert(t,e,!0),this.setState({lockInfo:e}),this.props.onAcquireComplete&&(t.acquireStatus===Pr.EsriSuccess?this.props.onAcquireComplete(t,!0):this.props.onAcquireComplete(t,!1))}))}doReleaseLock(){return ii(this,void 0,void 0,(function*(){const e=this.createLockInfoFromParams(),t=yield Qr(this.props.featureDS,e);this.setState({lockInfo:e}),this.props.onReleaseComplete&&(t.releaseStatus===Cr.EsriSuccess?this.props.onReleaseComplete(t,!0):this.props.onReleaseComplete(t,!1))}))}createLockInfoFromParams(){const e=[],t=[];this.props.lockInfo.eventServiceLayerIds.forEach(((n,o)=>{const r=""!==this.props.lockInfo.routeInfo.lineId;e.push(r?this.props.lockInfo.routeInfo.lineId:this.props.lockInfo.routeInfo.routeId),t.push(r)}));return{networkId:this.props.lockInfo.networkId,routeOrLineId:e,eventServiceLayerIds:this.props.lockInfo.eventServiceLayerIds,isLine:t,status:Pr.EsriSuccess,details:[],routeInfo:this.props.lockInfo.routeInfo,lockAction:$r.None}}getNameOrId(e){return""!==e.lineId&&""===e.lineName?e.lineId:""!==e.lineId&&""!==e.lineName?e.lineName:""!==e.routeName?e.routeName:e.routeId}getNameOrIdFromUnavailableLock(e){return re(e.routeName)&&""!==e.routeName?e.routeName:re(e.lineName)&&""!==e.lineName?e.lineName:re(e.routeId)&&""!==e.routeId?e.routeId:re(e.lineId)&&""!==e.lineId?e.lineId:void 0}setAlert(e,t,n){var o;let r="",i="info",a="";const s=(null===(o=null==t?void 0:t.details[0])||void 0===o?void 0:o.lrsNetworkName)||this.props.networkName,l=ye(this.props.featureDS);switch(e.acquireStatus){case Pr.EsriSuccess:a=this.getNameOrId(this.props.lockInfo.routeInfo),r=""!==this.props.lockInfo.routeInfo.lineId?X(this.props.intl,"YouAcquiredLockOnLine",{nameOrId:a,networkName:s,version:l}):X(this.props.intl,"YouAcquiredLockOnRoute",{nameOrId:a,networkName:s,version:l}),i="info";break;case Pr.EsriReconcileRequired:r=X(this.props.intl,"ReconcileRequired"),i="error";break;case Pr.EsriCouldNotAcquireAllLocks:const t=e.unavailableLocks[0].versionName,o=e.unavailableLocks[0].user;a=this.getNameOrIdFromUnavailableLock(e.unavailableLocks[0]),r=""===t?""!==this.props.lockInfo.routeInfo.lineId?X(this.props.intl,"UnavailableLockOnLineWithoutVersion",{nameOrId:a,networkName:s,lockUser:o}):X(this.props.intl,"UnavailableLockOnRouteWithoutVersion",{nameOrId:a,networkName:s,lockUser:o}):""!==this.props.lockInfo.routeInfo.lineId?X(this.props.intl,"UnavailableLockOnLine",{nameOrId:a,networkName:s,lockUser:o,version:t}):X(this.props.intl,"UnavailableLockOnRoute",{nameOrId:a,networkName:s,lockUser:o,version:t}),i="error";break;default:r="",i="info",n=!1}this.setState({toastMsg:r,toastMsgType:i,toastOpen:n})}render(){const{conflictPreventionEnabled:e}=this.props;return e&&re(this.props.lockInfo)&&re(this.props.lockInfo.routeInfo)&&re(this.props.featureDS)&&this.props.showAlert&&""!==this.state.toastMsg?Gr.default.createElement(z.Alert,{className:"lock-manager-alert w-100",size:"small",type:this.state.toastMsgType,text:this.state.toastMsg,closable:!0,withIcon:!0,open:this.state.toastOpen,onClose:()=>{this.setState({toastOpen:!1})}}):null}}var si=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function li(e){const{disabled:t,networkDs:o,eventDataSources:i,jimuMapView:a,hoverGraphic:s,onAttributesCopied:l}=e,u=n.hooks.useTranslation(K),c=n.React.useRef(null),d=n.React.useRef(null),[f,m]=n.React.useState(null),p=n.React.useRef(!1),h=n.React.useRef(!1),[v,y]=n.React.useState(!1),[g,b]=n.React.useState();n.React.useEffect((()=>{if(re(o)){const e=o;re(null==e?void 0:e.layer)&&m(null==e?void 0:e.layer)}re(null==a?void 0:a.view)&&b(null==a?void 0:a.view.popupEnabled)}),[null==a?void 0:a.view,o]),n.React.useEffect((()=>{v?I():S()}),[v]);const I=()=>{c.current=null==a?void 0:a.view.on("pointer-move",F),d.current=null==a?void 0:a.view.on("pointer-down",k)},S=()=>{re(c.current)&&(c.current.remove(),c.current=null),re(d.current)&&(d.current.remove(),d.current=null),h.current&&(h.current=!1),p.current&&(p.current=!1)},N=()=>{re(s)&&s.removeAll()},w=e=>{N(),re(e)&&s.add(e)},R=(e,t)=>{const n=t.spatialReference,o=t.createQuery(),r="degrees"===n.unit?4:Math.max(3*n.metersPerUnit,3);return o.geometry=e,o.units="meters",o.returnGeometry=!0,o.returnM=!0,o.returnZ=!0,o.distance=(null==a?void 0:a.view.resolution)*r,o.spatialRelationship="intersects",o},F=e=>{re(f)&&!p.current&&(0,r.loadArcGISJSAPIModules)(["esri/geometry/geometryEngine","esri/TimeExtent"]).then((t=>{let n=null,r=null;[n,r]=t,p.current=!0;const i=o.getCurrentQueryParams(),s=null==a?void 0:a.view.toMap(e),l=R(s,f);l.outFields=[],(null==i?void 0:i.time)&&(l.timeExtent=new r({start:i.time[0],end:i.time[1]})),l.gdbVersion=i.gdbVersion,f.queryFeatures(l).then((e=>si(this,void 0,void 0,(function*(){if(e.features.length>0){const t=e.features[0].geometry,o=n.nearestCoordinate(t,s),r=n.nearestVertex(t,s);r.distance<3*l.distance&&(o.coordinate=r.coordinate),w(yield Pe(yield _e(o.coordinate))),p.current=!1}p.current&&(w(null),p.current=!1)}))))}))},k=e=>si(this,void 0,void 0,(function*(){re(f)&&!h.current&&(e.stopPropagation(),(0,r.loadArcGISJSAPIModules)(["esri/TimeExtent"]).then((t=>si(this,void 0,void 0,(function*(){let n=null;[n]=t,a.view.popupEnabled=!1,h.current=!0;const o=null==a?void 0:a.view.toMap(e),r=[];yield Promise.all(i.map((e=>si(this,void 0,void 0,(function*(){const t=e,i=R(o,null==t?void 0:t.layer);i.outFields=["*"];const a=t.getCurrentQueryParams();(null==a?void 0:a.time)&&(i.timeExtent=new n({start:a.time[0],end:a.time[1]})),i.gdbVersion=a.gdbVersion;const s=yield null==t?void 0:t.layer.queryFeatures(i).then((e=>si(this,void 0,void 0,(function*(){const t=[];if(e.features.length>0){const n=e.features[0].attributes;for(const e in n){const o={name:e,value:n[e]};t.push(o)}}return t})))),l={layerId:t.layerId,fieldValuePair:s};r.push(l)}))))).then((()=>{r.length>0&&l(r)})).finally((()=>{x()})).catch((()=>{x()}))})))))})),x=()=>{y(!1),S(),h.current=!1,setTimeout((()=>{a.view.popupEnabled=g,a.clearSelectedFeatures()}),800),N()};return(0,n.jsx)(z.Tooltip,{title:u("copyAttributes")},(0,n.jsx)(B.CalciteButton,{scale:"s",css:Te(),iconStart:"eyedropper",appearance:v?"solid":"outline",kind:"brand",disabled:!!t||void 0,tabIndex:-1,onClick:()=>{y(!v)}}))}var ui=c(48993),ci=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function di(e,t,n,o,i){return ci(this,void 0,void 0,(function*(){const a=(yield(0,r.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]))[0],s=i+o.id,l=o.view.map.findLayerById(s);re(l)&&o.view.map.remove(l);const u=new a({id:s,listMode:n,legendEnabled:!1,title:s,geometryType:t,source:[],objectIdField:"OBJECTID",elevationInfo:{mode:ui.DrawingElevationMode3D.RelativeToGround},hasZ:!0,hasM:!0,popupEnabled:!1,popupTemplate:null,outFields:["*"],labelsVisible:!1,spatialReference:o.view.spatialReference,screenSizePerspectiveEnabled:!1,fields:e});return o.view.map.add(u),u}))}function fi(e){return ci(this,void 0,void 0,(function*(){const t=n.DataSourceManager.getInstance().getDataSource(e.dataSourceId);if(re(t)){const e=t;return(null==e?void 0:e.layer)||(yield e.createJSAPILayerByDataSource())}return null}))}function mi(e,t){const n=e.find((e=>e.type===t));return re(n)?n.clone():null}function pi(e,t){const n=e.find((e=>e.name===t));return re(n)?n.clone():null}function hi(e,t){let n=t.replace(/[^a-zA-Z0-9_]+/g,""),o=0,r=!0;for(;r;){const i=n.toUpperCase();r=e.includes(i),r&&(o++,n=t.replace(/[^a-zA-Z0-9_]+/g,"")+"_"+o.toString())}return n}function vi(e,t){return e.filter((e=>t.includes(e.name)))}function yi(){return["SHAPE_LENGTH","SHAPE_LEN","SHAPELENGTH","SHAPELEN","SHAPE__LENGTH","SHAPE__LENGTH__","SE_LENGTH","ST_LENGTH","STLENGTH","DB2GSEST_LENGTH","DB2GSESDELENGTH","SDELENGTH","SHAPESTLENGTH","SDO_GEOMSDO_LENGTH"]}function gi(e,t,n,o){return ci(this,void 0,void 0,(function*(){const i=new(0,(yield(0,r.loadArcGISJSAPIModules)(["esri/layers/support/Field"]))[0]);return i.name=e,i.alias=t,i.type=n,i.editable=o,i.defaultValue=null,i}))}var bi=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function Ii(e){return bi(this,void 0,void 0,(function*(){return new Promise((function(t,o){const r={params:e.params,httpMethod:e.method};n.esri.restRequest.request(e.url,r).then((e=>{t(e)})).catch((e=>{t(e)}))}))}))}function Si(e){return bi(this,void 0,void 0,(function*(){if(!e)return[];const t=e.url,o=e.layerId,r=n.SessionManager.getInstance().getSessionByUrl(t),i=r&&r.token?r.token:"";return Ii({method:"POST",url:`${t}/queryDataElements`,params:{f:"json",layers:JSON.stringify([o]),token:i}}).then((e=>{var t,n;return null!==(n=null===(t=e.layerDataElements)||void 0===t?void 0:t[0].dataElement.fieldGroups)&&void 0!==n?n:[]}))}))}function Ni(e){return bi(this,void 0,void 0,(function*(){if(!e)return[];const t=e.url,o=e.layerId,r=n.SessionManager.getInstance().getSessionByUrl(t),i=r&&r.token?r.token:"";return Ii({method:"POST",url:t+"/queryContingentValues",params:{f:"json",layers:JSON.stringify([o]),token:i}}).then((e=>e))}))}function wi(e,t,n,o,r,i,a){const s={};if(re(o))if(-1===e&&-1===n)o.forEach((e=>{s[e.name]=e.value}));else{const t=o[n];o.forEach((n=>{s[n.name]=n.value,n.name===t.name&&(s[n.name]=e)}))}else a.forEach((e=>{const t=i.attributes[e.name],n=e.alias.split(".")[1];s[n]=t}));const l=[];for(const e of r){const t=e.isEditingRestrictive?"error":"warning";let n=!1;const o=e.contingencies.filter((e=>!e.isRetired));if(!o||0===o.length)return[];for(const e of o){let t=!0;for(const n in e.values){const o=e.values[n];if("any"!==o.objectType)if("null"===o.objectType){if(null!=s[n]){t=!1;break}}else if("code"===o.objectType){if(null!=o.codedValue&&s[n]!==o.codedValue.code){t=!1;break}}else if("range"===o.objectType){const e=s[n];if(null!=o.minValue&&null!=o.maxValue&&(e<o.minValue||e>o.maxValue)){t=!1;break}}}if(t){n=!0;break}}n||l.push({fieldGroup:e,type:t})}return l}function Ri(e,t,n){const o=e&&!Number.isNaN(e)?function(e,t){const n=e.domains;if(n)return n[t]||null;return null}(e,t):n.getFieldDomain(t);return"inherited"===(null==o?void 0:o.type)?n.getFieldDomain(t):o}function Fi(e){return null!=e&&("string"===e.type||"esriFieldTypeString"===e.type)}function ki(e){return null!=e&&("date"===e.type||"esriFieldTypeDate"===e.type)}function xi(e,t,n,o){const r=null==e?void 0:e.contingentValueSets;if(!r)return[];const i=null==r?void 0:r[0].fieldGroups;if(!i||0===(null==i?void 0:i.length))return[];return t.map((e=>{const t=i.find((t=>t.name===e.name));if(t){const i=t.contingencies.map((t=>{var i;const a=t.id,s=t.isRetired||!1,l=function(e,t){const n=null==t?void 0:t.sourceJSON;let o;n.subtypes&&(o=n.subtypes.find((t=>t.code===e)));return o||null}(t.subtypeCode,n);if(Number.isNaN(o)||(null==l?void 0:l.code)===o){const o={};for(let a=0;a<e.fields.length;a++){const s=e.fields[a];let u=t.values[a];if("number"==typeof u||"string"==typeof u){const e=Ri(l,s,n),t=n.getField(s);if(Fi(t))u=r[0].stringDictionary[u];else if(ki(t)){const e=new Date(`${u}+00:00`);u=e.getTime()}const a={codedValue:null===(i=null==e?void 0:e.codedValues)||void 0===i?void 0:i.find((e=>e.code===u)),objectType:"code"};o[s]=a}else if("object"==typeof u){const e={minValue:u.minValue,maxValue:u.maxValue,objectType:"range"};o[s]=e}else if(u){const e={objectType:"any"};o[s]=e}else{const e={objectType:"null"};o[s]=e}}return{id:a,isRetired:s,subtype:l,values:o}}return null})),a=[];return null==i||i.forEach((e=>{null!==e&&a.push(e)})),{name:e.name,isEditingRestrictive:e.isEditingRestrictive,fields:e.fields,contingencies:a}}return[]}))}function Ti(e){if(null==e)return null;const t=e.trim();let n="";for(let e=0;e<t.length;e++){const o=t.charCodeAt(e);n+=o>=48&&o<=57||o>=65&&o<=90||o>=97&&o<=122||95===o||o>=128&&o<=65535?t[e]:"_"}return(n[0]>="0"&&n[0]<="9"||"_"===n[0])&&(n="F"+n),n||null}const Di=e=>{const t=[];if(null==e||0===(null==e?void 0:e.length))return[];for(const n of e){const e=[],{contingencies:o,fields:r,name:i}=n;for(const t of o)t.isRetired||e.push({values:t.values});e.length>0&&t.push({name:i,fields:r,contingencies:e})}return t};function Li(e,t){const n=new Map;if(!re(t))return[...n.values()];const o=Di(t).slice();if(o)for(const t of o){const o=null==t?void 0:t.contingencies;for(const t of o){const o=null==t?void 0:t.values[e];if("code"===(null==o?void 0:o.objectType)||"null"===(null==o?void 0:o.objectType)){const{code:e,name:t}=o.codedValue&&"null"!==o.objectType?o.codedValue:{code:"",name:"No value"};n.has(e)||n.set(e,{name:t,code:e})}}}return[...n.values()]}function Ei(e){if(!e)return new Set;const t=e.flatMap((e=>e.fields));return new Set(t)}var ji=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function Mi(e,t){const n=t+e.id,o=e.view.map.findLayerById(n);re(o)&&e.view.map.remove(o)}function Ai(e,t,o,r,i,a){return ji(this,void 0,void 0,(function*(){const s=(yield(0,n.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]))[0],l=r+t.id,u=t.view.map.findLayerById(l);re(u)&&t.view.map.remove(u);const c={type:"text",color:i||[0,0,0],haloColor:[255,255,255,.8],haloSize:1,font:{size:a||12}},d=new s({id:l,listMode:"hide",legendEnabled:!1,title:l,geometryType:"point",source:[],objectIdField:"OBJECTID",elevationInfo:{mode:ui.DrawingElevationMode3D.RelativeToGround},hasZ:!0,hasM:!0,popupEnabled:!1,popupTemplate:null,outFields:["*"],labelsVisible:!0,screenSizePerspectiveEnabled:!1,fields:e,labelingInfo:[{labelExpressionInfo:{expression:o},symbol:c}]});return t.view.map.add(d),d}))}function Oi(e){return ji(this,void 0,void 0,(function*(){const t=yield(0,n.loadArcGISJSAPIModules)(["esri/geometry/Point","esri/geometry/geometryEngine"]),o=t[0],r=t[1].planarLength(e)/2;if(0<e.paths.length){const t=e.paths[0];let n,i,a,s,l,u,c,d,f,m=0;if(0===r)return e.getPoint(0,0);if(r>0)for(let p=1;p<t.length;p++){if(n=t[p-1][0],s=t[p-1][1],i=t[p][0],l=t[p][1],c=Pi(n,s,i,l),m+=c,m===r)return e.getPoint(0,p);if(m>r)return d=c-(m-r),f=Math.atan2(l-s,i-n),a=d*Math.cos(f),u=d*Math.sin(f),new o({x:n+a,y:s+u,spatialReference:{wkid:e.spatialReference.wkid}})}}return null}))}function Pi(e,t,n,o){return Math.sqrt(Math.pow(n-e,2)+Math.pow(o-t,2))}var Ci,Vi,_i=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function Ui(e,t,n,o){return _i(this,void 0,void 0,(function*(){const r=ae(t),i=t.useRouteName?o.attributes[r.routeNameFieldName]:"",a=o.attributes[r.routeIdFieldName],s=o.attributes[r.fromDateFieldName],l=o.attributes[r.toDateFieldName],u=o.geometry,c=ie(u),d=o.attributes[r.lineIdFieldName],f=o.attributes[r.lineNameFieldName];let m=new Date(Date.now());re(l)&&m>l?m=Fe(s,n):m.setHours(0,0,0,0);let p=new Date(Date.now());return re(l)&&p>l?p=Fe(l,n):p.setHours(0,0,0,0),re(l)||(p=null),yield He(n,t,c,s,a).then((o=>_i(this,void 0,void 0,(function*(){const r=Math.min(...o),c=Math.max(...o);return Object.assign(Object.assign({},e),{routeName:i,routeId:a,fromDate:re(s)?Fe(s,n):null,toDate:re(l)?Fe(l,n):null,selectedPolyline:u,fromMeasure:q(r,t.measurePrecision),toMeasure:q(c,t.measurePrecision),validRoute:!0,selectedFromDate:m,selectedToDate:p,lineName:f,lineId:d})}))))}))}!function(e){e.network="NETWORK",e.event="EVENT",e.intersection="INTERSECTION",e.nonLrs="NONLRS"}(Ci||(Ci={})),function(e){e.Measure="ROUTEANDMEASURE",e.Coordinate="COORDINATE",e.LocationOffset="LOCATIONOFFSET",e.Referent="REFERENT",e.LineAndMeasure="LINEANDMEASURE"}(Vi||(Vi={}));var $i=function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function a(e){try{l(o.next(e))}catch(e){i(e)}}function s(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}l((o=o.apply(e,t||[])).next())}))};function Gi(e){var t,o,r,i,a;let s=[];if(!e)return s;const l=(null===(t=null===window||void 0===window?void 0:window.jimuConfig)||void 0===t?void 0:t.isBuilder)?null===(r=null===(o=(0,n.getAppStore)().getState())||void 0===o?void 0:o.appStateInBuilder)||void 0===r?void 0:r.appConfig:null===(i=(0,n.getAppStore)().getState())||void 0===i?void 0:i.appConfig;if(!l)return s;const u=null===(a=l.widgets[e])||void 0===a?void 0:a.useDataSources;if(void 0!==u){u.map((e=>e.dataSourceId)).forEach((e=>{const t=n.DataSourceManager.getInstance().getDataSource(e),o=null==t?void 0:t.getDataSourcesByType(n.DataSourceTypes.FeatureLayer);o&&(s=s.concat(o))}))}return s}function qi(e){let t=e;return t.includes("FeatureServer")&&(t=t.substring(0,t.indexOf("FeatureServer"))),t.includes("MapServer")&&(t=t.substring(0,t.indexOf("MapServer"))),t+"MapServer/exts/LRServer"}function Bi(e){const t=Gi(e),n=[];return t.forEach((e=>{var t;const o=qi(null===(t=null==e?void 0:e.getDataSourceJson())||void 0===t?void 0:t.url);n.includes(o)||n.push(o)})),n}function zi(e,t,n){const o={},r=(null==n?void 0:n.fields)?Object.values(null==n?void 0:n.fields):[];o.networkUrl=t,o.datasetName=e.datasetName;const i=e.routeIdFieldName;o.routeIdFieldSchema=r.find((e=>i===e.name));const a=e.routeNameFieldName;o.routeNameFieldSchema=r.find((e=>a===e.name));const s=e.fromDateFieldName;o.fromDateFieldSchema=r.find((e=>s===e.name));const l=e.toDateFieldName;if(o.toDateFieldSchema=r.find((e=>l===e.name)),o.supportsLines=e.supportsLines,o.supportsLines){const t=null==e?void 0:e.lineIdFieldName;o.lineIdFieldSchema=r.find((e=>t===e.name));const n=null==e?void 0:e.lineNameFieldName;o.lineNameFieldSchema=r.find((e=>n===e.name));const i=null==e?void 0:e.lineOrderFieldName;o.lineOrderFieldSchema=r.find((e=>i===e.name))}o.useRouteName=e.supportsLines,re(a)&&i.length&&(o.useRouteName=!0),o.measurePrecision=e.measurePrecision,o.unitsOfMeasure=e.unitsOfMeasure,o.mTolerance=e.spatialReferenceInfo.mTolerance,o.xyTolerance=e.spatialReferenceInfo.xyTolerance,o.lrsNetworkId=e.lrsNetworkId;const u=[],c=e.eventLayers;c&&c.length>0&&c.forEach((e=>{u.push(e.name)})),o.eventLayers=u;const d=[],f=e.intersectionLayers;return f&&f.length>0&&f.forEach((e=>{d.push(e.name)})),o.intersectionLayers=d,o}function Wi(e,t,n,o){const r={},i=(null==n?void 0:n.fields)?Object.values(null==n?void 0:n.fields):[];r.datasetName=e.datasetName,r.eventUrl=t,r.fromDateFieldName=e.fromDateFieldName,r.toDateFieldName=e.toDateFieldName,r.derivedFromMeasureFieldName=e.derivedFromMeasureFieldName,r.derivedRouteIdFieldName=e.derivedRouteIdFieldName,r.derivedRouteNameFieldName=e.derivedRouteNameFieldName,r.derivedToMeasureFieldName=e.derivedToMeasureFieldName,r.fromReferentLocationFieldName=e.fromReferentLocationFieldName,r.fromReferentMethodFieldName=e.fromReferentMethodFieldName,r.fromReferentOffsetFieldName=e.fromReferentOffsetFieldName,r.toReferentLocationFieldName=e.toReferentLocationFieldName,r.toReferentMethodFieldName=e.toReferentMethodFieldName,r.toReferentOffsetFieldName=e.toReferentOffsetFieldName,r.locErrorFieldName=e.locErrorFieldName,r.eventIdFieldName=e.eventIdFieldName,r.routeIdFieldName=e.routeIdFieldName,r.routeNameFieldName=e.routeNameFieldName,r.fromMeasureFieldName=e.fromMeasureFieldName,r.toRouteIdFieldName=e.toRouteIdFieldName,r.toRouteNameFieldName=e.toRouteNameFieldName,r.toMeasureFieldName=e.toMeasureFieldName;const a=e.type;r.isPointEvent="esriLRSPointEventLayer"===a;const s=[r.fromDateFieldName,r.toDateFieldName,r.derivedFromMeasureFieldName,r.derivedRouteIdFieldName,r.derivedRouteNameFieldName,r.derivedToMeasureFieldName,r.fromReferentLocationFieldName,r.fromReferentMethodFieldName,r.fromReferentOffsetFieldName,r.toReferentLocationFieldName,r.toReferentMethodFieldName,r.toReferentOffsetFieldName,r.locErrorFieldName,r.eventIdFieldName,r.routeIdFieldName,r.routeNameFieldName,r.fromMeasureFieldName,r.toRouteIdFieldName,r.toRouteNameFieldName,r.toMeasureFieldName],l=null==o?void 0:o.objectIdField,u=null==o?void 0:o.globalIdField,c=null==o?void 0:o.editFieldsInfo,d=[l,u];c&&(d.push(c.creationDateField),d.push(c.creatorField),d.push(c.editDateField),d.push(c.editorField));const f=s.map((e=>re(e)?e.toLowerCase():e)),m=d.map((e=>re(e)?e.toLowerCase():e));r.lrsFields=i.filter((e=>f.includes(e.name.toLowerCase())));const p=i.filter((e=>!f.includes(e.name.toLowerCase())&&!m.includes(e.name.toLowerCase()))),h=[];return p.forEach((e=>{const t={field:e,enabled:!0,editable:!0,description:""};h.push(t)})),r.attributeFields=h,r.parentNetworkId=e.lrsNetworkId,r}function Hi(e,t){return $i(this,void 0,void 0,(function*(){const o=e+"/attributeSets";let r=null;const i=n.SessionManager.getInstance().getSessionByUrl(t),a=i&&i.token?i.token:"";r=a?{f:"json",token:a}:{f:"json"};const s={attributeSet:[]};return yield Ge({method:"GET",url:o,params:r}).then((e=>{const t=e.attributeSets;return re(t)&&t.forEach((e=>{const t={title:e.title,isDefault:e.isDefault,isPoint:e.isPoint,defaultSettings:e.defaultSettings,layers:e.layers};s.attributeSet.push(t)})),s})).catch((e=>null))}))}function Qi(e,t){if(!re(t))return!1;const n=t.at(e);return!re(n)||!re(n.eventInfo)||n.layerType!==Ci.event||t.findIndex((e=>re(e.networkInfo)&&e.networkInfo.lrsNetworkId===n.eventInfo.parentNetworkId))>-1}(0,t.registerStyles)("widgets/shared-code/lrs/ui",e)})(),d})())}}}));
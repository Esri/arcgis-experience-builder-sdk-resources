System.register(["jimu-core","jimu-arcgis","jimu-ui","jimu-layouts/layout-runtime","jimu-theme"],(function(e,t){var i={},s={},o={},a={},n={};return{setters:[function(e){i.AppMode=e.AppMode,i.BaseVersionManager=e.BaseVersionManager,i.DataSourceComponent=e.DataSourceComponent,i.DataSourceManager=e.DataSourceManager,i.DataSourceSelectionMode=e.DataSourceSelectionMode,i.DataSourceTypes=e.DataSourceTypes,i.ErrorBoundary=e.ErrorBoundary,i.ExBAddedJSAPIProperties=e.ExBAddedJSAPIProperties,i.ExtentChangeMessage=e.ExtentChangeMessage,i.Immutable=e.Immutable,i.JSAPILayerTypes=e.JSAPILayerTypes,i.LocationChangeMessage=e.LocationChangeMessage,i.MessageManager=e.MessageManager,i.MessageType=e.MessageType,i.MutableStoreManager=e.MutableStoreManager,i.React=e.React,i.ReactDOM=e.ReactDOM,i.ReactRedux=e.ReactRedux,i.ReactResizeDetector=e.ReactResizeDetector,i.ServiceManager=e.ServiceManager,i.SessionManager=e.SessionManager,i.TimezoneConfig=e.TimezoneConfig,i.UrlManager=e.UrlManager,i.appActions=e.appActions,i.classNames=e.classNames,i.css=e.css,i.dataSourceUtils=e.dataSourceUtils,i.esri=e.esri,i.focusElementInKeyboardMode=e.focusElementInKeyboardMode,i.geometryUtils=e.geometryUtils,i.getAppStore=e.getAppStore,i.jsx=e.jsx,i.lodash=e.lodash,i.observeStore=e.observeStore,i.polished=e.polished,i.portalUrlUtils=e.portalUrlUtils,i.serviceUrlUtils=e.serviceUrlUtils},function(e){s.ActionType=e.ActionType,s.DataChangeStatus=e.DataChangeStatus,s.DataChangeType=e.DataChangeType,s.JimuMapViewComponent=e.JimuMapViewComponent,s.MapViewManager=e.MapViewManager,s.basemapUtils=e.basemapUtils,s.loadArcGISJSAPIModules=e.loadArcGISJSAPIModules,s.portalUtils=e.portalUtils,s.zoomToUtils=e.zoomToUtils},function(e){o.Button=e.Button,o.DataActionList=e.DataActionList,o.DataActionListStyle=e.DataActionListStyle,o.Dropdown=e.Dropdown,o.DropdownButton=e.DropdownButton,o.DropdownItem=e.DropdownItem,o.DropdownMenu=e.DropdownMenu,o.Icon=e.Icon,o.ImageWithParam=e.ImageWithParam,o.Loading=e.Loading,o.LoadingType=e.LoadingType,o.MobilePanel=e.MobilePanel,o.MobilePanelManager=e.MobilePanelManager,o.Nav=e.Nav,o.NavItem=e.NavItem,o.NavLink=e.NavLink,o.Popper=e.Popper,o.Progress=e.Progress,o.Radio=e.Radio,o.SVG=e.SVG,o.defaultMessages=e.defaultMessages},function(e){a.LayoutEntry=e.LayoutEntry,a.PageVisibilityContext=e.PageVisibilityContext,a.ViewVisibilityContext=e.ViewVisibilityContext,a.ViewportVisibilityContext=e.ViewportVisibilityContext},function(e){n.Global=e.Global}],execute:function(){e((()=>{var e={82009:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M.1 6.9h6.8V.1H.1zm6-.8H3.985c.077-.403.25-.78.506-1.102a4.6 4.6 0 0 0 1.609.805zm0-1.128a3.8 3.8 0 0 1-1.006-.523c.31-.203.65-.358 1.006-.459zM6.1.9v2.266a4.2 4.2 0 0 0-1.613.73 6 6 0 0 1-1.1-1.767l.002-.004-.004-.001A8 8 0 0 1 2.99.9zM.9.9h1.266a9 9 0 0 0 .359 1.249A1.93 1.93 0 0 1 .9 3.188zm0 3.09a2.83 2.83 0 0 0 2.006-.966c.262.519.594 1 .987 1.428A3.37 3.37 0 0 0 3.17 6.1H.9zM9.1.1v6.8h6.8V.1zm.8.8h4.063a.37.37 0 0 1-.045.2.6.6 0 0 1-.438.176 1.64 1.64 0 0 0-1.175.49.9.9 0 0 0-.203.708c-.001.007-.114.736-.607.742a.74.74 0 0 0-.719.384.83.83 0 0 0-.026.6H9.9zm5.2 5.2H9.9V5h2.296l-.474-.639a1.6 1.6 0 0 1-.192-.346c1.041-.03 1.37-1.188 1.365-1.587a.2.2 0 0 1 .028-.154c.031-.037.166-.162.624-.2.419 0 .81-.205 1.049-.549a1.13 1.13 0 0 0 .16-.625h.344zm-15 9.8h6.8V9.1H.1zm.8-6h5.2v.46l-2 1.973v.867l-3.2-.089zm0 4.01 4 .112v-1.355l1.2-1.182V15.1H.9zm8.2 1.99h6.8V9.1H9.1zm6-.8h-1.792l-1.27-1.572 1.468-1.468 1.594 1.605zm0-5.2v2.628L12.49 9.9zm-5.2 0h1.46l1.581 1.592-1.978 1.98 1.316 1.628H9.9z"></path></svg>'},60670:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 14 14"><g fill="none" fill-rule="nonzero"><path fill="#000" d="m7.745 7 4.1 4.1a.527.527 0 0 1-.745.746L7 7.746l-4.1 4.1a.527.527 0 0 1-.746-.746l4.1-4.1-4.1-4.1a.527.527 0 0 1 .746-.746l4.1 4.1 4.1-4.1a.527.527 0 0 1 .746.746z"></path><path d="M1 1h12v12H1z"></path></g></svg>'},47717:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 39 32"><path d="M38.784 9.778v2.962H3.236V9.778h.074L13.086.002l2.111 2.111-7.702 7.665zM3.236 21.628h31.327l-7.702 7.702 2.111 2.111 9.776-9.813h.037v-2.962H3.237v2.962z"></path></svg>'},69881:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M5 11v5H4v-4.001L0 12v-1zm11 0v1l-4-.001V16h-1v-5zM5 0v5H0V4l4 .001V0zm7 0v4.001L16 4v1h-5V0z"></path></svg>'},49798:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M1 11v4.001L5 15v1H0v-5zm15 0v5h-5v-1l4 .001V11zM5 0v1L1 .999V5H0V0zm11 0v5h-1V.999L11 1V0z"></path></svg>'},32945:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="m14.376 10.573 1.647.927-8 4.5-8-4.5 1.648-.927 1.02.574-.628.353 5.96 3.353 5.96-3.353-.627-.353zm-.999-2.414.606.341-5.96 3.353L2.063 8.5l.607-.341-1.02-.574L.023 8.5l8 4.5 8-4.5-1.626-.915zM8.023 1.023l-8 4.5 8 4.5 8-4.5zm-5.96 4.5 5.96-3.352 5.96 3.352-5.96 3.353z"></path></svg>'},60308:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 16"><g fill="#000" fill-rule="nonzero"><path d="M4 8h1v3H4zM2 9h1v2H2zm6-1h1v3H8zm4 0h1v3h-1z"></path><path d="M15 12V6h-2V5h1V2h-3v1L4 1.05V0H1v3h1v3H0v6h2v1H1v3h3v-1h7v1h3v-3h-1v-1zm-3-9h1v1h-1zm-8-.92L11 4v1h1v1H3V3h1zM2 1h1v1H2zm1 14H2v-1h1zm8-1H4v-1H3v-1h9v1h-1zm2 1h-1v-1h1zM1 11V7h13v4z"></path><path d="M6 9h1v2H6zm4 0h1v2h-1z"></path></g></svg>'},19086:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15 10"><path fill="#000" fill-rule="nonzero" d="M0 10h15V4H0zm1-5h13v4h-1V6h-1v3h-1V7h-1v2H9V6H8v3H7V7H6v2H5V6H4v3H3V7H2v2H1zm11-5v1H3V0H0v3h3V2h9v1h3V0zM2 2H1V1h1zm12 0h-1V1h1z"></path></svg>'},9206:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M0 9v6h16V9zm15 3h-1v2h-1v-3h-1v3h-1v-2h-1v2H9v-3H8v3H7v-2H6v2H5v-3H4v3H3v-2H2v2H1v-4h14zm.18-7.5-2.85 2.85-.71-.7L13.23 5H9V4h4.32l-1.7-1.69.71-.7zM2.68 4H7v1H2.77l1.61 1.65-.71.7L.82 4.5l2.85-2.85.71.7z"></path></svg>'},3737:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#181818" fill-rule="evenodd" d="M13.43 3H5.298L7.95 5.652 3 10.602 5.83 13.43l4.95-4.95 2.65 2.652zm-7.601 9.016L4.414 10.6l4.95-4.95L7.712 4h4.718v4.718l-1.652-1.652z" clip-rule="evenodd"></path></svg>'},56113:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#181818" fill-rule="evenodd" d="M13.43 13.43V5.298L10.778 7.95 5.828 3 3 5.828l4.95 4.95-2.652 2.652zM4.414 5.828l1.414-1.414 4.95 4.95 1.652-1.652v4.718H7.712l1.652-1.652z" clip-rule="evenodd"></path></svg>'},15181:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#181818" fill-rule="evenodd" d="M3 3v8.132L5.652 8.48l4.95 4.95L13.43 10.6l-4.95-4.95L11.132 3zm9.016 7.601L10.6 12.015l-4.95-4.95L4 8.719V4h4.718L7.066 5.652z" clip-rule="evenodd"></path></svg>'},71525:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#181818" fill-rule="evenodd" d="M3 13.43h8.132L8.48 10.778l4.95-4.95L10.6 3l-4.95 4.95L3 5.298zm7.601-9.016 1.415 1.414-4.95 4.95 1.652 1.652H4V7.712l1.652 1.652z" clip-rule="evenodd"></path></svg>'},98018:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#000" fill-rule="nonzero" d="M7 1a6 6 0 1 0 0 12A6 6 0 0 0 7 1m0 13a7 7 0 1 1 5.621-2.828l-.222.284 3.405 3.404a.668.668 0 0 1-.944.944L11.456 12.4A6.97 6.97 0 0 1 7 14"></path></svg>'},88721:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g fill="#363636" fill-rule="nonzero"><path d="m.25 3 8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z"></path><path d="M10.318 0C13.456 0 16 2.462 16 5.5S13.456 11 10.318 11a5.8 5.8 0 0 1-3.023-.842l-.22-.142.54-.752c.788.53 1.722.82 2.703.82 2.615 0 4.735-2.053 4.735-4.584S12.933.917 10.318.917c-1.916 0-3.617 1.112-4.354 2.779l-.078.187L5 3.56C5.827 1.435 7.933 0 10.318 0"></path></g></svg>'},50045:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 17 16"><g fill="#363636" fill-rule="nonzero"><path d="m.75 3 8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48z"></path><path d="M8.721 0c1.82 0 2.865 1.556 2.865 4.35 0 .462.12.66.385.774.219.093.473.126.99.131h.551l.397.009c1.251.05 1.807.336 2.04 1.333.41 1.76-1.62 3.114-5.904 4.313l-.326.09-.245-.999.64-.18c3.516-1.02 5.088-2.089 4.88-2.979-.094-.407-.382-.535-1.304-.553l-.787-.002c-.62-.008-.943-.055-1.3-.207-.648-.276-.998-.859-.998-1.73 0-2.286-.694-3.318-1.884-3.318-.731 0-1.68.55-2.815 1.685l-.215.22L5 2.203C6.398.748 7.626 0 8.721 0"></path></g></svg>'},22459:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g fill="#363636" fill-rule="nonzero"><path d="m.25 3 8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48zM9.72 1.11l.588-.808 5.082 3.7-4.577 2.656L14.61 9.49l-.598.801L9 6.555l4.56-2.649z"></path></g></svg>'},20561:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#363636" fill-rule="nonzero" d="m.25 3 8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48zM12 6a2 2 0 1 0 0-4 2 2 0 0 0 0 4"></path></svg>'},10272:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path fill="#363636" fill-rule="nonzero" d="m.25 3 8.642 4.969-3.422.738 2.723 5.45-2.886 1.667-2.724-5.45-2.351 2.595zm.996 1.726-.01 5.644 1.527-1.684 2.909 5.771 1.155-.667-2.91-5.77 2.222-.48zM16 0v11H8.5v-1H15V1H6v2.5H5V0z"></path></svg>'},37175:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M0 10.5V12a1 1 0 0 0 1 1h1.5v-1H1v-1.5zM2.5 1H1a1 1 0 0 0-1 1v1.5h1V2h1.5zM0 8.5h1v-3H0zM4.5 1v1h3V1zm5 0v1H11v1.5h1V2a1 1 0 0 0-1-1zM6.318 13.682a4.5 4.5 0 0 0 5.991.334l1.848 1.848.707-.707-1.847-1.848a4.5 4.5 0 1 0-6.699.373m.707-.707a3.5 3.5 0 1 1 4.95-4.95 3.5 3.5 0 0 1-4.95 4.95M9 13v-2H7v-1h2V8h1v2h2v1h-2v2z" clip-rule="evenodd"></path></svg>'},53089:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#050505" d="m12.687 9.074.073-.133a.15.15 0 0 0 .017-.078l-.012-.142c-.002-.033-.042-.051-.068-.028l-.205.175a.1.1 0 0 1-.019.01l-.092.017a.04.04 0 0 0-.033.051l.019.077a.14.14 0 0 0 .093.097l.07.02a.134.134 0 0 0 .157-.066M13.8 9.389a.13.13 0 0 0 .058-.014l.141-.069q.002 0 .003.002l.104.13q.008.01.023.01h.069a.028.028 0 0 0 .023-.046l-.108-.141-.047-.04-.382-.191-.092.036h-.07v-.001l-.026-.084a.027.027 0 0 0-.025-.019h-.093a.027.027 0 0 0-.027.028v.082h.06v.024c0 .03.023.055.052.06l.136.016h.001l.074.093c.023.028.019.097-.006.125v.001h.131zM13.878 6.775l-.048.043a.3.3 0 0 0-.094.187.3.3 0 0 1-.082.178.5.5 0 0 1-.246.136l-.018.004-.076.062s-.022.11 0 .135c.009.012.049.01.061 0 .016-.012.017-.08.017-.08l.242-.087s.06.08.09.083c.012.002.042-.013.05-.025.032-.045.068-.208.068-.208a.6.6 0 0 0 .024-.113l.013-.143.108-.007.043-.087-.112-.011zM9.427 10.12a.141.141 0 0 0 .245 0v-.334a.122.122 0 0 0-.187-.105.13.13 0 0 0-.058.105zM6.698 4.315l.144-.084.002-.006a.065.065 0 0 0-.026-.085.1.1 0 0 0-.031-.008h-.328l-.035-.038a.22.22 0 0 0-.157-.074L5.778 4l-.048.009-.048.009-.289.122a.2.2 0 0 1-.076.018l-.464.023a.2.2 0 0 0-.099.028l-.26.148a.03.03 0 0 0-.015.024.03.03 0 0 0 .012.026c.02.015.014.047-.01.053l-.203.051a.03.03 0 0 0-.019.044l.068.112a.03.03 0 0 0 .02.014l.364.063c.056.01.106.04.14.086l.251.333.074.102a.094.094 0 0 1-.007.118l-.056.06a.09.09 0 0 0-.015.105l.183.37a.13.13 0 0 0 .081.068.223.223 0 0 0 .274-.142l.048-.137a.1.1 0 0 1 .04-.05l.204-.175a.24.24 0 0 1 .085-.046l.32-.088a.22.22 0 0 0 .148-.133l.151-.378a.23.23 0 0 0-.001-.172l-.03-.07a.23.23 0 0 1 .097-.28M4.03 4.643l.061-.11a.2.2 0 0 1 .088-.087l.504-.282-.057-.066-.572-.035a.2.2 0 0 0-.05.003l-.557.09a.232.232 0 0 0-.137.377l.125.148c.043.051.107.08.172.08h.224a.23.23 0 0 0 .199-.118M4.666 5.672l.052-.061c.013-.016.01-.04-.007-.051l-.162-.116-.569-.425a.14.14 0 0 0-.081-.027h-.224a.13.13 0 0 0-.095.04l-.118.115a.034.034 0 0 0-.003.047l.067.085q.01.015.03.014l.064-.006a.035.035 0 0 1 .038.033l.002.038q0 .007-.002.016l-.03.073a.04.04 0 0 0 .006.036l.07.084a.03.03 0 0 0 .028.012l.068-.003a.035.035 0 0 0 .034-.035v-.147c0-.019.014-.034.032-.035l.094-.007q.014 0 .024.007l.174.133c.013.011.017.029.01.044l-.057.116a.03.03 0 0 1-.03.018l-.054.004a.04.04 0 0 0-.032.027.036.036 0 0 0 .032.044l.117.009q.037.002.069.024l.206.146q.022.014.043-.003l.065-.055a.03.03 0 0 0 .011-.018l.021-.083a.04.04 0 0 0-.004-.029l-.07-.11.022-.004a.04.04 0 0 1 .024.004l.091.054a.035.035 0 0 0 .044-.008M2.08 5.137h.07l.104.146q.02.027.05.044l.136.068q.028.015.061.015h.422V5.27l-.156-.056-.18-.097A.14.14 0 0 1 2.52 5.1l-.288-.166a.13.13 0 0 0-.067-.018h-.173a.14.14 0 0 0-.13.095l-.014.047a.14.14 0 0 0 .033.14l.061.062h.138zM2.679 5.022l.11-.058a.14.14 0 0 1 .063-.015h.06c.052 0 .1.03.123.078l.044.092v.094h-.2v-.12l-.084-.043-.1.003zM3.061 4.95l.1.164.08.047h.115l.116-.124-.088-.116-.225.028zM2.414 4.698l.158.057a.1.1 0 0 1 .03.015l.109.073q.027.019.06.021l.2.02-.024-.124-.238-.132a.14.14 0 0 0-.065-.017h-.122zM7.46 5.712l.058.092a.03.03 0 0 1-.001.028l-.044.06q-.007.013-.004.022l.017.061a.02.02 0 0 0 .008.012l.092.072c.063.048.07.141.017.2l-.001.002a.14.14 0 0 1-.101.046h-.11a.025.025 0 0 1-.024-.031l.028-.11a.02.02 0 0 1 .014-.017l.049-.024q.015-.008.013-.026l-.002-.03a.03.03 0 0 0-.02-.021l-.071-.015a.024.024 0 0 0-.027.014l-.016.035v.002l-.001.002-.035.118q-.006.017-.024.018l-.11-.003a.02.02 0 0 1-.018-.007.02.02 0 0 1-.007-.017v-.127c0-.013.011-.024.024-.024l.058-.002q.012 0 .02-.01l.053-.079A.03.03 0 0 0 7.3 5.94V5.82q0-.012.01-.019l.115-.094a.024.024 0 0 1 .037.005"></path><path fill="#050505" fill-rule="evenodd" d="M15.073 5.1H14.7a.04.04 0 0 1-.04-.03l-.358-.069a.16.16 0 0 1-.088-.027l-.081-.055a.16.16 0 0 0-.088-.027s-.832-.43-1.922-.388c-.41.016-.77.222-.77.222a.03.03 0 0 0-.02.026l-.004.034a.033.033 0 0 1-.033.028l-.164-.004a.033.033 0 0 0-.034.032l-.459.016c-.04 0-.077.02-.1.053l-.041.06c-.03.045-.441.06-.441.06a.06.06 0 0 1-.036-.055v-.049q0-.026.02-.044l.218-.2a.16.16 0 0 1 .087-.04l.136-.018a.06.06 0 0 0 .04-.024l.016-.024a.06.06 0 0 0-.028-.09l-.01-.005a.06.06 0 0 0-.047.004l-.104.061a.1.1 0 0 1-.03.008h-.101a.16.16 0 0 0-.114.049l-.244.252a.17.17 0 0 0-.042.08l-.023.11.016.047-.096.135-.087.087h-.081v-.087H9.45l-.028.11a.16.16 0 0 1-.098.11l-.081.032a.16.16 0 0 1-.156-.026l-.106-.086.284.015.032-.062S9 5.18 8.828 5.084c-.14-.08-.324-.013-.388.016a.2.2 0 0 0-.042.027l-.62.565a.16.16 0 0 0-.006.231l.058.061.083-.069a.06.06 0 0 1 .076.003l.155.146h.04l.146-.176a.06.06 0 0 0 .002-.072l-.019-.026a.06.06 0 0 1-.004-.066l.204-.334a.04.04 0 0 1 .052-.017l.036.018c.022.01.03.035.019.057l-.14.268a.13.13 0 0 0-.01.104l.023.071a.18.18 0 0 1-.03.146l-.087.12a.16.16 0 0 1-.134.064l-.254-.01a.05.05 0 0 1-.031-.013.05.05 0 0 1-.013-.032v-.042a.045.045 0 0 0-.046-.046.046.046 0 0 0-.045.042l-.007.074a.046.046 0 0 1-.045.042h-.024a.04.04 0 0 0-.03.012l-.414.386.06.088v.093a.057.057 0 0 1-.056.056h-.132c-.071 0-.127.06-.123.132l.001.018a.124.124 0 0 0 .119.116l.141.004a.16.16 0 0 0 .135-.068l.101-.144a.16.16 0 0 1 .13-.067h.097q.05 0 .09.028l.157.11c.03.022.033.068.004.092l-.088.077a.16.16 0 0 1-.104.04h-.55a.16.16 0 0 0-.126.064l-.425.573a.17.17 0 0 0-.032.096v.38q0 .054.032.097l.148.198q.018.025.027.055c.01.033.036.08.1.08h.686s.172.005.172.12q0 .061-.003.116a.16.16 0 0 0 .083.148c.048.028.099.077.099.155v.21a.2.2 0 0 1-.007.049.8.8 0 0 1-.079.178c-.036.054.015.135.052.182a.17.17 0 0 1 .035.102v.21s.016.076.088.109a.6.6 0 0 1 .097.05v.084c0 .09.071.16.16.16h.207s.094.008.155-.087l.28-.437s.04-.043 0-.12c-.04-.076-.021-.145-.021-.145l.19-.11s.09-.016.09-.141v-.136a.1.1 0 0 0-.018-.062l-.033-.057a.16.16 0 0 1 .021-.191l.395-.424s.104-.156.104-.235H9.49a.16.16 0 0 1-.136-.077l-.346-.576a.087.087 0 0 1 .033-.121.084.084 0 0 1 .112.03l.335.552-.001.05c0 .016.012.028.028.028.083 0 .327-.01.463-.13a.6.6 0 0 0 .143-.181.16.16 0 0 0-.038-.19l-.085-.076-.11.025-.197-.199a.063.063 0 0 1 .016-.1.06.06 0 0 1 .065.007l.307.238s.063.056.127.056h.18c.056 0 .108.03.136.078l.402.683s.06.056.094.054c.035-.003.082-.15.082-.15 0-.136.065-.266.176-.344l.138-.098a.16.16 0 0 1 .202.015l.085.083v.09c0 .014.012.027.028.027h.038l.036-.036h.042v.359c0 .04.015.08.043.109l.267.288v-.103a.16.16 0 0 0-.035-.1l-.125-.158a.16.16 0 0 1-.035-.1v-.109c0-.017.021-.026.033-.013l.162.167.004.105c.001.02.025.03.038.015l.229-.25s.066-.083 0-.152a5 5 0 0 0-.158-.154.05.05 0 0 1-.016-.039.05.05 0 0 1 .019-.038l.044-.037.11.002s-.023.052-.058.112c0 0 .017.096.123-.083.008-.007.036-.003.067.002.04.006.084.014.1-.002.06-.064.309-.407.309-.407s.032-.126-.043-.192c-.076-.066-.043-.147-.043-.147l.094-.082v-.058h-.244s.02-.13.194-.139l.031-.001q.016 0 .03-.002a.13.13 0 0 1 .127.083q.01.024.01.052v.243l.036.004s.068.007.093-.084c0 0 .046-.013.046-.068v-.066l-.066-.08.107-.138a.12.12 0 0 1 .075-.045l.054-.011a.13.13 0 0 0 .08-.053l.247-.373a.17.17 0 0 0 .027-.09v-.102a.05.05 0 0 0-.05-.05h-.144s-.06-.07.022-.12c.057-.035.169-.128.232-.18a.16.16 0 0 1 .101-.038h.29a.16.16 0 0 0 .093-.03l.19-.137a.04.04 0 0 1 .025-.008c.082 0 .125.1.07.162l-.198.214a.16.16 0 0 0-.043.106l-.003.173c0 .032.026.06.059.06h.048l.259-.268a.13.13 0 0 0 .033-.066l.01-.056a.16.16 0 0 1 .155-.134h.114a.15.15 0 0 0 .104-.039l.159-.14a.04.04 0 0 1 .028-.01h.082a.042.042 0 0 0 .043-.044v-.08q0-.02.013-.032l.062-.058a.16.16 0 0 1 .181-.024l.104.055a.06.06 0 0 0 .076-.016l.051-.065a.06.06 0 0 0 .012-.052.06.06 0 0 0-.033-.042l-.503-.25a5 5 0 0 0-.39-.014M8.141 7.024l.09-.078zl-.133-.163a.1.1 0 0 1-.01-.019.1.1 0 0 0 .01.018zm.755.493h-.081a.1.1 0 0 1-.032-.004 9 9 0 0 1-.61-.186.06.06 0 0 1-.035-.045.06.06 0 0 1 .015-.055l.11-.117a.094.094 0 0 1 .13.005l.1.107.087-.016-.024-.064s-.01-.03-.021-.056.048-.061.048-.061.06-.006.06.088c0 .093.097.163.097.163h.332c.021 0 .035.023.024.04l-.059.113a.16.16 0 0 1-.141.088m.417-.503H9.2l-.083-.065a.06.06 0 0 0-.032-.01h-.108a.07.07 0 0 0-.044.017l-.078.07-.078.012a.05.05 0 0 1-.056-.026.1.1 0 0 1-.006-.02l-.011-.087a.1.1 0 0 1 .021-.069l.128-.145.058-.005-.003.026a.05.05 0 0 0 .05.058h.029a.07.07 0 0 0 .064-.042l.026-.058.12.02.01.087a.08.08 0 0 0 .026.048l.133.112v.025c0 .03-.023.052-.053.052m.574.093v.099h-.205l-.018-.099a.05.05 0 0 1 .008-.039l.011-.015a.05.05 0 0 0-.008-.069l-.096-.089v-.163l.14-.06h.072c.028 0 .052.019.06.046l.001.004q.008.031-.013.056a.1.1 0 0 0-.015.031l-.013.085.113.105-.08.054z" clip-rule="evenodd"></path><path fill="#050505" d="M12.945 7.8q-.008-.022-.017-.021t-.036.025a.11.11 0 0 0-.039.08q0 .03.012.062c.007.018.02.032.028.032.025 0 .066-.14.052-.178M12.894 8.108l.024.005.014.004q.026.008.033.015.006.007.013.03l.004.014c.008.027.002.053-.018.07-.046.037-.038.057.03.072.047.01.061.024.061.062 0 .046-.003.046-.055.019-.03-.016-.06-.023-.065-.016q-.009.012.014.021c.055.02.086.071.074.12-.014.057.014.066.059.02.048-.049.089.023.078.136-.004.038-.038.055-.09.043a.1.1 0 0 1-.022-.012.04.04 0 0 1-.013-.027c0-.024-.013-.029-.051-.02s-.05.006-.05-.018a.05.05 0 0 1 .03-.044q.02-.006.02-.017 0-.01-.02-.038a.2.2 0 0 1-.03-.08c0-.02-.008-.037-.019-.037-.027 0-.088-.193-.063-.201q.007-.004.012-.016a.2.2 0 0 0 .009-.053c0-.04.003-.054.021-.052M12.8 8.567c.047-.044.072-.116.04-.116-.014 0-.082.079-.11.129-.03.052.009.045.07-.013M12.912 8.698a.02.02 0 0 1 .021.02q0 .018-.008.02s-.005 0-.007-.003a.1.1 0 0 1-.015-.017q-.01-.018.01-.02M13.254 8.913q-.021-.045-.044-.043t-.03.05a.1.1 0 0 1-.01.026c.013.052.052.06.064.063h.004l.025-.029.014-.015zM13.082 8.894c.026-.004.035.015.011.043l-.008.015-.057.01-.036.005c-.038.006-.077.011-.1.037q0 .006.01.009t.032-.001l.006-.003.005-.003.02-.002.064.008-.004.006h-.002l-.005.004-.013.008c-.03.026-.044.054-.034.067.008.012.015.04.015.062-.002.053-.066.067-.079.017q-.009-.035-.012.021c-.001.044-.011.057-.038.051-.02-.004-.035-.025-.035-.047a.14.14 0 0 0-.016-.065c-.008-.013-.006-.048.006-.078.007-.019.009-.028.01-.036l.002-.006.012-.032.018-.05-.003.001c.028-.026.056-.032.1-.022l.032.004a.15.15 0 0 0 .068-.012q.015-.009.031-.011M13.36 9.136c0-.027-.034-.042-.092-.042a1 1 0 0 0-.064.006c-.08.012-.103.027-.08.051.02.02.236.007.236-.015M5.866 9.362l-.35-.185a.2.2 0 0 0-.102-.026h-.101a.04.04 0 0 1-.037-.033.22.22 0 0 0-.218-.201h-.032a.22.22 0 0 1-.173-.088l-.048-.065a.22.22 0 0 0-.155-.086l-.262-.023a.03.03 0 0 1-.017-.007l-.043-.03q-.019-.012-.038 0l-.187.106a.2.2 0 0 1-.108.028h-.192a.04.04 0 0 1-.017-.004.15.15 0 0 1-.071-.133v-.112a.04.04 0 0 0-.023-.035l-.014-.003h-.122a.04.04 0 0 1-.032-.019.04.04 0 0 1 0-.038l.057-.1a.04.04 0 0 0 .006-.02V8.2q0-.016-.011-.027a.04.04 0 0 0-.027-.011h-.066a.04.04 0 0 0-.03.017l-.038.06a.22.22 0 0 1-.184.1h-.054s-.086-.015-.086-.108v-.339a.1.1 0 0 1 .045-.067c.032-.02.107-.061.144-.081a.04.04 0 0 1 .043.005l.07.066q.01.01.024.01h.015c.022 0 .051 0 .057-.003q.005-.003.003-.014c0-.017 0-.046.045-.06.066-.019.109.04.109.04l.165.199a.04.04 0 0 0 .05.006l.023-.016a.04.04 0 0 0 .012-.05l-.002-.005a.22.22 0 0 1 .048-.28l.137-.118s.016-.01.024-.071c.005-.037.015-.09.021-.128l.021-.036.02-.036.297-.252a.036.036 0 0 1 .055.008c.014.022.038.046.069.045a.8.8 0 0 0 .208-.093.04.04 0 0 0 .019-.033v-.047l-.143.03a.04.04 0 0 1-.044-.031l-.016-.095a.04.04 0 0 0-.036-.03l-.143.015.018-.043a.04.04 0 0 1 .034-.027l.352-.037.056-.023.056-.023.071-.056a.04.04 0 0 0 .004-.055l-.396-.41a.04.04 0 0 0-.043-.008l-.118.057a.04.04 0 0 1-.038-.003L4.1 5.91a.036.036 0 0 0-.05.008l-.051.07a.03.03 0 0 0-.007.02l-.01.174q0 .016.011.029l.048.05a.04.04 0 0 1-.005.056l-.07.051a.04.04 0 0 1-.034.006l-.16.027a.22.22 0 0 0-.133-.13l-.08-.028a.222.222 0 0 1-.098-.35l.156-.19a.04.04 0 0 0 .007-.038l-.044-.115-.008-.012-.176-.19a.122.122 0 0 0-.21.065l-.001.01a.12.12 0 0 1-.12.104H2.54l-.05-.01-.04-.009-.358-.162-.075-.018-.33-.022-.092.015-.148.058a.2.2 0 0 1-.124.01L.591 5.23a.2.2 0 0 0-.132.013l-.346.15a.038.038 0 0 0-.009.063l.09.077c.026.021.011.065-.022.066l-.136.003c-.02 0-.036.017-.036.037v.02c0 .02.016.036.036.037l.117.001c.04.002.051.056.015.072l-.101.046a.04.04 0 0 0-.022.037l.01.103a.22.22 0 0 0 .184.198l.072.012c.034.006.042.051.013.069l-.023.013c-.024.015-.024.05 0 .064l.012.006a.04.04 0 0 0 .035.003l.618-.282a.22.22 0 0 1 .237.04l.588.543a.22.22 0 0 1 .071.152l.02.415a.22.22 0 0 0 .048.128l.579.728c.01.014.03.018.045.01a.04.04 0 0 0 .014-.055s.365.383.4.399l.296.148a.2.2 0 0 0 .097.023h.147q.024 0 .033.021l.05.108V8.7l.001.001.002.003c.015.025.088.143.165.148.087.005.243 0 .243 0s.056-.001.056.06v.095a.04.04 0 0 1-.019.032c-.048.027-.172.107-.172.197v.212q0 .014.008.024c.016.019.05.06.08.084.027.022.072.073.098.103l.013.014a.04.04 0 0 1 .008.024v.122l.001.006.001.007c.007.016.024.057.055.072.019.009.065.047.108.085a.22.22 0 0 1 .076.186l-.027.345-.003.02-.003.02-.119.45-.007.08.012.185a.2.2 0 0 1-.01.095l-.044.126a.24.24 0 0 0-.007.125l.056.233a.12.12 0 0 0 .044.07l.057.045c.022.018.054.042.076.026.077-.054.12-.218.155-.353.015-.06.03-.115.044-.15.01-.023.067-.105.134-.202.11-.156.245-.35.244-.389l-.003-.09c0-.022.016-.038.037-.038h.114q.016 0 .026-.012l.266-.294a.04.04 0 0 0 .01-.026v-.12c0-.021.017-.037.038-.037.045.002.12.002.145-.02.027-.021.097-.103.138-.15l.021-.024a.04.04 0 0 0 .01-.025v-.19c0-.055.02-.108.057-.15l.133-.148a.137.137 0 0 0-.043-.215M14.916 10.7l-.008.001c-.006.005.005.036.024.067.031.051.033.062.016.086-.017.025-.016.03.004.044q.054.035-.022.03c-.038-.004-.049.002-.07.039a.3.3 0 0 1-.078.074c-.071.044-.108.109-.06.109q.02.001.012.026c-.01.032-.006.032.065-.002.041-.02.06-.038.066-.065a.07.07 0 0 1 .041-.048c.018-.006.032-.015.03-.019-.007-.018.033-.082.048-.077.02.006.08-.06.07-.076q-.006-.01.012-.011c.022 0 .043-.048.03-.067-.004-.006-.023-.007-.043-.003q-.035.008-.035-.01c0-.02-.075-.089-.102-.097M12.885 9.274l-.486-.057a.1.1 0 0 1-.035-.01l-.118-.048a.14.14 0 0 1-.048-.032l-.39-.414a.05.05 0 0 0-.042-.015.047.047 0 0 0-.028.078l.41.466a.15.15 0 0 0 .063.04l.232.07a.1.1 0 0 0 .04.005h.397zM13.85 9.535l-.02.057a.255.255 0 0 1-.27.17.05.05 0 0 1-.038-.027.05.05 0 0 1 .001-.047l.1-.186-.26.01a.3.3 0 0 0-.1.023l-.098.046a.3.3 0 0 0-.07.049l-.18.178a.2.2 0 0 1-.075.051l-.123.055a.26.26 0 0 0-.152.236v.02q0 .052.02.1l.096.228q.004.008.005.015a.11.11 0 0 0 .143.077l.245-.088a.25.25 0 0 1 .108-.013l.294.027c.08.006.15.05.193.12l.02.03a.25.25 0 0 0 .218.122h.118a.26.26 0 0 0 .182-.076l.13-.132a.26.26 0 0 0 .075-.183v-.173a.26.26 0 0 0-.082-.19l-.268-.248a.24.24 0 0 1-.06-.082l-.08-.175c-.017-.027-.06-.026-.071.006M13.322 9.25c.017.001.029.014.028.037 0 .015-.029.043-.064.063a.3.3 0 0 1-.068.032c-.016.004-.019-.005-.019-.027 0-.017.006-.031.014-.031.007 0 .03-.02.051-.043q.031-.033.058-.03M13.079 9.272c.16 0 .149.04-.013.048-.095.004-.12 0-.115-.021.005-.018.045-.027.128-.027M6.117 5.52h.09l.067.046.182-.047.033.081v.115l-.175.021a.13.13 0 0 1-.1-.028l-.153-.121zM8.12 4.551h-.23l-.056.04.197.25h.09l.082-.152.202.103.032-.048-.24-.169a.13.13 0 0 0-.076-.024M8.611 4.372h-.298l-.028.046.086.064a.13.13 0 0 0 .08.027h.16l.076-.08zM3.042 4.379l-.197.074-.19.048.273.13.216-.07.072-.013-.057-.109zM3.415 4.78h-.086v.043l.046.017.01.044.071.01.048.055.424-.014.024-.05-.037-.056h-.456zM3.03 4.884l-.033-.096.033-.018.127.01.03.029-.07.082zM3.216 4.725l.016-.054.035-.024.034.013.058.025v.024h-.03l-.046.038z"></path><path fill="#050505" d="m3.844 8.095-.083.037c-.01.005-.01.021 0 .024l.088.037.103-.017.167.115h.119s.081-.01.081-.032-.081-.033-.081-.033l-.172-.13zM4.4 8.272s-.074.045-.065.066c.016.038.16 0 .16 0s.052-.048.043-.066c-.018-.031-.138 0-.138 0M14.162 10.93h-.28l.074.164h.066z"></path></svg>'},43058:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="M.4 8 8 1.92V5.5h7v5H8v3.58zM7 9.5h7v-3H7V4L2 8l5 4z" clip-rule="evenodd"></path></svg>'},78313:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" fill-rule="evenodd" d="m16 8-7.6 6.08V10.5h-7v-5h7V1.92zM9.4 6.5h-7v3h7V12l5-4-5-4z" clip-rule="evenodd"></path></svg>'},4583:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 17"><path fill="#000" fill-rule="evenodd" d="M0 12v-1.5h1V12h1.5v1H1a1 1 0 0 1-1-1M1 1h1.5v1H1v1.5H0V2a1 1 0 0 1 1-1m0 7.5H0v-3h1zM4.5 2V1h3v1zm5 0V1H11a1 1 0 0 1 1 1v1.5h-1V2zm4.813 14.02-3.535-3.535-3.536 3.535-.707-.707 3.536-3.535-3.536-3.536.707-.707 3.536 3.536 3.535-3.536.707.707-3.535 3.536 3.535 3.535z" clip-rule="evenodd"></path></svg>'},9044:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 16 16"><path fill="#000" d="M6 6.5a.5.5 0 0 1 1 0v6a.5.5 0 0 1-1 0zM9.5 6a.5.5 0 0 0-.5.5v6a.5.5 0 0 0 1 0v-6a.5.5 0 0 0-.5-.5"></path><path fill="#000" fill-rule="evenodd" d="M11 0H5a1 1 0 0 0-1 1v2H.5a.5.5 0 0 0 0 1h1.6l.81 11.1a1 1 0 0 0 .995.9h8.19a1 1 0 0 0 .995-.9L13.9 4h1.6a.5.5 0 0 0 0-1H12V1a1 1 0 0 0-1-1m0 3V1H5v2zm1.895 1h-9.79l.8 11h8.19z" clip-rule="evenodd"></path></svg>'},99973:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 9 5"><path fill="#000" fill-rule="evenodd" d="M4.128 4.587.751.834A.5.5 0 0 1 1.123 0h6.754a.5.5 0 0 1 .372.834L4.872 4.587a.5.5 0 0 1-.744 0"></path></svg>'},81146:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><g fill="none" fill-rule="nonzero"><path fill="#000" d="M13 7.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0m-6.5 0a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0M0 7.5a1.5 1.5 0 1 1 3 0 1.5 1.5 0 0 1-3 0"></path><path d="M0 0h16v16H0z"></path></g></svg>'},91340:e=>{e.exports='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path d="M20.889 1.333h6.222a3.556 3.556 0 0 1 3.556 3.556v6.222a3.556 3.556 0 0 1-3.556 3.556h-6.222a3.556 3.556 0 0 1-3.556-3.556V4.889a3.556 3.556 0 0 1 3.556-3.556M20 4v8h8V4zM4.889 17.333h6.222a3.556 3.556 0 0 1 3.556 3.556v6.222a3.556 3.556 0 0 1-3.556 3.556H4.889a3.556 3.556 0 0 1-3.556-3.556v-6.222a3.556 3.556 0 0 1 3.556-3.556M4 20v8h8v-8zm20 8a4 4 0 1 0 0-8 4 4 0 0 0 0 8m0 2.667a6.667 6.667 0 1 1 0-13.334 6.667 6.667 0 0 1 0 13.334M4.981 12h6.037L7.999 5.963zm4.212-9.615 5.176 10.352a1.334 1.334 0 0 1-1.192 1.93H2.825a1.333 1.333 0 0 1-1.192-1.929L6.809 2.386a1.332 1.332 0 0 1 2.385 0z"></path></svg>'},62686:e=>{"use strict";e.exports=s},79244:e=>{"use strict";e.exports=i},41496:e=>{"use strict";e.exports=a},1888:e=>{"use strict";e.exports=n},14321:e=>{"use strict";e.exports=o}},t={};function r(i){var s=t[i];if(void 0!==s)return s.exports;var o=t[i]={exports:{}};return e[i](o,o.exports,r),o.exports}r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},r.d=(e,t)=>{for(var i in t)r.o(t,i)&&!r.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:t[i]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="";var l={};return r.p=window.jimuConfig.baseUrl,(()=>{"use strict";r.r(l),r.d(l,{__set_webpack_public_path__:()=>Tt,default:()=>Ct});var e,t=r(79244);!function(e){e.auto="auto",e.low="low",e.medium="medium",e.high="high"}(e||(e={}));var i=r(62686),s=r(14321),o=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};function a(e,t,s){return o(this,void 0,void 0,(function*(){return yield new Promise(((o,a)=>(0,i.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]).then((i=>{if(t.features.length<1)o(null);else{let a;[a]=i;const r=t.features[0].layer,l=[],p={};for(let e=0;e<r.fields.length;e++){const t=n(r.fields[e]);p[r.fields[e].name]=t.name,l.push(t)}const c=[];for(const e in t.features[0].attributes)if(p[e]){const t={fieldName:p[e],label:e};c.push(t)}const h=[];t.features.forEach(((e,t)=>{const i=e;if(i.attributes){for(const e in i.attributes)i.attributes[p[e]]=i.attributes[e];i.attributes.exbfid=t}else i.attributes={exbfid:t};h.push(i)}));const d=new a({id:s,title:r.title,source:h,fields:l,outFields:["*"],objectIdField:"exbfid",renderer:r.renderer,popupEnabled:!0,popupTemplate:{title:"information",content:[{type:"fields",fieldInfos:c}]}});e.map.add(d),d.on("layerview-create",(e=>{o(null)}))}}))))}))}function n(e){return{name:e.name.replace(/\./g,"_").replace(/\(/g,"_").replace(/\)/g,"_"),alias:e.alias,type:e.type}}function p(e,t){const i=e.wkid===t.wkid||e.equals(t),s=(e.isWebMercator||e.isWGS84)&&(t.isWebMercator||t.isWGS84);return!i&&!s}function c(e,t){return o(this,void 0,void 0,(function*(){var i;const s=e.clone(),o=s.targetGeometry,a=null===(i=s.camera)||void 0===i?void 0:i.position,n=[];let r=!1,l=!1;if(o&&p(o.spatialReference,t)&&(r=!0,n.push(o)),a&&p(a.spatialReference,t)&&(l=!0,n.push(a)),n.length>0){const e=yield y(n,t);r&&(s.targetGeometry=e[0]),l&&(s.camera.position=e[e.length-1])}return s}))}function h(e,t){return o(this,void 0,void 0,(function*(){return new Promise(((i,s)=>{setTimeout((()=>{e.goTo(t).then((()=>{i()})).catch((()=>{s(new Error(null))}))}),400)}))}))}function d(e){return o(this,void 0,void 0,(function*(){return yield(0,i.loadArcGISJSAPIModules)(["esri/geometry/Extent"]).then((t=>o(this,void 0,void 0,(function*(){let i;if([i]=t,!e||!e.length)return yield Promise.resolve(null);let s,o=null;const a=e.length;for(s=0;s<a;s++){const t=e[s];if(!t)continue;let a=t.extent;if(!a&&"point"===t.type){const e=t;e.x&&e.y&&(a=new i({xmax:e.x,xmin:e.x,ymax:e.y,ymin:e.y,zmax:e.z,zmin:e.z,spatialReference:e.spatialReference}))}a&&(o=o?o.union(a):a)}return o.width<0&&o.height<0?yield Promise.resolve(null):yield Promise.resolve(o)}))))}))}function u(e,t){return"esri.layers.support.SubtypeSublayer"===e.declaredClass?function(e,t){const i=e.parent;if(i){const s=t.clone(),o=function(e){if(!e)return null;const t=e.subtypeField;if(t){const i=e.getField(t);if(i&&i.name)return i.name}return t}(e),a=`${o} = ${e.subtypeCode}`;return s.where?s.where=`(${s.where}) AND (${a})`:s.where=a,i.queryExtent(s)}return null}(e,t):e.queryExtent(t)}function m(e,t,s){return(0,i.loadArcGISJSAPIModules)(["esri/rest/support/Query"]).then((i=>{let o;[o]=i;const a=new o;return a.where=t,a.outFields=s||[],a.returnGeometry=!0,e.queryFeatures(a).then((e=>e))}))}function g(e,s,a){return o(this,void 0,void 0,(function*(){var o;const n=e.view,r=a.layer;if(!r)return;let l=null;if("function"==typeof r.queryFeatures)l=r;else{const[e]=yield(0,i.loadArcGISJSAPIModules)(["esri/layers/FeatureLayer"]);let s=new e({url:t.dataSourceUtils.getUrlByLayer(r)});yield s.load(),l=s}if(l){const e=yield m(l,s,[]);if(e&&e.features&&e.features.length>0){let t=l.geometryType;t||(t=null===(o=e.features[0].geometry)||void 0===o?void 0:o.type);const s=function(e){return["point","multipoint"].includes(e)?{type:"simple-marker",style:"circle",color:[255,255,0,.8],size:"16px",outline:{color:[255,255,0,.8],width:3}}:["polyline"].includes(e)?{type:"simple-line",color:[255,255,0,.8],width:3,style:"solid"}:["polygon","extent"].includes(e)?{type:"simple-fill",color:[255,255,0,.5],style:"solid",outline:{color:[255,255,0,.8],width:3}}:["mesh"].includes(e)?{type:"mesh-3d",symbolLayers:[{type:"fill",material:{color:[255,255,0,.8]}}]}:null}(t);!function(e,t,s){(0,i.loadArcGISJSAPIModules)(["esri/Graphic"]).then((i=>{let o;[o]=i;const a=function(t,i){const a=[];let n=0;for(let e=0;e<t.length;e++){const i=new o({geometry:t[e].geometry,symbol:s,attributes:t[e].attributes});a.push(i)}const r=function(){e.graphics.addMany(a),setTimeout((()=>{e.graphics.removeMany(a),n+=1,n<i&&setTimeout((()=>{r()}),500)}),500)};r()};a(t,3)}))}(n,e.features,s)}}}))}function v(e,s,a){return o(this,void 0,void 0,(function*(){if(!s)return;const n=t.DataSourceManager.getInstance().getDataSource(s);if(!n)return;let r=null;try{r=yield e.whenJimuLayerViewLoadedByDataSource(n)}catch(e){r=null,console.error("can't get jimuLayerView by dataSource",n,e)}if(r&&r.layer){const s=r.type,n=[t.JSAPILayerTypes.FeatureLayer,t.JSAPILayerTypes.ImageryLayer,t.JSAPILayerTypes.OrientedImageryLayer,t.JSAPILayerTypes.SubtypeGroupLayer,t.JSAPILayerTypes.SubtypeSublayer],l=[t.JSAPILayerTypes.SceneLayer,t.JSAPILayerTypes.BuildingComponentSublayer];n.includes(s)?g(e,a,r):l.includes(s)&&function(e,t,s){let a=null;const n=s.view;if(n){const s=n.layer||n.sublayer;if(!s)return;const r=s.associatedLayer;if(!r)return;const l=s.objectIdField;if(!l)return;m(r,t,[l]).then((t=>o(this,void 0,void 0,(function*(){if(t&&t.features&&t.features.length>0){const[s]=yield(0,i.loadArcGISJSAPIModules)(["esri/Color"]),o=t.features.map((e=>e.attributes[l]));let r=0;const p=6;let c=!0;const h=f(null==e?void 0:e.view);if(!h)return void console.error(`can't get the default HighlightOptions for map ${null==e?void 0:e.id}`);const d=h.color,u=function(){r<p?(r++,c?(h.color=new s([0,0,0,0]),a&&a.remove(),a=n.highlight(o)):(h.color=new s([255,255,0,.8]),a&&a.remove(),a=n.highlight(o)),c=!c,setTimeout(u,500)):(h.color=d,a&&a.remove())};setTimeout(u,500)}}))))}}(e,a,r)}}))}function w(e){switch(e.type){case"point":return e;case"extent":return e.center;case"polygon":return e.centroid;case"polyline":return e.extent.center;default:return e&&e.extent?e.extent.center:void 0}}function f(e){let t=null;const i=null==e?void 0:e.highlights;return(null==i?void 0:i.length)>0&&(t=i.find((e=>"default"===e.name))),t}function y(e,i){return o(this,void 0,void 0,(function*(){return e&&0!==e.length&&e[0]&&i.wkid!==e[0].spatialReference.wkid&&!i.equals(e[0].spatialReference)?i.isWebMercator&&e[0].spatialReference.isWGS84||i.isWGS84&&e[0].spatialReference.isWebMercator?yield Promise.resolve(e):yield t.geometryUtils.projectToSpatialReference(e,i):yield Promise.resolve(e)}))}function M(e,i){return o(this,void 0,void 0,(function*(){const s=yield function(e,i){return o(this,void 0,void 0,(function*(){if(!e||0===e.length)return[];const s=e.map((e=>o(this,void 0,void 0,(function*(){const s=yield t.geometryUtils.projectToSpatialReference([e],i);return s&&s.length>0?s[0]:null}))));return yield Promise.all(s)}))}(e,i),a=s.filter((e=>!!e));if(0===a.length)return null;let n=null;return a.forEach((e=>{n=n?n.union(e):e})),n}))}function S(e){return!window.jimuConfig.isInBuilder||e!==t.AppMode.Design}function b(e){const i=[];return e.forEach((e=>{const s=t.DataSourceManager.getInstance().getDataSource(e);let o;o=(null==s?void 0:s.layer)?Promise.resolve(s.layer):(null==s?void 0:s.createJSAPILayerByDataSource)?s.createJSAPILayerByDataSource():Promise.resolve(null),i.push(o)})),Promise.all(i)}function x(e,t){return`${e}-${t||""}`}function I(e,i){if(e&&i){const s=(0,t.getAppStore)().getState().appConfig.messageConfigs;if(s){const o=["panTo","zoomToFeature"],a=t.MessageType.ExtentChange;if(C(e,i,s,a,o)&&C(i,e,s,a,o))return!0}}return!1}function C(e,t,i,s,o){if(i){const a=Object.values(i);for(let i=0;i<a.length;i++){const n=a[i];if(n.widgetId===e&&n.messageType===s){const e=n.actions;for(let i=0;i<e.length;i++){const s=e[i];if(s.widgetId===t&&o.includes(s.actionName))return!0}}}}return!1}function T(e,t,i){if(!t)return!1;if(!i)return!1;if(t.targetGeometry&&"esri.geometry.Point"===t.targetGeometry.declaredClass&&i.targetGeometry&&"esri.geometry.Point"===i.targetGeometry.declaredClass){const s=e.toScreen(t.targetGeometry),o=e.toScreen(i.targetGeometry),a=s.x-o.x,n=s.y-o.y;if(Math.sqrt(a*a+n*n)>=5)return!1}const s=t.camera,o=i.camera;if(s&&o){if(parseFloat(s.heading.toFixed(2))!==parseFloat(o.heading.toFixed(2)))return!1;if(parseFloat(s.tilt.toFixed(2))!==parseFloat(o.tilt.toFixed(2)))return!1;if(s.position.distance(o.position)>=1)return!1}else{if(parseFloat(t.rotation.toFixed(2))!==parseFloat(i.rotation.toFixed(2)))return!1;const e=t.scale-i.scale;if(Math.abs(e)>=1)return!1}return!0}function V(e,t){if(e.viewpointHistory.length>0){const i=e.viewpointHistory.length-1;if(t>=0&&t<=i){return e.viewpointHistory[t].clone()}}return null}function P(e){var i;if(e&&e.isActive&&e.view&&!e.view.destroyed){const s=e.view,o=t.UrlManager.getInstance(),a=s.viewpoint?s.viewpoint.toJSON():null;let n=null,r=null,l=null,p=null;if(a&&(n=JSON.stringify(a)),"2d"===s.type){const e=null===(i=s.spatialReference)||void 0===i?void 0:i.wkid;if(e){const t=s.center;r=`${t.x},${t.y},${e}`}l=String(s.scale),p=String(s.rotation)}s.lastViewpointToUpdateUrlParams=s.viewpoint?s.viewpoint.clone():null,s.lastViewpointUrlParamUpdateTimestamp=Date.now();const c={active_datasource_id:e.dataSourceId||null,center:r,scale:l,rotation:p,viewpoint:n};o.setWidgetUrlParams(e.mapWidgetId,c)}}function L(e,t,i,s,o){let a={},n=null,r=null,l=null,p=null;if(e){try{if(e.viewpoint){const t=JSON.parse(e.viewpoint);t&&(n=i.fromJSON(t))}}catch(e){console.error("parse viewpoint from url hash params error",e),n=null}if(t){try{if(e.center){const t=e.center.split(",");if(t.length>=3){const e=parseFloat(t[0]),i=parseFloat(t[1]),a=parseFloat(t[2]);if(D(e)&&D(i)&&D(a)){r=new s({x:e,y:i,spatialReference:new o({wkid:a})})}}}}catch(e){console.error("parse center from url hash params error",e),r=null}try{if("scale"in e){const t=parseFloat(e.scale);D(t)&&t>=0&&(l=t)}}catch(e){l=null,console.error("parse scale from url hash params error",e)}try{if("rotation"in e){const t=parseFloat(e.rotation);D(t)&&t>=0&&t<=360&&(p=t)}}catch(e){p=null,console.error("parse rotation from url hash params error",e)}}}return n&&(a.viewpoint=n),t&&(r&&(a.center=r),D(l)&&(a.scale=l),D(p)&&(a.rotation=p)),0===Object.keys(a).length&&(a=null),a}function D(e){return"number"==typeof e&&!isNaN(e)}function A(){if(!document)return null;return document.fullscreenElement||document.webkitFullscreenElement||document.webkitFullScreenElement||document.mozFullScreenElement||document.msFullscreenElement}const N=t.React.createContext({mapWidgetId:null,mapWidgetHeight:null,isShowMapSwitchBtn:!1,isFullScreen:!1,dataSourceIds:[],activeDataSourceId:null,switchMap:()=>null,fullScreenMap:()=>null,initialMapState:null,mobilePanelContainer:null,onMobilePanelContentChange:e=>null,theme:null}),E=["top-left","top-center","top-right","bottom-left","bottom-center","bottom-right"];function j(e){let t=null;return e&&e.popupDockPosition&&("auto"===e.popupDockPosition||E.includes(e.popupDockPosition))&&(t=e.popupDockPosition),t}function k(e,t){let i=null;if("2d"===e.type&&t){const s=function(e){var t;let i=null,s=null;const o=null===(t=null==e?void 0:e.constraintsInfo)||void 0===t?void 0:t.lods;if(o&&o.length>0){const e=[];o.forEach((t=>{const i=null==t?void 0:t.scale;"number"==typeof i&&i>0&&e.push(i)})),e.length>0&&(i=Math.max(...e),s=Math.min(...e))}return{minScale:i,maxScale:s}}(e),o=null==s?void 0:s.minScale,a=null==s?void 0:s.maxScale;i=function(e,t,i,s){const o={isScaleRangeValid:!0,finalMinScale:0,finalMaxScale:0};if(s){const a=s.minScale,n=s.maxScale,r=O(a)?a:1/0,l=O(n)?n:0,p=O(t)?t:1/0,c=function(e,t){const i=Math.min(...e),s=Math.max(...e),o=Math.min(...t),a=Math.max(...t),n=Math.max(i,o),r=Math.min(s,a);if(n>r)return null;return[n,r]}([l,r],[O(i)?i:0,p]);if(c){const[e,s]=c;o.isScaleRangeValid=!0,o.finalMinScale=R(s),o.finalMaxScale=R(e),o.finalMinScale===t&&(o.finalMinScale=0),o.finalMaxScale===i&&(o.finalMaxScale=0)}else o.isScaleRangeValid=!1,o.finalMinScale=e,o.finalMaxScale=e}return o}(e.scale,o,a,t)}return i||(i={isScaleRangeValid:!0,finalMinScale:0,finalMaxScale:0}),i}function O(e){return"number"==typeof e&&isFinite(e)&&e>0}function R(e){return isFinite(e)?e:0}var W=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};const B=r(47717);var F;!function(e){e.Loading="LOADING",e.Loadok="LOADOK",e.LoadError="LOADERROR"}(F||(F={}));class H extends t.React.PureComponent{constructor(e){super(e),this.dsManager=t.DataSourceManager.getInstance(),this.isFirstReceiveMessage=!0,this.__unmount=!1,this.debounceUpdateUrlHashParams=()=>null,this.getInitViewPointForDefaultWebMap=()=>{const e=this.props.defaultMapInfo&&this.props.defaultMapInfo.defaultExtent;let t=null;return t=this.props.baseWidgetProps.config.initialMapState&&this.props.baseWidgetProps.config.initialMapState.viewPoint?this.generateViewPointFromInitialMapState(this.props.baseWidgetProps.config.initialMapState):new this.Viewpoint({targetGeometry:new this.Extent({xmin:e&&e.xmin,ymin:e&&e.ymin,xmax:e&&e.xmax,ymax:e&&e.ymax,spatialReference:{wkid:e.spatialReference.wkid}})}),t},this.onDataSourceCreated=e=>{if(e.id===this.props.dataSourceId){const t=this.createFailedDataSourceIds[this.props.dataSourceId];if(delete this.createFailedDataSourceIds[this.props.dataSourceId],this.mapDs=e,this.isReadyToCreateJimuMapView())return void this.createJimuMapView();t&&!this.view&&!this.mapCreatingInfo&&this.expectedDataSourceInfo&&this.expectedDataSourceInfo.dataSourceId===e.id&&(console.log(`recreate map because data source ${this.props.dataSourceId} is recreated`),this.cacheLoadModulesAndCreateMapbaseView(this.expectedDataSourceInfo))}},this.onCreateDataSourceFailed=e=>{console.warn("onCreateDataSourceFailed",e),this.mapDs=null;const t=this.props.dataSourceId;this.createFailedDataSourceIds[t]=!0,this.setState({mapLoadStatus:F.LoadError},(()=>{this.props.onMapLoaded(t,F.LoadError)}))},this.setViewPoint=e=>{this.view&&e&&(this.view.viewpoint=e.clone())},this.getViewPoint=()=>this.view&&this.view.viewpoint?this.view.viewpoint.clone():null,this.getMapLoadStatus=()=>this.state.mapLoadStatus,this.getViewType=()=>this.getDsJsonFromDsId(this.props.dataSourceId).type,this.queryExtentFromSingleLayerQueryParams=e=>{const t=this.dsManager.getDataSource(e),s=t.getCurrentQueryParams();let o;return o=(null==t?void 0:t.layer)?Promise.resolve(t.layer):t.createJSAPILayerByDataSource().then((e=>Promise.resolve(e))),(0,i.loadArcGISJSAPIModules)(["esri/rest/support/Query","esri/Graphic","esri/geometry/Point"]).then((e=>{const[t,i,a]=e,n=new t;return n.where=null==s?void 0:s.where,o.then((e=>u(e,n).then((t=>{var s;const o=null===(s=null==t?void 0:t.extent)||void 0===s?void 0:s.center,n=null==t?void 0:t.extent;let r;if(1===(null==t?void 0:t.count)&&"point"===e.geometryType&&o){const e=new a({x:o.x,y:o.y,spatialReference:n.spatialReference});r=new i({geometry:e})}return{extent:n,singlePointGraphic:r,count:null==t?void 0:t.count,layer:e}}))))}))},this.queryExtentFromQueryParams=(e,t,i)=>W(this,void 0,void 0,(function*(){if(!i.some((e=>{const t=this.dsManager.getDataSource(e).getRuntimeQueryParams();return!!((null==t?void 0:t.where)&&"1=1"!==t.where)}))){const e=this.getMapBaseInitViewPoint();return Promise.resolve({viewpoint:e,useDefaultExtentOfCurrentView:!0,singlePointGraphic:null,count:2,layer:null})}const s=[];t.forEach((e=>{s.push(this.queryExtentFromSingleLayerQueryParams(e))}));const o=yield Promise.all(s);if(1===(null==o?void 0:o.length))return o[0];{let t=0;const i=[];o.forEach((e=>{e.extent&&i.push(e.extent),t+=e.count}));return{extent:yield M(i,e.spatialReference),singlePointGraphic:null,count:t,layer:null}}})),this.debounceUpdateUrlHashParams=t.lodash.debounce((()=>{this.updateUrlHashParams()}),500),this.restored=!1,this.createFailedDataSourceIds={},this.mapViewCreateFailedUniqueIdsInfo={},this.updateExpectedDataSourceInfo();const s=this.getRestoreDataFromMS();s&&s.expectedDataSourceInfo.uniqueId===this.expectedDataSourceInfo.uniqueId?(!function(e,t){const i=Object.keys(t);for(const s of i)e[s]=t[s]}(this,s),this.updateRestoreDataToMS(null),this.bindMapBaseViewEvent(this.view),this.view&&(this.view.isInCaching=!1,this.view.mapbase=this,this.restored=!0,this.tryFatalErrorRecovery(this.view),this.view.isMapToolsHidden?this.view.hideMapTools():this.view.showMapTools())):this.state={dataSourceId:null,isBasicModulesLoaded:!1,mapLoadStatus:F.Loading},this.unsubscribeResourceSessions(),this.resourceSessionsUnsubscribe=(0,t.observeStore)(this.onStoreResourceSessionsChange.bind(this),["resourceSessions"])}unsubscribeResourceSessions(){this.resourceSessionsUnsubscribe&&(this.resourceSessionsUnsubscribe(),this.resourceSessionsUnsubscribe=null)}static getDerivedStateFromProps(e,t){return e.dataSourceId!==t.dataSourceId?{dataSourceId:e.dataSourceId,mapLoadStatus:F.Loading}:null}getStyle(){return t.css`
      .esri-view .esri-view-surface:focus::after {
        display: none;
      }
    `}render(){let e=null;return this.props.baseWidgetProps.useDataSources&&(e=this.props.baseWidgetProps.useDataSources.find((e=>e.dataSourceId===this.props.dataSourceId))),(0,t.jsx)("div",{className:"w-100 h-100 map-base",style:{position:"relative"},css:this.getStyle(),ref:e=>{this.widgetContainer=e}},this.state.mapLoadStatus===F.Loading&&(0,t.jsx)("div",{className:"w-100 h-100 widget-map-background"},(0,t.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"})),this.state.mapLoadStatus===F.LoadError&&(0,t.jsx)("div",{className:"w-100 h-100 widget-map-background"},this.getMapSwitchForErrorMap(),(0,t.jsx)("div",{className:"w-100 h-100 d-flex justify-content-center align-items-center"},this.formatMessage("mapFailure"))),!this.props.isDefaultMap&&(0,t.jsx)("div",{style:{position:"absolute",display:"none"}},(0,t.jsx)(t.DataSourceComponent,{useDataSource:e,onDataSourceCreated:this.onDataSourceCreated,onCreateDataSourceFailed:this.onCreateDataSourceFailed})))}componentDidMount(){if(this.__unmount=!1,0===this.widgetContainer.getElementsByClassName("widget-map").length&&(this.mapContainer||(this.mapContainer=document&&document.createElement("div"),this.mapContainer.className="w-100 h-100 widget-map mapview-container"),this.widgetContainer.appendChild(this.mapContainer)),this.props.startLoadModules&&this.loadCommonModules(),this.restored){const e=this.getJimuMapViewFoView(this.view);e&&!e.isCached()&&e.onRestore()}}componentDidUpdate(e){this.tryCreateMapViewWhenDidUpdate(e),this.tryHandleUrlParamsChangeWhenDidUpdate(e)}tryCreateMapViewWhenDidUpdate(e){var t;if(this.updateExpectedDataSourceInfo(),!this.state.isBasicModulesLoaded)return;this.view&&e.isMapInVisibleArea!==this.props.isMapInVisibleArea&&this.props.baseWidgetProps.useDataSources&&2===this.props.baseWidgetProps.useDataSources.length&&(this.props.isMapInVisibleArea?(this.view.isInCaching=!1,this.tryFatalErrorRecovery(this.view)):this.view.isInCaching=!0);let i=!1;if(this.view){if(this.isViewExpected(this.view))return i=!1,this.tryUpdateCurrentViewByConfigProps(!1),void this.checkAndHandleMutableStateProps();i=!0}else{if(this.isCreatingExpectedView())return void(i=!1);{const e=null===(t=this.expectedDataSourceInfo)||void 0===t?void 0:t.uniqueId;i=!e||!this.mapViewCreateFailedUniqueIdsInfo[e]}}i&&(this.destroyCurrentMapbaseView(),this.cacheLoadModulesAndCreateMapbaseView(this.expectedDataSourceInfo))}tryHandleUrlParamsChangeWhenDidUpdate(e){var t,i,s,o;try{if(!this.view)return;const a=null===(t=null==e?void 0:e.baseWidgetProps)||void 0===t?void 0:t.runtimeUrlHashParams,n=null===(s=null===(i=this.props)||void 0===i?void 0:i.baseWidgetProps)||void 0===s?void 0:s.runtimeUrlHashParams;if(n&&n!==a&&n.active_datasource_id){const e=this.getJimuMapViewFoView(this.view);if(e&&e.isActive&&e.dataSourceId===n.active_datasource_id){const e=this.view.lastViewpointUrlParamUpdateTimestamp>0&&Date.now()-this.view.lastViewpointUrlParamUpdateTimestamp<=100;if(!e){const e=n.viewpoint&&n.viewpoint!==(null==a?void 0:a.viewpoint),t=n.center&&n.center!==(null==a?void 0:a.center),i=n.scale&&n.scale!==(null==a?void 0:a.scale),s=n.rotation&&n.rotation!==(null==a?void 0:a.rotation);if(e||t||i||s){const a=function(e,t,i,s,o,a,n,r,l){var p;let c=null;const h=null===(p=e.viewpoint)||void 0===p?void 0:p.clone(),d="2d"===e.type;d||(s=!1,o=!1,a=!1);const u=L(t,d,n,r,l);return u&&(i||delete u.viewpoint,s||delete u.center,o||delete u.scale,a||delete u.rotation,Object.keys(u).length>0&&(d?(c=u.viewpoint||h,c&&(u.center&&(c.targetGeometry=u.center),"scale"in u&&(c.scale=u.scale),"rotation"in u&&(c.rotation=u.rotation))):c=u.viewpoint)),c}(this.view,n,e,t,i,s,this.Viewpoint,this.Point,this.SpatialReference),r=null===(o=this.view.viewpoint)||void 0===o?void 0:o.clone();a&&!T(this.view,a,r)&&(this.view.viewpoint=a)}}}}}catch(e){console.error("handleUrlParamsChange error",e)}}componentWillUnmount(){this.__unmount=!0,this.unsubscribeResourceSessions(),this.view&&(this.view.mapbase=null);const e=(0,t.getAppStore)().getState().appConfig.widgets;if(e[this.props.baseWidgetProps.id]&&e[this.props.baseWidgetProps.id].useDataSources===this.props.baseWidgetProps.useDataSources&&this.state.mapLoadStatus!==F.Loading){const e=function(e){const{mapContainer:t,state:i,Geometry:s,InitialViewProperties:o,TileLayer:a,Basemap:n,MapView:r,SceneView:l,Extent:p,Viewpoint:c,PortalItem:h,Portal:d,WebMap:u,WebScene:m,Color:g,SpatialReference:v,Point:w,expectedDataSourceInfo:f,mapCreatingInfo:y,view:M,lastUpdateViewConfig:S,mapDs:b,dsManager:x,isFirstReceiveMessage:I}=e;return{mapContainer:t,state:i,Geometry:s,InitialViewProperties:o,TileLayer:a,Basemap:n,MapView:r,SceneView:l,Extent:p,Viewpoint:c,PortalItem:h,Portal:d,WebMap:u,WebScene:m,Color:g,SpatialReference:v,Point:w,expectedDataSourceInfo:f,mapCreatingInfo:y,view:M,lastUpdateViewConfig:S,mapDs:b,dsManager:x,isFirstReceiveMessage:I}}(this);if(this.view&&(this.view.isInCaching=!0),this.updateRestoreDataToMS(e),this.view){const e=this.getJimuMapViewFoView(this.view);e&&e.onCache()}}else this.destroyCurrentMapbaseView(),this.mapCreatingInfo=null,this.view&&!this.view.destroyed&&(this.view.container=null,this.view=null),this.mapDs=null}createDataSourceInfo(e){let i=null;const s=this.getDsJsonFromDsId(e);if(s&&s.id){const e=s.type||"",o=s.itemId||"",a=s.id,n=this.getJimuMapViewId(a);i=e===t.DataSourceTypes.WebScene?{isDefaultMap:!1,isWebMap:!1,uniqueId:`webscene-${a}-${o}`,dataSourceId:a,jimuMapViewId:n,dataSourceJson:s}:{isDefaultMap:!1,isWebMap:!0,uniqueId:`webmap-${a}-${o}`,dataSourceId:a,jimuMapViewId:n,dataSourceJson:s}}else{const e="";i={isDefaultMap:!0,isWebMap:!0,uniqueId:"webmap-default",dataSourceId:e,jimuMapViewId:this.getJimuMapViewId(e),dataSourceJson:s}}return i}getJimuMapViewId(e){return x(this.props.baseWidgetProps.id,e)}getDsJsonFromDsId(e){let i=null;return e&&(i=(0,t.getAppStore)().getState().appConfig.dataSources[e]),i||(i={}),i}getCurrentDataSourceJson(){return this.getDsJsonFromDsId(this.props.dataSourceId)}updateExpectedDataSourceInfo(){this.expectedDataSourceInfo=this.createDataSourceInfo(this.props.dataSourceId)}isCurrentViewExpected(){return this.isViewExpected(this.view)}isViewExpected(e){return e&&e.dataSourceInfo.uniqueId===this.expectedDataSourceInfo.uniqueId}isCreatingExpectedView(){return this.mapCreatingInfo&&this.isDataSourceInfoExpected(this.mapCreatingInfo.dataSourceInfo)}isDataSourceInfoExpected(e){return e&&e.uniqueId===this.expectedDataSourceInfo.uniqueId}tryUpdateCurrentViewByConfigProps(e){if(!this.view)return;const t=this.props.baseWidgetProps.config,i=this.lastUpdateViewConfig;this.lastUpdateViewConfig=t;const s=!t.disablePopUp;if(e)this.view.popupEnabled=s;else{const e=!(null==i?void 0:i.disablePopUp),s=!t.disablePopUp;e!==s&&(this.view.popupEnabled=s,s||this.view.closePopup())}if(!e&&t.popupDockPosition!==(null==i?void 0:i.popupDockPosition)&&this.view.popup){const e=j(t);this.updatePopupDockParams(this.view.popup,e)}const o=f(this.view);if(o&&(t.selectionHighlightColor!==(null==i?void 0:i.selectionHighlightColor)||t.selectionHighlightHaloColor!==(null==i?void 0:i.selectionHighlightHaloColor))){const e=this.createDefaultHighlightOptionsByConfig(t,this.Color);o.color=e.color,o.haloColor=e.haloColor}const a=!t.disableScroll;this.view.navigation&&(this.view.navigation.mouseWheelZoomEnabled!==a&&(this.view.navigation.mouseWheelZoomEnabled=a),this.view.navigation.browserTouchPanEnabled!==a&&(this.view.navigation.browserTouchPanEnabled=a)),this.view.ui&&(this.view.ui.components=[]);const n=t.sceneQualityMode;if(this.isSceneView(this.view)){const e=this.view;n&&n!==e.qualityProfile&&(e.qualityProfile=n)}if("2d"===this.view.type){const e=this.calMapViewTimeZone(this.view.map),s=this.view;s.timeZone!==e&&(s.timeZone=e);const o=(null==i?void 0:i.scaleRange)||null;((null==t?void 0:t.scaleRange)||null)!==o&&this.applyFinalMinMaxScaleFor2dMapView(s)}}applyFinalMinMaxScaleFor2dMapView(e){var t,i,s;let o=!1;if("2d"===e.type){const a=null===(s=null===(i=null===(t=this.props)||void 0===t?void 0:t.baseWidgetProps)||void 0===i?void 0:i.config)||void 0===s?void 0:s.scaleRange,n=e.constraints;if(n){const t=k(e,a);if(t){const{finalMinScale:e,finalMaxScale:i}=t;n.minScale!==e&&(o=!0,n.minScale=e),n.maxScale!==i&&(o=!0,n.maxScale=i)}}}return o}updatePopupDockParams(e,t){e&&(t?(e.dockEnabled=!0,e.dockOptions={breakpoint:!1,buttonEnabled:!0,position:()=>{let e=t;return this.view&&(e="xsmall"===this.view.widthBreakpoint?["top-left","top-center","top-right"].includes(t)?"top-center":"bottom-center":t),e||(e="auto"),e}}):(e.dockEnabled=!1,e.dockOptions={breakpoint:!0,buttonEnabled:!0,position:"auto"}))}checkAndHandleMutableStateProps(){if(this.view&&this.props.baseWidgetProps.mutableStateProps){const e=this.view.dataSourceInfo.jimuMapViewId,t=i.MapViewManager.getInstance().getJimuMapViewById(e);t&&t.whenJimuMapViewLoaded().then((()=>{setTimeout((()=>{this.handleAction(this.props.baseWidgetProps.mutableStateProps,this.view,t),this.isFirstReceiveMessage=!1}),this.isFirstReceiveMessage?500:0)}))}}isMapView(e){return e&&"esri.views.MapView"===e.declaredClass}isSceneView(e){return e&&"esri.views.SceneView"===e.declaredClass}diffProps(e){const t=[],i=[],s=[],o=Object.keys(this.props),a=Object.keys(e),n={};a.forEach((e=>{n[e]=!0}));const r={};return o.forEach((e=>{r[e]=!0})),o.forEach((i=>{n[i]?e[i]!==this.props[i]&&s.push(i):t.push(i)})),a.forEach((e=>{r[e]||i.push(e)})),{addedKeys:t,removeKeys:i,updatedKeys:s}}loadCommonModules(){return W(this,void 0,void 0,(function*(){const e=yield(0,i.loadArcGISJSAPIModules)(["esri/geometry/Extent","esri/Viewpoint","esri/portal/Portal","esri/portal/PortalItem","esri/Color","esri/geometry/SpatialReference","esri/geometry/Point","esri/core/reactiveUtils"]);[this.Extent,this.Viewpoint,this.Portal,this.PortalItem,this.Color,this.SpatialReference,this.Point,this.reactiveUtils]=e,this.__unmount||this.setState({isBasicModulesLoaded:!0})}))}cacheLoadModulesAndCreateMapbaseView(e){return W(this,void 0,void 0,(function*(){if(this.__unmount||this.isCurrentViewExpected()||this.isCreatingExpectedView())return;const t=null==e?void 0:e.uniqueId;t&&delete this.mapViewCreateFailedUniqueIdsInfo[t],this.setState({mapLoadStatus:F.Loading});const s={dataSourceInfo:e};this.mapCreatingInfo=s;try{if(e.isWebMap){if(!this.MapView){const e=yield(0,i.loadArcGISJSAPIModules)(["esri/geometry/Geometry","esri/webmap/InitialViewProperties","esri/Basemap","esri/layers/TileLayer","esri/views/MapView","esri/WebMap"]);[this.Geometry,this.InitialViewProperties,this.Basemap,this.TileLayer,this.MapView,this.WebMap]=e}}else if(!this.SceneView){const e=yield(0,i.loadArcGISJSAPIModules)(["esri/views/SceneView","esri/WebScene"]);[this.SceneView,this.WebScene]=e}if(this.__unmount||this.isCurrentViewExpected()||!this.isDataSourceInfoExpected(s.dataSourceInfo))return;yield this.createMapbaseView(s)}catch(e){console.error("cacheLoadModulesAndCreateMapbaseView error",e),t&&(this.mapViewCreateFailedUniqueIdsInfo[t]=!0),this.mapCreatingInfo===s&&this.setState({mapLoadStatus:F.LoadError})}this.mapCreatingInfo===s&&(this.mapCreatingInfo=null)}))}createMapbaseView(e){return W(this,void 0,void 0,(function*(){const t=e.dataSourceInfo;if(this.__unmount||this.isCurrentViewExpected()||!this.isDataSourceInfoExpected(t))return;let i=null,s=null;t.isWebMap?i=yield this.getMapViewOptionToCreateMapView(t):s=yield this.getSceneViewOptionToCreateSceneView(t);const o=i&&i.map||s&&s.map;if(!o||"failed"===o.loadStatus)return void console.log("webmap load failed, so can't create mapbase view,",t.uniqueId);const a={defaultPopupTemplateEnabled:!0},n=this.props.baseWidgetProps.config;if(n){const e=j(n);e&&this.updatePopupDockParams(a,e)}if(i&&(i.popup=a),s&&(s.popup=a),this.__unmount||this.isCurrentViewExpected()||!this.isDataSourceInfoExpected(t))return;let r=null;if(this.props.baseWidgetProps.isRunAppMode&&(r=this.getMapOptionsByUrlHashParams(t.isWebMap),r)){const e=r.viewpoint;if(i){let t=!1;e&&(i.viewpoint=e,t=!0),r.center&&(i.center=r.center),"scale"in r&&(i.scale=r.scale),"rotation"in r&&(i.rotation=r.rotation,t=!0),t&&(i.constraints.snapToZoom=!1)}s&&e&&(s.viewpoint=e)}let l=null;l=t.isWebMap?new this.MapView(i):new this.SceneView(s),l.initUrlHashMapOptions=r;const p=l.map,c=()=>{if(p.originalBasemap)return;const e=p.basemap;if(e){if(!e.thumbnailUrl){const t=p.thumbnailUrl;t&&(e.thumbnailUrl=t)}p.originalBasemap=e}};if(p.basemap)c();else{let e=null;e=this.reactiveUtils.watch((()=>null==p?void 0:p.basemap),(()=>{e&&e.remove(),e=null,p.basemap&&c()}))}l.mapbase=this,l.highLightHandles={},l.mapBaseViewEventHandles={},l.extentChangeRelatedWidgetIds=[],l.publishExtentChangeMessage=function(e,t){try{if(l&&!l.destroyed){const i=l.mapbase;i&&!i.__unmount&&i.props&&i.props.onExtentChanged&&i.publishExtentChangeMessage(l,e,t)}}catch(e){console.error("view publish extent change message error",e)}},l.hideMapTools=function(){try{if(l.isMapToolsHidden=!0,l&&!l.destroyed){const e=l.mapbase;if(e&&!e.__unmount&&e.props){e.props.onActiveToolInfoChange&&e.props.onActiveToolInfoChange(null);const t=e.props.multiSourceMapDom;t&&t.classList.add("hide-map-tools-layout")}}}catch(e){console.error("view hide map tools error",e)}},l.viewpointHistory=[],l.viewpointIndex=-1,l.showMapTools=function(){try{if(l.isMapToolsHidden=!1,l&&!l.destroyed){const e=l.mapbase;if(e&&!e.__unmount&&e.props){const t=e.props.multiSourceMapDom;t&&t.classList.remove("hide-map-tools-layout")}}}catch(e){console.error("view show map tools error",e)}},l.dataSourceInfo=t,this.view&&(this.destroyCurrentMapbaseView(),this.view=null),this.view=l,this.mapCreatingInfo=null,this.isReadyToCreateJimuMapView()&&this.createJimuMapView(),l.when((()=>{var e,t,i;if(l.isViewWhenReady=!0,l.viewpoint?l.lastViewpointToUpdateUrlParams=l.viewpoint.clone():l.lastViewpointToUpdateUrlParams=null,"2d"===l.type){this.applyFinalMinMaxScaleFor2dMapView(l)&&setTimeout((()=>{l.viewpoint&&(l.lastViewpointToUpdateUrlParams=l.viewpoint.clone())}),100)}l.viewWhenTimestamp=Date.now();!l.destroyed&&this.view===l&&this.isViewExpected(l)&&(setTimeout((()=>{l.destroyed||this.publishExtentChangeMessage(l,!0)}),1e3),l.watchInteractingHandle=this.reactiveUtils.watch((()=>null==l?void 0:l.interacting),(()=>{l.interacting&&(H.lastInteractiveView=l,this.setExtentChangeRelatedWidgetIdsForView(l,[]))})),l.extentWatchHandle=this.reactiveUtils.watch((()=>null==l?void 0:l.extent),(e=>{e&&(this.publishExtentChangeMessage(l,!1),l.stationaryTimerId&&(clearTimeout(l.stationaryTimerId),l.stationaryTimerId=null),l.stationaryTimerId=setTimeout((()=>{l.stationaryTimerId=null,this.publishExtentChangeMessage(l,!0),this.setExtentChangeRelatedWidgetIdsForView(l,[]),setTimeout((()=>{l!==H.lastInteractiveView||l.interacting||(H.lastInteractiveView=null)}),1e3)}),200))})),"2d"===l.type&&(l.watchLodsHandle=this.reactiveUtils.watch((()=>{var e;return null===(e=l.constraintsInfo)||void 0===e?void 0:e.lods}),(()=>{this.applyFinalMinMaxScaleFor2dMapView(l)}))),l.fatalErrorWatchHandle||(l.fatalErrorWatchHandle=this.reactiveUtils.watch((()=>null==l?void 0:l.fatalError),(e=>{var t,i;if(e){const e=!l.isInCaching&&l.container&&l.container.clientWidth>0&&l.container.clientHeight>0,s=(null===(i=null===(t=this.props)||void 0===t?void 0:t.baseWidgetProps)||void 0===i?void 0:i.id)||"";e?(console.error(`${s} Fatal Error! View has lost its WebGL context. Attempting to recover it because the view is visible.`),this.tryFatalErrorRecovery(l)):console.error(`${s} Fatal Error! View has lost its WebGL context. Don't recover it because the view is not visible.`)}}))),this.setState({mapLoadStatus:F.Loadok},(()=>{this.props.onMapLoaded(this.props.dataSourceId,F.Loadok)})),(null===(i=null===(t=null===(e=this.props.baseWidgetProps)||void 0===e?void 0:e.mutableStateProps)||void 0===t?void 0:t.zoomToFeatureActionValue)||void 0===i?void 0:i.value)||l.initUrlHashMapOptions||this.goHome(!1),this.isMapView(l)&&setTimeout((()=>{l.constraints.snapToZoom=!1}),0))})),this.bindMapBaseViewEvent(l),this.tryUpdateCurrentViewByConfigProps(!0),this.checkAndHandleMutableStateProps()}))}publishExtentChangeMessage(e,i,s){if(!e)return;const o=Date.now();e.firstPublishExtentChangeTime||(e.firstPublishExtentChangeTime=o);const a=e.extent.clone(),n=e.viewpoint.clone(),r=new t.ExtentChangeMessage(this.props.baseWidgetProps.id,a,n,i);r.publishTime=o,r.interactive=s||e.interacting;const l=this.getExtentChangeRelatedWidgetIdsOfView(e);if(r.setRelatedWidgetIds(l),r.addRelatedWidgetId(this.props.baseWidgetProps.id),this.props.onExtentChanged(this.props.dataSourceId,r),i){const t=e.viewpoint.clone();if(e.viewpointHistory.length>0){const i=[e.viewpointIndex,e.viewpointIndex-1,e.viewpointIndex+1];let s=!1;const o=e.viewpointHistory.length-1;for(let a=0;a<i.length;a++){const n=i[a];if(n>=0&&n<=o){const i=V(e,n);if(i&&T(e,t,i)){s=!0;break}}}s||(e.viewpointHistory.splice(e.viewpointIndex+1),e.viewpointHistory.push(t),e.viewpointIndex+=1)}else e.viewpointHistory.push(t),e.viewpointIndex=0;e.stationaryCallback&&e.stationaryCallback()}this.debounceUpdateUrlHashParams()}updateUrlHashParams(){if(this.view){const e=this.getJimuMapViewFoView(this.view);if(e&&e.isActive){!T(this.view,this.view.viewpoint,this.view.lastViewpointToUpdateUrlParams)&&P(e)}}}generateViewPointFromInitialMapState(e){return"2d"===e.viewType?new this.Viewpoint({targetGeometry:this.Extent.fromJSON(e.extent),rotation:e.rotation}):this.Viewpoint.fromJSON(e.viewPoint)}getMapOptionsByUrlHashParams(e){let t=null;try{const i=this.props.baseWidgetProps.isRunAppMode,s=this.props.baseWidgetProps.runtimeUrlHashParams;i&&s&&(t=L(s,e,this.Viewpoint,this.Point,this.SpatialReference))}catch(e){console.error("parse map options from url hash params error",e),t=null}return t}calMapViewTimeZone(e){var t,i;let s="";const o=null===(i=null===(t=this.props)||void 0===t?void 0:t.baseWidgetProps)||void 0===i?void 0:i.mapTimeZone,a=null==e?void 0:e.originalItemTimeZone;return s=o||(a||"system"),s}createWebMapOrWebSceneByDataSource(e){return W(this,void 0,void 0,(function*(){let i=null;const s=e.isWebMap?this.WebMap:this.WebScene,o=e.dataSourceJson;if(o.portalUrl){const e=new this.Portal({url:t.portalUrlUtils.getPlatformUrlByOrgUrl(o.portalUrl)});i=new s({portalItem:new this.PortalItem({id:o.itemId,portal:e})})}else i=new s({portalItem:new this.PortalItem({id:o.itemId})});return yield i.load(),yield i.when(),i}))}getDefaultWebMap(){return W(this,void 0,void 0,(function*(){const e=this.props.defaultMapInfo&&this.props.defaultMapInfo.defaultExtent,t=new this.Viewpoint({targetGeometry:new this.Extent({xmin:e&&e.xmin,ymin:e&&e.ymin,xmax:e&&e.xmax,ymax:e&&e.ymax,spatialReference:{wkid:e.spatialReference.wkid}})}),i=new this.WebMap({portalItem:{id:this.props.defaultMapInfo.defaultMapId,portal:{url:this.props.baseWidgetProps.portalUrl}},initialViewProperties:new this.InitialViewProperties({spatialReference:e&&e.spatialReference,viewpoint:t})});return yield i.load(),yield i.when(),i}))}getMapViewOptionToCreateMapView(e){return W(this,void 0,void 0,(function*(){var t,i;let s;const o=this.props.baseWidgetProps.config.initialMapState;let a=null;this.props.isDefaultMap?(a=yield this.getDefaultWebMap(),s={map:a,container:this.mapContainer,viewpoint:this.getInitViewPointForDefaultWebMap()}):(a=yield this.createWebMapOrWebSceneByDataSource(e),s=o?{map:a,container:this.mapContainer,viewpoint:o&&this.generateViewPointFromInitialMapState(o)}:{map:a,container:this.mapContainer});try{const e=yield a.resourceInfo;e&&(a.originalItemTimeZone=e.timeZone)}catch(e){console.error("can not get MapViewer timeZone",e)}const n=null===(i=null===(t=this.props)||void 0===t?void 0:t.baseWidgetProps)||void 0===i?void 0:i.config;s.highlights=this.createInitialHighlights(n,this.Color);s.constraints={snapToZoom:!0};const r=this.calMapViewTimeZone(a);if(s.timeZone=r,!window.jimuConfig.isInBuilder&&this.props.baseWidgetProps.queryObject[this.props.baseWidgetProps.id]){const e=this.props.baseWidgetProps.queryObject[this.props.baseWidgetProps.id].substr(7);let t;try{t=new this.Extent(JSON.parse(e))}catch(e){console.error("Bad extent URL parameter.")}t&&(s.extent=t)}return s}))}getSceneViewOptionToCreateSceneView(t){return W(this,void 0,void 0,(function*(){const i={map:yield this.createWebMapOrWebSceneByDataSource(t),container:this.mapContainer},s=this.props.baseWidgetProps.config,o=s.initialMapState;o&&(i.viewpoint=o&&this.generateViewPointFromInitialMapState(o)),i.highlights=this.createInitialHighlights(s,this.Color);const a=s.sceneQualityMode;return a&&a!==e.auto?i.qualityProfile=a:i.qualityProfile=e.low,i}))}createInitialHighlights(e,t){return[this.createDefaultHighlightOptionsByConfig(e,t)]}createDefaultHighlightOptionsByConfig(e,t){const i=(null==e?void 0:e.selectionHighlightColor)||"#00FFFF",s=(null==e?void 0:e.selectionHighlightHaloColor)||"#00FFFF";return{name:"default",color:new t(i),haloColor:new t(s)}}bindMapBaseViewEvent(e){e&&(this.releaseMapbaseViewEventHandles(e),e.mapBaseViewEventHandles.click=e.on("click",(()=>{this.releaseHighLightHandles(e)})))}isReadyToCreateJimuMapView(){return!!this.view&&(!!this.props.isDefaultMap||this.mapDs&&this.mapDs.id===this.props.dataSourceId)}getJimuMapViewFoView(e){var t;const s=null===(t=null==e?void 0:e.dataSourceInfo)||void 0===t?void 0:t.jimuMapViewId;if(s){return i.MapViewManager.getInstance().getJimuMapViewById(s)}return null}createJimuMapView(){if(!this.isReadyToCreateJimuMapView())return;const e=this.view,t=this.props.dataSourceId||"",s=this.props.baseWidgetProps.isRunAppMode;i.MapViewManager.getInstance().createJimuMapView({mapWidgetId:this.props.baseWidgetProps.id,dataSourceId:t,view:e,isEnablePopup:this.props.baseWidgetProps.config&&!this.props.baseWidgetProps.config.disablePopUp,mapViewManager:i.MapViewManager.getInstance(),useUrlHashLayersVisibility:s}),e.when((()=>{const t=e.dataSourceInfo.jimuMapViewId,s=i.MapViewManager.getInstance().getJimuMapViewById(t);s&&(s.view?s.whenJimuMapViewLoaded().then((()=>{s.view?this.isViewExpected(e)&&this.props.onJimuMapViewCreated&&this.props.onJimuMapViewCreated(s):i.MapViewManager.getInstance().destroyJimuMapView(t)})):i.MapViewManager.getInstance().destroyJimuMapView(t))}))}destroyCurrentMapbaseView(){this.view&&this.destroyMapbaseView(this.view),this.view=null}destroyMapbaseView(e){e&&(e.watchInteractingHandle&&(e.watchInteractingHandle.remove(),e.watchInteractingHandle=null),e.extentWatchHandle&&(e.extentWatchHandle.remove(),e.extentWatchHandle=null),e.watchLodsHandle&&(e.watchLodsHandle.remove(),e.watchLodsHandle=null),e.fatalErrorWatchHandle&&(e.fatalErrorWatchHandle.remove(),e.fatalErrorWatchHandle=null),e.stationaryTimerId&&(clearTimeout(e.stationaryTimerId),e.stationaryTimerId=null),this.releaseHighLightHandles(e),this.releaseMapbaseViewEventHandles(e));const t=e.dataSourceInfo.jimuMapViewId;t&&i.MapViewManager.getInstance().destroyJimuMapView(t),e.destroyed||e.destroy()}releaseHighLightHandles(e){if(e.highLightHandles){const t=Object.keys(e.highLightHandles);for(const i of t)e.highLightHandles[i].remove()}e.highLightHandles={}}releaseMapbaseViewEventHandles(e){if(e.mapBaseViewEventHandles){const t=Object.keys(e.mapBaseViewEventHandles);for(const i of t)e.mapBaseViewEventHandles[i].remove()}e.mapBaseViewEventHandles={}}onStoreResourceSessionsChange(e,i){t.lodash.defer((()=>{var s,o,a,n;if(this.createFailedDataSourceIds[this.props.dataSourceId])return;if(this.mapCreatingInfo)return;if(!this.view)return;if(!this.view.isViewWhenReady)return;if(this.view.isInCaching)return;const r=this.getJimuMapViewFoView(this.view);if(!r)return;const l=((null===(o=null===(s=this.view.map)||void 0===s?void 0:s.layers)||void 0===o?void 0:o.toArray())||[]).filter((e=>"failed"===e.loadStatus&&e.loadError&&e.url));if(0===l.length)return;const p=t.ServiceManager.getInstance(),c=t.SessionManager.getInstance().getNoPermissionResourceInfoList()||{},h=l.some((s=>{var o;const a=s.url,n=null===(o=p.getServerInfoByServiceUrl(a))||void 0===o?void 0:o.owningSystemUrl,r=t.serviceUrlUtils.getServerRootUrl(a),l=t.portalUrlUtils.getStandardPortalUrl(n||r);if(!l)return!1;const h=(null==e?void 0:e[l])||"",d=(null==i?void 0:i[l])||"";return!(h===d||!d||c[a])}));if(h&&this.expectedDataSourceInfo&&this.isViewExpected(this.view)){const e=null===(n=null===(a=this.props)||void 0===a?void 0:a.baseWidgetProps)||void 0===n?void 0:n.widgetId,t=r.id;console.log(`recreate mapbaseview because layers that previously failed to load are now accessible, mapWidgetId: ${e}, jimuMapViewId: ${t}`),this.destroyCurrentMapbaseView(),this.cacheLoadModulesAndCreateMapbaseView(this.expectedDataSourceInfo)}}))}getRestoreDataFromMS(){const e=this.getRestoreDataKey();return t.MutableStoreManager.getInstance().getStateValue([this.props.baseWidgetProps.id,"restoreData",e])}updateRestoreDataToMS(e){const i=this.getRestoreDataKey();t.MutableStoreManager.getInstance().updateStateValue(this.props.baseWidgetProps.id,`restoreData.${i}`,e)}getRestoreDataKey(){return`${this.props.baseWidgetProps.id}-restoreData-${this.props.dataSourceId}`}goHome(e){return W(this,void 0,void 0,(function*(){if(!this.getDsJsonFromDsId(this.props.dataSourceId))return;const i=(0,t.getAppStore)().getState().appConfig.widgets;if(this.view&&i[this.props.baseWidgetProps.id]){const t=this.getMapBaseInitViewPoint();if(t)return this.view.goTo(t,{animate:e})}}))}getMapBaseInitViewPoint(){var e,t;if(this.props.isDefaultMap)return this.getInitViewPointForDefaultWebMap();{const i=this.props.baseWidgetProps.config.initialMapState;if(i)return this.generateViewPointFromInitialMapState(i);if(this.view){const i=this.view.map;return null===(t=null===(e=null==i?void 0:i.initialViewProperties)||void 0===e?void 0:e.viewpoint)||void 0===t?void 0:t.clone()}}}formatMessage(e){return this.props.baseWidgetProps.intl.formatMessage({id:e,defaultMessage:s.defaultMessages[e]})}handleDisableWheel(){this.widgetContainer.style.pointerEvents="none",setTimeout((()=>{this.widgetContainer.style.pointerEvents="auto"}),50)}getMapSwitchForErrorMap(){return(0,t.jsx)(N.Consumer,null,(({isShowMapSwitchBtn:e,dataSourceIds:i,activeDataSourceId:o,switchMap:a})=>(0,t.jsx)("div",{className:"mapswitch-container",style:{display:e?"block":"none",marginBottom:"xsmall"===this.props.widthBreakpoint?10:0}},(0,t.jsx)("div",{onClick:e=>{e.preventDefault(),a()},className:"w-100 h-100 esri-widget--button"},(0,t.jsx)(s.Icon,{icon:B,width:16,height:16,className:"mapswitch-icon"})))))}handleAction(e,t,i){t&&!t.destroyed&&(this.handleActionForZoomToFeatureActionValue(e,t),this.handleActionForPanToActionValue(e,t),this.handleActionForNewFeatureSetActionValue(e,t),this.handleActionForChangedFeatureSetActionValue(e,t),this.handleActionForSelectFeatureActionValue(e,t),this.handleActionForFlashActionValueAndFilterActionValue(e,t),this.handleActionForShowOnMapDatas(e,i),this.handleActionForAddToMapDatas(e,i))}getExtentChangeRelatedWidgetIdsOfView(e){let t=[];if(e){t=(e.extentChangeRelatedWidgetIds||[]).slice()}return t}setExtentChangeRelatedWidgetIdsForView(e,t){if(e){const i=t||[];e.extentChangeRelatedWidgetIds=i.slice()}}tryFatalErrorRecovery(e){e&&e.tryFatalErrorRecovery()}handleActionForZoomToFeatureActionValue(e,t){return W(this,void 0,void 0,(function*(){var s;if(!e.zoomToFeatureActionValue)return;const a=Date.now(),n=e.zoomToFeatureActionValue,r=e.zoomToFeatureActionValue.relatedWidgets||[];if(r&&r.includes(this.props.baseWidgetProps.id))this.props.onMutableStatePropsChanged(this.props.dataSourceId,"zoomToFeatureActionValue",null);else{const e=n.value;if("zoom-to-extent"===e.type){const i=Date.now();t.lastZoomToExtentTime=i;let s=!1;if(t.firstPublishExtentChangeTime&&i-t.firstPublishExtentChangeTime<=2e3&&t.firstPublishExtentChangeTime<=e.publishTime&&(e.interactive||I(this.props.baseWidgetProps.id,e.publishWidgetId)&&(s=!0)),!s&&t!==H.lastInteractiveView){const i=e.viewpoint,s=e.extent,o=e.stationary;this.setExtentChangeRelatedWidgetIdsForView(t,r);const n=t.spatialReference;i?!function(e,t){var i,s,o;const a=null===(i=e.targetGeometry)||void 0===i?void 0:i.spatialReference;if(a&&p(a,t))return!0;const n=null===(o=null===(s=e.camera)||void 0===s?void 0:s.position)||void 0===o?void 0:o.spatialReference;return!(!n||!p(n,t))}(i,n)?t.viewpoint=i:o&&c(i,n).then((e=>{t.receiveMessageTimeOfLastViewUpdate&&t.receiveMessageTimeOfLastViewUpdate>a||(t.viewpoint=e)})):p(s.spatialReference,n)?o&&y([s],n).then((e=>{const i=e[0];t.goTo(i)})):t.goTo(s,{animate:!1})}}else if("zoom-to-query-params"===e.type)this.queryExtentFromQueryParams(t,e.filterChangedDataSourceIds,e.useDataSourceIds).then((s=>{let o;0!==s.count&&(o=1===s.count&&(null==s?void 0:s.singlePointGraphic)?{graphics:[null==s?void 0:s.singlePointGraphic],layer:null==s?void 0:s.layer}:null==s?void 0:s.extent,this.setExtentChangeRelatedWidgetIdsForView(t,r),s.useDefaultExtentOfCurrentView?t.goTo(s.viewpoint):i.zoomToUtils.zoomTo(t,o,e.zoomToOption))}));else if("zoom-to-array-graphics"===e.type)this.setExtentChangeRelatedWidgetIdsForView(t,r),i.zoomToUtils.zoomTo(t,e.arrayFeatures,e.zoomToOption);else if("zoom-to-layers"===e.type){b(e.dataSourceIds).then((s=>{this.setExtentChangeRelatedWidgetIdsForView(t,r),i.zoomToUtils.zoomTo(t,s,e.zoomToOption)}))}else if("zoom-to-map-initial-extent"===e.type){const e=this.getMapBaseInitViewPoint();e&&(this.setExtentChangeRelatedWidgetIdsForView(t,r),t.goTo(e))}else if("zoom-to-features-extent"===e.type){const o=e.extent;if(o){let a=null;if("function"==typeof o)try{a=yield o()}catch(e){console.error("can not get extent by extent function",e)}else a=o;if("esri.geometry.Extent"===(null==a?void 0:a.declaredClass)){this.setExtentChangeRelatedWidgetIdsForView(t,r);const o=null===(s=e.zoomToOption)||void 0===s?void 0:s.scale;let n=null;"number"==typeof o&&o>=0&&(n={scale:o}),i.zoomToUtils.zoomTo(t,a,n)}}}else if("zoom-to-graphics"===e.type){const s=e.features||[];if(s.length>0||e.dataSourceId){const a=this.dsManager.getDataSource(e.dataSourceId);let n=null;a&&(a.layer?n=a.layer:a.createJSAPILayerByDataSource&&(n=yield a.createJSAPILayerByDataSource()));const l=yield function(e,t,s){return o(this,void 0,void 0,(function*(){return e&&"3d"===e.type&&t&&t.queryFeatures&&s?yield(0,i.loadArcGISJSAPIModules)(["esri/rest/support/Query"]).then((e=>{const[i]=e,a=new i;return a.returnGeometry=!0,a.outFields=["*"],a.objectIds=s.map((e=>e.attributes[t.objectIdField])),t.queryFeatures(a).then((e=>o(this,void 0,void 0,(function*(){return e&&e.features&&e.features.length===s.length?yield Promise.resolve(e.features):yield Promise.resolve(s)}))),(()=>o(this,void 0,void 0,(function*(){return yield Promise.resolve(s)}))))})):yield Promise.resolve(s)}))}(t,n,s);let p=null;p=n?{layer:n,graphics:l}:l,e.zoomToOption||(e.zoomToOption={}),this.setExtentChangeRelatedWidgetIdsForView(t,r),e.zoomToOption.queryParams=(null==a?void 0:a.getCurrentQueryParams)&&a.getCurrentQueryParams()||"",i.zoomToUtils.zoomTo(t,p,e.zoomToOption)}}this.props.onMutableStatePropsChanged(this.props.dataSourceId,"zoomToFeatureActionValue",null)}}))}handleActionForPanToActionValue(e,t){var s;if(!e.panToActionValue)return;const o=e.panToActionValue.relatedWidgets||[],a=null===(s=e.panToActionValue.value)||void 0===s?void 0:s.type;if(o&&o.includes(this.props.baseWidgetProps.id))this.props.onMutableStatePropsChanged(this.props.dataSourceId,"panToActionValue",null);else if("pan-to-query-params"===a){const i=e.panToActionValue.value;this.queryExtentFromQueryParams(t,i.filterChangedDataSourceIds,i.useDataSourceIds).then((e=>{var i,s,a;if(e.useDefaultExtentOfCurrentView){const n=(null===(s=null===(i=null==e?void 0:e.viewpoint)||void 0===i?void 0:i.camera)||void 0===s?void 0:s.position)||(null===(a=null==e?void 0:e.viewpoint)||void 0===a?void 0:a.targetGeometry);this.panToGeometry([n],t,o)}else this.panToGeometry([null==e?void 0:e.extent],t,o)}))}else if("pan-to-layer"===a){const s=e.panToActionValue.value,o=this.dsManager.getDataSource(s.dataSourceId);let a;a=(null==o?void 0:o.layer)?Promise.resolve(o.layer):(null==o?void 0:o.createJSAPILayerByDataSource)?o.createJSAPILayerByDataSource():Promise.resolve(null),a.then((e=>{let s=null;o&&o.getCurrentQueryParams&&(s=o.getCurrentQueryParams()),i.zoomToUtils.layerExtent(t,e,s).then((e=>{e&&this.panToGeometry([e],t,[])}))}))}else if("pan-to-layers"===a){b(e.panToActionValue.value.dataSourceIds).then((e=>{const s=[];e.forEach((e=>{e&&s.push(i.zoomToUtils.layerExtent(t,e))}));let o=null;return Promise.all(s).then((e=>{e.forEach((e=>{e&&(o=o?o.union(e):e)})),o&&this.panToGeometry([o],t,[])}))}))}else if("pan-to-geometries"===a){const i=e.panToActionValue.value;this.panToGeometry(i.geometries,t,o)}else if("pan-to-map-initial-extent"===a){const e=this.getMapBaseInitViewPoint();e&&(this.setExtentChangeRelatedWidgetIdsForView(t,o),t.goTo(e))}else if("pan-to-extent"===a){let i=!1;const s=Date.now();t.firstPublishExtentChangeTime&&s-t.firstPublishExtentChangeTime<=2e3&&t.firstPublishExtentChangeTime<=e.panToActionValue.value.publishTime&&I(this.props.baseWidgetProps.id,e.panToActionValue.value.publishWidgetId)&&(i=!0);let a=!1;if(t.lastZoomToExtentTime&&s-t.lastZoomToExtentTime<=500&&(a=!0),!i&&!a&&t!==H.lastInteractiveView){this.setExtentChangeRelatedWidgetIdsForView(t,o);const i=e.panToActionValue.value,s=i.geometries[0].center,a=i.stationary,n=t.spatialReference;p(s.spatialReference,n)?a&&y([s],n).then((e=>{const i=e[0];t.goTo(i)})):t.center=s}}this.props.onMutableStatePropsChanged(this.props.dataSourceId,"panToActionValue",null)}panToGeometry(e,t,i){y(e,t.spatialReference).then((e=>{this.setExtentChangeRelatedWidgetIdsForView(t,i),function(e,t){o(this,void 0,void 0,(function*(){const i=t,s=e;if(!(i instanceof Array)){if(i.geometry){const e=i.geometry;return h(s,w(e))}return h(s,w(i))}if(0!==i.length){if(!i[0].geometry)return d(i).then((e=>h(s,e.center)));{const e=[];for(let t=0;t<i.length;t++)e.push(i[t].geometry);yield d(e).then((e=>h(s,e.center)))}}else yield Promise.resolve()}))}(t,e)}))}handleActionForNewFeatureSetActionValue(e,t){if(e.newFeatureSetActionValue&&!e.newFeatureSetActionValue.promise){const i=function(e,t){return o(this,void 0,void 0,(function*(){const i=[];return t&&Object.keys(t).forEach((s=>{e.map.layers.find((e=>e.id===s))?console.warn("the feature layer is already created"):i.push(a(e,t[s],s))})),0===i.length?null:Promise.all(i)}))}(t,e.newFeatureSetActionValue.value);i?(this.props.onMutableStatePropsChanged(this.props.dataSourceId,"newFeatureSetActionValue.promise",i),i.then((()=>{this.props.onMutableStatePropsChanged(this.props.dataSourceId,"newFeatureSetActionValue",null)}))):this.props.onMutableStatePropsChanged(this.props.dataSourceId,"newFeatureSetActionValue",null)}}handleActionForChangedFeatureSetActionValue(e,t){e.changedFeatureSetActionValue&&(!function(e,t){o(this,void 0,void 0,(function*(){const i=[];return t&&Object.keys(t).forEach((s=>{const o=e.map.layers.find((e=>e.id===s));o&&(e.map.remove(o),i.push(a(e,t[s],s)))})),0===i.length?null:Promise.all(i)}))}(t,e.changedFeatureSetActionValue),this.props.onMutableStatePropsChanged(this.props.dataSourceId,"changedFeatureSetActionValue",null))}handleActionForSelectFeatureActionValue(e,t){if(e.selectFeatureActionValue){t.closePopup(),this.releaseHighLightHandles(t);const i=function(e,t,i){let s=i,o=null,a=null;if(s||(a=t instanceof Array?t[0]:t,a&&(s=a.layer&&a.layer.id)),s){const i=e.allLayerViews;for(let e=0;e<i.length;e++)i.getItemAt(e).layer.id===s&&(o=i.getItemAt(e));return o?{layerId:s,handle:o.highlight(t)}:null}}(t,e.selectFeatureActionValue);i&&(t.highLightHandles[i.layerId]=i.handle),setTimeout((()=>{this.props.onMutableStatePropsChanged(this.props.dataSourceId,"selectFeatureActionValue",null)}),500)}}handleActionForFlashActionValueAndFilterActionValue(e,s){Object.keys(e).some((a=>{var n;const r=s.dataSourceInfo.jimuMapViewId,l=i.MapViewManager.getInstance().getJimuMapViewById(r);return 0===a.indexOf("flashActionValue-")&&e[a]&&(e[a].querySQL&&v(l,e[a].layerDataSourceId,e[a].querySQL),this.props.onMutableStatePropsChanged(this.props.dataSourceId,a,null)),0===a.indexOf("filterActionValue-")&&e[a]&&((null===(n=e[a].querySQL)||void 0===n?void 0:n.length)>=0&&function(e,i,s){o(this,void 0,void 0,(function*(){if(!i)return;const o=t.DataSourceManager.getInstance().getDataSource(i);if(!o)return;let a=null;try{a=yield e.whenJimuLayerViewLoadedByDataSource(o)}catch(e){a=null,console.error("can't get jimuLayerView by dataSource",o,e)}const n=[t.JSAPILayerTypes.FeatureLayer,t.JSAPILayerTypes.SceneLayer,t.JSAPILayerTypes.BuildingComponentSublayer,t.JSAPILayerTypes.ImageryLayer,t.JSAPILayerTypes.OrientedImageryLayer,t.JSAPILayerTypes.SubtypeGroupLayer,t.JSAPILayerTypes.SubtypeSublayer];a&&a.layer&&n.includes(a.type)&&a.setDefinitionExpression&&a.setDefinitionExpression(s)}))}(l,e[a].layerDataSourceId,e[a].querySQL),this.props.onMutableStatePropsChanged(this.props.dataSourceId,a,null)),!1}))}handleActionForShowOnMapDatas(e,t){e.showOnMapDatas&&t.handleShowOnMapAction(e.showOnMapDatas)}handleActionForAddToMapDatas(e,t){e.addToMapDatas&&t.handleAddToMapAction(e.addToMapDatas)}}H.runtimeInitedJimuMapViews={};const z=H;var U=r(41496);class J extends t.React.PureComponent{constructor(e){super(e),this.getMapFixedLayout=()=>{if(window.jimuConfig.isInBuilder){const e=this.props.LayoutEntry,i=this.props.layouts&&this.props.layouts.MapFixedLayout;return(0,t.jsx)(e,{layouts:i||null,isInWidget:!0,className:(0,t.classNames)("w-100 h-100 map-fix-layout",{"widget-map-usemask":!S(this.props.appMode),"map-is-live-mode":S(this.props.appMode)})})}{const e=this.props.layouts&&this.props.layouts.MapFixedLayout;return(0,t.jsx)(U.LayoutEntry,{layouts:e?(0,t.Immutable)(e):null,className:"w-100 h-100 map-is-live-mode map-fix-layout"})}},this.state={}}render(){return this.getMapFixedLayout()}}class G extends t.React.PureComponent{}class _ extends t.React.PureComponent{constructor(){super(...arguments),this.moveY=0,this.startY=0,this.isRegisted=!1,this.registerTouchEvent=e=>{e&&!this.isRegisted&&(e.addEventListener("touchstart",(e=>{this.moveY=0;const t=e.touches[0];this.startY=t.clientY}),{passive:!1}),e.addEventListener("touchmove",(t=>{const i=t.touches[0];this.moveY=-1*(i.clientY-this.startY),this.startY=i.clientY,e.scrollTop=e.scrollTop+this.moveY}),{passive:!1}),e.addEventListener("touchend",(e=>{this.moveY=0,this.startY=0}),{passive:!1}),this.isRegisted=!0)}}getStyle(){return t.css`
      overflow: auto;
      pointer-events: auto;
      `}render(){return(0,t.jsx)("div",{css:this.getStyle(),className:this.props.className,style:this.props.style,ref:e=>{this.registerTouchEvent(e)}},this.props.children)}}class $ extends t.React.PureComponent{componentWillUnmount(){this.props.onDestroyed&&this.props.onDestroyed()}render(){return t.React.createElement(t.React.Fragment,null,this.props.children)}}const K=r(91340),q=r(60670);class Z extends G{constructor(e){super(e),this.toolName=null,this.isContainedToMobilePanel=!1,this.generation=0,this.exbMapUiExpandContentRef=t.React.createRef(),this._onKeyDown=e=>{var t;"Enter"!==e.key&&" "!==e.key||((null===(t=this.props.activeToolInfo)||void 0===t?void 0:t.activeToolName)!==this.toolName?this._onIconClick():this.focusDefaultElement())},this._getContent=()=>this.props.toolJson.isOnlyExpanded?(0,t.jsx)("div",{css:this._cssStyle(),className:"exbmap-ui exbmap-ui-tool-panel"},(0,t.jsx)(t.ErrorBoundary,null,this.getExpandPanel())):this.props.isMobile?this._renderMobileTool():this._renderPCTool(),this.onResize=({width:e,height:t})=>{e&&t&&(this.generation=t,this.forceUpdate())},this.onMouseOverPopper=()=>{this.props.onMouseOverPopper&&this.props.onMouseOverPopper()},this.onMouseOutPopper=()=>{this.props.onMouseOutPopper&&this.props.onMouseOutPopper()},this.handleToggleMobilePanel=()=>{this.props.onActiveToolInfoChange(null)};const i=this.props.jimuMapView&&this.props.jimuMapView.view&&this.props.jimuMapView.view.container;s.MobilePanelManager.getInstance().checkDomIsContained(i)&&(this.isContainedToMobilePanel=!0),this.shiftOptions={boundary:i},this.flipOptions={padding:0},this._onKeyDown=this._onKeyDown.bind(this),this.onPopperToggle=this.onPopperToggle.bind(this)}_cssStyle(){const e=this.getExtendCssStyle();return t.css`
      .exbmap-basetool-loader {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        width: 100%;
        animation: esri-fade-in 500ms ease-in-out;
      }

      .exbmap-basetool-loader:before {
        background-color: rgba(110,110,110,0.3);
        width: 100%;
        z-index: 0;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }

      .exbmap-basetool-loader:after {
        background-color: #6e6e6e;
        width: 20%;
        z-index: 0;
        animation: looping-progresss-bar-ani 1500ms linear infinite;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }

      ${e}

      /* pointer-events: auto;
      box-shadow: 0 1px 2px rgba(0,0,0,0.3);
      position: relative;

      .exbmap-ui-tool-icon {
        fill: black;
        left: 8px;
        top: 8px;
        position: absolute;
        display: block;
      }

      .exbmap-ui-expand-content {
        transition: opacity 250ms ease-in-out, margin 250ms ease-in-out;
        min-height: 10px;
        min-width: 10px;
        padding-top: ${t.polished.rem(10)};
        padding-bottom: ${t.polished.rem(10)};
        padding-left: ${t.polished.rem(20)};
        padding-right: ${t.polished.rem(20)};

        .exbmap-ui-expand-content-header {
          margin-bottom: ${t.polished.rem(10)};
        }

        .panel-title {
          font-size: ${t.polished.rem(16)};
          color: #000000;
        }
      }

      .expand-placement-bottom {
        padding-top: 0.25rem !important;
      }

      .expand-placement-left {
        padding-right: 0.25rem !important;
      }

      .expand-placement-right {
        padding-left: 0.25rem !important;
      }

      .expand-placement-top {
        padding-bottom: 0.25rem !important;
      }

      .exbmap-basetool-loader {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        width: 100%;
        animation: esri-fade-in 500ms ease-in-out;
      }

      .exbmap-basetool-loader:before {
        background-color: rgba(110,110,110,0.3);
        width: 100%;
        z-index: 0;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }

      .exbmap-basetool-loader:after {
        background-color: #6e6e6e;
        width: 20%;
        z-index: 0;
        animation: looping-progresss-bar-ani 1500ms linear infinite;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      } */
    `}getExtendCssStyle(){return""}focusDefaultElement(){}onShowPanel(){}onClosePanel(){}destroy(){}static getIsNeedSetting(){return!0}static isAvailable(e){return!0}onPopperToggle(e){e&&"keydown"===e.type&&"Escape"===e.key&&(this._onIconClick(),(0,t.focusElementInKeyboardMode)(this.iconContainer))}_onIconClick(e){const t=this.getIcon()&&this.getIcon().onIconClick;t&&t(e),this.getExpandPanel()&&(this.props.activeToolInfo&&this.props.activeToolInfo.activeToolName===this.toolName?this.props.onActiveToolInfoChange(null):(this.props.onActiveToolInfoChange({activeToolName:this.toolName,activeToolTitle:this.getTitle()}),this.onShowPanel()))}_initIconContainer(e){e&&!this.iconContainer&&(this.iconContainer=e,this.forceUpdate())}_renderPCTool(){var e;let i=this.getIcon();i||(i={icon:K,onIconClick:()=>null});const o=this.getExpandPanel(),a=this.props.activeToolInfo&&this.props.activeToolInfo.activeToolName;this.generation=this.generation+1;const n=this.getTitle()||"",r=this.props.toolJson.isShowIconTitle?n:"";return(0,t.jsx)("div",{className:"exbmap-ui exbmap-ui-tool",css:this._cssStyle(),style:{width:"32px",height:"32px"}},(0,t.jsx)("div",{style:{},ref:e=>{this._initIconContainer(e)},className:(0,t.classNames)("exbmap-ui-tool esri-widget--button",{"exbmap-ui-tool-icon-selected":this.toolName===a&&o}),title:r,"aria-label":r,onClick:e=>{this._onIconClick(e)},"aria-expanded":(null===(e=this.props.activeToolInfo)||void 0===e?void 0:e.activeToolName)===this.toolName,role:"button",tabIndex:0,onKeyDown:this._onKeyDown},(0,t.jsx)(s.Icon,{"aria-hidden":!0,width:16,height:16,className:"exbmap-ui-tool-icon",icon:i.icon})),this.iconContainer&&this.toolName===a&&o&&(0,t.jsx)($,{onDestroyed:()=>{this.onClosePanel()}},(0,t.jsx)(s.Popper,{className:"map-tool-popper exbmap-ui-popper",reference:this.iconContainer,open:!(this.toolName!==a||!o),placement:this.props.toolJson.panelPlacement,shiftOptions:this.shiftOptions,flipOptions:this.flipOptions,version:this.generation,offsetOptions:4,toggle:this.onPopperToggle,forceLatestFocusElements:!0,onMouseEnter:this.onMouseOverPopper,onMouseLeave:this.onMouseOutPopper},(0,t.jsx)(N.Consumer,null,(({mapWidgetHeight:e})=>(0,t.jsx)("div",{css:this._cssStyle(),className:this.getExpandPanelPlacementClassName()},(0,t.jsx)("div",{className:"exbmap-ui-expand-content",ref:this.exbMapUiExpandContentRef},(0,t.jsx)("div",{className:"w-100 justify-content-between d-flex exbmap-ui-expand-content-header"},(0,t.jsx)("div",{className:"panel-title text-truncate",style:{maxWidth:"210px"},title:n},n),(0,t.jsx)("div",{onClick:()=>{this.props.onActiveToolInfoChange(null)},style:{cursor:"pointer"},tabIndex:0,role:"button","aria-label":this.props.intl.formatMessage({id:"close",defaultMessage:"close"})},(0,t.jsx)(s.Icon,{width:20,height:20,icon:q}))),(0,t.jsx)(t.ErrorBoundary,null,(0,t.jsx)("div",{style:{maxHeight:e-55+"px",overflowY:"Search"!==this.toolName?"auto":"inherit"}},o)),(0,t.jsx)(t.ReactResizeDetector,{targetRef:this.exbMapUiExpandContentRef,handleHeight:!0,onResize:this.onResize}))))))))}_renderMobileTool(){let e=this.getIcon();e||(e={icon:K,onIconClick:()=>null});const i=this.getExpandPanel(),o=this.props.activeToolInfo&&this.props.activeToolInfo.activeToolName;return(0,t.jsx)(N.Consumer,null,(({mobilePanelContainer:a})=>(0,t.jsx)("div",{className:"exbmap-ui exbmap-ui-tool",css:this._cssStyle()},(0,t.jsx)("div",{style:{},ref:e=>{this.iconContainer=e},className:(0,t.classNames)("exbmap-ui-tool esri-widget--button",{"exbmap-ui-tool-icon-selected":this.toolName===o&&i}),role:"button",tabIndex:0,onKeyDown:this._onKeyDown,title:this.props.toolJson.isShowIconTitle?this.getTitle():"",onClick:e=>{this._onIconClick(e)}},(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:e.icon})),this.toolName===o&&i&&t.ReactDOM.createPortal((0,t.jsx)($,{onDestroyed:()=>{this.onClosePanel()}},(0,t.jsx)("div",{className:"w-100 h-100 d-flex flex-column",css:this._cssStyle()},(0,t.jsx)(_,{className:"w-100 h-100"},(0,t.jsx)(t.ErrorBoundary,null,this.getExpandPanel())))),a))))}getExpandPanelPlacementClassName(){return this.props.toolJson.panelPlacement?`expand-placement-${this.props.toolJson.panelPlacement.split("-")[0]}`:null}render(){return this._getContent()}}class Q extends t.React.PureComponent{constructor(e){super(e),this.Zoom=null,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/Zoom"]).then((e=>{[this.Zoom]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(){this.state.apiLoaded&&this.container&&(this.ZoomBtn&&(this.container.innerHTML=""),this.ZoomBtn=new this.Zoom({container:this.container,view:this.props.jimuMapView.view}),this.props.jimuMapView.deleteJimuMapTool("Zoom"),this.props.jimuMapView.addJimuMapTool({name:"Zoom",instance:this.ZoomBtn}))}componentWillUnmount(){this.ZoomBtn&&(this.ZoomBtn.destroy(),this.ZoomBtn=null,this.props.jimuMapView.deleteJimuMapTool("Zoom"))}getStyle(){return t.css`
      .esri-widget--button {
        appearance: none !important;
      }
    `}render(){return(0,t.jsx)("div",{className:"zoom-map-tool",css:this.getStyle(),ref:e=>{this.container=e}})}}var Y=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};class X extends t.React.PureComponent{constructor(e){super(e),this.Home=null,this.generateViewPointFromInitialMapState=e=>"2d"===e.viewType?new this.Viewpoint({targetGeometry:this.Extent.fromJSON(e.extent),rotation:e.rotation}):this.Viewpoint.fromJSON(e.viewPoint),this.homeBtnGoToOverride=(e,t)=>Y(this,void 0,void 0,(function*(){const i="2d"===e.type;let s=!1;i&&e.constraints&&!e.constraints.snapToZoom&&(e.constraints.snapToZoom=!0,s=!0);try{yield e.goTo(t.target,t.options)}catch(e){console.error("home btn goto error",e)}i&&e.constraints&&s&&(e.constraints.snapToZoom=!1)})),this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/Home","esri/geometry/Extent","esri/Viewpoint"]).then((e=>{[this.Home,this.Extent,this.Viewpoint]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(e){var t;if(!this.state.apiLoaded||!this.container)return;const i=(null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view)||null,s=((null==e?void 0:e.initialMapState)||null)!==(this.props.initialMapState||null);if(this.homeBtn&&(this.homeBtn.view!==i||s)&&this.destroyHomeBtn(),!this.homeBtn&&i){let e=this.props.initialMapState?this.generateViewPointFromInitialMapState(this.props.initialMapState):this.props.jimuMapView.view.map.initialViewProperties.viewpoint;e&&(e=e.clone());const t=document.createElement("div");this.container.appendChild(t),this.homeBtn=new this.Home({container:t,view:this.props.jimuMapView.view,viewpoint:e,goToOverride:this.homeBtnGoToOverride}),this.props.jimuMapView.deleteJimuMapTool("Home"),this.props.jimuMapView.addJimuMapTool({name:"Home",instance:this.homeBtn})}s&&i&&this.homeBtn&&this.homeBtn.go()}destroyHomeBtn(){this.homeBtn&&(this.homeBtn.destroy(),this.homeBtn=null,this.props.jimuMapView.deleteJimuMapTool("Home")),this.container&&(this.container.innerHTML="")}componentWillUnmount(){this.destroyHomeBtn()}getStyle(){return t.css`
      .esri-widget--button {
        appearance: none !important;
      }
    `}render(){return(0,t.jsx)("div",{className:"home-map-tool",css:this.getStyle(),ref:e=>{this.container||(this.container=e)}})}}class ee extends t.React.PureComponent{constructor(e){super(e),this.Compass=null,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/Compass"]).then((e=>{[this.Compass]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(){this.state.apiLoaded&&this.container&&(this.CompassBtn&&(this.container.innerHTML=""),this.CompassBtn=new this.Compass({container:this.container,view:this.props.jimuMapView.view}),this.props.jimuMapView.deleteJimuMapTool("Compass"),this.props.jimuMapView.addJimuMapTool({name:"Compass",instance:this.CompassBtn}))}componentWillUnmount(){this.CompassBtn&&(this.CompassBtn.destroy(),this.CompassBtn=null,this.props.jimuMapView.deleteJimuMapTool("Compass"))}render(){return t.React.createElement("div",{className:"compass-map-tool",ref:e=>{this.container=e}})}}class te extends t.React.PureComponent{constructor(e){super(e),this.Locate=null,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/Locate"]).then((e=>{[this.Locate]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(){this.state.apiLoaded&&this.container&&(this.LocateBtn&&(this.container.innerHTML=""),this.LocateBtn=new this.Locate({container:this.container,view:this.props.jimuMapView.view}),this.props.jimuMapView.deleteJimuMapTool("Locate"),this.props.jimuMapView.addJimuMapTool({name:"Locate",instance:this.LocateBtn}))}componentWillUnmount(){this.LocateBtn&&(this.LocateBtn.destroy(),this.LocateBtn=null,this.props.jimuMapView.deleteJimuMapTool("Locate"))}getStyle(){return t.css`
      .esri-widget--button {
        appearance: none !important;
      }
    `}render(){return(0,t.jsx)("div",{className:"locate-map-tool",css:this.getStyle(),ref:e=>{this.container=e}})}}class ie extends t.React.PureComponent{constructor(e){super(e),this.Navigation=null,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/NavigationToggle"]).then((e=>{[this.Navigation]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(){this.state.apiLoaded&&this.container&&(this.NavigationBtn&&(this.container.innerHTML=""),this.NavigationBtn=new this.Navigation({container:this.container,view:this.props.jimuMapView.view}),this.props.jimuMapView.deleteJimuMapTool("Navigation"),this.props.jimuMapView.addJimuMapTool({name:"Navigation",instance:this.NavigationBtn}))}componentWillUnmount(){this.NavigationBtn&&(this.NavigationBtn.destroy(),this.NavigationBtn=null,this.props.jimuMapView.deleteJimuMapTool("Navigation"))}render(){return t.React.createElement("div",{className:"navigation-map-tool",ref:e=>{this.container=e}})}}class se extends t.React.PureComponent{constructor(e){super(e),this.Search=null,this.Portal=null,this.updateSearchPopupEnabled=()=>{if(this.SearchBtn){const e=this.SearchBtn.view;e&&(this.SearchBtn.popupEnabled=!1!==e.popupEnabled)}},this.state={apiLoaded:!1}}getStyle(){return t.css`
      /* border: solid 1px rgba(110,110,110,0.3); */
    `}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/Search","esri/portal/Portal","esri/core/reactiveUtils"]).then((e=>{[this.Search,this.Portal,this.reactiveUtils]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(){if(this.state.apiLoaded&&this.container){if(this.SearchBtn){const e=this.container.parentElement;this.SearchBtn.destroy(),this.SearchBtn=null,!this.container.parentElement&&e&&e.appendChild(this.container),this.container.innerHTML=""}this.releasePopupEnabledWatchHandle();const e=this.props.jimuMapView.view;this.SearchBtn=new this.Search({container:this.container,view:e,portal:new this.Portal({url:(0,t.getAppStore)().getState().portalUrl})}),this.updateSearchPopupEnabled(),e&&(this.popupEnabledWatchHandle=this.reactiveUtils.watch((()=>null==e?void 0:e.popupEnabled),(()=>{this.updateSearchPopupEnabled()}))),this.props.jimuMapView.deleteJimuMapTool("Search"),this.props.jimuMapView.addJimuMapTool({name:"Search",instance:this.SearchBtn}),this.SearchBtn.on("select-result",(e=>{if(e.result.feature.layer){const i=e.result.feature.geometry;if("point"===i.type)t.MessageManager.getInstance().publishMessage(new t.LocationChangeMessage(this.props.mapWidgetId,i.toJSON()));else{const e=i.extent.center;t.MessageManager.getInstance().publishMessage(new t.LocationChangeMessage(this.props.mapWidgetId,e.toJSON()))}}else{const i=e.result.feature.geometry.toJSON();t.MessageManager.getInstance().publishMessage(new t.LocationChangeMessage(this.props.mapWidgetId,i))}}))}}componentWillUnmount(){this.SearchBtn&&(this.SearchBtn.destroy(),this.SearchBtn=null,this.props.jimuMapView.deleteJimuMapTool("Search")),this.releasePopupEnabledWatchHandle()}render(){return(0,t.jsx)("div",{css:this.getStyle(),className:"w-100 search-map-tool",ref:e=>{this.container=e}},!this.state.apiLoaded&&(0,t.jsx)("div",{className:"exbmap-basetool-loader"}))}releasePopupEnabledWatchHandle(){this.popupEnabledWatchHandle&&(this.popupEnabledWatchHandle.remove(),this.popupEnabledWatchHandle=null)}}class oe extends t.React.PureComponent{constructor(e){super(e),this.LayerList=null,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/LayerList"]).then((e=>{[this.LayerList]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(e){this.state.apiLoaded&&this.container&&(e.jimuMapView&&this.props.jimuMapView&&e.jimuMapView.id!==this.props.jimuMapView.id?this.LayerListBtn&&(this.LayerListBtn.view=this.props.jimuMapView.view,this.LayerListBtn.renderNow()):(this.LayerListBtn=new this.LayerList({container:this.container,view:this.props.jimuMapView.view}),this.props.jimuMapView.deleteJimuMapTool("LayerList"),this.props.jimuMapView.addJimuMapTool({name:"LayerList",instance:this.LayerListBtn})))}componentWillUnmount(){this.LayerListBtn&&(this.LayerListBtn=null,this.props.jimuMapView.deleteJimuMapTool("LayerList"))}getStyle(){return t.css`
      .esri-layer-list__item {
        background-color: var(--calcite-color-foreground-1);
      }
    `}render(){return(0,t.jsx)("div",{className:"layers-map-tool",ref:e=>{this.container=e},css:this.getStyle(),style:{width:"100%",minHeight:"32px",position:"relative"}},!this.state.apiLoaded&&(0,t.jsx)("div",{className:"exbmap-basetool-loader"}))}}class ae extends t.React.PureComponent{constructor(e){super(e),this.Legend=null,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/Legend"]).then((e=>{[this.Legend]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(e){this.state.apiLoaded&&this.container&&(e.jimuMapView&&this.props.jimuMapView&&e.jimuMapView.id!==this.props.jimuMapView.id?this.LegendBtn&&(this.LegendBtn.view=this.props.jimuMapView.view,this.LegendBtn.renderNow()):(this.LegendBtn=new this.Legend({container:this.container,view:this.props.jimuMapView.view}),this.props.jimuMapView.deleteJimuMapTool("Legend"),this.props.jimuMapView.addJimuMapTool({name:"Legend",instance:this.LegendBtn})))}componentWillUnmount(){this.LegendBtn&&(this.LegendBtn=null,this.props.jimuMapView.deleteJimuMapTool("Legend"))}render(){return(0,t.jsx)("div",{ref:e=>{this.container=e},style:{width:"100%",minHeight:"32px",position:"relative"}},!this.state.apiLoaded&&(0,t.jsx)("div",{className:"exbmap-basetool-loader"}))}}class ne extends t.React.PureComponent{constructor(e){super(e),this.__unmount=!1,this.state={apiLoaded:!1,sourceLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/BasemapGallery","esri/widgets/BasemapGallery/support/LocalBasemapsSource"]).then((e=>{this.__unmount||([this.BasemapGallery,this.LocalBasemapsSource]=e,this.setState({apiLoaded:!0}))})),this.state.sourceLoaded||i.basemapUtils.getOrgBasemaps().then((e=>{this.__unmount||(this.orgBasemaps=e,this.setState({sourceLoaded:!0}))})).catch((e=>{console.error(`load basemap gallery source error: ${e}`)}))}componentDidUpdate(e){if(this.state.apiLoaded&&this.state.sourceLoaded&&this.container)if(this.basemapGallery){e.jimuMapView&&this.props.jimuMapView&&e.jimuMapView.id!==this.props.jimuMapView.id&&(this.basemapGallery.view=this.props.jimuMapView.view,this.basemapGallery.source=this.getFinalBasemapGallerySource(this.orgBasemaps,this.basemapGallery),this.basemapGallery.renderNow())}else this.basemapGallery=new this.BasemapGallery({container:this.container,view:this.props.jimuMapView.view}),this.basemapGallery.source=this.getFinalBasemapGallerySource(this.orgBasemaps,this.basemapGallery),this.props.jimuMapView.deleteJimuMapTool("BaseMap"),this.props.jimuMapView.addJimuMapTool({name:"BaseMap",instance:this.basemapGallery})}getFinalBasemapGallerySource(e,t){var s;let o=[];const a=t.view;if(a){o="2d"===a.type?e.filter((e=>!i.basemapUtils.isBasemap3D(e))):e.slice();const n=a.map.originalBasemap||a.map.basemap,r=t.viewModel;if(n&&r){if(!o.some((e=>r.basemapEquals(n,e)))){if(!n.thumbnailUrl){const e=null===(s=a.map)||void 0===s?void 0:s.thumbnailUrl;e&&(n.thumbnailUrl=e)}o.unshift(n)}}}return new this.LocalBasemapsSource({basemaps:o})}componentWillUnmount(){this.__unmount=!0,this.basemapGallery&&(this.basemapGallery.destroy(),this.basemapGallery=null,this.props.jimuMapView.deleteJimuMapTool("BaseMap"))}render(){return this.props.isMobile?t.React.createElement("div",{className:"basemap-map-tool",ref:e=>{this.container=e},style:{width:"100%",minHeight:"32px",maxWidth:"none",maxHeight:"none",overflowY:"auto",position:"relative"}},!this.state.apiLoaded&&t.React.createElement("div",{className:"exbmap-basetool-loader"})):t.React.createElement("div",{ref:e=>{this.container=e},style:{width:"250px",minHeight:"32px",position:"relative"},className:"exbmap-ui-pc-expand-maxheight basemap-map-tool"},!this.state.apiLoaded&&t.React.createElement("div",{className:"exbmap-basetool-loader"}))}}var re=r(53089),le=r.n(re),pe=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const ce=e=>{const i=window.SVG,{className:s}=e,o=pe(e,["className"]),a=(0,t.classNames)("jimu-icon jimu-icon-component",s);return i?t.React.createElement(i,Object.assign({className:a,src:le()},o)):t.React.createElement("svg",Object.assign({className:a},o))};class he extends t.React.PureComponent{constructor(e){super(e),this.unmount=!1,this.setMapThumbUrl=e=>{var i;e||this.setState({mapThumbUrl:null});const s=(null===(i=this.props)||void 0===i?void 0:i.portUrl)||(0,t.getAppStore)().getState().portalUrl,o=t.SessionManager.getInstance().getSessionByUrl(s)||null;t.esri.restPortal.searchItems({q:`id:${e}`,authentication:o,portal:s+"/sharing/rest"}).then((e=>{var i;if(!this.unmount)if(null===(i=e.results[0])||void 0===i?void 0:i.thumbnail){const i=t.SessionManager.getInstance().getSessionByUrl(s);let o=null;o=i&&i.token?`${s}/sharing/rest/content/items/${e.results[0].id}/info/${e.results[0].thumbnail}?token=${i.token}`:`${s}/sharing/rest/content/items/${e.results[0].id}/info/${e.results[0].thumbnail}`,this.setState({mapThumbUrl:o})}else this.setState({mapThumbUrl:null})}))},this.state={mapThumbUrl:null}}componentDidMount(){this.unmount=!1,this.setMapThumbUrl(this.props.mapItemId)}componentDidUpdate(e,t){e.mapItemId!==this.props.mapItemId&&this.setMapThumbUrl(this.props.mapItemId)}componentWillUnmount(){this.unmount=!0}render(){var e;const i=(null===(e=this.props)||void 0===e?void 0:e.label)||"";if(this.state.mapThumbUrl)return t.React.createElement(s.ImageWithParam,{imageParam:{url:this.state.mapThumbUrl},altText:i});{const e=this.props.theme;return t.React.createElement("div",{style:{backgroundColor:e.ref.palette.neutral[300],height:"100%"}},t.React.createElement(ce,{color:e.ref.palette.neutral[600],size:"100%"}))}}}const de={_widgetLabel:"Map",_action_displayFeatureSet_label:"Display feature set",_action_panTo_label:"Pan to",_action_zoomToFeature_label:"Zoom to",_action_selectFeature_label:"Select feature",_action_flash_label:"Flash",_action_filter_label:"Filter",_action_showOnMap_label:"Show on map",_action_addToMap_label:"Add to map",_action_showPopup_label:"Show pop-up",showOnMapData:"Show on map data",addedData:"added data",failToAddTheDataOnMap:"Fail to add the data.",addToMapData:"Add to map data",mapCurrentRecord:"{layerName} map current record",switchTo:"Switch to {webMapName}",_url_params_viewpoint_label:"Viewpoint",_url_params_viewpoint_tooltip:"Viewpoint describes the point of view for a web map or web scene.",_url_params_center_label:"Center",_url_params_scale_label:"Scale",_url_params_rotation_label:"Rotation",_url_params_layer_visibility_label:"Layer visibility"};class ue extends t.React.PureComponent{constructor(e){super(e),this.ScaleBar=null,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/ScaleBar"]).then((e=>{[this.ScaleBar]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(){if(this.state.apiLoaded&&this.container){this.ScaleBarBtn&&(this.container.innerHTML="");let e="";const i=(0,t.getAppStore)().getState();i&&(i.user&&i.user.units?e=i.user.units:i.portalSelf&&i.portalSelf.units&&(e=i.portalSelf.units));let s=null;s="metric"===e?"metric":"english"===e?"imperial":"dual",this.ScaleBarBtn=new this.ScaleBar({container:this.container,view:this.props.jimuMapView.view,unit:s}),this.props.jimuMapView.deleteJimuMapTool("ScaleBar"),this.props.jimuMapView.addJimuMapTool({name:"ScaleBar",instance:this.ScaleBarBtn})}}componentWillUnmount(){this.ScaleBarBtn&&(this.ScaleBarBtn.destroy(),this.ScaleBarBtn=null,this.props.jimuMapView.deleteJimuMapTool("ScaleBar"))}render(){return t.React.createElement("div",{className:"scalebar-map-tool",ref:e=>{this.container=e}})}}class me extends t.React.PureComponent{constructor(e){super(e),this.Attribution=null,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/Attribution"]).then((e=>{[this.Attribution]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(e){this.state.apiLoaded&&this.container&&(e.jimuMapView&&this.props.jimuMapView&&e.jimuMapView.id!==this.props.jimuMapView.id?this.AttributionBtn&&!this.AttributionBtn.destroy&&(this.AttributionBtn.view=this.props.jimuMapView.view,this.AttributionBtn.renderNow(),this.props.jimuMapView.addJimuMapTool({name:"Attribution",instance:this.AttributionBtn})):(this.AttributionBtn=new this.Attribution({container:this.container,view:this.props.jimuMapView.view}),this.props.jimuMapView.deleteJimuMapTool("Attribution"),this.props.jimuMapView.addJimuMapTool({name:"Attribution",instance:this.AttributionBtn})))}componentWillUnmount(){this.AttributionBtn&&(this.AttributionBtn.destroy(),this.AttributionBtn=null,this.props.jimuMapView.deleteJimuMapTool("Attribution"))}render(){return t.React.createElement("div",{className:"attribution-map-tool",style:{position:"relative"},ref:e=>{this.container=e}})}}class ge extends t.React.PureComponent{constructor(e){super(e),this.toolName="measurement",this.checkContainer=()=>{"0"!==this.container.style.opacity&&0!==this.container.style.opacity||(this.container.style.opacity=1,this.container.style.height="")},this.id=`${this.props.mapWidgetId}-measure-tool`,this.state={apiLoaded:!1}}componentDidMount(){this.state.apiLoaded||(0,i.loadArcGISJSAPIModules)(["esri/widgets/Measurement","esri/core/reactiveUtils"]).then((e=>{[this.MeasureClass,this.reactiveUtils]=e,this.setState({apiLoaded:!0})}))}componentDidUpdate(e){if(this.state.apiLoaded&&this.parentContainer&&this.container){if(this.props.measureInstance){const e=this.props.jimuMapView;this.props.measureInstance.view!==e.view&&(this.restoreClickHighlightEnabledForCurrentJimuMapView(),this.setCurrentJimuMapView(e),this.props.measureInstance.clear(),this.props.measureInstance.view=e.view,this.props.measureInstance.activeTool=this.props.measureModule.activeTool,ve(e,this.props.measureInstance,this.reactiveUtils))}else{const e=this.props.jimuMapView,i=new this.MeasureClass({container:this.container,view:e.view});i.activeTool=this.props.measureModule.activeTool,this.setCurrentJimuMapView(e),this.currentJimuMapView.deleteJimuMapTool(this.toolName),this.currentJimuMapView.addJimuMapTool({name:this.toolName,instance:i}),this.props.onMeasurceInstanceCreated(i),ve(e,i,this.reactiveUtils);const s=t.appActions.requestAutoControlMapWidget(this.props.mapWidgetId,this.id);(0,t.getAppStore)().dispatch(s)}this.checkContainer()}((null==e?void 0:e.autoControlWidgetId)||"")===this.id&&this.props.autoControlWidgetId!==this.id&&this.props.onRequestClosePanel()}componentWillUnmount(){if(this.restoreClickHighlightEnabledForCurrentJimuMapView(),this.props.autoControlWidgetId===this.id){const e=t.appActions.releaseAutoControlMapWidget(this.props.mapWidgetId);(0,t.getAppStore)().dispatch(e)}}setCurrentJimuMapView(e){this.currentJimuMapView=e,this.originalClickHighlightEnabled=e.isClickHighlightEnabled(),this.currentJimuMapView.disableClickHighlight()}restoreClickHighlightEnabledForCurrentJimuMapView(){this.currentJimuMapView&&(this.originalClickHighlightEnabled?this.currentJimuMapView.enableClickHighlight():this.currentJimuMapView.disableClickHighlight())}render(){return t.React.createElement("div",{className:"w-100",style:{width:"250px",position:"relative",minHeight:"32px"},ref:e=>{this.parentContainer=e}},t.React.createElement("div",{className:"measure-container measure-map-tool",ref:e=>{this.container=e}}),!this.state.apiLoaded&&t.React.createElement("div",{className:"exbmap-basetool-loader"}))}}function ve(e,t,i){t&&(fe(t),t.activeWidget&&we(e,t),t._exbWatchActiveWidgetHandle=i.watch((()=>null==t?void 0:t.activeWidget),(()=>{(null==t?void 0:t.activeWidget)&&we(e,t)})))}function we(e,t){if(!e||!t)return;const i=t.activeWidget;if(!i)return;if(!["esri.widgets.AreaMeasurement2D","esri.widgets.DistanceMeasurement2D"].includes(i.declaredClass))return;let s=e.view===t.view?e.getSnappingLayers():[];s||(s=[]);const o=s.map((e=>({layer:e,enabled:!0})));i.snappingOptions={enabled:!0,distance:10,featureEnabled:!0,featureSources:o,gridEnabled:!1,selfEnabled:!1}}function fe(e){const t=e,i=t._exbWatchActiveWidgetHandle;i&&(i.remove(),t._exbWatchActiveWidgetHandle=null)}class ye extends t.React.PureComponent{constructor(e){super(e),this.state={}}getStyle(){const e="dark"===this.props.theme.sys.color.mode?"black":"white";return t.css`
      position: relative;

      .select-circle-progress {
        position: absolute;
        left: 6px;
        top: 6px;

        .progress-circle-bg {
          stroke: ${e};
          opacity: 0.3;
        }

        .progress-circle-progress {
          stroke: ${e};
          transition: none !important;
        }
      }

      .progress-stop {
        width: 6px;
        height: 6px;
        background: ${e};
      }

      .progress-mask {
        position: absolute;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: transparent;
      }
    `}render(){var e;const i=100*this.props.progress,o=parseFloat(i.toFixed(2)),a=s.defaultMessages.selectingFeaturesTip,n=(null===(e=this.props.intl)||void 0===e?void 0:e.formatMessage({id:"selectingFeaturesTip",defaultMessage:a}))||a;return(0,t.jsx)("button",{css:this.getStyle(),onClick:this.props.onClick,className:"esri-widget--button  border-0 select-tool-btn d-flex align-items-center justify-content-center active select-progress"},(0,t.jsx)(s.Progress,{className:"select-circle-progress",color:this.props.theme.ref.palette.neutral[200],type:"circular",value:o,circleSize:20}),(0,t.jsx)("div",{className:"progress-stop"}),(0,t.jsx)("div",{className:"progress-mask",title:n}))}}var Me=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};const Se={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},be={tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},xe={style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}},Ie=r(99973),Ce=r(10272),Te=r(50045),Ve=r(88721),Pe=r(22459),Le=r(20561),De=r(4583);class Ae extends t.React.PureComponent{constructor(e){var i,s;super(e),this.currentActiveTool="rectangle",this.jsonUtils=null,this.resultGraphics=[],this.toggleIsSelectActive=()=>{this.setState({isActive:!this.state.isActive})},this.toggleSelectTypePopup=()=>{this.setState({isShowSelectTypePopup:!this.state.isShowSelectTypePopup})},this.onClickLoadingProgress=()=>{const e=this.activeJimuMapView;if(e){const t=!0;e.cancelSelectByQuery(t)}},this.clearSelect=()=>Me(this,void 0,void 0,(function*(){const e=this.props.jimuMapView;if(e){try{const t=!1;yield e.cancelSelectByQuery(t)}catch(t){console.error(`jimuMapView.cancelSelectByQuery() error, jimuMapViewId: ${e.id}`,t)}setTimeout((()=>{e.clearSelectedFeatures()}),200)}})),this.getSelectToolIcon=()=>"Point"===this.state.currentSelectType?Le:"Rectangle"===this.state.currentSelectType?Ce:"Lasso"===this.state.currentSelectType?Te:"Circle"===this.state.currentSelectType?Ve:"Line"===this.state.currentSelectType?Pe:Ce,this.setCurrentSelectType=e=>{this.initialSketchTool(),"Point"===e&&(this.setActiveToolForSketchViewModel("point"),this.currentActiveTool="point"),"Rectangle"===e&&(this.setActiveToolForSketchViewModel("rectangle"),this.currentActiveTool="rectangle"),"Lasso"===e&&(this.setActiveToolForSketchViewModel("polygon"),this.currentActiveTool="polygon"),"Circle"===e&&(this.setActiveToolForSketchViewModel("circle"),this.currentActiveTool="circle"),"Line"===e&&(this.setActiveToolForSketchViewModel("polyline"),this.currentActiveTool="polyline"),this.setState({currentSelectType:e,isShowSelectTypePopup:!1,isActive:!0})},this.onJimuMapViewSelectProgressChange=e=>{this.setState({selectProgress:e})},this.onKeyDown=e=>{"Shift"===e.key?this.lastShiftKeyEventInfo={eventDate:new Date,isKeyDown:!0}:(this.isMac&&"Meta"===e.key||!this.isMac&&"Control"===e.key)&&(this.lastCtrlKeyEventInfo={eventDate:new Date,isKeyDown:!0})},this.onKeyUp=e=>{"Shift"===e.key?this.lastShiftKeyEventInfo={eventDate:new Date,isKeyDown:!1}:(this.isMac&&"Meta"===e.key||!this.isMac&&"Control"===e.key)&&(this.lastCtrlKeyEventInfo={eventDate:new Date,isKeyDown:!1})},this.onPopperToggle=e=>{this.toggleSelectTypePopup(),e&&"keydown"===e.type&&"Escape"===e.key&&(0,t.focusElementInKeyboardMode)(this.btnSelectTypeContainer)},this.handleKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||this.setCurrentSelectType(t)},this.isMac="macOS"===(null===(s=null===(i=window.jimuUA)||void 0===i?void 0:i.os)||void 0===s?void 0:s.name),this.id=`${this.props.mapWidgetId}-select-tool`,this.sketChCreateOptions={polygon:{mode:"hybrid"}},this.state={sketchInitialed:!1,isActive:!1,isShowSelectTypePopup:!1,currentSelectType:"Rectangle",spatialRelationship:"intersects",selectProgress:0},this.bindShiftCtrlKeysEventListeners()}getCSSStyle(){const e=this.props.theme,i=e.arcgis.components.button.variants.default.default.bg,s=e.arcgis.components.button.variants.default.default.border;return t.css`
      .select-tool-container {
        ${i&&`background-color: ${i};`}
        ${s&&`border: ${s.color} ${s.width} solid;`}
      }

      .select-tool-btn {
        width: 32px;
        height: 32px;
      }

      .content-bg {
        background-color: ${e.ref.palette.neutral[200]};
      }

      .content-title {
        font-size: ${t.polished.rem(13)};
        font-weight: bold;
      }

      .select-tool-type-mobile-container-shell {
        overflow-x: auto;
      }

      .select-tool-type-mobile-container-shell::-webkit-scrollbar {
        height: 0 !important;
        display: none;
      }

      .select-tool-type-mobile-container {
        width: 400px;
      }

      .select-tool-type {
        width: 64px;
        height: 64px;
        border: 1px solid ${e.ref.palette.neutral[500]};
        cursor: pointer;
      }

      .select-tool-type-choosed {
        border: 1px solid ${e.sys.color.primary.main};
        position: relative;
      }

      .select-tool-type-choosed:after {
        width: 0;
        height: 0;
        border-top: 8px solid ${e.sys.color.primary.main};
        border-left: 8px solid transparent;
        position: absolute;
        top: 0;
        right: 0;
        content: "";
      }

      .select-tool-type-text {
        font-size: ${t.polished.rem(12)};
      }

      .select-tool-loader {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        width: 100%;
        animation: esri-fade-in 500ms ease-in-out;
      }

      .select-tool-loader:before {
        background-color: rgba(110,110,110,0.3);
        width: 100%;
        z-index: 0;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }

      .select-tool-loader:after {
        background-color: ${e.sys.color.primary.main};
        width: 20%;
        z-index: 0;
        animation: looping-progresss-bar-ani 1500ms linear infinite;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }
    `}componentDidMount(){this.state.sketchInitialed||(0,i.loadArcGISJSAPIModules)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/rest/support/Query","esri/symbols/support/jsonUtils","esri/geometry/geometryEngine","esri/views/2d/interactive/editingTools","esri/views/3d/interactive/editingTools","esri/views/2d/layers/GraphicsLayerView2D","esri/views/3d/layers/GraphicsLayerView3D"]).then((e=>{[this.SketchViewModel,this.GraphicsLayer,this.Query,this.jsonUtils,this.geometryEngine]=e,this.props.jimuMapView.view.when((()=>{this.initialSketchTool(),this.setState({sketchInitialed:!0})}))}))}componentDidUpdate(e,t){return t.sketchInitialed!==this.state.sketchInitialed&&this.state.sketchInitialed?(this.initialSketchTool(),void(this.state.isActive&&this.currentActiveTool&&this.setActiveToolForSketchViewModel(this.currentActiveTool))):e.jimuMapView&&this.props.jimuMapView&&e.jimuMapView.id!==this.props.jimuMapView.id&&this.state.sketchInitialed?(this.destroySketchViewModelAndReleaseHandles(),this.initialSketchTool(),void(this.state.isActive&&this.currentActiveTool&&this.setActiveToolForSketchViewModel(this.currentActiveTool))):(t.isActive!==this.state.isActive&&(this.initialSketchTool(),this.state.isActive?this.setActiveToolForSketchViewModel(this.currentActiveTool):this.destroySketchViewModelAndReleaseHandles()),this.tryUpdateActiveToolInfoWhenStateChange(t),void this.tryUpdateActiveToolInfoWhenPropsChange(e))}tryUpdateActiveToolInfoWhenStateChange(e){if(!e)return;const t=!(!e.isActive&&!e.isShowSelectTypePopup),i=!(!this.state.isActive&&!this.state.isShowSelectTypePopup);!t&&i?this.setCurrentToolAsActiveTool():t&&!i&&(this.setState({isActive:!1,isShowSelectTypePopup:!1}),this.setActiveToolToNull())}tryUpdateActiveToolInfoWhenPropsChange(e){var t,i;let s=!1;const o=(null===(t=null==e?void 0:e.activeToolInfo)||void 0===t?void 0:t.activeToolName)||"",a=(null===(i=this.props.activeToolInfo)||void 0===i?void 0:i.activeToolName)||"";if(o!==a){const e=this.props.toolName;o===e&&!(a===e)&&(s=!0)}e.autoControlWidgetId===this.id&&this.props.autoControlWidgetId&&this.props.autoControlWidgetId!==this.id&&(s=!0),s&&(this.state.isActive||this.state.isShowSelectTypePopup)&&this.setState({isActive:!1,isShowSelectTypePopup:!1})}componentWillUnmount(){this.destroySketchViewModelAndReleaseHandles(),this.releaseShiftCtrlKeysEventListeners()}destroySketchViewModelAndReleaseHandles(){if(this.releaseViewHandles(),this.sketchViewModel&&(this.sketchViewModel.destroy(),this.sketchViewModel=null),this.activeJimuMapView=null,this.props.autoControlWidgetId===this.id){const e=t.appActions.releaseAutoControlMapWidget(this.props.mapWidgetId);(0,t.getAppStore)().dispatch(e)}}releaseViewHandles(){this.activeJimuMapView&&this.activeJimuMapView.removeSelectByQueryProgressChangeListener(this.onJimuMapViewSelectProgressChange),this.viewKeyDownHandle&&(this.viewKeyDownHandle.remove(),this.viewKeyDownHandle=null),this.viewKeyUpHandle&&(this.viewKeyUpHandle.remove(),this.viewKeyUpHandle=null)}setCurrentToolAsActiveTool(){this.isSelectIsActiveTool()||this.props._onIconClick()}setActiveToolToNull(){this.isSelectIsActiveTool()&&this.props._onIconClick()}isSelectIsActiveTool(){var e;return this.props.toolName&&this.props.toolName===(null===(e=this.props.activeToolInfo)||void 0===e?void 0:e.activeToolName)}getSelectIconTitle(){let e="";e="Point"===this.state.currentSelectType?this.formatMessage("SelectionByPoint"):"Rectangle"===this.state.currentSelectType?this.formatMessage("SelectionByRectangle"):"Lasso"===this.state.currentSelectType?this.formatMessage("SelectionByLasso"):"Circle"===this.state.currentSelectType?this.formatMessage("SelectionByCircle"):"Line"===this.state.currentSelectType?this.formatMessage("SelectionByLine"):this.formatMessage("SelectLabel");const t=this.formatMessage("newSelection"),i=this.formatMessage("addToCurrentSelection"),s=this.formatMessage("removeFromCurrentSelection"),o=this.formatMessage("selectFromCurrentSelection"),a=this.formatMessage("drawShape"),n=this.formatMessage("draw"),r=this.isMac?"Cmd":"Ctrl";return`${e}\n${`\u2219 ${t} (${a})`}\n${`\u2219 ${i} (Shift + ${n})`}\n${`\u2219 ${s} (${r} + ${n})`}\n${`\u2219 ${o} (Shift + ${r} + ${n})`}\n    `}formatMessage(e){return this.props.intl.formatMessage({id:e,defaultMessage:s.defaultMessages[e]})}useShiftKey(e){return this.useKey(this.lastShiftKeyEventInfo,e)}useCtrlKey(e){return this.useKey(this.lastCtrlKeyEventInfo,e)}useKey(e,t){if(e){if(e.isKeyDown)return!0;return Date.now()-e.eventDate.getTime()<=t}return!1}bindShiftCtrlKeysEventListeners(){document.addEventListener("keydown",this.onKeyDown,!0),document.addEventListener("keyup",this.onKeyUp,!0)}releaseShiftCtrlKeysEventListeners(){document.removeEventListener("keydown",this.onKeyDown,!0),document.removeEventListener("keyup",this.onKeyUp,!0)}initialSketchTool(){if(this.SketchViewModel&&!this.sketchViewModel){this.releaseViewHandles();const e=this.props.jimuMapView;this.activeJimuMapView=e,this.activeJimuMapView.addSelectByQueryProgressChangeListener(this.onJimuMapViewSelectProgressChange);const i=e.view;this.viewKeyDownHandle=i.on("key-down",(e=>{"Shift"===e.key&&e.stopPropagation()})),this.viewKeyDownHandle=i.on("key-up",(e=>{"Shift"===e.key&&e.stopPropagation()})),this.sketchViewModel=new this.SketchViewModel({view:i,layer:new this.GraphicsLayer,pointSymbol:this.jsonUtils.fromJSON(Se),polylineSymbol:this.jsonUtils.fromJSON(be),polygonSymbol:this.jsonUtils.fromJSON(xe)}),this.sketchViewModel.on("create",(e=>{if("complete"===e.state){this.setActiveToolForSketchViewModel(this.currentActiveTool);const i=this.props.jimuMapView;i.view.closePopup();const s=e.graphic;if(!s)return void console.log("sketch graphic is null");if(!s.geometry)return void console.log("sketch graphic.geometry is null");const o=500,a=this.useShiftKey(o),n=this.useCtrlKey(o);let r=t.DataSourceSelectionMode.New;r=a?n?t.DataSourceSelectionMode.SelectFromCurrent:t.DataSourceSelectionMode.AddToCurrent:n?t.DataSourceSelectionMode.RemoveFromCurrent:t.DataSourceSelectionMode.New,i.selectFeaturesByGraphic(s,this.state.spatialRelationship,r)}}))}}setActiveToolForSketchViewModel(e){if(this.sketchViewModel){const i=this.sketChCreateOptions[e];if(i?this.sketchViewModel.create(e,i):this.sketchViewModel.create(e),this.props.autoControlWidgetId!==this.id){const e=t.appActions.requestAutoControlMapWidget(this.props.mapWidgetId,this.id);(0,t.getAppStore)().dispatch(e)}}}render(){const e=this.getSelectIconTitle(),i=this.props.intl.formatMessage({id:"clearSelection",defaultMessage:s.defaultMessages.clearSelection}),o=this.state.selectProgress>0&&this.state.selectProgress<1;return(0,t.jsx)("div",{css:this.getCSSStyle()},(0,t.jsx)("div",{className:"d-flex align-items-center justify-content-center select-tool-container",ref:e=>{this.btnContainer=e}},(0,t.jsx)("div",{className:"d-flex"},(0,t.jsx)("div",{className:"d-flex"},!o&&(0,t.jsx)("button",{title:e,"aria-label":e,onClick:this.toggleIsSelectActive,className:(0,t.classNames)("esri-widget--button  border-0 select-tool-btn d-flex align-items-center justify-content-center",{active:this.state.isActive}),disabled:!this.state.sketchInitialed},(0,t.jsx)(s.Icon,{"aria-hidden":!0,width:16,height:16,icon:this.getSelectToolIcon()})),o&&(0,t.jsx)(ye,{progress:this.state.selectProgress,intl:this.props.intl,theme:this.props.theme,onClick:this.onClickLoadingProgress}),(0,t.jsx)("button",{"aria-label":this.formatMessage("moreSelectionTools"),onClick:this.toggleSelectTypePopup,style:{width:18},className:(0,t.classNames)("esri-widget--button border-0 pl-1 pr-1 select-tool-btn d-flex align-items-center justify-content-center",{active:this.state.isShowSelectTypePopup}),disabled:!this.state.sketchInitialed,ref:e=>{this.btnSelectTypeContainer=e}},(0,t.jsx)(s.Icon,{"aria-hidden":!0,width:8,height:8,icon:Ie}))),(0,t.jsx)("button",{"aria-label":i,title:i,className:"select-tool-btn d-flex align-items-center justify-content-center select-tool-btn-hover esri-widget--button border-0",ref:e=>{this.selectResultContainer=e},onClick:this.clearSelect,disabled:!this.state.sketchInitialed},(0,t.jsx)(s.Icon,{width:16,height:16,icon:De})),(0,t.jsx)(s.Popper,{className:"map-tool-popper",css:this.getCSSStyle(),reference:this.btnContainer,open:this.state.isShowSelectTypePopup,placement:"bottom-start",toggle:this.onPopperToggle},(0,t.jsx)("div",{className:"p-4 content-bg",style:{display:"flex",flexDirection:"column"}},(0,t.jsx)("div",{className:"content-title"},this.props.intl.formatMessage({id:"SelectionTool",defaultMessage:s.defaultMessages.SelectionTool})),(0,t.jsx)("div",{className:"mt-2 mb-2"},(0,t.jsx)("div",{className:"d-flex mb-2"},(0,t.jsx)("div",{className:(0,t.classNames)("select-tool-type mr-2 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Rectangle"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Rectangle")},onKeyDown:e=>{this.handleKeyDown(e,"Rectangle")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,icon:Ce}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolRectangle",defaultMessage:s.defaultMessages.SelectionToolRectangle})},this.props.intl.formatMessage({id:"SelectionToolRectangle",defaultMessage:s.defaultMessages.SelectionToolRectangle}))),(0,t.jsx)("div",{className:(0,t.classNames)("select-tool-type mr-2 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Lasso"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Lasso")},onKeyDown:e=>{this.handleKeyDown(e,"Lasso")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,icon:Te}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolLasso",defaultMessage:s.defaultMessages.SelectionToolLasso})},this.props.intl.formatMessage({id:"SelectionToolLasso",defaultMessage:s.defaultMessages.SelectionToolLasso}))),(0,t.jsx)("div",{className:(0,t.classNames)("select-tool-type d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Circle"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Circle")},onKeyDown:e=>{this.handleKeyDown(e,"Circle")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,icon:Ve}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolCircle",defaultMessage:s.defaultMessages.SelectionToolCircle})},this.props.intl.formatMessage({id:"SelectionToolCircle",defaultMessage:s.defaultMessages.SelectionToolCircle})))),(0,t.jsx)("div",{className:"d-flex"},(0,t.jsx)("div",{className:(0,t.classNames)("select-tool-type mr-2 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Line"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Line")},onKeyDown:e=>{this.handleKeyDown(e,"Line")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,icon:Pe}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolLine",defaultMessage:s.defaultMessages.SelectionToolLine})},this.props.intl.formatMessage({id:"SelectionToolLine",defaultMessage:s.defaultMessages.SelectionToolLine}))),(0,t.jsx)("div",{className:(0,t.classNames)("select-tool-type d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Point"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Point")},onKeyDown:e=>{this.handleKeyDown(e,"Point")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,icon:Le}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolPoint",defaultMessage:s.defaultMessages.SelectionToolPoint})},this.props.intl.formatMessage({id:"SelectionToolPoint",defaultMessage:s.defaultMessages.SelectionToolPoint}))))),(0,t.jsx)("div",{className:"content-title"},this.props.intl.formatMessage({id:"SelectionMode",defaultMessage:s.defaultMessages.SelectionMode})),(0,t.jsx)("div",null,(0,t.jsx)("div",{className:"d-flex align-items-center mt-2"},(0,t.jsx)(s.Radio,{style:{cursor:"pointer"},checked:"intersects"===this.state.spatialRelationship,onChange:()=>{this.setState({spatialRelationship:"intersects"})}}),(0,t.jsx)("label",{className:"m-0 ml-2 content-title",style:{cursor:"pointer"},onClick:()=>{this.setState({spatialRelationship:"intersects"})}},this.props.intl.formatMessage({id:"SelectionWithin",defaultMessage:s.defaultMessages.SelectionWithin}))),(0,t.jsx)("div",{className:"d-flex align-items-center mt-2"},(0,t.jsx)(s.Radio,{style:{cursor:"pointer"},checked:"contains"===this.state.spatialRelationship,onChange:()=>{this.setState({spatialRelationship:"contains"})}}),(0,t.jsx)("label",{className:"m-0 ml-2 content-title",style:{cursor:"pointer"},onClick:()=>{this.setState({spatialRelationship:"contains"})}},this.props.intl.formatMessage({id:"SelectionContain",defaultMessage:s.defaultMessages.SelectionContain})))))))),!this.state.sketchInitialed&&(0,t.jsx)("div",{className:"select-tool-loader"}))}}const Ne={style:"esriSMSCircle",color:[0,0,128,128],name:"Circle",outline:{color:[0,0,128,255],width:1},type:"esriSMS",size:18},Ee={tags:["solid"],title:"Blue Thin",style:"esriSLSSolid",color:[79,129,189,255],width:3,name:"Blue 1",type:"esriSLS"},je={style:"esriSFSSolid",color:[79,129,189,77],type:"esriSFS",outline:{style:"esriSLSSolid",color:[54,93,141,255],width:1.5,type:"esriSLS"}},ke=r(10272),Oe=r(50045),Re=r(88721),We=r(22459),Be=r(20561),Fe=r(81146);class He extends t.React.PureComponent{constructor(e){var i,o;super(e),this.jsonUtils=null,this.currentActiveTool="rectangle",this.toggleIsSelectActive=()=>{this.setState({isActive:!this.state.isActive})},this.toggleSelectTypePopup=()=>{this.setState({isShowSelectTypePopup:!this.state.isShowSelectTypePopup})},this.onJimuMapViewSelectProgressChange=e=>{this.setState({selectProgress:e})},this.onKeyDown=e=>{"Shift"===e.key?this.lastShiftKeyEventInfo={eventDate:new Date,isKeyDown:!0}:(this.isMac&&"Meta"===e.key||!this.isMac&&"Control"===e.key)&&(this.lastCtrlKeyEventInfo={eventDate:new Date,isKeyDown:!0})},this.onKeyUp=e=>{"Shift"===e.key?this.lastShiftKeyEventInfo={eventDate:new Date,isKeyDown:!1}:(this.isMac&&"Meta"===e.key||!this.isMac&&"Control"===e.key)&&(this.lastCtrlKeyEventInfo={eventDate:new Date,isKeyDown:!1})},this.setCurrentSelectType=e=>{this.initialSketchTool(),e!==this.state.currentSelectType&&("Point"===e&&(this.state.isActive&&this.setActiveToolForSketchViewModel("point"),this.currentActiveTool="point"),"Rectangle"===e&&(this.state.isActive&&this.setActiveToolForSketchViewModel("rectangle"),this.currentActiveTool="rectangle"),"Lasso"===e&&(this.state.isActive&&this.setActiveToolForSketchViewModel("polygon"),this.currentActiveTool="polygon"),"Circle"===e&&(this.state.isActive&&this.setActiveToolForSketchViewModel("circle"),this.currentActiveTool="circle"),"Line"===e&&(this.state.isActive&&this.setActiveToolForSketchViewModel("polyline"),this.currentActiveTool="polyline"),this.setState({currentSelectType:e,isActive:!0}))},this.onClickLoadingProgress=()=>{if(this.activeJimuMapView){const e=!0;this.activeJimuMapView.cancelSelectByQuery(e)}},this.getSelectToolIcon=()=>"Point"===this.state.currentSelectType?Be:"Rectangle"===this.state.currentSelectType?ke:"Lasso"===this.state.currentSelectType?Oe:"Circle"===this.state.currentSelectType?Re:"Line"===this.state.currentSelectType?We:ke,this.getMobilePanelForSelectSetting=()=>(0,t.jsx)(N.Consumer,null,(({mapWidgetId:e})=>(0,t.jsx)(s.MobilePanel,{className:"map-tool-mobile-panel",mapWidgetId:`${e}-with-select-container`,title:"",open:this.state.isShowSelectTypePopup,onClose:()=>{this.toggleSelectTypePopup()}},(0,t.jsx)("div",{className:"w-100"},this.getMobilePanelSettingContent())))),this.getMobilePanelSettingContent=()=>(0,t.jsx)("div",{css:this.getCSSStyle()},(0,t.jsx)("div",{className:"content-title mt-1 mb-2"},this.props.intl.formatMessage({id:"SelectionTool",defaultMessage:s.defaultMessages.SelectionTool})),(0,t.jsx)("div",{className:"w-100 select-tool-type-mobile-container-shell"},(0,t.jsx)("div",{className:"select-tool-type-mobile-container d-flex"},(0,t.jsx)("div",{className:(0,t.classNames)("select-tool-type mr-4 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Rectangle"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Rectangle")},onKeyDown:e=>{this.handleSelectTypeKeyDown(e,"Rectangle")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,icon:ke}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolRectangle",defaultMessage:s.defaultMessages.SelectionToolRectangle})},this.props.intl.formatMessage({id:"SelectionToolRectangle",defaultMessage:s.defaultMessages.SelectionToolRectangle}))),(0,t.jsx)("div",{className:(0,t.classNames)("select-tool-type mr-4 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Lasso"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Lasso")},onKeyDown:e=>{this.handleSelectTypeKeyDown(e,"Lasso")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,icon:Oe}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolLasso",defaultMessage:s.defaultMessages.SelectionToolLasso})},this.props.intl.formatMessage({id:"SelectionToolLasso",defaultMessage:s.defaultMessages.SelectionToolLasso}))),(0,t.jsx)("div",{className:(0,t.classNames)("select-tool-type mr-4 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Circle"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Circle")},onKeyDown:e=>{this.handleSelectTypeKeyDown(e,"Circle")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,icon:Re}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolCircle",defaultMessage:s.defaultMessages.SelectionToolCircle})},this.props.intl.formatMessage({id:"SelectionToolCircle",defaultMessage:s.defaultMessages.SelectionToolCircle}))),(0,t.jsx)("div",{className:(0,t.classNames)("select-tool-type mr-4 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Line"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Line")},onKeyDown:e=>{this.handleSelectTypeKeyDown(e,"Line")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,icon:We}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolLine",defaultMessage:s.defaultMessages.SelectionToolLine})},this.props.intl.formatMessage({id:"SelectionToolLine",defaultMessage:s.defaultMessages.SelectionToolLine}))),(0,t.jsx)("div",{className:(0,t.classNames)("select-tool-type mr-4 d-flex flex-column align-items-center justify-content-center select-tool-btn-hover",{"select-tool-type-choosed":"Point"===this.state.currentSelectType}),onClick:()=>{this.setCurrentSelectType("Point")},onKeyDown:e=>{this.handleSelectTypeKeyDown(e,"Point")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,icon:Be}),(0,t.jsx)("div",{className:"select-tool-type-text mt-1 w-100 text-truncate pl-1 pr-1 d-flex justify-content-center",title:this.props.intl.formatMessage({id:"SelectionToolPoint",defaultMessage:s.defaultMessages.SelectionToolPoint})},this.props.intl.formatMessage({id:"SelectionToolPoint",defaultMessage:s.defaultMessages.SelectionToolPoint}))))),(0,t.jsx)("div",{className:"content-title mt-1 mb-2"},this.props.intl.formatMessage({id:"SelectionMode",defaultMessage:s.defaultMessages.SelectionMode})),(0,t.jsx)("div",null,(0,t.jsx)("div",{className:"d-flex align-items-center mt-2"},(0,t.jsx)(s.Radio,{style:{cursor:"pointer"},checked:"intersects"===this.state.spatialRelationship,onChange:()=>{this.setState({spatialRelationship:"intersects"})}}),(0,t.jsx)("label",{className:"m-0 ml-2 content-title",style:{cursor:"pointer"},onClick:()=>{this.setState({spatialRelationship:"intersects"})}},this.props.intl.formatMessage({id:"SelectionWithin",defaultMessage:s.defaultMessages.SelectionWithin}))),(0,t.jsx)("div",{className:"d-flex align-items-center mt-2"},(0,t.jsx)(s.Radio,{style:{cursor:"pointer"},checked:"contains"===this.state.spatialRelationship,onChange:()=>{this.setState({spatialRelationship:"contains"})}}),(0,t.jsx)("label",{className:"m-0 ml-2 content-title",style:{cursor:"pointer"},onClick:()=>{this.setState({spatialRelationship:"contains"})}},this.props.intl.formatMessage({id:"SelectionContain",defaultMessage:s.defaultMessages.SelectionContain}))))),this.handleSelectTypeKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||this.setCurrentSelectType(t)},this.handleKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||("toggleIsSelectActive"===t?this.toggleIsSelectActive():"showSelectSetting"===t?this.toggleSelectTypePopup():"onClickLoadingProgress"===t&&this.onClickLoadingProgress())},this.isMac="macOS"===(null===(o=null===(i=window.jimuUA)||void 0===i?void 0:i.os)||void 0===o?void 0:o.name),this.id=`${this.props.mapWidgetId}-select-tool`,this.sketChCreateOptions={polygon:{mode:"hybrid"}},this.state={sketchInitialed:!1,isActive:!1,isShowSelectTypePopup:!1,currentSelectType:"Rectangle",spatialRelationship:"intersects",selectProgress:0},this.bindShiftCtrlKeysEventListeners()}getCSSStyle(){const e=this.props.theme;return t.css`
      .select-tool-btn-hover:hover {
        background-color: ${t.polished.rgba(e.sys.color.primary.main,.1)};
      }

      .content-title {
        font-size: ${t.polished.rem(13)};
        font-weight: bold;
      }

      .select-tool-type-mobile-container-shell {
        overflow-x: auto;
        padding: 4px;
      }

      .select-tool-type-mobile-container-shell::-webkit-scrollbar {
        height: 0 !important;
        display: none;
      }

      .select-tool-type-mobile-container {
        width: 400px;
      }

      .select-tool-type {
        width: 64px;
        height: 64px;
        border: 1px solid ${e.ref.palette.neutral[500]};
        cursor: pointer;
      }

      .select-tool-type-choosed {
        border: 1px solid ${e.sys.color.primary.main};
        position: relative;
      }

      .select-tool-type-choosed:after {
        width: 0;
        height: 0;
        border-top: 8px solid ${e.sys.color.primary.main};
        border-left: 8px solid transparent;
        position: absolute;
        top: 0;
        right: 0;
        content: "";
      }

      .select-tool-type-text {
        font-size: ${t.polished.rem(12)};
      }

      .select-tool-loader {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 2px;
        width: 100%;
        animation: esri-fade-in 500ms ease-in-out;
      }

      .select-tool-loader:before {
        background-color: rgba(110,110,110,0.3);
        width: 100%;
        z-index: 0;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }

      .select-tool-loader:after {
        background-color: ${e.sys.color.primary.main};
        width: 40%;
        z-index: 0;
        animation: looping-progresss-bar-ani 1500ms linear infinite;
        content: "";
        opacity: 1;
        position: absolute;
        height: 2px;
        top: 0;
        transition: opacity 500ms ease-in-out;
      }
    `}componentDidMount(){this.state.sketchInitialed||(0,i.loadArcGISJSAPIModules)(["esri/widgets/Sketch/SketchViewModel","esri/layers/GraphicsLayer","esri/rest/support/Query","esri/symbols/support/jsonUtils","esri/geometry/geometryEngine","esri/views/2d/interactive/editingTools","esri/views/3d/interactive/editingTools","esri/views/2d/layers/GraphicsLayerView2D","esri/views/3d/layers/GraphicsLayerView3D"]).then((e=>{[this.SketchViewModel,this.GraphicsLayer,this.Query,this.jsonUtils,this.geometryEngine]=e,this.props.jimuMapView.view.when((()=>{this.initialSketchTool(),this.setState({sketchInitialed:!0})}))}))}componentDidUpdate(e,t){return t.sketchInitialed!==this.state.sketchInitialed&&this.state.sketchInitialed?(this.initialSketchTool(),void(this.state.isActive&&this.currentActiveTool&&this.setActiveToolForSketchViewModel(this.currentActiveTool))):e.jimuMapView&&this.props.jimuMapView&&e.jimuMapView.id!==this.props.jimuMapView.id&&this.state.sketchInitialed?(this.destroySketchViewModelAndReleaseHandles(),this.initialSketchTool(),void(this.state.isActive&&this.currentActiveTool&&this.setActiveToolForSketchViewModel(this.currentActiveTool))):(t.isActive!==this.state.isActive&&(this.initialSketchTool(),this.state.isActive?this.setActiveToolForSketchViewModel(this.currentActiveTool):this.destroySketchViewModelAndReleaseHandles()),this.tryUpdateActiveToolInfoWhenStateChange(t),void this.tryUpdateActiveToolInfoWhenPropsChange(e))}tryUpdateActiveToolInfoWhenStateChange(e){if(!e)return;const t=!(!e.isActive&&!e.isShowSelectTypePopup),i=!(!this.state.isActive&&!this.state.isShowSelectTypePopup);!t&&i?this.setCurrentToolAsActiveTool():t&&!i&&(this.setState({isActive:!1,isShowSelectTypePopup:!1}),this.setActiveToolToNull())}tryUpdateActiveToolInfoWhenPropsChange(e){var t,i;let s=!1;const o=(null===(t=null==e?void 0:e.activeToolInfo)||void 0===t?void 0:t.activeToolName)||"",a=(null===(i=this.props.activeToolInfo)||void 0===i?void 0:i.activeToolName)||"";if(o!==a){const e=this.props.toolName;o===e&&!(a===e)&&(s=!0)}e.autoControlWidgetId===this.id&&this.props.autoControlWidgetId&&this.props.autoControlWidgetId!==this.id&&(s=!0),s&&(this.state.isActive||this.state.isShowSelectTypePopup)&&this.setState({isActive:!1,isShowSelectTypePopup:!1})}componentWillUnmount(){this.destroySketchViewModelAndReleaseHandles(),this.releaseShiftCtrlKeysEventListeners()}destroySketchViewModelAndReleaseHandles(){if(this.releaseViewHandles(),this.sketchViewModel&&(this.sketchViewModel.destroy(),this.sketchViewModel=null),this.activeJimuMapView=null,this.props.autoControlWidgetId===this.id){const e=t.appActions.releaseAutoControlMapWidget(this.props.mapWidgetId);(0,t.getAppStore)().dispatch(e)}}releaseViewHandles(){this.activeJimuMapView&&this.activeJimuMapView.removeSelectByQueryProgressChangeListener(this.onJimuMapViewSelectProgressChange),this.viewKeyDownHandle&&(this.viewKeyDownHandle.remove(),this.viewKeyDownHandle=null),this.viewKeyUpHandle&&(this.viewKeyUpHandle.remove(),this.viewKeyUpHandle=null)}setCurrentToolAsActiveTool(){this.isSelectIsActiveTool()||this.props._onIconClick()}setActiveToolToNull(){this.isSelectIsActiveTool()&&this.props._onIconClick()}isSelectIsActiveTool(){var e;return this.props.toolName&&this.props.toolName===(null===(e=this.props.activeToolInfo)||void 0===e?void 0:e.activeToolName)}useShiftKey(e){return this.useKey(this.lastShiftKeyEventInfo,e)}useCtrlKey(e){return this.useKey(this.lastCtrlKeyEventInfo,e)}useKey(e,t){if(e){if(e.isKeyDown)return!0;return Date.now()-e.eventDate.getTime()<=t}return!1}bindShiftCtrlKeysEventListeners(){document.addEventListener("keydown",this.onKeyDown,!0),document.addEventListener("keyup",this.onKeyUp,!0)}releaseShiftCtrlKeysEventListeners(){document.removeEventListener("keydown",this.onKeyDown,!0),document.removeEventListener("keyup",this.onKeyUp,!0)}initialSketchTool(){if(this.SketchViewModel&&!this.sketchViewModel){this.releaseViewHandles();const e=this.props.jimuMapView;this.activeJimuMapView=e,this.activeJimuMapView.addSelectByQueryProgressChangeListener(this.onJimuMapViewSelectProgressChange);const i=e.view;this.viewKeyDownHandle=i.on("key-down",(e=>{"Shift"===e.key&&e.stopPropagation()})),this.viewKeyDownHandle=i.on("key-up",(e=>{"Shift"===e.key&&e.stopPropagation()})),this.sketchViewModel=new this.SketchViewModel({view:i,layer:new this.GraphicsLayer,pointSymbol:this.jsonUtils.fromJSON(Ne),polylineSymbol:this.jsonUtils.fromJSON(Ee),polygonSymbol:this.jsonUtils.fromJSON(je)}),this.sketchViewModel.on("create",(e=>{if("complete"===e.state){this.setActiveToolForSketchViewModel(this.currentActiveTool);const i=this.props.jimuMapView;i.view.closePopup();const s=e.graphic;if(!s)return void console.log("sketch graphic is null");if(!s.geometry)return void console.log("sketch graphic.geometry is null");const o=500,a=this.useShiftKey(o),n=this.useCtrlKey(o);let r=t.DataSourceSelectionMode.New;r=a?n?t.DataSourceSelectionMode.SelectFromCurrent:t.DataSourceSelectionMode.AddToCurrent:n?t.DataSourceSelectionMode.RemoveFromCurrent:t.DataSourceSelectionMode.New,i.selectFeaturesByGraphic(s,this.state.spatialRelationship,r)}}))}}setActiveToolForSketchViewModel(e){if(this.sketchViewModel){const i=this.sketChCreateOptions[e];if(i?this.sketchViewModel.create(e,i):this.sketchViewModel.create(e),this.props.autoControlWidgetId!==this.id){const e=t.appActions.requestAutoControlMapWidget(this.props.mapWidgetId,this.id);(0,t.getAppStore)().dispatch(e)}}}getSelectIconTitle(){let e="";e="Point"===this.state.currentSelectType?this.formatMessage("SelectionByPoint"):"Rectangle"===this.state.currentSelectType?this.formatMessage("SelectionByRectangle"):"Lasso"===this.state.currentSelectType?this.formatMessage("SelectionByLasso"):"Circle"===this.state.currentSelectType?this.formatMessage("SelectionByCircle"):"Line"===this.state.currentSelectType?this.formatMessage("SelectionByLine"):this.formatMessage("SelectLabel");const t=this.formatMessage("newSelection"),i=this.formatMessage("addToCurrentSelection"),s=this.formatMessage("removeFromCurrentSelection"),o=this.formatMessage("selectFromCurrentSelection"),a=this.formatMessage("drawShape"),n=this.formatMessage("draw"),r=this.isMac?"Cmd":"Ctrl";return`${e}\n${`\u2219 ${t} (${a})`}\n${`\u2219 ${i} (Shift + ${n})`}\n${`\u2219 ${s} (${r} + ${n})`}\n${`\u2219 ${o} (Shift + ${r} + ${n})`}\n    `}formatMessage(e){return this.props.intl.formatMessage({id:e,defaultMessage:s.defaultMessages[e]})}render(){const e=this.getSelectIconTitle(),i=this.formatMessage("moreSelectionTools"),o=this.state.selectProgress>0&&this.state.selectProgress<1;return(0,t.jsx)("div",{css:this.getCSSStyle()},this.state.sketchInitialed&&!o&&(0,t.jsx)("div",{onClick:this.toggleIsSelectActive,style:{},title:e,className:(0,t.classNames)("exbmap-ui-tool border-0 esri-widget--button",{"exbmap-ui-tool-icon-selected":this.state.isActive}),onKeyDown:e=>{this.handleKeyDown(e,"toggleIsSelectActive")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:this.getSelectToolIcon()})),this.state.sketchInitialed&&o&&(0,t.jsx)(ye,{progress:this.state.selectProgress,intl:this.props.intl,theme:this.props.theme,onClick:this.onClickLoadingProgress}),!this.state.sketchInitialed&&(0,t.jsx)("div",{style:{},className:(0,t.classNames)("exbmap-ui-tool border-0 esri-widget--button")},(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:this.getSelectToolIcon()})),(0,t.jsx)("div",{className:"border border-top-0 w-100",style:{height:"1px"}}),this.state.sketchInitialed&&(0,t.jsx)("div",{onClick:this.toggleSelectTypePopup,title:i,"aria-label":i,style:{},className:(0,t.classNames)("exbmap-ui-tool border-0 esri-widget--button"),onKeyDown:e=>{this.handleKeyDown(e,"showSelectSetting")},role:"button",tabIndex:0},(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:Fe})),!this.state.sketchInitialed&&(0,t.jsx)("div",{style:{},title:i,className:(0,t.classNames)("exbmap-ui-tool border-0 esri-widget--button")},(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:Fe})),this.state.isShowSelectTypePopup&&this.getMobilePanelForSelectSetting())}}class ze extends t.React.PureComponent{constructor(){super(...arguments),this.onJimuLayerViewSelectedFeaturesChange=()=>{this.computerSelectedGraphicCount()}}componentDidMount(){this.setCurrentJimuMapView(this.props.jimuMapView),this.computerSelectedGraphicCount()}componentDidUpdate(e){const t=(null==e?void 0:e.jimuMapView)||null,i=this.props.jimuMapView||null;t!==i&&this.setCurrentJimuMapView(i),this.computerSelectedGraphicCount()}componentWillUnmount(){this.setCurrentJimuMapView(null)}setCurrentJimuMapView(e){this.currentJimuMapView&&this.currentJimuMapView.removeJimuLayerViewSelectedFeaturesChangeListener(this.onJimuLayerViewSelectedFeaturesChange),this.currentJimuMapView=e,this.currentJimuMapView&&this.currentJimuMapView.addJimuLayerViewSelectedFeaturesChangeListener(this.onJimuLayerViewSelectedFeaturesChange)}computerSelectedGraphicCount(){if(this.props.onSelectedGraphicsChanged){const e=this.props.jimuMapView.getSelectedFeatureCount();this.props.onSelectedGraphicsChanged(e)}}render(){return null}}const Ue=t.ReactRedux.connect(((e,t)=>{if(e.appStateInBuilder){return{dataSourcesInfo:e.appStateInBuilder&&e.appStateInBuilder.dataSourcesInfo,viewInfos:e.appStateInBuilder&&e.appStateInBuilder.jimuMapViewsInfo}}return{dataSourcesInfo:e&&e.dataSourcesInfo,viewInfos:e&&e.jimuMapViewsInfo}}))(ze);var Je=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};const Ge=r(37175),_e=r(4583);var $e=r(43058),Ke=r.n($e),qe=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const Ze=e=>{const i=window.SVG,{className:s}=e,o=qe(e,["className"]),a=(0,t.classNames)("jimu-icon jimu-icon-component",s);return i?t.React.createElement(i,Object.assign({className:a,src:Ke()},o)):t.React.createElement("svg",Object.assign({className:a},o))};var Qe=r(78313),Ye=r.n(Qe),Xe=function(e,t){var i={};for(var s in e)Object.prototype.hasOwnProperty.call(e,s)&&t.indexOf(s)<0&&(i[s]=e[s]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(s=Object.getOwnPropertySymbols(e);o<s.length;o++)t.indexOf(s[o])<0&&Object.prototype.propertyIsEnumerable.call(e,s[o])&&(i[s[o]]=e[s[o]])}return i};const et=e=>{const i=window.SVG,{className:s}=e,o=Xe(e,["className"]),a=(0,t.classNames)("jimu-icon jimu-icon-component",s);return i?t.React.createElement(i,Object.assign({className:a,src:Ye()},o)):t.React.createElement("svg",Object.assign({className:a},o))};var tt=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};const it=r(15181),st=r(56113),ot=r(71525),at=r(3737);var nt;!function(e){e.Initial="Initial",e.Creating="Creating",e.Created="Created",e.CreateError="CreateError"}(nt||(nt={}));const rt={Zoom:class extends Z{constructor(){super(...arguments),this.toolName="Zoom"}getTitle(){return this.props.intl.formatMessage({id:"ZoomLabel",defaultMessage:s.defaultMessages.ZoomLabel})}getIcon(){return null}getExpandPanel(){return(0,t.jsx)(Q,{jimuMapView:this.props.jimuMapView})}},Home:class extends Z{constructor(){super(...arguments),this.toolName="Home",this.getHomeContent=e=>(0,t.jsx)(X,{jimuMapView:this.props.jimuMapView,initialMapState:e})}getTitle(){return this.props.intl.formatMessage({id:"HomeLabel",defaultMessage:s.defaultMessages.HomeLabel})}getIcon(){return null}getExpandPanel(){return(0,t.jsx)(N.Consumer,null,(({initialMapState:e})=>this.getHomeContent(e)))}},Navigation:class extends Z{constructor(){super(...arguments),this.toolName="Navigation"}getTitle(){return"Navigation"}getIcon(){return null}getExpandPanel(){return t.React.createElement(ie,{jimuMapView:this.props.jimuMapView})}static isAvailable(e){var t,i;return"3d"===(null===(i=null===(t=e.jimuMapView)||void 0===t?void 0:t.view)||void 0===i?void 0:i.type)}},Locate:class extends Z{constructor(){super(...arguments),this.toolName="Locate"}getTitle(){return"Locate"}getIcon(){return null}getExpandPanel(){return(0,t.jsx)(te,{jimuMapView:this.props.jimuMapView})}},ClearActionData:class extends Z{constructor(e){super(e),this.toolName="ClearActionData",this.onIconClick=()=>null,this.onDropDownToggle=()=>{this.setState({isOpen:!this.state.isOpen})},this.onItemClick=(e,s)=>{var o,a,n;this.setState({isOpen:!1});const r=e.layerId,l=t.MutableStoreManager.getInstance().getStateValue([s])||{};if(e.isAction){const e=r,a=l.showOnMapDatas,n=l.addToMapDatas;a&&(delete a[e],t.MutableStoreManager.getInstance().updateStateValue(s,"showOnMapDatas",a)),n&&(null===(o=n[e])||void 0===o?void 0:o.dataChangeType)===i.DataChangeType.Created&&t.MutableStoreManager.getInstance().updateStateValue(s,`addToMapDatas.${e}.dataChangeType`,i.DataChangeType.Remove)}else{const e=null===(n=null===(a=this.props.jimuMapView)||void 0===a?void 0:a.view)||void 0===n?void 0:n.map;if(e){const t=e.findLayerById(r);t&&e.remove(t)}}},this.getContent=e=>{const i=this.getListItems(e).map(((t,i)=>this.createDropdownItem(t,e,i)));return i.length>0?(0,t.jsx)("div",{css:this.getStyle(),title:this.getTitle()},(0,t.jsx)(s.Dropdown,{direction:"down",size:"sm",toggle:this.onDropDownToggle,isOpen:this.state.isOpen},(0,t.jsx)(s.DropdownButton,{icon:!0,arrow:!1,size:"sm",type:"default"},(0,t.jsx)(s.Icon,{size:16,className:"exbmap-ui-tool-icon",icon:this.getIcon().icon})),(0,t.jsx)(s.DropdownMenu,null,i))):null},this.state={isOpen:!1}}static getIsNeedSetting(){return!1}getStyle(){return t.css`
      .jimu-dropdown {
        display: flex;
        .icon-btn {
          padding: 7px;
          border-radius: 0;
        }
      }
    `}getTitle(){return this.props.intl.formatMessage({id:"clearResults",defaultMessage:s.defaultMessages.clearResults})}getIcon(){return{icon:r(9044),onIconClick:()=>{this.onIconClick()}}}getListItems(e){const i=t.MutableStoreManager.getInstance().getStateValue([e])||{},s=this.getListItemsByAddOrShowOnMapDatas(e,i),o=s.map((e=>e.layerId));let a=this.getListItemsByRemoveableLayerIdsInfo(i);a=a.filter((e=>!o.includes(e.layerId)));return s.concat(a)}getListItemsByAddOrShowOnMapDatas(e,s){const o=(null==s?void 0:s.showOnMapDatas)||{},a=(null==s?void 0:s.addToMapDatas)||{},n=Object.entries(o).map((e=>({id:e[0],title:e[1].title,jimuMapViewId:e[1].jimuMapViewId,mapWidgetId:e[1].mapWidgetId,needToRemove:!0,type:e[1].type}))),r=Object.entries(a).map((e=>({id:e[0],title:e[1].title,jimuMapViewId:e[1].jimuMapViewId,mapWidgetId:e[1].mapWidgetId,needToRemove:e[1].dataChangeType===i.DataChangeType.Created,type:e[1].type})));return n.concat(r).filter((s=>{let o=s.jimuMapViewId;if(!o&&s.mapWidgetId===e){const i=(0,t.getAppStore)().getState().jimuMapViewsInfo;o=Object.keys(i||{}).find((t=>i[t].mapWidgetId===e))}return o===this.props.jimuMapView.id&&s.type===i.ActionType.DataAction&&s.needToRemove})).map((e=>({layerId:e.id,title:e.title,isAction:!0})))}getListItemsByRemoveableLayerIdsInfo(e){var t;const i=[],s=(null==e?void 0:e.removeableLayerIdsInfo)||{},o=this.props.jimuMapView;if(o){const e=null===(t=o.view)||void 0===t?void 0:t.map;if(e){(s[o.id]||[]).forEach((t=>{const s=e.findLayerById(t);if(s){const e={layerId:t,title:s.title||t,isAction:!1};i.push(e)}}))}}return i}createDropdownItem(e,i,o){const a=`${e.layerId}-index-${o}`;return(0,t.jsx)(s.DropdownItem,{key:a,header:!1,onClick:()=>{this.onItemClick(e,i)}},e.title)}getExpandPanel(){return(0,t.jsx)(N.Consumer,null,(({mapWidgetId:e})=>this.getContent(e)))}},Compass:class extends Z{constructor(){super(...arguments),this.toolName="Compass"}getTitle(){return this.props.intl.formatMessage({id:"CompassLabel",defaultMessage:s.defaultMessages.CompassLabel})}getIcon(){return null}getExpandPanel(){return t.React.createElement(ee,{jimuMapView:this.props.jimuMapView})}},Search:class extends Z{constructor(){super(...arguments),this.toolName="Search"}getTitle(){return this.props.intl.formatMessage({id:"SearchLabel",defaultMessage:s.defaultMessages.SearchLabel})}getIcon(){return{icon:r(98018)}}getExpandPanel(){return this.props.isMobile?(0,t.jsx)("div",{style:{position:"relative",width:"100%",minHeight:"32px"}},(0,t.jsx)(se,{jimuMapView:this.props.jimuMapView,mapWidgetId:this.props.mapWidgetId})):(0,t.jsx)("div",{style:{position:"relative",width:"283px",minHeight:"32px"}},(0,t.jsx)(se,{jimuMapView:this.props.jimuMapView,mapWidgetId:this.props.mapWidgetId}))}},Layers:class extends Z{constructor(e){super(e),this.toolName="Layers",this.handleTabIndexChange=e=>{this.setState({activeTabIndex:e})},this.handleKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||this.handleTabIndexChange(t)},this.state={activeTabIndex:0}}getTitle(){return this.props.intl.formatMessage({id:"LayersLabel",defaultMessage:s.defaultMessages.LayersLabel})}getIcon(){return{icon:r(32945)}}getExpandPanel(){return(0,t.jsx)("div",{style:{width:this.props.isMobile?"100%":"250px",minHeight:"32px",position:"relative"},className:(0,t.classNames)({"exbmap-ui-pc-expand-maxheight":!this.props.isMobile})},(0,t.jsx)(s.Nav,{tabs:!0},(0,t.jsx)(s.NavItem,null,(0,t.jsx)(s.NavLink,{active:0===this.state.activeTabIndex,onClick:()=>{this.handleTabIndexChange(0)},onKeyDown:e=>{this.handleKeyDown(e,0)}},this.props.intl.formatMessage({id:"LayersLabelLayer",defaultMessage:s.defaultMessages.LayersLabelLayer}))),(0,t.jsx)(s.NavItem,null,(0,t.jsx)(s.NavLink,{active:1===this.state.activeTabIndex,onClick:()=>{this.handleTabIndexChange(1)},onKeyDown:e=>{this.handleKeyDown(e,1)}},this.props.intl.formatMessage({id:"LayersLabelLegend",defaultMessage:s.defaultMessages.LayersLabelLegend})))),(0,t.jsx)("div",{className:"mt-1"}),0===this.state.activeTabIndex&&(0,t.jsx)(oe,{jimuMapView:this.props.jimuMapView}),1===this.state.activeTabIndex&&(0,t.jsx)(ae,{jimuMapView:this.props.jimuMapView}))}},BaseMap:class extends Z{constructor(){super(...arguments),this.toolName="BaseMap"}getTitle(){return this.props.intl.formatMessage({id:"BaseMapLabel",defaultMessage:s.defaultMessages.BaseMapLabel})}getIcon(){return{icon:r(82009)}}getExpandPanel(){return t.React.createElement(ne,{jimuMapView:this.props.jimuMapView,isMobile:this.props.isMobile})}},Measure:class extends Z{constructor(e){super(e),this.toolName="Measure",this.measureModules2D=[{name:"Line",title:"Line",activeTool:"distance",src:r(19086)},{name:"Polygon",title:"Polygon",activeTool:"area",src:r(60308)}],this.measureModules3D=[{name:"Line",title:"Line",activeTool:"direct-line",src:r(19086)},{name:"Polygon",title:"Polygon",activeTool:"area",src:r(60308)}],this.destroy=()=>{const e=this.state.measureInstance;e&&(fe(e),e.destroyed||(e.destroy(),this.setState({measureInstance:null,activeTabIndex:0})))},this.handleMeasurceInstanceCreated=e=>{const t=this.state.measureInstance;t&&fe(t),this.setState({measureInstance:e})},this.onTabClick=e=>{this.state.activeTabIndex!==e&&(this.state.measureInstance.clear(),this.setState({activeTabIndex:e}),0===e?this.state.measureInstance.activeTool="2d"===this.props.jimuMapView.view.type?"distance":"direct-line":1===e&&(this.state.measureInstance.activeTool="area"))},this.handleKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||this.onTabClick(t)},this.onRequestClosePanel=()=>{this.props.activeToolInfo.activeToolName===this.toolName&&this.props.onActiveToolInfoChange(null)},this.onClosePanel=()=>{this.destroy()},this.onShowPanel=()=>{this.state.measureInstance&&(0===this.state.activeTabIndex?this.state.measureInstance.activeTool="2d"===this.props.jimuMapView.view.type?"distance":"direct-line":1===this.state.activeTabIndex&&(this.state.measureInstance.activeTool="area"))},this.getNavTab=()=>"2d"===this.props.jimuMapView.view.type?t.React.createElement(s.Nav,{tabs:!0},this.measureModules2D.map(((e,i)=>{const o=0===i?"drawModeLine":"drawModePolygon";return t.React.createElement(s.NavItem,{key:i},t.React.createElement(s.NavLink,{active:this.state.activeTabIndex===i,ref:e=>{this.state.activeTabIndex===i&&(this.activeTabRef=e)},onClick:()=>{this.onTabClick(i)},onKeyDown:e=>{this.handleKeyDown(e,i)},"aria-label":this.props.intl.formatMessage({id:o,defaultMessage:s.defaultMessages[o]})},t.React.createElement(s.Icon,{width:16,height:16,className:"m-0",icon:e.src})))}))):"3d"===this.props.jimuMapView.view.type?t.React.createElement(s.Nav,{tabs:!0},this.measureModules3D.map(((e,i)=>{const o=0===i?"drawModeLine":"drawModePolygon";return t.React.createElement(s.NavItem,{key:i},t.React.createElement(s.NavLink,{active:this.state.activeTabIndex===i,ref:e=>{this.state.activeTabIndex===i&&(this.activeTabRef=e)},onClick:()=>{this.onTabClick(i)},onKeyDown:e=>{this.handleKeyDown(e,i)},"aria-label":this.props.intl.formatMessage({id:o,defaultMessage:s.defaultMessages[o]})},t.React.createElement(s.Icon,{width:16,height:16,className:"m-0",icon:e.src})))}))):null,this.getMeasureModule=()=>"2d"===this.props.jimuMapView.view.type?this.measureModules2D[this.state.activeTabIndex]:this.measureModules3D[this.state.activeTabIndex],this.state={activeTabIndex:0,measureInstance:null}}getTitle(){return this.props.intl.formatMessage({id:"MeasureLabel",defaultMessage:s.defaultMessages.MeasureLabel})}getIcon(){return{icon:r(9206)}}focusDefaultElement(){(0,t.focusElementInKeyboardMode)(this.activeTabRef)}getExpandPanel(){return t.React.createElement("div",{style:{width:this.props.isMobile?"100%":"250px",position:"relative"},className:(0,t.classNames)({"exbmap-ui-pc-expand-maxheight":!this.props.isMobile})},this.getNavTab(),t.React.createElement(ge,{mapWidgetId:this.props.mapWidgetId,activeTabIndex:this.state.activeTabIndex,jimuMapView:this.props.jimuMapView,measureModule:this.getMeasureModule(),measureInstance:this.state.measureInstance,onMeasurceInstanceCreated:this.handleMeasurceInstanceCreated,autoControlWidgetId:this.props.autoControlWidgetId,onRequestClosePanel:this.onRequestClosePanel}))}},MapSwitch:class extends Z{constructor(){super(...arguments),this.toolName="MapSwitch",this.switchMap=()=>null,this.handleKeyDown=(e,t)=>{"Enter"!==e.key&&" "!==e.key||(null==e||e.preventDefault(),t())},this.getContent=(e,i,o,a,n,r)=>{const l=()=>{(0,t.getAppStore)().dispatch(t.appActions.requestAutoControlMapWidget(n,n)),a()},p=(0,t.getAppStore)().getState().appConfig.dataSources,c="switchTo",h=i[0],d=h?p[h]:null,u=(null==d?void 0:d.portalUrl)||null,m=(null==d?void 0:d.itemId)||null,g=(null==d?void 0:d.label)||(null==d?void 0:d.sourceLabel)||"",v=g?this.props.intl.formatMessage({id:c,defaultMessage:de[c]},{webMapName:g}):"",w=i[1],f=w?p[w]:null,y=(null==f?void 0:f.portalUrl)||null,M=(null==f?void 0:f.itemId)||null,S=(null==f?void 0:f.label)||(null==f?void 0:f.sourceLabel)||"",b=S?this.props.intl.formatMessage({id:c,defaultMessage:de[c]},{webMapName:S}):"";let x="",I="";return h!==o?(x=g,I=v):w!==o&&(x=S,I=b),I||(I=this.props.intl.formatMessage({id:"SwitchMap",defaultMessage:s.defaultMessages.SwitchMap})),e?this.props.isMobile?(0,t.jsx)("div",{className:"exbmap-ui-tool esri-widget--button",onClick:l,role:"button",tabIndex:0,onKeyDown:e=>{this.handleKeyDown(e,l)},title:x,"aria-label":I},(0,t.jsx)(s.Icon,{width:16,height:16,className:"exbmap-ui-tool-icon",icon:this.getIcon().icon})):(0,t.jsx)("div",{className:"mapswitch-map-tool",css:this.getStyle(),onClick:l,role:"button",tabIndex:0,onKeyDown:e=>{this.handleKeyDown(e,l)},"aria-label":I},(0,t.jsx)("div",{title:g,className:(0,t.classNames)("mapthumb-item",{front:h!==o},{back:h===o})},(0,t.jsx)(he,{mapItemId:m,portUrl:u,label:v,theme:r})),(0,t.jsx)("div",{title:S,className:(0,t.classNames)("mapthumb-item",{front:w!==o},{back:w===o})},(0,t.jsx)(he,{mapItemId:M,portUrl:y,label:b,theme:r}))):null},this.getIconContent=(e,t,i,s)=>e?(this.switchMap=s,super.render()):null}static getIsNeedSetting(){return!1}static isAvailable(e){if(e.isMobile){const i=e.mapWidgetId;if(i){const e=(0,t.getAppStore)().getState().appConfig.widgets[i];if(e)return e.useDataSources&&e.useDataSources.length>=2}return!1}return!0}getStyle(){return t.css`
      width: ${t.polished.rem(68)};
      height: ${t.polished.rem(52)};
      cursor: pointer;
      position: relative;

      .mapthumb-item {
        position: absolute;
        width: ${t.polished.rem(64)};
        height: ${t.polished.rem(48)};
        transition: bottom 0.5s, left 0.5s, top 0.5s, right 0.5s, z-index 0.5s;
      }

      .front {
        z-index: 1;
        bottom: 0;
        left: 0;
      }

      .back {
        z-index: 0;
        top: 0;
        right: 0;
      }
    `}getTitle(){return"MapSwitch"}getIcon(){return{icon:r(47717),onIconClick:()=>{this.switchMap()}}}getExpandPanel(){return this.props.toolJson.isOnlyExpanded?(0,t.jsx)(N.Consumer,null,(({isShowMapSwitchBtn:e,dataSourceIds:t,activeDataSourceId:i,switchMap:s,mapWidgetId:o,theme:a})=>this.getContent(e,t,i,s,o,a))):null}render(){return this.props.toolJson.isOnlyExpanded?super.render():(0,t.jsx)(N.Consumer,null,(({isShowMapSwitchBtn:e,dataSourceIds:t,activeDataSourceId:i,switchMap:s})=>this.getIconContent(e,t,i,s)))}},FullScreen:class extends Z{constructor(){super(...arguments),this.toolName="Fullscreen",this.isFullScreen=!1,this.fullScreenMap=()=>null,this.getContent=(e,t)=>(this.fullScreenMap=e,this.isFullScreen=t,super.render())}getTitle(){return this.props.intl.formatMessage({id:"FullScreenLabel",defaultMessage:s.defaultMessages.FullScreenLabel})}getIcon(){return{icon:this.isFullScreen?r(69881):r(49798),onIconClick:e=>{this.fullScreenMap()}}}getExpandPanel(){return null}render(){return t.React.createElement(N.Consumer,null,(({fullScreenMap:e,isFullScreen:t})=>this.getContent(e,t)))}},ScaleBar:class extends Z{constructor(){super(...arguments),this.toolName="ScaleBar"}getTitle(){return"ScaleBar"}getIcon(){return null}getExpandPanel(){return t.React.createElement(ue,{jimuMapView:this.props.jimuMapView})}static isAvailable(e){var t,i;return"2d"===(null===(i=null===(t=e.jimuMapView)||void 0===t?void 0:t.view)||void 0===i?void 0:i.type)}},Attribution:class extends Z{constructor(){super(...arguments),this.toolName="Attribution"}static getIsNeedSetting(){return!1}getTitle(){return"Attribution"}getIcon(){return null}getExpandPanel(){return t.React.createElement(me,{jimuMapView:this.props.jimuMapView})}},Select:class extends Z{constructor(e){super(e),this.toolName="Select",this.state={}}getTitle(){return this.props.intl.formatMessage({id:"SelectLabel",defaultMessage:s.defaultMessages.SelectLabel})}getIcon(){return{icon:r(10272)}}getExpandPanel(){return this.props.isMobile?(0,t.jsx)(He,{mapWidgetId:this.props.mapWidgetId,autoControlWidgetId:this.props.autoControlWidgetId,activeToolInfo:this.props.activeToolInfo,toolName:this.toolName,onActiveToolInfoChange:this.props.onActiveToolInfoChange,_onIconClick:()=>{this._onIconClick()},theme:this.props.theme,intl:this.props.intl,jimuMapView:this.props.jimuMapView}):(0,t.jsx)(Ae,{mapWidgetId:this.props.mapWidgetId,autoControlWidgetId:this.props.autoControlWidgetId,theme:this.props.theme,intl:this.props.intl,jimuMapView:this.props.jimuMapView,activeToolInfo:this.props.activeToolInfo,toolName:this.toolName,onActiveToolInfoChange:this.props.onActiveToolInfoChange,_onIconClick:()=>{this._onIconClick()}})}},SelectState:class extends Z{constructor(e){super(e),this.toolName="SelectState",this.handleSelectedGraphicsChanged=e=>{this.setState({selectedGraphicCount:e})},this.zoomToSelectedFeatures=()=>Je(this,void 0,void 0,(function*(){var e;const t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view;if(t){const e=yield this.getSelectedGraphics();e.length>0&&t.goTo(e)}})),this.clearSelectedFeatures=()=>Je(this,void 0,void 0,(function*(){const e=this.props.jimuMapView;if(e){try{const t=!1;yield e.cancelSelectByQuery(t)}catch(t){console.error(`jimuMapView.cancelSelectByQuery() error, jimuMapViewId: ${e.id}`,t)}setTimeout((()=>{e.clearSelectedFeatures()}),200)}})),this.state={selectedGraphicCount:0}}getStyle(){return t.css`
      background-color: ${this.props.theme.arcgis.components.button.variants.default.default.bg};

      .divide-line {
        border-right: 1px solid ${this.props.theme.ref.palette.neutral[900]};
        height: 100%;
      }
    `}getTitle(){return""}getIcon(){return null}getSelectedGraphics(){return Je(this,void 0,void 0,(function*(){let e=[];return this.props.jimuMapView&&(e=yield this.props.jimuMapView.getSelectedFeatures()),e}))}getExpandPanel(){const e=this.props.intl.formatMessage({id:"SelectionSelectedFeatures",defaultMessage:s.defaultMessages.SelectionSelectedFeatures}),i=this.props.intl.formatMessage({id:"clearSelection",defaultMessage:s.defaultMessages.clearSelection}),o=this.props.intl.formatMessage({id:"SelectionZoomToSelectedFeatures",defaultMessage:s.defaultMessages.SelectionZoomToSelectedFeatures});return this.props.isMobile?(0,t.jsx)("div",{css:this.getStyle(),className:"w-100 d-flex justify-content-between align-items-center",style:{height:"40px"}},(0,t.jsx)("div",{className:"ml-2"},`${e}: ${this.state.selectedGraphicCount}`),(0,t.jsx)("div",{className:"d-flex"},(0,t.jsx)("div",{title:o,className:"h-100 border border-top-0 border-bottom-0 d-flex justify-content-center align-items-center",style:{width:"40px",cursor:"pointer"},onClick:this.zoomToSelectedFeatures},(0,t.jsx)(s.Icon,{width:18,height:18,icon:Ge})),(0,t.jsx)("div",{className:"h-100 d-flex justify-content-center align-items-center",style:{width:"40px",cursor:"pointer"},onClick:this.clearSelectedFeatures,title:i},(0,t.jsx)(s.Icon,{width:18,height:18,icon:_e}))),(0,t.jsx)(Ue,{jimuMapView:this.props.jimuMapView,onSelectedGraphicsChanged:this.handleSelectedGraphicsChanged})):(0,t.jsx)(t.React.Fragment,null,(0,t.jsx)(s.Button,{onClick:this.zoomToSelectedFeatures,title:o},(0,t.jsx)(s.Icon,{width:16,height:16,icon:Ge,className:"mr-2"}),`${e}: ${this.state.selectedGraphicCount}`),(0,t.jsx)(Ue,{jimuMapView:this.props.jimuMapView,onSelectedGraphicsChanged:this.handleSelectedGraphicsChanged}))}},ExtentNavigate:class extends Z{constructor(){super(...arguments),this.toolName="ExtentNavigate",this.onViewStationary=()=>{this.updateByCurrentView()},this.onClickPrevBtn=()=>{if(!this.isPrevBtnEnabled())return;this.view.viewpointIndex--;const e=V(this.view,this.view.viewpointIndex);e&&this.view.goTo(e),this.updateByCurrentView()},this.onPrevBtnKeyDown=e=>{"Enter"!==e.key&&" "!==e.key||this.onClickPrevBtn()},this.onClickNextBtn=()=>{if(!this.isNextBtnEnabled())return;this.view.viewpointIndex++;const e=V(this.view,this.view.viewpointIndex);e&&this.view.goTo(e),this.updateByCurrentView()},this.onNextBtnKeyDown=e=>{"Enter"!==e.key&&" "!==e.key||this.onClickNextBtn()}}getTitle(){return"ExtentNavigate"}getIcon(){return{icon:null}}getExtendCssStyle(){return"\n      .extent-navigate-btn {\n        width: 32px;\n        height: 32px;\n        text-align: center;\n        line-height: 32px;\n        cursor: default;\n      }\n\n      .extent-navigate-btn.extent-navigate-btn-disabled {\n        color: grey;\n      }\n\n      .extent-navigate-prev-btn {\n        border-bottom: 1px solid #ccc;\n      }\n    "}getExpandPanel(){const e=!this.isPrevBtnEnabled(),i=!this.isNextBtnEnabled(),s=(0,t.classNames)("esri-widget--button extent-navigate-btn extent-navigate-prev-btn",{"extent-navigate-btn-disabled":e}),o=(0,t.classNames)("esri-widget--button extent-navigate-btn extent-navigate-next-btn",{"extent-navigate-btn-disabled":i}),a=this.formatMessage("prevExtent"),n=this.formatMessage("nextExtent");return t.React.createElement("div",null,t.React.createElement("div",{role:"button",tabIndex:0,className:s,title:a,"aria-label":a,onClick:this.onClickPrevBtn,onKeyDown:this.onPrevBtnKeyDown},t.React.createElement(Ze,null)),t.React.createElement("div",{role:"button",tabIndex:0,className:o,title:n,"aria-label":n,onClick:this.onClickNextBtn,onKeyDown:this.onNextBtnKeyDown},t.React.createElement(et,null)))}formatMessage(e){return this.props.intl.formatMessage({id:e,defaultMessage:s.defaultMessages[e]})}componentDidMount(){this.bindView()}componentDidUpdate(){this.bindView()}bindView(){var e;const t=null===(e=this.props.jimuMapView)||void 0===e?void 0:e.view;this.view!==t&&(this.view&&(this.view.stationaryCallback=null),this.view=t,this.view&&(this.view.stationaryCallback=this.onViewStationary),this.updateByCurrentView())}updateByCurrentView(){this.forceUpdate()}isPrevBtnEnabled(){return this.view&&this.view.viewpointHistory.length>=2&&this.view.viewpointIndex>=1}isNextBtnEnabled(){return this.view&&this.view.viewpointHistory.length>=2&&this.view.viewpointIndex<this.view.viewpointHistory.length-1}},OverviewMap:class extends Z{constructor(e){super(e),this.toolName="OverviewMap",this.mouseDownOffsetXY=null,this.onSetRootDom=e=>{this.rootDom=e},this.onClickArrowIcon=()=>{this.setState({isOpened:!this.state.isOpened},(()=>{this.tryCreateNewSmallView()}))},this.onMouseDownOverviewFocusDom=e=>{this.boundMainJimuMapView&&this.smallView&&(this.mouseDownOffsetXY=this.getMouseEventRelativePosition(e,this.rootDom))},this.onBodyMouseMove=e=>{if(!this.mouseDownOffsetXY)return;const t=this.getMouseEventRelativePosition(e,this.rootDom),i=t[0]-this.mouseDownOffsetXY[0],s=t[1]-this.mouseDownOffsetXY[1];this.mixinUpdateOverviewFocusDomStyle({transform:`translate(${i}px, ${s}px)`})},this.onBodyMouseUp=e=>{var t,i;if(!this.mouseDownOffsetXY)return;if(!this.boundMainJimuMapView||!this.smallView)return;const s=this.boundMainJimuMapView.view,o=this.smallView,a=this.getMouseEventRelativePosition(e,this.rootDom),n=a[0]-this.mouseDownOffsetXY[0],r=a[1]-this.mouseDownOffsetXY[1];if(this.mouseDownOffsetXY=null,0===n&&0===r)this.mixinUpdateOverviewFocusDomStyle({transform:"none"});else{const e=o.resolution,a=e*n,l=-e*r,p=this.focusExtent.clone(),c=p.xmin+a,h=p.xmax+a,d=p.ymin+l,u=p.ymax+l;p.xmin=c,p.xmax=h,p.ymin=d,p.ymax=u,this.tempFixedFocusExtent=p;const m=this.tempFixedFocusExtent.center.clone();(null===(i=null===(t=s.map.ground)||void 0===t?void 0:t.layers)||void 0===i?void 0:i.length)>0?(s.center=m,this.tempFixedFocusExtent=null,this.onMainViewExtentChange()):s.goTo(m).finally((()=>{this.tempFixedFocusExtent=null,this.onMainViewExtentChange()}))}},this.state={apiLoaded:!1,isOpened:!1,smallViewStatus:nt.Initial,overviewFocusDomStyle:{}}}getStyle(){let e="left",i="right";return this.props.isRTL&&(e="right",i="left"),t.css`
      position: relative;
      overflow: visible;

      .overview-window {
        box-sizing: content-box;
        position: absolute;
        width: 200px;
        height: 200px;
        overflow: hidden;
        background: white;
        border: 1px solid var(--ref-palette-neutral-1200, #050505);

        .overview-map-container {
          pointer-events: none;
          width: 100%;
          height: 100%;
        }

        .overview-mask {
          position: absolute;
          left: 0;
          right: 0;
          top: 0;
          bottom: 0;
          width: 100%;
          height: 100%;

          .overview-focus {
            position: absolute;
            box-sizing: border-box;
            ${e}: 0;
            top: 0;
            width: 0;
            height: 0;
            background: rgba(0, 0, 0, 0.4);
            border: 1px solid var(--ref-palette-neutral-1200, #050505);
            cursor: move;
          }
        }
      }

      .overview-map-arrow-icon-btn {
        position: absolute;
        width: 14px !important;
        height: 14px !important;
        margin: 0 !important;
        padding: 0 !important;
        border: 0 !important;
        border-radius: 0 !important;
        background: var(--ref-palette-neutral-200) !important;

        .icon-btn-sizer {
          min-width: 0;
          min-height: 0;
          width: 100%;
          height: 100%;
          margin: 0;
          padding: 0;
          border: 0;
        }
      }

      &.small-view-not-created {
        .overview-focus {
          display: none !important;
        }
      }

      &.right-bottom-corner {
        .overview-window {
          ${i}: 0;
          bottom: 0;
        }

        .overview-map-arrow-icon-btn {
          ${i}: 1px;
          bottom: 1px;
        }
      }

      &.right-top-corner {
        .overview-window {
          ${i}: 0;
          top: 0;
        }

        .overview-map-arrow-icon-btn {
          ${i}: 1px;
          top: 1px;
        }
      }

      &.overview-map-tool-not-opened {
        .overview-window {
          visibility: hidden;
          pointer-events: none;
        }

        &.right-bottom-corner {
          .overview-map-arrow-icon-btn {
            ${i}: 0;
            bottom: 0;
          }
        }

        &.right-top-corner {
          .overview-map-arrow-icon-btn {
            ${i}: 0;
            top: 0;
          }
        }
      }
    `}getTitle(){return""}getIcon(){return null}getExpandPanel(){var e,i;const o=this.state.overviewFocusDomStyle||{},a=null===(e=this.props.toolJson)||void 0===e?void 0:e.isSecondLayout,n=this.state.smallViewStatus===nt.Created,r=(0,t.classNames)(["overview-map-tool",{"right-bottom-corner":!a},{"right-top-corner":a},{"overview-map-tool-not-opened":!this.state.isOpened},{"small-view-created":n},{"small-view-not-created":!n}]);let l="";l=a?this.state.isOpened?at:ot:this.state.isOpened?st:it;let p=s.defaultMessages.OverviewMapLabel||"";return this.props.intl&&(p=null===(i=this.props.intl)||void 0===i?void 0:i.formatMessage({id:"OverviewMapLabel",defaultMessage:p})),p||(p=""),(0,t.jsx)("div",{className:r,css:this.getStyle()},(0,t.jsx)("div",{className:"overview-window",ref:this.onSetRootDom},(0,t.jsx)("div",{className:"overview-mask"},(0,t.jsx)("div",{className:"overview-focus",style:o,onMouseDown:this.onMouseDownOverviewFocusDom}))),(0,t.jsx)(s.Button,{className:"overview-map-arrow-icon-btn",title:p,icon:!0,onClick:this.onClickArrowIcon},(0,t.jsx)(s.SVG,{className:"overview-map-arrow-icon",src:l,size:14,color:"var(--ref-palette-neutral-1100)"})))}componentDidMount(){document.body.addEventListener("mousemove",this.onBodyMouseMove,!1),document.body.addEventListener("mouseup",this.onBodyMouseUp,!1),this.loadAPIModules()}componentDidUpdate(e,t){const i=(null==t?void 0:t.apiLoaded)!==this.state.apiLoaded,s=(null==e?void 0:e.jimuMapView)||null,o=this.props.jimuMapView||null;(i||s!==o)&&this.tryCreateNewSmallView()}componentWillUnmount(){this.unmounted=!0,document.body.removeEventListener("mousemove",this.onBodyMouseMove,!1),document.body.removeEventListener("mouseup",this.onBodyMouseUp,!1),this.destroySmallView()}loadAPIModules(){return tt(this,void 0,void 0,(function*(){const e=yield(0,i.loadArcGISJSAPIModules)(["esri/Map","esri/views/MapView","esri/Basemap","esri/core/reactiveUtils"]);this.Map=e[0],this.MapView=e[1],this.Basemap=e[2],this.reactiveUtils=e[3],this.setState({apiLoaded:!0})}))}tryCreateNewSmallView(){return tt(this,void 0,void 0,(function*(){var e,t;if(!this.rootDom)return;if(!this.state.apiLoaded)return;const i=this.props.jimuMapView;if(!i)return void this.destroySmallView();const s=null===(t=null===(e=i.view)||void 0===e?void 0:e.map)||void 0===t?void 0:t.basemap;if(!s)return console.warn(`jimuMapView ${i.id} doesn't have basemap`),void this.destroySmallView();if(this.isMainJimuMapViewExpected(this.boundMainJimuMapView)&&this.isMainBasemapExpected(this.boundMainBasemap)&&this.state.smallViewStatus!==nt.Initial)return;if(this.destroySmallView(),!this.state.isOpened)return;const o=document.createElement("div");o.className="overview-map-container",this.rootDom.firstChild?this.rootDom.insertBefore(o,this.rootDom.firstChild):this.rootDom.appendChild(o),this.setState({smallViewStatus:nt.Creating}),this.boundMainJimuMapView=i,this.boundMainBasemap=s,yield i.whenJimuMapViewLoaded();const a=s.toJSON(),n=this.Basemap.fromJSON(a),r=new this.Map({basemap:n}),l=this.calSmallViewExtentByMainViewExtent(i.view),p=new this.MapView({container:o,map:r,extent:l,popupEnabled:!1,constraints:{rotationEnabled:!1,snapToZoom:!1},navigation:{browserTouchPanEnabled:!1,mouseWheelZoomEnabled:!1,momentumEnabled:!1}});p.ui.components=[];let c=null;try{yield p.when()}catch(e){c=e,console.error("can not create MapView for OverviewMap tool",e)}this.isMainJimuMapViewExpected(i)&&this.isMainBasemapExpected(s)?c?(this.smallView=null,this.setState({smallViewStatus:nt.CreateError})):(this.smallView=p,this.bindEventsToUpdateOverview(),this.setState({smallViewStatus:nt.Created})):o.parentElement&&o.parentElement.removeChild(o)}))}isMainJimuMapViewExpected(e){return e&&e===this.props.jimuMapView}isMainBasemapExpected(e){var t,i,s;return e&&e===(null===(s=null===(i=null===(t=this.props.jimuMapView)||void 0===t?void 0:t.view)||void 0===i?void 0:i.map)||void 0===s?void 0:s.basemap)}destroySmallView(){if(this.releaseHandles(),this.focusExtent=null,this.tempFixedFocusExtent=null,this.boundMainJimuMapView=null,this.boundMainBasemap=null,this.unmounted||this.setState({smallViewStatus:nt.Initial}),this.smallView){const e=this.smallView.container;this.smallView.destroyed||this.smallView.destroy(),e&&e.parentElement&&e.parentElement.removeChild(e),this.smallView=null}}releaseHandles(){this.watchMainViewBasemapChangeHandle&&(this.watchMainViewBasemapChangeHandle.remove(),this.watchMainViewBasemapChangeHandle=null),this.watchMainViewExtentChangeHandle&&(this.watchMainViewExtentChangeHandle.remove(),this.watchMainViewExtentChangeHandle=null),this.watchSmallViewExtentChangeHandle&&(this.watchSmallViewExtentChangeHandle.remove(),this.watchSmallViewExtentChangeHandle=null)}bindEventsToUpdateOverview(){this.releaseHandles();const e=this.boundMainJimuMapView.view,t=this.smallView;this.watchMainViewBasemapChangeHandle=this.reactiveUtils.watch((()=>{var t;return null===(t=null==e?void 0:e.map)||void 0===t?void 0:t.basemap}),(()=>{this.tryCreateNewSmallView()})),this.watchMainViewExtentChangeHandle=this.reactiveUtils.watch((()=>null==e?void 0:e.extent),(()=>{this.onMainViewExtentChange()})),this.watchSmallViewExtentChangeHandle=this.reactiveUtils.watch((()=>null==t?void 0:t.extent),(()=>{this.updateOverviewFocusByMainViewExtent()})),this.onMainViewExtentChange(),this.updateOverviewFocusByMainViewExtent()}onMainViewExtentChange(){if(!this.boundMainJimuMapView||!this.smallView)return;if(this.mouseDownOffsetXY)return;const e=this.calSmallViewExtentByMainViewExtent(this.boundMainJimuMapView.view);this.smallView.extent=e,this.updateOverviewFocusByMainViewExtent()}calSmallViewExtentByMainViewExtent(e){return this.getHandledMainViewExtent(e).clone().expand(3)}getHandledMainViewExtent(e){let t=null;if("2d"===e.type&&0!==e.rotation){const[i,s]=e.size,o=e.toMap({x:0,y:0}),a=e.toMap({x:i,y:0}),n=e.toMap({x:i,y:s}),r=e.toMap({x:0,y:s}),l=[o.x,a.x,n.x,r.x],p=[o.y,a.y,n.y,r.y],c=Math.min(...l),h=Math.max(...l),d=Math.min(...p),u=Math.max(...p);t=e.extent.clone(),t.xmin=c,t.xmax=h,t.ymin=d,t.ymax=u}else t=e.extent.clone();return t}mixinUpdateOverviewFocusDomStyle(e){const t=Object.assign({},this.state.overviewFocusDomStyle,e);this.setState({overviewFocusDomStyle:t})}updateOverviewFocusByMainViewExtent(){const e=this.boundMainJimuMapView.view,t=(this.tempFixedFocusExtent||this.getHandledMainViewExtent(e)).clone();this.updateOverviewFocusDomPosition(t)}updateOverviewFocusDomPosition(e){const t=this.smallView;this.focusExtent=e.clone();const i=this.focusExtent.center.clone(),s=i.clone();s.x=this.focusExtent.xmin,s.y=this.focusExtent.ymax;const o=i.clone();o.x=this.focusExtent.xmax,o.y=this.focusExtent.ymin;const a=t.toScreen(s),n=t.toScreen(o);let r=!1;const[l,p]=t.size;if(a&&n){const e=a.x<n.x,t=a.y<n.y;if(e&&t){r=!(a.x<0&&n.x>l&&a.y<0&&n.y>p)}}const c={transform:"none"};if(r){const e=n.x-a.x,t=n.y-a.y;c.left=`${a.x}px`,c.top=`${a.y}px`,c.width=`${e}px`,c.height=`${t}px`,c.display="block"}else c.display="none";this.mixinUpdateOverviewFocusDomStyle(c)}getMouseEventRelativePosition(e,t){const{offsetX:i,offsetY:s}=e;if(e.target===t)return[i,s];const o=t.getBoundingClientRect();return[e.clientX-o.x,e.clientY-o.y]}}},lt=rt;class pt extends G{render(){const e=lt[this.props.toolName];let i=!0;if(i=!!e&&(!e.isAvailable||e.isAvailable(this.props)),i){const i=`exbmap-ui exbmap-ui-tool-shell divitem exbmap-ui-tool-shell-${this.props.toolName}`,s=this.props.layoutConfig.elements[this.props.toolName],o=s.style||{};return(0,t.jsx)("div",{className:(0,t.classNames)(this.props.className,i,s.className,{"exbmap-ui-hidden-element":this.props.isHidden,"rounded-pill":["Compass"].includes(this.props.toolName)}),style:o},(0,t.jsx)(e,{mapWidgetId:this.props.mapWidgetId,toolJson:s,toolName:this.props.toolName,isMobile:this.props.isMobile,jimuMapView:this.props.jimuMapView,activeToolInfo:this.props.activeToolInfo,onActiveToolInfoChange:this.props.onActiveToolInfoChange,intl:this.props.intl,theme:this.props.theme,autoControlWidgetId:this.props.autoControlWidgetId,isRTL:this.props.isRTL,onMouseOverPopper:this.props.onMouseOverPopper,onMouseOutPopper:this.props.onMouseOutPopper}))}return this.props.isMobile?(0,t.jsx)("span",null):null}}class ct extends G{getStyle(){const e=this.props.layoutConfig.elements[this.props.groupName],i=e.direction,s=this.props.isRTL,o="vertical"===i;let a="";a=o?"column":s?"row-reverse":"row";let n="flex-start";return o&&(e.isVerticalRrlAlignItemsStart&&(n=s?"flex-end":"flex-start"),e.isVerticalRrlAlignItemsEnd&&(n=s?"flex-start":"flex-end")),t.css`

      display: flex;
      flex-flow: ${a};
      align-items: ${n};

      .exbmap-ui-group-expand-icon {
        fill: black;
        left: 8px;
        top: 8px;
        position: absolute;
        display: block;
      }

      .expand-mobile-panel {
        box-shadow: rgba(0, 0, 0, 0.3) 0px 0px 2px;
        border-radius: 10px 10px 0px 0px;
      }

      .expand-mobile-panel-transition {
        transition: height 0.3s;
      }

      .expand-mobile-panel-touch-container {
        top: 0;
        position: absolute;
        width: 100%;
        height: 31px;
      }

      .expand-mobile-panel-bar {
        width: 36px;
        height: 4px;
        background-color: #434343;
        border-radius: 2px;
      }
      `}constructor(e){super(e),this.reactResizeDetectorRef=t.React.createRef(),this.groupConRef=t.React.createRef(),this.checkIsHiddenElement=e=>!!this.props.hiddenElementNames&&!!this.props.hiddenElementNames.includes(e),this.checkResponsive=()=>{if(!this.props.onSetHiddenElementNames)return;if(!this.props.isMainGroup||!this.props.isMobile)return void this.props.onSetHiddenElementNames([]);const e=this.props.layoutConfig.mobileResponsiveStrategy,t=this.state.widgetHeight;let i=[];t>=465?i=[]:t>=400&&t<465?i=(null==e?void 0:e.stage1)||[]:t>=320&&t<400?i=(null==e?void 0:e.stage2)||[]:t>=250&&t<320?i=(null==e?void 0:e.stage3)||[]:t>=160&&t<250?i=(null==e?void 0:e.stage4)||[]:t>=54&&t<160?i=(null==e?void 0:e.stage5)||[]:t<54&&(i=(null==e?void 0:e.stage6)||[]),this.props.onSetHiddenElementNames(i)},this.onResize=({width:e,height:t})=>{e&&t&&this.setState({widgetWidth:e,widgetHeight:t},(()=>{this.checkResponsive()}))},this.returnNullNode=e=>this.props.isMobile?(0,t.jsx)("span",{key:e}):null,this.checkIsLastElement=(e,t)=>{const i=t.toolName,s=this.props.layoutConfig,o=s.layout[e.groupName].children,a=o.indexOf(i);if(a===o.length-1)return!0;if(a<o.length-1){let e=!0;for(let t=a+1;t<o.length;t++){const i=o[t];if("GROUP"!==s.elements[o[t]].type&&(!lt[i].getIsNeedSetting()||this.props.toolConfig&&this.props.toolConfig[`can${i}`]||s.lockToolNames&&s.lockToolNames.includes(i))){e=!1;break}}return e}},this.handleToggleMobilePanel=()=>{this.props.onActiveToolInfoChange(null)},this.handlePanelHeightChange=({width:e,height:t})=>{this.setState({bottomPanelHeight:t},(()=>{this.checkResponsive()}))},this.getMobilePanelInContext=()=>(0,t.jsx)(N.Consumer,null,(({mobilePanelContainer:e,mapWidgetId:i})=>(0,t.jsx)(s.MobilePanel,{className:"map-tool-mobile-panel",mapWidgetId:i,title:this.props.activeToolInfo&&this.props.activeToolInfo.activeToolTitle,open:!!this.props.activeToolInfo,onClose:()=>{this.handleToggleMobilePanel()}},(0,t.jsx)("div",{className:"w-100 h-100",ref:t=>{e&&t&&t.appendChild(e)}})))),this.getGroupContent=e=>{if(e){const i=e.layout[this.props.groupName]&&e.layout[this.props.groupName].children;if(this.checkIsShowGroup(e,i)){const s=(0,t.classNames)(`exbmap-ui exbmap-ui-group exbmap-ui-group-${this.props.groupName}`,this.props.className,{"exbmap-ui-hidden-element":this.props.isHidden}),o=this.props.layoutConfig.elements[this.props.groupName].style||{};return(0,t.jsx)("div",{id:this.props.isMainGroup?this.props.mapWidgetId:void 0,css:this.getStyle(),className:s,style:o,ref:this.groupConRef},i.map(((i,s)=>{var o,a;if(!e.elements[i])return this.returnNullNode(s);if("GROUP"===e.elements[i].type)return(0,t.jsx)(ct,{mapWidgetId:this.props.mapWidgetId,isHidden:this.checkIsHiddenElement(i),className:e.elements[i].className,style:e.elements[i].style,key:s,layoutConfig:e,toolConfig:this.props.toolConfig,isMobile:this.props.isMobile,intl:this.props.intl,jimuMapView:this.props.jimuMapView,groupName:i,activeToolInfo:this.props.activeToolInfo,hiddenElementNames:this.props.hiddenElementNames,onActiveToolInfoChange:this.props.onActiveToolInfoChange,theme:this.props.theme,isThumbMap:this.props.isMainGroup?this.state.isThumbMap:this.props.isThumbMap,autoControlWidgetId:this.props.autoControlWidgetId,isRTL:this.props.isRTL,onMouseOverPopper:this.props.onMouseOverPopper,onMouseOutPopper:this.props.onMouseOutPopper});if("TOOL"===e.elements[i].type){const n=e.elements[i].toolName,r=null===(a=null===(o=this.props.jimuMapView)||void 0===o?void 0:o.view)||void 0===a?void 0:a.type;return"Navigation"===n&&"2d"===r||"ScaleBar"===n&&"3d"===r?this.returnNullNode(s):!lt[i].getIsNeedSetting()||this.props.toolConfig&&this.props.toolConfig[`can${i}`]||e.lockToolNames&&e.lockToolNames.includes(i)?(0,t.jsx)(pt,{mapWidgetId:this.props.mapWidgetId,isHidden:this.checkIsHiddenElement(i),key:s,layoutConfig:e,activeToolInfo:this.props.activeToolInfo,toolConfig:this.props.toolConfig,jimuMapView:this.props.jimuMapView,toolName:i,theme:this.props.theme,onActiveToolInfoChange:this.props.onActiveToolInfoChange,intl:this.props.intl,isMobile:this.props.isMobile,isLastElement:this.checkIsLastElement(e.elements[this.props.groupName],e.elements[i]),autoControlWidgetId:this.props.autoControlWidgetId,isRTL:this.props.isRTL,onMouseOverPopper:this.props.onMouseOverPopper,onMouseOutPopper:this.props.onMouseOutPopper}):this.returnNullNode(s)}return this.returnNullNode(s)})),this.props.isMainGroup&&this.props.isMobile&&(0,t.jsx)(t.ReactResizeDetector,{targetRef:this.groupConRef,handleWidth:!0,handleHeight:!0,onResize:this.onResize}),this.props.isMainGroup&&this.props.isMobile&&this.props.activeToolInfo&&"Select"!==this.props.activeToolInfo.activeToolName&&this.getMobilePanelInContext(),this.props.isMainGroup&&(0,t.jsx)("div",{className:"exbmap-ui w-100",style:{position:"relative",pointerEvents:"auto",overflow:"hidden",touchAction:"none",display:!this.props.isMobile||this.state.isThumbMap||this.props.isThumbMap?"none":"block"}},(0,t.jsx)("div",{className:`${this.props.mapWidgetId}-bottom-panel exbmap-ui w-100 expand-mobile-panel`,style:{overflow:"hidden",pointerEvents:"auto",position:"relative",touchAction:"none"}},(0,t.jsx)("div",{className:"w-100 h-100",ref:this.reactResizeDetectorRef},(0,t.jsx)(t.ReactResizeDetector,{targetRef:this.reactResizeDetectorRef,handleHeight:!0,onResize:this.handlePanelHeightChange})))))}return this.returnNullNode()}return this.returnNullNode()},this.checkIsShowGroup=(e,t)=>{if(t&&0!==t.length){const i=[];this.findAllToolNames(e,t,i);let s=!1;for(let t=0;t<i.length;t++)if(this.props.toolConfig[`can${i[t]}`]||!lt[i[t]].getIsNeedSetting()||e.lockToolNames&&e.lockToolNames.includes(i[t])){s=!0;break}return s}return!1},this.findAllToolNames=(e,t,i)=>{if(t&&0!==t.length)for(let s=0;s<t.length;s++){const o=t[s],a=e.elements[o];if("GROUP"===a.type){const t=a.groupName;this.findAllToolNames(e,e.layout[t]&&e.layout[t].children,i)}else i.push(t[s])}},this.state={bottomPanelHeight:0,isThumbMap:!!this.props.isMobile}}componentDidMount(){this.checkResponsive()}render(){return this.props.isMainGroup&&this.props.isMobile&&this.props.toolConfig&&this.props.toolConfig.canSelect?(0,t.jsx)("div",{style:{position:"absolute",top:0,left:0,bottom:0,right:0}},(0,t.jsx)("div",{id:`${this.props.mapWidgetId}-with-select-container`,style:{position:"absolute",top:0,left:0,bottom:0,right:0}},(0,t.jsx)("div",{className:"w-100 h-100",style:{position:"relative"}},this.getGroupContent(this.props.layoutConfig)))):this.getGroupContent(this.props.layoutConfig)}}class ht extends t.React.PureComponent{constructor(e){super(e),this.getMaxHeightForPcExpand=e=>{if(e){if(e<65)return null;{const t=e-65;return t<300?t:300}}return null},this.handSetHiddenElementNames=e=>{this.setState({hiddenElementNames:e})},this.state={toolsContentInMobileExpandPanel:null,hiddenElementNames:[]}}getStyle(){return t.css`
      z-index: 8;
      pointer-events: none;

      .expand-panel-transition {
        transition: opacity 0.3s, right 0.3s;
      }

      .scale-attribution-xy-group {
        > div:first-of-type:nth-last-of-type(1) {
          width: 100%;
          max-width: 100% !important;
        }
      }

      .exbmap-ui-hidden-element {
        display: none !important;
      }

      .exbmap-ui-pc-expand-maxheight {
        max-height: ${this.getMaxHeightForPcExpand(this.props.widgetHeight)}px;
        overflow: auto
      }
      `}getLayoutContent(e){return e&&this.props.toolConfig?(0,t.jsx)("div",{className:"exbmap-ui esri-ui-inner-container map-tool-layout",css:this.getStyle()},Object.keys(e.layout).map(((i,s)=>{var o;const a=e.elements[i],n=e.layout[i];if(!a||"GROUP"!==a.type||!n.isMainGroup)return null;const r=(0,t.getAppStore)().getState(),l=(null===(o=null==r?void 0:r.appContext)||void 0===o?void 0:o.isRTL)||!1;return(0,t.jsx)(ct,{mapWidgetId:this.props.mapWidgetId,className:a.className,style:a.style,isMobile:this.props.isMobile,isMainGroup:!0,key:s,layoutConfig:e,toolConfig:this.props.toolConfig,activeToolInfo:this.props.activeToolInfo,jimuMapView:this.props.jimuMapView,groupName:i,onActiveToolInfoChange:this.props.onActiveToolInfoChange,hiddenElementNames:e.mobileResponsiveStrategy&&this.state.hiddenElementNames,intl:this.props.intl,onSetHiddenElementNames:this.handSetHiddenElementNames,theme:this.props.theme,autoControlWidgetId:this.props.autoControlWidgetId,isRTL:l,onMouseOverPopper:this.props.onMouseOverPopper,onMouseOutPopper:this.props.onMouseOutPopper})}))):null}componentDidUpdate(e){e.appMode!==this.props.appMode&&this.props.appMode===t.AppMode.Design&&this.props.onActiveToolInfoChange(null)}render(){return this.getLayoutContent(this.props.layoutConfig)}}const dt=[{elements:{leftTopContainer:{type:"GROUP",groupName:"leftTopContainer",direction:"horizontal",style:{position:"absolute",top:"15px",left:"15px"}},navigator:{type:"GROUP",groupName:"navigator",direction:"vertical",style:{marginRight:"10px"}},interact:{type:"GROUP",groupName:"interact",direction:"vertical",isResponsive:!0,style:{position:"absolute",top:"15px",right:"15px"}},bottom:{type:"GROUP",groupName:"bottom",direction:"vertical",className:"w-100",style:{position:"absolute",bottom:"0px",left:"0px"}},"bottom-line1":{type:"GROUP",groupName:"bottom-line1",direction:"horizontal",className:"d-flex align-items-center justify-content-between w-100 scale-attribution-xy-group",style:{marginBottom:"0px",marginTop:"0px"}},"bottom-line2":{type:"GROUP",groupName:"bottom-line2",direction:"horizontal",className:"d-flex align-items-end justify-content-between w-100",style:{paddingLeft:"15px",paddingRight:"15px",marginBottom:"10px"}},"SelectState-FullScreen-Container":{type:"GROUP",groupName:"SelectState-FullScreen-Container",direction:"vertical",isVerticalRrlAlignItemsEnd:!0},attributionGroup:{type:"GROUP",groupName:"attributionGroup",direction:"horizontal",style:{maxWidth:"60%"}},overviewMapContainer:{type:"GROUP",groupName:"overviewMapContainer",direction:"horizontal",style:{position:"absolute",right:"0px",bottom:"16px"}},Zoom:{type:"TOOL",toolName:"Zoom",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginBottom:"10px"}},Home:{type:"TOOL",toolName:"Home",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginBottom:"10px"}},Compass:{type:"TOOL",toolName:"Compass",isOnlyExpanded:!0,isShowIconTitle:!1},Navigation:{type:"TOOL",toolName:"Navigation",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginBottom:"10px"}},Locate:{type:"TOOL",toolName:"Locate",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginBottom:"10px"}},Layers:{type:"TOOL",toolName:"Layers",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginBottom:"10px"}},BaseMap:{type:"TOOL",toolName:"BaseMap",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginBottom:"10px"}},Select:{type:"TOOL",toolName:"Select",isOnlyExpanded:!0,isShowIconTitle:!0},SelectState:{type:"TOOL",toolName:"SelectState",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px",boxShadow:"0 1px 2px 0 rgba(0,0,0,0)"}},ExtentNavigate:{type:"TOOL",toolName:"ExtentNavigate",isOnlyExpanded:!0,isShowIconTitle:!0,style:{marginBottom:"10px"}},Measure:{type:"TOOL",toolName:"Measure",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start"},MapSwitch:{type:"TOOL",toolName:"MapSwitch",isOnlyExpanded:!0,isShowIconTitle:!0},FullScreen:{type:"TOOL",toolName:"FullScreen",isOnlyExpanded:!1,isShowIconTitle:!0},ClearActionData:{type:"TOOL",toolName:"ClearActionData",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},ScaleBar:{type:"TOOL",toolName:"ScaleBar",isOnlyExpanded:!0,isShowIconTitle:!1},Attribution:{type:"TOOL",toolName:"Attribution",isOnlyExpanded:!0,isShowIconTitle:!1,className:"w-100"},Search:{type:"TOOL",toolName:"Search",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginBottom:"10px"}},OverviewMap:{type:"TOOL",toolName:"OverviewMap",isOnlyExpanded:!0,isShowIconTitle:!1,isSecondLayout:!1}},layout:{leftTopContainer:{isMainGroup:!0,children:["navigator","Select"]},navigator:{children:["Zoom","Home","Navigation","ExtentNavigate","Locate","Compass"]},interact:{isMainGroup:!0,children:["Search","Layers","BaseMap","Measure"]},"bottom-line1":{children:["ScaleBar","attributionGroup"]},"bottom-line2":{children:["MapSwitch","SelectState-FullScreen-Container"]},"SelectState-FullScreen-Container":{children:["FullScreen","ClearActionData","SelectState"]},bottom:{isMainGroup:!0,children:["bottom-line2","bottom-line1"]},attributionGroup:{children:["Attribution"]},overviewMapContainer:{isMainGroup:!0,children:["OverviewMap"]}}},{elements:{navigator:{type:"GROUP",groupName:"navigator",direction:"vertical",isVerticalRrlAlignItemsEnd:!0},interact:{type:"GROUP",groupName:"interact",direction:"horizontal",isResponsive:!0,style:{position:"absolute",top:"15px",left:"15px"}},fullScreenGroup:{type:"GROUP",groupName:"fullScreenGroup",direction:"horizontal",style:{position:"absolute",top:"15px",right:"15px"}},bottom:{type:"GROUP",groupName:"bottom",direction:"vertical",className:"w-100",style:{position:"absolute",bottom:"0px",left:"0px"}},"bottom-line1":{type:"GROUP",groupName:"bottom-line1",direction:"horizontal",className:"d-flex align-items-center justify-content-between w-100 scale-attribution-xy-group",style:{marginBottom:"0px",marginTop:"0px"}},"bottom-line2":{type:"GROUP",groupName:"bottom-line2",direction:"horizontal",className:"d-flex align-items-end justify-content-between w-100",style:{paddingLeft:"15px",paddingRight:"15px",marginBottom:"10px"}},attributionGroup:{type:"GROUP",groupName:"attributionGroup",direction:"horizontal",style:{maxWidth:"60%"},className:"attibute-group"},overviewMapContainer:{type:"GROUP",groupName:"overviewMapContainer",direction:"horizontal",style:{position:"absolute",right:"0px",top:"0px"}},Zoom:{type:"TOOL",toolName:"Zoom",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},Home:{type:"TOOL",toolName:"Home",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},Compass:{type:"TOOL",toolName:"Compass",isOnlyExpanded:!0,isShowIconTitle:!1},Navigation:{type:"TOOL",toolName:"Navigation",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},Locate:{type:"TOOL",toolName:"Locate",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},ExtentNavigate:{type:"TOOL",toolName:"ExtentNavigate",isOnlyExpanded:!0,isShowIconTitle:!0,style:{marginTop:"10px"}},Layers:{type:"TOOL",toolName:"Layers",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"bottom",style:{marginRight:"10px"}},BaseMap:{type:"TOOL",toolName:"BaseMap",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"bottom",style:{marginRight:"10px"}},Select:{type:"TOOL",toolName:"Select",isOnlyExpanded:!0,isShowIconTitle:!0},SelectState:{type:"TOOL",toolName:"SelectState",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px",boxShadow:"0 1px 2px 0 rgba(0,0,0,0)"}},Measure:{type:"TOOL",toolName:"Measure",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"bottom",style:{marginRight:"10px"}},MapSwitch:{type:"TOOL",toolName:"MapSwitch",isOnlyExpanded:!0,isShowIconTitle:!0},FullScreen:{type:"TOOL",toolName:"FullScreen",isOnlyExpanded:!1,isShowIconTitle:!0},ClearActionData:{type:"TOOL",toolName:"ClearActionData",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginLeft:"10px"}},ScaleBar:{type:"TOOL",toolName:"ScaleBar",isOnlyExpanded:!0,isShowIconTitle:!1},Attribution:{type:"TOOL",toolName:"Attribution",isOnlyExpanded:!0,isShowIconTitle:!1,className:"w-100"},Search:{type:"TOOL",toolName:"Search",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"bottom",style:{marginRight:"10px"}},OverviewMap:{type:"TOOL",toolName:"OverviewMap",isOnlyExpanded:!0,isShowIconTitle:!1,isSecondLayout:!0}},layout:{navigator:{children:["Compass","Locate","ExtentNavigate","Navigation","Zoom","Home","SelectState"]},interact:{isMainGroup:!0,children:["Search","Layers","BaseMap","Measure","Select"]},fullScreenGroup:{isMainGroup:!0,children:["FullScreen","ClearActionData"]},"bottom-line1":{children:["ScaleBar","attributionGroup"]},"bottom-line2":{children:["MapSwitch","navigator"]},bottom:{isMainGroup:!0,children:["bottom-line2","bottom-line1"]},attributionGroup:{children:["Attribution"]},overviewMapContainer:{isMainGroup:!0,children:["OverviewMap"]}}}],ut=[{elements:{mainGroup:{type:"GROUP",groupName:"mainGroup",direction:"vertical",className:"d-flex flex-column",style:{position:"absolute",top:"0px",left:"0px",bottom:"0px",right:"0px"}},topGroup:{type:"GROUP",groupName:"topGroup",direction:"horizontal",className:"d-flex w-100 align-items-center justify-content-between",style:{padding:"10px 10px 0 10px"}},midGroup:{type:"GROUP",groupName:"midGroup",direction:"horizontal",className:"flex-grow-1 d-flex w-100 justify-content-between",style:{position:"relative"}},bottomGroup:{type:"GROUP",groupName:"bottomGroup",direction:"horizontal",className:"d-flex w-100 align-items-center justify-content-between"},"midGroup-left-top":{type:"GROUP",groupName:"midGroup-left-top",direction:"vertical",style:{position:"absolute",left:"0px",top:"0px"}},"midGroup-left-bottom":{type:"GROUP",groupName:"midGroup-left-bottom",direction:"vertical",className:"d-flex flex-column",isVerticalRrlAlignItemsStart:!0,style:{position:"absolute",left:"0px",bottom:"0px"}},"midGroup-right-content-top":{type:"GROUP",groupName:"midGroup-right-content-top",direction:"vertical",style:{position:"absolute",top:"0px",right:"10px"}},"midGroup-right-content-bottom":{type:"GROUP",groupName:"midGroup-right-content-bottom",direction:"vertical",style:{position:"absolute",bottom:"10px",right:"10px"}},Search:{type:"TOOL",toolName:"Search",isOnlyExpanded:!0,isShowIconTitle:!1,className:"flex-grow-1"},FullScreen:{type:"TOOL",toolName:"FullScreen",isOnlyExpanded:!1,isShowIconTitle:!0,style:{marginLeft:"10px"}},Locate:{type:"TOOL",toolName:"Locate",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},ClearActionData:{type:"TOOL",toolName:"ClearActionData",isOnlyExpanded:!0,isShowIconTitle:!1},Compass:{type:"TOOL",toolName:"Compass",isOnlyExpanded:!0,isShowIconTitle:!1,className:"mb-0",style:{marginLeft:"10px",marginTop:"10px"}},MapSwitch:{type:"TOOL",toolName:"MapSwitch",isOnlyExpanded:!0,isShowIconTitle:!0,style:{marginLeft:"10px",marginBottom:"10px"}},Zoom:{type:"TOOL",toolName:"Zoom",isOnlyExpanded:!0,isShowIconTitle:!1},Home:{type:"TOOL",toolName:"Home",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},ExtentNavigate:{type:"TOOL",toolName:"ExtentNavigate",isOnlyExpanded:!0,isShowIconTitle:!0,style:{marginLeft:"10px",marginBottom:"10px"}},Layers:{type:"TOOL",toolName:"Layers",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginTop:"10px"}},BaseMap:{type:"TOOL",toolName:"BaseMap",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginTop:"10px"}},Select:{type:"TOOL",toolName:"Select",isOnlyExpanded:!0,isShowIconTitle:!1,style:{marginTop:"10px"}},SelectState:{type:"TOOL",toolName:"SelectState",isOnlyExpanded:!0,isShowIconTitle:!1,style:{width:"100%"}},Measure:{type:"TOOL",toolName:"Measure",isOnlyExpanded:!1,isShowIconTitle:!0,panelPlacement:"left-start",style:{marginTop:"10px"}},ScaleBar:{type:"TOOL",toolName:"ScaleBar",isOnlyExpanded:!0,isShowIconTitle:!1}},layout:{mainGroup:{isMainGroup:!0,children:["topGroup","midGroup","bottomGroup"]},topGroup:{children:["Search","FullScreen"]},midGroup:{children:["midGroup-left-top","midGroup-left-bottom","midGroup-right-content-top","midGroup-right-content-bottom"]},"midGroup-left-top":{children:["Compass"]},"midGroup-left-bottom":{children:["ExtentNavigate","MapSwitch","ScaleBar"]},"midGroup-right-content-top":{children:["Layers","BaseMap","Measure","Select"]},"midGroup-right-content-bottom":{children:["Zoom","Home","Locate","ClearActionData"]},bottomGroup:{children:["SelectState"]}},mobileResponsiveStrategy:{stage1:["Measure","Locate"],stage2:["Measure","Select","Locate","bottomGroup"],stage3:["ExtentNavigate","midGroup-right-content-top","Locate","bottomGroup"],stage4:["MapSwitch","midGroup-right-content-top","Home","Locate","ClearActionData","bottomGroup"],stage5:["midGroup","bottomGroup"],stage6:["topGroup","midGroup","bottomGroup"]},lockToolNames:[]}];var mt=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};const gt={firstMapVisible:[{zIndex:"unset",opacity:1},{zIndex:-1,opacity:0}],secondMapVisible:[{zIndex:-1,opacity:0},{zIndex:"unset",opacity:1}]};class vt extends t.React.PureComponent{constructor(e){super(e),this.mutableStatePropsMap={},this.__unmount=!1,this.dateOfMouseOverPopper=null,this.dateOfMouseOutPopper=null,this.onPageChange=(e,t)=>{e&&t&&e!==t&&this.setState({activeToolInfo:null})},this.onResize=({width:e,height:t})=>{let i=!1;const s=Date.now();if(this.dateOfMouseOverPopper){s-this.dateOfMouseOverPopper.getTime()<=100&&(i=!0)}if(this.dateOfMouseOutPopper){s-this.dateOfMouseOutPopper.getTime()<=100&&(i=!0)}i&&e>0&&t>0||this.setState({activeToolInfo:null})},this.onMouseOverPopper=()=>{this.dateOfMouseOverPopper=new Date},this.onMouseOutPopper=()=>{this.dateOfMouseOutPopper=new Date},this.reInitWidgetInstance=e=>{this.state=e,this.isReIniting=!0},this.changeInitialMapDataSourceID=(e,t)=>{var i,s;if(this.props.baseWidgetProps.useDataSources&&this.props.baseWidgetProps.useDataSources.length>1){const o=null===(i=this.firstMapInstance)||void 0===i?void 0:i.current,a=null===(s=this.secondMapInstance)||void 0===s?void 0:s.current;if(!o||!a)return void(t&&t());this.state.currentMapIndex?this.state.firstMapDsId&&this.state.firstMapDsId===e?(this.startChangeInitialMapAnimation(t),o.goHome(!1)):a.goHome(!1):this.state.secondMapDsId&&this.state.secondMapDsId===e?(this.startChangeInitialMapAnimation(t),a.goHome(!1)):o.goHome(!1)}},this.startChangeInitialMapAnimation=e=>{var t,i;const s=null===(t=this.firstMapInstance)||void 0===t?void 0:t.current,o=null===(i=this.secondMapInstance)||void 0===i?void 0:i.current;if(!s||!o)return void(e&&e());const a=Object.assign({},this.state);if(this.state.currentMapIndex){a.currentMapIndex=0,a.multiMapStyle=gt.firstMapVisible;const t=o.getViewPoint();t&&s.setViewPoint(t),this.setState(a,(()=>{e&&e()}))}else{a.currentMapIndex=1,a.multiMapStyle=gt.secondMapVisible;const t=s.getViewPoint();t&&o.setViewPoint(t),this.setState(a,(()=>{e&&e()}))}},this.switchMap=(...e)=>mt(this,[...e],void 0,(function*(e=!1){var t,i;if(!this.props.baseWidgetProps.useDataSources||this.props.baseWidgetProps.useDataSources.length<2)return void(yield Promise.resolve());const s=null===(t=this.firstMapInstance)||void 0===t?void 0:t.current,o=null===(i=this.secondMapInstance)||void 0===i?void 0:i.current;if(!s||!o)return;const a=Object.assign({},this.state);if(a.useAnimation=!e,this.state.currentMapIndex){a.currentMapIndex=0,a.multiMapStyle=gt.firstMapVisible;const e=o.getViewPoint();e&&s.setViewPoint(e)}else{a.currentMapIndex=1,a.multiMapStyle=gt.secondMapVisible;const e=s.getViewPoint();e&&o.setViewPoint(e)}return new Promise(((e,t)=>{this.setState(a,(()=>{this.confirmJimuMapViewIsActive(),setTimeout((()=>{this.setState({useAnimation:!1},(()=>{e(null)}))}),500)}))}))})),this.handleMutableStatePropsChanged=(e,i,s)=>{var o,a;this.mutableStatePropsMap[i]?this.mutableStatePropsMap[i].includes(e)||this.mutableStatePropsMap[i].push(e):this.mutableStatePropsMap[i]=[e];const n=[],r=null===(o=this.firstMapInstance)||void 0===o?void 0:o.current,l=null===(a=this.secondMapInstance)||void 0===a?void 0:a.current;r&&r.getViewType()&&n.push(this.state.firstMapDsId),l&&l.getViewType()&&n.push(this.state.secondMapDsId);let p=!0;for(let e=0;e<n.length;e++)if(!this.mutableStatePropsMap[i].includes(n[e])){p=!1;break}p&&(delete this.mutableStatePropsMap[i],t.MutableStoreManager.getInstance().updateStateValue(this.props.baseWidgetProps.id,i,s))},this.onMapbaseExtentChanged=(e,i)=>{var s,o;if(this.getCurrentVisibleDsId()===e){const a=i.viewpoint.clone();t.MessageManager.getInstance().publishMessage(i);let n=null;this.state.firstMapDsId&&this.state.firstMapDsId!==e?n=null===(s=this.firstMapInstance)||void 0===s?void 0:s.current:this.state.secondMapDsId&&this.state.secondMapDsId!==e&&(n=null===(o=this.secondMapInstance)||void 0===o?void 0:o.current),n&&n.setViewPoint(a)}},this.handleMapLoaded=(e,t)=>{this.forceUpdate()},this.handleJimuMapViewCreated=e=>{this.props.onJimuMapViewCreated&&this.props.onJimuMapViewCreated(e),this.__unmount||this.confirmJimuMapViewIsActive()},this.confirmJimuMapViewIsActive=()=>{if(this.props.isDefaultMap){const e=this.getJimuMapViewByDataSourceId(null);return void(e&&this.setActiveJimuMapView(e,!0))}const e=[];this.state.firstMapDsId&&e.push(this.state.firstMapDsId),this.state.secondMapDsId&&e.push(this.state.secondMapDsId);const t=this.getCurrentVisibleDsId();for(let i=0;i<e.length;i++){const s=this.getJimuMapViewByDataSourceId(e[i]);s&&(e[i]===t?this.setActiveJimuMapView(s,!0):this.setActiveJimuMapView(s,!1))}},this.isShowMapSwitchBtn=()=>{var e,t;const i=null===(e=this.firstMapInstance)||void 0===e?void 0:e.current,s=null===(t=this.secondMapInstance)||void 0===t?void 0:t.current;return!(!i||!s)&&(i.getMapLoadStatus()!==F.Loading&&s.getMapLoadStatus()!==F.Loading||void 0)},this.getCurrentVisibleDsId=()=>1===this.state.multiMapStyle[0].opacity?this.state.firstMapDsId:this.state.secondMapDsId,this.handleViewGroupCreate=e=>{this.props.onViewGroupCreate&&this.props.onViewGroupCreate(e)},this.handleMobilePanelContentChange=e=>{this.setState({mobilePanelContent:e})},this.handleActiveToolInfoChange=e=>{this.setState({activeToolInfo:e})},this.domRef=t.React.createRef(),this.firstMapInstance=t.React.createRef(),this.secondMapInstance=t.React.createRef();const i=this.props.baseWidgetProps.id;"number"==typeof vt.runtimeInitedMapWidgets[i]?vt.runtimeInitedMapWidgets[i]+=1:vt.runtimeInitedMapWidgets[i]=1;const s=t.MutableStoreManager.getInstance().getStateValue([this.props.baseWidgetProps.id,"restoreData",`${this.props.baseWidgetProps.id}-restoreData-multimap`]);if(s){const e=document.createElement("div");e.id=`${this.props.baseWidgetProps.id}-bottom-panel`,e.className="w-100 h-100",s.mobilePanelContainer=e,this.reInitWidgetInstance(s),t.MutableStoreManager.getInstance().updateStateValue(this.props.baseWidgetProps.id,`restoreData.${this.props.baseWidgetProps.id}-restoreData-multimap`,null)}else{const e=document.createElement("div");e.id=`${this.props.baseWidgetProps.id}-bottom-panel`,e.className="w-100 h-100",this.state={currentMapIndex:0,multiMapStyle:gt.firstMapVisible,firstMapDsId:null,secondMapDsId:null,useAnimation:!1,useDataSources:null,currentJimuMapViewId:null,mobilePanelContent:null,mobilePanelContainer:e,activeToolInfo:null}}this.mutableStatePropsMap={},this.useMapWidgetIds=this.props.baseWidgetProps.id?(0,t.Immutable)([this.props.baseWidgetProps.id]):(0,t.Immutable)([]),(0,t.observeStore)(this.onPageChange,["appRuntimeInfo","currentPageId"])}componentDidMount(){if((0,t.getAppStore)().getState().mapWidgetsInfo&&((0,t.getAppStore)().getState().mapWidgetsInfo[this.props.baseWidgetProps.id]||(0,t.getAppStore)().dispatch(t.appActions.MapWidgetInfoAdded(this.props.baseWidgetProps.id,(0,t.Immutable)({mapWidgetId:this.props.baseWidgetProps.id})))),this.__unmount=!1,this.isReIniting)return;const e=this.props.baseWidgetProps.useDataSources;if(e){let t=this.props.baseWidgetProps.config.initialMapDataSourceID;if(this.props.baseWidgetProps.isRunAppMode){const i=this.props.baseWidgetProps.id;if(1===vt.runtimeInitedMapWidgets[i]){const i=this.props.baseWidgetProps.runtimeUrlHashParams;if(i&&i.active_datasource_id){e.map((e=>e.dataSourceId)).includes(i.active_datasource_id)&&(t=i.active_datasource_id)}}}t?t===(e[0]&&e[0].dataSourceId)?this.setState({firstMapDsId:e[0]&&e[0].dataSourceId,secondMapDsId:e[1]&&e[1].dataSourceId}):t===(e[1]&&e[1].dataSourceId)?this.setState({firstMapDsId:e[1]&&e[1].dataSourceId,secondMapDsId:e[0]&&e[0].dataSourceId}):this.setState({firstMapDsId:e[0]&&e[0].dataSourceId,secondMapDsId:e[1]&&e[1].dataSourceId}):this.setState({firstMapDsId:e[0]&&e[0].dataSourceId,secondMapDsId:e[1]&&e[1].dataSourceId})}}componentWillUnmount(){this.__unmount=!0;const e=(0,t.getAppStore)().getState().appConfig.widgets;if(e[this.props.baseWidgetProps.id]&&e[this.props.baseWidgetProps.id].useDataSources===this.props.baseWidgetProps.useDataSources){const e={currentMapIndex:this.state.currentMapIndex,multiMapStyle:this.state.multiMapStyle,firstMapDsId:this.state.firstMapDsId,secondMapDsId:this.state.secondMapDsId,useAnimation:this.state.useAnimation,currentJimuMapViewId:this.state.currentJimuMapViewId};t.MutableStoreManager.getInstance().updateStateValue(this.props.baseWidgetProps.id,`restoreData.${this.props.baseWidgetProps.id}-restoreData-multimap`,e)}e[this.props.baseWidgetProps.id]||(0,t.getAppStore)().dispatch(t.appActions.MapWidgetInfoRemoved(this.props.baseWidgetProps.id))}static getDerivedStateFromProps(e,t){if(e.baseWidgetProps.useDataSources!==t.useDataSources){return vt.getChangedState(t.firstMapDsId,t.secondMapDsId,e.baseWidgetProps.useDataSources)}return null}componentDidUpdate(e,i,s){var o,a;if(this.props.baseWidgetProps.stateProps&&this.props.baseWidgetProps.stateProps.initialMapDataSourceID){const e=this.props.baseWidgetProps.stateProps.initialMapDataSourceID;if(this.state.firstMapDsId===e){const e=null===(o=this.firstMapInstance)||void 0===o?void 0:o.current;e&&e.goHome(!1)}if(this.state.secondMapDsId===e){const e=null===(a=this.secondMapInstance)||void 0===a?void 0:a.current;e&&e.goHome(!1)}this.props.baseWidgetProps.dispatch(t.appActions.widgetStatePropChange(this.props.baseWidgetProps.id,"initialMapDataSourceID",null))}this.isReIniting?this.isReIniting=!1:(this.props.baseWidgetProps.config.initialMapDataSourceID!==e.baseWidgetProps.config.initialMapDataSourceID&&this.changeInitialMapDataSourceID(this.props.baseWidgetProps.config.initialMapDataSourceID,this.confirmJimuMapViewIsActive),this.props.baseWidgetProps.useDataSources!==e.baseWidgetProps.useDataSources&&this.confirmJimuMapViewIsActive())}getJimuMapViewByDataSourceId(e){const t=x(this.props.baseWidgetProps.id,e);return i.MapViewManager.getInstance().getJimuMapViewById(t)}setActiveJimuMapView(e,t){var i,s;if(t){e.setIsActive(t),this.setState({currentJimuMapViewId:e.id}),this.props.onActiveJimuMapViewChange&&this.props.onActiveJimuMapViewChange(e);const o=null===(i=this.props)||void 0===i?void 0:i.baseWidgetProps;if(o){let t=(null===(s=o.runtimeUrlHashParams)||void 0===s?void 0:s.active_datasource_id)||o.config.initialMapDataSourceID;if(!t){const e=o.useDataSources;e&&1===e.length&&(t=e[0].dataSourceId)}t||(t="");(e.dataSourceId||"")!==t&&P(e)}}else e.setIsActive(t)}getLayoutConfig(){return"xsmall"===this.props.widthBreakpoint?ut[0]:this.props.baseWidgetProps.config.layoutIndex?dt[this.props.baseWidgetProps.config.layoutIndex]:dt[0]}render(){var e;const s=this.domRef.current,o=i.MapViewManager.getInstance().getJimuMapViewById(this.state.currentJimuMapViewId);return t.React.createElement(N.Provider,{value:{mapWidgetId:this.props.baseWidgetProps.id,mapWidgetHeight:this.props.widgetHeight,isShowMapSwitchBtn:this.props.baseWidgetProps.useDataSources&&this.props.baseWidgetProps.useDataSources.length>1&&this.isShowMapSwitchBtn(),dataSourceIds:[this.state.firstMapDsId,this.state.secondMapDsId],activeDataSourceId:this.getCurrentVisibleDsId(),switchMap:this.switchMap,fullScreenMap:this.props.fullScreenMap,isFullScreen:this.props.isFullScreen,mobilePanelContainer:this.state.mobilePanelContainer,onMobilePanelContentChange:this.handleMobilePanelContentChange,initialMapState:this.props.baseWidgetProps.config&&this.props.baseWidgetProps.config.initialMapState,theme:this.props.baseWidgetProps.theme}},t.React.createElement("div",{ref:this.domRef,className:"w-100 h-100 multi-source-map"},!this.props.isDefaultMap&&t.React.createElement("div",{className:"w-100 h-100 multi-map-container",style:{position:"relative"}},t.React.createElement("div",{className:(0,t.classNames)("w-100 h-100 map1",{"multisourcemap-item-appear":this.state.useAnimation&&this.state.multiMapStyle[0].opacity,"multisourcemap-item-disappear":this.state.useAnimation&&!this.state.multiMapStyle[0].opacity,"multisourcemap-item-appear-noanimate":this.state.multiMapStyle[0].opacity,"multisourcemap-item-disappear-noanimate":!this.state.multiMapStyle[0].opacity}),style:{position:"absolute",zIndex:this.state.multiMapStyle[0].zIndex}},this.state.firstMapDsId&&this.props.isMapInVisibleArea&&t.React.createElement(z,{ref:this.firstMapInstance,baseWidgetProps:this.props.baseWidgetProps,onMapLoaded:this.handleMapLoaded,onMutableStatePropsChanged:this.handleMutableStatePropsChanged,onExtentChanged:this.onMapbaseExtentChanged,onJimuMapViewCreated:this.handleJimuMapViewCreated,onActiveToolInfoChange:this.handleActiveToolInfoChange,startLoadModules:this.props.startLoadModules,dataSourceId:this.state.firstMapDsId,widthBreakpoint:this.props.widthBreakpoint,isMapInVisibleArea:this.props.isMapInVisibleArea,multiSourceMapDom:s})),t.React.createElement("div",{className:(0,t.classNames)("w-100 h-100 map2",{"multisourcemap-item-appear":this.state.useAnimation&&this.state.multiMapStyle[1].opacity,"multisourcemap-item-disappear":this.state.useAnimation&&!this.state.multiMapStyle[1].opacity,"multisourcemap-item-appear-noanimate":this.state.multiMapStyle[1].opacity,"multisourcemap-item-disappear-noanimate":!this.state.multiMapStyle[1].opacity}),style:{position:"absolute",zIndex:this.state.multiMapStyle[1].zIndex}},this.state.secondMapDsId&&this.props.isMapInVisibleArea&&t.React.createElement(z,{ref:this.secondMapInstance,baseWidgetProps:this.props.baseWidgetProps,onMapLoaded:this.handleMapLoaded,onMutableStatePropsChanged:this.handleMutableStatePropsChanged,onExtentChanged:this.onMapbaseExtentChanged,onJimuMapViewCreated:this.handleJimuMapViewCreated,onActiveToolInfoChange:this.handleActiveToolInfoChange,startLoadModules:this.props.startLoadModules,dataSourceId:this.state.secondMapDsId,widthBreakpoint:this.props.widthBreakpoint,isMapInVisibleArea:this.props.isMapInVisibleArea,multiSourceMapDom:s}))),this.props.isDefaultMap&&t.React.createElement("div",{className:"w-100 h-100 default-map-container",style:{position:"relative"}},t.React.createElement("div",{className:(0,t.classNames)("w-100 h-100 multisourcemap-item-appear-noanimate default-map-mapbase-container"),style:{position:"absolute",zIndex:"unset"}},this.props.isMapInVisibleArea&&t.React.createElement(z,{ref:this.firstMapInstance,isDefaultMap:this.props.isDefaultMap,baseWidgetProps:this.props.baseWidgetProps,onMapLoaded:this.handleMapLoaded,onMutableStatePropsChanged:this.handleMutableStatePropsChanged,dataSourceId:null,onExtentChanged:this.onMapbaseExtentChanged,onJimuMapViewCreated:this.handleJimuMapViewCreated,onActiveToolInfoChange:this.handleActiveToolInfoChange,startLoadModules:this.props.startLoadModules,widthBreakpoint:this.props.widthBreakpoint,isMapInVisibleArea:this.props.isMapInVisibleArea,defaultMapInfo:this.props.defaultMapInfo,multiSourceMapDom:s}))),this.state.currentJimuMapViewId&&t.React.createElement(J,{jimuMapView:o,appMode:this.props.baseWidgetProps.appMode,layouts:this.props.baseWidgetProps.layouts,LayoutEntry:this.props.baseWidgetProps.builderSupportModules&&this.props.baseWidgetProps.builderSupportModules.LayoutEntry,widgetManifestName:this.props.baseWidgetProps.manifest.name}),this.state.currentJimuMapViewId&&o&&t.React.createElement(ht,{mapWidgetId:this.props.baseWidgetProps.id,isMobile:"xsmall"===this.props.widthBreakpoint,jimuMapView:o,appMode:this.props.baseWidgetProps.appMode,layouts:this.props.baseWidgetProps.layouts,intl:this.props.baseWidgetProps.intl,LayoutEntry:this.props.baseWidgetProps.builderSupportModules&&this.props.baseWidgetProps.builderSupportModules.LayoutEntry,layoutConfig:this.getLayoutConfig(),toolConfig:this.props.baseWidgetProps.config.toolConfig?this.props.baseWidgetProps.config.toolConfig:{},activeToolInfo:this.state.activeToolInfo,onActiveToolInfoChange:this.handleActiveToolInfoChange,theme:this.props.baseWidgetProps.theme,widgetManifestName:this.props.baseWidgetProps.manifest.name,widgetHeight:"xsmall"===this.props.widthBreakpoint?null:this.props.widgetHeight,autoControlWidgetId:this.props.autoControlWidgetId,onMouseOverPopper:this.onMouseOverPopper,onMouseOutPopper:this.onMouseOutPopper}),t.React.createElement(i.JimuMapViewComponent,{useMapWidgetId:null===(e=this.useMapWidgetIds)||void 0===e?void 0:e[0],onViewGroupCreate:this.handleViewGroupCreate}),t.React.createElement(t.ReactResizeDetector,{targetRef:this.domRef,handleHeight:!0,handleWidth:!0,onResize:this.onResize})))}}vt.runtimeInitedMapWidgets={},vt.getChangedState=(e,t,i)=>{const s={};if(i&&i[0]){const o=[],a=[];for(let t=0;t<i.length;t++)e!==i[t].dataSourceId?o.push(i[t].dataSourceId):a.push(i[t].dataSourceId);a.length>0?(s.firstMapDsId=e,s.secondMapDsId=o[0]):0===a.length&&(o.includes(t)?(o.splice(o.indexOf(t),1),s.firstMapDsId=o[0],s.secondMapDsId=t):(s.firstMapDsId=o[0],s.secondMapDsId=o[1]))}else s.firstMapDsId=null,s.secondMapDsId=null;return s.firstMapDsId!==e?s.firstMapDsId?(s.multiMapStyle=gt.firstMapVisible,s.currentMapIndex=0):s.secondMapDsId?(s.multiMapStyle=gt.secondMapVisible,s.currentMapIndex=1):(s.multiMapStyle=gt.firstMapVisible,s.currentMapIndex=0):s.secondMapDsId?s.secondMapDsId!==t&&(s.multiMapStyle=gt.secondMapVisible,s.currentMapIndex=1):(s.multiMapStyle=gt.firstMapVisible,s.currentMapIndex=0),s};const wt=vt;class ft extends t.React.PureComponent{constructor(e){super(e),this.state={defaultMapInfo:null}}componentDidMount(){i.portalUtils.getDefaultWebMap(this.props.baseWidgetProps.portalUrl).then((e=>{this.setState({defaultMapInfo:e})}))}render(){return t.React.createElement("div",{className:"w-100 h-100"},!this.state.defaultMapInfo&&t.React.createElement("div",{className:"widget-map w-100 h-100 widget-map-background"},t.React.createElement("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"})),this.state.defaultMapInfo&&t.React.createElement("div",{className:(0,t.classNames)("w-100 h-100",{"map-is-design-mode":!S(this.props.baseWidgetProps.appMode)})},t.React.createElement(wt,{key:0,fullScreenMap:this.props.fullScreenMap,baseWidgetProps:this.props.baseWidgetProps,startLoadModules:this.props.startLoadModules,isDefaultMap:!0,ref:this.props.setMultiSourceMapInstance,onViewGroupCreate:this.props.onViewGroupCreate,onJimuMapViewCreated:this.props.onJimuMapViewCreated,onActiveJimuMapViewChange:this.props.onActiveJimuMapViewChange,widgetHeight:this.props.widgetHeight,widthBreakpoint:this.props.widthBreakpoint,isFullScreen:this.props.isFullScreen,isMapInVisibleArea:this.props.isMapInVisibleArea,defaultMapInfo:this.state.defaultMapInfo,autoControlWidgetId:this.props.autoControlWidgetId})))}}class yt extends t.BaseVersionManager{constructor(){super(...arguments),this.versions=[{version:"1.10.0",description:"1.10.0",upgrader:e=>{let i;return e.toolConifg&&(i=t.Immutable.without(e,"toolConifg"),i=i.set("toolConfig",e.toolConifg)),i||(i=e),i}},{version:"1.16.0",description:'update config.popupDockPosition to "auto" if value is "top-right" for Map widget',upgrader:e=>{let t=e;return"top-right"===e.popupDockPosition&&(t=e.set("popupDockPosition","auto")),t||(t=e),t}}]}}const Mt=new yt;var St=r(1888),bt=function(e,t,i,s){return new(i||(i=Promise))((function(o,a){function n(e){try{l(s.next(e))}catch(e){a(e)}}function r(e){try{l(s.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof i?t:new i((function(e){e(t)}))).then(n,r)}l((s=s.apply(e,t||[])).next())}))};const xt="fake-fullscreen-map";class It extends t.React.PureComponent{constructor(e){super(e),this.container=t.React.createRef(),this.multiSourceMapInstance=null,this.activeJimuMapView=null,this.watchSelectedFeatureHandle=null,this.dataActionListContainer=null,this.reactiveUtils=null,this.popupDomNodeObserver=null,this.startRenderMap=()=>{setTimeout((()=>{this.setState({startLoadModules:!0})}),100)},this.getPlaceHolderImage=()=>{let e=this.props.config.placeholderImage;const i=t.SessionManager.getInstance().getMainSession();if(e){new RegExp("^(.)+/sharing/rest/content/items/(.)+/info/(.)+").test(e)&&i&&(e+=`?token=${i.token}`)}return e},this.onFullscreenChangeHandler=e=>{const t=A(),i=t&&t===this.container.current;this.setState({isFullScreen:i})},this.fullScreenMap=()=>{if(!!document&&(document.fullscreenEnabled||document.webkitFullscreenEnabled||document.webkitFullScreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled)){A()===this.container.current?function(){try{document.exitFullscreen?document.exitFullscreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.webkitExitFullScreen?document.webkitExitFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(e){console.error("exitFullscreen error",e)}}():function(e){try{e.requestFullscreen?e.requestFullscreen():e.webkitRequestFullscreen?e.webkitRequestFullscreen():e.webkitRequestFullScreen?e.webkitRequestFullScreen():e.mozRequestFullScreen?e.mozRequestFullScreen():e.msRequestFullscreen&&e.msRequestFullscreen()}catch(e){console.error("requestFullscreen error",e)}}(this.container.current)}else this.container.current.classList.contains(xt)?(this.container.current.classList.remove(xt),this.setState({isFullScreen:!1})):(this.container.current.classList.add(xt),this.setState({isFullScreen:!0}))},this.handleViewGroupCreate=e=>{e&&e.setMapWidgetInstance(this)},this.onJimuMapViewCreated=e=>{e.setMapWidgetState(this.props.state),this.setShowPopupUponSelectionForJimuMapView(e)},this.onActiveJimuMapViewChange=e=>{this.activeJimuMapView=e,this.watchPopupSelectedFeatureChange()},this.switchMap=(...e)=>bt(this,[...e],void 0,(function*(e=!1){if(this.multiSourceMapInstance)return yield this.multiSourceMapInstance.switchMap(e);yield Promise.resolve()})),this.setMultiSourceMapInstance=e=>{this.multiSourceMapInstance=e},this.onResize=({width:e,height:t})=>{e&&t&&(e<=545&&e>0?this.setState({widthBreakpoint:"xsmall",widgetHeight:t}):this.setState({widthBreakpoint:"other",widgetHeight:t}))},this.isLoadingDisplayed=()=>{var e;const t=(null===(e=this.props.mutableStateProps)||void 0===e?void 0:e.addToMapDatas)||{};return Object.values(t).some((e=>(null==e?void 0:e.dataChangeStatus)===i.DataChangeStatus.Pending))},this.isWarningDisplayed=()=>{var e;const t=(null===(e=this.props.mutableStateProps)||void 0===e?void 0:e.addToMapDatas)||{};return Object.values(t).some((e=>(null==e?void 0:e.dataChangeStatus)===i.DataChangeStatus.Rejected))},this.getInnerContent=e=>this.state.startLoadModules?this.props.useDataSources&&this.props.useDataSources[0]&&this.props.useDataSources[0].dataSourceId?(0,t.jsx)("div",{className:"w-100 h-100",ref:e=>{this.parentContainer=e}},(0,t.jsx)("div",{css:this.getInnerContentStyle(),className:"w-100 h-100 map-component-container",ref:this.container},(0,t.jsx)("div",{className:(0,t.classNames)("w-100 h-100",{"map-is-design-mode":!S(this.props.appMode)})},this.props.useDataSources.length>=1&&(0,t.jsx)(wt,{key:1,fullScreenMap:this.fullScreenMap,baseWidgetProps:this.props,startLoadModules:this.state.startLoadModules,ref:this.setMultiSourceMapInstance,onViewGroupCreate:this.handleViewGroupCreate,onJimuMapViewCreated:this.onJimuMapViewCreated,onActiveJimuMapViewChange:this.onActiveJimuMapViewChange,widgetHeight:this.state.widgetHeight,widthBreakpoint:this.state.widthBreakpoint,isFullScreen:this.state.isFullScreen,isMapInVisibleArea:e,autoControlWidgetId:this.props.autoControlWidgetId})),(0,t.jsx)(t.ReactResizeDetector,{targetRef:this.container,handleWidth:!0,handleHeight:!0,onResize:this.onResize}))):(0,t.jsx)("div",{className:"w-100 h-100",ref:e=>{this.parentContainer=e}},(0,t.jsx)("div",{css:this.getInnerContentStyle(),className:"w-100 h-100 map-component-container",ref:this.container},(0,t.jsx)("div",{className:(0,t.classNames)("w-100 h-100",{"map-is-design-mode":!S(this.props.appMode)})},(0,t.jsx)(ft,{fullScreenMap:this.fullScreenMap,baseWidgetProps:this.props,startLoadModules:this.state.startLoadModules,isDefaultMap:!0,setMultiSourceMapInstance:this.setMultiSourceMapInstance,onViewGroupCreate:this.handleViewGroupCreate,onJimuMapViewCreated:this.onJimuMapViewCreated,onActiveJimuMapViewChange:this.onActiveJimuMapViewChange,widgetHeight:this.state.widgetHeight,widthBreakpoint:this.state.widthBreakpoint,isFullScreen:this.state.isFullScreen,isMapInVisibleArea:e,autoControlWidgetId:this.props.autoControlWidgetId})),(0,t.jsx)(t.ReactResizeDetector,{targetRef:this.container,handleWidth:!0,handleHeight:!0,onResize:this.onResize}))):(0,t.jsx)("div",{css:this.getInnerContentStyle(),className:"w-100 h-100"},(0,t.jsx)("div",{className:"widget-map w-100 h-100"},(0,t.jsx)("div",{style:{position:"absolute",left:"50%",top:"50%"},className:"jimu-secondary-loading"}))),this.warningIcon='<svg width="16" height="15" viewBox="0 0 16 15" fill="none" xmlns="http://www.w3.org/2000/svg">\n                        <path d="M7.09926 5.37004C7.04598 4.83729 7.46434 4.375 7.99975 4.375C8.53516 4.375 8.95353 4.83728 8.90025 5.37004L8.5495 8.87748C8.52126 9.15992 8.2836 9.375 7.99975 9.375C7.71591 9.375 7.47825 9.15992 7.45 8.87748L7.09926 5.37004Z" fill="#938500"/>\n                        <path d="M7.99975 12.375C8.55204 12.375 8.99975 11.9273 8.99975 11.375C8.99975 10.8227 8.55204 10.375 7.99975 10.375C7.44747 10.375 6.99975 10.8227 6.99975 11.375C6.99975 11.9273 7.44747 12.375 7.99975 12.375Z" fill="#938500"/>\n                        <path fill-rule="evenodd" clip-rule="evenodd" d="M1.66642 14.375C0.9115 14.375 0.428811 13.5705 0.784067 12.9044L7.1174 1.02941C7.49387 0.323529 8.50564 0.323529 8.88211 1.02941L15.2154 12.9044C15.5707 13.5705 15.088 14.375 14.3331 14.375H1.66642ZM1.66642 13.375L7.99975 1.5L14.3331 13.375H1.66642Z" fill="#938500"/>\n                        </svg>',this.state={widthBreakpoint:null,widgetHeight:null,isFullScreen:!1,dataActionDataSet:null},this.dataActionListContainer=document.createElement("div"),this.dataActionListContainer.className="data-action-list-wrapper",this.loadReactiveUtils()}getWidgetGlobalStyle(){return t.css`
    /*
      Position fixed doesn't work when using transform
      https://stackoverflow.com/questions/2637058/position-fixed-doesnt-work-when-using-webkit-transform
      Need to clear the transform of this.container's all ancestors.
      We also need  to make sure all ancestors have fixed position, otherwise strange behavior may occur on iPhone browsers of iOS 17.7.1.
    */
    *:has(.fake-fullscreen-map) {
      transform: none !important;
      position: fixed !important;
      left: 0;
      right: 0;
      top: 0;
      bottom: 0;
      z-index: 1;
    }

    /*
      Put the map widget into a widget controller and open the map widget from widget controller on mobile devices, you can see the map widget is placed at a MobilePanel.
      After click the full screen map tool, you can see the close button of MobilePanel overlaps the map widget.
      To solve the above case, we need to update the z-index of widget-content.
    */
    .widget-renderer > .widget-content:has(.fake-fullscreen-map) {
      z-index: 1;
    }
    `}getWidgetSyle(){return t.css`
      /*
        If the initial zoom of map is small (e.g. zoom is 0), map tiles can't cover all the map widget.
        When the above map enter real full screen mode, the blank area of map shows black. So we need to update the map's background color for full screen mode.
        https://stackoverflow.com/questions/16163089/background-element-goes-black-when-entering-fullscreen-with-html5
      */
      .map-component-container:fullscreen {
        background: white;

        /*
          case1: When map is not in real full screen mode, document.fullscreenElement is null and popper is placed into document.body. So, the popper of map tool is above map popup as expected.
          case2: When map is in real full screen mode, document.fullscreenElement is this.container and popper is placed into this.container.
                 The default z-index of popper is 1, but z-index of .esri-popup is 9, so the popper of map tool is below .esri-popup. This is not expected.
          We need to add the following css to fix case2 for both pc layout tool (.map-tool-popper), mobile layout tool (.map-tool-mobile-panel) and other widget's Popper or MobilePanel (.popper[role="dialog"]).
          If fact, if we set .popper[role="dialog"], we don't need to set .map-tool-popper and .map-tool-mobile-panel, but we can still keep it here.
          The className of normal Popper is 'popper' and the className of MobilePanel is 'popper mobile-panel-popper'. The role attribute of both normal Popper and MobilePanel is 'dialog'.
        */
        .map-tool-popper, .map-tool-mobile-panel, .popper[role="dialog"], .popper.jimu-dropdown-menu {
          z-index: 9 !important;
        }
      }

      /*
        .fake-fullscreen-map is used to support the fake full screen for iPhone browsers.
      */
      .fake-fullscreen-map {
        position: fixed !important;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        background: white;
      }

      /*
        Put map widget2 into map widget1. Both map widgets enable full screen tool. After click the full screen tool of map widget2, you can see the map tools of map widget1 overlap map widget2.
        To solve the above case, we need to hide the map-tool-layout of map widget1.
      */
      .multi-source-map:has(.fake-fullscreen-map) > .map-tool-layout {
        display: none;
      }

      .map-loading-bar {
        z-index: 8;
      }

      .map-warning-bar {
        z-index: 8;
        position: absolute;
        bottom: 4px;
        left: 4px;
        right: 4px;
        height: 35px;
        background: #fffdeb;
        border: 1px solid #fff592;
        display: flex;
        align-items: center;
        justify-content: flex-start;

        .warning-icon {
          width: 14px;
          margin: 0 12px 0 12px;
        }
      }

      .map-fix-layout {
        position: absolute !important;
        left: 0;
        right: 0;
        top: 0;
        bottom: 0;
        width: 100%;
        height: 100%;
        z-index: 7;
        pointer-events: none;
      }

      .hide-map-tools-layout .map-tool-layout{
        display: none;
      }

      .esri-view-root > .esri-ui {
        z-index: unset;
        /*
        In API 4.31 and earlier versions, contain has a default value of 'none', and .esri-ui .esri-popup { z-index: 9; } can make the popup appear above the widget and map tool.
        However, starting from API 4.32, the value of contain is set to 'layout', in order to improve the layout performance of .esri-ui ,
        but this makes .esri-ui .esri-popup { z-index: 9; } invalid. In order to solve the popup z-index problem, we need to reset the value of contain to 'none'.
        */
        contain: none;
      }

      .esri-ui-manual-container .esri-swipe {
        z-index: 0;
      }

      .esri-ui .esri-popup {
        z-index: 9;
      }

      .esri-features .esri-feature-content a[href] {
        text-decoration-line: underline;
      }

      .data-action-list-wrapper {
        margin: 3px;
      }
    `}getInnerContentStyle(){const e=this.props.theme;return t.css`
      position: relative;

      .map-is-live-mode {
        .exbmap-ui {
          pointer-events: auto !important;
        }

        .is-widget {
          pointer-events: auto !important;
        }
      }

      .widget-map-usemask {
        pointer-events: auto !important;
      }

      .map-is-design-mode {
        .exbmap-ui,
        .exbmap-ui-tool {
          pointer-events: none !important;
        }

        .is-widget {
          pointer-events: auto !important;
        }
      }

      .widget-map{
        padding: 0;
        margin: 0;
        height: 100%;
        width: 100%;
        z-index: -1;
        .overview-container{
          position: absolute;
          top: 12px;
          right: 12px;
          width: 300px;
          height: 200px;
          border: 1px solid black;
          z-index: 1;
        }

        .extent-container{
          background-color: rgba(0, 0, 0, 0.5);
          position: absolute;
          z-index: 2;
        }

        .extent-btn-container{
          button{
            outline: none;
          }
          .previous-extent-btn{
            color: #111;
          }
          .next-extent-btn{
            color: #222;
          }
        }
      }

      .mapswitch-container {
        position: absolute;
        z-index: 7;
        width: 32px;
        height: 32px;
        bottom: 10px;
        left: 10px;
        box-shadow: 0 1px 2px rgba(0, 0, 0, 0.3)
      }

      .mapswitch-icon {
        fill: black;
        left: 8px;
        top: 8px;
        position: absolute;
        display: block;
      }

      .widget-map-background {
        background-color: ${e.ref.palette.white};
        position: absolute;
        z-index: 1;
      }

      .widget-map-crashed {
        background-color: ${t.polished.rgba(e.ref.palette.white,.85)};
        position: absolute;
        z-index: 1;
        top: 0;

        .widget-map-crashed-label-padding {
          padding-left: ${t.polished.rem(24)};
          padding-right: ${t.polished.rem(24)};
        }

        .widget-map-crashed-label {
          font-size: ${t.polished.rem(13)};
          color: ${e.ref.palette.black};
          font-weight: bold;
          text-align: center;
        }
      }

      @keyframes appear {
        0%{opacity:0}
        25%{opacity:.25}
        50%{opacity:.5;}
        75%{opacity:.75}
        100%{opacity:1;}
      }

      @keyframes disappear {
        0%{opacity:1}
        25%{opacity:.75}
        50%{opacity:.5;}
        75%{opacity:.25}
        100%{opacity:0;}
      }

      .multisourcemap-item-appear {
        animation: appear 300ms;
        -webkit-animation: appear 300ms;
        -moz-animation: appear 300ms;
        animation-fill-mode: forwards;
        -webkit-animation-fill-mode: forwards;
        -moz-animation-fill-mode: forwards;
        animation-timing-function: ease-in;
        -webkit-animation-timing-function: ease-in;
        -moz-animation-timing-function: ease-in;
      }

      .multisourcemap-item-disappear {
        animation: disappear 300ms;
        -webkit-animation: disappear 300ms;
        -moz-animation: disappear 300ms;
        animation-fill-mode: forwards;
        -webkit-animation-fill-mode: forwards;
        -moz-animation-fill-mode: forwards;
        animation-timing-function: ease-in;
        -webkit-animation-timing-function: ease-in;
        -moz-animation-timing-function: ease-in;
      }

      .multisourcemap-item-appear-noanimate {
        opacity: 1;
      }

      .multisourcemap-item-disappear-noanimate {
        opacity: 0;
      }
      `}componentDidMount(){this.state.startLoadModules||!window.jimuConfig.isInBuilder&&this.props.config.canPlaceHolder||this.startRenderMap(),document.addEventListener("webkitfullscreenchange",this.onFullscreenChangeHandler),document.addEventListener("fullscreenchange",this.onFullscreenChangeHandler)}componentDidUpdate(e,t){var i,s,o;const a=e.state,n=this.props.state;if(a!==n){this.getJimuMapViews().forEach((e=>{e.setMapWidgetState(n)}))}if(!!(null===(i=null==e?void 0:e.config)||void 0===i?void 0:i.showPopupUponSelection)!==!!(null===(o=null===(s=this.props)||void 0===s?void 0:s.config)||void 0===o?void 0:o.showPopupUponSelection)){this.getJimuMapViews().forEach((e=>{this.setShowPopupUponSelectionForJimuMapView(e)}))}(null==e?void 0:e.enableDataAction)!==this.props.enableDataAction&&this.handleDataActionWhenPopupSelectedFeatureChange(this.activeJimuMapView)}componentWillUnmount(){document.removeEventListener("webkitfullscreenchange",this.onFullscreenChangeHandler),document.removeEventListener("fullscreenchange",this.onFullscreenChangeHandler);(0,t.getAppStore)().getState().appConfig.widgets[this.props.id]||t.MutableStoreManager.getInstance().updateStateValue(this.props.id,"restoreData",null)}getJimuMapViews(){let e=[];const t=i.MapViewManager.getInstance().getJimuMapViewGroup(this.props.id);return t&&(e=t.getAllJimuMapViews()),e}setShowPopupUponSelectionForJimuMapView(e){e&&e.setShowPopupUponSelection(!!this.props.config.showPopupUponSelection)}getCurrentPopupSelectedFeature(){var e,t,i;return null===(i=null===(t=null===(e=this.activeJimuMapView)||void 0===e?void 0:e.view)||void 0===t?void 0:t.popup)||void 0===i?void 0:i.selectedFeature}loadReactiveUtils(){return bt(this,void 0,void 0,(function*(){[this.reactiveUtils]=yield(0,i.loadArcGISJSAPIModules)(["esri/core/reactiveUtils"]),this.watchPopupSelectedFeatureChange()}))}watchPopupSelectedFeatureChange(){this.watchSelectedFeatureHandle&&(this.watchSelectedFeatureHandle.remove(),this.watchSelectedFeatureHandle=null);const e=this.activeJimuMapView;e&&this.reactiveUtils&&(this.getCurrentPopupSelectedFeature()&&this.handleDataActionWhenPopupSelectedFeatureChange(e),this.watchSelectedFeatureHandle=this.reactiveUtils.watch((()=>{var t,i;return null===(i=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.popup)||void 0===i?void 0:i.selectedFeature}),(()=>{this.handleDataActionWhenPopupSelectedFeatureChange(e)})))}handleDataActionWhenPopupSelectedFeatureChange(e){return bt(this,void 0,void 0,(function*(){var t;const i=null===(t=null==e?void 0:e.view)||void 0===t?void 0:t.popup,s=null==i?void 0:i.selectedFeature;this.dataActionListContainer.parentNode&&this.dataActionListContainer.parentNode.removeChild(this.dataActionListContainer),this.releasePopupDomNodeObserver(),yield this.updateDataActionDataSet(null);if(this.isDataActionEnabled()&&s){const t=yield this.getDataActionDataSet(e,s);if(this.getCurrentPopupSelectedFeature()!==s)return;if(yield this.updateDataActionDataSet(t),this.getCurrentPopupSelectedFeature()!==s)return;this.watchPopupDomNodeChange(i)}}))}updateDataActionDataSet(e){return new Promise((t=>{this.setState({dataActionDataSet:e},(()=>{t()}))}))}releasePopupDomNodeObserver(){this.popupDomNodeObserver&&(this.popupDomNodeObserver.disconnect(),this.popupDomNodeObserver=null)}watchPopupDomNodeChange(e){this.releasePopupDomNodeObserver();const t=e.domNode||e.container;this.tryAppendDataActionListDomNodeToPopup(t);const i=new MutationObserver((e=>{for(const i of e)"childList"===i.type&&this.tryAppendDataActionListDomNodeToPopup(t)}));i.observe(t,{childList:!0,subtree:!0}),this.popupDomNodeObserver=i}tryAppendDataActionListDomNodeToPopup(e){const t=e.querySelector('calcite-action-bar[slot="action-bar"]');t&&!t.contains(this.dataActionListContainer)&&this.state.dataActionDataSet&&(this.dataActionListContainer.parentNode&&this.dataActionListContainer.parentNode.removeChild(this.dataActionListContainer),t.firstChild?t.insertBefore(this.dataActionListContainer,t.firstChild):t.appendChild(this.dataActionListContainer))}getDataActionDataSet(e,i){return bt(this,void 0,void 0,(function*(){let s=null;try{s=yield this.getLayerDataSourceBySelectedFeature(e,i)}catch(e){s=null,console.error("getLayerDataSourceBySelectedFeature error",e)}if(!s){const e=i.layer;e&&(s=e[t.ExBAddedJSAPIProperties.EXB_DATA_SOURCE])}if(s){const e=s.getLabel()||"",t="mapCurrentRecord",o=this.props.intl.formatMessage({id:t,defaultMessage:de[t]},{layerName:e}),a=s.buildRecord(i);return{dataSource:s,name:o,type:"current",records:[a]}}return null}))}getLayerDataSourceBySelectedFeature(e,i){return bt(this,void 0,void 0,(function*(){let s=null;if(i){const o=i[t.ExBAddedJSAPIProperties.EXB_DATA_SOURCE_ID];if(o&&(s=t.DataSourceManager.getInstance().getDataSource(o)),!s){const t=this.getJimuLayerViewBySelectedFeature(e,i);t&&(s=t.getLayerDataSource(),s||(s=yield t.createLayerDataSource()))}}return s}))}getJimuLayerViewBySelectedFeature(e,t){let i=null;const s=t.jimuLayerViewId;if(s&&(i=e.jimuLayerViews[s]),!i){const s=Object.values(e.jimuLayerViews);if(t.layer&&"esri.layers.BuildingSceneLayer"!==t.layer.declaredClass&&(i=s.find((e=>e.layer===t.layer))),!i){const e=t.sourceLayer;e&&(i=s.find((t=>t.layer===e)))}}return i}isDataActionEnabled(){return!1!==this.props.enableDataAction}renderDataActionList(){return this.isDataActionEnabled()&&this.state.dataActionDataSet?t.ReactDOM.createPortal((0,t.jsx)(s.DataActionList,{widgetId:this.props.id,dataSets:[this.state.dataActionDataSet],disableDataSourceLevelActions:!0,listStyle:s.DataActionListStyle.Dropdown,hideGroupTitle:!0}),this.dataActionListContainer):null}render(){const e=this.renderDataActionList();return(0,t.jsx)("div",{className:"jimu-widget arcgis-map",css:this.getWidgetSyle()},(0,t.jsx)(St.Global,{styles:this.getWidgetGlobalStyle()}),this.isLoadingDisplayed()&&(0,t.jsx)(s.Loading,{className:"map-loading-bar",type:s.LoadingType.Bar}),this.isWarningDisplayed()&&(0,t.jsx)("div",{className:"map-warning-bar"},(0,t.jsx)(s.Icon,{className:"warning-icon",icon:this.warningIcon,size:26,currentColor:!1}),(0,t.jsx)("span",null,this.props.intl.formatMessage({id:"failToAddTheDataOnMap",defaultMessage:"Fail to add the data."}))),e,(0,t.jsx)(U.PageVisibilityContext.Consumer,null,(e=>(0,t.jsx)(U.ViewportVisibilityContext.Consumer,null,(i=>(0,t.jsx)(U.ViewVisibilityContext.Consumer,null,(t=>{const s=!t.isInView||t.isInCurrentView,o=e&&(i||this.props.isPrintPreview)&&s;return this.getInnerContent(o)})))))))}}It.versionManager=Mt,It.mapExtraStateProps=(e,i)=>{var s,o,a;let n="";const r=i.id;e.mapWidgetsInfo&&r&&(n=(null===(s=e.mapWidgetsInfo[r])||void 0===s?void 0:s.autoControlWidgetId)||"");const l=e&&e.appRuntimeInfo&&e.appRuntimeInfo.appMode,p=l===t.AppMode.Run;let c=null;p&&e.urlHashObject&&(c=e.urlHashObject[r]);let h="";const d=null===(a=null===(o=e.appConfig)||void 0===o?void 0:o.attributes)||void 0===a?void 0:a.timezone;return d?d.type===t.TimezoneConfig.Device?h="system":d.type===t.TimezoneConfig.Specific?h=d.value:d.type===t.TimezoneConfig.Data&&(h=""):h="system",{appMode:l,isPrintPreview:e.appRuntimeInfo.isPrintPreview,queryObject:e.queryObject,autoControlWidgetId:n,isRunAppMode:p,runtimeUrlHashParams:c,mapTimeZone:h}};const Ct=It;function Tt(e){r.p=e}})(),l})())}}}));
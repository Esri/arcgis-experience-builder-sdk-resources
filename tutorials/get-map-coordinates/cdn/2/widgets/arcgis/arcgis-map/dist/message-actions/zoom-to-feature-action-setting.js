System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-theme"],(function(e,t){var a={},o={},s={},r={},i={};return{setters:[function(e){a.AllDataSourceTypes=e.AllDataSourceTypes,a.CONSTANTS=e.CONSTANTS,a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.MessageCarryData=e.MessageCarryData,a.MessageType=e.MessageType,a.React=e.React,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.jsx=e.jsx,a.polished=e.polished},function(e){o.Checkbox=e.Checkbox,o.Label=e.Label,o.NumericInput=e.NumericInput,o.Radio=e.Radio},function(e){s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection},function(e){r.DEFAULT_DATA_VIEW_ID=e.DEFAULT_DATA_VIEW_ID,r.DataSourceSelector=e.DataSourceSelector},function(e){i.withTheme=e.withTheme}],execute:function(){e((()=>{var e={79244:e=>{"use strict";e.exports=a},1888:e=>{"use strict";e.exports=i},14321:e=>{"use strict";e.exports=o},13089:e=>{"use strict";e.exports=r},79298:e=>{"use strict";e.exports=s}},t={};function n(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,n),s.exports}n.d=(e,t)=>{for(var a in t)n.o(t,a)&&!n.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.p="";var u={};return n.p=window.jimuConfig.baseUrl,(()=>{"use strict";n.r(u),n.d(u,{default:()=>x});var e=n(79244),t=n(14321),a=n(79298),o=n(13089);const s="Trigger data",r="All data",i="Customized data",c="Return to the initial map extent when selection is cleared",l="Zoom scale",d="Automatic",p="Custom",g="Type a scale";var m=n(1888);function S(t,a){var o,s;const r=T(),i=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[t],n=null===(s=null==i?void 0:i.manifest)||void 0===s?void 0:s.publishMessages;let u=e.MessageCarryData.UseDataSource;return null==n||n.forEach((e=>{const t=e;(null==t?void 0:t.messageCarryData)&&(null==t?void 0:t.messageType)===a&&(u=null==t?void 0:t.messageCarryData)})),u}function h(t,a){if(a===e.MessageType.DataSourceFilterChange){const a=e.DataSourceManager.getInstance().getDataSource(t);if(a&&a.type===e.DataSourceTypes.ImageryLayer)return!1}return!0}function D(t,a,o,s){var r,i;let n=null;const u=f(t,o);if(!(u&&u.length>0))return null;let c=!1;if(a){const t=null===(i=null===(r=e.DataSourceManager.getInstance().getDataSource(a.dataSourceId))||void 0===r?void 0:r.getDataSourceJson())||void 0===i?void 0:i.isOutputFromWidget;c=u.some((e=>!!e&&(A(e.dataSourceId)?e.dataSourceId===a.rootDataSourceId:t||s?a.mainDataSourceId===e.mainDataSourceId:a.dataSourceId===e.dataSourceId)))}if(c)n=a;else if(n=null,u&&1===u.length){const t=u[0];t&&t.dataSourceId&&!A(t.dataSourceId)&&(n=(0,e.Immutable)({dataSourceId:t.dataSourceId,mainDataSourceId:t.mainDataSourceId,dataViewId:t.dataViewId,rootDataSourceId:t.rootDataSourceId}))}return n}function f(t,a){var o;const s=S(t,a),r=T(),i=null===(o=null==r?void 0:r.widgets)||void 0===o?void 0:o[t],n=(null==i?void 0:i.useDataSources)||(0,e.Immutable)([]),u=function(t){var a;const o=null!==(a=null==t?void 0:t.map((e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}))))&&void 0!==a?a:[];return(0,e.Immutable)(o)}(null==i?void 0:i.outputDataSources)||(0,e.Immutable)([]),c=function(t){const a=[],o=I(t),s=null==o?void 0:o.useMapWidgetIds,r={};(null==s?void 0:s.length)>0&&s.forEach((e=>{if(e){const t=I(e),o=null==t?void 0:t.useDataSources;o&&o.forEach((e=>{var t;const o=null===(t=null==e?void 0:e.asMutable)||void 0===t?void 0:t.call(e,{deep:!0});o&&o.dataSourceId&&!r[o.dataSourceId]&&(r[o.dataSourceId]=!0,a.push(o))}))}}));return(0,e.Immutable)(a)}(t),l=u,d=(null==i?void 0:i.useDataSources)?n:c,p=(0,e.Immutable)(d.asMutable({deep:!0}).concat(l.asMutable({deep:!0})));switch(s){case e.MessageCarryData.OutputDataSource:return l;case e.MessageCarryData.UseDataSource:return d;case e.MessageCarryData.BothDataSource:return p}}function I(e){var t;if(!e)return null;const a=T();return null===(t=null==a?void 0:a.widgets)||void 0===t?void 0:t[e]}function y(t,a,o){const s=S(null==t?void 0:t.id,a),r=(null==t?void 0:t.outputDataSources)||[],i=(null==t?void 0:t.useDataSources)||[];if(o)return!1;switch(s){case e.MessageCarryData.OutputDataSource:return 1===(null==r?void 0:r.length);case e.MessageCarryData.UseDataSource:return 1===(null==i?void 0:i.length);case e.MessageCarryData.BothDataSource:return 1===r.length+i.length}}function T(){var t,a,o;return window.jimuConfig.isBuilder?null===(a=null===(t=(0,e.getAppStore)().getState())||void 0===t?void 0:t.appStateInBuilder)||void 0===a?void 0:a.appConfig:null===(o=(0,e.getAppStore)().getState())||void 0===o?void 0:o.appConfig}function v(t,a){let o=[];const s=f(t,a);return s&&s.forEach((e=>{const t=null==e?void 0:e.dataSourceId;t&&A(t)&&o.push(t)})),o=Array.from(new Set(o)),o.length>0?(0,e.Immutable)(o):void 0}function C(t,a){const o=f(t,a),s=[];return o&&o.forEach((e=>{const t=null==e?void 0:e.mainDataSourceId;t&&!A(t)&&s.push(t)})),(0,e.Immutable)(s)}function A(t){const a=T();if(t&&a.dataSources){const o=a.dataSources[t];if(o&&(o.type===e.DataSourceTypes.WebMap||o.type===e.DataSourceTypes.WebScene))return!0}return!1}const M=(0,e.Immutable)([e.AllDataSourceTypes.FeatureLayer,e.AllDataSourceTypes.SceneLayer,e.AllDataSourceTypes.BuildingComponentSubLayer,e.AllDataSourceTypes.ImageryLayer,e.AllDataSourceTypes.OrientedImageryLayer,e.AllDataSourceTypes.SubtypeGroupLayer,e.AllDataSourceTypes.SubtypeSublayer]);class b extends e.React.PureComponent{constructor(s){super(s),this.NoLockTriggerLayerWidgets=["Map"],this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.onAllDataRadioChecked=()=>{const e=this.props.config.set("useAnyTriggerData",!0);this.updateMessageActionConfigAndUseDataSources(e)},this.onCustomizeDataRadioChecked=()=>{const e=this.props.config.set("useAnyTriggerData",!1);this.updateMessageActionConfigAndUseDataSources(e)},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e):this.handleRemoveLayerForTriggerLayer()},this.handleTriggerLayerSelected=t=>{let a=null;if(this.fromRootDsIds)a=t;else{a=f(this.props.messageWidgetId,this.props.messageType).filter((a=>!!t.find((t=>{var o;return t.dataViewId&&t.dataViewId!==e.CONSTANTS.OUTPUT_DATA_VIEW_ID||(null===(o=this.props.config.useDataSources)||void 0===o?void 0:o.find((e=>t.mainDataSourceId===e.mainDataSourceId)))?t.dataSourceId===a.dataSourceId:t.mainDataSourceId===a.mainDataSourceId}))))}let o=this.props.config.set("useDataSource",a[0]);o=o.set("useDataSources",a),this.updateMessageActionConfigAndUseDataSources(o)},this.handleRemoveLayerForTriggerLayer=()=>{let e=this.props.config.set("useDataSource",null);e=e.set("useDataSources",[]),this.updateMessageActionConfigAndUseDataSources(e)},this.handleIsUseCustomZoomToOption=e=>{if(e&&(!this.props.config.zoomToOption||!this.props.config.zoomToOption.scale)){const t=this.props.config.set("isUseCustomZoomToOption",e).setIn(["zoomToOption","scale"],5e3);return void this.updateMessageActionConfigAndUseDataSources(t)}const t=this.props.config.set("isUseCustomZoomToOption",e);this.updateMessageActionConfigAndUseDataSources(t)},this.handleSetCustomZoomScale=e=>{const t=this.props.config.setIn(["zoomToOption","scale"],e);this.updateMessageActionConfigAndUseDataSources(t)},this.onGoToInitialMapExtentWhenSelectionClearedCheckboxChanged=(e,t)=>{t=!!t;const a=this.props.config.set("goToInitialMapExtentWhenSelectionCleared",t);this.updateMessageActionConfigAndUseDataSources(a)},this.getTriggerLayerContent=()=>{const s=this.props.messageType===e.MessageType.DataRecordsSelectionChange,n=this.props.messageType===e.MessageType.DataSourceFilterChange;if(!s&&!n)return null;const u=function(t,a,o,s){var r;const i=T(),n=null===(r=null==i?void 0:i.widgets)||void 0===r?void 0:r[t],u=v(t,s);let c,l=!1;l=!(u&&u.length>0)&&y(n,s,u),c=u&&u.length>0?void 0:C(t,s).filter((e=>h(e,s)));return{isReadOnly:l,useDataSource:a,useDataSources:o||(0,e.Immutable)([]),fromRootDsIds:u,fromDsIds:c}}(this.props.messageWidgetId,this.props.config.useDataSource,this.props.config.useDataSources,this.props.messageType);let c;c=u.useDataSources?(0,e.Immutable)(u.useDataSources):u.useDataSource?(0,e.Immutable)([u.useDataSource]):(0,e.Immutable)([]);const l=!u.isReadOnly;let d,p,g,m=null;s?(m=!0,d=!1,p=!0,g=u.isReadOnly):(m=(e,t)=>!f(this.props.messageWidgetId,this.props.messageType).filter((e=>e.mainDataSourceId===t)).find((t=>{let a;return a=t.dataViewId?t.dataViewId:o.DEFAULT_DATA_VIEW_ID,a===e.id})),d=!0,p=!1,g=!1),this.fromRootDsIds=u.fromRootDsIds;const S=!!this.props.config.useAnyTriggerData,D=this.props.intl.formatMessage({id:"mapAction_AllData",defaultMessage:r}),I=this.props.intl.formatMessage({id:"mapAction_CustomizeData",defaultMessage:i});return(0,e.jsx)("div",null,(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.Label,{className:"d-flex align-items-center",style:{cursor:"pointer"}},(0,e.jsx)(t.Radio,{className:"mr-2",checked:S,onChange:()=>{this.onAllDataRadioChecked()}}),D)),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.Label,{className:"d-flex align-items-center",style:{cursor:"pointer"}},(0,e.jsx)(t.Radio,{className:"mr-2",checked:!S,onChange:()=>{this.onCustomizeDataRadioChecked()}}),I)),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(o.DataSourceSelector,{className:(0,e.classNames)([{"d-none":S}]),types:M,useDataSources:c,fromRootDsIds:u.fromRootDsIds,fromDsIds:u.fromDsIds,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,disableRemove:()=>u.isReadOnly,disableDataSourceList:g,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,isMultiple:l,hideDataView:m,isMultipleDataView:d,disableDataView:p,hideCreateViewButton:!0,enableToSelectOutputDsFromSelf:!0})))},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1}}componentDidMount(){const t=function(t,a,o){let s=null;const r=[];if(t.useDataSource){const e=!1;s=D(a,t.useDataSource,o,e),t.useDataSources&&t.useDataSources.forEach((t=>{const s=D(a,t,o,e);s&&r.push(s)}))}else{let t=f(a,o);t=t.filter((e=>h(e.dataSourceId,o))),t.length>0&&t.forEach(((t,a)=>{let o;A(t.dataSourceId)?o=null:(o=(0,e.Immutable)({dataSourceId:t.dataSourceId,mainDataSourceId:t.mainDataSourceId,rootDataSourceId:t.rootDataSourceId,dataViewId:t.dataViewId}),s||(s=o),r.push(o))}))}return{useDataSource:s,useDataSources:r}}(this.props.config,this.props.messageWidgetId,this.props.messageType);let a=this.props.config.set("useDataSource",t.useDataSource);a=a.set("useDataSources",t.useDataSources),this.updateMessageActionConfigAndUseDataSources(a)}getStyle(t){return e.css`
      .setting-header {
        padding: ${e.polished.rem(10)} ${e.polished.rem(16)} ${e.polished.rem(0)} ${e.polished.rem(16)}
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }
    `}updateMessageActionConfigAndUseDataSources(t){const a=function(t){const a=[];return t&&t.useDataSources&&t.useDataSources.forEach((t=>{if(t){const o=(0,e.Immutable)(t).asMutable({deep:!0});a.push(o)}})),a}(t);this.props.onSettingChange({actionId:this.props.actionId,config:t,useDataSources:a})}render(){const o=this.props.messageType===e.MessageType.DataRecordsSelectionChange,r=this.props.messageType===e.MessageType.DataSourceFilterChange,i=o||r,n=this.props.config.goToInitialMapExtentWhenSelectionCleared||!1;return(0,e.jsx)("div",{css:this.getStyle(this.props.theme)},i&&(0,e.jsx)(a.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:s})},this.getTriggerLayerContent()),(0,e.jsx)(a.SettingSection,{title:this.props.intl.formatMessage({id:"mapZoomToAction_ZoomScale",defaultMessage:l})},(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.Label,{className:"d-flex align-items-center",style:{cursor:"pointer"}},(0,e.jsx)(t.Radio,{className:"mr-2",checked:!this.props.config.isUseCustomZoomToOption,onChange:()=>{this.handleIsUseCustomZoomToOption(!1)}}),this.props.intl.formatMessage({id:"mapZoomToAction_Automatic",defaultMessage:d}))),(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.Label,{className:"d-flex align-items-center",style:{cursor:"pointer"}},(0,e.jsx)(t.Radio,{style:{cursor:"pointer"},className:"mr-2",checked:this.props.config.isUseCustomZoomToOption,onChange:()=>{this.handleIsUseCustomZoomToOption(!0)}}),this.props.intl.formatMessage({id:"mapZoomToAction_Custom",defaultMessage:p}))),this.props.config.isUseCustomZoomToOption&&(0,e.jsx)(a.SettingRow,null,(0,e.jsx)(t.NumericInput,{className:"w-100",placeholder:this.props.intl.formatMessage({id:"mapZoomToAction_TypeScale",defaultMessage:g}),value:this.props.config.zoomToOption&&this.props.config.zoomToOption.scale,onChange:this.handleSetCustomZoomScale}))),o&&(0,e.jsx)(a.SettingSection,null,(0,e.jsx)(t.Label,{className:"d-flex align-items-center"},(0,e.jsx)(t.Checkbox,{checked:n,className:"mr-2",onChange:this.onGoToInitialMapExtentWhenSelectionClearedCheckboxChanged}),this.props.intl.formatMessage({id:"mapAction_ReturnToInitialMapExtent",defaultMessage:c}))))}}b.defaultProps={config:(0,e.Immutable)({useDataSource:null})};const x=(0,m.withTheme)(b)})(),u})())}}}));
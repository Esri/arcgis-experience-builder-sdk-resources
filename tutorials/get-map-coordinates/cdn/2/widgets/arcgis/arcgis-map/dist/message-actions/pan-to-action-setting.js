System.register(["jimu-core","jimu-ui","jimu-ui/advanced/setting-components","jimu-ui/advanced/data-source-selector","jimu-theme","jimu-arcgis"],(function(e,t){var a={},o={},s={},r={},n={},i={};return{setters:[function(e){a.AllDataSourceTypes=e.AllDataSourceTypes,a.CONSTANTS=e.CONSTANTS,a.DataSourceManager=e.DataSourceManager,a.DataSourceTypes=e.DataSourceTypes,a.Immutable=e.Immutable,a.MessageCarryData=e.MessageCarryData,a.MessageType=e.MessageType,a.React=e.React,a.classNames=e.classNames,a.css=e.css,a.getAppStore=e.getAppStore,a.jsx=e.jsx,a.polished=e.polished},function(e){o.Checkbox=e.Checkbox,o.Label=e.Label,o.Radio=e.Radio},function(e){s.SettingRow=e.SettingRow,s.SettingSection=e.SettingSection},function(e){r.DEFAULT_DATA_VIEW_ID=e.DEFAULT_DATA_VIEW_ID,r.DataSourceSelector=e.DataSourceSelector},function(e){n.withTheme=e.withTheme},function(e){i.ArcGISDataSourceTypes=e.ArcGISDataSourceTypes}],execute:function(){e((()=>{"use strict";var e={62686:e=>{e.exports=i},79244:e=>{e.exports=a},1888:e=>{e.exports=n},14321:e=>{e.exports=o},13089:e=>{e.exports=r},79298:e=>{e.exports=s}},t={};function u(a){var o=t[a];if(void 0!==o)return o.exports;var s=t[a]={exports:{}};return e[a](s,s.exports,u),s.exports}u.d=(e,t)=>{for(var a in t)u.o(t,a)&&!u.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:t[a]})},u.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),u.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var c={};u.r(c),u.d(c,{default:()=>E});var l=u(79244),d=u(14321),p=u(79298),S=u(13089);const g="Trigger data",h="All data",m="Customized data",D="Return to the initial map extent when selection is cleared";var f=u(1888),I=u(62686);function y(e,t){var a,o;const s=M(),r=null===(a=null==s?void 0:s.widgets)||void 0===a?void 0:a[e],n=null===(o=null==r?void 0:r.manifest)||void 0===o?void 0:o.publishMessages;let i=l.MessageCarryData.UseDataSource;return null==n||n.forEach((e=>{const a=e;(null==a?void 0:a.messageCarryData)&&(null==a?void 0:a.messageType)===t&&(i=null==a?void 0:a.messageCarryData)})),i}function v(e,t){if(t===l.MessageType.DataSourceFilterChange){const t=l.DataSourceManager.getInstance().getDataSource(e);if(t&&t.type===l.DataSourceTypes.ImageryLayer)return!1}return!0}function T(e,t,a,o){var s,r;let n=null;const i=b(e,a);if(!(i&&i.length>0))return null;let u=!1;if(t){const e=null===(r=null===(s=l.DataSourceManager.getInstance().getDataSource(t.dataSourceId))||void 0===s?void 0:s.getDataSourceJson())||void 0===r?void 0:r.isOutputFromWidget;u=i.some((a=>!!a&&(R(a.dataSourceId)?a.dataSourceId===t.rootDataSourceId:e||o?t.mainDataSourceId===a.mainDataSourceId:t.dataSourceId===a.dataSourceId)))}if(u)n=t;else if(n=null,i&&1===i.length){const e=i[0];e&&e.dataSourceId&&!R(e.dataSourceId)&&(n=(0,l.Immutable)({dataSourceId:e.dataSourceId,mainDataSourceId:e.mainDataSourceId,dataViewId:e.dataViewId,rootDataSourceId:e.rootDataSourceId}))}return n}function b(e,t){var a;const o=y(e,t),s=M(),r=null===(a=null==s?void 0:s.widgets)||void 0===a?void 0:a[e],n=(null==r?void 0:r.useDataSources)||(0,l.Immutable)([]),i=function(e){var t;const a=null!==(t=null==e?void 0:e.map((e=>({dataSourceId:e,mainDataSourceId:e,rootDataSourceId:null}))))&&void 0!==t?t:[];return(0,l.Immutable)(a)}(null==r?void 0:r.outputDataSources)||(0,l.Immutable)([]),u=function(e){const t=[],a=A(e),o=null==a?void 0:a.useMapWidgetIds,s={};(null==o?void 0:o.length)>0&&o.forEach((e=>{if(e){const a=A(e),o=null==a?void 0:a.useDataSources;o&&o.forEach((e=>{var a;const o=null===(a=null==e?void 0:e.asMutable)||void 0===a?void 0:a.call(e,{deep:!0});o&&o.dataSourceId&&!s[o.dataSourceId]&&(s[o.dataSourceId]=!0,t.push(o))}))}}));return(0,l.Immutable)(t)}(e),c=i,d=(null==r?void 0:r.useDataSources)?n:u,p=(0,l.Immutable)(d.asMutable({deep:!0}).concat(c.asMutable({deep:!0})));switch(o){case l.MessageCarryData.OutputDataSource:return c;case l.MessageCarryData.UseDataSource:return d;case l.MessageCarryData.BothDataSource:return p}}function A(e){var t;if(!e)return null;const a=M();return null===(t=null==a?void 0:a.widgets)||void 0===t?void 0:t[e]}function C(e,t,a){const o=y(null==e?void 0:e.id,t),s=(null==e?void 0:e.outputDataSources)||[],r=(null==e?void 0:e.useDataSources)||[];if(a)return!1;switch(o){case l.MessageCarryData.OutputDataSource:return 1===(null==s?void 0:s.length);case l.MessageCarryData.UseDataSource:return 1===(null==r?void 0:r.length);case l.MessageCarryData.BothDataSource:return 1===s.length+r.length}}function M(){var e,t,a;return window.jimuConfig.isBuilder?null===(t=null===(e=(0,l.getAppStore)().getState())||void 0===e?void 0:e.appStateInBuilder)||void 0===t?void 0:t.appConfig:null===(a=(0,l.getAppStore)().getState())||void 0===a?void 0:a.appConfig}function x(e,t){let a=[];const o=b(e,t);return o&&o.forEach((e=>{const t=null==e?void 0:e.dataSourceId;t&&R(t)&&a.push(t)})),a=Array.from(new Set(a)),a.length>0?(0,l.Immutable)(a):void 0}function w(e,t){const a=b(e,t),o=[];return a&&a.forEach((e=>{const t=null==e?void 0:e.mainDataSourceId;t&&!R(t)&&o.push(t)})),(0,l.Immutable)(o)}function R(e){const t=M();if(e&&t.dataSources){const a=t.dataSources[e];if(a&&(a.type===I.ArcGISDataSourceTypes.WebMap||a.type===I.ArcGISDataSourceTypes.WebScene))return!0}return!1}const j=(0,l.Immutable)([l.AllDataSourceTypes.FeatureLayer,l.AllDataSourceTypes.SceneLayer,l.AllDataSourceTypes.BuildingComponentSubLayer,l.AllDataSourceTypes.ImageryLayer,l.AllDataSourceTypes.OrientedImageryLayer,l.AllDataSourceTypes.SubtypeGroupLayer,l.AllDataSourceTypes.SubtypeSublayer]);class L extends l.React.PureComponent{constructor(e){super(e),this.modalStyle={position:"absolute",top:"0",bottom:"0",width:"259px",height:"auto",borderRight:"",borderBottom:"",paddingBottom:"1px"},this.onAllDataRadioChecked=()=>{const e=this.props.config.set("useAnyTriggerData",!0);this.updateMessageActionConfigAndUseDataSources(e)},this.onCustomizeDataRadioChecked=()=>{const e=this.props.config.set("useAnyTriggerData",!1);this.updateMessageActionConfigAndUseDataSources(e)},this.handleTriggerLayerChange=e=>{e&&e.length>0?this.handleTriggerLayerSelected(e):this.handleRemoveLayerForTriggerLayer()},this.handleTriggerLayerSelected=e=>{let t=null;if(this.fromRootDsIds)t=e;else{t=b(this.props.messageWidgetId,this.props.messageType).filter((t=>!!e.find((e=>{var a;return e.dataViewId&&e.dataViewId!==l.CONSTANTS.OUTPUT_DATA_VIEW_ID||(null===(a=this.props.config.useDataSources)||void 0===a?void 0:a.find((t=>e.mainDataSourceId===t.mainDataSourceId)))?e.dataSourceId===t.dataSourceId:e.mainDataSourceId===t.mainDataSourceId}))))}let a=this.props.config.set("useDataSource",t[0]);a=a.set("useDataSources",t),this.updateMessageActionConfigAndUseDataSources(a)},this.handleRemoveLayerForTriggerLayer=()=>{let e=this.props.config.set("useDataSource",null);e=e.set("useDataSources",[]),this.updateMessageActionConfigAndUseDataSources(e)},this.onGoToInitialMapExtentWhenSelectionClearedCheckboxChanged=(e,t)=>{t=!!t;const a=this.props.config.set("goToInitialMapExtentWhenSelectionCleared",t);this.updateMessageActionConfigAndUseDataSources(a)},this.modalStyle.borderRight="1px solid black",this.modalStyle.borderBottom="1px solid black",this.state={isShowLayerList:!1}}componentDidMount(){const e=function(e,t,a){let o=null;const s=[];if(e.useDataSource){const r=!1;o=T(t,e.useDataSource,a,r),e.useDataSources&&e.useDataSources.forEach((e=>{const o=T(t,e,a,r);o&&s.push(o)}))}else{let e=b(t,a);e=e.filter((e=>v(e.dataSourceId,a))),e.length>0&&e.forEach(((e,t)=>{let a;R(e.dataSourceId)?a=null:(a=(0,l.Immutable)({dataSourceId:e.dataSourceId,mainDataSourceId:e.mainDataSourceId,rootDataSourceId:e.rootDataSourceId,dataViewId:e.dataViewId}),o||(o=a),s.push(a))}))}return{useDataSource:o,useDataSources:s}}(this.props.config,this.props.messageWidgetId,this.props.messageType);let t=this.props.config.set("useDataSource",e.useDataSource);t=t.set("useDataSources",e.useDataSources),this.updateMessageActionConfigAndUseDataSources(t)}getStyle(e){return l.css`
      .setting-header {
        padding: ${l.polished.rem(10)} ${l.polished.rem(16)} ${l.polished.rem(0)} ${l.polished.rem(16)}
      }

      .deleteIcon {
        cursor: pointer;
        opacity: .8;
      }

      .deleteIcon:hover {
        opacity: 1;
      }
    `}updateMessageActionConfigAndUseDataSources(e){const t=function(e){const t=[];return e&&e.useDataSources&&e.useDataSources.forEach((e=>{if(e){const a=(0,l.Immutable)(e).asMutable({deep:!0});t.push(a)}})),t}(e);this.props.onSettingChange({actionId:this.props.actionId,config:e,useDataSources:t})}render(){const e=this.props.messageType===l.MessageType.DataRecordsSelectionChange,t=function(e,t,a,o){var s;const r=M(),n=null===(s=null==r?void 0:r.widgets)||void 0===s?void 0:s[e],i=x(e,o);let u,c=!1;c=!(i&&i.length>0)&&C(n,o,i),u=i&&i.length>0?void 0:w(e,o).filter((e=>v(e,o)));return{isReadOnly:c,useDataSource:t,useDataSources:a||(0,l.Immutable)([]),fromRootDsIds:i,fromDsIds:u}}(this.props.messageWidgetId,this.props.config.useDataSource,this.props.config.useDataSources,this.props.messageType);let a;a=t.useDataSources?(0,l.Immutable)(t.useDataSources):t.useDataSource?(0,l.Immutable)([t.useDataSource]):(0,l.Immutable)([]);const o=this.props.config.goToInitialMapExtentWhenSelectionCleared||!1,s=!t.isReadOnly;let r,n,i=null;e?(i=!0,r=!1,n=!0):(i=(e,t)=>!b(this.props.messageWidgetId,this.props.messageType).filter((e=>e.mainDataSourceId===t)).find((t=>{let a;return a=t.dataViewId?t.dataViewId:S.DEFAULT_DATA_VIEW_ID,a===e.id})),r=!0,n=!1),this.fromRootDsIds=t.fromRootDsIds;const u=!!this.props.config.useAnyTriggerData,c=this.props.intl.formatMessage({id:"mapAction_AllData",defaultMessage:h}),f=this.props.intl.formatMessage({id:"mapAction_CustomizeData",defaultMessage:m});return(0,l.jsx)("div",{css:this.getStyle(this.props.theme)},(0,l.jsx)(p.SettingSection,{title:this.props.intl.formatMessage({id:"mapAction_TriggerLayer",defaultMessage:g})},(0,l.jsx)(p.SettingRow,null,(0,l.jsx)(d.Label,{className:"d-flex align-items-center"},(0,l.jsx)(d.Radio,{className:"mr-2",checked:u,onChange:()=>{this.onAllDataRadioChecked()}}),c)),(0,l.jsx)(p.SettingRow,null,(0,l.jsx)(d.Label,{className:"d-flex align-items-center"},(0,l.jsx)(d.Radio,{className:"mr-2",checked:!u,onChange:()=>{this.onCustomizeDataRadioChecked()}}),f)),(0,l.jsx)(p.SettingRow,null,(0,l.jsx)(S.DataSourceSelector,{className:(0,l.classNames)([{"d-none":u}]),types:j,useDataSources:a,fromRootDsIds:t.fromRootDsIds,fromDsIds:t.fromDsIds,hideAddDataButton:!0,hideTypeDropdown:!0,mustUseDataSource:!0,disableRemove:()=>t.isReadOnly,onChange:this.handleTriggerLayerChange,widgetId:this.props.messageWidgetId,isMultiple:s,hideDataView:i,isMultipleDataView:r,disableDataView:n,hideCreateViewButton:!0,enableToSelectOutputDsFromSelf:!0}))),e&&(0,l.jsx)(p.SettingSection,null,(0,l.jsx)(d.Label,{className:"d-flex align-items-center"},(0,l.jsx)(d.Checkbox,{checked:o,className:"mr-2",onChange:this.onGoToInitialMapExtentWhenSelectionClearedCheckboxChanged}),this.props.intl.formatMessage({id:"mapAction_ReturnToInitialMapExtent",defaultMessage:D}))))}}L.defaultProps={config:(0,l.Immutable)({useDataSource:null})};const E=(0,f.withTheme)(L);return c})())}}}));